<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dl_iterate_phdr - walk through list of shared objects</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Walk through list of shared objects">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dl_iterate_phdr<small> (3)</small></h1>
        <p class="lead">Walk through list of shared objects</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dl_iterate_phdr.3.html">
      <span itemprop="name">dl_iterate_phdr</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/man-pages/">
      <span itemprop="name">man-pages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dl_iterate_phdr.3.html">
      <span itemprop="name">dl_iterate_phdr</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>#define _GNU_SOURCE</strong>         /* See <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a> */
<strong>#include &lt;link.h&gt;</strong>

<strong>int dl_iterate_phdr(</strong>
<strong>          int (*</strong><em>callback</em><strong>) (struct dl_phdr_info *</strong><em>info</em><strong>,</strong>
<strong>                           size_t </strong><em>size</em><strong>, void *</strong><em>data</em><strong>),</strong>
<strong>          void *</strong><em>data</em><strong>);</strong></pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>The <strong>dl_iterate_phdr</strong>() function allows an application to inquire at run time to find out which shared objects it has loaded.</p>
<p class='spacer'>

<p>The <strong>dl_iterate_phdr</strong>() function walks through the list of an application's shared objects and calls the function <em>callback</em> once for each object, until either all shared objects have been processed or <em>callback</em> returns a nonzero value.</p>
<p class='spacer'>

<p>Each call to <em>callback</em> receives three arguments: <em>info</em>, which is a pointer to a structure containing information about the shared object; <em>size</em>, which is the size of the structure pointed to by <em>info</em>; and <em>data</em>, which is a copy of whatever value was passed by the calling program as the second argument (also named <em>data</em>) in the call to <strong>dl_iterate_phdr</strong>().</p>
<p class='spacer'>

<p>The <em>info</em> argument is a structure of the following type:</p>
<p class='spacer'>

<pre>struct dl_phdr_info {
    ElfW(Addr)        dlpi_addr;  /* Base address of object */
    const char       *dlpi_name;  /* (Null-terminated) name of
                                     object */
    const ElfW(Phdr) *dlpi_phdr;  /* Pointer to array of
                                     ELF program headers
                                     for this object */
    ElfW(Half)        dlpi_phnum; /* # of items in <em>dlpi_phdr</em> */

    /* The following fields were added in glibc 2.4, after the first
       version of this structure was available.  Check the <em>size</em>
       argument passed to the dl_iterate_phdr callback to determine
       whether or not each later member is available.  */

    unsigned long long int dlpi_adds;
                    /* Incremented when a new object may
                       have been added */
    unsigned long long int dlpi_subs;
                    /* Incremented when an object may
                       have been removed */
    size_t dlpi_tls_modid;
                    /* If there is a PT_TLS segment, its module
                       ID as used in TLS relocations, else zero */
    void  *dlpi_tls_data;
                    /* The address of the calling thread's instance
                       of this module's PT_TLS segment, if it has
                       one and it has been allocated in the calling
		       thread, otherwise a null pointer */
};</pre>

<p class='spacer'>

<p>(The <em>ElfW</em>() macro definition turns its argument into the name of an ELF data type suitable for the hardware architecture. For example, on a 32-bit platform, <em>ElfW(Addr)</em> yields the data type name <em>Elf32_Addr</em>. Further information on these types can be found in the <em>&lt;elf.h&gt;</em> and <em>&lt;link.h&gt;</em> header files.)</p>
<p class='spacer'>

<p>The <em>dlpi_addr</em> field indicates the base address of the shared object (i.e., the difference between the virtual memory address of the shared object and the offset of that object in the file from which it was loaded). The <em>dlpi_name</em> field is a null-terminated string giving the pathname from which the shared object was loaded.</p>
<p class='spacer'>

<p>To understand the meaning of the <em>dlpi_phdr</em> and <em>dlpi_phnum</em> fields, we need to be aware that an ELF shared object consists of a number of segments, each of which has a corresponding program header describing the segment. The <em>dlpi_phdr</em> field is a pointer to an array of the program headers for this shared object. The <em>dlpi_phnum</em> field indicates the size of this array.</p>
<p class='spacer'>

  <p>These program headers are structures of the following form:</p>
<pre>
typedef struct {
    Elf32_Word  p_type;    /* Segment type */
    Elf32_Off   p_offset;  /* Segment file offset */
    Elf32_Addr  p_vaddr;   /* Segment virtual address */
    Elf32_Addr  p_paddr;   /* Segment physical address */
    Elf32_Word  p_filesz;  /* Segment size in file */
    Elf32_Word  p_memsz;   /* Segment size in memory */
    Elf32_Word  p_flags;   /* Segment flags */
    Elf32_Word  p_align;   /* Segment alignment */
} Elf32_Phdr;</pre>

<p class='spacer'>

<p>Note that we can calculate the location of a particular program header, <em>x</em>, in virtual memory using the formula:</p>
<p class='spacer'>

<pre>  addr == info-&gt;dlpi_addr + info-&gt;dlpi_phdr[x].p_vaddr;</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>The <strong>dl_iterate_phdr</strong>() function returns whatever value was returned by the last call to <em>callback</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">

<p><strong>dl_iterate_phdr</strong>() has been supported in glibc since version 2.2.4.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ATTRIBUTES</h2>
        <div class="sectioncontent">

<p>For an explanation of the terms used in this section, see <a href="../man7/attributes.7.html"><strong>attributes</strong>(7)</a>.</p>
<table class="table table-striped">
<tr>
<th>Interface</th>
<th>Attribute</th>
<th>Value</th></tr>

<tr>
<td><strong>dl_iterate_phdr</strong>()  </td>
<td>Thread safety</td>
<td>MT-Safe</td></tr>
</table>

<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">

<p>The <strong>dl_iterate_phdr</strong>() function is not specified in any standard. Various other systems provide a version of this function, although details of the returned <em>dl_phdr_info</em> structure differ. On the BSDs and Solaris, the structure includes the fields <em>dlpi_addr</em>, <em>dlpi_name</em>, <em>dlpi_phdr</em>, and <em>dlpi_phnum</em> in addition to other implementation-specific fields.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<p>Future versions of the C library may add further fields to the <em>dl_phdr_info</em> structure; in that event, the <em>size</em> argument provides a mechanism for the callback function to discover whether it is running on a system with added fields.</p>
<p class='spacer'>

<p>The first object visited by <em>callback</em> is the main program. For the main program, the <em>dlpi_name</em> field will be an empty string.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<p>The following program displays a list of pathnames of the shared objects it has loaded. For each shared object, the program lists the virtual addresses at which the object's ELF segments are loaded.</p>
<p class='spacer'>

<pre>#define _GNU_SOURCE
#include &lt;link.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

static int
callback(struct dl_phdr_info *info, size_t size, void *data)
{
    int j;

    printf("name=%s (%d segments)&#92;n", info-&gt;dlpi_name,
        info-&gt;dlpi_phnum);

    for (j = 0; j &lt; info-&gt;dlpi_phnum; j++)
         printf("&#92;t&#92;t header %2d: address=%10p&#92;n", j,
             (void *) (info-&gt;dlpi_addr + info-&gt;dlpi_phdr[j].p_vaddr));
    return 0;
}

int
main(int argc, char *argv[])
{
    dl_iterate_phdr(callback, NULL);

    exit(EXIT_SUCCESS);
}</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man1/ldd.1.html"><strong>ldd</strong>(1)</a>, <a href="../man1/objdump.1.html"><strong>objdump</strong>(1)</a>, <a href="../man1/readelf.1.html"><strong>readelf</strong>(1)</a>, <a href="../man3/dladdr.3.html"><strong>dladdr</strong>(3)</a>, <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a>, <a href="../man5/elf.5.html"><strong>elf</strong>(5)</a>, <a href="../man8/ld.so.8.html"><strong>ld.so</strong>(8)</a></p>
<p class='spacer'>

<p><em>Executable and Linking Format Specification</em>, available at various locations online.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="div.3.html"><span aria-hidden="true">&larr;</span> div.3: compute quotient and remainder of an integer division</a></li>
   <li class="next"><a href="dladdr.3.html">dladdr.3: translate address to symbolic information <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
