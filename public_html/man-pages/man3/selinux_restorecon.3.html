<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>selinux_restorecon: Restore file(s) default selinux security contexts</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Restore file(s) default selinux security contexts">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">selinux_restorecon<small> (3)</small></h1>
        <p class="lead">Restore file(s) default selinux security contexts</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/selinux_restorecon.3.html">
      <span itemprop="name">selinux_restorecon: Restore file(s) default selinux security contexts</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/selinux/">
      <span itemprop="name">selinux</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/selinux_restorecon.3.html">
      <span itemprop="name">selinux_restorecon: Restore file(s) default selinux security contexts</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include <selinux/restorecon.h></strong></p><p><strong>int</strong> <strong>selinux_restorecon(const</strong> <strong>char</strong> <strong>*</strong><em>pathname</em><strong>,</strong></p><p><strong>unsigned</strong> <strong>int</strong> <strong></strong><em>restorecon_flags</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>selinux_restorecon</strong>() restores file default security contexts on filesystems that support extended attributes (see <a href="../man7/xattr.7.html"><strong>xattr</strong>(7)</a>), based on:</p><p><em>pathname</em> containing a directory or file to be relabeled.</p><p>If this is a directory and the <em>restorecon_flags</em> <strong>SELINUX_RESTORECON_RECURSE</strong> has been set (for decending through directories), then <strong>selinux_restorecon</strong>() will write an SHA1 digest of the combined specfiles (see the <strong>NOTES</strong> section for details) to an extended attribute of <em>security.restorecon_last</em> once the relabeling has been completed successfully. This digest will be checked should <strong>selinux_restorecon</strong>() be rerun with the <em>restorecon_flags</em> <strong>SELINUX_RESTORECON_RECURSE</strong> flag set. If any of the specfiles had been updated, the digest will also be updated. However if the digest is the same, no relabeling checks will take place (unless the <strong>SELINUX_RESTORECON_IGNORE_DIGEST</strong> flag is set).</p><p><em>restorecon_flags</em> contains the labeling option/rules as follows:</p><p><strong>SELINUX_RESTORECON_IGNORE_DIGEST</strong> force the checking of labels even if the stored SHA1 digest matches the specfiles SHA1 digest. The specfiles digest will be written to the <em>security.restorecon_last</em> extended attribute once relabeling has been completed successfully provided the <strong>SELINUX_RESTORECON_NOCHANGE</strong> flag has not been set.</p><p><strong>SELINUX_RESTORECON_NOCHANGE</strong> don't change any file labels (passive check) or update the digest in the <em>security.restorecon_last</em> extended attribute.</p><p><strong>SELINUX_RESTORECON_SET_SPECFILE_CTX</strong> If set, reset the files label to match the default specfile context. If not set only reset the files "type" component of the context to match the default specfile context.</p><p><strong>SELINUX_RESTORECON_RECURSE</strong> change file and directory labels recursively (descend directories) and if successful write an SHA1 digest of the combined specfiles to an extended attribute as described in the <strong>NOTES</strong> section.</p><p><strong>SELINUX_RESTORECON_VERBOSE</strong> log file label changes.</p><p>Note that if <strong>SELINUX_RESTORECON_VERBOSE</strong> and <strong>SELINUX_RESTORECON_PROGRESS</strong> are set, then <strong>SELINUX_RESTORECON_PROGRESS</strong> will take precedence.</p><p><strong>SELINUX_RESTORECON_PROGRESS</strong> show progress by printing * to stdout every 1000 files.</p><p><strong>SELINUX_RESTORECON_REALPATH</strong> convert passed-in <em>pathname</em> to the canonical pathname using <a href="../man3/realpath.3.html"><strong>realpath</strong>(3)</a>.</p><p><strong>SELINUX_RESTORECON_XDEV</strong> prevent descending into directories that have a different device number than the <em>pathname</em> entry from which the descent began.</p><p>The behavior regarding the checking and updating of the SHA1 digest described above is the default behavior. It is possible to change this by first calling <a href="../man3/selabel_open.3.html"><strong>selabel_open</strong>(3)</a> and not enabling the <strong>SELABEL_OPT_DIGEST</strong> option, then calling <a href="../man3/selinux_restorecon_set_sehandle.3.html"><strong>selinux_restorecon_set_sehandle</strong>(3)</a> to set the handle to be used by <a href="../man3/selinux_restorecon.3.html"><strong>selinux_restorecon</strong>(3)</a>.</p><p>If the <em>pathname</em> is a directory path, then it is possible to set files/directories to be excluded from the path by calling <a href="../man3/selinux_restorecon_set_exclude_list.3.html"><strong>selinux_restorecon_set_exclude_list</strong>(3)</a> with a <strong>NULL</strong> terminated list before calling <a href="../man3/selinux_restorecon.3.html"><strong>selinux_restorecon</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>On success, zero is returned.  On error, -1 is returned and <em>errno</em> is set appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>To improve performance when relabeling file systems recursively (e.g. the <em>restorecon_flags</em> <strong>SELINUX_RESTORECON_RECURSE</strong> flag is set) <strong>selinux_restorecon</strong>() will write an SHA1 digest of the specfiles that are processed by <a href="../man3/selabel_open.3.html"><strong>selabel_open</strong>(3)</a> to an extended attribute named <em>security.restorecon_last</em> to the directory specified in the <em>pathname</em>.</p><p>To check the extended attribute entry use <a href="../man1/getfattr.1.html"><strong>getfattr</strong>(1)</a><strong>,</strong> for example:</p><p>getfattr -e hex -n security.restorecon_last /</p><p>The SHA1 digest is calculated by <a href="../man3/selabel_open.3.html"><strong>selabel_open</strong>(3)</a> concatenating the specfiles it reads during initialisation with the resulting digest and list of specfiles being retrieved by <a href="../man3/selabel_digest.3.html"><strong>selabel_digest</strong>(3)</a>.</p><p>The specfiles consist of the mandatory <em>file_contexts</em> file plus any subs, subs_dist, local and homedir entries (text or binary versions) as determined by any <a href="../man3/selabel_open.3.html"><strong>selabel_open</strong>(3)</a> options e.g. <strong>SELABEL_OPT_BASEONLY</strong>.</p><p>Should any of the specfiles have changed, then when <strong>selinux_restorecon</strong>() is run again with the <strong>SELINUX_RESTORECON_RECURSE</strong> flag set, a new SHA1 digest will be calculated and all files will be automatically relabeled depending on the settings of the <strong>SELINUX_RESTORECON_SET_SPECFILE_CTX</strong> flag (provided <strong>SELINUX_RESTORECON_NOCHANGE</strong> is not set).</p><p><strong>/sys</strong> and in-memory filesystems do not support the <em>security.restorecon_last</em> extended attribute and are automatically excluded from any relabeling checks.</p><p><strong>selinux_restorecon</strong>() does not check whether mounted filesystems support the <strong>seclabel</strong> option (i.e. support extended attributes as described in <a href="../man7/xattr.7.html"><strong>xattr</strong>(7)</a>). To exclude these filesystems from any relabeling checks <a href="../man3/selinux_restorecon_set_exclude_list.3.html"><strong>selinux_restorecon_set_exclude_list</strong>(3)</a> should be called prior to <strong>selinux_restorecon</strong>() with a NULL terminated <em>exclude_list</em> of these filesystems.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO selinux_restorecon&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/selinux_restorecon_set_sehandle.3.html"><strong>selinux_restorecon_set_sehandle</strong>(3)</a>,</p><p><a href="../man3/selinux_restorecon_default_handle.3.html"><strong>selinux_restorecon_default_handle</strong>(3)</a>,</p><p><a href="../man3/selinux_restorecon_set_exclude_list.3.html"><strong>selinux_restorecon_set_exclude_list</strong>(3)</a>,</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="selinux_removable_context_path.3.html"><span aria-hidden="true">&larr;</span> selinux_removable_context_path.3: These functions return the paths to the active selinux policy configuration directories and files</a></li>
   <li class="next"><a href="selinux_restorecon_default_handle.3.html">selinux_restorecon_default_handle.3: Sets default parameters for selinux_restorecon(3) <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
