<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>avc_init - legacy userspace SELinux AVC setup .</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Legacy userspace selinux avc setup .">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">avc_init<small> (3)</small></h1>
        <p class="lead">Legacy userspace selinux avc setup .</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/avc_init.3.html">
      <span itemprop="name">avc_init</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/selinux/">
      <span itemprop="name">selinux</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/avc_init.3.html">
      <span itemprop="name">avc_init</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<p><strong>#include &lt;selinux/selinux.h&gt;</strong></p>
<p class='spacer'>

<p><strong>#include &lt;selinux/avc.h&gt;</strong></p>
<p class='spacer'>

<p><strong>int avc_init(const char *</strong><em>msgprefix</em><strong>,</strong> <strong>const struct avc_memory_callback *</strong><em>mem_callbacks</em><strong>,</strong></p>
<p class='spacer'>

<p><strong>const struct avc_log_callback *</strong><em>log_callbacks</em><strong>,</strong></p>
<p class='spacer'>

<p><strong>const struct avc_thread_callback *</strong><em>thread_callbacks</em><strong>,</strong></p>
<p class='spacer'>

<p><strong>const struct avc_lock_callback *</strong><em>lock_callbacks</em><strong>);</strong> .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p><strong>avc_init</strong>() is deprecated; please use <a href="../man3/avc_open.3.html"><strong>avc_open</strong>(3)</a> in conjunction with <a href="../man3/selinux_set_callback.3.html"><strong>selinux_set_callback</strong>(3)</a> in all new code.</p>
<p class='spacer'>

<p><strong>avc_init</strong>() initializes the userspace AVC and must be called before any other AVC operation can be performed.  A non-NULL <em>msgprefix</em> will be prepended to all audit messages produced by the userspace AVC.  The default is `uavc'.  The remaining arguments, if non-NULL, specify callbacks to be used by the userspace AVC. .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CALLBACKS</h2>
        <div class="sectioncontent">

<p>The userspace AVC can be directed how to perform memory allocation, logging, thread creation, and locking via callback functions passed to <strong>avc_init</strong>(). The purpose of this functionality is to allow the userspace AVC to be smoothly integrated into existing userspace object managers.</p>
<p class='spacer'>

<p>Use an <strong>avc_memory_callback</strong> structure to specify alternate functions for dynamic memory allocation.</p>
<p class='spacer'>

<pre>struct avc_memory_callback {
	void	*(*func_malloc)(size_t size);
	void	(*func_free)(void *ptr);
};</pre>

<p class='spacer'>

<p>The two fields of the structure should be pointers to functions which behave as <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a> and <a href="../man3/free.3.html"><strong>free</strong>(3)</a>, which are used by default.</p>
<p class='spacer'>

<p>Use an <strong>avc_log_callback</strong> structure to specify alternate functions for logging.</p>
<p class='spacer'>

<pre>struct avc_log_callback {
	void	(*func_log)(const char *fmt, ...);
	void	(*func_audit)(void *auditdata,
			security_class_t class,
			char *msgbuf, size_t msgbufsize);
};</pre>

<p class='spacer'>

<p>The <strong>func_log</strong> callback should accept a <a href="../man3/printf.3.html"><strong>printf</strong>(3)</a> style format and arguments and log them as desired.  The default behavior prints the message on the standard error.  The <strong>func_audit</strong> callback should interpret the <em>auditdata</em> parameter for the given <em>class</em>, printing a human-readable interpretation to <em>msgbuf</em> using no more than <em>msgbufsize</em> characters.  The default behavior is to ignore <em>auditdata</em>.</p>
<p class='spacer'>

<p>Use an <strong>avc_thread_callback</strong> structure to specify functions for starting and manipulating threads.</p>
<p class='spacer'>

<pre>struct avc_thread_callback {
	void	*(*func_create_thread)(void (*run)(void));
	void	(*func_stop_thread)(void *thread);
};</pre>

<p class='spacer'>

<p>The <strong>func_create_thread</strong> callback should create a new thread and return a pointer which references it.  The thread should execute the <em>run</em> argument, which does not return under normal conditions.  The <strong>func_stop_thread</strong> callback should cancel the running thread referenced by <em>thread</em>. By default, threading is not used; see <strong>NETLINK NOTIFICATION</strong> below.</p>
<p class='spacer'>

<p>Use an <strong>avc_lock_callback</strong> structure to specify functions to create, obtain, and release locks for use by threads.</p>
<p class='spacer'>

<pre>struct avc_lock_callback {
	void	*(*func_alloc_lock)(void);
	void	(*func_get_lock)(void *lock);
	void	(*func_release_lock)(void *lock);
	void	(*func_free_lock)(void *lock);
};</pre>

<p class='spacer'>

<p>The <strong>func_alloc_lock</strong> callback should create a new lock, returning a pointer which references it.  The <strong>func_get_lock</strong> callback should obtain <em>lock</em>, blocking if necessary.  The <strong>func_release_lock</strong> callback should release <em>lock</em>. The <strong>func_free_lock</strong> callback should destroy <em>lock</em>, freeing any resources associated with it.  The default behavior is not to perform any locking.  Note that undefined behavior may result if threading is used without appropriate locking. .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NETLINK NOTIFICATION</h2>
        <div class="sectioncontent">

<p>Beginning with version 2.6.4, the Linux kernel supports SELinux status change notification via netlink.  Two message types are currently implemented, indicating changes to the enforcing mode and to the loaded policy in the kernel, respectively.  The userspace AVC listens for these messages and takes the appropriate action, modifying the behavior of <a href="../man3/avc_has_perm.3.html"><strong>avc_has_perm</strong>(3)</a> to reflect the current enforcing mode and flushing the cache on receipt of a policy load notification.  Audit messages are produced when netlink notifications are processed.</p>
<p class='spacer'>

<p>In the default single-threaded mode, the userspace AVC checks for new netlink messages at the start of each permission query.  If threading and locking callbacks are passed to <strong>avc_init</strong>() however, a dedicated thread will be started to listen on the netlink socket.  This may increase performance and will ensure that log messages are generated immediately rather than at the time of the next permission query. .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>Functions with a return value return zero on success.  On error, -1 is returned and <em>errno</em> is set appropriately. .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<p>The <em>msgprefix</em> argument to <strong>avc_init</strong>() currently has a length limit of 15 characters and will be truncated if necessary.</p>
<p class='spacer'>

<p>If a provided <strong>func_malloc</strong> callback does not set <em>errno</em> appropriately on error, userspace AVC calls may exhibit the same behavior.</p>
<p class='spacer'>

<p>If a netlink thread has been created and an error occurs on the socket (such as an access error), the thread may terminate and cause the userspace AVC to return <strong>EINVAL</strong> on all further permission checks until <strong>avc_destroy</strong> is called. .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<p>Eamon Walsh &lt;ewalsh@tycho.nsa.gov&gt; .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man3/avc_open.3.html"><strong>avc_open</strong>(3)</a>, <a href="../man3/selinux_set_callback.3.html"><strong>selinux_set_callback</strong>(3)</a>, <a href="../man8/selinux.8.html"><strong>selinux</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="avc_has_perm_noaudit.3.html"><span aria-hidden="true">&larr;</span> avc_has_perm_noaudit.3: obtain and audit SELinux access decisions .</a></li>
   <li class="next"><a href="avc_netlink_acquire_fd.3.html">avc_netlink_acquire_fd.3: SELinux netlink processing . <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
