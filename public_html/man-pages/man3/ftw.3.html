<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ftw: File tree walk</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="File tree walk">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ftw<small> (3)</small></h1>
        <p class="lead">File tree walk</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ftw.3.html">
      <span itemprop="name">ftw: File tree walk</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/man-pages/">
      <span itemprop="name">man-pages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ftw.3.html">
      <span itemprop="name">ftw: File tree walk</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include <ftw.h></strong>

<strong>int</strong> <strong>nftw(const</strong> <strong>char</strong> <strong>*</strong><em>dirpath</em><strong>,</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong>(*</strong><em>fn</em><strong>)</strong> <strong>(const</strong> <strong>char</strong> <strong>*</strong><em>fpath</em><strong>,</strong> <strong>const</strong> <strong>struct</strong> <strong>stat</strong> <strong>*</strong><em>sb</em><strong>,</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong></strong><em>typeflag</em><strong>,</strong> <strong>struct</strong> <strong>FTW</strong> <strong>*</strong><em>ftwbuf</em><strong>),</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong></strong><em>nopenfd</em><strong>,</strong> <strong>int</strong> <strong></strong><em>flags</em><strong>);</strong>

<strong>#include <ftw.h></strong>

<strong>int</strong> <strong>ftw(const</strong> <strong>char</strong> <strong>*</strong><em>dirpath</em><strong>,</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong>(*</strong><em>fn</em><strong>)</strong> <strong>(const</strong> <strong>char</strong> <strong>*</strong><em>fpath</em><strong>,</strong> <strong>const</strong> <strong>struct</strong> <strong>stat</strong> <strong>*</strong><em>sb</em><strong>,</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong></strong><em>typeflag</em><strong>),</strong>
<strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong></strong> <strong>int</strong> <strong></strong><em>nopenfd</em><strong>);</strong>
</pre>
<p>Feature Test Macro Requirements for glibc (see <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a>):</p><p><strong>nftw</strong>(): _XOPEN_SOURCE &gt;= 500</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>nftw</strong>() walks through the directory tree that is located under the directory <em>dirpath</em>, and calls <em>fn</em>() once for each entry in the tree. By default, directories are handled before the files and subdirectories they contain (preorder traversal).</p><p>To avoid using up all of the calling process's file descriptors, <em>nopenfd</em> specifies the maximum number of directories that <strong>nftw</strong>() will hold open simultaneously. When the search depth exceeds this, <strong>nftw</strong>() will become slower because directories have to be closed and reopened. <strong>nftw</strong>() uses at most one file descriptor for each level in the directory tree.</p><p>For each entry found in the tree, <strong>nftw</strong>() calls <em>fn</em>() with four arguments: <em>fpath</em>, <em>sb</em>, <em>typeflag</em>, and <em>ftwbuf</em>. <em>fpath</em> is the pathname of the entry, and is expressed either as a pathname relative to the calling process's current working directory at the time of the call to <strong>nftw</strong>(), if <em>dirpath</em> was expressed as a relative pathname, or as an absolute pathname, if <em>dirpath</em> was expressed as an absolute pathname. <em>sb</em> is a pointer to the <em>stat</em> structure returned by a call to <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> for <em>fpath</em>. <em>typeflag</em> is an integer that has one of the following values:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>FTW_F</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a regular file.</p>
  </dd>
  <dt>
    <p><strong>FTW_D</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a directory.</p>
  </dd>
  <dt>
    <p><strong>FTW_DNR</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a directory which can't be read.</p>
  </dd>
  <dt>
    <p><strong>FTW_DP</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a directory, and <strong>FTW_DEPTH</strong> was specified in <em>flags</em>. (If <strong>FTW_DEPTH</strong> was not specified in <em>flags</em>, then directories will always be visited with <em>typeflag</em> set to <strong>FTW_D</strong>.) All of the files and subdirectories within <em>fpath</em> have been processed.</p>
  </dd>
  <dt>
    <p><strong>FTW_NS</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> call failed on <em>fpath</em>, which is not a symbolic link. The probable cause for this is that the caller had read permission on the parent directory, so that the filename <em>fpath</em> could be seen, but did not have execute permission, so that the file could not be reached for <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a>.</p>
  </dd>
  <dt>
    <p><strong>FTW_SL</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a symbolic link, and <strong>FTW_PHYS</strong> was set in <em>flags</em>.</p>
  </dd>
  <dt>
    <p><strong>FTW_SLN</strong></p>
  </dt>
  <dd>
    <p><em>fpath</em> is a symbolic link pointing to a nonexistent file. (This occurs only if <strong>FTW_PHYS</strong> is not set.)</p>
  </dd>

</dl>
<p>The fourth argument that <strong>nftw</strong>() supplies when calling <em>fn</em>() is a structure of type <em>FTW</em>:</p>
<pre>

struct FTW {
    int base;
    int level;
};

</pre>
<p><em>base</em> is the offset of the filename (i.e., basename component) in the pathname given in <em>fpath</em>. <em>level</em> is the depth of <em>fpath</em> in the directory tree, relative to the root of the tree (<em>dirpath</em>, which has depth 0).</p><p>To stop the tree walk, <em>fn</em>() returns a nonzero value; this value will become the return value of <strong>nftw</strong>(). As long as <em>fn</em>() returns 0, <strong>nftw</strong>() will continue either until it has traversed the entire tree, in which case it will return zero, or until it encounters an error (such as a <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a> failure), in which case it will return -1.</p><p>Because <strong>nftw</strong>() uses dynamic data structures, the only safe way to exit out of a tree walk is to return a nonzero value from <em>fn</em>(). To allow a signal to terminate the walk without causing a memory leak, have the handler set a global flag that is checked by <em>fn</em>(). <em>Don't</em> use <a href="../man3/longjmp.3.html"><strong>longjmp</strong>(3)</a> unless the program is going to terminate.</p><p>The <em>flags</em> argument of <strong>nftw</strong>() is formed by ORing zero or more of the following flags:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>FTW_ACTIONRETVAL</strong> (since glibc 2.3.3)</p>
  </dt>
  <dd>
    <p>If this glibc-specific flag is set, then <strong>nftw</strong>() handles the return value from <em>fn</em>() differently. <em>fn</em>() should return one of the following values:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>FTW_CONTINUE</strong></p>
  </dt>
  <dd>
    <p>Instructs <strong>nftw</strong>() to continue normally.</p>
  </dd>
  <dt>
    <p><strong>FTW_SKIP_SIBLINGS</strong></p>
  </dt>
  <dd>
    <p>If <em>fn</em>() returns this value, then siblings of the current entry will be skipped, and processing continues in the parent.</p>
  </dd>
  <dt>
    <p><strong>FTW_SKIP_SUBTREE</strong></p>
  </dt>
  <dd>
    <p>If <em>fn</em>() is called with an entry that is a directory (<em>typeflag</em> is <strong>FTW_D</strong>), this return value will prevent objects within that directory from being passed as arguments to <em>fn</em>(). <strong>nftw</strong>() continues processing with the next sibling of the directory.</p>
  </dd>
  <dt>
    <p><strong>FTW_STOP</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>nftw</strong>() to return immediately with the return value <strong>FTW_STOP</strong>.</p>
  </dd>

</dl>
<p>Other return values could be associated with new actions in the future; <em>fn</em>() should not return values other than those listed above.</p><p>The feature test macro <strong>_GNU_SOURCE</strong> must be defined (before including <em>any</em> header files) in order to obtain the definition of <strong>FTW_ACTIONRETVAL</strong> from <em>&lt;ftw.h&gt;</em>.</p>
  </dd>
  <dt>
    <p><strong>FTW_CHDIR</strong></p>
  </dt>
  <dd>
    <p>If set, do a <a href="../man2/chdir.2.html"><strong>chdir</strong>(2)</a> to each directory before handling its contents. This is useful if the program needs to perform some action in the directory in which <em>fpath</em> resides. (Specifying this flag has no effect on the pathname that is passed in the <em>fpath</em> argument of <em>fn</em>.)</p>
  </dd>
  <dt>
    <p><strong>FTW_DEPTH</strong></p>
  </dt>
  <dd>
    <p>If set, do a post-order traversal, that is, call <em>fn</em>() for the directory itself <em>after</em> handling the contents of the directory and its subdirectories. (By default, each directory is handled <em>before</em> its contents.)</p>
  </dd>
  <dt>
    <p><strong>FTW_MOUNT</strong></p>
  </dt>
  <dd>
    <p>If set, stay within the same filesystem (i.e., do not cross mount points).</p>
  </dd>
  <dt>
    <p><strong>FTW_PHYS</strong></p>
  </dt>
  <dd>
    <p>If set, do not follow symbolic links. (This is what you want.) If not set, symbolic links are followed, but no file is reported twice.</p><p>If <strong>FTW_PHYS</strong> is not set, but <strong>FTW_DEPTH</strong> is set, then the function <em>fn</em>() is never called for a directory that would be a descendant of itself.</p>
  </dd>

</dl>
<h3>ftw()</h3>
<p><strong>ftw</strong>() is an older function that offers a subset of the functionality of <strong>nftw</strong>(). The notable differences are as follows:</p><ul>
<li><p><strong>ftw</strong>() has no <em>flags</em> argument. It behaves the same as when <strong>nftw</strong>() is called with <em>flags</em> specified as zero.</p></li><li><p>The callback function, <em>fn</em>(), is not supplied with a fourth argument.</p></li><li><p>The range of values that is passed via the <em>typeflag</em> argument supplied to <em>fn</em>() is smaller: just <strong>FTW_F</strong>, <strong>FTW_D</strong>, <strong>FTW_DNR</strong>, <strong>FTW_NS</strong>, and (possibly) <strong>FTW_SL</strong>.</p></li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>These functions return 0 on success, and -1 if an error occurs.</p><p>If <em>fn</em>() returns nonzero, then the tree walk is terminated and the value returned by <em>fn</em>() is returned as the result of <strong>ftw</strong>() or <strong>nftw</strong>().</p><p>If <strong>nftw</strong>() is called with the <strong>FTW_ACTIONRETVAL</strong> flag, then the only nonzero value that should be used by <em>fn</em>() to terminate the tree walk is <strong>FTW_STOP</strong>, and that value is returned as the result of <strong>nftw</strong>().</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">
<p><strong>nftw</strong>() is available under glibc since version 2.1.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ATTRIBUTES</h2>
        <div class="sectioncontent">
<p>For an explanation of the terms used in this section, see <a href="../man7/attributes.7.html"><strong>attributes</strong>(7)</a>.</p><table class="table table-striped">
<tr>
<th>Interface</th>
<th>Attribute</th>
<th>Value</th></tr>

<tr>
<td><strong>nftw</strong>()  </td>
<td>Thread safety</td>
<td>MT-Safe cwd</td></tr>

<tr>
<td><strong>ftw</strong>()  </td>
<td>Thread safety</td>
<td>MT-Safe</td></tr>
</table>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>POSIX.1-2001, POSIX.1-2008, SVr4, SUSv1. POSIX.1-2008 marks <strong>ftw</strong>() as obsolete.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>POSIX.1-2008 notes that the results are unspecified if <em>fn</em> does not preserve the current working directory.</p><p>The function <strong>nftw</strong>() and the use of <strong>FTW_SL</strong> with <strong>ftw</strong>() were introduced in SUSv1.</p><p>In some implementations (e.g., glibc), <strong>ftw</strong>() will never use <strong>FTW_SL</strong>, on other systems <strong>FTW_SL</strong> occurs only for symbolic links that do not point to an existing file, and again on other systems <strong>ftw</strong>() will use <strong>FTW_SL</strong> for each symbolic link. If <em>fpath</em> is a symbolic link and <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> failed, POSIX.1-2008 states that it is undefined whether <strong>FTW_NS</strong> or <strong>FTW_SL</strong> is passed in <em>typeflag</em>. For predictable results, use <strong>nftw</strong>().</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>The following program traverses the directory tree under the path named in its first command-line argument, or under the current directory if no argument is supplied. It displays various information about each file. The second command-line argument can be used to specify characters that control the value assigned to the <em>flags</em> argument when calling <strong>nftw</strong>().</p><h3>Program source</h3>

<pre>
#define _XOPEN_SOURCE 500
#include &lt;ftw.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdint.h&gt;

static int
display_info(const char *fpath, const struct stat *sb,
             int tflag, struct FTW *ftwbuf)
{
    printf("%-3s %2d %7jd   %-40s %d %s&#92;n",
        (tflag == FTW_D) ?   "d"   : (tflag == FTW_DNR) ? "dnr" :
        (tflag == FTW_DP) ?  "dp"  : (tflag == FTW_F) ?   "f" :
        (tflag == FTW_NS) ?  "ns"  : (tflag == FTW_SL) ?  "sl" :
        (tflag == FTW_SLN) ? "sln" : "???",
        ftwbuf-&gt;level, (intmax_t) sb-&gt;st_size,
        fpath, ftwbuf-&gt;base, fpath + ftwbuf-&gt;base);
    return 0;           /* To tell nftw() to continue */
}

int
main(int argc, char *argv[])
{
    int flags = 0;

    if (argc &gt; 2 && strchr(argv[2], &apos;d&apos;) != NULL)
        flags |= FTW_DEPTH;
    if (argc &gt; 2 && strchr(argv[2], &apos;p&apos;) != NULL)
        flags |= FTW_PHYS;

    if (nftw((argc &lt; 2) ? "." : argv[1], display_info, 20, flags)
            == -1) {
        perror("nftw");
        exit(EXIT_FAILURE);
    }
    exit(EXIT_SUCCESS);
}
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ftw&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man2/stat.2.html"><strong>stat</strong>(2)</a>, <a href="../man3/fts.3.html"><strong>fts</strong>(3)</a>, <a href="../man3/readdir.3.html"><strong>readdir</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="fts_set.3.html"><span aria-hidden="true">&larr;</span> fts_set.3: Traverse a file hierarchy</a></li>
   <li class="next"><a href="funlockfile.3.html">funlockfile.3: Lock file for stdio <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
