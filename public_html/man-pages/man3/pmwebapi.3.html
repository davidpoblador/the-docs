<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmwebapi: Introduction to the performance metrics web application programming interface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Introduction to the performance metrics web application programming interface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmwebapi (3) manual">
  <meta name="twitter:description" content="Introduction to the performance metrics web application programming interface">
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pmwebapi (3) manual" />
  <meta property="og:description" content="Introduction to the performance metrics web application programming interface" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmwebapi<small> (3)</small></h1>
        <p class="lead">Introduction to the performance metrics web application programming interface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmwebapi.3.html">
      <span itemprop="name">pmwebapi: Introduction to the performance metrics web application programming interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmwebapi.3.html">
      <span itemprop="name">pmwebapi: Introduction to the performance metrics web application programming interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">OVERVIEW</h2>
        <div class="sectioncontent">
<p>The PMWEBAPI interface is a binding of a subset of the PMAPI to the web.  It uses HTTP as transport, REST as organizational style for request/parameter encoding (the GET and POST methods are interchangeable), and JSON as response encoding.  A context identifier is used as a persistent way to refer to PMAPI contexts across related web requests.  These context identifiers expire after a configurable period of disuse.</p><p>Errors generally result in HTTP-level error responses. An <em>Access-Control-Allow-Origin: *</em> header is added to all JSON responses.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTEXT CREATION: pmNewContext</h2>
        <div class="sectioncontent">
<p>To create a new web context identifier, a web client invokes:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/context?hostname=STRING</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>/pmapi/context?hostspec=STRING</strong></p>
  </dt>
  <dd>
    <p>Creates a PM_CONTEXT_HOST PMAPI context with the given host name and/or extended specification.  If the host specification contains a userid/password combination, then the corresponding PMAPI context operations will require HTTP Basic authentication credentials with matching userid/password.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/context?archivefile=ARCHIVE</strong></p>
  </dt>
  <dd>
    <p>Creates a PM_CONTEXT_ARCHIVE PMAPI context with the given file name.  Only metrics from the given archive are available.</p>
  </dd>

</dl>
<p>In addition, the web client may add the parameter <strong>&polltimeout=MMMM</strong> for a maximum interval (in seconds) between expected accesses to the given context.  This value is limited by pmwebd configuration, and is a courtesy to allow pmwebd to free up memory earlier in case of sudden web application shutdown.</p><p>If successful, the response from these requests is a JSON document of the form:</p>
<pre>
{ "context" : NNNNN }
</pre>
<p>The number (a 32-bit unsigned decimal) is then used in all later operations.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PMAPI OPERATIONS</h2>
        <div class="sectioncontent">
<p>The general form of the requests is as follows: <strong>/pmapi/NNNNN/OPERATION</strong> where</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi</strong></p>
  </dt>
  <dd>
    <p>is the fixed prefix for all PMWEBAPI operations,</p>
  </dd>
  <dt>
    <p><strong>NNNNN</strong></p>
  </dt>
  <dd>
    <p>is a PMWEBAPI context number returned from a context-creation call, or assigned permanently at pmwebd startup, and</p>
  </dd>
  <dt>
    <p><strong>OPERATION?PARAM1=VALUE2&PARAM2=VALUE2</strong></p>
  </dt>
  <dd>
    <p>identifies the operation and its URL-encoded parameters.  Some parameters may be optional.</p>
  </dd>

</dl>
<h3>METRIC METADATA: pmLookupName, pmLookupDesc, pmTraversePMNS_r</h3>
<p>The general form of the requests is as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNNN/_metric</strong></p>
  </dt>
  <dd>
    <p>Traverse the entire Performance Metrics Name Space (PMNS).</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNNN/_metric?prefix=NAME</strong></p>
  </dt>
  <dd>
    <p>Traverse the subtree of PMNS with the prefix NAME.</p>
  </dd>

</dl>
<p>The response is a JSON document that provides the metric metadata as an array.  For example:</p><p>{ "metrics": [</p>
<pre>
    { "name":"foo.bar", "pmID":PPPP, "indom":DDDD,
      "type":"32", "sem":"instant", "units":"MHz",
      "text-oneline":"foo bar", "text-help":"blah blah blah" },
    { "name":"foo.bar2", ... }
    ...
  ] }
</pre>
<p>Most of the fields are self-explanatory.</p>
<dl class='dl-vertical'>
  <dt>
    <p>name</p>
  </dt>
  <dd>
    <p>A name for the metric as defined in the PMNS. If the PMNS contains multiple names associated with the metric's Performance Metric Identifier (PMID), one of these will be returned via name, but there is no way to determine which of the duplicate names this will be.</p>
  </dd>
  <dt>
    <p>PPPP</p>
  </dt>
  <dd>
    <p>the PMID</p>
  </dd>
  <dt>
    <p>DDDD</p>
  </dt>
  <dd>
    <p>the instance domain</p>
  </dd>
  <dt>
    <p>type</p>
  </dt>
  <dd>
    <p>from pmTypeStr</p>
  </dd>
  <dt>
    <p>units</p>
  </dt>
  <dd>
    <p>from pmUnitsStr</p>
  </dd>
  <dt>
    <p>sem</p>
  </dt>
  <dd>
    <p>an abbreviation of the metric semantic:</p><table class="table table-striped">
<tr>
<th>PM_SEM_COUNTER  "counter"</th>
<th></th></tr>

<tr>
<td>PM_SEM_INSTANT  "instant"</td>
<td></td></tr>

<tr>
<td>PM_SEM_DISCRETE "discrete"</td>
<td></td></tr>
</table>
  </dd>

</dl>

<h3>METRIC VALUE: pmFetch</h3>
<p>The general form of the requests is as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNNN/_fetch?names=NAME1,NAME2</strong></p>
  </dt>
  <dd>
    <p>Fetch current values for given named metrics.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNNN/_fetch?pmids=PPPP1,PPPP2</strong></p>
  </dt>
  <dd>
    <p>Fetch current values for given PMIDs.</p>
  </dd>

</dl>
<p>If any of the names/pmids are valid, the response is a JSON document that provides the values for all requested metrics, for all their instances.</p><p>{ "timestamp": { "s":SEC, "us":USEC },</p>
<pre>
  "values": [
        { "pmid":PPPP1, "name":"NAME1",
          "instances:" [
               { "instance":IIII1, "value":VALUE1 }
               { "instance":IIII2, "value":VALUE2 }
               ...
          ] },
        { "pmid":PPPP2, "name":"NAME2", ... }
        ...
  ] }
</pre>
<p>Most of the fields are self-explanatory.  Numeric metric types are represented as JSON integer or floating-point values.  Strings are passed verbatim, except that non-ASCII values are replaced with a Unicode 0xFFFD REPLACEMENT CHARACTER code.  Event type metrics are not currently supported.</p>
<h3>INSTANCE DOMAINS METADATA: pmGetInDom, pmNameInDom, pmLookupInDom</h3>
<p>The general form of the requests is as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNN/_indom?indom=DDDD</strong></p>
  </dt>
  <dd>
    <p>List instances of the given instance domain.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNN/_indom?name=NAME</strong></p>
  </dt>
  <dd>
    <p>List instances of the instance domain belonging to the named metric.</p>
  </dd>

</dl>
<p>In addition, either query may be suffixed with:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>&instance=IIII,JJJJ</strong></p>
  </dt>
  <dd>
    <p>Restrict listings to given instance code numbers.</p>
  </dd>
  <dt>
    <p><strong>&iname=INAME1,INAME2</strong></p>
  </dt>
  <dd>
    <p>Restrict listings to given instance names.</p>
  </dd>

</dl>
<p>The response is a JSON document that provides the metric metadata as an array.  For example:</p><p>{ "indom":DDDD,</p>
<pre>
   "instances": [
      { "instance":IIII, "name":"INAME" }
      ...
   ] }
</pre>

<h3>INSTANCE PROFILE: pmAddProfile, pmDelProfile</h3>
<p>The general form of these requests is as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNN/_profile_reset?indom=DDDD</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNN/_profile_add?indom=DDDD&instance=IIII,JJJJ</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNN/_profile_add?indom=DDDD&iname=IIII,JJJJ</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNN/_profile_del?indom=DDDD&instance=JJJJ</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNN/_profile_del?indom=DDDD&iname=INAME1,INAME2</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>

</dl>

<h3>METRIC STORE: pmStore</h3>
<p>The general form of these requests is as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNN/_store?name=NAME&value=VALUE</strong></p>
  </dt>
  <dd>
    <p>Store a new value for given named metrics.</p>
  </dd>
  <dt>
    <p><strong>/pmapi/NNNNN/_store?pmid=PPPP&value=VALUE</strong></p>
  </dt>
  <dd>
    <p>Store a new value for given performance metric identifier (PMID).</p>
  </dd>

</dl>
<p>In addition, either query may be suffixed with:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>&instance=IIII,JJJJ</strong></p>
  </dt>
  <dd>
    <p>Restrict store to given instance code numbers.</p>
  </dd>
  <dt>
    <p><strong>&iname=INAME1,INAME2</strong></p>
  </dt>
  <dd>
    <p>Restrict store to given instance names.</p>
  </dd>

</dl>
<p>If successful, the response from these requests is a JSON document of the form:</p><p>{ "success" : true }</p>
<h3>DERIVED METRICS: pmRegisterDerived</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNNN/_derive?name=NAME&expr=EXPRESSION</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>

</dl>

<h3>CONTEXT COPY: pmDupContext</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNNN/copy</strong></p>
  </dt>
  <dd>
    <p>These are not currently supported.</p>
  </dd>

</dl>

<h3>CONTEXT CLOSE: pmDestroyContext</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>/pmapi/NNNNN/destroy</strong></p>
  </dt>
  <dd>
    <p>This is not likely to be supported, as it is destructive and would offer a tempting target to brute-force attackers.  Instead, the pmwebd timeout is used to automatically free unused contexts.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GRAPHITE</h2>
        <div class="sectioncontent">
<p>When enabled, pmwebd can emulate a subset of the graphite web-api to allow web applications like graphite and grafana to extract data from all archives under the configured -A directory.  The graphite namespace is constructed from the PCP archives using a simple mapping that encodes the Cartesian product of archives, metrics, and instance-domain instances into dot-separated strings.  Some metacharacter-quoting is employed to encode general strings into components.  Only numeric PCP metrics are exposed; COUNTER semantic values are rate-converted.</p><table class="table table-striped">
<tr>
<th>position</th>
<th>number</th>
<th>purpose</th>
<th></th>
<th></th></tr>

<tr>
<td>1</td>
<td>1</td>
<td>the pathname of the archive .meta file</td>
<td></td>
<td></td></tr>

<tr>
<td>2</td>
<td>N</td>
<td>the N components of the pcp metric name</td>
<td></td>
<td></td></tr>

<tr>
<td>N+2</td>
<td>1</td>
<td>instance name of the metric (if any)</td>
<td></td>
<td></td></tr>
</table><p>Since glob wildcarding is supported within metric name components, using them in the first component (an encoding of the archive name) is a good way to identify machines, or to match multiple archives spanning times of interest.</p><p>We list here only the broadest outline of the supported calls.  pmwebd does not support every graphite web-api option, so many querystring parameters may be ignored.  Arithmetic/statistical functions on metrics are not supported.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/graphite/render&format=json&target=FOO&from=TIME&until=TIME</strong></p>
  </dt>
  <dd>
    <p>Return a series of values of the given metrics, between the two times, sampled every 60 seconds.</p>
  </dd>
  <dt>
    <p><strong>/graphite/rawdata&target=FOO.BAR&from=TIME&until=TIME</strong></p>
  </dt>
  <dd>
    <p>Same, with a slightly different result encoding.</p>
  </dd>
  <dt>
    <p><strong>/graphite/render&format=png&target=FOO&from=TIME&until=TIME&....</strong></p>
  </dt>
  <dd>
    <p>Same, but render the curves into a PNG image file.  Several color- and rendering-control-related parameters are supported.</p>
  </dd>
  <dt>
    <p><strong>/graphite/metrics/find&query=FOO.BAR.*</strong></p>
  </dt>
  <dd>
    <p>Provide incremental metric-tree traversal uwing wildcards.</p>
  </dd>
  <dt>
    <p><strong>/graphite/graphlot/findmetric&query=FOO+BAR</strong></p>
  </dt>
  <dd>
    <p>Search through metrics with space-separated regular expressions.</p>
  </dd>
  <dt>
    <p><strong>/graphite/browser/search&q=FOO+BAR</strong></p>
  </dt>
  <dd>
    <p>Same, with a slightly different result encoding.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmwebapi&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/pcpintro.1.html"><strong>PCPIntro</strong>(1)</a>, <a href="../man3/pcpintro.3.html"><strong>PCPIntro</strong>(3)</a>, <a href="../man1/pmwebd.1.html"><strong>pmwebd</strong>(1)</a>, <strong>http://graphite.readthedocs.org/</strong> and <a href="../man3/pmapi.3.html"><strong>PMAPI</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmusezone.3.html"><span aria-hidden="true">&larr;</span> pmusezone.3: Re-establish a reporting timezone</a></li>
   <li class="next"><a href="pmwhichcontext.3.html">pmwhichcontext.3: Identify the current pmapi context <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
