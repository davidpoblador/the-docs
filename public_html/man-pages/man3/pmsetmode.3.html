<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmsetmode: Set collection time parameters for the current pmapi context</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Set collection time parameters for the current pmapi context">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmsetmode (3) manual">
  <meta name="twitter:description" content="Set collection time parameters for the current pmapi context">
  <meta name="twitter:image" content="https://www.carta.tech/images/pcp-pmsetmode-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/pmsetmode.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pmsetmode (3) manual" />
  <meta property="og:description" content="Set collection time parameters for the current pmapi context" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pcp-pmsetmode-3.png" />

</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmsetmode<small> (3)</small></h1>
        <p class="lead">Set collection time parameters for the current pmapi context</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmsetmode.3.html">
      <span itemprop="name">pmsetmode: Set collection time parameters for the current pmapi context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmsetmode.3.html">
      <span itemprop="name">pmsetmode: Set collection time parameters for the current pmapi context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;pcp/pmapi.h&gt;</p><p>int pmSetMode(int <em>mode</em>, const struct timeval *<em>when</em>, int <em>delta</em>);</p><p>cc ... -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>pmSetMode</strong> is used to define the collection time and/or mode for accessing performance metrics and meta-data in the current Performance Metrics Application Programming Interface (PMAPI) context. This mode affects the semantics of subsequent calls to the following PMAPI routines: <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>, <a href="../man3/pmfetcharchive.3.html"><strong>pmFetchArchive</strong>(3)</a>, <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, <a href="../man3/pmgetindom.3.html"><strong>pmGetInDom</strong>(3)</a>, <a href="../man3/pmlookupindom.3.html"><strong>pmLookupInDom</strong>(3)</a> and <a href="../man3/pmnameindom.3.html"><strong>pmNameInDom</strong>(3)</a>.</p><p>If <em>mode</em> is <strong>PM_MODE_LIVE</strong> then all information is returned from the active pool of performance metrics as of the time that the PMAPI call is made, and the other two parameters to <strong>pmSetMode</strong> are ignored. <strong>PM_MODE_LIVE</strong> is the default mode when a new PMAPI context of type <strong>PM_CONTEXT_HOST</strong> is created.</p><p>If the <em>mode</em> is not <strong>PM_MODE_LIVE</strong>, then the <em>when</em> parameter defines a time origin, and all requests for meta-data (metric descriptions and instance identifiers from the instance domains) will be processed to reflect the state of the meta-data as of the time origin, i.e. we use the last state of this information at, or before, the time origin.</p><p>If the <em>mode</em> is <strong>PM_MODE_INTERP</strong> then, in the case of <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>, the underlying code will use an interpolation scheme to compute the values of the metrics from the values recorded for times in the proximity of the time origin. A <em>mode</em> of <strong>PM_MODE_INTERP</strong> may only be used with an archive context.</p><p>If the <em>mode</em> is <strong>PM_MODE_FORW</strong> then, in the case of <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>, the collection of recorded metric values will be scanned in a forwards direction in time, until values for at least one of the requested metrics is located after the time origin, and then all requested metrics stored in the set of archives at that time will be returned with the corresponding timestamp. A <em>mode</em> of <strong>PM_MODE_FORW</strong> may only be used with an archive context.</p><p>If the <em>mode</em> is <strong>PM_MODE_BACK</strong> then, the situation is the same as for <strong>PM_MODE_FORW</strong>, except a <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a> will be serviced by scanning the collection of recorded metrics in a backwards direction in time for metrics before the time origin. A <em>mode</em> of <strong>PM_MODE_BACK</strong> may only be used with an archive context.</p><p>If the <em>mode</em> is <strong>PM_MODE_FORW</strong> or <strong>PM_MODE_BACK</strong>, and no qualifying metrics can be found in the requested direction of searching before the end or start of the set of archive logs is found, then <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a> returns the special error indicator, <strong>PM_ERR_EOL</strong>.</p><p>For <em>mode</em>s other than <strong>PM_MODE_LIVE</strong>, after each successful <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>, the time origin is reset to the timestamp returned via the structure from <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>.</p><p>The <strong>pmSetMode</strong> parameter <em>delta</em> defines an additional number of time units that should be used to adjust the time origin (forwards or backwards), after the new time origin from the has been determined. This automatic adjustment of the time origin only occurs when the <em>mode</em> is <strong>PM_MODE_INTERP</strong>, and the adjustment is applied, even if the <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a> fails because the time origin is outside the range defined by the records in a set of archive logs, i.e. returns <strong>PM_ERR_EOL</strong>.</p><p>By default <em>delta</em> is interpreted as milliseconds (but see the LARGE DELTA VALUES section below).</p><p>Using these <em>mode</em> options, an application can implement replay, playback, fast forward, reverse, etc. for performance metric values held in the set of archive logs by alternating calls to <strong>pmSetMode</strong> and <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>.</p><p>As a special case, if <em>when</em> is <strong>NULL</strong> then the <em>mode</em> and <em>delta</em> arguments are used as described above, but the current time in the archive is not altered.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The following code fragment may be used to dump just those values recorded in an archive in correct temporal sequence, for a selected set of performance metrics; this uses the default collection time mechanisms.</p>
<pre>
pmNewContext(PM_CONTEXT_ARCHIVE, "myarchive");
while (pmFetch(npmid, pmidlist, &result) != PM_ERR_EOL) {
    /*
     * process real metric values as of result-&gt;timestamp
     */
    . . .
    pmFreeResult(result);
}
</pre>
<p>Alternatively, to replay interpolated metrics from the log in reverse chronological order, at 10 second intervals (of recorded time), the following code fragment could be used.</p>
<pre>
struct timeval mytime;

mytime.tv_sec = 0x7fffffff; /* or use pmGetArchiveEnd(&mtime) */
pmSetMode(PM_MODE_BACK, &mytime, 0);
pmFetchArchive(&result);
mytime = result-&gt;timestamp;
pmFreeResult(result);
pmSetMode(PM_MODE_INTERP | PM_XTB_SET(PM_TIME_SEC), &mytime, -10);

while (pmFetch(numpmid, pmidlist, &result) != PM_ERR_EOL) {
    /*
     * process interpolated metric values as of
     * result-&gt;timestamp
     */
    . . .
    pmFreeResult(result);
}
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LARGE DELTA VALUES</h2>
        <div class="sectioncontent">
<p>Because <em>delta</em> is an <em>int</em> and treated as milliseconds by default there is a limit on the maximum absolute value of <em>delta</em> that can be specified with this default interpretation, namely about 24 days if a signed <em>int</em> has 31 bits of precision. To accommodate longer values of <em>delta</em> the high-order bits of the <em>mode</em> parameter is also used to optionally set the units of time for the <em>delta</em> parameter. To specify the units of time use the <strong>PM_XTB_SET</strong> macro with one of the values <strong>PM_TIME_NSEC</strong>, <strong>PM_TIME_MSEC</strong>, <strong>PM_TIME_SEC</strong>, etc. to set the <em>mode</em> as follows:</p><p>PM_MODE_INTERP | PM_XTB_SET(PM_TIME_XXXX)</p><p>The following code shows how this could be done if the desired <em>delta</em> is initially encoded in <em>interval</em> (a struct timeval).</p>
<pre>
struct timeval interval;
int mode;

mode = ...

if (abs(interval.tv_sec / (3600*24)) &lt;= 24) {
    /* default encoding of milliseconds is fine */
    mode = PM_MODE_INTERP;
    delta = interval.tv_sec * 1000 + (interval.tv_usec + 500)/ 1000;
}
else {
    /* encode delta in units of seconds */
    mode = PM_MODE_INTERP | PM_XTB_SET(PM_TIME_SEC);
    delta = interval.tv_sec + (interval.tv_usec + 500000)/ 1000000;
}
</pre>
<p>For millisecond encoding of <em>delta</em>, using <strong>PM_XTB_SET(PM_TIME_MSEC)</strong> is functionally equivalent to not using <strong>PM_XTB_SET</strong> at all.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmsetmode&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/pmapi.3.html"><strong>PMAPI</strong>(3)</a>, <a href="../man3/pmfetch.3.html"><strong>pmFetch</strong>(3)</a>, <a href="../man3/pmfetcharchive.3.html"><strong>pmFetchArchive</strong>(3)</a>, <a href="../man3/pmgetindom.3.html"><strong>pmGetInDom</strong>(3)</a>, <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, <a href="../man3/pmlookupindom.3.html"><strong>pmLookupInDom</strong>(3)</a> and <a href="../man3/pmnameindom.3.html"><strong>pmNameInDom</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>PM_ERR_MODE</strong>
  </dt>
  <dd>
    <p>The <em>mode</em> parameter is invalid</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmsemstr.3.html"><span aria-hidden="true">&larr;</span> pmsemstr.3: Convert a performance metric semantic into a string</a></li>
   <li class="next"><a href="pmsortinstances.3.html">pmsortinstances.3: Sort performance metric values on instance identifier <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
