<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pthread_cancel - send a cancellation request to a thread</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="${metadescription}">
  
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pthread_cancel<small> (3)</small></h1>
        <p class="lead">send a cancellation request to a thread</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Linux Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man3/"><span itemprop="title">Library calls</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man3/pthread_cancel.3.html"><span itemprop="title">pthread_cancel</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>#include &lt;pthread.h&gt;</strong>

<strong>int pthread_cancel(pthread_t </strong><em>thread</em><strong>);</strong>

Compile and link with <em>-pthread</em>.</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>The <strong>pthread_cancel</strong>() function sends a cancellation request to the thread <em>thread</em>. Whether and when the target thread reacts to the cancellation request depends on two attributes that are under the control of that thread: its cancelability <em>state</em> and <em>type</em>.</p>
<p class='spacer'>

<p>A thread's cancelability state, determined by <a href="../man3/pthread_setcancelstate.3.html"><strong>pthread_setcancelstate</strong>(3)</a>, can be <em>enabled</em> (the default for new threads) or <em>disabled</em>. If a thread has disabled cancellation, then a cancellation request remains queued until the thread enables cancellation. If a thread has enabled cancellation, then its cancelability type determines when cancellation occurs.</p>
<p class='spacer'>

<p>A thread's cancellation type, determined by <a href="../man3/pthread_setcanceltype.3.html"><strong>pthread_setcanceltype</strong>(3)</a>, may be either <em>asynchronous</em> or <em>deferred</em> (the default for new threads). Asynchronous cancelability means that the thread can be canceled at any time (usually immediately, but the system does not guarantee this). Deferred cancelability means that cancellation will be delayed until the thread next calls a function that is a <em>cancellation point</em>. A list of functions that are or may be cancellation points is provided in <a href="../man7/pthreads.7.html"><strong>pthreads</strong>(7)</a>.</p>
<p class='spacer'>

  <p>When a cancellation requested is acted on, the following steps occur for <em>thread</em> (in this order):</p>
  <dl class='dl-horizontal'>
    <dt>1.</dt>
    <dd>
  <p>Cancellation clean-up handlers are popped (in the reverse of the order in which they were pushed) and called. (See <a href="../man3/pthread_cleanup_push.3.html"><strong>pthread_cleanup_push</strong>(3)</a>.)</p>
    </dd>
    <dt>2.</dt>
    <dd>
  <p>Thread-specific data destructors are called, in an unspecified order. (See <strong>pthread_key_create</strong>(3).)</p>
    </dd>
    <dt>3.</dt>
    <dd>
  <p>The thread is terminated. (See <a href="../man3/pthread_exit.3.html"><strong>pthread_exit</strong>(3)</a>.)</p>
    </dd>
  </dl>
<p class='spacer'>

<p>The above steps happen asynchronously with respect to the <strong>pthread_cancel</strong>() call; the return status of <strong>pthread_cancel</strong>() merely informs the caller whether the cancellation request was successfully queued.</p>
<p class='spacer'>

<p>After a canceled thread has terminated, a join with that thread using <a href="../man3/pthread_join.3.html"><strong>pthread_join</strong>(3)</a> obtains <strong>PTHREAD_CANCELED</strong> as the thread's exit status. (Joining with a thread is the only way to know that cancellation has completed.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>On success, <strong>pthread_cancel</strong>() returns 0; on error, it returns a nonzero error number.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>ESRCH</strong></dt>
    <dd>
  <p>No thread with the ID <em>thread</em> could be found.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ATTRIBUTES</h2>
        <div class="sectioncontent">

<p>For an explanation of the terms used in this section, see <a href="../man7/attributes.7.html"><strong>attributes</strong>(7)</a>.</p>
<table class="table table-striped">
<tr>
<th>Interface</th>
<th>Attribute</th>
<th>Value</th></tr>

<tr>
<td><strong>pthread_cancel</strong>()  </td>
<td>Thread safety</td>
<td>MT-Safe</td></tr>
</table>

<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">

<p>POSIX.1-2001, POSIX.1-2008.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<p>On Linux, cancellation is implemented using signals. Under the NPTL threading implementation, the first real-time signal (i.e., signal 32) is used for this purpose. On LinuxThreads, the second real-time signal is used, if real-time signals are available, otherwise <strong>SIGUSR2</strong> is used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<p>The program below creates a thread and then cancels it. The main thread joins with the canceled thread to check that its exit status was <strong>PTHREAD_CANCELED</strong>. The following shell session shows what happens when we run the program:</p>
<p class='spacer'>

<pre>$ ./a.out
thread_func(): started; cancellation disabled
main(): sending cancellation request
thread_func(): about to enable cancellation
main(): thread was canceled</pre>

  <h3>Program source</h3>
  <p></p>
<pre>#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;errno.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define handle_error_en(en, msg) &#92;
        do { errno = en; perror(msg); exit(EXIT_FAILURE); } while (0)

static void *
thread_func(void *ignored_argument)
{
    int s;

    /* Disable cancellation for a while, so that we don&apos;t
       immediately react to a cancellation request */

    s = pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, NULL);
    if (s != 0)
        handle_error_en(s, "pthread_setcancelstate");

    printf("thread_func(): started; cancellation disabled&#92;n");
    <strong>sleep</strong>(5);
    printf("thread_func(): about to enable cancellation&#92;n");

    s = pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);
    if (s != 0)
        handle_error_en(s, "pthread_setcancelstate");

    /* sleep() is a cancellation point */

    sleep(1000);        /* Should get canceled while we sleep */

    /* Should never get here */

    printf("thread_func(): not canceled!&#92;n");
    return NULL;
}

int
main(void)
{
    pthread_t thr;
    void *res;
    int s;

    /* Start a thread and then send it a cancellation request */

    s = pthread_create(&thr, NULL, &thread_func, NULL);
    if (s != 0)
        handle_error_en(s, "pthread_create");

    <strong>sleep</strong>(2);           /* Give thread a chance to get started */

    printf("main(): sending cancellation request&#92;n");
    s = pthread_cancel(thr);
    if (s != 0)
        handle_error_en(s, "pthread_cancel");

    /* Join with thread to see what its exit status was */

    s = pthread_join(thr, &res);
    if (s != 0)
        handle_error_en(s, "pthread_join");

    if (res == PTHREAD_CANCELED)
        printf("main(): thread was canceled&#92;n");
    else
        printf("main(): thread wasn&apos;t canceled (shouldn&apos;t happen!)&#92;n");
    exit(EXIT_SUCCESS);
}</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man3/pthread_cleanup_push.3.html"><strong>pthread_cleanup_push</strong>(3)</a>, <a href="../man3/pthread_create.3.html"><strong>pthread_create</strong>(3)</a>, <a href="../man3/pthread_exit.3.html"><strong>pthread_exit</strong>(3)</a>, <a href="../man3/pthread_join.3.html"><strong>pthread_join</strong>(3)</a>, <strong>pthread_key_create</strong>(3), <a href="../man3/pthread_setcancelstate.3.html"><strong>pthread_setcancelstate</strong>(3)</a>, <a href="../man3/pthread_setcanceltype.3.html"><strong>pthread_setcanceltype</strong>(3)</a>, <a href="../man3/pthread_testcancel.3.html"><strong>pthread_testcancel</strong>(3)</a>, <a href="../man7/pthreads.7.html"><strong>pthreads</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
  <li class="previous"><a href="pthread_attr_setstacksize.3.html"><span aria-hidden="true">&larr;</span> pthread_attr_setstacksize.3: set/get stack size attribute in thread attributes object</a></li><li class="next"><a href="pthread_cleanup_pop.3.html">pthread_cleanup_pop.3: push and pop thread cancellation clean-up handlers <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
