<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>fanotify_init - create and initialize fanotify group</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Create and initialize fanotify group">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">fanotify_init<small> (2)</small></h1>
        <p class="lead">Create and initialize fanotify group</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="/"><span itemprop="title">Carta.tech</span></a>
	</li>
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man2/"><span itemprop="title">System calls</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man2/fanotify_init.2.html"><span itemprop="title">fanotify_init</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<p><strong>#include &lt;fcntl.h&gt;</strong></p>
<p class='spacer'>

<p><strong>#include &lt;sys/fanotify.h&gt;</strong></p>
<p class='spacer'>

<p><strong>int fanotify_init(unsigned int </strong><em>flags</em><strong>, unsigned int </strong><em>event_f_flags</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>For an overview of the fanotify API, see <a href="../man7/fanotify.7.html"><strong>fanotify</strong>(7)</a>.</p>
<p class='spacer'>

<p><strong>fanotify_init</strong>() initializes a new fanotify group and returns a file descriptor for the event queue associated with the group.</p>
<p class='spacer'>

<p>The file descriptor is used in calls to <a href="../man2/fanotify_mark.2.html"><strong>fanotify_mark</strong>(2)</a> to specify the files, directories, and mounts for which fanotify events shall be created. These events are received by reading from the file descriptor. Some events are only informative, indicating that a file has been accessed. Other events can be used to determine whether another application is permitted to access a file or directory. Permission to access filesystem objects is granted by writing to the file descriptor.</p>
<p class='spacer'>

<p>Multiple programs may be using the fanotify interface at the same time to monitor the same files.</p>
<p class='spacer'>

<p>In the current implementation, the number of fanotify groups per user is limited to 128. This limit cannot be overridden.</p>
<p class='spacer'>

<p>Calling <strong>fanotify_init</strong>() requires the <strong>CAP_SYS_ADMIN</strong> capability. This constraint might be relaxed in future versions of the API. Therefore, certain additional capability checks have been implemented as indicated below.</p>
<p class='spacer'>

<p>The <em>flags</em> argument contains a multi-bit field defining the notification class of the listening application and further single bit fields specifying the behavior of the file descriptor.</p>
<p class='spacer'>

<p>If multiple listeners for permission events exist, the notification class is used to establish the sequence in which the listeners receive the events.</p>
<p class='spacer'>

  <p>Only one of the following notification classes may be specified in <em>flags</em>:</p>
  <dl class='dl-vertical'>
    <dt><strong>FAN_CLASS_PRE_CONTENT</strong></dt>
    <dd>
  <p>This value allows the receipt of events notifying that a file has been accessed and events for permission decisions if a file may be accessed. It is intended for event listeners that need to access files before they contain their final data. This notification class might be used by hierarchical storage managers, for example.</p>
    </dd>
    <dt><strong>FAN_CLASS_CONTENT</strong></dt>
    <dd>
  <p>This value allows the receipt of events notifying that a file has been accessed and events for permission decisions if a file may be accessed. It is intended for event listeners that need to access files when they already contain their final content. This notification class might be used by malware detection programs, for example.</p>
    </dd>
    <dt><strong>FAN_CLASS_NOTIF</strong></dt>
    <dd>
  <p>This is the default value. It does not need to be specified. This value only allows the receipt of events notifying that a file has been accessed. Permission decisions before the file is accessed are not possible.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>Listeners with different notification classes will receive events in the order <strong>FAN_CLASS_PRE_CONTENT</strong>, <strong>FAN_CLASS_CONTENT</strong>, <strong>FAN_CLASS_NOTIF</strong>. The order of notification for listeners in the same notification class is undefined.</p>
<p class='spacer'>

  <p>The following bits can additionally be set in <em>flags</em>:</p>
  <dl class='dl-vertical'>
    <dt><strong>FAN_CLOEXEC</strong></dt>
    <dd>
  <p>Set the close-on-exec flag (<strong>FD_CLOEXEC</strong>) on the new file descriptor. See the description of the <strong>O_CLOEXEC</strong> flag in <a href="../man2/open.2.html"><strong>open</strong>(2)</a>.</p>
    </dd>
    <dt><strong>FAN_NONBLOCK</strong></dt>
    <dd>
  <p>Enable the nonblocking flag (<strong>O_NONBLOCK</strong>) for the file descriptor. Reading from the file descriptor will not block. Instead, if no data is available, <a href="../man2/read.2.html"><strong>read</strong>(2)</a> will fail with the error <strong>EAGAIN</strong>.</p>
    </dd>
    <dt><strong>FAN_UNLIMITED_QUEUE</strong></dt>
    <dd>
  <p>Remove the limit of 16384 events for the event queue. Use of this flag requires the <strong>CAP_SYS_ADMIN</strong> capability.</p>
    </dd>
    <dt><strong>FAN_UNLIMITED_MARKS</strong></dt>
    <dd>
  <p>Remove the limit of 8192 marks. Use of this flag requires the <strong>CAP_SYS_ADMIN</strong> capability.</p>
    </dd>
  </dl>
<p class='spacer'>

  <p>The <em>event_f_flags</em> argument defines the file status flags that will be set on the open file descriptions that are created for fanotify events. For details of these flags, see the description of the <em>flags</em> values in <a href="../man2/open.2.html"><strong>open</strong>(2)</a>. <em>event_f_flags</em> includes a multi-bit field for the access mode. This field can take the following values:</p>
  <dl class='dl-vertical'>
    <dt><strong>O_RDONLY</strong></dt>
    <dd>
  <p>This value allows only read access.</p>
    </dd>
    <dt><strong>O_WRONLY</strong></dt>
    <dd>
  <p>This value allows only write access.</p>
    </dd>
    <dt><strong>O_RDWR</strong></dt>
    <dd>
  <p>This value allows read and write access.</p>
    </dd>
  </dl>
<p class='spacer'>

  <p>Additional bits can be set in <em>event_f_flags</em>. The most useful values are:</p>
  <dl class='dl-vertical'>
    <dt><strong>O_LARGEFILE</strong></dt>
    <dd>
  <p>Enable support for files exceeding 2 GB. Failing to set this flag will result in an <strong>EOVERFLOW</strong> error when trying to open a large file which is monitored by an fanotify group on a 32-bit system.</p>
    </dd>
    <dt><strong>O_CLOEXEC</strong> (since Linux 3.18)</dt>
    <dd>
  <p>Enable the close-on-exec flag for the file descriptor. See the description of the <strong>O_CLOEXEC</strong> flag in <a href="../man2/open.2.html"><strong>open</strong>(2)</a> for reasons why this may be useful.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>The following are also allowable: <strong>O_APPEND</strong>, <strong>O_DSYNC</strong>, <strong>O_NOATIME</strong>, <strong>O_NONBLOCK</strong>, and <strong>O_SYNC</strong>. Specifying any other flag in <em>event_f_flags</em> yields the error <strong>EINVAL</strong> (but see BUGS).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>On success, <strong>fanotify_init</strong>() returns a new file descriptor. On error, -1 is returned, and <em>errno</em> is set to indicate the error.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>EINVAL</strong></dt>
    <dd>
  <p>An invalid value was passed in <em>flags</em> or <em>event_f_flags</em>. <strong>FAN_ALL_INIT_FLAGS</strong> defines all allowable bits for <em>flags</em>.</p>
    </dd>
    <dt><strong>EMFILE</strong></dt>
    <dd>
  <p>The number of fanotify groups for this user exceeds 128.</p>
    </dd>
    <dt>The per-process limit on the number of open file descriptors has been reached.</dt>
    <dd>
    </dd>
    <dt><strong>ENOMEM</strong></dt>
    <dd>
  <p>The allocation of memory for the notification group failed.</p>
    </dd>
    <dt><strong>ENOSYS</strong></dt>
    <dd>
  <p>This kernel does not implement <strong>fanotify_init</strong>(). The fanotify API is available only if the kernel was configured with <strong>CONFIG_FANOTIFY</strong>.</p>
    </dd>
    <dt><strong>EPERM</strong></dt>
    <dd>
  <p>The operation is not permitted because the caller lacks the <strong>CAP_SYS_ADMIN</strong> capability.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">

<p><strong>fanotify_init</strong>() was introduced in version 2.6.36 of the Linux kernel and enabled in version 2.6.37.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">

<p>This system call is Linux-specific.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">

  <p>As of Linux 3.17, the following bug exists:</p>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>The <strong>O_CLOEXEC</strong> is ignored when passed in <em>event_f_flags</em>.</p>
    </dd>
  </dl>
<p class='spacer'>

  <p>The following bug was present in Linux kernels before version 3.14:</p>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>The <em>event_f_flags</em> argument is not checked for invalid flags. Flags that are intended only for internal use, such as <strong>FMODE_EXEC</strong>, can be set, and will consequently be set for the file descriptors returned when reading from the fanotify file descriptor.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man2/fanotify_mark.2.html"><strong>fanotify_mark</strong>(2)</a>, <a href="../man7/fanotify.7.html"><strong>fanotify</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="fallocate.2.html"><span aria-hidden="true">&larr;</span> fallocate.2: manipulate file space</a></li>
   <li class="next"><a href="fanotify_mark.2.html">fanotify_mark.2: add, remove, or modify an fanotify mark on a filesystem object <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
