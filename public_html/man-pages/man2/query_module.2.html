<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>query_module: Query the kernel for various bits pertaining to modules</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Query the kernel for various bits pertaining to modules">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="query_module (2) manual">
  <meta name="twitter:description" content="Query the kernel for various bits pertaining to modules">
  <meta name="twitter:image" content="https://www.carta.tech/images/man-pages-query_module-2.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man2/query_module.2.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="query_module (2) manual" />
  <meta property="og:description" content="Query the kernel for various bits pertaining to modules" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/man-pages-query_module-2.png" />

</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">query_module<small> (2)</small></h1>
        <p class="lead">Query the kernel for various bits pertaining to modules</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/">
      <span itemprop="name">System calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/query_module.2.html">
      <span itemprop="name">query_module: Query the kernel for various bits pertaining to modules</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/man-pages/">
      <span itemprop="name">man-pages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/query_module.2.html">
      <span itemprop="name">query_module: Query the kernel for various bits pertaining to modules</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include &lt;linux/module.h&gt;</strong>

<strong>int query_module(const char *</strong><em>name</em><strong>, int </strong><em>which</em><strong>, void *</strong><em>buf</em><strong>,</strong>
<strong>                 size_t </strong><em>bufsize</em><strong>, size_t *</strong><em>ret</em><strong>);</strong>
</pre>
<p><em>Note</em>: No declaration of this system call is provided in glibc headers; see NOTES.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Note</em>: This system call is present only in kernels before Linux 2.6.</p><p><strong>query_module</strong>() requests information from the kernel about loadable modules. The returned information is placed in the buffer pointed to by <em>buf</em>. The caller must specify the size of <em>buf</em> in <em>bufsize</em>. The precise nature and format of the returned information depend on the operation specified by <em>which</em>. Some operations require <em>name</em> to identify a currently loaded module, some allow <em>name</em> to be NULL, indicating the kernel proper.</p><p>The following values can be specified for <em>which</em>:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>0</strong></p>
  </dt>
  <dd>
    <p>Returns success, if the kernel supports <strong>query_module</strong>(). Used to probe for availability of the system call.</p>
  </dd>
  <dt>
    <p><strong>QM_MODULES</strong></p>
  </dt>
  <dd>
    <p>Returns the names of all loaded modules. The returned buffer consists of a sequence of null-terminated strings; <em>ret</em> is set to the number of modules.</p>
  </dd>
  <dt>
    <p><strong>QM_DEPS</strong></p>
  </dt>
  <dd>
    <p>Returns the names of all modules used by the indicated module. The returned buffer consists of a sequence of null-terminated strings; <em>ret</em> is set to the number of modules.</p>
  </dd>
  <dt>
    <p><strong>QM_REFS</strong></p>
  </dt>
  <dd>
    <p>Returns the names of all modules using the indicated module. This is the inverse of <strong>QM_DEPS</strong>. The returned buffer consists of a sequence of null-terminated strings; <em>ret</em> is set to the number of modules.</p>
  </dd>
  <dt>
    <p><strong>QM_SYMBOLS</strong></p>
  </dt>
  <dd>
    <p>Returns the symbols and values exported by the kernel or the indicated module. The returned buffer is an array of structures of the following form</p>
<pre>
struct module_symbol {
    unsigned long value;
    unsigned long name;
};
</pre>
<ul>
<li><p>followed by null-terminated strings. The value of <em>name</em> is the character offset of the string relative to the start of <em>buf</em>; <em>ret</em> is set to the number of symbols.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>QM_INFO</strong></p>
  </dt>
  <dd>
    <p>Returns miscellaneous information about the indicated module. The output buffer format is:</p>
<pre>
struct module_info {
    unsigned long address;
    unsigned long size;
    unsigned long flags;
};
</pre>
<ul>
<li><p>where <em>address</em> is the kernel address at which the module resides, <em>size</em> is the size of the module in bytes, and <em>flags</em> is a mask of <strong>MOD_RUNNING</strong>, <strong>MOD_AUTOCLEAN</strong>, and so on, that indicates the current status of the module (see the Linux kernel source file <em>include/linux/module.h</em>). <em>ret</em> is set to the size of the <em>module_info</em> structure.</p></li>
</ul>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>On success, zero is returned. On error, -1 is returned and <em>errno</em> is set appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>EFAULT</strong></p>
  </dt>
  <dd>
    <p>At least one of <em>name</em>, <em>buf</em>, or <em>ret</em> was outside the program's accessible address space.</p>
  </dd>
  <dt>
    <p><strong>EINVAL</strong></p>
  </dt>
  <dd>
    <p>Invalid <em>which</em>; or <em>name</em> is NULL (indicating "the kernel"), but this is not permitted with the specified value of <em>which</em>.</p>
  </dd>
  <dt>
    <p><strong>ENOENT</strong></p>
  </dt>
  <dd>
    <p>No module by that <em>name</em> exists.</p>
  </dd>
  <dt>
    <p><strong>ENOSPC</strong></p>
  </dt>
  <dd>
    <p>The buffer size provided was too small. <em>ret</em> is set to the minimum size needed.</p>
  </dd>
  <dt>
    <p><strong>ENOSYS</strong></p>
  </dt>
  <dd>
    <p><strong>query_module</strong>() is not supported in this version of the kernel (e.g., the kernel is version 2.6 or later).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">
<p>This system call is present on Linux only up until kernel 2.4; it was removed in Linux 2.6.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p><strong>query_module</strong>() is Linux-specific.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Some of the information that was formerly available via <strong>query_module</strong>() can be obtained from <em>/proc/modules</em>, <em>/proc/kallsyms</em>, and the files under the directory <em>/sys/module</em>.</p><p>The <strong>query_module</strong>() system call is not supported by glibc. No declaration is provided in glibc headers, but, through a quirk of history, glibc does export an ABI for this system call. Therefore, in order to employ this system call, it is sufficient to manually declare the interface in your code; alternatively, you can invoke the system call using <a href="../man2/syscall.2.html"><strong>syscall</strong>(2)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO query_module&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man2/create_module.2.html"><strong>create_module</strong>(2)</a>, <a href="../man2/delete_module.2.html"><strong>delete_module</strong>(2)</a>, <a href="../man2/get_kernel_syms.2.html"><strong>get_kernel_syms</strong>(2)</a>, <a href="../man2/init_module.2.html"><strong>init_module</strong>(2)</a>, <a href="../man8/lsmod.8.html"><strong>lsmod</strong>(8)</a>, <a href="../man8/modinfo.8.html"><strong>modinfo</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pwritev2.2.html"><span aria-hidden="true">&larr;</span> pwritev2.2: Read or write data into multiple buffers</a></li>
   <li class="next"><a href="quotactl.2.html">quotactl.2: Manipulate disk quotas <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
