<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sync_file_range2 - sync a file segment with disk</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Sync a file segment with disk">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">sync_file_range2<small> (2)</small></h1>
        <p class="lead">Sync a file segment with disk</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="/"><span itemprop="title">Carta.tech</span></a>
	</li>
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man2/"><span itemprop="title">System calls</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man2/sync_file_range2.2.html"><span itemprop="title">sync_file_range2</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>#define _GNU_SOURCE</strong>         /* See <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a> */
<strong>#include &lt;fcntl.h&gt;</strong>

<strong>int sync_file_range(int </strong><em>fd</em><strong>, off64_t </strong><em>offset</em><strong>, off64_t </strong><em>nbytes</em><strong>,</strong>
<strong>                    unsigned int </strong><em>flags</em><strong>);</strong></pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p><strong>sync_file_range</strong>() permits fine control when synchronizing the open file referred to by the file descriptor <em>fd</em> with disk.</p>
<p class='spacer'>

<p><em>offset</em> is the starting byte of the file range to be synchronized. <em>nbytes</em> specifies the length of the range to be synchronized, in bytes; if <em>nbytes</em> is zero, then all bytes from <em>offset</em> through to the end of file are synchronized. Synchronization is in units of the system page size: <em>offset</em> is rounded down to a page boundary; <em>(offset+nbytes-1)</em> is rounded up to a page boundary.</p>
<p class='spacer'>

  <p>The <em>flags</em> bit-mask argument can include any of the following values:</p>
  <dl class='dl-vertical'>
    <dt><strong>SYNC_FILE_RANGE_WAIT_BEFORE</strong></dt>
    <dd>
  <p>Wait upon write-out of all pages in the specified range that have already been submitted to the device driver for write-out before performing any write.</p>
    </dd>
    <dt><strong>SYNC_FILE_RANGE_WRITE</strong></dt>
    <dd>
  <p>Initiate write-out of all dirty pages in the specified range which are not presently submitted write-out. Note that even this may block if you attempt to write more than request queue size.</p>
    </dd>
    <dt><strong>SYNC_FILE_RANGE_WAIT_AFTER</strong></dt>
    <dd>
  <p>Wait upon write-out of all pages in the range after performing any write.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>Specifying <em>flags</em> as 0 is permitted, as a no-op.</p>
  <h3>Warning</h3>
<p>This system call is extremely dangerous and should not be used in portable programs. None of these operations writes out the file's metadata. Therefore, unless the application is strictly performing overwrites of already-instantiated disk blocks, there are no guarantees that the data will be available after a crash. There is no user interface to know if a write is purely an overwrite. On filesystems using copy-on-write semantics (e.g., <em>btrfs</em>) an overwrite of existing allocated blocks is impossible. When writing into preallocated space, many filesystems also require calls into the block allocator, which this system call does not sync out to disk. This system call does not flush disk write caches and thus does not provide any data integrity on systems with volatile disk write caches.</p>
  <h3>Some details</h3>
<p><strong>SYNC_FILE_RANGE_WAIT_BEFORE</strong> and <strong>SYNC_FILE_RANGE_WAIT_AFTER</strong> will detect any I/O errors or <strong>ENOSPC</strong> conditions and will return these to the caller.</p>
<p class='spacer'>

  <p>Useful combinations of the <em>flags</em> bits are:</p>
  <dl class='dl-vertical'>
    <dt><strong>SYNC_FILE_RANGE_WAIT_BEFORE | SYNC_FILE_RANGE_WRITE</strong></dt>
    <dd>
  <p>Ensures that all pages in the specified range which were dirty when <strong>sync_file_range</strong>() was called are placed under write-out. This is a start-write-for-data-integrity operation.</p>
    </dd>
    <dt><strong>SYNC_FILE_RANGE_WRITE</strong></dt>
    <dd>
  <p>Start write-out of all dirty pages in the specified range which are not presently under write-out. This is an asynchronous flush-to-disk operation. This is not suitable for data integrity operations.</p>
    </dd>
    <dt><strong>SYNC_FILE_RANGE_WAIT_BEFORE</strong> (or <strong>SYNC_FILE_RANGE_WAIT_AFTER</strong>)</dt>
    <dd>
  <p>Wait for completion of write-out of all pages in the specified range. This can be used after an earlier <strong>SYNC_FILE_RANGE_WAIT_BEFORE | SYNC_FILE_RANGE_WRITE</strong> operation to wait for completion of that operation, and obtain its result.</p>
    </dd>
    <dt><strong>SYNC_FILE_RANGE_WAIT_BEFORE | SYNC_FILE_RANGE_WRITE | SYNC_FILE_RANGE_WAIT_AFTER</strong></dt>
    <dd>
  <p>This is a write-for-data-integrity operation that will ensure that all pages in the specified range which were dirty when <strong>sync_file_range</strong>() was called are committed to disk.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>On success, <strong>sync_file_range</strong>() returns 0; on failure -1 is returned and <em>errno</em> is set to indicate the error.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>EBADF</strong></dt>
    <dd>
  <p><em>fd</em> is not a valid file descriptor.</p>
    </dd>
    <dt><strong>EINVAL</strong></dt>
    <dd>
  <p><em>flags</em> specifies an invalid bit; or <em>offset</em> or <em>nbytes</em> is invalid.</p>
    </dd>
    <dt><strong>EIO</strong></dt>
    <dd>
  <p>I/O error.</p>
    </dd>
    <dt><strong>ENOMEM</strong></dt>
    <dd>
  <p>Out of memory.</p>
    </dd>
    <dt><strong>ENOSPC</strong></dt>
    <dd>
  <p>Out of disk space.</p>
    </dd>
    <dt><strong>ESPIPE</strong></dt>
    <dd>
  <p><em>fd</em> refers to something other than a regular file, a block device, a directory, or a symbolic link.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">

<p><strong>sync_file_range</strong>() appeared on Linux in kernel 2.6.17.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">

<p>This system call is Linux-specific, and should be avoided in portable programs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

  <h3>sync_file_range2()</h3>
<p>Some architectures (e.g., PowerPC, ARM) need 64-bit arguments to be aligned in a suitable pair of registers. On such architectures, the call signature of <strong>sync_file_range</strong>() shown in the SYNOPSIS would force a register to be wasted as padding between the <em>fd</em> and <em>offset</em> arguments. (See <a href="../man2/syscall.2.html"><strong>syscall</strong>(2)</a> for details.) Therefore, these architectures define a different system call that orders the arguments suitably:</p>
<p class='spacer'>

<pre><strong>int sync_file_range2(int </strong><em>fd</em><strong>, unsigned int </strong><em>flags</em><strong>,</strong>
<strong>                     off64_t </strong><em>offset</em><strong>, off64_t </strong><em>nbytes</em><strong>);</strong></pre>

<p class='spacer'>

<p>The behavior of this system call is otherwise exactly the same as <strong>sync_file_range</strong>().</p>
<p class='spacer'>

<p>A system call with this signature first appeared on the ARM architecture in Linux 2.6.20, with the name <strong>arm_sync_file_range</strong>(). It was renamed in Linux 2.6.22, when the analogous system call was added for PowerPC. On architectures where glibc support is provided, glibc transparently wraps <strong>sync_file_range2</strong>() under the name <strong>sync_file_range</strong>().</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man2/fdatasync.2.html"><strong>fdatasync</strong>(2)</a>, <a href="../man2/fsync.2.html"><strong>fsync</strong>(2)</a>, <a href="../man2/msync.2.html"><strong>msync</strong>(2)</a>, <a href="../man2/sync.2.html"><strong>sync</strong>(2)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="sync_file_range.2.html"><span aria-hidden="true">&larr;</span> sync_file_range.2: sync a file segment with disk</a></li>
   <li class="next"><a href="syncfs.2.html">syncfs.2: commit filesystem caches to disk <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
