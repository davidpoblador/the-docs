<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pgsql_table - Postfix PostgreSQL client configuration</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Postfix postgresql client configuration">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pgsql_table<small> (5)</small></h1>
        <p class="lead">Postfix postgresql client configuration</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Linux Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man5/"><span itemprop="title">File formats and conventions</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man5/pgsql_table.5.html"><span itemprop="title">pgsql_table</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>postmap -q "<em>string" pgsql:/etc/postfix/filename</em>

postmap -q - pgsql:/etc/postfix/<em>filename &lt;inputfile</em></pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>The Postfix mail system uses optional tables for address rewriting or mail routing. These tables are usually in <strong>dbm</strong> or <strong>db</strong> format.</p>
<p class='spacer'>

  <p>Alternatively, lookup tables can be specified as PostgreSQL databases.  In order to use PostgreSQL lookups, define a PostgreSQL source as a lookup table in main.cf, for example:</p>
<pre>    alias_maps = pgsql:/etc/pgsql-aliases.cf</pre>

<p class='spacer'>

<p>The file /etc/postfix/pgsql-aliases.cf has the same format as the Postfix main.cf file, and can specify the parameters described below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BACKWARDS COMPATIBILITY</h2>
        <div class="sectioncontent">

<p>For compatibility with other Postfix lookup tables, PostgreSQL parameters can also be defined in main.cf.  In order to do that, specify as PostgreSQL source a name that doesn't begin with a slash or a dot.  The PostgreSQL parameters will then be accessible as the name you've given the source in its definition, an underscore, and the name of the parameter.  For example, if the map is specified as "pgsql:<em>pgsqlname</em>", the parameter "hosts" below would be defined in main.cf as "<em>pgsqlname</em>_hosts".</p>
<p class='spacer'>

<p>Note: with this form, the passwords for the PostgreSQL sources are written in main.cf, which is normally world-readable. Support for this form will be removed in a future Postfix version.</p>
<p class='spacer'>

<p>Normally, the SQL query is specified via a single <strong>query</strong> parameter (described in more detail below).  When this parameter is not specified in the map definition, Postfix reverts to an older interface, with the  SQL  query constructed  from the <strong>select_function</strong>, <strong>select_field</strong>, <strong>table</strong>, <strong>where_field</strong> and <strong>additional_conditions</strong> parameters.  The old interface will be gradually phased out. To migrate to the new interface set:</p>
<p class='spacer'>

<pre>    <strong>query</strong> = SELECT <em>select_function</em>('%s')</pre>

<p class='spacer'>

<p>or in the absence of <strong>select_function</strong>, the lower precedence:</p>
<p class='spacer'>

<pre>    <strong>query</strong> = SELECT <em>select_field</em>
        FROM <em>table</em>
        WHERE <em>where_field</em> = '%s'
            <em>additional_conditions</em></pre>

<p class='spacer'>

<p>Use the value, not the name, of each legacy parameter. Note that the <strong>additional_conditions</strong> parameter is optional and if not empty, will always start with <strong>AND</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIST MEMBERSHIP</h2>
        <div class="sectioncontent">

<p>When using SQL to store lists such as $mynetworks, $mydestination, $relay_domains, $local_recipient_maps, etc., it is important to understand that the table must store each list member as a separate key. The table lookup verifies the *existence* of the key. See "Postfix lists versus tables" in the DATABASE_README document for a discussion.</p>
<p class='spacer'>

<p>Do NOT create tables that return the full list of domains in $mydestination or $relay_domains etc., or IP addresses in $mynetworks.</p>
<p class='spacer'>

<p>DO create tables with each matching item as a key and with an arbitrary value. With SQL databases it is not uncommon to return the key itself or a constant value.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PGSQL PARAMETERS</h2>
        <div class="sectioncontent">

  <dl class='dl-horizontal'>
    <dt><strong>hosts</strong></dt>
    <dd>
    <p>The hosts that Postfix will try to connect to and query from. Specify <em>unix:</em> for UNIX-domain sockets, <em>inet:</em> for TCP connections (default).  Example:</p>
<pre>    hosts = host1.some.domain host2.some.domain:port
    hosts = unix:/file/name</pre>

<p class='spacer'>

  <p>The hosts are tried in random order, with all connections over UNIX domain sockets being tried before those over TCP.  The connections are automatically closed after being idle for about 1 minute, and are re-opened as necessary.</p>
<p class='spacer'>

  <p>NOTE: the <em>unix:</em> and <em>inet:</em> prefixes are accepted for backwards compatibility reasons, but are actually ignored. The PostgreSQL client library will always try to connect to an UNIX socket if the name starts with a slash, and will try a TCP connection otherwise.</p>
    </dd>
    <dt><strong>user, password</strong></dt>
    <dd>
    <p>The user name and password to log into the pgsql server. Example:</p>
<pre>    user = someone
    password = some_password</pre>

    </dd>
    <dt><strong>dbname</strong></dt>
    <dd>
    <p>The database name on the servers. Example:</p>
<pre>    dbname = customer_database</pre>

    </dd>
    <dt><strong>query</strong></dt>
    <dd>
    <p>The SQL query template used to search the database, where <strong>%s</strong> is a substitute for the address Postfix is trying to resolve, e.g.</p>
<pre>    query = SELECT replacement FROM aliases WHERE mailbox = '%s'</pre>

<p class='spacer'>

      <p>This parameter supports the following '%' expansions:</p>
      <dl class='dl-horizontal'>
        <dt><strong>%%</strong></dt>
        <dd>
      <p>This is replaced by a literal '%' character. (Postfix 2.2 and later)</p>
        </dd>
        <dt><strong>%s</strong></dt>
        <dd>
      <p>This is replaced by the input key. SQL quoting is used to make sure that the input key does not add unexpected metacharacters.</p>
        </dd>
        <dt><strong>%u</strong></dt>
        <dd>
      <p>When the input key is an address of the form user@domain, <strong>%u</strong> is replaced by the SQL quoted local part of the address. Otherwise, <strong>%u</strong> is replaced by the entire search string. If the localpart is empty, the query is suppressed and returns no results.</p>
        </dd>
        <dt><strong>%d</strong></dt>
        <dd>
      <p>When the input key is an address of the form user@domain, <strong>%d</strong> is replaced by the SQL quoted domain part of the address. Otherwise, the query is suppressed and returns no results.</p>
        </dd>
        <dt><strong>%[SUD]</strong></dt>
        <dd>
      <p>The upper-case equivalents of the above expansions behave in the <strong>query</strong> parameter identically to their lower-case counter-parts. With the <strong>result_format</strong> parameter (see below), they expand the input key rather than the result value.</p>
        </dd>
<p class='spacer'>

      <p>The above %S, %U and %D expansions are available with Postfix 2.2 and later</p>
        </dd>
        <dt><strong>%[1-9]</strong></dt>
        <dd>
      <p>The patterns %1, %2, ... %9 are replaced by the corresponding most significant component of the input key's domain. If the input key is <em>user@mail.example.com</em>, then %1 is <strong>com</strong>, %2 is <strong>example</strong> and %3 is <strong>mail</strong>. If the input key is unqualified or does not have enough domain components to satisfy all the specified patterns, the query is suppressed and returns no results.</p>
        </dd>
<p class='spacer'>

      <p>The above %1, ... %9 expansions are available with Postfix 2.2 and later</p>
        </dd>
      </dl>
    </dd>
<p class='spacer'>

  <p>The <strong>domain</strong> parameter described below limits the input keys to addresses in matching domains. When the <strong>domain</strong> parameter is non-empty, SQL queries for unqualified addresses or addresses in non-matching domains are suppressed and return no results.</p>
<p class='spacer'>

  <p>The precedence of this parameter has changed with Postfix 2.2, in prior releases the precedence was, from highest to lowest, <strong>select_function</strong>, <strong>query</strong>, <strong>select_field</strong>, ...</p>
<p class='spacer'>

  <p>With Postfix 2.2 the <strong>query</strong> parameter has highest precedence, see COMPATIBILITY above.</p>
<p class='spacer'>

  <p>NOTE: DO NOT put quotes around the <strong>query</strong> parameter.</p>
    </dd>
    <dt><strong>result_format (default: %s</strong>)</dt>
    <dd>
      <p>Format template applied to result attributes. Most commonly used to append (or prepend) text to the result. This parameter supports the following '%' expansions:</p>
      <dl class='dl-horizontal'>
        <dt><strong>%%</strong></dt>
        <dd>
      <p>This is replaced by a literal '%' character.</p>
        </dd>
        <dt><strong>%s</strong></dt>
        <dd>
      <p>This is replaced by the value of the result attribute. When result is empty it is skipped.</p>
        </dd>
        <dt><strong>%u</strong></dt>
        <dd>
      <p>When the result attribute value is an address of the form user@domain, <strong>%u</strong> is replaced by the local part of the address. When the result has an empty localpart it is skipped.</p>
        </dd>
        <dt><strong>%d</strong></dt>
        <dd>
      <p>When a result attribute value is an address of the form user@domain, <strong>%d</strong> is replaced by the domain part of the attribute value. When the result is unqualified it is skipped.</p>
        </dd>
        <dt><strong>%[SUD1-9]</strong></dt>
        <dd>
      <p>The upper-case and decimal digit expansions interpolate the parts of the input key rather than the result. Their behavior is identical to that described with <strong>query</strong>, and in fact because the input key is known in advance, queries whose key does not contain all the information specified in the result template are suppressed and return no results.</p>
        </dd>
      </dl>
    </dd>
<p class='spacer'>

  <p>For example, using "result_format = smtp:[%s]" allows one to use a mailHost attribute as the basis of a <a href="../man5/transport.5.html"><strong>transport</strong>(5)</a> table. After applying the result format, multiple values are concatenated as comma separated strings. The expansion_limit and parameter explained below allows one to restrict the number of values in the result, which is especially useful for maps that must return at most one value.</p>
<p class='spacer'>

  <p>The default value <strong>%s</strong> specifies that each result value should be used as is.</p>
<p class='spacer'>

  <p>This parameter is available with Postfix 2.2 and later.</p>
<p class='spacer'>

  <p>NOTE: DO NOT put quotes around the result format!</p>
    </dd>
    <dt><strong>domain (default: no domain list)</strong></dt>
    <dd>
    <p>This is a list of domain names, paths to files, or dictionaries. When specified, only fully qualified search keys with a *non-empty* localpart and a matching domain are eligible for lookup: 'user' lookups, bare domain lookups and "@domain" lookups are not performed. This can significantly reduce the query load on the PostgreSQL server.</p>
<pre>    domain = postfix.org, hash:/etc/postfix/searchdomains</pre>

<p class='spacer'>

  <p>It is best not to use SQL to store the domains eligible for SQL lookups.</p>
<p class='spacer'>

  <p>This parameter is available with Postfix 2.2 and later.</p>
<p class='spacer'>

  <p>NOTE: DO NOT define this parameter for <strong>local</strong>(8) aliases, because the input keys are always unqualified.</p>
    </dd>
    <dt><strong>expansion_limit (default: 0)</strong></dt>
    <dd>
  <p>A limit on the total number of result elements returned (as a comma separated list) by a lookup against the map. A setting of zero disables the limit. Lookups fail with a temporary error if the limit is exceeded.  Setting the limit to 1 ensures that lookups do not return multiple values.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OBSOLETE QUERY INTERFACES</h2>
        <div class="sectioncontent">

  <p>This section describes query interfaces that are deprecated as of Postfix 2.2.  Please migrate to the new <strong>query</strong> interface as the old interfaces are slated to be phased out.</p>
  <dl class='dl-horizontal'>
    <dt><strong>select_function</strong></dt>
    <dd>
    <p>This parameter specifies a database function name. Example:</p>
<pre>    select_function = my_lookup_user_alias</pre>

<p class='spacer'>

    <p>This is equivalent to:</p>
<pre>    query = SELECT my_lookup_user_alias('%s')</pre>

<p class='spacer'>

  <p>This parameter overrides the legacy table-related fields (described below). With Postfix versions prior to 2.2, it also overrides the <strong>query</strong> parameter. Starting with Postfix 2.2, the <strong>query</strong> parameter has highest precedence, and the <strong>select_function</strong> parameter is deprecated.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>The following parameters (with lower precedence than the <strong>select_function</strong> interface described above) can be used to build the SQL select statement as follows:</p>
<p class='spacer'>

<pre>    SELECT [<strong>select_field</strong>]
    FROM [<strong>table</strong>]
    WHERE [<strong>where_field</strong>] = '%s'
          [<strong>additional_conditions</strong>]</pre>

<p class='spacer'>

<p>The specifier %s is replaced with each lookup by the lookup key and is escaped so if it contains single quotes or other odd characters, it will not cause a parse error, or worse, a security problem.</p>
<p class='spacer'>

  <p>Starting with Postfix 2.2, this interface is obsoleted by the more general <strong>query</strong> interface described above. If higher precedence the <strong>query</strong> or <strong>select_function</strong> parameters described above are defined, the parameters described here are ignored.</p>
  <dl class='dl-horizontal'>
    <dt><strong>select_field</strong></dt>
    <dd>
    <p>The SQL "select" parameter. Example:</p>
<pre>    <strong>select_field</strong> = forw_addr</pre>

    </dd>
    <dt><strong>table</strong></dt>
    <dd>
    <p>The SQL "select .. from" table name. Example:</p>
<pre>    <strong>table</strong> = mxaliases</pre>

    </dd>
    <dt><strong>where_field</strong></dt>
    <dd>
    <p>The SQL "select .. where" parameter. Example:</p>
<pre>    <strong>where_field</strong> = alias</pre>

    </dd>
    <dt><strong>additional_conditions</strong></dt>
    <dd>
    <p>Additional conditions to the SQL query. Example:</p>
<pre>    <strong>additional_conditions</strong> = AND status = 'paid'</pre>

    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<a href="../man1/postmap.1.html"><strong>postmap</strong>(1)</a>, Postfix lookup table manager
<a href="../man5/postconf.5.html"><strong>postconf</strong>(5)</a>, configuration parameters
<a href="../man5/ldap_table.5.html"><strong>ldap_table</strong>(5)</a>, LDAP lookup tables
<a href="../man5/mysql_table.5.html"><strong>mysql_table</strong>(5)</a>, MySQL lookup tables
<a href="../man5/sqlite_table.5.html"><strong>sqlite_table</strong>(5)</a>, SQLite lookup tables</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">README FILES</h2>
        <div class="sectioncontent">

  <p>Use "<strong>postconf readme_directory</strong>" or "<strong>postconf html_directory</strong>" to locate this information.</p>
<pre>DATABASE_README, Postfix lookup table overview
PGSQL_README, Postfix PostgreSQL client guide</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">

<p>The Secure Mailer license must be distributed with this software.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">

<pre>PgSQL support was introduced with Postfix version 2.1.</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR(S)</h2>
        <div class="sectioncontent">

<pre>Based on the MySQL client by:
Scott Cotton, Joshua Marcus
IC Group, Inc.

Ported to PostgreSQL by:
Aaron Sethman

Further enhanced by:
Liviu Daia
Institute of Mathematics of the Romanian Academy
P.O. BOX 1-764
RO-014700 Bucharest, ROMANIA</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
  <li class="previous"><a href="pcre_table.5.html"><span aria-hidden="true">&larr;</span> pcre_table.5: format of Postfix PCRE tables</a></li><li class="next"><a href="postconf.5.html">postconf.5: Postfix configuration parameters <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
