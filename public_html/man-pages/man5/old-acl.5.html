<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>old-acl - Access Control Lists</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Access control lists">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">old-acl<small> (5)</small></h1>
        <p class="lead">Access control lists</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/old-acl.5.html">
      <span itemprop="name">old-acl</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/acl/">
      <span itemprop="name">acl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/old-acl.5.html">
      <span itemprop="name">old-acl</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>This document describes Posix-style access control lists as implemented under Linux. Access control lists (ACLs) are used to define access to files and directories.</p>
<p class='spacer'>

<p>In portable programs, the Posix 1003.1e Draft Standard 17 library functions should be used for mainpulating ACL. On most platforms, the ACL entry manipulation functions are not available, so relying only on the ACL manipulation and format conversion functions (ACL to and from text format) is more portable.  The library functions are declared in the <em>sys/acl.h</em> header file.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACCESS CONTROL LIST ENTRIES</h2>
        <div class="sectioncontent">

<p>An access control list contains a number of entries of various types. Each entry stands for permissions granted to a user, or to a group of users.</p>
<p class='spacer'>

<p>An ACL may contain entries with the following entry tag types.</p>
<p class='spacer'>

<pre>ACL_USER_OBJ         (owner)
ACL_USER             (named user)
ACL_GROUP_OBJ        (owning group)
ACL_GROUP            (named group)
ACL_MASK             (effective rights mask)
ACL_OTHER            (other users)</pre>

<p class='spacer'>

<p>The ACL_USER_OBJ, ACL_GROUP_OBJ, and ACL_OTHER entries correspond to the traditional file mode permission bits. There is exactly one each of these entries in a valid ACL.</p>
<p class='spacer'>

<p>ACL_USER and ACL_GROUP entries define explicit rights for users and groups, respectively. For entries of these two types, <em>a_id[0]</em> is set to the ID of the user or group in question. Whenever there are any entries of the last two types in the ACL, an ACL_MASK entry is also required.</p>
<p class='spacer'>

<p>An ACL_MASK entry limits the effective rights granted to named users or groups. The efective rights granted are those that are both granted by the user's or group's entry, and by the ACL_MASK entry. The ACL_MASK entry does not apply to the ACL_USER_OBJ and ACL_OTHER entries.</p>
<p class='spacer'>

<p>The lowest three bits of <em>a_perm</em> define the rights granted to the user the entry applies to, just like the bits in the traditional file mode. This results in a value between 0 and 7 (from 0 standing for no access to 7 standing for read, write, and execute access). For accessing these bits, the constants ACL_READ, ACL_WRITE and ACL_EXECUTE should be used.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VALID ACCESS CONTROL LISTS</h2>
        <div class="sectioncontent">

<p>Each valid ACL has as a minimum the three required base entries ACL_USER_OBJ, ACL_GROUP_OBJ, and ACL_OTHER. These entries correspond to the traditional Posix permission bits. There must be exactly one each of these three entries. The permission mask `rw-r-----' corresponds to the following entries:</p>
<p class='spacer'>

<pre>	u::rw- (ACL_USER_OBJ entry)
	g::r-- (ACL_GROUP_OBJ entry)
	o::--- (ACL_OTHER entry)</pre>

<p class='spacer'>

<p>An ACL must also contain exactly one ACL_MASK entry, if it contains additional ACL_USER or ACL_GROUP entries. For each user or group, there must be at most one ACL_USER or ACL_GROUP entry per access control list. An ACL may also contain an ACL_MASK entry if no ACL_USER or ACL_GROUP entries exist.</p>
<p class='spacer'>

<pre>	u:joe:rw- (ACL_USER entry)
	g:webteam:rw- (ACL_GROUP entry)
	m::rw- (ACL_MASK entry)</pre>

<p class='spacer'>

  <h3>THE ACL_MASK ENTRY</h3>
<p>The purpose of the ACL_MASK entry is to limit the effective rights granted to groups and named users in the ACL. The effective rights granted to a user or a group with an ACL_USER or an ACL_GROUP entry are those which are listed in both the ACL_USER or ACL_GROUP entry <em>and</em> the ACL_MASK entry. The ACL_USER_OBJ and ACL_OTHER entries are not affected by the ACL_MASK entry.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PERMISSIONS</h2>
        <div class="sectioncontent">

<p>The permissions required for manipulating ACLs of an inode are similar to the permissions required for manipulating the file mode. Processes with search access to a file are granted the right to read ACLs. Only the file owner and processes capable of CAP_FOWNER are granted the right to modify ACLs. (On current Linux systems, root is the only user with the CAP_FOWNER capability.)</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DETERMINING ACCESS</h2>
        <div class="sectioncontent">

<p>When a process requests access to a file, the following algorithm determines whether access is granted or not. The input to the algorithm is a set of requested permissions (read, write, execute).</p>
<p class='spacer'>

  <h3>(1) Find a matching ACL entry</h3>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>If the user is the file owner, access is granted <em>only</em> if the ACL_USER_OBJ entry contains the requested permissions.</p>
    </dd>
    <dt>*</dt>
    <dd>
      <p>If the ACL contains a named user (ACL_USER) entry that matches the user, then:</p>
      <dl class='dl-horizontal'>
        <dt>-</dt>
        <dd>
      <p>If access is granted by that entry, continue with step <strong>(2)</strong> below.</p>
        </dd>
        <dt>-</dt>
        <dd>
      <p>Otherwise, access is denied.</p>
        </dd>
      </dl>
    </dd>
    <dt>*</dt>
    <dd>
      <p>If the user is in the owning group of the file (ACL_GROUP_OBJ entry), or if the user is member of a named group (ACL_GROUP entries), then:</p>
      <dl class='dl-horizontal'>
        <dt>-</dt>
        <dd>
      <p>If either the ACL_GROUP_OBJ entry or one of the ACL_GROUP entries contains the requested permissions, continue with step <strong>(2)</strong> below. (Permissions of multiple ACL entries are <em>not</em> accumulated.)</p>
        </dd>
        <dt>-</dt>
        <dd>
      <p>Otherwise, access is denied.</p>
        </dd>
      </dl>
    </dd>
    <dt>*</dt>
    <dd>
      <p>If none of the above rules match, then</p>
      <dl class='dl-horizontal'>
        <dt>-</dt>
        <dd>
      <p>If the ACL_OTHER entry contains the requested permissions, access is granted.</p>
        </dd>
        <dt>-</dt>
        <dd>
      <p>Otherwise, access is denied.</p>
        </dd>
      </dl>
    </dd>
  </dl>
  <h3>(2) Check the access mask</h3>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>If the access mask (ACL_MASK) contains the requested permissions, access is granted.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>Otherwise, access is denied.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEFAULT ACCESS CONTROL LISTS</h2>
        <div class="sectioncontent">

<p>Directories may have a default ACL, in addition to the regular ACL. While the purpose of the regular ACL is to control access to a file or directory, the purpose of the default ACL is to control access to files which are created inside the directory.</p>
<p class='spacer'>

<p>When a file is created, a create permissions are specified that determines the maximum access rights to the file. This usually is 0666 of files, and 0777 for directories.</p>
<p class='spacer'>

  <p>Traditionally, the effective access rights to new files are determined by combining the <strong>umask</strong> and the create permissions. The default ACL replaces the role of the <strong>umask</strong>. The following steps are taken when a file is created inside a directory which has a default ACL:</p>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>The new file inherits the directory's default ACL as its access ACL.</p>
    </dd>
    <dt>*</dt>
    <dd>
      <p>The permissions of the new file's access ACL are modified in the following way:</p>
      <dl class='dl-horizontal'>
        <dt>-</dt>
        <dd>
      <p>The ACL_USER entry is set to the union of the value determied by the default ACL and the user bits of the create permissions.</p>
        </dd>
        <dt>-</dt>
        <dd>
      <p>The ACL_OTHER entry is set to the union of the value determined by the default ACL and the other bits of the create permissions.</p>
        </dd>
        <dt>-</dt>
        <dd>
      <p>If the new file's ACL contains an ACL_MASK entry, the permission bits of the ACL_MASK entry are set to the group bits of the create permissions. If the new file's ACL does not contain an ACL_MASK entry, the permission bits of the ACL_GROUP_OBJ entry are set to the group bits of the create permissions.</p>
        </dd>
      </dl>
    </dd>
    <dt>*</dt>
    <dd>
  <p>The user and other part of the new file's mode bits are set to the ACL_USER_OBJ and ACL_OTHER permission bits, respectively.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>If the new file's ACL contains an ACL_MASK entry, the group bits of the new file's mode field are set to the ACL_MASK entry permission bits. If the new file's ACL does not contain an ACL_MASK entry, the group bits of the new file's mode field are set to the ACL_GROUP_OBJ entry permission bits.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>If the new file is a directory, it inherits the parent directory's default ACL as its own default ACL.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>For directories without a default ACL, the <strong>umask</strong> is used to determine effective permissions (see <a href="../man2/umask.2.html"><strong>umask</strong>(2)</a>).</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILE MODE PERMISSION BITS TO ACL ENTRY MAPPING</h2>
        <div class="sectioncontent">

<pre>          user    group   other
    ----+-------+-------+-------+
        | r w x | r w x | r w x |
    ----+-------+-------+-------+
            ^       ^       ^
            |       |       +-- maps to ACL_OTHER
            |       +-- maps to ACL_GROUP_OBJ or ACL_MASK
            +-- maps to ACL_USER_OBJ</pre>

<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NFSv2, NFSv3 AND ACCESS CONTROL LISTS</h2>
        <div class="sectioncontent">

<p>The NFS protocol in version 2 performs some access control decisions at the client, based on the file mode permission bits. It serves the user cached file contents if it thinks access would be granted. This logic is no longer correct if access control lists are in effect. Both false positives and denials might result.</p>
<p class='spacer'>

<p>As a workaround, the file mode permission bits are modified before sending them to NFSv2 clients. This ensures NFS clients don't grant extra permissions. (Only the kernel NFS daemon does that right now; the userspace NFS daemon has not been patched yet.) The file mode permission sent are a subset of the real file mode permission bits. They are changed as follows:</p>
<p class='spacer'>

  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>The group file mode permission bits are set to the intersection of the ACL_GROUP_OBJ and the ACL_MASK ACL entry.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>The others file mode permission bits are set to the intersection of all ACL entries excluding the ACL_USER_OBJ entry.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>A consequence of these changes is that extended permissions granted by ACLs are not available over NFSv2 mounts.</p>
<p class='spacer'>

<p>Up to at least 2.2.18 and 2.4.2 kernels, the NFSv3 implementation does not implement the ACCESS remote procedure call. Therefore, NFSv3 currently suffers the same problems as NFSv2. The same workaround is employed right now.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CHANGES TO THE FILE UTILITIES</h2>
        <div class="sectioncontent">

<p>The <strong>ls</strong>(1) utility displays a plus sign (`+') after the permission string of entries with an extended ACL (i.e., entries where the permission string shows only part of the effective permissions).</p>
<p class='spacer'>

<p>The <strong>cp</strong>(1) and <strong>mv</strong>(1) utilities preserve ACLs if possible. If files are copied or moved between fileystems that do not support ACLs, only the file mode permission bits are preserved, and a warning is written to standard error.</p>
<p class='spacer'>

  <p>The <a href="../man1/chmod.1.html"><strong>chmod</strong>(1)</a> utility is traditionally used to change the file mode permission bits. Changing the permission bits using <strong>chmod</strong> has the following effect on an ACL that is associated with a file:</p>
  <dl class='dl-horizontal'>
    <dt>*</dt>
    <dd>
  <p>The new user permission bits replace the permissions of the owner ACL entry.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>The new group permission bits replace the permission bits of the mask ACL entry if a mask ACL entry exists. The new group permission bits replace the permission bits of the owning group ACL entry if no mask ACL entry exists.</p>
    </dd>
    <dt>*</dt>
    <dd>
  <p>The new others permission bits replace the permissions of the others ACL entry.</p>
    </dd>
  </dl>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<p>Andreas Gruenbacher, &lt;<em>a.gruenbacher@computer.org</em>&gt;.</p>
<p class='spacer'>

<p>Please send your bug reports, suggested features and comments to the above address.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<a href="../man1/getfacl.1.html"><strong>getfacl</strong>(1)</a>, <a href="../man1/setfacl.1.html"><strong>setfacl</strong>(1)</a>, <a href="../man1/chmod.1.html"><strong>chmod</strong>(1)</a>, <strong>umask</strong>(1), ls(1)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="numa_maps.5.html"><span aria-hidden="true">&larr;</span> numa_maps.5: overview of Non-Uniform Memory Architecture</a></li>
   <li class="next"><a href="pam.conf.5.html">pam.conf.5: PAM configuration files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
