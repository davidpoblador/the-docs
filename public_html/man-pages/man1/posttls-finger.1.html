<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>posttls-finger - Probe the TLS properties of an ESMTP or LMTP server.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Probe the tls properties of an esmtp or lmtp server.">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">posttls-finger<small> (1)</small></h1>
        <p class="lead">Probe the tls properties of an esmtp or lmtp server.</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Linux Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man1/"><span itemprop="title">Executable programs or shell commands</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man1/posttls-finger.1.html"><span itemprop="title">posttls-finger</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>posttls-finger</strong> [<em>options</em>] [<strong>inet:</strong>]<em>domain</em>[:<em>port</em>] [<em>match ...</em>]

<strong>posttls-finger</strong> -S [<em>options</em>] unix:<em>pathname</em> [<em>match ...</em>]</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p><a href="../man1/posttls-finger.1.html"><strong>posttls-finger</strong>(1)</a> connects to the specified destination and reports TLS-related information about the server. With SMTP, the destination is a domainname; with LMTP it is either a domainname prefixed with <strong>inet:</strong> or a pathname prefixed with <strong>unix:</strong>.  If Postfix is built without TLS support, the resulting posttls-finger program has very limited functionality, and only the <strong>-a</strong>, <strong>-c</strong>, <strong>-h</strong>, <strong>-o</strong>, <strong>-S</strong>, <strong>-t</strong>, <strong>-T</strong> and <strong>-v</strong> options are available.</p>
<p class='spacer'>

<p>Note: this is an unsupported test program. No attempt is made to maintain compatibility between successive versions.</p>
<p class='spacer'>

<p>For SMTP servers that don't support ESMTP, only the greeting banner and the negative EHLO response are reported. Otherwise, the reported EHLO response details further server capabilities.</p>
<p class='spacer'>

<p>If TLS support is enabled when <a href="../man1/posttls-finger.1.html"><strong>posttls-finger</strong>(1)</a> is compiled, and the server supports <strong>STARTTLS</strong>, a TLS handshake is attempted.</p>
<p class='spacer'>

<p>If DNSSEC support is available, the connection TLS security level (<strong>-l</strong> option) defaults to <strong>dane</strong>; see TLS_README for details. Otherwise, it defaults to <strong>secure</strong>.  This setting determines the certificate matching policy.</p>
<p class='spacer'>

<p>If TLS negotiation succeeds, the TLS protocol and cipher details are reported. The server certificate is then verified in accordance with the policy at the chosen (or default) security level.  With public CA-based trust, when the <strong>-L</strong> option includes <strong>certmatch</strong>, (true by default) name matching is performed even if the certificate chain is not trusted.  This logs the names found in the remote SMTP server certificate and which if any would match, were the certificate chain trusted.</p>
<p class='spacer'>

<p>Note: <a href="../man1/posttls-finger.1.html"><strong>posttls-finger</strong>(1)</a> does not perform any table lookups, so the TLS policy table and obsolete per-site tables are not consulted. It does not communicate with the <strong>tlsmgr</strong>(8) daemon (or any other Postfix daemons); its TLS session cache is held in private memory, and disappears when the process exits.</p>
<p class='spacer'>

<p>With the <strong>-r <em>delay</em> option, if the server assigns a TLS session id, the TLS session is cached. The connection is then closed and re-opened after the specified delay, and <a href="../man1/posttls-finger.1.html"><strong>posttls-finger</strong>(1)</a> then reports whether the cached TLS session was re-used.</p>
<p class='spacer'>

<p>When the destination is a load-balancer, it may be distributing load between multiple server caches. Typically, each server returns its unique name in its EHLO response. If, upon reconnecting with <strong>-r</strong>, a new server name is detected, another session is cached for the new server, and the reconnect is repeated up to a maximum number of times (default 5) that can be specified via the <strong>-m</strong> option.</p>
<p class='spacer'>

<p>The choice of SMTP or LMTP (<strong>-S</strong> option) determines the syntax of the destination argument. With SMTP, one can specify a service on a non-default port as <em>host</em>:<em>service</em>, and disable MX (mail exchanger) DNS lookups with [<em>host</em>] or [<em>host</em>]:<em>port</em>. The [] form is required when you specify an IP address instead of a hostname.  An IPv6 address takes the form [<strong>ipv6:<em>address</em>]. The default port for SMTP is taken from the smtp/tcp</strong> entry in /etc/services, defaulting to 25 if the entry is not found.</p>
<p class='spacer'>

<p>With LMTP, specify <strong>unix:<em>pathname</em> to connect to a local server listening on a unix-domain socket bound to the specified pathname; otherwise, specify an optional inet:</strong> prefix followed by a <em>domain</em> and an optional port, with the same syntax as for SMTP. The default TCP port for LMTP is 24.</p>
<p class='spacer'>

  <p>Arguments:</p>
  <dl class='dl-horizontal'>
    <dt><strong>-a</strong> <em>family</em> (default: <strong>any</strong>)</dt>
    <dd>
  <p>Address family preference: <strong>ipv4</strong>, <strong>ipv6</strong> or <strong>any</strong>.  When using <strong>any</strong>, posttls-finger will randomly select one of the two as the more preferred, and exhaust all MX preferences for the first address family before trying any addresses for the other.</p>
    </dd>
    <dt><strong>-A</strong> <em>trust-anchor.pem</em> (default: none)</dt>
    <dd>
  <p>A list of PEM trust-anchor files that overrides CAfile and CApath trust chain verification.  Specify the option multiple times to specify multiple files.  See the main.cf documentation for smtp_tls_trust_anchor_file for details.</p>
    </dd>
    <dt><strong>-c</strong></dt>
    <dd>
  <p>Disable SMTP chat logging; only TLS-related information is logged.</p>
    </dd>
    <dt><strong>-C</strong></dt>
    <dd>
  <p>Print the remote SMTP server certificate trust chain in PEM format. The issuer DN, subject DN, certificate and public key fingerprints (see -d <em>mdalg</em> option below) are printed above each PEM certificate block.  If you specify -F <em>CAfile</em> or -P <em>CApath</em>, the OpenSSL library may augment the chain with missing issuer certificates.  To see the actual chain sent by the remote SMTP server leave <em>CAfile</em> and <em>CApath</em> unset.</p>
    </dd>
    <dt><strong>-d <em>mdalg</em> (default: sha1</strong>)</dt>
    <dd>
  <p>The message digest algorithm to use for reporting remote SMTP server fingerprints and matching against user provided certificate fingerprints (with DANE TLSA records the algorithm is specified in the DNS).</p>
    </dd>
    <dt><strong>-f</strong></dt>
    <dd>
  <p>Lookup the associated DANE TLSA RRset even when a hostname is not an alias and its address records lie in an unsigned zone.  See smtp_tls_force_insecure_host_tlsa_lookup for details.</p>
    </dd>
    <dt>-F <em>CAfile.pem</em> (default: none)</dt>
    <dd>
  <p>The PEM formatted CAfile for remote SMTP server certificate verification.  By default no CAfile is used and no public CAs are trusted.</p>
    </dd>
    <dt>-g <em>grade</em> (default: medium)</dt>
    <dd>
  <p>The minimum TLS cipher grade used by posttls-finger.  See smtp_tls_mandatory_ciphers for details.</p>
    </dd>
    <dt><strong>-h <em>host_lookup</em> (default: dns</strong>)</dt>
    <dd>
  <p>The hostname lookup methods used for the connection.  See the documentation of smtp_host_lookup for syntax and semantics.</p>
    </dd>
    <dt><strong>-l <em>level</em> (default: dane</strong> or <strong>secure</strong>)</dt>
    <dd>
  <p>The security level for the connection, default <strong>dane</strong> or <strong>secure</strong> depending on whether DNSSEC is available.  For syntax and semantics, see the documentation of smtp_tls_security_level. When <strong>dane</strong> or <strong>dane-only</strong> is supported and selected, if no TLSA records are found, or all the records found are unusable, the <em>secure</em> level will be used instead.  The <strong>fingerprint</strong> security level allows you to test certificate or public-key fingerprint matches before you deploy them in the policy table.</p>
    </dd>
<p class='spacer'>

  <p>Note, since <strong>posttls-finger</strong> does not actually deliver any email, the <strong>none</strong>, <strong>may</strong> and <strong>encrypt</strong> security levels are not very useful.  Since <strong>may</strong> and <strong>encrypt</strong> don't require peer certificates, they will often negotiate anonymous TLS ciphersuites, so you won't learn much about the remote SMTP server's certificates at these levels if it also supports anonymous TLS (though you may learn that the server supports anonymous TLS).</p>
    </dd>
    <dt><strong>-L <em>logopts</em> (default: routine,certmatch</strong>)</dt>
    <dd>
      <p>Fine-grained TLS logging options. To tune the TLS features logged during the TLS handshake, specify one or more of:</p>
      <dl class='dl-horizontal'>
        <dt><strong>0, none</strong></dt>
        <dd>
          <p>These yield no TLS logging; you'll generally want more, but this is handy if you just want the trust chain:</p>
<pre>$ posttls-finger -cC -L none destination</pre>

        </dd>
        <dt><strong>1, routine, summary</strong></dt>
        <dd>
      <p>These synonymous values yield a normal one-line summary of the TLS connection.</p>
        </dd>
        <dt><strong>2, debug</strong></dt>
        <dd>
      <p>These synonymous values combine routine, ssl-debug, cache and verbose.</p>
        </dd>
        <dt><strong>3, ssl-expert</strong></dt>
        <dd>
      <p>These synonymous values combine debug with ssl-handshake-packet-dump. For experts only.</p>
        </dd>
        <dt><strong>4, ssl-developer</strong></dt>
        <dd>
      <p>These synonymous values combine ssl-expert with ssl-session-packet-dump. For experts only, and in most cases, use wireshark instead.</p>
        </dd>
        <dt><strong>ssl-debug</strong></dt>
        <dd>
      <p>Turn on OpenSSL logging of the progress of the SSL handshake.</p>
        </dd>
        <dt><strong>ssl-handshake-packet-dump</strong></dt>
        <dd>
      <p>Log hexadecimal packet dumps of the SSL handshake; for experts only.</p>
        </dd>
        <dt><strong>ssl-session-packet-dump</strong></dt>
        <dd>
      <p>Log hexadecimal packet dumps of the entire SSL session; only useful to those who can debug SSL protocol problems from hex dumps.</p>
        </dd>
        <dt><strong>untrusted</strong></dt>
        <dd>
      <p>Logs trust chain verification problems.  This is turned on automatically at security levels that use peer names signed by certificate authorities to validate certificates.  So while this setting is recognized, you should never need to set it explicitly.</p>
        </dd>
        <dt><strong>peercert</strong></dt>
        <dd>
      <p>This logs a one line summary of the remote SMTP server certificate subject, issuer, and fingerprints.</p>
        </dd>
        <dt><strong>certmatch</strong></dt>
        <dd>
      <p>This logs remote SMTP server certificate matching, showing the CN and each subjectAltName and which name matched.  With DANE, logs matching of TLSA record trust-anchor and end-entity certificates.</p>
        </dd>
        <dt><strong>cache</strong></dt>
        <dd>
      <p>This logs session cache operations, showing whether session caching is effective with the remote SMTP server.  Automatically used when reconnecting with the <strong>-r</strong> option; rarely needs to be set explicitly.</p>
        </dd>
        <dt><strong>verbose</strong></dt>
        <dd>
      <p>Enables verbose logging in the Postfix TLS driver; includes all of peercert..cache and more.</p>
        </dd>
      </dl>
    </dd>
<p class='spacer'>

  <p>The default is <strong>routine,certmatch</strong>. After a reconnect, <strong>peercert</strong>, <strong>certmatch</strong> and <strong>verbose</strong> are automatically disabled while <strong>cache</strong> and <strong>summary</strong> are enabled.</p>
    </dd>
    <dt><strong>-m <em>count</em> (default: 5</strong>)</dt>
    <dd>
  <p>When the <strong>-r <em>delay</em> option is specified, the -m</strong> option determines the maximum number of reconnect attempts to use with a server behind a load-balacer, to see whether connection caching is likely to be effective for this destination.  Some MTAs don't expose the underlying server identity in their EHLO response; with these servers there will never be more than 1 reconnection attempt.</p>
    </dd>
    <dt>-o <em>name=value</em></dt>
    <dd>
  <p>Specify zero or more times to override the value of the main.cf parameter <em>name</em> with <em>value</em>.  Possible use-cases include overriding the values of TLS library parameters, or "myhostname" to configure the SMTP EHLO name sent to the remote server.</p>
    </dd>
    <dt>-p <em>protocols</em> (default: !SSLv2)</dt>
    <dd>
  <p>List of TLS protocols that posttls-finger will exclude or include.  See smtp_tls_mandatory_protocols for details.</p>
    </dd>
    <dt>-P <em>CApath/</em> (default: none)</dt>
    <dd>
  <p>The OpenSSL CApath/ directory (indexed via <strong>c_rehash</strong>(1)) for remote SMTP server certificate verification.  By default no CApath is used and no public CAs are trusted.</p>
    </dd>
    <dt>-r <em>delay</em></dt>
    <dd>
  <p>With a cachable TLS session, disconnect and reconnect after <em>delay</em> seconds. Report whether the session is re-used. Retry if a new server is encountered, up to 5 times or as specified with the <strong>-m</strong> option. By default reconnection is disabled, specify a positive delay to enable this behavior.</p>
    </dd>
    <dt><strong>-S</strong></dt>
    <dd>
  <p>Disable SMTP; that is, connect to an LMTP server. The default port for LMTP over TCP is 24.  Alternative ports can specified by appending "<em>:servicename</em>" or ":<em>portnumber</em>" to the destination argument.</p>
    </dd>
    <dt><strong>-t <em>timeout</em> (default: 30</strong>)</dt>
    <dd>
  <p>The TCP connection timeout to use.  This is also the timeout for reading the remote server's 220 banner.</p>
    </dd>
    <dt><strong>-T <em>timeout</em> (default: 30</strong>)</dt>
    <dd>
  <p>The SMTP/LMTP command timeout for EHLO/LHLO, STARTTLS and QUIT.</p>
    </dd>
    <dt><strong>-v</strong></dt>
    <dd>
  <p>Enable verose Postfix logging.  Specify more than once to increase the level of verbose logging.</p>
    </dd>
    <dt>[<strong>inet:</strong>]<em>domain</em>[:<em>port</em>]</dt>
    <dd>
  <p>Connect via TCP to domain <em>domain</em>, port <em>port</em>. The default port is <strong>smtp</strong> (or 24 with LMTP).  With SMTP an MX lookup is performed to resolve the domain to a host, unless the domain is enclosed in <strong>[]</strong>.  If you want to connect to a specific MX host, for instance <em>mx1.example.com</em>, specify [<em>mx1.example.com</em>] as the destination and <em>example.com</em> as a <strong>match</strong> argument. When using DNS, the destination domain is assumed fully qualified and no default domain or search suffixes are applied; you must use fully-qualified names or also enable <strong>native</strong> host lookups (these don't support <strong>dane</strong> or <strong>dane-only</strong> as no DNSSEC validation information is available via <strong>native</strong> lookups).</p>
    </dd>
    <dt>unix:<em>pathname</em></dt>
    <dd>
  <p>Connect to the UNIX-domain socket at <em>pathname</em>. LMTP only.</p>
    </dd>
    <dt><strong>match ...</strong></dt>
    <dd>
  <p>With no match arguments specified, certificate peername matching uses the compiled-in default strategies for each security level.  If you specify one or more arguments, these will be used as the list of certificate or public-key digests to match for the <strong>fingerprint</strong> level, or as the list of DNS names to match in the certificate at the <strong>verify</strong> and <strong>secure</strong> levels.  If the security level is <strong>dane</strong>, or <strong>dane-only</strong> the match names are ignored, and <strong>hostname, nexthop</strong> strategies are used.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">

  <dl class='dl-horizontal'>
    <dt><strong>MAIL_CONFIG</strong></dt>
    <dd>
  <p>Read configuration parameters from a non-default location.</p>
    </dd>
    <dt><strong>MAIL_VERBOSE</strong></dt>
    <dd>
  <p>Same as <strong>-v</strong> option.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<a href="../man1/smtp-source.1.html"><strong>smtp-source</strong>(1)</a>, SMTP/LMTP message source
<a href="../man1/smtp-sink.1.html"><strong>smtp-sink</strong>(1)</a>, SMTP/LMTP message dump
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">README FILES</h2>
        <div class="sectioncontent">

  <p>Use "<strong>postconf readme_directory</strong>" or "<strong>postconf html_directory</strong>" to locate this information.</p>
<pre>TLS_README, Postfix STARTTLS howto</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">

<p>The Secure Mailer license must be distributed with this software.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR(S)</h2>
        <div class="sectioncontent">

<pre>Wietse Venema
IBM T.J. Watson Research
P.O. Box 704
Yorktown Heights, NY 10598, USA

Viktor Dukhovni</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
  <li class="previous"><a href="postsuper.1.html"><span aria-hidden="true">&larr;</span> postsuper.1: Postfix superintendent</a></li><li class="next"><a href="pr.1.html">pr.1: convert text files for printing <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
