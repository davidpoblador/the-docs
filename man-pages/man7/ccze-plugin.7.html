<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ccze-plugin: A robust log colorizer, plugin infrastructure</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A robust log colorizer, plugin infrastructure">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ccze-plugin (7) manual">
  <meta name="twitter:description" content="A robust log colorizer, plugin infrastructure">
  <meta name="twitter:image" content="https://www.carta.tech/images/ccze-ccze-plugin-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/ccze-plugin.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ccze-plugin (7) manual" />
  <meta property="og:description" content="A robust log colorizer, plugin infrastructure" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ccze-ccze-plugin-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ccze-plugin<small> (7)</small></h1>
        <p class="lead">A robust log colorizer, plugin infrastructure</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/ccze-plugin.7.html">
      <span itemprop="name">ccze-plugin: A robust log colorizer, plugin infrastructure</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ccze/">
      <span itemprop="name">ccze</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/ccze-plugin.7.html">
      <span itemprop="name">ccze-plugin: A robust log colorizer, plugin infrastructure</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;ccze.h&gt;</strong></p><p><strong>/* Plugin support */</strong></p><p><strong>typedef void (*</strong><em>ccze_plugin_startup_t</em><strong>) (void);</strong></p><p><strong>typedef void (*</strong><em>ccze_plugin_shutdown_t</em><strong>) (void);</strong></p><p><strong>typedef int (*</strong><em>ccze_plugin_handle_t</em><strong>) (const char *</strong><em>str</em><strong>,</strong> <strong>size_t </strong><em>length</em><strong>, char **</strong><em>rest</em><strong>);</strong></p><p><strong>CCZE_DEFINE_PLUGIN (</strong><em>name</em><strong>, </strong><em>type</em><strong>, </strong><em>desc</em><strong>);</strong></p><p><strong>CCZE_DEFINE_PLUGINS (</strong><em>plugins</em><strong>...);</strong></p><p><strong>/* Display */</strong></p><p><strong>void ccze_addstr (ccze_color_t </strong><em>col</em><strong>, const char *</strong><em>str</em><strong>);</strong></p><p><strong>void ccze_newline (void);</strong></p><p><strong>void ccze_space (void);</strong></p><p><strong>void ccze_wordcolor_process_one (char *</strong><em>word</em><strong>, int </strong><em>slookup</em><strong>);</strong></p><p><strong>/* Helpers */</strong></p><p><strong>ccze_color_t ccze_http_action (const char *</strong><em>method</em><strong>);</strong></p><p><strong>void ccze_print_date (const char *</strong><em>date</em><strong>);</strong></p><p><strong>/* Command line */</strong></p><p><strong>char **ccze_plugin_argv_get (const char *</strong><em>name</em><strong>);</strong></p><p><strong>const char *ccze_plugin_name_get (void);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This manual page attempts to outline the internals of CCZE plugins:  how they work, how they are implemented, and how to add new ones.</p><p>There are four required entry points in a plugin: a <em>startup</em>, a <em>shutdown</em> and a <em>handler</em> routine (more on these later), and an informational structure.</p><p>The <em>startup</em> function must be of type <strong>ccze_plugin_startup_t</strong>. This is called right after the module is loaded.  Its purpose is to initialise all kinds of module-specific global variables, such as the regular expressions.</p><p>The <em>shutdown</em> function is its counterpart: this is used to deallocate any memory reserved by the <em>startup</em> code.</p><p>The core part of a plugin is the <em>handler</em>, of type <strong>ccze_plugin_handle_t</strong>.  This does the actual coloring.  The string to process is passed in the <em>str</em> argument, its length in <em>length</em>. The third argument, <em>rest</em> is a pointer to a string.  Unlike the first two, this argument is used only for output.</p><p>When a handler processed a string, it must return a non-zero value, in case it could not process it, the handler must return with zero.  If the string could be processed only partially, the part which was deemed unknown by the handler must be passed back in the <em>rest</em> variable.</p><p>The fourth part, although the smallest part, is the most important. Without this, the module is useless, it cannot be loaded.  This part tells CCZE what the <em>startup</em>, <em>shutdown</em> and <em>handler</em> functions are called.</p><p>To encourage good style, the little details of this structure will not be disclosed in this manual page.  Instead, the helper macro, <em>CCZE_DEFINE_PLUGIN</em> will be explained.</p><p><em>CCZE_DEFINE_PLUGIN</em> is the macro to use if one wants to make the plugin loadable. Its first argument is an unquoted string: the name of the plugin. The second part is the type of the plugin, it can be <em>FULL</em>, <em>PARTIAL</em> or <em>ANY</em>. The last argument is a short description of the plugin.</p><p>It is assumed that the three functions mentioned earlier are called <em>ccze_</em><strong>name</strong><em>_setup</em>, <em>ccze_</em><strong>name</strong><em>_shutdown</em> and <em>ccze_</em><strong>name</strong><em>_handle</em>, respectively.</p><p>A <em>FULL</em> plugin is one that accepts raw input, untouched by any other plugin before, and processes it.  On the other hand, a <em>PARTIAL</em> plugin relies on previous ones preprocessing the input.  For example, <em>syslog</em> is a full plugin, on which <em>ulogd</em>, a partial plugin relies.  The <em>syslog</em> plugin processes the raw input from the logfile, adds colour to most of it, save the actual message sent by a process, that is left to subsequent plugins, like <em>ulogd</em>. An <em>ANY</em> plugin is one can act as both other types.</p><p>With <em>CCZE_DEFINE_PLUGINS</em> one can place more than one plugin into one shared object.</p><p>There are two other helper functions, <em>ccze_plugin_argv_get</em> and <em>ccze_plugin_name_get</em>. One can pass arguments to CCZE plugins, and these is the function to retrieve them. While <em>ccze_plugin_name_get</em> returns the name of the current plugin, <em>ccze_plugin_argv_get</em> returns a NULL-terminated array, with each entry containing an argument.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DISPLAY METHODS</h2>
        <div class="sectioncontent">
<p>The so-called <em>display methods</em> are the <strong>only</strong> supported interface to emit something to the display. These handle both the normal, ncurses-based, and the HTML output. This is a kind of abstraction so plugins will not have to worry about the differences between the output formats.</p><p>The most important one is <em>ccze_addstr</em>, which takes a color (see <em>ccze.h</em> for a list of supported color tags) and a string, and displays it appropriately. The <em>ccze_space</em> and <em>ccze_newline</em> functions emit a space and a newline, respectively.</p><p>Our last function, <em>ccze_wordcolor_process_one</em> passes <strong>word</strong> to the word colourising engine. If the second argument, <strong>slookup</strong> is non-zero, the engine will perform service lookups (like <em>getent</em> and friends).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HELPER METHODS</h2>
        <div class="sectioncontent">
<p>We only have two helper methods: <em>ccze_print_date</em>, which simply prints out the date in the appropriate colour, and <em>ccze_http_action</em>, which given a HTTP <strong>method</strong>, returns the associated colour, in a format suitable for <em>ccze_addstr</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
#include &lt;ccze.h&gt;
#include &lt;stddef.h&gt;
#include &lt;string.h&gt;

static char **ccze_foo_argv;

static int
ccze_foo_handle (const char *str, size_t length, char **rest)
{
  int i = 1;

  if (strstr (str, "foo"))
    {
      ccze_addstr (CCZE_COLOR_GOODWORD, str);
      return 1;
    }

  while (ccze_foo_argv[i])
    {
      if (strstr (str, ccze_foo_argv[i]))
        {
          ccze_addstr (CCZE_COLOR_GOODWORD, str);
          return 1;
        }
      i++;
    }
  return 0;
}

static void
ccze_foo_startup (void)
{
  ccze_foo_argv = ccze_plugin_argv_get (ccze_plugin_name_get ());
}

static void
ccze_foo_shutdown (void)
{
}

CCZE_DEFINE_PLUGIN (foo, PARTIAL, "Partial FOO coloriser.");
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ccze-plugin&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/ccze.1.html"><strong>ccze</strong>(1)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>ccze was written by Gergely Nagy &lt;algernon@bonehunter.rulez.org&gt;, based on colorize by Istvan Karaszi &lt;colorize@spam.raszi.hu&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cbios.7.html"><span aria-hidden="true">&larr;</span> cbios.7: Provides open source bios rom files for msx computers</a></li>
   <li class="next"><a href="cenv.7.html">cenv.7: Cwnn environment operation functions. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
