<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>amanda-changers: Configuring and using amanda changers</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Configuring and using amanda changers">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="amanda-changers (7) manual">
  <meta name="twitter:description" content="Configuring and using amanda changers">
  <meta name="twitter:image" content="https://www.carta.tech/images/amanda-common-amanda-changers-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/amanda-changers.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="amanda-changers (7) manual" />
  <meta property="og:description" content="Configuring and using amanda changers" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/amanda-common-amanda-changers-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">amanda-changers<small> (7)</small></h1>
        <p class="lead">Configuring and using amanda changers</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/amanda-changers.7.html">
      <span itemprop="name">amanda-changers: Configuring and using amanda changers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/amanda-common/">
      <span itemprop="name">amanda-common</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/amanda-changers.7.html">
      <span itemprop="name">amanda-changers: Configuring and using amanda changers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Amanda uses changers to arbitrate access to devices (<a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a>) and data volumes. Changers provide an abstraction of tape robots, but are used to manage non-tape media, too. Amanda communicates with changers through the Changer API. This manpage contains a <em>user-level</em> overview of the API, and does not address details that are only of concern to developers. For that purpose, consult the Amanda source code and http://wiki.zmanda.com.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TRANSITION</h2>
        <div class="sectioncontent">
<p>The Amanda Changer API is in transition from version 1.0 - driven by shell scripts invoked for each changer operation - to version 2.0, composed of perl objects that can manage parallel access to multiple devices and other complexity. At this point, all Amanda programs use the new Changer API directly, although 1.0 changer scripts are still fully supported via chg-compat.</p><p>The Changer API strives to treat all changers identically, so that Amanda&apos;s behavior is independent of the changer in use. However, some parts of Amanda operate differently depending on whether a changer can efficiently search for a volume with a given label. This distinction is really only apparent with tape libraries: those with barcode readers can quickly find a desired tape, while those without may fall back to an inefficient scan of each volume. The capability to perform quick searches is called "fast-search", and each changer is annotated below to indicate its support.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SPECIFYING CHANGERS</h2>
        <div class="sectioncontent">
<p>Changer specifications are strings like chg-disk:/my/vtapes. The chg- prefix serves to differentiate changers from devices (see <a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a>). The next portion (disk, in this case) identifies the particular changer driver to use, and everything that follows the : is interpreted by the driver. Note that the : character is required, even when nothing follows it. This is an easy way to distinguish new changer specifications from old.</p><p>A name which does not match this pattern, but which matches an old changer script (e.g., chg-zd-mtx), invokes the backward-compatibility changer driver as e.g., chg-compat:chg-zd-mtx. If the name does not match an old changer, then it is treated as an Amanda device, and is wrapped by the single-device changer, e.g., chg-single:tape:/dev/rmt/0.</p><p>Changers which require additional parameters can also be described in <a href="../man5/amanda.conf.5.html"><strong>amanda.conf</strong>(5)</a> with "changer" sections. Such a changer defininition creates a changer "alias", in this case named <em>hp-robot</em>, which can then be named where an application expects a changer - for example, the target of the <strong>amvault</strong> command or in a global <strong>tpchanger</strong> parameter.</p><h3>CONFIGURATION</h3>
<p>The preferred method of specifying configuration for a changer is as a "changer" section in <a href="../man5/amanda.conf.5.html"><strong>amanda.conf</strong>(5)</a>. The <em>tapedev</em> parameter then indicates, by name, the changer that will be used by default by most Amanda programs. For example:</p>
<pre>
define changer hp-robot {
    tapedev "chg-robot:/dev/sg1"
    property "tape-device" "0=tape:/dev/nst0"
    property append "tape-device" "1=tape:/dev/nst1"
    device-property "BLOCK_SIZE" "512k"
}
# ...
tapedev "hp-robot"
</pre>
<p>Several changer drivers accept <em>changer properties</em> which control the behavior of the changer. These properties must be specified in a changer definition, as in the <em>hp-robot</em> example, above.</p><p>Devices, too, can take properties to control their behavior (see <a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a>). Device properties can come from four places: implicit device properties (from tapetype parameters), global device properties (from global <em>device-property</em> parameters), properties in device definitions, and properties in changer definitions. Properties are applied in this order, with later properties taking priority.</p><p>There are only three implicit properties: <em>MAX_VOLUME_USAGE</em> is set based on the tapetype <em>length</em> parameter, <em>READ_BLOCK_SIZE</em> is set if <em>readblocksize</em> is set, and <em>BLOCK_SIZE</em> is set based on the <em>blocksize</em> parameter.</p><p>Global device properties always apply. If the changer specifies a device by alias, then device properties from the definition apply. If the changer is specified by an alias, then properties from that definition applied.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CHANGER DRIVERS</h2>
        <div class="sectioncontent">
<p>This section lists the changer drivers included with Amanda, and basic instructions for using them. For complete How-To information, consult the Amanda wiki at http://wiki.zmanda.com.</p><h3>chg-aggregate:changer (new)</h3>

<pre>
define changer robot0 {
  tpchanger "chg-robot:/dev/sg0"
  property "tape-device" "0=tape:/dev/rmt/0" "1=tape:/dev/rmt/1"
}
define changer robot1 {
  tpchanger "chg-robot:/dev/sg1"
  property "tape-device" "0=tape:/dev/rmt/2" "1=tape:/dev/rmt/3"
}
define changer single {
  tpchanger "chg-single:/dev/rmt/4"
}
define changer aggregate {
  tpchanger "chg-aggregate:{robot0,robot1,single}"
  property "state-filename" "/etc/amanda/CONF/aggregate.state"

}
tpchanger "aggregate"
</pre>
<p>This changer driver allow to use two or more changers or standalone drive in sequence.</p>
<h3>Properties</h3>
<p>LOCK-TIMEOUT</p><p>The time in seconds amanda wait to lock the statefile (default:1000)</p><p>STATE_FILENAME</p><p>The name of the state file (default: "$CONFIG_DIR/$changer_name.state".</p>
<h3>chg-disk:VTAPEROOT (new)</h3>

<pre>
tpchanger "chg-disk:/var/mnt/vtapes"
property "num-slot" "10"
property "auto-create-slot" "yes"
property "removable" "yes"
property "mount" "yes"
property "umount" "yes"
property "umount-lockfile" "/etc/amanda/conf/vtapes-lock"
property "umount-idle" "1"
</pre>
<p>This changer driver replaces the old <strong>chg-disk</strong>, supporting parallel access to vtapes stored in directories named slotN in the directory specified after chg-disk:. It does so by creating numbered "drives" so that simultaneous processes can access distinct slots. This changer is fast-search capable.</p><p>The current slot can be accessed using the device name file:VTAPEROOT. This is useful for the <a href="../man8/amrestore.8.html"><strong>amrestore</strong>(8)</a> command line.</p>
<h3>Properties</h3>
<p>AUTO-CREATE-SLOT</p><p>If a slotN directory in the range 1 to NUM-SLOT does not already exist, and this property is true, then the changer will create the directory.</p><p>LOCK-TIMEOUT</p><p>The time in seconds amanda wait to lock the statefile (default:1000)</p><p>MOUNT</p><p>If this property is true, the changer try to mount the removable disk if nothing is mounted. The system must be configured to allow the amanda user to mount it.</p><p>NUM-SLOT</p><p>The minimum number of slots in the changer, where the first slot is slot1.  If additional slot directories exist, they will also be used.</p><p>REMOVABLE</p><p>If this property is true, then the changer will verify that the changer directory (e.g., /var/mnt/vtapes) is on a different filesystem from its parent directory (e.g., /var/mnt). This is useful for removable disks, as it will prevent Amanda from creating slot directories when the removable disk is not mounted.</p><p>UMOUNT</p><p>If this property is true, the changer try to umount the removable disk when it exit. The system must be configured to allow the amanda user to umount it.</p><p>UMOUNT-LOCKFILE</p><p>If UMOUNT is set, it require a lockfile outside of the mount point to prevent race.</p><p>UMOUNT-IDLE</p><p>If set, the changer try to umount the removable disk when it is not in use. The umount-idle value is a delay in second to wait before doing the umount. A value &gt;= 1 is required to prevent useless mount/umount.</p>
<h3>chg-disk (old)</h3>

<pre>
tapedev "file:/u01/vtapes"
tpchanger "chg-disk"
changerfile "chg-disk.conf"     # optional file
</pre>
<p>This changer script supports sequential access to vtapes stored in directories named slotN in the directory specified by the <em>tapedev</em> parameter. The configuration file parameter is:</p>
<pre>
LASTSLOT=number    # The number of slots, default to tapecycle setting.
</pre>
<p>This changer is not fast-search capable.</p>
<h3>chg-multi:DEVICE-LIST</h3>

<pre>
tpchanger "chg-multi:{/dev/nst0,/dev/nst1,/dev/nst2}"
changerfile "chg-multi-state"
</pre>
<p>This script simply round-robins a number of distinct device names, as specified in the <em>tpchanger</em> setting. It is useful when all volumes for a configuration have different device names -- for example, if you have many standalone drive. The <em>changerfile</em> must exist; it is used to save the state file.</p><p>The child devices are specified using the same syntax as for the RAIT device (see <a href="../man7/amanda-changers.7.html"><strong>amanda-changers</strong>(7)</a>). The range specification can be especially useful here:</p>
<pre>
tpchanger "chg-multi:s3:mycompany-backups/tape-{001..100}"
</pre>
<p>This changer is not fast-search capable.</p>
<h3>Properties</h3>
<p>FIRST-SLOT</p><p>This property gives the number of the first slot. The default value is "1".</p><p>LOCK-TIMEOUT</p><p>The time in seconds amanda wait to lock the statefile (default:1000)</p>
<h3>Special Operations</h3>
<p>A number of special operations are available for <strong>chg-multi</strong> via <a href="../man8/amtape.8.html"><strong>amtape</strong>(8)</a> subcommands.</p><p>The <strong>reset</strong> subcommand will change the current slot to the first available slot, but does not erase any stored state maintained by the changer.</p><p>The <strong>eject</strong> subcommand will eject the volume in the given drive</p><p>The <strong>clean</strong> subcommand is not yet implemented.</p><p>The <strong>update</strong> subcommand instructs the changer to update its state database. Given no arguments, the changer will scan all available slots, loading each tape and reading its label. Especially for large libraries, this can take a long time. If only a few slots have changed, they can be listed on the command line:</p>
<pre>
amtape CONFIG update 1-3,9
</pre>
<p>In this case, the changer will only scan the stated slots. Finally, the changer will not scan at all if it is given the tape label for the slot:</p>
<pre>
amtape CONFIG update 2=DailySet-028
</pre>
<p>In this case, the changer updates its state to indicate that DailySet-028 is in slot 2, without trying to load the tape.</p>
<pre>
amtape CONFIG update 1-3,9=
</pre>
<p>In this case, the changer marks the stated slots as an unknown state.</p>
<h3>chg-multi (old)</h3>

<pre>
tpchanger "chg-multi"
changerfile "chg-multi-state"
</pre>
<p>This script simply round-robins a number of distinct device names, as specified in its configuration file. It is useful when all volumes for a configuration have different device names -- for example, with S3 devices. The <em>changerfile</em> need not exist; it is used as a prefix for filenames of state files.</p><p>The configuration file has simple lines with a parameter and its value separated by a space. The # character introduces a comment. The configuration parameters are:</p><p>multieject</p><p>If this is 1, use an &apos;mt offline&apos; command to change to the next tape, or multiple such commands for skipping several tapes at a time.</p><p>needeject</p><p>This option is incompatible with &apos;multieject&apos;. This should be 1 for changers accessed through several virtual tape devices, when the changer needs the current tape to be ejected before changing to another device.</p><p>gravity</p><p>Set this to 1 if the changer/stacker is unable to loop back to the first tape after unloading the last one, or if you don&apos;t want amanda to go through the tape stack looking for the exact tape it wants instead of using the first acceptable one.</p><p>slot X</p><p>The configuration file should list as many &apos;slot X&apos; statements as the number of slots supported by the changer or the number of separate tape drives used.</p><p>This changer is not fast-search capable.</p>
<h3>chg-manual</h3>

<pre>
tpchanger "chg-manual"
changerfile "chg-manual.conf"
</pre>
<p>This script simply provides distinct device names in a round-robin fashion, as specified in its configuration file. It is useful when all volumes for a configuration have different device names -- for example, with S3 devices. The configuration file parameters are (as listed in the script):</p>
<pre>
resend_mail=900       # resend mail every __ seconds
timeout_mail=604800   # time out after this many seconds (default 7 days)
request="[type]"      # How to request a new tape (default "tty_email")
  request="tty"       # Use the tty to ask the user to change tape.
                      # Can&apos;t be use by cron
  request="email"     # Send an email to ask the user to change tape.
  request="tty_email" # Use the tty if it exist or send an email.
</pre>
<p>This changer is not fast-search capable.</p>
<h3>chg-zd-mtx (old)</h3>

<pre>
tpchanger "chg-zd-mtx"
changerdev "/dev/sg0"         # used with &apos;mtx -f&apos;
changerfile "chg-zd-mtx.conf"
tapedev "tape:/dev/nst0"
</pre>
<p>This script interfaces with a tape drive using the Zubkoff/Dandelion version of mtx. That&apos;s the version that takes a device specifier with the <strong>-f</strong> option and has subcommands like <strong>status</strong>. The configuration file parameters are (as listed in the script itself):</p>
<pre>
firstslot=?                 #### First storage slot (element)
lastslot=?                  #### Last storage slot (element)
cleanslot=-1                #### Slot with cleaner tape -- default is "-1"
                            #### Set negative to indicate no cleaner available
driveslot=0                 #### Drive slot number.  Defaults to 0
                            #### Use the &apos;Data Transfer Element&apos; you want
autoclean=0                 #### Set to &apos;1&apos; or greater to enable
autocleancount=99           #### Number of access before a clean.
havereader=0                #### If you have a barcode reader, set to 1.
offline_before_unload=0     #### Does your robot require an
                            #### &apos;mt offline&apos; before mtx unload?
poll_drive_ready=NN         #### Time (seconds) between tests to see if
                            #### the tape drive has gone ready (default: 3).
max_drive_wait=NN           #### Maximum time (seconds) to wait for the
                            #### tape drive to become ready (default: 120).
initial_poll_delay=NN       #### initial delay after load before polling for
                            #### readiness
slotinfofile=FILENAME       #### record slot information to this file, in
                            #### the line-based format "SLOT LABEL&#92;n"
</pre>
<p>This changer is fast-search capable if and only if <strong>havereader</strong> is true.</p>
<h3>chg-rait:{CHILD1,CHILD2,..}</h3>

<pre>
define changer vtape {
    tpchanger "chg-disk:/path/to/vtape"
}
define changer robot {
    tpchanger "chg-robot:/dev/sg0"
    tapedev "tape:/dev/nst0"
}
tpchanger "chg-rait:{vtape,robot}"
</pre>
<p>This changer script constructs RAIT devices out of the devices provided by several "sub-changers". The sub-changers are specified using the same shell-like syntax as the RAIT device (see <a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a>).</p><p>Chg-rait does not require that all of the child changers have the same slot names: compound slot names are created by combining the slot names supplied by the child changers using the same shell-like syntax. For example, if the child changers return slots "top", "strange", and "3", then the RAIT changer will return "{top,strange,3}". This makes it possible to, for example, mirror data on tapes in slots 1-10 to tapes in slots 11-20 of the same robot, using two <strong>chg-zd-mtx</strong> child changers (and, naturally, two tape drives). In this arrangement, the first slot would be named {1,11}.</p><p>As a convenience to the user, the RAIT changer will also accept un-braced slot names, and supply the same name to each child changer. Thus with a 4-device RAIT changer, "17" is equivalent to "{17,17,17,17}".</p><p>Drive names are parsed in a similar fashion, for operations that take drive names (clean and eject).</p><p>This changer is fast-search capable only if all of its child changers are fast-search capable.</p><p><strong>Note</strong></p><p>The old chg-rait script is no longer supported nor shipped with Amanda, although the old script will continue to function via <strong>chg-compat</strong>, giving users time to upgrade their configuration.</p>
<h3>chg-null:</h3>

<pre>
tpchanger "chg-null:"
</pre>
<p>This changer always provides the device "null:". It is sometimes useful in conjunction with <strong>chg-rait:</strong>.</p>
<h3>chg-robot:DEVICE</h3>

<pre>
define changer robot {
    tpchanger "chg-robot:/dev/sg0"
    property "tape-device" "0=tape:/dev/rmt/0" "1=tape:/dev/rmt/1"
    property "eject-before-unload" "yes"
    property "use-slots" "1-5,11-20"
}
tpchanger "robot"
</pre>
<p>This changer drives a robotic tape library using the operating system&apos;s <strong>mtx</strong> command. It replaces the ancient <strong>chg-zd-mtx</strong> script. The changer uses all of the information available to operate as efficiently as possible. Even without a barcode reader, the changer can usually load a tape immediately, without resorting to a sequential scan of many tapes. It is capable of sharing state across multiple Amanda configurations, avoiding conflicts and optimally tracking the contents of the library.</p><p>This changer does not accept a <strong>changerdev</strong> parameter, but the <strong>changerfile</strong> parameter can be used to specify a filename at which it should store its state. Ordinarily, this state is stored in a file named after the changer device under <em>$localstatedir/amanda</em>, e.g., <strong>/var/amanda/chg-robot-dev-sg0</strong>. There should be a single such statefile for each distinct tape library attached to the Amanda server, even if multiple Amanda configurations reference that library.</p><p>With a barcode reader present, it is possible for <strong>chg-robot</strong> to track the state of the library reliably, even recognizing tapes that are removed and later re-inserted (by remembering their barcodes). Without barcodes, the changer can still remember the slot in which it last saw the tape with a particular label, although this information can become stale if the tapes are rearranged by an operator. In any case, the changer will never "hunt" for a tape by repeatedly loading slots and checking labels. If the changer&apos;s state is inaccurate, use the <a href="../man8/amtape.8.html"><strong>amtape</strong>(8)</a> subcommand <strong>update</strong>.</p><p>This changer is fast-search capable even without a barcode reader. For such libraries, it is the responsibility of the operator to <strong>update</strong> the changer when tapes are added to or removed from the library.</p><p>There is a shell script in the contrib/ directory of Amanda&apos;s source distribution which can help you convert a <strong>chg-zd-mtx</strong> configuration into a <strong>chg-robot</strong> configuration. Just give it your Amanda configuration name:</p>
<pre>
  sh contrib/convert-zd-mtx-to-robot.sh $config
</pre>
<p>The script can be downloaded at http://github.com/zmanda/amanda/raw/master/contrib/convert-zd-mtx-to-robot.sh</p>
<h3>Special Operations</h3>
<p>A number of special operations are available for <strong>chg-robot</strong> via <a href="../man8/amtape.8.html"><strong>amtape</strong>(8)</a> subcommands.</p><p>The <strong>reset</strong> subcommand will change the current slot to the first available slot, but does not erase any stored state maintained by the changer.</p><p>The <strong>eject</strong> subcommand will unload the volume in the given drive, ejecting first if the changer properties dictate. Note that, despite the subcommand name, the changer attempts to avoid the state where a volume has been ejected from the drive but not unloaded back to a storage slot.</p><p>The <strong>clean</strong> subcommand is not yet implemented.</p><p>The <strong>update</strong> subcommand instructs the changer to update its state database. Given no arguments, the changer will scan all available slots, loading each tape and reading its label. Especially for large libraries, this can take a long time. If only a few slots have changed, they can be listed on the command line:</p>
<pre>
amtape CONFIG update 1-3,9
</pre>
<p>In this case, the changer will only scan the stated slots. Finally, the changer will not scan at all if it is given the tape label for the slot:</p>
<pre>
amtape CONFIG update 2=DailySet-028
</pre>
<p>In this case, the changer updates its state to indicate that DailySet-028 is in slot 2, without trying to load the tape.</p>
<pre>
amtape CONFIG update 1-3,9=
</pre>
<p>In this case, the changer marks the stated slots as an unknown state.</p>
<h3>Properties</h3>
<p>DRIVE-CHOICE</p><p>This property controls the algorithm used to select a drive in which to load a tape.  If set to the default ("lru"), the changer attempts to use the least recently used drive, resulting in a round-robin behavior.  The "firstavail" algorithm selects the first available drive, thus preferring the first drive specified via the TAPE-DEVICE property.</p><p>EJECT-BEFORE-UNLOAD</p><p>Set this boolean property to true if the library requires an <strong>offline</strong> operation be performed on the tape drive before it can be unloaded.  If set, then <strong>mt</strong> will be invoked to perform this operation.  Most libraries do not require this workaround.</p><p>EJECT-DELAY</p><p>This is the time between ejecting a tape and unloading the volume to a storage slot, and defaults to 0 seconds.  It is only used if EJECT-BEFORE-UNLOAD is true.  See "Timing", below.</p><p>FAST-SEARCH</p><p>This boolean property indicates whether the changer advertises the ability to find volumes without sequential scanning.  The traditional taperscan algorithm alters its behavior based on this flag, so it is sometimes necessary to adjust it, although the changer will always search for a desired tape using the most efficient means available.  The default value is true.</p><p>IGNORE-BARCODES</p><p>If this boolean property is true, then chg-robot will ignore any barcode information that the library provides.  This property is probably only useful when the library returns incorrect barcodes, for example due to a malfunction in the barcode reader.</p><p>LOAD-POLL</p><p>This property specifies the timing of Amanda&apos;s polling for the tape drive to be ready after loading a new tape. See "Timing", below.</p><p>The script "polls" by trying to open the tape device repeatedly until no error is encountered. The property specifies the time to wait before the first poll (D), the frequency at which to poll and retry on errors (P); and the time after which it should give up (U). The format is</p>
<pre>
"D [poll P [until U]]"
</pre>
<p>For a simple delay with no polling, use e.g.,</p>
<pre>
property "load-poll" "13s"
</pre>
<p>To delay and then poll, use e.g.,</p>
<pre>
property "load-poll" "13s poll 5s"
</pre>
<p>and to add a maximum total time, use e.g.,</p>
<pre>
property "load-poll" "0s poll 5s until 2m"
</pre>
<p>The default value is <strong>"0s poll 3s until 2m"</strong>.</p><p>LOCK-TIMEOUT</p><p>The time in seconds amanda wait to lock the statefile (default:1000)</p><p>MTX</p><p>The path to the &apos;mtx&apos; binary.  The default value is defined at compile time.</p><p>STATUS-INTERVAL</p><p>This is the minimum time between invocations of <strong>mtx status</strong> to determine the state of the changer library.  The default value, 2 seconds, avoids back-to-back status invocations but ensures that the metadata is up to date.  For operating systems or libraries where the <strong>mtx</strong> status takes a considerable time to complete, this value should be increased.  See "Timing", below.</p><p>TAPE-DEVICE</p><p>This property describes the correspondance of drive numbers in the library to Amanda devices, in the format <em>DRIVE=DEVICE</em>.  The property can be specified multiple times to describe multiple devices.  The device will usually be a tape device name starting with <strong>tape:</strong>, but may also refer to a device alias (see <a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a>). As a shortcut, if the <strong>tapedev</strong> parameter is specified in the changer definition, then it is assumed to be the device name for drive 0.</p><p>UNLOAD-DELAY</p><p>This specifies the minimum time between an unload operation any any subsequent operation.  The default value is 0 seconds.  See "Timing", below.</p><p>USE-SLOTS</p><p>This property, if specifies, enumerates the slots to which this changer should limit itself.  The slots are specified as a comma-separated list of ranges, e.g., "1-5,11-15,19,22".  The property can be specified more than once, and the resulting sets will be combined.  The changer will refuse to load tapes not found in these slots, except for import/export purposes.</p>
<h3>Timing</h3>
<p>Tape libraries are fickle, and in many cases will report that an operation is complete when it is still in progress. Chg-robot takes several timing-related properties to accommodate such behavior.</p><p>A typical sequence of operations performed during a load are: get library status, eject a tape, unload the tape back to a storage slot, load a new tape, and read the label on that tape to ensure the drive is ready.</p><p>On most systems, the library status check is nearly instantaneous -- the changer library provides its cached state to the host without initiating any robot motion. In order to keep its metadata up-to-date, chg-robot runs this command very frequently, but this frequency can be reduced (at the cost of potentially stale metadata) by setting the STATUS-INTERVAL property to a larger value.</p><p>Some tape libraries do not integrate the eject operation (performed by the embedded tape drive) with the unload operation (performed by the library robot), and can actually cause physical damage by attempting to remove the tape before the ejection is complete. For such changers, set the EJECT-DELAY property to allow enough time for the eject to complete.</p><p>Once a tape is unloaded, if the library needs time to "quiesce" before processing another command, add that time to the UNLOAD-DELAY parameter. No other operations will be performed on the library until this delay has elapsed.</p><p>Once a tape has been loaded, chg-robot waits until the drive is ready before allowing Amanda to use the volume, as described for LOAD-POLL, above.</p><p>Each of the times specified in these properties may be given as integers with the optional suffix <strong>s</strong> for seconds (the default) or <strong>m</strong> for minutes.</p>
<h3>chg-ndmp:HOST[:PORT]@SCSIDEV</h3>

<pre>
    tpchanger "chg-ndmp:filer.company.com@/dev/sg0"
    property        "tape-device" "0=ndmp:filer.company.com@/dev/rtape0"
    property append "tape-device" "1=ndmp:filer.company.com@/dev/rtape1"
    property "use-slots" "1-12"
    property "ndmp-auth" "text"
    property "ndmp-username" "luke"
    property "ndmp-password" "leia"
</pre>
<p>This changer is very similar to <strong>chg-robot</strong>, but controls a tape changer on an NDMP server instead of a local device. The <strong>HOST</strong> in the <strong>tpchanger</strong> should be the hostname of the NDMP server. The <strong>PORT</strong> is optional. The <strong>SCSIDEV</strong> should specify the SCSI device on the NDMP server which controls the changer. The format of this parameter is implementation-specific.</p><p>The appropriate authentication properties will be automatically set on any devices created by this changer.</p>
<h3>Properties</h3>
<p>This changer supports all of the properties supported by <strong>chg-robot</strong>, although the value of <strong>MTX</strong> is ignored. The following properties are also recognized:</p><p>NDMP_AUTH</p><p>Authentication method to use to connect to the NDMP server.  One of "md5" (default), "text", "none" (for an empty authentication attempt) or "void" (for no authentication attempt at all).</p><p>NDMP-PASSWORD</p><p>The password for the NDMP server.</p><p>NDMP-USERNAME</p><p>The username for the NDMP server.</p><p>VERBOSE</p><p>If true, enables the NDMJOB library&apos;s verbose (packet-level) debugging.</p>
<h3>chg-single:DEVICE</h3>

<pre>
tpchanger "chg-single:tape:/dev/nst0"
</pre>
<p>This changer is for use with standalone drive, it can work with any device. The device (<strong>tape:/dev/nst0</strong>) must be set in the tpchanger definition.</p><p>The <strong>chg-single</strong> changer has no property.</p>
<h3>Unmaintained Changers</h3>
<p>Amanda has many other changer scripts and programs beyond those described here (see the changer-src/ in the source directory), but most of these scripts are unmaintained and undocumented, and will be removed when the new changer API is fully implemented.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO amanda-changers&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/amanda.8.html"><strong>amanda</strong>(8)</a>, <a href="../man5/amanda.conf.5.html"><strong>amanda.conf</strong>(5)</a>, <a href="../man7/amanda-devices.7.html"><strong>amanda-devices</strong>(7)</a></p><p>The Amanda Wiki: : http://wiki.zmanda.com/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Dustin J. Mitchell</strong> &lt;dustin@zmanda.com&gt;</p><p>Zmanda, Inc. (http://www.zmanda.com)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="amanda-auth.7.html"><span aria-hidden="true">&larr;</span> amanda-auth.7: Communication/authentication methods between amanda server and client</a></li>
   <li class="next"><a href="amanda-compatibility.7.html">amanda-compatibility.7: Compatibility between amanda versions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
