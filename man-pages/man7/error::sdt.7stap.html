<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>error::sdt: Sys/sdt.h marker failures</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Sys/sdt.h marker failures">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="error::sdt (7stap) manual">
  <meta name="twitter:description" content="Sys/sdt.h marker failures">
  <meta name="twitter:image" content="https://www.carta.tech/images/systemtap-doc-error::sdt-7stap.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7stap/error::sdt.7stap.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="error::sdt (7stap) manual" />
  <meta property="og:description" content="Sys/sdt.h marker failures" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/systemtap-doc-error::sdt-7stap.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">error::sdt<small> (7stap)</small></h1>
        <p class="lead">Sys/sdt.h marker failures</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7stap/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7stap/error::sdt.7stap.html">
      <span itemprop="name">error::sdt: Sys/sdt.h marker failures</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/systemtap-doc/">
      <span itemprop="name">systemtap-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7stap/error::sdt.7stap.html">
      <span itemprop="name">error::sdt: Sys/sdt.h marker failures</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Systemtap's <strong>&lt;sys/sdt.h&gt;</strong> probes are modeled after the dtrace USDT API, but are implemented differently.  They leave a only a NOP instruction in the userspace program's text segment, and add an ELF note to the binary with metadata.  This metadata describes the marker's name and parameters. This encoding is designed to be parseable by multiple tools (not just systemtap: GDB, the GNU Debugger, also contains support).  These allow the tools to find parameters and their types, wherever they happen to reside, even without DWARF debuginfo.</p><p>The reason finding parameters is tricky is because the STAP_PROBE / DTRACE_PROBE markers store an assembly language expression for each operand, as a result of use of gcc inline-assembly directives.  The compiler is given a broad gcc operand constraint string ("nor") for the operands, which usually works well.  Usually, it does not force the compiler to load the parameters into or out of registers, which would slow down an instrumented program.  However, some instrumentation sites with some parameters do not work well with the default "nor" constraint.</p>
<dl class='dl-vertical'>
  <dt>
    <p>unresolveable at run-time</p>
  </dt>
  <dd>
    <p>GCC may emit strings that an assembler could resolve (from the context of compiling the original program), but a run-time tool cannot.  For example, the operand string might refer to a label of a local symbol that is not emitted into the ELF object file at all, which leaves no trace for the run-time.  Reference to such parameters from within systemtap can result in "SDT asm not understood" errors.</p>
  </dd>
  <dt>
    <p>too complicated expression</p>
  </dt>
  <dd>
    <p>GCC might synthesize very complicated assembly addressing modes from complex C data types / pointer expressions.  systemtap or gdb may not be able to parse some valid but complicated expressions.  Reference to such parameters from within systemtap can result in "SDT asm not understood" errors.</p>
  </dd>
  <dt>
    <p>overly restrictive constraint</p>
  </dt>
  <dd>
    <p>GCC might not be able to even compile the original program with the default "nor" constraint due to shortage of registers or other reasons.  A compile-time gcc error such as "asm operand has impossible constraints" may result.</p>
  </dd>

</dl>
<p>There are two general workarounds to this family of problems.</p>
<dl class='dl-vertical'>
  <dt>
    <p>change the constraints</p>
  </dt>
  <dd>
    <p>While compiling the original instrumented program, set the <em>STAP_SDT_ARG_CONSTRAINT</em> macro to different constraint strings.  See the GCC manual about various options.  For example, on many machine architectures, "r" forces operands into registers, and "g" leaves operands essentially unconstrained.</p>
  </dd>
  <dt>
    <p>revert to debuginfo</p>
  </dt>
  <dd>
    <p>As long as the instrumented program compiles, it may be fine simply to keep using &lt;sys/sdt.h&gt; but eschew extraction of a few individual parameters.  In the worst case, disable &lt;sys/sdt.h&gt; macros entirely to eschew the compiled-in instrumentation.  If DWARF debuginfo was generated and preserved, a systemtap script could refer to the underlying source context variables instead of the positional STAP_PROBE parameters.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO error::sdt&hellip;</h2>
        <div class="sectioncontent">

<pre>
<a href="../man1/stap.1.html"><strong>stap</strong>(1)</a>,
<em>stapprobes</em>(3stap),
<em>error::dwarf</em>(7stap),
<em>http://gcc.gnu.org/onlinedocs/gcc/Constraints.html</em>,
<em>http://sourceware.org/systemtap/wiki/UserSpaceProbeImplementation</em>,
<em>error::reporting</em>(7stap)
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="error::reporting.7stap.html"><span aria-hidden="true">&larr;</span> error::reporting.7stap: Systemtap error reporting</a></li>
   <li class="next"><a href="warning::debuginfo.7stap.html">warning::debuginfo.7stap: Systemtap missing-debuginfo warnings <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
