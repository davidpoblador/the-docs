<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>roartut: Roaraudio sound library developer tutorial</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Roaraudio sound library developer tutorial">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="roartut (7) manual">
  <meta name="twitter:description" content="Roaraudio sound library developer tutorial">
  <meta name="twitter:image" content="https://www.carta.tech/images/libroar-dev-roartut-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/roartut.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="roartut (7) manual" />
  <meta property="og:description" content="Roaraudio sound library developer tutorial" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libroar-dev-roartut-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">roartut<small> (7)</small></h1>
        <p class="lead">Roaraudio sound library developer tutorial</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/roartut.7.html">
      <span itemprop="name">roartut: Roaraudio sound library developer tutorial</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libroar-dev/">
      <span itemprop="name">libroar-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/roartut.7.html">
      <span itemprop="name">roartut: Roaraudio sound library developer tutorial</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This tutorial descipes some basics with working with libroar. We will create a simple application that can play a file and one that can play some sines. A lot of other examples can be found in RoarAudio's sources in the roarclients directory.</p><p>This tutorial will cover some basics of the so called VS API. The VS API is a abstract layer ontop of the normal API. It is designed to be simple yet powerful. The VS API is all you need for most applications. If you need more control over what you do you must use the normal. If you need only a little of those extra power you can mix VS API and normal API.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PLAYING A FILE</h2>
        <div class="sectioncontent">
<p>Playing back a file is a easy task with libroar. The VS API has some special support to play back files in a very simple way. This is shown here.</p><p>First of all we need to include the needed header files:  #include &lt;roaraudio.h&gt;  /* libroar */</p><p>This main header already includes all we need to use the VS API.</p><p>Now we can start our main(). We need to declare a object for the VS API as it is object oriented. This object is used to interact with the server and send all audio data to it:  roar_vs_t * vss;  int err; /* see later */</p><p>Next we need to open the connection to the server. The most simple function to do this is <a href="../man3/roar_vs_new_from_file.3.html"><strong>roar_vs_new_from_file</strong>(3)</a> if we are going to play a file. It takes the folloing arguments:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>server address</strong></p>
  </dt>
  <dd>
    <p>This is the address of the server. In general case This should be set to NULL.</p>
  </dd>
  <dt>
    <p><strong>program name</strong></p>
  </dt>
  <dd>
    <p>This is the name of our program. This should be set to some name the user will recognize like "some App", "some Game". It <strong>should not</strong> contain the filename of the process like "/usr/bin/someapp.bin".</p>
  </dd>
  <dt>
    <p><strong>file name</strong></p>
  </dt>
  <dd>
    <p>This is the name of the file we want to play. In fact this is a URL. VS API uses so called DSTR API to open files. DSTR API supports local files as well as for example HTTP. Examples include: "somefile.ogg", "file:///data/bla.wav", "http://radiostation.org:8000/bla.ogg".</p>
  </dd>
  <dt>
    <p><strong>error var</strong></p>
  </dt>
  <dd>
    <p>This is a pointer to a int used to store the error value in case of error. This can be set to NULL but should not. The function <a href="../man3/roar_vs_strerr.3.html"><strong>roar_vs_strerr</strong>(3)</a> can be used to get a lion readable string of the error.</p>
  </dd>

</dl>
<p>Our call to <a href="../man3/roar_vs_new_from_file.3.html"><strong>roar_vs_new_from_file</strong>(3)</a> will look like this:  vss = roar_vs_new_from_file(NULL, "some App", "somefile.ogg", &err);  if ( vss == NULL ) {</p>
<pre>
  roar_vio_printf(roar_stderr, "Error: Can not connect to server: %s\n", roar_vs_strerr(err));
  return 1;
</pre>
<p> }</p><p>Next we need to continuously feed in the data so the server can do the playback. Again most simple way is to use <a href="../man3/roar_vs_run.3.html"><strong>roar_vs_run</strong>(3)</a>.</p><p> if ( roar_vs_run(vss, &err) == -1 ) {</p>
<pre>
  roar_vio_printf(roar_stderr, "Error: can not loop: %s\n", roar_vs_strerr(err));
</pre>
<p> }</p><p>This will block untill all of the file is played.</p><p>After it returned must close the VS object. This should be done directly after <a href="../man3/roar_vs_run.3.html"><strong>roar_vs_run</strong>(3)</a> returned. This is done this way:  if ( roar_vs_close(vss, ROAR_VS_FALSE, &err) == -1 ) {</p>
<pre>
  roar_vio_printf(roar_stderr, "Error: Can not close connection to server: %s\n", roar_vs_strerr(err));
  return 1;
</pre>
<p> }</p><p>After adding some standard main() construct we should have something like this:  //vsfile.c:</p><p> #include &lt;roaraudio.h&gt;</p><p> int main (void) {</p>
<pre>
  roar_vs_t * vss;
  int err; /* see later */
</pre>

<pre>
  vss = roar_vs_new_from_file(NULL, "some App", "somefile.ogg", &err);
  if ( vss == NULL ) {
   roar_vio_printf(roar_stderr, "Error: Can not connect to server: %s\n", roar_vs_strerr(err));
   return 1;
  }
</pre>

<pre>
  if ( roar_vs_run(vss, &err) == -1 ) {
   roar_vio_printf(roar_stderr, "Error: can not loop: %s\n", roar_vs_strerr(err));
  }
</pre>

<pre>
  if ( roar_vs_close(vss, ROAR_VS_FALSE, &err) == -1 ) {
   roar_vio_printf(roar_stderr, "Error: Can not close connection to server: %s\n", roar_vs_strerr(err));
   return 1;
  }
</pre>

<pre>
  return 0;
</pre>
<p> }</p><p> //ll</p><p>To compile and link we can use a command like this one:  cc -o vsfile vsfile.c `roar-config --libs --cflags`</p><p>The tool <a href="../man1/roar-config.1.html"><strong>roar-config</strong>(1)</a> will keep care for us about all flags needed for libroar.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PLAYING A SINE</h2>
        <div class="sectioncontent">
<p>Now we want to write a application playing a sine for some secs. We start the same way by including the correct header files:  #include &lt;math.h&gt;       /* sin() */  #include &lt;roaraudio.h&gt;  /* libroar */</p><p>After that we need some basic varibales with data about the audio we want to play back:  int rate     = ROAR_RATE_DEFAULT;  int bits     = 16;  int channels =  1; /* mono */</p><p>Next we need to set the 'codec'. The codec is how the data is encoded. We want PCM as signed ints in the native byte order of our machine.  int codec    = ROAR_CODEC_DEFAULT;</p><p>Now we need to store the frequency of our sine:  float freq = 523.2;            /* middle C */  float step = M_PI*2*freq/rate; /* how much time per sample we have to encode ... */</p><p>In addition we need some variables to store the current time and the length of time sine:  float t      = 0; /* current time */  float length = 5; /* 5 sec */</p><p>Next we need the buffer to hold the data as well as a varible used to go thru the buffer on generation of data.  int16_t out[1024];  int i;</p><p>last we need the VS object again as well as our error var:  roar_vs_t * vss;  int err;</p><p>This time we open the connection to the server using <a href="../man3/roar_vs_new_playback.3.html"><strong>roar_vs_new_playback</strong>(3)</a>. It is similar to <a href="../man3/roar_vs_new_from_file.3.html"><strong>roar_vs_new_from_file</strong>(3)</a> but takes some other options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>server address</strong></p>
  </dt>
  <dd>
    <p>Same as above.</p>
  </dd>
  <dt>
    <p><strong>program name</strong></p>
  </dt>
  <dd>
    <p>same as above.</p>
  </dd>
  <dt>
    <p><strong>sample rate</strong></p>
  </dt>
  <dd>
    <p>The number of audio frames per sec.</p>
  </dd>
  <dt>
    <p><strong>channels</strong></p>
  </dt>
  <dd>
    <p>The number of samples (one per channel) per audio frame.</p>
  </dd>
  <dt>
    <p><strong>codec</strong></p>
  </dt>
  <dd>
    <p>The codec to be used. This is one of ROAR_CODEC_*. In our case we use ROAR_CODEC_DEFAULT which is signed PCM in CPU native format.</p>
  </dd>
  <dt>
    <p><strong>bits</strong></p>
  </dt>
  <dd>
    <p>The number of bits per sample.</p>
  </dd>
  <dt>
    <p><strong>error var</strong></p>
  </dt>
  <dd>
    <p>same as above.</p>
  </dd>

</dl>
<p>The call looks like this:  vss = roar_vs_new_playback(NULL, "vssin", rate, channels, codec, bits, &err);  if ( vss == NULL ) {</p>
<pre>
  roar_vio_printf(roar_stderr, "Error: Can not connect to server: %s\n", roar_vs_strerr(err));
  return 1;
</pre>
<p> }</p><p>Now we want to loop for <strong>length</strong> seconds:  while (t &lt; 2*M_PI*freq*length) {  }</p><p>In this loop we need to calculate our samples:</p>
<pre>
  for (i = 0; i &lt; (sizeof(out)/sizeof(*out)); i++) {
   out[i] = 32767.f*sin(t);
   t += step;
  }
</pre>
<p>The sine is multiplyed by 32767 as our amplitude range for 16 bit signed int is from -32768 to +32767.</p><p>After we have our current data in <strong>out</strong> we want to write them to the server:</p>
<pre>
  if ( roar_vs_write(vss, out, sizeof(out), &err) == -1 ) {
   roar_vio_printf(roar_stderr, "Error: Can not write audio data to server: %s\n", roar_vs_strerr(err));
   break;
  }
</pre>
<p><strong>NOTE:</strong> In a real application you may want to check the return value for short writes: Those are writes shorter than the requested amount of data to be written. If you got any short writes you should try to rewrite the rest of your buffer later. This is not a error case.</p><p>After we are finished with our main loop we have to close the connection to the server. This is done by <a href="../man3/roar_vs_close.3.html"><strong>roar_vs_close</strong>(3)</a> as we already done in the file playback example:  if ( roar_vs_close(vss, ROAR_VS_FALSE, &err) == -1 ) {</p>
<pre>
  roar_vio_printf(roar_stderr, "Error: Can not close connection to server: %s\n", roar_vs_strerr(err));
  return 1;
</pre>
<p> }</p><p>After adding some standard main() construct we should have something like this:  //vssin.c:</p><p> #include &lt;roaraudio.h&gt;  #include &lt;math.h&gt;</p><p> int main (void) {</p>
<pre>
  roar_vs_t * vss;
  int rate     = ROAR_RATE_DEFAULT;
  int bits     = 16;
  int channels =  1; /* mono */
  int codec    = ROAR_CODEC_DEFAULT;
  float freq = 523.2;            /* middle C */
  float step = M_PI*2*freq/rate; /* how much time per sample we have to encode ... */
  float t      = 0; /* current time */
  float length = 5; /* 5 sec */
  int16_t out[1024];
  size_t i;
  int err;
</pre>

<pre>
  vss = roar_vs_new_playback(NULL, "vssin", rate, channels, codec, bits, &err);
  if ( vss == NULL ) {
   roar_vio_printf(roar_stderr, "Error: Can not connect to server: %s\n", roar_vs_strerr(err));
   return 1;
  }
</pre>

<pre>
  while (t &lt; 2*M_PI*freq*length) {
   for (i = 0; i &lt; (sizeof(out)/sizeof(*out)); i++) {
    out[i] = 32768.f*sin(t);
    t += step;
   }
</pre>

<pre>
   if ( roar_vs_write(vss, out, sizeof(out), &err) == -1 ) {
    roar_vio_printf(roar_stderr, "Error: Can not write audio data to server: %s\n", roar_vs_strerr(err));
    break;
   }
  }
</pre>

<pre>
  if ( roar_vs_close(vss, ROAR_VS_FALSE, &err) == -1 ) {
   roar_vio_printf(roar_stderr, "Error: Can not close connection to server: %s\n", roar_vs_strerr(err));
   return 1;
  }
</pre>

<pre>
  return 0;
</pre>
<p> }</p><p> //ll</p><p>To compile and link we can use a command like this one:  cc -o vssin vssin.c -lm `roar-config --libs --cflags`</p><p>We need to use <strong>-lm</strong> to link the math library for <strong>sin()</strong>. The tool <a href="../man1/roar-config.1.html"><strong>roar-config</strong>(1)</a> will keep care for us about all flags needed for libroar.</p><p>Now we should have a working binary <strong>vssin</strong> playing a sin() for 5 sec.</p><p>Happy hacking!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO roartut&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/roar-config.1.html"><strong>roar-config</strong>(1)</a>, <a href="../man1/roarcat.1.html"><strong>roarcat</strong>(1)</a>, <a href="../man7/libroar.7.html"><strong>libroar</strong>(7)</a>. <a href="../man7/RoarAudio.7.html"><strong>RoarAudio</strong>(7)</a>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="roartips.7.html"><span aria-hidden="true">&larr;</span> roartips.7: Tips for roaraudio users</a></li>
   <li class="next"><a href="roarvio.7.html">roarvio.7: Roaraudio sound library  roarvio - roaraudio virtual io layer <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
