<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PREPARE_TRANSACTION: Prepare the current transaction for two-phase commit</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Prepare the current transaction for two-phase commit">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="PREPARE_TRANSACTION (7) manual">
  <meta name="twitter:description" content="Prepare the current transaction for two-phase commit">
  <meta name="twitter:image" content="https://www.carta.tech/images/postgresql-client-9.4-PREPARE_TRANSACTION-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/PREPARE_TRANSACTION.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PREPARE_TRANSACTION (7) manual" />
  <meta property="og:description" content="Prepare the current transaction for two-phase commit" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/postgresql-client-9.4-PREPARE_TRANSACTION-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">PREPARE_TRANSACTION<small> (7)</small></h1>
        <p class="lead">Prepare the current transaction for two-phase commit</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/PREPARE_TRANSACTION.7.html">
      <span itemprop="name">PREPARE_TRANSACTION: Prepare the current transaction for two-phase commit</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/postgresql-client-9.4/">
      <span itemprop="name">postgresql-client-9.4</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/PREPARE_TRANSACTION.7.html">
      <span itemprop="name">PREPARE_TRANSACTION: Prepare the current transaction for two-phase commit</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
PREPARE TRANSACTION <em>transaction_id</em>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>PREPARE TRANSACTION</strong> prepares the current transaction for two-phase commit. After this command, the transaction is no longer associated with the current session; instead, its state is fully stored on disk, and there is a very high probability that it can be committed successfully, even if a database crash occurs before the commit is requested.</p><p>Once prepared, a transaction can later be committed or rolled back with COMMIT PREPARED (<a href="../man7/COMMIT_PREPARED.7.html"><strong>COMMIT_PREPARED</strong>(7)</a>) or ROLLBACK PREPARED (<a href="../man7/ROLLBACK_PREPARED.7.html"><strong>ROLLBACK_PREPARED</strong>(7)</a>), respectively. Those commands can be issued from any session, not only the one that executed the original transaction.</p><p>From the point of view of the issuing session, <strong>PREPARE TRANSACTION</strong> is not unlike a <strong>ROLLBACK</strong> command: after executing it, there is no active current transaction, and the effects of the prepared transaction are no longer visible. (The effects will become visible again if the transaction is committed.)</p><p>If the <strong>PREPARE TRANSACTION</strong> command fails for any reason, it becomes a <strong>ROLLBACK</strong>: the current transaction is canceled.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PARAMETERS</h2>
        <div class="sectioncontent">
<p><em>transaction_id</em></p><p>An arbitrary identifier that later identifies this transaction for <strong>COMMIT PREPARED</strong> or <strong>ROLLBACK PREPARED</strong>. The identifier must be written as a string literal, and must be less than 200 bytes long. It must not be the same as the identifier used for any currently prepared transaction.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p><strong>PREPARE TRANSACTION</strong> is not intended for use in applications or interactive sessions. Its purpose is to allow an external transaction manager to perform atomic global transactions across multiple databases or other transactional resources. Unless you&apos;re writing a transaction manager, you probably shouldn&apos;t be using <strong>PREPARE TRANSACTION</strong>.</p><p>This command must be used inside a transaction block. Use <a href="../man7/BEGIN.7.html"><strong>BEGIN</strong>(7)</a> to start one.</p><p>It is not currently allowed to <strong>PREPARE</strong> a transaction that has executed any operations involving temporary tables, created any cursors WITH HOLD, or executed <strong>LISTEN</strong> or <strong>UNLISTEN</strong>. Those features are too tightly tied to the current session to be useful in a transaction to be prepared.</p><p>If the transaction modified any run-time parameters with <strong>SET</strong> (without the LOCAL option), those effects persist after <strong>PREPARE TRANSACTION</strong>, and will not be affected by any later <strong>COMMIT PREPARED</strong> or <strong>ROLLBACK PREPARED</strong>. Thus, in this one respect <strong>PREPARE TRANSACTION</strong> acts more like <strong>COMMIT</strong> than <strong>ROLLBACK</strong>.</p><p>All currently available prepared transactions are listed in the pg_prepared_xacts system view.</p><p><strong>Caution</strong></p><p>It is unwise to leave transactions in the prepared state for a long time. This will interfere with the ability of <strong>VACUUM</strong> to reclaim storage, and in extreme cases could cause the database to shut down to prevent transaction ID wraparound (see Section 23.1.5, &ldquo;Preventing Transaction ID Wraparound Failures&rdquo;, in the documentation). Keep in mind also that the transaction continues to hold whatever locks it held. The intended usage of the feature is that a prepared transaction will normally be committed or rolled back as soon as an external transaction manager has verified that other databases are also prepared to commit.</p><p>If you have not set up an external transaction manager to track prepared transactions and ensure they get closed out promptly, it is best to keep the prepared-transaction feature disabled by setting max_prepared_transactions to zero. This will prevent accidental creation of prepared transactions that might then be forgotten and eventually cause problems.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Prepare the current transaction for two-phase commit, using foobar as the transaction identifier:</p>
<pre>
PREPARE TRANSACTION &apos;foobar&apos;;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPATIBILITY</h2>
        <div class="sectioncontent">
<p><strong>PREPARE TRANSACTION</strong> is a PostgreSQL extension. It is intended for use by external transaction management systems, some of which are covered by standards (such as X/Open XA), but the SQL side of those systems is not standardized.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO PREPARE_TRANSACTION&hellip;</h2>
        <div class="sectioncontent">
<p>COMMIT PREPARED (<a href="../man7/COMMIT_PREPARED.7.html"><strong>COMMIT_PREPARED</strong>(7)</a>), ROLLBACK PREPARED (<a href="../man7/ROLLBACK_PREPARED.7.html"><strong>ROLLBACK_PREPARED</strong>(7)</a>)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="PREPARE.7.html"><span aria-hidden="true">&larr;</span> PREPARE.7: Prepare a statement for execution</a></li>
   <li class="next"><a href="REASSIGN_OWNED.7.html">REASSIGN_OWNED.7: Change the ownership of database objects owned by a database role <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
