<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>gammu-smsd-run: Documentation for runonreceive directive</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Documentation for runonreceive directive">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="gammu-smsd-run (7) manual">
  <meta name="twitter:description" content="Documentation for runonreceive directive">
  <meta name="twitter:image" content="https://www.carta.tech/images/gammu-smsd-gammu-smsd-run-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/gammu-smsd-run.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="gammu-smsd-run (7) manual" />
  <meta property="og:description" content="Documentation for runonreceive directive" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/gammu-smsd-gammu-smsd-run-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">gammu-smsd-run<small> (7)</small></h1>
        <p class="lead">Documentation for runonreceive directive</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/gammu-smsd-run.7.html">
      <span itemprop="name">gammu-smsd-run: Documentation for runonreceive directive</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/gammu-smsd/">
      <span itemprop="name">gammu-smsd</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/gammu-smsd-run.7.html">
      <span itemprop="name">gammu-smsd-run: Documentation for runonreceive directive</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Gammu SMSD can be configured by <strong>RunOnReceive</strong> directive (see <em>gammu-smsdrc</em> for details) to run defined program after receiving every message. It can receive single message or more messages, which are parts of one multipart message.</p><p>This parameter is executed through shell, so you might need to escape some special characters and you can include any number of parameters. Additionally parameters with identifiers of received messages are appended to the command line. The identifiers depend on used service backend, typically it is ID of inserted row for database backends or file name for file based backends.</p><p>Gammu SMSD waits for the script to terminate. If you make some time consuming there, it will make SMSD not receive new messages. However to limit breakage from this situation, the waiting time is limited to two minutes. After this time SMSD will continue in normal operation and might execute your script again.</p><p><strong>NOTE:</strong></p><p>All input and output file descriptors are closed when this program is invoked, so you have to ensure to open files on your own.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>program is executed with environment which contains lot of information about the message. You can use it together with NULL service (see <em>gammu-smsd-null</em>) to implement completely own processing of messages.</p><h3>Global variables</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>SMS_MESSAGES</strong></p>
  </dt>
  <dd>
    <p>Number of physical messages received.</p>
  </dd>
  <dt>
    <p><strong>DECODED_PARTS</strong></p>
  </dt>
  <dd>
    <p>Number of decoded message parts.</p>
  </dd>

</dl>

<h3>Per message variables</h3>
<p>The variables further described as <strong>SMS_1_...</strong> are generated for each physical message, where 1 is replaced by current number of message.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>SMS_1_CLASS</strong></p>
  </dt>
  <dd>
    <p>Class of message.</p>
  </dd>
  <dt>
    <p><strong>SMS_1_NUMBER</strong></p>
  </dt>
  <dd>
    <p>Sender number.</p>
  </dd>
  <dt>
    <p><strong>SMS_1_TEXT</strong></p>
  </dt>
  <dd>
    <p>Message text. Text is not available for 8-bit binary messages.</p>
  </dd>

</dl>

<h3>Per part variables</h3>
<p>The variables further described as <strong>DECODED_1_...</strong> are generated for each message part, where 1 is replaced by current number of part. Set are only those variables whose content is present in the message.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>DECODED_1_TEXT</strong></p>
  </dt>
  <dd>
    <p>Decoded long message text.</p>
  </dd>
  <dt>
    <p><strong>DECODED_1_MMS_SENDER</strong></p>
  </dt>
  <dd>
    <p>Sender of MMS indication message.</p>
  </dd>
  <dt>
    <p><strong>DECODED_1_MMS_TITLE</strong></p>
  </dt>
  <dd>
    <p>title of MMS indication message.</p>
  </dd>
  <dt>
    <p><strong>DECODED_1_MMS_ADDRESS</strong></p>
  </dt>
  <dd>
    <p>Address (URL) of MMS from MMS indication message.</p>
  </dd>
  <dt>
    <p><strong>DECODED_1_MMS_SIZE</strong></p>
  </dt>
  <dd>
    <p>Size of MMS as specified in MMS indication message.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<h3>Activating RunOnReceive</h3>
<p>To activate this feature you need to set <strong>RunOnReceive</strong> in the <em>gammu-smsdrc</em>.</p>
<pre>
[smsd]
RunOnReceive = /path/to/script.sh
</pre>

<h3>Processing messages from the files backend</h3>
<p>Following script (if used as <strong>RunOnReceive</strong> handler) passes message data to other program. This works only with the <em>gammu-smsd-files</em>.</p>
<pre>
#!/bin/sh
INBOX=/path/to/smsd/inbox
PROGRAM=/bin/cat
for ID in "$@" ; do
    $PROGRAM &lt; $INBOX/$ID
done
</pre>

<h3>Passing message text to program</h3>
<p>Following script (if used as <strong>RunOnReceive</strong> handler) passes message text and sender to external program.</p>
<pre>
#!/bin/sh
PROGRAM=/bin/echo
for i in \(gaseq $SMS_MESSAGES\(ga ; do
    eval "$PROGRAM &#92;"&#92;${SMS_${i}_NUMBER}&#92;" &#92;"&#92;${SMS_${i}_TEXT}&#92;""
done
</pre>

<h3>Passing MMS indication parameters to external program</h3>
<p>Following script (if used as <strong>RunOnReceive</strong> handler) will write information about each received MMS indication to the log file. Just replace echo command with your own program to do custom processing.</p>
<pre>
#!/bin/sh
if [ $DECODED_PARTS -eq 0 ] ; then
    # No decoded parts, nothing to process
    exit
fi
if [ "$DECODED_1_MMS_ADDRESS" ] ; then
    echo "$DECODED_1_MMS_ADDRESS" "$DECODED_1_MMS_SENDER" "$DECODED_1_MMS_TITLE" &gt;&gt; /tmp/smsd-mms.log
fi
</pre>

<h3>Processing message text in Python</h3>
<p>Following script (if used as <strong>RunOnReceive</strong> handler) written in Python will concatenate all text from received message:</p>
<pre>
#!/usr/bin/python
import os
import sys

numparts = int(os.environ[&apos;DECODED_PARTS&apos;])

# Are there any decoded parts?
if numparts == 0:
    print(&apos;No decoded parts!&apos;)
    <strong>sys.exit</strong>(1)

# Get all text parts
text = &apos;&apos;
for i in range(1, numparts + 1):
    varname = &apos;DECODED_%d_TEXT&apos; % i
    if varname in os.environ:
        text = text + os.environ[varname]

# Do something with the text
print(&apos;Number %s have sent text: %s&apos; % (os.environ[&apos;SMS_1_NUMBER&apos;], text))
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Michal Čihař &lt;michal@cihar.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>2009-2012, Michal Čihař &lt;michal@cihar.com&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="gammu-smsd-pgsql.7.html"><span aria-hidden="true">&larr;</span> gammu-smsd-pgsql.7: Gammu-smsd(1) backend using postgresql database server as a message storage</a></li>
   <li class="next"><a href="gammu-smsd-sql.7.html">gammu-smsd-sql.7: Gammu-smsd(1) backend using sql abstraction layer to use any supported database as a message storage <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
