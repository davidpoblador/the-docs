<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>maildropex: Maildrop filtering language examples</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Maildrop filtering language examples">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="maildropex (7) manual">
  <meta name="twitter:description" content="Maildrop filtering language examples">
  <meta name="twitter:image" content="https://www.carta.tech/images/maildrop-maildropex-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/maildrop-maildropex.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="maildropex (7) manual" />
  <meta property="og:description" content="Maildrop filtering language examples" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/maildrop-maildropex-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">maildropex<small> (7)</small></h1>
        <p class="lead">Maildrop filtering language examples</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/maildropex.7.html">
      <span itemprop="name">maildropex: Maildrop filtering language examples</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/maildrop/">
      <span itemprop="name">maildrop</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/maildropex.7.html">
      <span itemprop="name">maildropex: Maildrop filtering language examples</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>$HOME/.mailfilter, $HOME/.mailfilters/*</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>If $HOME/.mailfilter exists, filtering instructions in this file will be carried out prior to delivering the message. The filtering instructions may instruct <strong>maildrop</strong> to discard the message, save the message in a different mailbox, or forward the message to another address. If $HOME/.mailfilter does not exist, or does not provide explicit delivery instructions, <strong>maildrop</strong> delivers the message to the user&apos;s system mailbox.</p><p>The files in $HOME/.mailfilters are used when <strong>maildrop</strong> is invoked in embedded mode.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Take all mail that&apos;s sent to the &apos;auto&apos; mailing list, and save it in Mail/auto. The &apos;auto&apos; mailing list software adds a "Delivered-To: auto@domain.com" header to all messages:</p>
<pre>
if (/^Delivered-To: *auto@domain&#92;.com$/)
    to Mail/auto
</pre>
<p>After the <strong>to</strong> command delivers the message, <strong>maildrop</strong> automatically stops filtering and terminates without executing the subsequent instructions in the filter file.</p><p>Take all mail from &lt;boss@domain.com&gt; about the current project status, save it in Mail/project, then forward a copy to John:</p>
<pre>
if (/^From: *boss@domain&#92;.com/ &#92;
    && /^Subject:.*[:wbreak:]project status[:wbreak:]/)
{
    cc "!john"
    to Mail/project
}
</pre>
<p>Note that it is necessary to use a backslash in order to continue the <strong>if</strong> statement on the next line.</p><p>Keep copies of the last 50 messages that you received in the maildir directory &apos;backup&apos;. NOTE: &apos;backup&apos; must be a maildir directory, not a mailbox. You can create a maildir using the <strong>maildirmake</strong> command.</p>
<pre>
cc backup
`cd backup/new && rm -f dummy &#92;`ls -t | sed -e 1,50d&#92;``
</pre>
<p>Put this at the beginning of your filter file, before any other filtering instructions. This is a good idea to have when you are learning <strong>maildrop</strong>. If you make a mistake and accidentally delete a message, you can recover it from the backup/new subdirectory.</p><p>Save messages that are at least 100 lines long (approximately) into Mail/IN.Large::</p>
<pre>
     if ( $LINES &gt; 100 )
        to Mail/IN.Large
</pre>
<p>Send messages from the auto mailing list to the program &apos;archive&apos;, using a lock file to make sure that only one instance of the archive program will be running at the same time:</p>
<pre>
     if (/^Delivered-To: *auto@domain&#92;.com$/)
        dotlock "auto.lock" {

               to "|archive"
        }
</pre>
<p>Check if the Message-ID: header in the message is identical to the same header that was recently seen. Discard the message if it is, otherwise continue to filter the message:</p>
<pre>
`reformail -D 8000 duplicate.cache`
if ( $RETURNCODE == 0 )
    exit
</pre>
<p>The \m[blue]<strong>reformail</strong>\m[]\s-2\u[1]\d\s+2 command maintains a list of recently seen Message-IDs in the file duplicate.cache.</p><p><strong>Note</strong></p><p>Unlike a similar feature in the <strong>formail</strong> command, \m[blue]<strong>reformail</strong>\m[]\s-2\u[1]\d\s+2 takes care of locking the file, so it&apos;s not necessary to implement your own locking mechanism for this option.</p><p>Here&apos;s a more complicated example. This fragment is intended to go right after the message has been filtered according to your regular rules, and just before the message should be saved in your mailbox:</p>
<pre>
cc $DEFAULT
xfilter "reformail -r -t"
/^To:.*/
getaddr($MATCH) =~ /^.*/;

MATCH=tolower($MATCH)
flock "vacation.lock" {
        `fgrep -iqx "$MATCH" vacation.lst 2&gt;/dev/null || { &#92;
                  echo "$MATCH" &gt;&gt;vacation.lst ; &#92;
                  exit 1 ; &#92;
              } `
}
if ( $RETURNCODE == 0 )
   exit
to "| ( cat - ; echo &apos;&apos;; cat vacation.msg) | $SENDMAIL"
</pre>
<p>This code maintains a list of everyone who sent you mail in the file called vacation.lst. When a message is received from anyone that is not already on the list, the address is added to the list, and the contents of the file vacation.msg are mailed back to the sender. This is intended to reply notify people that you will not be answering mail for a short period of time.</p><p>The first statement saves the original message in your regular mailbox. Then, \m[blue]<strong></strong><strong>xfilter</strong>\m[]\s-2\u[2]\d\s+2 is used to generate an autoreply header to the sender. The To: header in the autoreply - which was the sender of the original message - is extracted, and the \m[blue]<strong></strong><strong>getaddr</strong>\m[]\s-2\u[3]\d\s+2 function is used to strip the person&apos;s name, leaving the address only. The file vacation.lst is checked, using a lock file to guarantee atomic access and update (overkill, probably). Note that the backslashes are required.</p><p>If the address is already in the file, <strong>maildrop</strong> exits, otherwise the contents of vacation.msg are appended to the autoreply header, and mailed out.</p><p><strong>Note</strong></p><p>An easier to make a vacation script is with \m[blue]<strong></strong><a href="../man1/mailbot.1.html"><strong>mailbot</strong>(1)</a>\m[]\s-2\u[4]\d\s+2.</p><p>Here&apos;s a version of the vacation script that uses a GDBM database file instead. The difference between this script and the previous script is that the previous script will send a vacation message to a given E-mail address only once. The following script will store the time that the vacation message was sent in the GDBM file. If it&apos;s been at least a week since the vacation message has been sent to the given address, another vacation message will be sent.</p><p>Even though a GDBM database file is used, locking is still necessary because the GDBM library does not allow more than one process to open the same database file for writing:</p>
<pre>
cc $DEFAULT
xfilter "reformail -r -t"
/^To:.*/
getaddr($MATCH) =~ /^.*/;
MATCH=tolower($MATCH)
flock "vacation.lock" {
    current_time=time;
    if (gdbmopen("vacation.dat", "C") == 0)
    {
       if ( (prev_time=gdbmfetch($MATCH)) ne "" && &#92;
             $prev_time &gt;= $current_time - 60 * 60 * 24 * 7)
       {
           exit
       }
       gdbmstore($MATCH, $current_time)
       gdbmclose
    }
}
to "| ( cat - ; echo &apos;&apos;; cat vacation.msg) | $SENDMAIL"
</pre>
<p>This script requires that <strong>maildrop</strong> must be compiled with GDBM support enabled, which is done by default if GDBM libraries are present.</p><p>After you return from vacation, you can use a simple Perl script to obtain a list of everyone who sent you mail (of course, that can also be determined by examining your mailbox).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO maildropex&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[5]\d\s+2, \m[blue]<strong></strong><a href="../man7/maildropfilter.7.html"><strong>maildropfilter</strong>(7)</a>\m[]\s-2\u[6]\d\s+2, \m[blue]<strong></strong><a href="../man1/reformail.1.html"><strong>reformail</strong>(1)</a>\m[]\s-2\u[1]\d\s+2, \m[blue]<strong></strong><a href="../man1/mailbot.1.html"><strong>mailbot</strong>(1)</a>\m[]\s-2\u[4]\d\s+2, <a href="../man1/egrep.1.html"><strong>egrep</strong>(1)</a>, <a href="../man1/grep.1.html"><strong>grep</strong>(1)</a>, <a href="../man8/sendmail.8.html"><strong>sendmail</strong>(8)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Sam Varshavchik</strong></p><p>Author</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>reformail</p><p>[set $man.base.url.for.relative.links]/reformail.html</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p><strong>xfilter</strong></p><p>[set $man.base.url.for.relative.links]/maildropfilter.html#xfilter</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p><strong>getaddr</strong></p><p>[set $man.base.url.for.relative.links]/maildropfilter.html#getaddr</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p><a href="../man1/mailbot.1.html"><strong>mailbot</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/mailbot.html</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/maildrop.html</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p><a href="../man7/maildropfilter.7.html"><strong>maildropfilter</strong>(7)</a></p><p>[set $man.base.url.for.relative.links]/maildropfilter.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="courier-maildrop-maildropex.7.html"><span aria-hidden="true">&larr;</span> maildropex.7: Maildrop filtering language examples</a></li>
   <li class="next"><a href="courier-maildrop-maildropfilter.7.html">maildropfilter.7: Maildrops filtering language <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
