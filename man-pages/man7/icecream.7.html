<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>icecream: A distributed compile system</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A distributed compile system">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="icecream (7) manual">
  <meta name="twitter:description" content="A distributed compile system">
  <meta name="twitter:image" content="https://www.carta.tech/images/icecc-icecream-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/icecream.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="icecream (7) manual" />
  <meta property="og:description" content="A distributed compile system" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/icecc-icecream-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">icecream<small> (7)</small></h1>
        <p class="lead">A distributed compile system</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/icecream.7.html">
      <span itemprop="name">icecream: A distributed compile system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/icecc/">
      <span itemprop="name">icecc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/icecream.7.html">
      <span itemprop="name">icecream: A distributed compile system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Icecream is a distributed compile system for C and C++.</p><p>Icecream is created by SUSE and is based on ideas and code by distcc. Like distcc it takes compile jobs from your build and distributes it to remote machines allowing a parallel build on several machines you've got. But unlike distcc Icecream uses a central server that schedules the compile jobs to the fastest free server and is as this dynamic. This advantage pays off mostly for shared computers, if you're the only user on x machines, you have full control over them anyway.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOW TO USE ICECREAM</h2>
        <div class="sectioncontent">
<p>You need:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>One machine that runs the scheduler ("./icecc-scheduler -d")</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Many machines that run the daemon ("./iceccd -d")</p>
  </dd>

</dl>
<p>If you want to compile using icecream, make sure $prefix/lib/icecc/bin is the first first entry in your path, e.g. type <strong>export PATH=/usr/lib/icecc/bin:$PATH</strong> (Hint: put this in ~/.bashrc or /etc/profile to not have to type it in everytime)</p><p>Then you just compile with <strong>make -j &lt;num&gt;</strong>, where &lt;num&gt; is the amount of jobs you want to compile in parallel. Don't exaggerate. Numbers greater than 15 normally cause trouble.</p><p>WARNING: Never use icecream in untrusted environments. Run the deamons and the scheduler as unpriviliged user in such networks if you have to! But you will have to rely on homogeneous networks then (see below).</p><p>If you want funny stats, you might want to run "icemon".</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USING ICECREAM IN HETEROGENEOUS ENVIRONMENTS</h2>
        <div class="sectioncontent">
<p>If you are running icecream daemons (note: they _all_ must be running as root. In the future icecream might gain the ability to know when machines can't accept a different env, but for now it is all or nothing ) in the same icecream network but on machines with incompatible compiler versions you have to tell icecream which environment you are using. Use <strong>icecc --build-native</strong> to create an archive file containing all the files necessary to setup the compiler environment. The file will have a random unique name like "ddaea39ca1a7c88522b185eca04da2d8.tar.bz2" per default. Rename it to something more expressive for your convenience, e.g. "i386-3.3.1.tar.bz2". Set <strong>ICECC_VERSION=&lt;filename_of_archive_containing_your_environment&gt;</strong> in the shell environment where you start the compile jobs and the file will be transfered to the daemons where your compile jobs run and installed to a chroot environment for executing the compile jobs in the environment fitting to the environment of the client. This requires that the icecream deamon runs as root.</p><p>If you do not set ICECC_VERSION, the client will use a tar ball provided by the daemon running on the same machine. So you can always be sure you're not tricked by incompatible gcc versions - and you can share your computer with users of other distributions (or different versions of your beloved SUSE Linux :)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CROSS-COMPILING USING ICECREAM</h2>
        <div class="sectioncontent">
<p>SUSE got quite some good machines not having a processor from Intel or AMD, so icecream is pretty good in using cross-compiler environments similiar to the above way of spreading compilers. There the ICECC_VERSION varaible looks like &lt;native_filename&gt;(,&lt;platform&gt;:&lt;cross_compiler_filename&gt;)*, for example like this: \*(T&lt;/work/9.1-i386.tar.bz2,ia64:/work/9.1-cross-ia64.tar.bz2\*(T&gt;</p><p>How to package such a cross compiler is pretty straightforward if you look what's inside the tarballs generated by <strong>icecc --build-native</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CROSS-COMPILING FOR EMBEDDED TARGETS USING ICECREAM</h2>
        <div class="sectioncontent">
<p>When building for embedded targets like ARM often you'll have a toolchain that runs on your host and produces code for the target. In these situations you can exploit the power of icecream as well.</p><p>Create symlinks from where icecc is to the name of your cross compilers (e.g. arm-linux-g++ and arm-linux-gcc), make sure that these symlinks are in the path and before the path of your toolchain, with \*(T&lt;$ICECC_CC\*(T&gt; and \*(T&lt;$ICECC_CXX\*(T&gt; you need to tell icecream which compilers to use for preprocessing and local compiling. e.g. set it to <strong>ICECC_CC=arm-linux-gcc</strong> and <strong>ICECC_CXX=arm-linux-g++</strong>.</p><p>As the next step you need to create a .tar.bz2 of your cross compiler, check the result of build-native to see what needs to be present.</p><p>Finally one needs to set \*(T&lt;ICECC_VERSION\*(T&gt; and point it to the tar.bz2 you've created. When you start compiling your toolchain will be used.</p><p>NOTE: with \*(T&lt;ICECC_VERSION\*(T&gt; you point out on which platforms your toolchain runs, you do not indicate for which target code will be generated.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOW TO COMBINE ICECREAM WITH CCACHE</h2>
        <div class="sectioncontent">
<p>The easiest way to use ccache with icecream is to set \*(T&lt;CCACHE_PREFIX\*(T&gt; to icecc (the actual icecream client wrapper)</p>
<pre>
\*(T&lt;
 export CCACHE_PREFIX=icecc
\*(T&gt;.fi

This will make ccache prefix any compilation command it needs to do with icecc,
making it use icecream for the compilation (but not for preprocessing alone).

To actually use ccache, the mechanism is the same like with using icecream alone.
Since ccache does not provide any symlinks in /opt/ccache/bin, you can create them manually:

\*(T&lt;
mkdir /opt/ccache/bin
ln -s /usr/bin/ccache /opt/ccache/bin/gcc
ln -s /usr/bin/ccache /opt/ccache/bin/g++
\*(T&gt;.fi

And then compile with

\*(T&lt;
export PATH=/opt/ccache/bin:$PATH
\*(T&gt;.fi

Note however that ccache isn't really worth the trouble if you're not
recompiling your project three times a day from scratch (it adds quite some overhead
in comparing the preprocessor output and uses quite some disc space and I found
a cache hit of 18% a bit too few, so I disabled it again).
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEBUG OUTPUT</h2>
        <div class="sectioncontent">
<p>You can use the environment variable \*(T&lt;ICECC_DEBUG\*(T&gt; to control if icecream gives debug output or not. Set it to \*(T&lt;debug\*(T&gt; to get debug output. The other possible values are \*(T&lt;error\*(T&gt;, \*(T&lt;warning\*(T&gt; and \*(T&lt;info\*(T&gt; (the -v option for daemon and scheduler raise the level per -v on the command line - so use -vvv for full debug).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AVOIDING OLD HOSTS</h2>
        <div class="sectioncontent">
<p>It is possible that compilation on some hosts fails because they are too old (typically the kernel on the remote host is too old for the glibc from the local host). Recent icecream versions should automatically detect this and avoid such hosts when compilation would fail. If some hosts are running old icecream versions and it is not possible to upgrade them for some reason, use</p>
<pre>
\*(T&lt;
 export ICECC_IGNORE_UNVERIFIED=1
\*(T&gt;.fi
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOME NUMBERS</h2>
        <div class="sectioncontent">
<p>Numbers of my test case (some STL C++ genetic algorithm)</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>g++ on my machine: 1.6s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>g++ on fast machine: 1.1s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>icecream using my machine as remote machine: 1.9s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>icecream using fast machine: 1.8s</p>
  </dd>

</dl>
<p>The icecream overhead is quite huge as you might notice, but the compiler can't interleave preprocessing with compilation and the file needs to be read/written once more and in between the file is transfered.</p><p>But even if the other computer is faster, using g++ on my local machine is faster. If you're (for whatever reason) alone in your network at some point, you loose all advantages of distributed compiling and only add the overhead. So icecream got a special case for local compilations (the same special meaning that localhost got within $DISTCC_HOSTS). This makes compiling on my machine using icecream down to 1.7s (the overhead is actually less than 0.1s in average).</p><p>As the scheduler is aware of that meaning, it will prefer your own computer if it's free and got not less than 70% of the fastest available computer.</p><p>Keep in mind, that this affects only the first compile job, the second one is distributed anyway. So if I had to compile two of my files, I would get</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>g++ -j1 on my machine: 3.2s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>g++ -j1 on the fast machine: 2.2s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>using icecream -j2 on my machine: max(1.7,1.8)=1.8s</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>(using icecream -j2 on the other machine: max(1.1,1.8)=1.8s)</p>
  </dd>

</dl>
<p>The math is a bit tricky and depends a lot on the current state of the compilation network, but make sure you're not blindly assuming make -j2 halfs your compilation time.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WHAT IS THE BEST ENVIRONMENT FOR ICECREAM</h2>
        <div class="sectioncontent">
<p>In most requirements icecream isn't special, e.g. it doesn't matter what distributed compile system you use, you won't have fun if your nodes are connected through than less or equal to 10MBit. Note that icecream compresses input and output files (using lzo), so you can calc with ~1MBit per compile job - i.e more than make -j10 won't be possible without delays.</p><p>Remember that more machines are only good if you can use massive parallelization, but you will for sure get the best result if your submitting machine (the one you called g++ on) will be fast enough to feed the others. Especially if your project consists of many easy to compile files, the preprocessing and file IO will be job enough to need a quick machine.</p><p>The scheduler will try to give you the fastest machines available, so even if you add old machines, they will be used only in exceptional situations, but still you can have bad luck - the scheduler doesn't know how long a job will take before it started. So if you have 3 machines and two quick to compile and one long to compile source file, you're not safe from a choice where everyone has to wait on the slow machine. Keep that in mind.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NETWORK SETUP FOR ICECREAM (FIREWALLS)</h2>
        <div class="sectioncontent">
<p>A short overview of the ports icecream requires:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>TCP/10245 on the daemon computers (required)</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>TCP/8765 for the the scheduler computer (required)</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>TCP/8766 for the telnet interface to the scheduler (optional)</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>UDP/8765 for broadcast to find the scheduler (optional)</p>
  </dd>

</dl>
<p>Note that the SuSEfirewall2 on SUSE &lt; 9.1 got some problems configuring broadcast. So you might need the -s option for the daemon in any case there. If the monitor can't find the scheduler, use USE_SCHEDULER=&lt;host&gt; icemon (or send me a patch :)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO icecream&hellip;</h2>
        <div class="sectioncontent">
<p>icecream, icecc-scheduler, iceccd, icemon</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ICECREAM AUTHORS</h2>
        <div class="sectioncontent">
<p>Stephan Kulow &lt;coolo@suse.de&gt;</p><p>Michael Matz &lt;matz@suse.de&gt;</p><p>Cornelius Schumacher &lt;cschum@suse.de&gt;</p><p>...and various other contributors.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ibacm.7.html"><span aria-hidden="true">&larr;</span> ibacm.7: Infiniband communication management assistant</a></li>
   <li class="next"><a href="icewm-common.7.html">icewm-common.7: A small and fast window manager <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
