<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CREATE_RULE: Define a new rewrite rule</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Define a new rewrite rule">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CREATE_RULE (7) manual">
  <meta name="twitter:description" content="Define a new rewrite rule">
  <meta name="twitter:image" content="https://www.carta.tech/images/postgresql-client-9.4-CREATE_RULE-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/CREATE_RULE.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CREATE_RULE (7) manual" />
  <meta property="og:description" content="Define a new rewrite rule" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/postgresql-client-9.4-CREATE_RULE-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CREATE_RULE<small> (7)</small></h1>
        <p class="lead">Define a new rewrite rule</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/CREATE_RULE.7.html">
      <span itemprop="name">CREATE_RULE: Define a new rewrite rule</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/postgresql-client-9.4/">
      <span itemprop="name">postgresql-client-9.4</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/CREATE_RULE.7.html">
      <span itemprop="name">CREATE_RULE: Define a new rewrite rule</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
CREATE [ OR REPLACE ] RULE <em>name</em> AS ON <em>event</em>
    TO <em>table_name</em> [ WHERE <em>condition</em> ]
    DO [ ALSO | INSTEAD ] { NOTHING | <em>command</em> | ( <em>command</em> ; <em>command</em> ... ) }

where <em>event</em> can be one of:

    SELECT | INSERT | UPDATE | DELETE
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>CREATE RULE</strong> defines a new rule applying to a specified table or view. <strong>CREATE OR REPLACE RULE</strong> will either create a new rule, or replace an existing rule of the same name for the same table.</p><p>The PostgreSQL rule system allows one to define an alternative action to be performed on insertions, updates, or deletions in database tables. Roughly speaking, a rule causes additional commands to be executed when a given command on a given table is executed. Alternatively, an INSTEAD rule can replace a given command by another, or cause a command not to be executed at all. Rules are used to implement SQL views as well. It is important to realize that a rule is really a command transformation mechanism, or command macro. The transformation happens before the execution of the command starts. If you actually want an operation that fires independently for each physical row, you probably want to use a trigger, not a rule. More information about the rules system is in Chapter 38, The Rule System, in the documentation.</p><p>Presently, ON SELECT rules must be unconditional INSTEAD rules and must have actions that consist of a single <strong>SELECT</strong> command. Thus, an ON SELECT rule effectively turns the table into a view, whose visible contents are the rows returned by the rule&apos;s <strong>SELECT</strong> command rather than whatever had been stored in the table (if anything). It is considered better style to write a <strong>CREATE VIEW</strong> command than to create a real table and define an ON SELECT rule for it.</p><p>You can create the illusion of an updatable view by defining ON INSERT, ON UPDATE, and ON DELETE rules (or any subset of those that&apos;s sufficient for your purposes) to replace update actions on the view with appropriate updates on other tables. If you want to support <strong>INSERT RETURNING</strong> and so on, then be sure to put a suitable RETURNING clause into each of these rules.</p><p>There is a catch if you try to use conditional rules for complex view updates: there <em>must</em> be an unconditional INSTEAD rule for each action you wish to allow on the view. If the rule is conditional, or is not INSTEAD, then the system will still reject attempts to perform the update action, because it thinks it might end up trying to perform the action on the dummy table of the view in some cases. If you want to handle all the useful cases in conditional rules, add an unconditional DO INSTEAD NOTHING rule to ensure that the system understands it will never be called on to update the dummy table. Then make the conditional rules non-INSTEAD; in the cases where they are applied, they add to the default INSTEAD NOTHING action. (This method does not currently work to support RETURNING queries, however.)</p><p><strong>Note</strong></p><p>A view that is simple enough to be automatically updatable (see CREATE VIEW (<a href="../man7/CREATE_VIEW.7.html"><strong>CREATE_VIEW</strong>(7)</a>)) does not require a user-created rule in order to be updatable. While you can create an explicit rule anyway, the automatic update transformation will generally outperform an explicit rule.</p><p>Another alternative worth considering is to use INSTEAD OF triggers (see CREATE TRIGGER (<strong>CREATE_TRIGGER</strong>(7))) in place of rules.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PARAMETERS</h2>
        <div class="sectioncontent">
<p><em>name</em></p><p>The name of a rule to create. This must be distinct from the name of any other rule for the same table. Multiple rules on the same table and same event type are applied in alphabetical name order.</p><p><em>event</em></p><p>The event is one of SELECT, INSERT, UPDATE, or DELETE.</p><p><em>table_name</em></p><p>The name (optionally schema-qualified) of the table or view the rule applies to.</p><p><em>condition</em></p><p>Any SQL conditional expression (returning boolean). The condition expression cannot refer to any tables except NEW and OLD, and cannot contain aggregate functions.</p><p><strong>INSTEAD</strong></p><p>INSTEAD indicates that the commands should be executed <em>instead of</em> the original command.</p><p><strong>ALSO</strong></p><p>ALSO indicates that the commands should be executed <em>in addition to</em> the original command.</p><p>If neither ALSO nor INSTEAD is specified, ALSO is the default.</p><p><em>command</em></p><p>The command or commands that make up the rule action. Valid commands are <strong>SELECT</strong>, <strong>INSERT</strong>, <strong>UPDATE</strong>, <strong>DELETE</strong>, or <strong>NOTIFY</strong>.</p><p>Within <em>condition</em> and <em>command</em>, the special table names NEW and OLD can be used to refer to values in the referenced table. NEW is valid in ON INSERT and ON UPDATE rules to refer to the new row being inserted or updated. OLD is valid in ON UPDATE and ON DELETE rules to refer to the existing row being updated or deleted.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>You must be the owner of a table to create or change rules for it.</p><p>In a rule for INSERT, UPDATE, or DELETE on a view, you can add a RETURNING clause that emits the view&apos;s columns. This clause will be used to compute the outputs if the rule is triggered by an <strong>INSERT RETURNING</strong>, <strong>UPDATE RETURNING</strong>, or <strong>DELETE RETURNING</strong> command respectively. When the rule is triggered by a command without RETURNING, the rule&apos;s RETURNING clause will be ignored. The current implementation allows only unconditional INSTEAD rules to contain RETURNING; furthermore there can be at most one RETURNING clause among all the rules for the same event. (This ensures that there is only one candidate RETURNING clause to be used to compute the results.) RETURNING queries on the view will be rejected if there is no RETURNING clause in any available rule.</p><p>It is very important to take care to avoid circular rules. For example, though each of the following two rule definitions are accepted by PostgreSQL, the <strong>SELECT</strong> command would cause PostgreSQL to report an error because of recursive expansion of a rule:</p>
<pre>
CREATE RULE "_RETURN" AS
    ON SELECT TO t1
    DO INSTEAD
        SELECT * FROM t2;

CREATE RULE "_RETURN" AS
    ON SELECT TO t2
    DO INSTEAD
        SELECT * FROM t1;

SELECT * FROM t1;
</pre>
<p>Presently, if a rule action contains a <strong>NOTIFY</strong> command, the <strong>NOTIFY</strong> command will be executed unconditionally, that is, the <strong>NOTIFY</strong> will be issued even if there are not any rows that the rule should apply to. For example, in:</p>
<pre>
CREATE RULE notify_me AS ON UPDATE TO mytable DO ALSO NOTIFY mytable;

UPDATE mytable SET name = &apos;foo&apos; WHERE id = 42;
</pre>
<p>one <strong>NOTIFY</strong> event will be sent during the <strong>UPDATE</strong>, whether or not there are any rows that match the condition id = 42. This is an implementation restriction that might be fixed in future releases.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPATIBILITY</h2>
        <div class="sectioncontent">
<p><strong>CREATE RULE</strong> is a PostgreSQL language extension, as is the entire query rewrite system.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO CREATE_RULE&hellip;</h2>
        <div class="sectioncontent">
<p>ALTER RULE (<a href="../man7/ALTER_RULE.7.html"><strong>ALTER_RULE</strong>(7)</a>), DROP RULE (<a href="../man7/DROP_RULE.7.html"><strong>DROP_RULE</strong>(7)</a>)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CREATE_ROLE.7.html"><span aria-hidden="true">&larr;</span> CREATE_ROLE.7: Define a new database role</a></li>
   <li class="next"><a href="CREATE_SCHEMA.7.html">CREATE_SCHEMA.7: Define a new schema <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
