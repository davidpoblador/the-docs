<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>rsocket: Rdma socket api</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Rdma socket api">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="rsocket (7) manual">
  <meta name="twitter:description" content="Rdma socket api">
  <meta name="twitter:image" content="https://www.carta.tech/images/librdmacm-dev-rsocket-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/rsocket.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="rsocket (7) manual" />
  <meta property="og:description" content="Rdma socket api" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/librdmacm-dev-rsocket-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">rsocket<small> (7)</small></h1>
        <p class="lead">Rdma socket api</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/rsocket.7.html">
      <span itemprop="name">rsocket: Rdma socket api</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/librdmacm-dev/">
      <span itemprop="name">librdmacm-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/rsocket.7.html">
      <span itemprop="name">rsocket: Rdma socket api</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;rdma/rsocket.h&gt;</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>RDMA socket API and protocol</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Rsockets is a protocol over RDMA that supports a socket-level API for applications.  Rsocket APIs are intended to match the behavior of corresponding socket calls, except where noted.  Rsocket functions match the name and function signature of socket calls, with the exception that all function calls are prefixed with an 'r'.</p><p>The following functions are defined:</p><p>rsocket</p><p>rbind, rlisten, raccept, rconnect</p><p>rshutdown, rclose</p><p>rrecv, rrecvfrom, rrecvmsg, rread, rreadv</p><p>rsend, rsendto, rsendmsg, rwrite, rwritev</p><p>rpoll, rselect</p><p>rgetpeername, rgetsockname</p><p>rsetsockopt, rgetsockopt, rfcntl</p><p>Functions take the same parameters as that used for sockets.  The follow capabilities and flags are supported at this time:</p><p>PF_INET, PF_INET6, SOCK_STREAM, SOCK_DGRAM</p><p>SOL_SOCKET - SO_ERROR, SO_KEEPALIVE (flag supported, but ignored), SO_LINGER, SO_OOBINLINE, SO_RCVBUF, SO_REUSEADDR, SO_SNDBUF</p><p>IPPROTO_TCP - TCP_NODELAY, TCP_MAXSEG</p><p>IPPROTO_IPV6 - IPV6_V6ONLY</p><p>MSG_DONTWAIT, MSG_PEEK, O_NONBLOCK</p><p>Rsockets provides extensions beyond normal socket routines that allow for direct placement of data into an application's buffer. This is also known as zero-copy support, since data is sent and received directly, bypassing copies into network controlled buffers. The following calls and options support direct data placement.</p><p>riomap, riounmap, riowrite</p>
<dl class='dl-vertical'>
  <dt>
    <p>off_t riomap(int socket, void *buf, size_t len, int prot, int flags, off_t offset)</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>Riomap registers an application buffer with the RDMA hardware</p>
  </dt>
  <dd>
    <p>associated with an rsocket.  The buffer is registered either for local only access (PROT_NONE) or for remote write access (PROT_WRITE). When registered for remote access, the buffer is mapped to a given offset.  The offset is either provided by the user, or if the user selects -1 for the offset, rsockets selects one.  The remote peer may access an iomapped buffer directly by specifying the correct offset. The mapping is not guaranteed to be available until after the remote peer receives a data transfer initiated after riomap has completed.</p>
  </dd>

</dl>
<p>In order to enable the use of remote IO mapping calls on an rsocket, an application must set the number of IO mappings that are available to the remote peer.  This may be done using the rsetsockopt RDMA_IOMAPSIZE option.  By default, an rsocket does not support remote IO mappings. riounmap</p>
<dl class='dl-vertical'>
  <dt>
    <p>int riounmap(int socket, void *buf, size_t len)</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>Riounmap removes the mapping between a buffer and an rsocket.</p>
  </dt>
  <dd>
    
  </dd>

</dl>
<p>riowrite</p>
<dl class='dl-vertical'>
  <dt>
    <p>size_t riowrite(int socket, const void *buf, size_t count, off_t offset, int flags)</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>Riowrite allows an application to transfer data over an rsocket</p>
  </dt>
  <dd>
    <p>directly into a remotely iomapped buffer.  The remote buffer is specified through an offset parameter, which corresponds to a remote iomapped buffer. From the sender's perspective, riowrite behaves similar to rwrite.  From a receiver's view, riowrite transfers are silently redirected into a pre- determined data buffer.  Data is received automatically, and the receiver is not informed of the transfer.  However, iowrite data is still considered part of the data stream, such that iowrite data will be written before a subsequent transfer is received.  A message sent immediately after initiating an iowrite may be used to notify the receiver of the iowrite.</p>
  </dd>

</dl>
<p>In addition to standard socket options, rsockets supports options specific to RDMA devices and protocols.  These options are accessible through rsetsockopt using SOL_RDMA option level.</p>
<dl class='dl-vertical'>
  <dt>
    <p>RDMA_SQSIZE - Integer size of the underlying send queue.</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>RDMA_RQSIZE - Integer size of the underlying receive queue.</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>RDMA_INLINE - Integer size of inline data.</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>RDMA_IOMAPSIZE - Integer number of remote IO mappings supported</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>RDMA_ROUTE - struct ibv_path_data of path record for connection.</p>
  </dt>
  <dd>
    
  </dd>

</dl>
<p>Note that rsockets fd's cannot be passed into non-rsocket calls.  For applications which must mix rsocket fd's with standard socket fd's or opened files, rpoll and rselect support polling both rsockets and normal fd's.</p><p>Existing applications can make use of rsockets through the use of a preload library.  Because rsockets implements an end-to-end protocol, both sides of a connection must use rsockets.  The rdma_cm library provides such a preload library, librspreload.  To reduce the chance of the preload library intercepting calls without the user's explicit knowledge, the librspreload library is installed into %libdir%/rsocket subdirectory.</p><p>The preload library can be used by setting LD_PRELOAD when running. Note that not all applications will work with rsockets.  Support is limited based on the socket options used by the application. Support for fork() is limited, but available.  To use rsockets with the preload library for applications that call fork, users must set the environment variable RDMAV_FORK_SAFE=1 on both the client and server side of the connection.  In general, fork is supportable for server applications that accept a connection, then fork off a process to handle the new connection.</p><p>rsockets uses configuration files that give an administrator control over the default settings used by rsockets.  Use files under %sysconfig%/rdma/rsocket as shown:</p><p>mem_default - default size of receive buffer(s)</p><p>wmem_default - default size of send buffer(s)</p><p>sqsize_default - default size of send queue</p><p>rqsize_default - default size of receive queue</p><p>inline_default - default size of inline data</p><p>iomap_size - default size of remote iomapping table</p><p>polling_time - default number of microseconds to poll for data before waiting</p><p>All configuration files should contain a single integer value.  Values may be set by issuing a command similar to the following example.</p><p>echo 1000000 &gt; /etc/rdma/rsocket/mem_default</p><p>If configuration files are not available, rsockets uses internal defaults. Applications can override default values programmatically through the rsetsockopt routine.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO rsocket&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man7/rdma_cm.7.html"><strong>rdma_cm</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ronn-format.7.html"><span aria-hidden="true">&larr;</span> ronn-format.7: Manual authoring format based on markdown</a></li>
   <li class="next"><a href="rtld-audit.7.html">rtld-audit.7: Auditing api for the dynamic linker <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
