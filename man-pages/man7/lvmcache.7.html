<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lvmcache: Lvmcache  lvm caching</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Lvmcache  lvm caching">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="lvmcache (7) manual">
  <meta name="twitter:description" content="Lvmcache  lvm caching">
  <meta name="twitter:image" content="https://www.carta.tech/images/lvm2-lvmcache-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/lvmcache.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="lvmcache (7) manual" />
  <meta property="og:description" content="Lvmcache  lvm caching" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/lvm2-lvmcache-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">lvmcache<small> (7)</small></h1>
        <p class="lead">Lvmcache  lvm caching</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/lvmcache.7.html">
      <span itemprop="name">lvmcache: Lvmcache  lvm caching</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/lvm2/">
      <span itemprop="name">lvm2</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/lvmcache.7.html">
      <span itemprop="name">lvmcache: Lvmcache  lvm caching</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>cache</strong> logical volume type uses a small and fast LV to improve the performance of a large and slow LV.  It does this by storing the frequently used blocks on the faster LV. LVM refers to the small fast LV as a <strong>cache pool LV</strong>.  The large slow LV is called the <strong>origin LV</strong>.  Due to requirements from dm-cache (the kernel driver), LVM further splits the cache pool LV into two devices - the <strong>cache data LV</strong> and <strong>cache metadata LV</strong>.  The cache data LV is where copies of data blocks are kept from the origin LV to increase speed.  The cache metadata LV holds the accounting information that specifies where data blocks are stored (e.g. on the origin LV or on the cache data LV).  Users should be familiar with these LVs if they wish to create the best and most robust cached logical volumes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Cache Terms</h2>
        <div class="sectioncontent">

<pre>
origin LV           OriginLV      large slow LV
cache data LV       CacheDataLV   small fast LV for cache pool data
cache metadata LV   CacheMetaLV   small fast LV for cache pool metadata
cache pool LV       CachePoolLV   CacheDataLV + CacheMetaLV
cache LV            CacheLV       OriginLV + CachePoolLV
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Cache Usage</h2>
        <div class="sectioncontent">
<p>The primary method for using a cache type logical volume:</p><h3>0. create OriginLV</h3>
<p>Create an LV or identify an existing LV to be the origin LV.</p><p><strong>lvcreate -n OriginLV -L LargeSize VG SlowPVs</strong></p><p><em>Example</em></p><p># lvcreate -n lvol0 -L 100G vg</p>
<h3>1. create CacheDataLV</h3>
<p>Create the cache data LV.  This LV will hold data blocks from the OriginLV.  The size of this LV is the size of the cache and will be reported as the size of the cache pool LV.</p><p><strong>lvcreate -n CacheDataLV -L CacheSize VG FastPVs</strong></p><p><em>Example</em></p><p># lvcreate -n cache0 -L 10G vg /dev/fast</p>
<h3>2. create CacheMetaLV</h3>
<p>Create the cache metadata LV.  This LV will hold cache pool metadata.  The size of this LV should be 1000 times smaller than the cache data LV, with a minimum size of 8MiB.</p><p><strong>lvcreate -n CacheMetaLV -L MetaSize VG FastPVs</strong></p><p><em>Example</em></p><p># lvcreate -n cache0meta -L 12M vg /dev/fast</p>
<pre>
# lvs -a vg
  LV         VG   Attr       LSize   Pool Origin
  cache0     vg   -wi-a-----  10.00g
  cache0meta vg   -wi-a-----  12.00m
  lvol0      vg   -wi-a----- 100.00g
</pre>

<h3>3. create CachePoolLV</h3>
<p>Combine the data and metadata LVs into a cache pool LV. The behavior of the cache pool LV can be set in this step.</p><p>CachePoolLV takes the name of CacheDataLV.</p><p>CacheDataLV is renamed CachePoolLV_cdata and becomes hidden.</p><p>CacheMetaLV is renamed CachePoolLV_cmeta and becomes hidden.</p><p><strong>lvconvert --cachepool VG/CacheDataLV --poolmetadata VG/CacheMetaLV</strong></p><p><em>Example</em></p><p># lvconvert --cachepool vg/cache0 --poolmetadata vg/cache0meta</p>
<pre>
# lvs -a vg
  LV              VG   Attr       LSize   Pool Origin
  cache0          vg   Cwi---C---  10.00g
  [cache0_cdata]  vg   Cwi-------  10.00g
  [cache0_cmeta]  vg   ewi-------  12.00m
  lvol0           vg   -wi-a----- 100.00g
</pre>

<h3>4. create CacheLV</h3>
<p>Create a cache LV by linking the cache pool LV to the origin LV. The user accessible cache LV takes the name of the origin LV, while the origin LV becomes a hidden LV with the name OriginLV_corig.  This can be done while the origin LV is in use.</p><p>CacheLV takes the name of OriginLV.</p><p>OriginLV is renamed OriginLV_corig and becomes hidden.</p><p><strong>lvconvert --type cache --cachepool VG/CachePoolLV VG/OriginLV</strong></p><p><em>Example</em></p><p># lvconvert --type cache --cachepool vg/cache0 vg/lvol0</p>
<pre>
# lvs -a vg
  LV              VG   Attr       LSize   Pool   Origin
  cache0          vg   Cwi---C---  10.00g
  [cache0_cdata]  vg   Cwi-ao----  10.00g
  [cache0_cmeta]  vg   ewi-ao----  12.00m
  lvol0           vg   Cwi-a-C--- 100.00g cache0 [lvol0_corig]
  [lvol0_corig]   vg   -wi-ao---- 100.00g
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Cache Removal</h2>
        <div class="sectioncontent">
<h3>Removing a cache pool LV without removing its linked origin LV</h3>
<p>This writes back data from the cache pool to the origin LV when necessary, then removes the cache pool LV, leaving the un-cached origin LV.</p><p><strong>lvremove VG/CachePoolLV</strong></p><p><em>Example</em></p>
<pre>
# lvs vg
  LV     VG   Attr       LSize   Pool   Origin
  cache0 vg   Cwi---C---  10.00g
  lvol0  vg   Cwi-a-C--- 100.00g cache0 [lvol0_corig]

# lvremove vg/cache0

# lvs vg
  LV    VG   Attr       LSize   Pool Origin
  lvol0 vg   -wi-a----- 100.00g
</pre>

<h3>Removing an origin LV without removing its linked cache pool LV</h3>
<p>This removes the origin LV, leaving the cache pool LV which can be linked to another origin LV.</p><p><strong>lvremove VG/CacheLV</strong></p><p><em>Example</em></p>
<pre>
# lvs vg
  LV     VG   Attr       LSize   Pool   Origin
  cache0 vg   Cwi---C---  10.00g
  lvol0  vg   Cwi-a-C--- 100.00g cache0 [lvol0_corig]

# lvremove vg/lvol0

# lvs vg
  LV     VG   Attr       LSize  Pool Origin
  cache0 vg   Cwi---C--- 10.00g
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Cache Topics</h2>
        <div class="sectioncontent">
<h3>Tolerate device failures in a cache pool LV</h3>
<p>Users who are concerned about the possibility of failures in their fast devices that could lead to data loss might consider making their cache pool sub-LVs redundant.</p>
<pre>
0. Create an origin LV we wish to cache
# lvcreate -L 10G -n lvx vg /dev/slow_devs

1. Create a 2-way RAID1 cache data LV
# lvcreate --type raid1 -m 1 -L 1G -n lvx_cache vg &#92;
	/dev/fast1 /dev/fast2

2. Create a 2-way RAID1 cache metadata LV
# lvcreate --type raid1 -m 1 -L 8M -n lvx_cache_meta vg &#92;
	/dev/fast1 /dev/fast2

3. Create a cache pool LV combining cache data LV and cache metadata LV
# lvconvert --cachepool vg/lvx_cache --poolmetadata vg/lvx_cache_meta

4. Create a cached LV by combining the cache pool LV and origin LV
# lvconvert --type cache --cachepool vg/lvx_cache vg/lvx
</pre>

<h3>Writethough caching</h3>
<p>Writethrough caching ensures that any data written will be stored both in the cache pool LV and on the origin LV.  The loss of a device associated with the cache pool LV in this case would not mean the loss of any data. When combining the cache data LV and the cache metadata LV to form the cache pool LV, properties of the cache can be specified - in this case, <em>writethrough</em> vs. <em>writeback</em>.</p>
<pre>
0. Create an origin LV we wish to cache (yours may already exist)
# lvcreate -L 10G -n lvx vg /dev/slow

1. Create a cache data LV
# lvcreate -L 1G -n lvx_cache vg /dev/fast

2. Create a cache metadata LV
# lvcreate -L 8M -n lvx_cache_meta vg /dev/fast

3. Create a cache pool LV specifying cache mode "writethrough"
# lvconvert --cachepool vg/lvx_cache --poolmetadata vg/lvx_cache_meta &#92;
	--cachemode writethrough

4. Create a cache LV by combining the cache pool LV and origin LV
# lvconvert --type cache --cachepool vg/lvx_cache vg/lvx
</pre>

<h3>Spare metadata LV</h3>
<p>See <a href="../man7/lvmthin.7.html"><strong>lvmthin</strong>(7)</a> for a description of the "pool metadata spare" LV. The same concept is used for cache pools.</p>
<h3>Automatic pool metadata LV</h3>
<p>A cache data LV can be converted to cache pool LV without specifying a cache pool metadata LV.  LVM will automatically create a metadata LV from the same VG.</p><p><strong>lvcreate -n CacheDataLV -L CacheSize VG</strong></p><p><strong>lvconvert --cachepool VG/CacheDataLV</strong></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO lvmcache&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/lvm.conf.5.html"><strong>lvm.conf</strong>(5)</a>, <a href="../man8/lvchange.8.html"><strong>lvchange</strong>(8)</a>, <a href="../man8/lvcreate.8.html"><strong>lvcreate</strong>(8)</a>, <a href="../man8/lvdisplay.8.html"><strong>lvdisplay</strong>(8)</a>, <a href="../man8/lvextend.8.html"><strong>lvextend</strong>(8)</a>, <a href="../man8/lvremove.8.html"><strong>lvremove</strong>(8)</a>, <a href="../man8/lvrename.8.html"><strong>lvrename</strong>(8)</a>, <a href="../man8/lvresize.8.html"><strong>lvresize</strong>(8)</a>, <a href="../man8/lvs.8.html"><strong>lvs</strong>(8)</a>, <a href="../man8/vgchange.8.html"><strong>vgchange</strong>(8)</a>, <a href="../man8/vgmerge.8.html"><strong>vgmerge</strong>(8)</a>, <a href="../man8/vgreduce.8.html"><strong>vgreduce</strong>(8)</a>, <a href="../man8/vgsplit.8.html"><strong>vgsplit</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lutefisk-doc.7.html"><span aria-hidden="true">&larr;</span> lutefisk-doc.7: Software for the de novo interpretation of peptide cid spectra (documentation)</a></li>
   <li class="next"><a href="lvmthin.7.html">lvmthin.7: Lvmthin  lvm thin provisioning <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
