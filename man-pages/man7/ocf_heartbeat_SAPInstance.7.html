<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ocf_heartbeat_SAPInstance: Manages a sap instance as an ha resource.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Manages a sap instance as an ha resource.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ocf_heartbeat_SAPInstance (7) manual">
  <meta name="twitter:description" content="Manages a sap instance as an ha resource.">
  <meta name="twitter:image" content="https://www.carta.tech/images/resource-agents-ocf_heartbeat_SAPInstance-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/ocf_heartbeat_SAPInstance.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ocf_heartbeat_SAPInstance (7) manual" />
  <meta property="og:description" content="Manages a sap instance as an ha resource." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/resource-agents-ocf_heartbeat_SAPInstance-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ocf_heartbeat_SAPInstance<small> (7)</small></h1>
        <p class="lead">Manages a sap instance as an ha resource.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/ocf_heartbeat_SAPInstance.7.html">
      <span itemprop="name">ocf_heartbeat_SAPInstance: Manages a sap instance as an ha resource.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/resource-agents/">
      <span itemprop="name">resource-agents</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/ocf_heartbeat_SAPInstance.7.html">
      <span itemprop="name">ocf_heartbeat_SAPInstance: Manages a sap instance as an ha resource.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>SAPInstance</strong> [start | stop | status | monitor | promote | demote | meta-data | validate-all]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Usually a SAP system consists of one database and at least one or more SAP instances (sometimes called application servers). One SAP Instance is defined by having exactly one instance profile. The instance profiles can usually be found in the directory /sapmnt/SID/profile. Each instance must be configured as it&apos;s own resource in the cluster configuration. The resource agent supports the following SAP versions:</p><p>- SAP WebAS ABAP Release 6.20 - 7.30</p><p>- SAP WebAS Java Release 6.40 - 7.30</p><p>- SAP WebAS ABAP + Java Add-In Release 6.20 - 7.30 (Java is not monitored by the cluster in that case) When using a SAP Kernel 6.40 please check and implement the actions from the section "Manual postprocessing" from SAP note 995116 (http://sdn.sap.com).</p><p>All operations of the SAPInstance resource agent are done by using the startup framework called SAP Management Console or sapstartsrv that was introduced with SAP kernel release 6.40. Find more information about the SAP Management Console in SAP note 1014480. Using this framework defines a clear interface for the Heartbeat cluster, how it sees the SAP system. The options for monitoring the SAP system are also much better than other methods like just watching the ps command for running processes or doing some pings to the application. sapstartsrv uses SOAP messages to request the status of running SAP processes. Therefore it can actually ask a process itself what it&apos;s status is, independent from other problems that might exist at the same time.</p><p>sapstartsrv knows 4 status colours:</p><p>- GREEN = everything is fine</p><p>- YELLOW = something is wrong, but the service is still working</p><p>- RED = the service does not work</p><p>- GRAY = the service has not been started</p><p>The SAPInstance resource agent will interpret GREEN and YELLOW as OK. That means that minor problems will not be reported to the Heartbeat cluster. This prevents the cluster from doing an unwanted failover. The statuses RED and GRAY are reported as NOT_RUNNING to the cluster. Depending on the status the cluster expects from the resource, it will do a restart, failover or just nothing.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORTED PARAMETERS</h2>
        <div class="sectioncontent">
<p><strong>InstanceName</strong></p><p>The full qualified SAP instance name. e.g. P01_DVEBMGS00_sapp01ci. Usually this is the name of the SAP instance profile.</p><p>(unique, required, string, no default)</p><p><strong>DIR_EXECUTABLE</strong></p><p>The full qualified path where to find sapstartsrv and sapcontrol. Specify this parameter, if you have changed the SAP kernel directory location after the default SAP installation.</p><p>(optional, string, no default)</p><p><strong>DIR_PROFILE</strong></p><p>The full qualified path where to find the SAP START profile. Specify this parameter, if you have changed the SAP profile directory location after the default SAP installation.</p><p>(optional, string, no default)</p><p><strong>START_PROFILE</strong></p><p>The name of the SAP START profile. Specify this parameter, if you have changed the name of the SAP START profile after the default SAP installation. As SAP release 7.10 does not have a START profile anymore, you need to specify the Instance Profile than.</p><p>(unique, optional, string, no default)</p><p><strong>START_WAITTIME</strong></p><p>After that time in seconds a monitor operation is executed by the resource agent. Does the monitor return SUCCESS, the start ishandled as SUCCESS. This is useful to resolve timing problems with e.g. the J2EE-Addin instance.Usually the resource agent waits until all services are started and the SAP Management Console reports a GREEN status. A double stack installation (ABAP + Java AddIn) consists of an ABAP dispatcher and aJAVA instance. Normally the start of the JAVA instance takes much longer than the start of the ABAP instance. For a JAVA Instance you may need to configure a much higher timeout for the start operation of the resource in Heartbeat. The disadvantage here is, that the discovery of a failed start by the cluster takes longer. Somebody might say: For me it is important, that the ABAP instance is up and running. A failure of the JAVA instance shall not cause a failover of the SAP instance. Actually the SAP MC reports a YELLOW status, if the JAVA instance of a double stack system fails. From the resource agent point of view YELLOW means:everything is OK. Setting START_WAITTIME to a lower value determines the resource agent to check the status of the instance during a start operation after that time. As it would wait normally for a GREEN status, now it reports SUCCESS to the cluster in case of a YELLOW status already after the specified time.</p><p>That is only useful for double stack systems.</p><p>(optional, string, default "3600")</p><p><strong>AUTOMATIC_RECOVER</strong></p><p>The SAPInstance resource agent tries to recover a failed start attempt automaticaly one time. This is done by killing runing instance processes, removing the kill.sap file and executing cleanipc. Sometimes a crashed SAP instance leaves some processes and/or shared memory segments behind. Setting this option to true will try to remove those leftovers during a start operation. That is to reduce manual work for the administrator.</p><p>(optional, boolean, default false)</p><p><strong>MONITOR_SERVICES</strong></p><p>Within a SAP instance there can be several services. Usually you will find the defined services in the START profile of the related instance (Attention: with SAP Release 7.10 the START profile content was moved to the instance profile). Not all of those services are worth to monitor by the cluster. For example you properly do not like to failover your SAP instance, if the central syslog collector daemon fails. Those services are monitored within the SAPInstance resource agent:</p><p>- disp+work</p><p>- msg_server</p><p>- enserver</p><p>- enrepserver</p><p>- jcontrol</p><p>- jstart</p><p>That names match the strings used in the output of the command &apos;sapcontrol -nr [Instance-Nr] -function GetProcessList&apos;. The default should fit most cases where you want to manage a SAP Instance from the cluster. You may change this with this parameter, if you like to monitor more/less or other services that sapstartsrv supports. You may specify multiple services seperated by a | (pipe) sign in this parameter: disp+work|msg_server|enserver</p><p>(optional, string, default "disp+work|msg_server|enserver|enrepserver|jcontrol|jstart")</p><p><strong>SHUTDOWN_METHOD</strong></p><p>Usual a SAP Instance is stopped by the command &apos;sapcontrol -nr InstanceNr -function Stop&apos;. SHUTDOWN_METHOD=KILL means to kill the SAP Instance using OS commands. SAP processes of the instance are terminated with &apos;kill -9&apos;, shared memory is deleted with &apos;cleanipc&apos; and the &apos;kill.sap&apos; file will be deleted. That method is much faster than the gracefull stop, but the instance does not have the chance to say goodbye to other SAPinstances in the same system. USE AT YOUR OWN RISK !!</p><p>(optional, string, default "normal")</p><p><strong>ERS_InstanceName</strong></p><p>Only used in a Master/Slave resource configuration: The full qualified SAP enqueue replication instance name. e.g. P01_ERS02_sapp01ers. Usually this is the name of the SAP instance profile. The enqueue replication instance must be installed, before you want to configure a master-slave cluster recource.</p><p>The master-slave configuration in the cluster must use this properties: clone_max = 2 clone_node_max = 1 master_node_max = 1 master_max = 1</p><p>(unique, optional, string, no default)</p><p><strong>ERS_START_PROFILE</strong></p><p>Only used in a Master/Slave resource configuration: The parameter ERS_InstanceName must also be set in this configuration. The name of the SAP START profile. Specify this parameter, if you have changed the name of the SAP START profile after the default SAP installation. As SAP release 7.10 does not have a START profile anymore, you need to specify the Instance Profile than.</p><p>(unique, optional, string, no default)</p><p><strong>PRE_START_USEREXIT</strong></p><p>The full qualified path where to find a script or program which should be executed before this resource gets started.</p><p>(optional, string, no default)</p><p><strong>POST_START_USEREXIT</strong></p><p>The full qualified path where to find a script or program which should be executed after this resource got started.</p><p>(optional, string, no default)</p><p><strong>PRE_STOP_USEREXIT</strong></p><p>The full qualified path where to find a script or program which should be executed before this resource gets stopped.</p><p>(optional, string, no default)</p><p><strong>POST_STOP_USEREXIT</strong></p><p>The full qualified path where to find a script or program which should be executed after this resource got stopped.</p><p>(optional, string, no default)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORTED ACTIONS</h2>
        <div class="sectioncontent">
<p>This resource agent supports the following actions (operations):</p><p><strong>start</strong></p><p>Starts the resource. Suggested minimum timeout: 180.</p><p><strong>stop</strong></p><p>Stops the resource. Suggested minimum timeout: 240.</p><p><strong>status</strong></p><p>Performs a status check. Suggested minimum timeout: 60.</p><p><strong>monitor</strong></p><p>Performs a detailed status check. Suggested minimum timeout: 60. Suggested interval: 120.</p><p><strong>promote</strong></p><p>Promotes the resource to the Master role. Suggested minimum timeout: 320.</p><p><strong>demote</strong></p><p>Demotes the resource to the Slave role. Suggested minimum timeout: 320.</p><p><strong>validate-all</strong></p><p>Performs a validation of the resource configuration. Suggested minimum timeout: 5.</p><p><strong>meta-data</strong></p><p>Retrieves resource agent metadata (internal use only). Suggested minimum timeout: 5.</p><p><strong>methods</strong></p><p>Suggested minimum timeout: 5.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>The following is an example configuration for a SAPInstance resource using the <strong>crm</strong>(8) shell:</p>
<pre>
primitive p_SAPInstance ocf:heartbeat:SAPInstance &#92;
  params &#92;
    InstanceName=<em>string</em> &#92;
  op monitor depth="0" timeout="60" interval="120"
</pre>

<pre>
ms ms_SAPInstance p_SAPInstance &#92;
  meta notify="true" interleave="true"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ocf_heartbeat_SAPInstance&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong>http://www.linux-ha.org/wiki/SAPInstance_(resource_agent)</strong>\m[]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Linux-HA contributors (see the resource agent source for information about individual authors)</strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ocf_heartbeat_SAPDatabase.7.html"><span aria-hidden="true">&larr;</span> ocf_heartbeat_SAPDatabase.7: Manages a sap database instance as an ha resource.</a></li>
   <li class="next"><a href="ocf_heartbeat_SendArp.7.html">ocf_heartbeat_SendArp.7: Broadcasts unsolicited arp announcements <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
