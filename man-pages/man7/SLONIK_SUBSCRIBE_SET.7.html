<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SLONIK_SUBSCRIBE_SET: Start replication of slony-i set</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Start replication of slony-i set">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="SLONIK_SUBSCRIBE_SET (7) manual">
  <meta name="twitter:description" content="Start replication of slony-i set">
  <meta name="twitter:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_SUBSCRIBE_SET-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/SLONIK_SUBSCRIBE_SET.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SLONIK_SUBSCRIBE_SET (7) manual" />
  <meta property="og:description" content="Start replication of slony-i set" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_SUBSCRIBE_SET-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">SLONIK_SUBSCRIBE_SET<small> (7)</small></h1>
        <p class="lead">Start replication of slony-i set</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_SUBSCRIBE_SET.7.html">
      <span itemprop="name">SLONIK_SUBSCRIBE_SET: Start replication of slony-i set</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/slony1-2-doc/">
      <span itemprop="name">slony1-2-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_SUBSCRIBE_SET.7.html">
      <span itemprop="name">SLONIK_SUBSCRIBE_SET: Start replication of slony-i set</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>SUBSCRIBE SET (options);</strong> \kx</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This performs one of two actions:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Initiates replication for a replication set</p><p>Causes a node (subscriber) to start replicating a set of tables either from the origin or from another provider node, which must itself already be be an active, forwarding subscriber.</p><p>The application tables contained in the set must already exist and should ideally be empty. The current version of Slony-I will <em>not</em> attempt to copy the schema of the set. The replication daemon will start copying the current content of the set from the given provider and then try to catch up with any update activity that happened during that copy process. After successful subscription, the tables are guarded on the subscriber, using triggers, against accidental updates by the application.</p><p>If the tables on the subscriber are <em>not</em> empty, then the <strong>COPY</strong> SET event (which is part of the subscription process) may wind up doing more work than should be strictly necessary:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>It attempts to <strong>TRUNCATE</strong> the table, which will be efficient.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>If that fails (a foreign key relationship might prevent TRUNCATE from working), it uses <strong>DELETE</strong> to delete all \(oqold\(cq entries in the table</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Those old entries clutter up the table until it is next <strong>VACUUM</strong>ed <em>after</em> the subscription process is complete</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>The indices for the table will contain entries for the old, deleted entries, which will slow the process of inserting new entries into the index.</p>
  </dd>

</dl>
<p><strong>Warning</strong></p><p>This operation can take a (potentially distinctly) non-zero period of time. If you have a great deal of data in a particular set of tables, it may take hours or even (if \(oqa great deal\(cq indicates \(oqtens or hundreds gigabytes of data\(cq) possibly multiple days for this event to complete.</p><p>The <strong>SUBSCRIBE SET</strong> request will, nonetheless, return fairly much immediately, even though the work, being handled by the <strong>COPY SET</strong> event, is still in progress. If you need to set up subscriptions for a set of cascading nodes, you will need to wait for each subscriber to complete subscribing before submitting requests for subscriptions that use that node as a provider.</p>
<pre>
\*(T&lt; Slony-I: provider 2 is not an active forwarding node for replication set 1\*(T&gt;
</pre>
<p>In effect, such subscription requests will be ignored until the provider is ready.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Revising subscription information for already-subscribed provider/receiver pair of nodes.</p><p>If you need to revise subscription information for a set,provider,receiver combination you must submit the new information using this command, and the new configuration will be propagated throughout the replication network. The normal reason to revise this information is if you want to change the \*(T&lt;FORWARD\*(T&gt; status of a set on a particular receiver node. If you want to change the provider used by a particular node you should use the <strong>SLONIK RESUBSCRIBE <strong>NODE</strong>(7)</strong> command.</p>
  </dd>
  <dt>
    <p>\*(T&lt;ID = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>ID of the set to subscribe</p>
  </dd>
  <dt>
    <p>\*(T&lt;PROVIDER = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>Node ID of the data provider from which this node draws data.</p>
  </dd>
  <dt>
    <p>\*(T&lt;RECEIVER = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>Node ID of the new subscriber</p>
  </dd>
  <dt>
    <p>\*(T&lt;FORWARD = boolean \*(T&gt;</p>
  </dt>
  <dd>
    <p>Flag whether or not the new subscriber should store the log information during replication to make it possible candidate for the provider role for future nodes. Any node that is intended to be a candidate for FAILOVER <em>must</em> have <strong>FORWARD =</strong> yes.</p>
  </dd>
  <dt>
    <p>\*(T&lt;OMIT COPY = boolean \*(T&gt;</p>
  </dt>
  <dd>
    <p>Flag whether or not the subscription process should omit doing the <strong>COPY</strong> of the existing data in the set. In effect, use this option indicates \(oqTrust me, the data is already in sync!\(cq</p><p>This is notably useful for the following sorts of cases:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Major inter-version upgrades (<em>e.g. </em>- as from Slony-I 1.2 to 2.0) may be done quickly.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Cloning a \(oqmaster node\(cq. <strong>SLONIK CLONE <a href="../man7/PREPARE.7.html"><strong>PREPARE</strong>(7)</a></strong>/<strong>SLONIK CLONE <strong>FINISH</strong>(7)</strong></p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    
  </dd>

</dl>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
\*(T&lt;SUBSCRIBE SET (
   ID = 1,
   PROVIDER = 1,
   RECEIVER = 3,
   FORWARD = YES
);
  WAIT FOR EVENT(
    ORIGIN=1,
    CONFIRMED=ALL,
    WAIT ON=1
);

    \*(T&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FORWARDING BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>The <strong>FORWARD=boolean</strong> flag indicates whether the subscriber will store log information in tables &ldquo;sl_log_1&rdquo; [not available as a man page] and &ldquo;sl_log_2&rdquo; [not available as a man page]. Several implications fall from this...</p><p>By storing the data in these tables on the subscriber, there is some additional processing burden. If you are certain that you would never want to <strong>SLONIK MOVE <a href="../man7/SET.7.html"><strong>SET</strong>(7)</a></strong> or <strong>SLONIK <strong>FAILOVER</strong>(7)</strong> to a particular subscriber, it is worth considering turning off forwarding on that node.</p><p>There is, however, a case where having forwarding turned off opens up a perhaps-unexpected failure condition; a rule of thumb should be that <em>all nodes that connect directly to</em> the origin should have forwarding turned on. Supposing one such \(oqdirect subscriber\(cq has forwarding turned off, it is possible for that node to be forcibly lost in a case of failover. The problem comes if that node gets ahead of other nodes.</p><p>Let's suppose that the origin, node 1 is at SYNC number 88901, a non-forwarding node, node 2 has processed up to SYNC 88897, and other forwarding nodes, 3, 4, and 5, have only processed data up to SYNC 88895. At that moment, the disk system on the origin node catches fire. Node 2 has the <em>data</em> up to SYNC 88897, but there is no remaining node that contains, in &ldquo;sl_log_1&rdquo; [not available as a man page] or &ldquo;sl_log_2&rdquo; [not available as a man page], the data for SYNCs 88896 and 88897, so there is no way to bring nodes 3-5 up to that point.</p><p>At that point, there are only two choices: To drop node 2, because there is no way to continue managing it, or to drop all nodes <em>but</em> 2, because there is no way to bring them up to SYNC 88897.</p><p>That dilemma may be avoided by making sure that all nodes directly subscribing to the origin have forwarding turned on.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DANGEROUS/UNINTUITIVE BEHAVIOUR </h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>The fact that the request returns immediately even though the subscription may take considerable time to complete may be a bit surprising.</p><p>Processing of the subscription involves <em>two</em> events; the <strong>SUBSCRIBE_SET</strong>, initiated on the set origin node, and an <strong>ENABLE_SUBSCRIPTION</strong>. This means that <strong>SLONIK WAIT FOR <strong>EVENT</strong>(7)</strong> must be used following a SUBSCRIBE SET to wait until the last event on the set origin completes.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>This command has <em>two</em> purposes; setting up subscriptions (which should be unsurprising) and <em>revising subscriptions</em>, which isn't so obvious to intuition.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>New subscriptions are set up by using <strong>DELETE</strong> or <strong>TRUNCATE</strong> to empty the table on a subscriber. If you created a new node by copying data from an existing node, it might \(oqseem intuitive\(cq that that data should be kept; that is not the case - the former contents are discarded and the node is populated <em>from scratch</em>.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>The <strong>OMIT COPY</strong> option has the potential to be a large \(oqfoot gun\(cq in that it allows the administrator to push replication sets out of sync.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOCKING BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>This operation does <em>not</em> require acquiring any locks on the provider node.</p><p>On the subscriber node, it will have the effect of locking every table in the replication set. In version 1.2 and later, exclusive locks are acquired at the beginning of the process.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SLONIK EVENT CONFIRMATION BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Slonik waits until the provider has confirmed all outstanding configuration events from any other node before contacting the provider to determine the set origin. Slonik then waits for the command submitted to the previous event node to be confirmed on the origin before submitting this command to the origin.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION INFORMATION </h2>
        <div class="sectioncontent">
<p>This command was introduced in Slony-I 1.0</p><p>The <strong>OMIT COPY</strong> option was introduced in Slony-I 2.0.3.</p><p>In Slony-I 2.0.5 the SUBSCRIBE SET command gets submitted directly against the set origin. Prior to this change the SUBSCRIBE SET was submitted against the provider</p><p>Prior to Slony-I 2.2.0 the SUBSCRIBE SET command could be used to change the provider of an already subscribed node. As of 2.2.0 the <strong>SLONIK RESUBSCRIBE <strong>NODE</strong>(7)</strong> command must be used.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="SLONIK_STORE_TRIGGER.7.html"><span aria-hidden="true">&larr;</span> SLONIK_STORE_TRIGGER.7: Indicate that a trigger should not be disabled by slony-i on a subscriber node</a></li>
   <li class="next"><a href="SLONIK_SYNC.7.html">SLONIK_SYNC.7: Generate an ordinary sync event <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
