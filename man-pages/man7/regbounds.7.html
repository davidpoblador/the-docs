<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>regbounds: Region boundaries</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Region boundaries">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="regbounds (7) manual">
  <meta name="twitter:description" content="Region boundaries">
  <meta name="twitter:image" content="https://www.carta.tech/images/libfuntools-dev-regbounds-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/regbounds.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="regbounds (7) manual" />
  <meta property="og:description" content="Region boundaries" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libfuntools-dev-regbounds-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">regbounds<small> (7)</small></h1>
        <p class="lead">Region boundaries</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/regbounds.7.html">
      <span itemprop="name">regbounds: Region boundaries</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libfuntools-dev/">
      <span itemprop="name">libfuntools-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/regbounds.7.html">
      <span itemprop="name">regbounds: Region boundaries</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Describes how spatial region boundaries are handled.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The golden rule for spatial region filtering was first enunciated by Leon VanSpeybroeck in 1986:</p><p>Each photon will be counted once, and no photon will be counted more than once.</p><p>This means that we must be careful about boundary conditions.  For example, if a circle is contained in an annulus such that the inner radius of the annulus is the same as the radius of the circle, then photons on that boundary must always be assigned to one or the other region. That is, the number of photons in both regions must equal the sum of the number of photons in each region taken separately.</p><p>With this in mind, the rules for determining whether a boundary image pixel or table row are assigned to a region are defined below.</p><p>Image boundaries  -  radially-symmetric shapes (circle, annuli, ellipse)</p><p>For image filtering, pixels whose center is inside the boundary are included.  This also applies non-radially-symmetric shapes.  When a pixel center is exactly on the boundary, the pixel assignment rule is:</p><ul>
<li><p>the outer boundary of a symmetric shape does not include such pixels</p></li><li><p>the inner boundary of a symmetric shape (annulus) includes such pixels</p></li>
</ul><p>In this way, an annulus with radius from 0 to 1, centered exactly on a pixel, includes the pixel on which it is centered, but none of its neighbors.</p><p>These rules ensure that when defining concentric shapes, no pixels are omitted between concentric regions and no pixels are claimed by two regions.  When applied to small symmetric shapes, the shape is less likely to be skewed, as would happen with non-radially-symmetric rules.  These rules differ from the rules for box-like shapes, which are more likely to be positioned adjacent to one another.</p><p>Image Boundaries -  non-radially symmetric shapes (polygons, boxes)</p><p>For image filtering, pixels whose center is inside the boundary are included. This also applies radially-symmetric shapes.  When a pixel center is exactly on the boundary of a non-radially symmetric region, the pixel is included in the right or upper region, but not the left or lower region.  This ensures that geometrically adjoining regions touch but don't overlap.</p><p><strong>Row Boundaries are Analytic</strong></p><p>When filtering table rows, the boundary rules are the same as for images, except that the calculation is not done on the center of a pixel, (since table rows, especially X\-ray events rows, often have discrete, floating point positions) but are calculated exactly. That is, an row is inside the boundary without regard to its integerized pixel value.  For rows that are exactly on a region boundary, the above rules are applied to ensure that all rows are counted once and no row is counted more than once.</p><p>Because row boundaries are calculated differently from image boundaries, certain programs will give different results when filtering the same region file. In particular, fundisp/funtable (which utilize analytic row filtering) perform differently from funcnts (which performs image filtering, even on tables).</p><p>Image Boundaries vs. Row Boundaries -  Practical Considerations</p><p>You will sometimes notice a discrepancy between running funcnts on an binary table file and running fundisp on the same file with the same filter. For example, consider the following:</p>
<pre>
  fundisp test1.fits"[box(4219,3887,6,6,0)]" | wc
  8893  320148 3752846
</pre>
<p>Since fundisp has a 2\-line header, there are actually 8891 photons that pass the filter.  But then run funtable and select only the rows that pass this filter, placing them in a new file:</p><p>  ./funtable test1.fits"[box(4219,3887,6,6,0)]" test2.fits</p><p>Now run funcnts using the original filter on the derived file:</p><p>  ./funcnts test2.fits "physical; box(4219,3887,6,6,0)"</p><p>  [... lot of processed output ...]</p><p>  # the following source and background components were used:   source region(s)   ----------------   physical; box(4219,3887,6,6,0)</p><p>   reg       counts    pixels   ---- ------------ ---------      1     7847.000        36</p><p>There are 1044 rows (events) that pass the row filter in fundisp (or funtable) but fail to make it through funcnts. Why?</p><p>The reason can be traced to how analytic row filtering (fundisp, funtable) differs from integerized pixel filtering(funcnts, funimage). Consider the region:</p><p>  box(4219,3887,6,6,0)</p><p>Analytically (i.e., using row filtering), positions will pass this filter successfully if:</p><p>  4216 &lt;= x &lt;= 4222   3884 &lt;= y &lt;= 3890</p><p>For example, photons with position values of x=4216.4 or y=3884.08 will pass.</p><p>Integerized image filtering is different in that the pixels that will pass this filter have centers at:</p><p>  x = 4217, 4218, 4219, 4220, 4221, 4222   y = 3885, 3886, 3887, 3888, 3889, 3890</p><p>Note that there are 6 pixels in each direction, as specified by the region. That means that positions will pass the filter successfully if:</p><p>  4217 &lt;= (int)x &lt;= 4222   3885 &lt;= (int)y &lt;= 3890</p><p>Photons with position values of x=4216.4 or y=3884.08 will \s-1NOT\s0 pass.</p><p>Note that the position values are integerized, in effect, binned into image values.  This means that x=4222.4 will pass this filter, but not the analytic filter above. We do this to maintain the design goal that either all counts in a pixel are included in an integerized filter, or else none are included.</p><p>[It could be argued that the correct photon limits for floating point row data really should be:</p><p>  4216.5 &lt;= x &lt;= 4222.5   3884.5 &lt;= y &lt;= 3890.5</p><p>since each pixel extends for .5 on either side of the center. We chose to the maintain integerized algorithm for all image-style filtering so that funcnts would give the exact same results regardless of whether a table or a derived non-blocked binned image is used.]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO regbounds&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/funtools.7.html"><strong>funtools</strong>(7)</a> for a list of Funtools help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="regalgebra.7.html"><span aria-hidden="true">&larr;</span> regalgebra.7: Boolean algebra on spatial regions</a></li>
   <li class="next"><a href="regcoords.7.html">regcoords.7: Spatial region coordinates <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
