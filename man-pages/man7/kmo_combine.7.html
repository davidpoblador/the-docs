<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>kmo_combine: Combine reconstructed cubes</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Combine reconstructed cubes">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="kmo_combine (7) manual">
  <meta name="twitter:description" content="Combine reconstructed cubes">
  <meta name="twitter:image" content="https://www.carta.tech/images/cpl-plugin-kmos-doc-kmo_combine-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/kmo_combine.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="kmo_combine (7) manual" />
  <meta property="og:description" content="Combine reconstructed cubes" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cpl-plugin-kmos-doc-kmo_combine-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">kmo_combine<small> (7)</small></h1>
        <p class="lead">Combine reconstructed cubes</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/kmo_combine.7.html">
      <span itemprop="name">kmo_combine: Combine reconstructed cubes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cpl-plugin-kmos-doc/">
      <span itemprop="name">cpl-plugin-kmos-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/kmo_combine.7.html">
      <span itemprop="name">kmo_combine: Combine reconstructed cubes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>esorex <strong>kmo_combine</strong> [OPTIONS] FILE.sof</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This recipe shifts several exposures of an object and combines them. The diffe- rent methods to match the exposures are described below (--method parameter).</p><p>The output cube is larger than the input cubes, according to the shifts to be applied. Additionally a border of NaN values is added. The WCS is the same as for the first exposure.</p><p>For each spatial/spectral pixel a new value will be calculated (according the --cmethod parameter) and written into the output cube.</p><p>Only exposures with equal orientation regarding the WCS can be combined (except -–method=”none”), north must point to the same direction. It is recommended to apply any rotation possibly after combining.</p><p>The behavior of the selection of IFUs to combine differs for some templates and can be controlled with the parameters --name and --ifus.</p><p>If the input data cubes stem from templates KMOS_spec_obs_mapping8 or KMOS_spec_obs_mapping24 all extensions from all input frames are combined into a single map by default (like in recipe kmo_sci_red). If just the area of a specific IFU should be combined, the parameter --ifus can be specified, or more easily --name.</p><p>If the input data cubes stem from other templates like e.g.</p><p>KMOS_spec_obs_freedither all extensions of all input frames are combined into several output frames by default. The input IFUs are grouped according their targeted object name stored in the keywords ESO OCS ARMx NAME. If just a specific object should be combined, its name can be specified with parameter --name. If arbitrary IFUs shoukd be comined, one can specify these with the parameter --ifus.</p><p>The default mapping mode is done via the --name parameter, where the name of the object has to be provided. The recipe searches in all input data cubes IFUs pointing to that object.</p><h3>BASIC PARAMETERS</h3>
<p>--name --ifus Since an object can be present only once per exposure and since it can be located in different IFUs for the existing exposures, there are two modes to identify the objects:</p>
<pre>
   * Combine by object names (default)
   In this case the object name must be provided via the --name parameter. The
   object name will be searched for in all primary headers of all provided frames
   in the keyword ESO OCS ARMx NAME.
</pre>

<pre>
   * Combine by index (advanced)
   In this case the --ifus parameter must be provided. The parameter must have
   the same number of entries as frames are provided, e.g. "3;1;24" for 3 expo-
   sures. The index doesn\'t reference the extension in the frame but the real
   index of the IFU as defined in the EXTNAME keyword (e.g. \'IFU.3.DATA\').
</pre>
<p>--method There are following sources to get the shift parameters from:</p>
<pre>
   * \'none\' (default)
   The cubes are directly recombined, not shifting at all. The output frame will
   have the same dimensions as the input cubes.
</pre>

<pre>
   If the size differs a warning will be emitted and the cubes will be aligned
   to the lower left corner. If the orientation differs a warning will be emit-
   ted, but the cubes are combined anyway.
</pre>

<pre>
   * \'header\'
   The shifts are calculated according to the WCS information stored in the
   header of every IFU. The output frame will get larger, except the object is
   at the exact same position for all exposures. The size of the exposures can
   differ, but the orientation must be the same for all exposures.
</pre>

<pre>
   * \'center\'
   The shifts are calculated using a centering algorithm. The cube will be col-
   lapsed and a 2D profile will be fitted to it to identify the centre. With
   the parameter --fmethod the function to fit can be provided. The size of the
   exposures can differ, but the orientation must be the same for all exposures.
</pre>

<pre>
   * \'user\'
   Read the shifts from a user specified file. The path of the file must be pro-
   vided using the --filename parameter. For every exposure (except the first one)
   two shift values are expected per line, they have to be separated with simple
   spaces. The values indicate pixel shifts and are referenced to the first
   frame. The 1st value is the shift in x-direction to the left, the 2nd the
   shift in y-direction upwards. The size of the exposures can differ, but the
   orientation must be the same for all exposures.
</pre>
<p>--cmethod Following methods of frame combination are available:</p>
<pre>
   * \'ksigma\' (Default)
   An iterative sigma clipping. For each position all pixels in the spectrum
   are examined. If they deviate significantly, they will be rejected according
   to the conditions:
       val &gt; mean + stdev * cpos_rej
   and
       val &lt; mean - stdev * cneg_rej
   where --cpos_rej, --cneg_rej and --citer are the corresponding configuration
   parameters. In the first iteration median and percentile level are used.
</pre>

<pre>
   * \'median\'
   At each pixel position the median is calculated.
</pre>

<pre>
   * \'average\'
   At each pixel position the average is calculated.
</pre>

<pre>
   * \'sum\'
   At each pixel position the sum is calculated.
</pre>

<pre>
   * \'min_max\'
   The specified number of minimum and maximum pixel values will be rejected.
</pre>

<pre>
   --cmax and --cmin apply to this method.
</pre>

<h3>ADVANCED PARAMETERS</h3>
<p>--edge_nan Set borders of two sides of the cubes to NaN before combining them. This minimises unwanted border effects when dithering.</p><p>--fmethod see --method=\'center\' The type of function that should be fitted spatially to the collapsed image.</p><p>This fit is used to create a mask to extract the spectrum of the object. Valid values are “gauss” and “moffat”.</p><p>--filename see --method=\'user\'</p><p>--cpos_rej --cneg_rej --citer see --cmethod=\'ksigma\'</p><p>--cmax --cmin see --cmethod=\'min_max\'</p><p>--flux Specify if flux conservation should be applied.</p><p>--suppress_extension If set to TRUE, the arbitrary filename extensions are supressed. If multiple products with the same category are produced, they will be numered consecutively starting from 0.</p>
<pre>
  Input files:
</pre>

<pre>
   DO                      KMOS
   category                Type   Explanation                  Required #Frames
   --------                -----  -----------                  -------- -------
   &lt;none or any&gt;           F3I    data frame                       Y      2-n
</pre>

<pre>
  Output files:
</pre>

<pre>
   DO                      KMOS
   category                Type   Explanation
   --------                -----  -----------
   COMBINE_&lt;ESO PRO CATG&gt;  F3I    Combined data cube
   EXP_MASK_&lt;ESO PRO CATG&gt; F3I    Exposure time mask
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>--name</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>Name of the object to combine. (str; default: \'\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.name</strong> [default = <em></em>].</p>
  </dd>
  <dt>
    <p><strong>--ifus</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>The indices of the IFUs to combine. "ifu1;ifu2;..." (str; default: \'\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.ifus</strong> [default = <em></em>].</p>
  </dd>
  <dt>
    <p><strong>--method</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>The shifting method:   \'none\': no shifting, combined directly (default), \'header\': shift according to WCS, \'center\': centering algorithm, \'user\': read shifts from file (str; default: \'none\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.method</strong> [default = <em>none</em>].</p>
  </dd>
  <dt>
    <p><strong>--fmethod</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>The fitting method (applies only when method=\'center\'):   \'gauss\': fit a gauss function to collapsed image (default), \'moffat\': fit a moffat function to collapsed image (str; default: \'gauss\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.fmethod</strong> [default = <em>gauss</em>].</p>
  </dd>
  <dt>
    <p><strong>--filename</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>The path to the file with the shift vectors.(Applies only to method=\'user\') (str; default: \'\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.filename</strong> [default = <em></em>].</p>
  </dd>
  <dt>
    <p><strong>--flux</strong> <em>&lt;bool&gt;</em></p>
  </dt>
  <dd>
    <p>Apply flux conservation: (TRUE (apply) or FALSE (don\'t apply) (bool; default: False). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.flux</strong> [default = <em>False</em>].</p>
  </dd>
  <dt>
    <p><strong>--edge_nan</strong> <em>&lt;bool&gt;</em></p>
  </dt>
  <dd>
    <p>Set borders of cubes to NaN before combining them.(TRUE (apply) or FALSE (don\'t apply) (bool; default: False). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.edge_nan</strong> [default = <em>False</em>].</p>
  </dd>
  <dt>
    <p><strong>--suppress_extension</strong> <em>&lt;bool&gt;</em></p>
  </dt>
  <dd>
    <p>Suppress arbitrary filename extension.(TRUE (apply) or FALSE (don\'t apply) (bool; default: False). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.suppress_extension</strong> [default = <em>False</em>].</p>
  </dd>
  <dt>
    <p><strong>--cmethod</strong> <em>&lt;str&gt;</em></p>
  </dt>
  <dd>
    <p>Apply "average", "median", "sum", "min_max." or "ksigma". (str; default: \'ksigma\'). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.cmethod</strong> [default = <em>ksigma</em>].</p>
  </dd>
  <dt>
    <p><strong>--cpos_rej</strong> <em>&lt;float&gt;</em></p>
  </dt>
  <dd>
    <p>The positive rejection threshold for kappa-sigma-clipping (sigma). (float; default: 3.0). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.cpos_rej</strong> [default = <em>3.0</em>].</p>
  </dd>
  <dt>
    <p><strong>--cneg_rej</strong> <em>&lt;float&gt;</em></p>
  </dt>
  <dd>
    <p>The negative rejection threshold for kappa-sigma-clipping (sigma). (float; default: 3.0). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.cneg_rej</strong> [default = <em>3.0</em>].</p>
  </dd>
  <dt>
    <p><strong>--citer</strong> <em>&lt;long&gt;</em></p>
  </dt>
  <dd>
    <p>The number of iterations for kappa-sigma-clipping. (long; default: 3). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.citer</strong> [default = <em>3</em>].</p>
  </dd>
  <dt>
    <p><strong>--cmax</strong> <em>&lt;long&gt;</em></p>
  </dt>
  <dd>
    <p>The number of maximum pixel values to clip with min/max-clipping. (long; default: 1). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.cmax</strong> [default = <em>1</em>].</p>
  </dd>
  <dt>
    <p><strong>--cmin</strong> <em>&lt;long&gt;</em></p>
  </dt>
  <dd>
    <p>The number of minimum pixel values to clip with min/max-clipping. (long; default: 1). The full name of this option for the EsoRex configuration file is <strong>kmos.kmo_combine.cmin</strong> [default = <em>1</em>].</p>
  </dd>

</dl>
<p>Note that it is possible to create a configuration file containing these options, along with suitable default values. Please refer to the details provided by the 'esorex --help' command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO kmo_combine&hellip;</h2>
        <div class="sectioncontent">
<p>The full documentation for the kmos pipeline can be downloaded as a PDF file using the following URL:</p><ul>
<li><p><strong>ftp://ftp.eso.org/pub/dfs/pipelines/kmos/kmos-pipeline-manual-2.9.pdf</strong></p></li>
</ul><p>An overview over the existing ESO pipelines can be found on the web page <strong>http://www.eso.org/sci/software/pipelines/</strong>.</p><p>Basic documentation about the EsoRex program can be found at the esorex (1) man page.</p><p>It is possible to call the pipelines from python using the python-cpl package. See <strong>http://packages.python.org/python-cpl/index.html</strong> for further information.</p><p>The other recipes of the kmos pipeline are <a href="../man7/kmo_copy.7.html"><strong>kmo_copy</strong>(7)</a>, <a href="../man7/kmo_fits_check.7.html"><strong>kmo_fits_check</strong>(7)</a>, <a href="../man7/kmo_sci_red.7.html"><strong>kmo_sci_red</strong>(7)</a>, <a href="../man7/kmo_fits_stack.7.html"><strong>kmo_fits_stack</strong>(7)</a>, <a href="../man7/kmo_noise_map.7.html"><strong>kmo_noise_map</strong>(7)</a>, <a href="../man7/kmo_rotate.7.html"><strong>kmo_rotate</strong>(7)</a>, <a href="../man7/kmo_extract_spec.7.html"><strong>kmo_extract_spec</strong>(7)</a>, <a href="../man7/kmo_multi_reconstruct.7.html"><strong>kmo_multi_reconstruct</strong>(7)</a>, <a href="../man7/kmo_sky_tweak.7.html"><strong>kmo_sky_tweak</strong>(7)</a>, <a href="../man7/kmo_shift.7.html"><strong>kmo_shift</strong>(7)</a>, <a href="../man7/kmos_gen_reflines.7.html"><strong>kmos_gen_reflines</strong>(7)</a>, <a href="../man7/kmo_stats.7.html"><strong>kmo_stats</strong>(7)</a>, <a href="../man7/kmo_arithmetic.7.html"><strong>kmo_arithmetic</strong>(7)</a>, <a href="../man7/kmos_dark.7.html"><strong>kmos_dark</strong>(7)</a>, <a href="../man7/kmo_fits_strip.7.html"><strong>kmo_fits_strip</strong>(7)</a>, <a href="../man7/kmo_std_star.7.html"><strong>kmo_std_star</strong>(7)</a>, <a href="../man7/kmo_illumination_flat.7.html"><strong>kmo_illumination_flat</strong>(7)</a>, <a href="../man7/kmo_make_image.7.html"><strong>kmo_make_image</strong>(7)</a>, <a href="../man7/kmos_flat.7.html"><strong>kmos_flat</strong>(7)</a>, <a href="../man7/kmo_fit_profile.7.html"><strong>kmo_fit_profile</strong>(7)</a>, <a href="../man7/kmo_sky_mask.7.html"><strong>kmo_sky_mask</strong>(7)</a>, <a href="../man7/kmos_illumination.7.html"><strong>kmos_illumination</strong>(7)</a>, <a href="../man7/kmos_wave_cal.7.html"><strong>kmos_wave_cal</strong>(7)</a>, <a href="../man7/kmo_reconstruct.7.html"><strong>kmo_reconstruct</strong>(7)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>kmo_combine 1.3.5</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Alex Agudo Berbel &lt;usd-help@eso.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUG REPORTS</h2>
        <div class="sectioncontent">
<p>Please report any problems to usd-help@eso.org. Alternatively, you may send a report to the ESO User Support Department &lt;usd-help@eso.org&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>This file is part of the CRIRES Instrument Pipeline Copyright (C) 2002,2003 European Southern Observatory</p><p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="kmo_arithmetic.7.html"><span aria-hidden="true">&larr;</span> kmo_arithmetic.7: Perform basic arithmetic on cubes</a></li>
   <li class="next"><a href="kmo_copy.7.html">kmo_copy.7: Copy a section of a cube to another cube, image or spectrum <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
