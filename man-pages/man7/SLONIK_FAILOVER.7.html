<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SLONIK_FAILOVER: Fail a broken replication set over to a backup node</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Fail a broken replication set over to a backup node">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="SLONIK_FAILOVER (7) manual">
  <meta name="twitter:description" content="Fail a broken replication set over to a backup node">
  <meta name="twitter:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_FAILOVER-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/SLONIK_FAILOVER.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SLONIK_FAILOVER (7) manual" />
  <meta property="og:description" content="Fail a broken replication set over to a backup node" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_FAILOVER-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">SLONIK_FAILOVER<small> (7)</small></h1>
        <p class="lead">Fail a broken replication set over to a backup node</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_FAILOVER.7.html">
      <span itemprop="name">SLONIK_FAILOVER: Fail a broken replication set over to a backup node</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/slony1-2-doc/">
      <span itemprop="name">slony1-2-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_FAILOVER.7.html">
      <span itemprop="name">SLONIK_FAILOVER: Fail a broken replication set over to a backup node</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>FAILOVER (options);</strong> \kx</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>FAILOVER</strong> command causes the backup node to take over all sets that currently originate on the failed node. slonik will contact all other direct subscribers of the failed node to determine which node has the highest sync status for each set. If another node has a higher sync status than the backup node, the replication will first be redirected so that the backup node replicates against that other node, before assuming the origin role and allowing update activity.</p><p>After successful failover, all former direct subscribers of the failed node become direct subscribers of the backup node. The failed node is abandoned, and can and should be removed from the configuration with <strong>SLONIK DROP <strong>NODE</strong>(7)</strong>.</p><p>If multiple set origin nodes have failed, then you should tell FAILOVER about all of them in one request. This is done by passing a list like \*(T&lt;NODE=(ID=val,BACKUP NODE=val), NODE=(ID=val2, BACKUP NODE=val2)\*(T&gt; to FAILOVER.</p><p>Nodes that are forwarding providers can also be passed to the failover command as a failed node. The failover process will redirect the subscriptions from these nodes to the backup node.</p>
<dl class='dl-vertical'>
  <dt>
    <p>\*(T&lt;ID = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>ID of the failed node</p>
  </dd>
  <dt>
    <p>\*(T&lt;BACKUP NODE = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>Node ID of the node that will take over all sets originating on the failed node</p>
  </dd>

</dl>
<p>This uses &ldquo;schemadocfailednode(p_failed_nodes integer, p_backup_node integer, p_failed_node integer[])&rdquo; [not available as a man page].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
\*(T&lt;FAILOVER (
   ID = 1,
   BACKUP NODE = 2
);

#example of multiple nodes
FAILOVER(
   NODE=(ID=1, BACKUP NODE=2),
   NODE=(ID=3, BACKUP NODE=4)
);

	 \*(T&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOCKING BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Exclusive locks on each replicated table will be taken out on both the new origin node as replication triggers are changed. If the new origin was not completely up to date, and replication data must be drawn from some other node that is more up to date, the new origin will not become usable until those updates are complete.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DANGEROUS/UNINTUITIVE BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>This command will abandon the status of the failed node. There is no possibility to let the failed node join the cluster again without rebuilding it from scratch as a slave. If at all possible, you would likely prefer to use <strong>SLONIK MOVE <a href="../man7/SET.7.html"><strong>SET</strong>(7)</a></strong> instead, as that does <em>not</em> abandon the failed node.</p><p>If a second failure occours in the middle of a FAILOVER operation then recovery might be complicated.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SLONIK EVENT CONFIRMATION BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Slonik will submit the FAILOVER_EVENT without waiting but wait until the most ahead node has received confirmations of the FAILOVER_EVENT from all nodes before completing.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION INFORMATION </h2>
        <div class="sectioncontent">
<p>This command was introduced in Slony-I 1.0</p><p>In version 2.0, the default <strong>BACKUP NODE</strong> value of 1 was removed, so it is mandatory to provide a value for this parameter</p><p>In version 2.2 support was added for passing multiple nodes to a single failover command</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="SLONIK_EXIT.7.html"><span aria-hidden="true">&larr;</span> SLONIK_EXIT.7: Terminate slonik script with signal</a></li>
   <li class="next"><a href="SLONIK_INCLUDE.7.html">SLONIK_INCLUDE.7: Pulling in slonik code from another file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
