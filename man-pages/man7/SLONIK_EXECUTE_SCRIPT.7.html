<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SLONIK_EXECUTE_SCRIPT: Execute sql/ddl script</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Execute sql/ddl script">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="SLONIK_EXECUTE_SCRIPT (7) manual">
  <meta name="twitter:description" content="Execute sql/ddl script">
  <meta name="twitter:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_EXECUTE_SCRIPT-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/SLONIK_EXECUTE_SCRIPT.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SLONIK_EXECUTE_SCRIPT (7) manual" />
  <meta property="og:description" content="Execute sql/ddl script" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_EXECUTE_SCRIPT-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">SLONIK_EXECUTE_SCRIPT<small> (7)</small></h1>
        <p class="lead">Execute sql/ddl script</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_EXECUTE_SCRIPT.7.html">
      <span itemprop="name">SLONIK_EXECUTE_SCRIPT: Execute sql/ddl script</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/slony1-2-doc/">
      <span itemprop="name">slony1-2-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_EXECUTE_SCRIPT.7.html">
      <span itemprop="name">SLONIK_EXECUTE_SCRIPT: Execute sql/ddl script</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>EXECUTE SCRIPT (options);</strong> \kx</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Executes a script containing arbitrary SQL statements on all nodes that are subscribed to a set at a common controlled point within the replication transaction stream.</p><p>The specified event origin must be an origin of a set. The script file must not contain any <strong>START</strong> or <strong>COMMIT TRANSACTION</strong> calls but SAVEPOINTS are allowed. In addition, non-deterministic DML statements (like updating a field with \*(T&lt;<strong>CURRENT_TIMESTAMP</strong>\*(T&gt;) should be avoided, since the data changes done by the script will be different on each node.</p>
<dl class='dl-vertical'>
  <dt>
    <p>\*(T&lt;FILENAME = '/path/to/file' \*(T&gt;</p>
  </dt>
  <dd>
    <p>The name of the file containing the SQL script to execute. This might be a relative path, relative to the location of the slonik instance you are running, or, preferably, an absolute path on the system where slonik is to run.</p><p>The <em>contents</em> of the file are propagated as part of the replication data stream, so the file does not need to be accessible on any of the nodes.</p>
  </dd>
  <dt>
    <p>\*(T&lt;SQL = 'sql-string-to-execute' \*(T&gt;</p>
  </dt>
  <dd>
    <p>Instead of a filename the SQL statements to execute can be specified as a string literal in single quotes.</p>
  </dd>
  <dt>
    <p>\*(T&lt;EVENT NODE = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>(Mandatory unless EXECUTE ONLY ON is given) The ID of the current origin of the set. If EXECUTE ONLY ON is given, EVENT NODE must specify the same node or be omitted.</p>
  </dd>
  <dt>
    <p>\*(T&lt;EXECUTE ONLY ON = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>(Optional) The ID of the only node to actually execute the script. This can be a single node value or a comma separated list of nodes. This option causes the script to be propagated by all nodes but executed only on the specified nodes. The default is to execute the script on all nodes that are subscribed to the set.</p>
  </dd>

</dl>
<p>See also the warnings in &ldquo;Database Schema Changes (DDL)&rdquo; [not available as a man page].</p><p>Note that this is a potentially heavily-locking operation, which means that it can get stuck behind other database activity.</p><p>Note that if you need to make reference to the cluster name, you can use the token <strong>@CLUSTERNAME@</strong>; if you need to make reference to the Slony-I namespace, you can use the token <strong>@NAMESPACE@</strong>; both will be expanded into the appropriate replacement tokens.</p><p>This uses &ldquo;schemadocddlscript_complete(p_nodes text)&rdquo; [not available as a man page].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
\*(T&lt;EXECUTE SCRIPT (
   FILENAME = '/tmp/changes_2008-04-01.sql',
   EVENT NODE = 1
);

EXECUTE SCRIPT (
   FILENAME = '/tmp/changes_2008-04-01.sql',
   EVENT NODE = 1,
   EXECUTE ONLY ON='1,2,3'
);
    \*(T&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOCKING BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Up until the 2.0 branch, each replicated table received an exclusive lock, on the origin node, in order to remove the replication triggers; after the DDL script completes, those locks will be cleared. In the 2.0 branch this is no longer the case. EXECUTE SCRIPT won't obtain any locks on your application tables though the script that you executing probably will.</p><p>After the DDL script has run on the origin node, it will then run on subscriber nodes, where replicated tables will be similarly altered to remove replication triggers, therefore requiring that exclusive locks be taken out on each node, in turn.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SLONIK EVENT CONFIRMATION BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Slonik waits for the command submitted to the previous event node to be confirmed on the specified event node before submitting this command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION INFORMATION </h2>
        <div class="sectioncontent">
<p>This command was introduced in Slony-I 1.0.</p><p>Before Slony-I version 1.2, the entire DDL script was submitted as one \*(T&lt;<strong>PQexec()</strong>\*(T&gt; request, with the implication that the <em>entire</em> script was parsed based on the state of the database before invocation of the script. This means statements later in the script cannot depend on DDL changes made by earlier statements in the same script. Thus, you cannot add a column to a table and add constraints to that column later in the same request.</p><p>In Slony-I version 1.2, the DDL script is split into statements, and each statement is submitted separately. As a result, it is fine for later statements to refer to objects or attributes created or modified in earlier statements. Furthermore, in version 1.2, the <strong>slonik</strong> output includes a listing of each statement as it is processed, on the set origin node. Similarly, the statements processed are listed in slon logs on the other nodes.</p><p>In Slony-I version 1.0, this would only lock the tables in the specified replication set. As of 1.1 (until 2.0), <em>all</em> replicated tables are locked (<em>e.g.</em> - triggers are removed at the start, and restored at the end). This deals with the risk that one might request DDL changes on tables in multiple replication sets. With version 2.0 no locks on application tables are obtained by Slony-I</p><p>In version 2.0, the default value for <strong>EVENT</strong> NODE was removed, so a node must be specified.</p><p>As of version 2.0.7, the log triggers on all replicated tables are checked to ensure their parameters match the primary key on the table. If they <em>do not</em> match, those tables that are exclusively locked as a result of the DDL request will have the triggers recreated to match the primary key. Tables that do not have an exclusive lock will <em>not</em> be corrected, but a warning message will be generated. The function \*(T&lt;<strong>repair_log_triggers(only_locked boolean)</strong>\*(T&gt; may be used manually to correct the triggers on those tables.</p><p>As of version 2.2 the DDL performed by an EXECUTE SCRIPT is stored in the sl_log_script table instead of sl_event.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="SLONIK_ECHO.7.html"><span aria-hidden="true">&larr;</span> SLONIK_ECHO.7: Generic output tool</a></li>
   <li class="next"><a href="SLONIK_EXIT.7.html">SLONIK_EXIT.7: Terminate slonik script with signal <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
