<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SLONIK_SET_ADD_TABLE: Add a table to a slony-i replication set</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Add a table to a slony-i replication set">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="SLONIK_SET_ADD_TABLE (7) manual">
  <meta name="twitter:description" content="Add a table to a slony-i replication set">
  <meta name="twitter:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_SET_ADD_TABLE-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/SLONIK_SET_ADD_TABLE.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SLONIK_SET_ADD_TABLE (7) manual" />
  <meta property="og:description" content="Add a table to a slony-i replication set" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/slony1-2-doc-SLONIK_SET_ADD_TABLE-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">SLONIK_SET_ADD_TABLE<small> (7)</small></h1>
        <p class="lead">Add a table to a slony-i replication set</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_SET_ADD_TABLE.7.html">
      <span itemprop="name">SLONIK_SET_ADD_TABLE: Add a table to a slony-i replication set</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/slony1-2-doc/">
      <span itemprop="name">slony1-2-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/SLONIK_SET_ADD_TABLE.7.html">
      <span itemprop="name">SLONIK_SET_ADD_TABLE: Add a table to a slony-i replication set</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>SET ADD TABLE (options);</strong> \kx</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Add an existing user table to a replication set. The set cannot currently be subscribed by any other node - that functionality is supported by the <strong>SLONIK MERGE</strong> <a href="../man7/SET.7.html"><strong>SET</strong>(7)</a> command.</p>
<dl class='dl-vertical'>
  <dt>
    <p>\*(T&lt;SET ID = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>ID of the set to which the table is to be added.</p>
  </dd>
  <dt>
    <p>\*(T&lt;ORIGIN = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>Origin node for the set. (Optional)</p>
  </dd>
  <dt>
    <p>\*(T&lt;ID = ival \*(T&gt;</p>
  </dt>
  <dd>
    <p>Unique ID of the table. These ID's are not only used to uniquely identify the individual table within the replication system. The numeric value of this ID also determines the order in which the tables are locked in a <strong>SLONIK LOCK <a href="../man7/SET.7.html"><strong>SET</strong>(7)</a></strong> command for example. So these numbers might represent any applicable table hierarchy to make sure the slonik command scripts do not deadlock at any critical moment. If this parameter is omitted then slonik will check every node that it can connect to and find the highest table id being used across all nodes.</p><p>This ID must be unique across all sets; you cannot have two tables in the same cluster with the same ID.</p><p>Note that Slony-I generates an in-memory array indicating all of the fully qualified table names; if you use large table ID numbers, the sparsely-utilized array can lead to substantial wastage of memory. Each potential table ID consumes a pointer to a char, commonly costing 4 bytes per table ID on 32 bit architectures, and 8 bytes per table ID on 64 bit architectures.</p>
  </dd>
  <dt>
    <p>\*(T&lt;FULLY QUALIFIED NAME = 'string' \*(T&gt;</p>
  </dt>
  <dd>
    <p>The full table name including the name of the schema. This can be omitted if \*(T&lt;TABLES\*(T&gt; is specified instead</p>
  </dd>
  <dt>
    <p>\*(T&lt;KEY = { 'string' | SERIAL } \*(T&gt;</p>
  </dt>
  <dd>
    <p><em>(Optional)</em> The index name that covers the unique and not null set of columns to be used as the row identifier for replication purposes. Default is to use the table's primary key. The index name is <em>not </em>fully qualified; you must omit the namespace.</p>
  </dd>
  <dt>
    <p>\*(T&lt;TABLES = 'string' \*(T&gt;</p>
  </dt>
  <dd>
    <p>A POSIX regular expression that specifies the list of tables that should be added. This regular expression is evaluated by PostgreSQL against the list of fully qualified table names on the set origin to find the tables that should be added. If \*(T&lt;TABLES\*(T&gt; is omitted then \*(T&lt;FULLY QUALIFIED NAME\*(T&gt; must be specified.</p><p><strong>Warning</strong></p><p>The \*(T&lt;TABLES\*(T&gt; option requires that all the tables are in \(oqgood form\(cq to be replicated en masse. The request will fail, not configuring any tables for replication, if it encounters any of the following problems:</p>
<dl class='dl-vertical'>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>Each table must have a \*(T&lt;PRIMARY KEY\*(T&gt; defined, and a candidate primary key will not suffice.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>If a table is found that is already replicated, the request will fail.</p>
  </dd>
  <dt>
    <p>&bull;</p>
  </dt>
  <dd>
    <p>The \*(T&lt;TABLES\*(T&gt; option needs to automatically assign table ID values, and looks through the configuration on every node specified by <strong>SLONIK ADMIN <strong>CONNINFO</strong>(7)</strong>, finding the largest ID in use, and starting after that for the table IDs that it assigns.</p><p>It considers it a \(oqbenign\(cq failure to find a node that does not yet have a Slony-I schema assigned, as that may be expected to occur if tables are configured before all the nodes have been configured using <strong>SLONIK STORE <strong>NODE</strong>(7)</strong>. If there is no Slony-I schema, then that node certainly hasn't contributed anything to an increase in the table IDs in use.</p><p>On the other hand, if a node specified by <strong>SLONIK ADMIN <strong>CONNINFO</strong>(7)</strong> is not available to be queried, the request <em>will</em> fail.</p>
  </dd>

</dl>

  </dd>
  <dt>
    <p>\*(T&lt;COMMENT = 'string' \*(T&gt;</p>
  </dt>
  <dd>
    <p>A descriptive text added to the table entry.</p>
  </dd>
  <dt>
    <p>\*(T&lt;ADD SEQUENCES= boolean\*(T&gt;</p>
  </dt>
  <dd>
    <p>A boolean value that indicates if any sequences attached to columns in this table should also be automatically added to the replication set. This defaults to false</p>
  </dd>

</dl>
<p>This uses &ldquo;schemadocsetaddtable(p_tab_comment integer, p_tab_idxname integer, p_fqname text, p_tab_id name, p_set_id text)&rdquo; [not available as a man page].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
\*(T&lt;SET ADD TABLE (
    SET ID = 1,
    ORIGIN = 1,
    ID = 20,
    FULLY QUALIFIED NAME = 'public.tracker_ticket',
    COMMENT = 'Support ticket',
    ADD SEQUENCES=false
);

or

SET ADD TABLE (
    SET ID=1,
    TABLES='public&#92;&#92;.tracker*'
);

    \*(T&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERROR MESSAGES </h2>
        <div class="sectioncontent">
<p>Here are some of the error messages you may encounter if adding tables incorrectly:</p>
<dl class='dl-vertical'>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int: table public.my_table PK column id nullable \*(T&gt;</p>
  </dt>
  <dd>
    <p>Primary keys (or candidates thereof) are required to have all column defined as <strong>NOT</strong> NULL. If you have a PK candidate that has columns that are not thus restricted, Slony-I will reject the table with this message.</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int: table id 14 has already been assigned! \*(T&gt;</p>
  </dt>
  <dd>
    <p>The table id, stored in <strong>sl_table.tab_id</strong>, is required to be unique across all tables/nodes/sets. Apparently you have tried to reused a table ID.</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int(): table public.my_table has no index mt_idx_14\*(T&gt;</p>
  </dt>
  <dd>
    <p>This will normally occur with candidate primary keys; apparently the index specified is not available on this node.</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int(): table public.my_table not found \*(T&gt;</p>
  </dt>
  <dd>
    <p>Worse than an index missing, the whole table is missing. Apparently whatever process you were using to get the schema into place everywhere didn't work properly.</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int(): public.my_view is not a regular table \*(T&gt;</p>
  </dt>
  <dd>
    <p>You can only replicate (at least, using <strong>SET ADD TABLE</strong>) objects that are ordinary tables. That doesn't include views or indexes. (Indexes can come along for the ride, but you don't ask to replicate an index...)</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable_int(): set 4 not found \*(T&gt;</p>
  </dt>
  <dd>
    <p>You need to define a replication set before assigning tables to it.</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: setAddTable(): set 4 has remote origin \*(T&gt;</p>
  </dt>
  <dd>
    <p>This will occur if set 4 is configured with, as origin, node 1, and then you submit a <strong>SET ADD</strong> TABLE request involving that set to some other node than node 1. This would be expected to occur if there was some confusion in the <strong>admin conninfo</strong> configuration in the slonik script preamble...</p>
  </dd>
  <dt>
    <p>\*(T&lt;Slony-I: cannot add table to currently subscribed set 1 \*(T&gt;</p>
  </dt>
  <dd>
    <p>Slony-I does not support adding tables to sets that are already participating in subscriptions. Instead, you need to define a new replication set, and add any new tables to <em>that</em> set. You might then use <strong>SLONIK MERGE</strong> <a href="../man7/SET.7.html"><strong>SET</strong>(7)</a> to merge the new set into an existing one, if that seems appropriate.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOCKING BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>On the origin node, this operation requires a brief exclusive lock on the table in order to alter it to add replication triggers. On subscriber nodes, corresponding locking takes place at the time of the <strong>SUBSCRIBE_SET</strong> event.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SLONIK EVENT CONFIRMATION BEHAVIOUR </h2>
        <div class="sectioncontent">
<p>Slonik waits for the command submitted to the previous event node to be confirmed on the specified event node before submitting this command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION INFORMATION </h2>
        <div class="sectioncontent">
<p>This command was introduced in Slony-I 1.0</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="SLONIK_SET_ADD_SEQUENCE.7.html"><span aria-hidden="true">&larr;</span> SLONIK_SET_ADD_SEQUENCE.7: Add a sequence to a slony-i replication set</a></li>
   <li class="next"><a href="SLONIK_SET_DROP_SEQUENCE.7.html">SLONIK_SET_DROP_SEQUENCE.7: Remove a sequence from a slony-i replication set <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
