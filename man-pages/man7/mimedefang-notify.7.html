<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mimedefang-notify: Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mimedefang-notify (7) manual">
  <meta name="twitter:description" content="Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.">
  <meta name="twitter:image" content="https://www.carta.tech/images/mimedefang-mimedefang-notify-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/mimedefang-notify.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mimedefang-notify (7) manual" />
  <meta property="og:description" content="Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mimedefang-mimedefang-notify-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mimedefang-notify<small> (7)</small></h1>
        <p class="lead">Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/mimedefang-notify.7.html">
      <span itemprop="name">mimedefang-notify: Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mimedefang/">
      <span itemprop="name">mimedefang</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/mimedefang-notify.7.html">
      <span itemprop="name">mimedefang-notify: Conventions used by mimedefang-multiplexor(8) to notify an external program of state changes.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>If you supply the <strong>-O</strong> option to <strong>mimedefang-multiplexor</strong>, then it allows external programs to connect to a socket and be notified of certain state changes in the multiplexor.  The external programs can react in whatever way they choose to these state changes. The external program that listens for state changes is referred to as a <em>listener</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTIFICATION OVERVIEW</h2>
        <div class="sectioncontent">
<p>From the point of view of a listener, notification works like this:</p><p>1) The listener connects to a TCP or UNIX-domain socket.</p><p>2) The listener informs <strong>mimedefang-multiplexor</strong> of the <em>message types</em> it is interested in.</p><p>3) The listener loops, reading messages from the socket and reacting to them.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MESSAGES</h2>
        <div class="sectioncontent">
<p>Each message from the multiplexor normally consists of a single upper-case letter, possibly followed by a space and some arguments, and then followed by a newline.</p><p>Two special messages are "*OK" followed by a newline, which is issued when a listener first connects, and "*ERR" followed by some text and a newline, which is issued when an error occurs.</p><p>The normal messages are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>B</strong></p>
  </dt>
  <dd>
    <p>This message is issued whenever a slave is killed because of a busy timeout.</p>
  </dd>
  <dt>
    <p><strong>F</strong> <em>n</em></p>
  </dt>
  <dd>
    <p>This message is issued whenever the number of free slaves changes. The parameter <em>n</em> is the number of free slaves.</p>
  </dd>
  <dt>
    <p><strong>R</strong></p>
  </dt>
  <dd>
    <p>This message is issued whenever someone has forced a filter reread.</p>
  </dd>
  <dt>
    <p><strong>S</strong> <em>n</em> <em>nmsg</em></p>
  </dt>
  <dd>
    <p>This message is issued whenever slave <em>n</em>'s status tag changes.  The status tag is a string indicating what the slave is currently doing; the <strong>-Z</strong> option to the multiplexor allows the Perl code to update the status tag so you have a good idea what each slave is doing.</p>
  </dd>
  <dt>
    <p><strong>U</strong></p>
  </dt>
  <dd>
    <p>This message is issued whenever a slave has died unexpectedly.</p>
  </dd>
  <dt>
    <p><strong>Y</strong></p>
  </dt>
  <dd>
    <p>This message is issued whenever the number of free slaves changes from zero to non-zero.</p>
  </dd>
  <dt>
    <p><strong>Z</strong></p>
  </dt>
  <dd>
    <p>This message is issued whenever the number of free slaves falls to zero.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPRESSING INTEREST</h2>
        <div class="sectioncontent">
<p>A listener does not receive any messages until it has <em>expressed interest</em> in various message types.  To express interest, the listener should send a question mark ("?") followed by the types of messages it is interested in, followed by a newline over the socket.  For example, a listener interested in the R and F messages would send this line:</p><p>	?RF</p><p>A listener interested in every possible message type should send:</p><p>	?*</p><p>Once a listener has expressed interest, it may receive messages at any time, and should monitor the socket for messages.</p><p>Note that a listener <em>always</em> receives the special messages "*OK" and "*ERR", even if it has not expressed interest in them.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>The following Perl script implements a listener that, on Linux, rejects new SMTP connections if all slaves are busy, and accepts them again once a slave is free.  Existing SMTP connections are not shut down; the system merely refuses new connections if all the slaves are busy.</p><p>This script assumes that you have used the <strong>-O inet:4567</strong> option to <strong>mimedefang-multiplexor</strong>.</p>
<pre>
#!/usr/bin/perl -w
#
# On Linux, prepare to use this script like this:
#     /sbin/iptables -N smtp_connect
#     /sbin/iptables -A INPUT --proto tcp --dport 25 --syn -j smtp_connect
# Then run the script as root.

use IO::Socket::INET;

sub no_free_slaves {
    print STDERR "No free slaves!&#92;n";
    system("/sbin/iptables -A smtp_connect -j REJECT");
}

sub some_free_slaves {
    print STDERR "Some free slaves.&#92;n";
    system("/sbin/iptables -F smtp_connect");
}

sub main {
    my $sock;

    $sock = IO::Socket::INET-&gt;new(PeerAddr =&gt; '127.0.0.1',
                                  PeerPort =&gt; '4567',
                                  Proto =&gt; 'tcp');
    # We are only interested in Y and Z messages
    print $sock "?YZ&#92;n";
    $sock-&gt;flush();
    while(&lt;$sock&gt;) {
        if (/^Z/) {
            no_free_slaves();
        }
        if (/^Y/) {
            some_free_slaves();
        }
    }

    # EOF from multiplexor?? Better undo firewalling
    system("/sbin/iptables -F smtp_connect");
}

main();
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mimedefang-notify&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/mimedefang.pl.8.html"><strong>mimedefang.pl</strong>(8)</a>, <a href="../man8/mimedefang.8.html"><strong>mimedefang</strong>(8)</a>, <a href="../man8/mimedefang-multiplexor.8.html"><strong>mimedefang-multiplexor</strong>(8)</a>, <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="midi.7.html"><span aria-hidden="true">&larr;</span> midi.7: Open sound system midi devices</a></li>
   <li class="next"><a href="mimedefang-protocol.7.html">mimedefang-protocol.7: Conventions used by mimedefang(8) to communicate with filter programs. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
