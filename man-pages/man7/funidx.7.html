<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>funidx: Using indexes to filter rows in a table</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Using indexes to filter rows in a table">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="funidx (7) manual">
  <meta name="twitter:description" content="Using indexes to filter rows in a table">
  <meta name="twitter:image" content="https://www.carta.tech/images/libfuntools-dev-funidx-7.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man7/funidx.7.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="funidx (7) manual" />
  <meta property="og:description" content="Using indexes to filter rows in a table" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libfuntools-dev-funidx-7.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">funidx<small> (7)</small></h1>
        <p class="lead">Using indexes to filter rows in a table</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/">
      <span itemprop="name">Miscellaneous</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/funidx.7.html">
      <span itemprop="name">funidx: Using indexes to filter rows in a table</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libfuntools-dev/">
      <span itemprop="name">libfuntools-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man7/funidx.7.html">
      <span itemprop="name">funidx: Using indexes to filter rows in a table</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>This document contains a summary of the user interface for filtering rows in binary tables with indexes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Funtools Table Filtering allows rows in a table to be selected based on the values of one or more columns in the row. Because the actual filter code is compiled on the fly, it is very efficient. However, for very large files (hundreds of Mb or larger), evaluating the filter expression on each row can take a long time. Therefore, funtools supports index files for columns, which are used automatically during filtering to reduce dramatically the number of row evaluations performed. The speed increase for indexed filtering can be an order of magnitude or more, depending on the size of the file.</p><p>The funindex program creates an index on one or more columns in a binary table. For example, to create an index for the column pi in the file huge.fits, use:</p>
<pre>
  funindex huge.fits pi
</pre>
<p>This will create an index named huge_pi.idx.</p><p>When a filter expression is initialized for row evaluation, funtools looks for an index file for each column in the filter expression. If found, and if the file modification date of the index file is later than that of the data file, then the index will be used to reduce the number of rows that are evaluated in the filter. When Spatial Region Filtering is part of the expression, the columns associated with the region are checked for index files.</p><p>If an index file is not available for a given column, then in general, all rows must be checked when that column is part of a filter expression.  This is not true, however, when a non-indexed column is part of an \s-1AND\s0 expression. In this case, only the rows that pass the other part of the \s-1AND\s0 expression need to be checked. Thus, in some cases, filtering speed can increase significantly even if all columns are not indexed.</p><p>Also note that certain types of filter expression syntax cannot make use of indices. For example, calling functions with column names as arguments implies that all rows must be checked against the function value. Once again, however, if this function is part of an \s-1AND\s0 expression, then a significant improvement in speed still is possible if the other part of the \s-1AND\s0 expression is indexed.</p><p>For example, note below the dramatic speedup in searching a 1 Gb file using an \s-1AND\s0 filter, even when one of the columns (pha) has no index:</p><p>  time fundisp &#92;   huge.fits'[idx_activate=0,idx_debug=1,pha=2348&&cir 4000 4000 1]' &#92;   "x y pha"           x           y        pha  ---------- ----------- ----------     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     42.36u 13.07s 6:42.89 13.7%</p><p>  time fundisp &#92;   huge.fits'[idx_activate=1,idx_debug=1,pha=2348&&cir 4000 4000 1]' &#92;   "x y pha"           x           y        pha  ---------- ----------- ----------  idxeq: [INDEF]  idxand sort: x[ROW 8037025:8070128] y[ROW 5757665:5792352]  <strong>idxand</strong>(1): INDEF [IDX_OR_SORT]  <strong>idxall</strong>(1): [IDX_OR_SORT]     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     3999.48     4000.47       2348     1.55u 0.37s 1:19.80 2.4%</p><p>When all columns are indexed, the increase in speed can be even more dramatic:</p><p>  time fundisp &#92;   huge.fits'[idx_activate=0,idx_debug=1,pi=770&&cir 4000 4000 1]' &#92;   "x y pi"           x           y         pi  ---------- ----------- ----------     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     42.60u 12.63s 7:28.63 12.3%</p><p>  time fundisp &#92;   huge.fits'[idx_activate=1,idx_debug=1,pi=770&&cir 4000 4000 1]' &#92;   "x y pi"           x           y         pi  ---------- ----------- ----------  idxeq: pi start=9473025,stop=9492240 =&gt; pi[ROW 9473025:9492240]  idxand sort: x[ROW 8037025:8070128] y[ROW 5757665:5792352]  idxor sort/merge: pi[ROW 9473025:9492240] [IDX_OR_SORT]  <strong>idxmerge</strong>(5): [IDX_OR_SORT] pi[ROW]  <strong>idxall</strong>(1): [IDX_OR_SORT]     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     3999.48     4000.47        770     1.67u 0.30s 0:24.76 7.9%</p><p>The miracle of indexed filtering (and indeed, of any indexing) is the speed of the binary search on the index, which is of order log2(n) instead of n. (The funtools binary search method is taken from http://www.tbray.org/ongoing/When/200x/2003/03/22/Binary, to whom grateful acknowledgement is made.)  This means that the larger the file, the better the performance. Conversely, it also means that for small files, using an index (and the overhead involved) can slow filtering down somewhat. Our tests indicate that on a file containing a few tens of thousands of rows, indexed filtering can be 10 to 20 percent slower than non-indexed filtering. Of course, your mileage will vary with conditions (disk access speed, amount of available memory, process load, etc.)</p><p>Any problem encountered during index processing will result in indexing being turned off, and replaced by filtering all rows. You can turn filtering off manually by setting the idx_activate variable to 0 (in a filter expression) or the \s-1FILTER_IDX_ACTIVATE\s0 environment variable to 0 (in the global environment). Debugging output showing how the indexes are being processed can be displayed to stderr by setting the idx_debug variable to 1 (in a filter expression) or the \s-1FILTER_IDX_DEBUG\s0 environment variable to 1 (in the global environment).</p><p>Currently, indexed filtering only works with \s-1FITS\s0 binary tables and raw event files. It does not work with text files. This restriction might be removed in a future release.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO funidx&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/funtools.7.html"><strong>funtools</strong>(7)</a> for a list of Funtools help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="funfilters.7.html"><span aria-hidden="true">&larr;</span> funfilters.7: Filtering rows in a table</a></li>
   <li class="next"><a href="funregions.7.html">funregions.7: Spatial region filtering <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
