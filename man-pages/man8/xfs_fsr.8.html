<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>xfs_fsr: Filesystem reorganizer for xfs</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Filesystem reorganizer for xfs">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="xfs_fsr (8) manual">
  <meta name="twitter:description" content="Filesystem reorganizer for xfs">
  <meta name="twitter:image" content="https://www.carta.tech/images/xfsprogs-xfs_fsr-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/xfs_fsr.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="xfs_fsr (8) manual" />
  <meta property="og:description" content="Filesystem reorganizer for xfs" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/xfsprogs-xfs_fsr-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">xfs_fsr<small> (8)</small></h1>
        <p class="lead">Filesystem reorganizer for xfs</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/xfs_fsr.8.html">
      <span itemprop="name">xfs_fsr: Filesystem reorganizer for xfs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/xfsprogs/">
      <span itemprop="name">xfsprogs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/xfs_fsr.8.html">
      <span itemprop="name">xfs_fsr: Filesystem reorganizer for xfs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>xfs_fsr</strong> [<strong>-vdg</strong>]  [<strong>-t</strong> seconds] [<strong>-p</strong> passes] [<strong>-f</strong> leftoff] [<strong>-m</strong> mtab]
<strong>xfs_fsr</strong> [<strong>-vdg</strong>]  [xfsdev | file] ...

<strong>xfs_fsr -V</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>xfs_fsr</em> is applicable only to XFS filesystems.</p><p><em>xfs_fsr</em> improves the organization of mounted filesystems. The reorganization algorithm operates on one file at a time, compacting or otherwise improving the layout of the file extents (contiguous blocks of file data).</p><p>The following options are accepted by <em>xfs_fsr</em>. The <strong>-m</strong>, <strong>-t</strong>, and <strong>-f</strong> options have no meaning if any filesystems or files are specified on the command line.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-m</strong><em> mtab</em></p>
  </dt>
  <dd>
    <p>Use this file for the list of filesystems to reorganize. The default is to use <em>/etc/mtab</em>.</p>
  </dd>
  <dt>
    <p><strong>-t</strong><em> seconds</em></p>
  </dt>
  <dd>
    <p>How long to reorganize. The default is 7200 seconds (2 hours).</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> passes</em></p>
  </dt>
  <dd>
    <p>Number of passes before terminating global re-org. The default is 10 passes.</p>
  </dd>
  <dt>
    <p><strong>-f</strong><em> leftoff</em></p>
  </dt>
  <dd>
    <p>Use this file instead of <em>/var/tmp/.fsrlast</em> to read the state of where to start and as the file to store the state of where reorganization left off.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Verbose. Print cryptic information about each file being reorganized.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Debug.  Print even more cryptic information.</p>
  </dd>
  <dt>
    <p><strong>-g</strong></p>
  </dt>
  <dd>
    <p>Print to syslog (default if stdout not a tty).</p>
  </dd>
  <dt>
    <p><strong>-V</strong></p>
  </dt>
  <dd>
    <p>Prints the version number and exits.</p>
  </dd>

</dl>
<p>When invoked with no arguments <em>xfs_fsr</em> reorganizes all regular files in all mounted filesystems. <em>xfs_fsr</em> makes many cycles over <em>/etc/mtab</em> each time making a single pass over each XFS filesystem. Each pass goes through and selects files that have the largest number of extents.  It attempts to defragment the top 10% of these files on each pass.</p><p>It runs for up to two hours after which it records the filesystem where it left off, so it can start there the next time. This information is stored in the file <em>/var/tmp/.fsrlast_xfs.</em> If the information found here is somehow inconsistent or out of date it is ignored and reorganization starts at the beginning of the first filesystem found in <em>/etc/mtab</em>.</p><p><em>xfs_fsr</em> can be called with one or more arguments naming filesystems (block device name), and files to reorganize. In this mode <em>xfs_fsr</em> does not read or write <em>/var/tmp/.fsrlast_xfs</em> nor does it run for a fixed time interval. It makes one pass through each specified regular file and all regular files in each specified filesystem. A command line name referring to a symbolic link (except to a file system device), FIFO, or UNIX domain socket generates a warning message, but is otherwise ignored. While traversing the filesystem these types of files are silently skipped.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>/etc/mtab</p>
  </dt>
  <dd>
    <p>contains default list of filesystems to reorganize.</p>
  </dd>
  <dt>
    <p>/var/tmp/.fsrlast_xfs</p>
  </dt>
  <dd>
    <p>records the state where reorganization left off.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO xfs_fsr&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/xfs_fsr.8.html"><strong>xfs_fsr</strong>(8)</a>, <a href="../man8/mkfs.xfs.8.html"><strong>mkfs.xfs</strong>(8)</a>, <a href="../man8/xfs_ncheck.8.html"><strong>xfs_ncheck</strong>(8)</a>, <a href="../man5/xfs.5.html"><strong>xfs</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p><em>xfs_fsr</em> improves the layout of extents for each file by copying the entire file to a temporary location and then interchanging the data extents of the target and temporary files in an atomic manner. This method requires that enough free disk space be available to copy any given file and that the space be less fragmented than the original file. It also requires the owner of the file to have enough remaining filespace quota to do the copy on systems running quotas. <em>xfs_fsr</em> generates a warning message if space is not sufficient to improve the target file.</p><p>A temporary file used in improving a file given on the command line is created in the same parent directory of the target file and is prefixed by the string '<strong>.fsr</strong>'. The temporary files used in improving an entire XFS device are stored in a directory at the root of the target device and use the same naming scheme. The temporary files are unlinked upon creation so data will not be readable by any other process.</p><p><em>xfs_fsr</em> does not operate on files that are currently mapped in memory. A 'file busy' error can be seen for these files if the verbose flag (<strong>-v</strong>) is set.</p><p>Files marked as no-defrag will be skipped. The <a href="../man8/xfs_io.8.html"><strong>xfs_io</strong>(8)</a> chattr command with the f attribute can be used to set or clear this flag. Files and directories created in a directory with the no-defrag flag will inherit the attribute.</p><p>An entry in <em>/etc/mtab</em> or the file specified using the <strong>-m</strong> option must have the <strong>rw</strong> option specified for read and write access. If this option is not present, then <em>xfs_fsr</em> skips the filesystem described by that line. See the <a href="../man5/fstab.5.html"><strong>fstab</strong>(5)</a> reference page for more details.</p><p>In general we do not foresee the need to run <em>xfs_fsr</em> on system partitions such as <em>/</em>, <em>/boot</em> and <em>/usr</em> as in general these will not suffer from fragmentation. There are also issues with defragmenting files <a href="../man8/lilo.8.html"><strong>lilo</strong>(8)</a> uses to boot your system. It is recommended that these files should be flagged as no-defrag with the <a href="../man8/xfs_io.8.html"><strong>xfs_io</strong>(8)</a> chattr command. Should these files be moved by <em>xfs_fsr</em> then you must rerun <em>lilo</em> before you reboot or you may have an unbootable system.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="xfs_freeze.8.html"><span aria-hidden="true">&larr;</span> xfs_freeze.8: Suspend access to an xfs filesystem</a></li>
   <li class="next"><a href="xfs_growfs.8.html">xfs_growfs.8: Expand an xfs filesystem <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
