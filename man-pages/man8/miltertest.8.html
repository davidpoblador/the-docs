<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>miltertest: Milter unit test utility</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Milter unit test utility">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="miltertest (8) manual">
  <meta name="twitter:description" content="Milter unit test utility">
  <meta name="twitter:image" content="https://www.carta.tech/images/opendkim-tools-miltertest-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/miltertest.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="miltertest (8) manual" />
  <meta property="og:description" content="Milter unit test utility" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/opendkim-tools-miltertest-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">miltertest<small> (8)</small></h1>
        <p class="lead">Milter unit test utility</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/miltertest.8.html">
      <span itemprop="name">miltertest: Milter unit test utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/opendkim-tools/">
      <span itemprop="name">opendkim-tools</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/miltertest.8.html">
      <span itemprop="name">miltertest: Milter unit test utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>miltertest</strong> [-D name[=value]] [-s script] [-u] [-v] [-V] [-w]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>miltertest</strong> simulates the MTA side of an MTA-milter interaction for testing a milter-aware filter application.  It takes as input a script using the Lua language, and by exporting some utility functions, makes it possible for users to write scripts that exercise a filter.</p><p>See documentation on Lua (e.g. http://www.lua.org) for the syntax of the language in general.  The documentation below describes functions that are added to Lua by this application to make testing possible.</p><p>Documentation on milter can be found at http://www.milter.org.  A particular transaction must follow a series of steps to be completed, namely negotiate, connection information, envelope sender, envelope recipient(s), header field(s), end-of-header, body chunk(s), end-of-message.  To make the work of writing tests with <strong>miltertest</strong> simpler, any of these steps prior to end-of-message that is skipped will be filled in using arbitrary, but legal, data.</p><p>Interspersed with these protocol phases are optional macro (key/value) deliveries from the MTA. <strong>miltertest</strong> will never send these automatically.  If they are needed for your tests, you must send them as part of your test script.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-D name[=value]</em></p>
  </dt>
  <dd>
    <p>Defines a global variable called <em>name</em> to the Lua interpreter.  If a <em>value</em> is provided, the global variable is set to that value (as a string, although Lua can convert strings to numbers internally).  If no <em>value</em> is provided, the global variable is set to 1.</p>
  </dd>
  <dt>
    <p><em>-s script</em></p>
  </dt>
  <dd>
    <p>Use the contents of file <em>script</em> as the Lua script to be executed.  The default is to read from standard input.</p>
  </dd>
  <dt>
    <p><em>-u</em></p>
  </dt>
  <dd>
    <p>After the filter being tested is terminated, report user and system time consumed.  See <a href="../man2/getrusage.2.html"><strong>getrusage</strong>(2)</a>.</em></p>
  </dd>
  <dt>
    <p><em>-v</em></p>
  </dt>
  <dd>
    <p>Increase verbose output.  May be specified multiple times to request more and more information.</p>
  </dd>
  <dt>
    <p><em>-V</em></p>
  </dt>
  <dd>
    <p>Print version number and exit.</p>
  </dd>
  <dt>
    <p><em>-w</em></p>
  </dt>
  <dd>
    <p>Don't wait for child status to be returned when testing is complete.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS</h2>
        <div class="sectioncontent">
<p>The following functions are made available to Lua scripts for exercising a filter.  All functions return Lua constant "nil" on success or an error string on failure, unless otherwise indicated.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>mt.abort(conn)</strong></p>
  </dt>
  <dd>
    <p>Aborts the transaction in progress on the specified connection.</p>
  </dd>
  <dt>
    <p><strong>mt.bodyfile(conn, file)</strong></p>
  </dt>
  <dd>
    <p>Sends the contents of the named <em>file</em> to the connection as body data.  If there is any error opening <em>file</em> for reading, the test aborts.</p>
  </dd>
  <dt>
    <p><strong>mt.bodyrandom(conn, n)</strong></p>
  </dt>
  <dd>
    <p>Sends at least <em>n</em> bytes of random-length lines of random printable ASCII data as body chunks to the specified connection.</p>
  </dd>
  <dt>
    <p><strong>mt.bodystring(conn, str)</strong></p>
  </dt>
  <dd>
    <p>Sends <em>str</em> as a chunk of body text on the specified connection.</p>
  </dd>
  <dt>
    <p><strong>mt.chdir(directory)</strong></p>
  </dt>
  <dd>
    <p>Changes the current working directory to the named <em>directory.</em></p>
  </dd>
  <dt>
    <p><strong>mt.connect(sockinfo[, count, interval])</strong></p>
  </dt>
  <dd>
    <p>Makes a connection to a filter listening at the socket described by <em>sockinfo.</em> Returns a handle referring to that connection, or the Lua constant "nil" on error.  If <em>count</em> and <em>interval</em> are included, they specify the number of times to try to connect to the filter and the delay between each connection in seconds (with floating point values permitted).  If the environment variable MILTERTEST_RETRY_SPEED_FACTOR is set and appears to contain an integer, the value of <em>interval</em> (if set) will be multiplied by the value found in that environment variable. This is included to allow tests in a large test suite to be easily adjusted on slow systems without reconfiguring the entire test suite.</p>
  </dd>
  <dt>
    <p><strong>mt.conninfo(conn, host, ip)</strong></p>
  </dt>
  <dd>
    <p>Sends information about a new SMTP connection to the MTA, represented by connection <em>conn,</em> from the host named <em>host</em> at IP address <em>ip</em> (both strings).  If <em>host</em> is the Lua constant "nil", the string "localhost" is assumed.  If <em>ip</em> is the Lua constant "nil", a DNS query will be made for the IP address matching <em>host;</em> if none is found, the test will abort.  The <em>ip</em> may also be the special string "unspec", which will tell the filter that a connection came in from an unknown protocol family.</p>
  </dd>
  <dt>
    <p><strong>mt.data(conn)</strong></p>
  </dt>
  <dd>
    <p>Announces the DATA command on the specified connection, which occurs between the last RCPT TO command and the beginning of the header block.</p>
  </dd>
  <dt>
    <p><strong>mt.disconnect(conn[, polite]))</strong></p>
  </dt>
  <dd>
    <p>Sends a "quit" message to the specified connection and then closes that connection.  The specified <em>conn</em> handle should no longer be used.  If <em>polite</em> is defined, it must be a Boolean indicating whether a normal disconnect should be done (true) or an abrupt disconnect should be done (false).  An abrupt disconnect skips standard protocol shutdown steps.</p>
  </dd>
  <dt>
    <p><strong>mt.echo(string)</strong></p>
  </dt>
  <dd>
    <p>Prints the specified <em>string</em> on standard output.  Returns nothing.</p>
  </dd>
  <dt>
    <p><strong>mt.eoh(conn)</strong></p>
  </dt>
  <dd>
    <p>Announces end-of-header on the specified connection.</p>
  </dd>
  <dt>
    <p><strong>mt.eom(conn)</strong></p>
  </dt>
  <dd>
    <p>Announces end-of-message on the specified connection, and begins capturing any other operations the filter might perform in that phase.</p>
  </dd>
  <dt>
    <p><strong>mt.eom_check(conn, op, param[, ...])</strong></p>
  </dt>
  <dd>
    <p>Checks the captured set of EOM operations (see above) to determine whether or not specific milter actions were requested by the filter.  Returns a Boolean value (true or false).  See the EOM CHECKS section for details.</p>
  </dd>
  <dt>
    <p><strong>mt.getheader(conn, hdr, n)</strong></p>
  </dt>
  <dd>
    <p>Retrieves the value of the <em>nth</em> instance of header field named <em>hdr</em> added during end-of-message processing on the specified connection. This can be used by the script to verify that the header thus added contains the right thing.  Returns the value as a string, or the Lua constant "nil" on error.</p>
  </dd>
  <dt>
    <p><strong>mt.getcwd()</strong></p>
  </dt>
  <dd>
    <p>Returns the current working directory as a string.</p>
  </dd>
  <dt>
    <p><strong>mt.getreply(conn)</strong></p>
  </dt>
  <dd>
    <p>Returns the last milter reply received from the specified connection, as an integer.  This can be compared to any of the SMFIR_* constants defined by milter to see if the filter responded as expected.  This value is initially set to the NULL character.</p>
  </dd>
  <dt>
    <p><strong>mt.header(conn, name, value)</strong></p>
  </dt>
  <dd>
    <p>Sends the header with the given <em>name</em> and <em>value</em> to the specified connection.</p>
  </dd>
  <dt>
    <p><strong>mt.helo(conn, name)</strong></p>
  </dt>
  <dd>
    <p>Sends HELO/EHLO information using the specified <em>name</em> as the parameter given.</p>
  </dd>
  <dt>
    <p><strong>mt.macro(conn, type, name, value[, name2, value2[, ...]])</strong></p>
  </dt>
  <dd>
    <p>Declares a macro called <em>name</em> whose value is <em>value</em> and whose type (matching protocol element) is <em>type.</em> Valid types are SMFIC_CONNECT, SMFIC_HELO, SMFIC_MAIL and SMFIC_RCPT.  Multiple macro names and values can be provided, but they must appear in pairs.</p>
  </dd>
  <dt>
    <p><strong>mt.mailfrom(conn, envfrom[, ...])</strong></p>
  </dt>
  <dd>
    <p>Announces <em>envfrom</em> as the envelope sender of a new message.  ESMTP parameters as additional arguments are permitted.</p>
  </dd>
  <dt>
    <p><strong>mt.negotiate(conn, version, actions, steps)</strong></p>
  </dt>
  <dd>
    <p>Performs milter option negotiation with the connection <em>conn,</em> advertising that the specified protocol <em>version,</em> protocol <em>actions</em> and protocol <em>steps</em> are offered by the MTA.  Returns the Lua constant "nil" on success or an error string on failure.  If any of the protocol parameters are "nil", the current defaults (defined in <em>libmilter/mfdef.h,</em> provided with the milter source code) will be used.</p>
  </dd>
  <dt>
    <p><strong>mt.rcptto(conn, envrcpt[, ...])</strong></p>
  </dt>
  <dd>
    <p>Announces <em>envrcpt</em> as an envelope recipient of a message.  ESMTP parameters as additional arguments are permitted.</p>
  </dd>
  <dt>
    <p><strong>mt.set_timeout(n)</strong></p>
  </dt>
  <dd>
    <p>Sets the read timeout to <em>n</em> seconds.  The default is ten seconds.  Returns nothing.</p>
  </dd>
  <dt>
    <p><strong>mt.sleep(n)</strong></p>
  </dt>
  <dd>
    <p>Sleeps for <em>n</em> seconds.  The value may be an integer (for whole seconds) or a floating-point value (for partial seconds).</p>
  </dd>
  <dt>
    <p><strong>mt.signal(n)</strong></p>
  </dt>
  <dd>
    <p>Sends the specified signal number <em>n</em> to the running filter.</p>
  </dd>
  <dt>
    <p><strong>mt.startfilter(path, arg1, arg2, ...)</strong></p>
  </dt>
  <dd>
    <p>Starts the filter whose binary is located at <em>path</em> with argument vector comprised of strings <em>path,</em> <em>arg1,</em> <em>arg2,</em> etc.  Basically this is almost the same syntax as <a href="../man3/execl.3.html"><strong>execl</strong>(3)</a></em> except that <strong>miltertest</strong> also does the fork for you, and will remember the process ID in order to request a clean shutdown using SIGTERM and <a href="../man2/wait.2.html"><strong>wait</strong>(2)</a></em> at the end of the test script.  If the filter could not be started, an exception is generated with an error message returned.</p>
  </dd>
  <dt>
    <p><strong>mt.test_action(conn, action)</strong></p>
  </dt>
  <dd>
    <p>Tests whether or not the connection represented by <em>conn</em> requested the specified milter protocol <em>action,</em> specified by an SMFIF_* constant, during option negotiation.  (See the libmilter documentation and/or include files for details.)</p>
  </dd>
  <dt>
    <p><strong>mt.test_option(conn, option)</strong></p>
  </dt>
  <dd>
    <p>Tests whether or not the connection represented by <em>conn</em> requested the specified milter protocol <em>option,</em> specified by an SMFIP_* constant, during option negotiation.  (See the libmilter documentation and/or include files for details.)</p>
  </dd>
  <dt>
    <p><strong>mt.unknown(conn, str)</strong></p>
  </dt>
  <dd>
    <p>Announces that the unknown SMTP command <em>str</em> arrived over the connection represented by <em>conn.</em></p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EOM CHECKS</h2>
        <div class="sectioncontent">
<p>The <strong>mt.eom_check()</strong> function is used to determine what changes to the message the filter requested during its EOM callback.  The changes can be requested in any order.  The first parameter, <em>op,</em> indicates what operation is of interest, and it also dictates what the possible parameter list is.  Valid values and corresponding parameters for <em>op</em> are as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>MT_HDRADD</em></p>
  </dt>
  <dd>
    <p>Checks to see if a header field was added to the message.  If no parameters are given, the function returns true if any header field was added.  If one parameter was given, the function returns true only if the named header field was added (regardless of its value).  If two parameters are given, the function returns true only if the named header field was added with the specified value.</p>
  </dd>
  <dt>
    <p><em>MT_HDRCHANGE</em></p>
  </dt>
  <dd>
    <p>Checks to see if an existing header field was changed.  If no parameters are given, the function returns true if any header field was modified.  If one parameter was given, the function returns true only if the named header field was modified (regardless of its new value).  If two parameters are given, the function returns true only if the named header field was modified to have the specified new value.</p>
  </dd>
  <dt>
    <p><em>MT_HDRDELETE</em></p>
  </dt>
  <dd>
    <p>Checks to see if an existing header field was deleted.  If no parameters are given, the function returns true if any header field was deleted.  If one parameter was given, the function returns true only if the named header field was deleted.</p>
  </dd>
  <dt>
    <p><em>MT_HDRINSERT</em></p>
  </dt>
  <dd>
    <p>Checks to see if a header field was inserted into the message.  If no parameters are given, the function returns true if any header field was added.  If one parameter was given, the function returns true only if the named header field was added (regardless of its value).  If two parameters are given, the function returns true only if the named header field was added with the specified value.  If three parameters are given, the function returns true only if the named header field was added with the specified value at the specified index.</p>
  </dd>
  <dt>
    <p><em>MT_RCPTADD</em></p>
  </dt>
  <dd>
    <p>Checks to see if an envelope recipient was added.  Currently only one parameter may be provided.</p>
  </dd>
  <dt>
    <p><em>MT_RCPTDELETE</em></p>
  </dt>
  <dd>
    <p>Checks to see if an envelope recipient was deleted.  Currently only one parameter may be provided.</p>
  </dd>
  <dt>
    <p><em>MT_BODYCHANGE</em></p>
  </dt>
  <dd>
    <p>Checks to see if the message's body was replaced by other content.  With no parameters, the function returns true only if the body was changed (regardless of the new content).  With one parameter, the function returns true only if the body was changed to the specified new content.</p>
  </dd>
  <dt>
    <p><em>MT_QUARANTINE</em></p>
  </dt>
  <dd>
    <p>Checks to see if the filter requested quarantining of the message. With no parameters, the function returns true only if quarantine was requested.  With one parameter, the function returns true only if quarantine was requested with the specified reason string.</p>
  </dd>
  <dt>
    <p><em>MT_SMTPREPLY</em></p>
  </dt>
  <dd>
    <p>Checks to see if the filter requested a specific SMTP reply message. With no parameters, the function returns true only if a specific reply was requested.  With one parameter, the function returns true only if a specific reply was requested with the specified SMTP code.  With two parameters, the function returns true only if a specific reply was requested with the specified SMTP code and enhanced status code.  With three parameters, the function returns true only if a specific reply was requested with the specified SMTP code, enhanced status code, and text.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>-- Echo that the test is starting</p><p>mt.echo("*** begin test")</p><p>-- start the filter</p><p>mt.startfilter("../myfilter", "-p", "inet:12345@localhost")</p><p><strong>mt.sleep</strong>(2)</p><p>-- try to connect to it</p><p>conn = mt.connect("inet:12345@localhost")</p><p>if conn == nil then</p><p>	error "mt.connect() failed"</p><p>end</p><p>-- send connection information</p><p>-- mt.negotiate() is called implicitly</p><p>if mt.conninfo(conn, "localhost", "127.0.0.1") ~= nil then</p><p>	error "mt.conninfo() failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.conninfo() unexpected reply"</p><p>end</p><p>-- send envelope macros and sender data</p><p>-- mt.helo() is called implicitly</p><p>mt.macro(conn, SMFIC_MAIL, "i", "test-id")</p><p>if mt.mailfrom(conn, "user@example.com") ~= nil then</p><p>	error "mt.mailfrom() failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.mailfrom() unexpected reply"</p><p>end</p><p>-- send headers</p><p>-- mt.rcptto() is called implicitly</p><p>if mt.header(conn, "From", "user@example.com") ~= nil then</p><p>	error "mt.header(From) failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.header(From) unexpected reply"</p><p>end</p><p>if mt.header(conn, "Date", "Tue, 22 Dec 2009 13:04:12 -0800") ~= nil then</p><p>	error "mt.header(Date) failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.header(Date) unexpected reply"</p><p>end</p><p>if mt.header(conn, "Subject", "Signing test") ~= nil then</p><p>	error "mt.header(Subject) failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.header(Subject) unexpected reply"</p><p>end</p><p>-- send EOH</p><p>if mt.eoh(conn) ~= nil then</p><p>	error "mt.eoh() failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.eoh() unexpected reply"</p><p>end</p><p>-- send body</p><p>if mt.bodystring(conn, "This is a test!&#92;r&#92;n") ~= nil then</p><p>	error "mt.bodystring() failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_CONTINUE then</p><p>	error "mt.bodystring() unexpected reply"</p><p>end</p><p>-- end of message; let the filter react</p><p>if mt.eom(conn) ~= nil then</p><p>	error "mt.eom() failed"</p><p>end</p><p>if mt.getreply(conn) ~= SMFIR_ACCEPT then</p><p>	error "mt.eom() unexpected reply"</p><p>end</p><p>-- verify that a test header field got added</p><p>if not mt.eom_check(conn, MT_HDRINSERT, "Test-Header") then</p><p>	error "no header added"</p><p>end</p><p>-- wrap it up!</p><p>mt.disconnect(conn)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>If a filter negotiates one of the SMFIP_NO* protocol option bits and a script attempts to perform one of those protocol steps, an error is returned. It is up to the test author to use <em>mt.test_option()</em> function to see if performing a protocol step has been explicitly disabled by the filter.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MILTER NOTES</h2>
        <div class="sectioncontent">
<p>When <em>mt.macro()</em> is called, it replaces all previous macros of the same <em>type</em> with the ones provided in the argument list.  Thus, one call should be made that lists the complete set rather than one call per name-value pair. Also, as each stage in the milter process is executed, all macros corresponding stages after the current one are discarded.  For example, calling <em>mt.helo(),</em> which corresponds to SMFIC_HELO, will cause all prior macros of type SMFIC_MAIL and SMFIC_RCPT to be discarded as they represent a milter stage that comes later than SMFIC_HELO.</p><p>Since the milter protocol and the internals of libmilter itself are not formally documented, there are myriad other subtleties of the milter protocol and implementation that are not documented here and may not be documented elsewhere, and could change without notice.  Caveat emptor.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This man page covers version 1.5.0 of <em>miltertest.</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (c) 2009-2014, The Trusted Domain Project.  All rights reserved.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO miltertest&hellip;</h2>
        <div class="sectioncontent">
<p>Milter -- http://www.milter.org</p><p>Lua -- http://www.lua.org</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="milter-greylist.8.html"><span aria-hidden="true">&larr;</span> milter-greylist.8: Grey listing filter for sendmail</a></li>
   <li class="next"><a href="mimedefang.8.html">mimedefang.8: Sendmail mime mail filter <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
