<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>courierperlfilter: Sample perl-based mail filter</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Sample perl-based mail filter">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="courierperlfilter (8) manual">
  <meta name="twitter:description" content="Sample perl-based mail filter">
  <meta name="twitter:image" content="https://www.carta.tech/images/courier-mta-courierperlfilter-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/courierperlfilter.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="courierperlfilter (8) manual" />
  <meta property="og:description" content="Sample perl-based mail filter" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/courier-mta-courierperlfilter-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">courierperlfilter<small> (8)</small></h1>
        <p class="lead">Sample perl-based mail filter</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/courierperlfilter.8.html">
      <span itemprop="name">courierperlfilter: Sample perl-based mail filter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/courier-mta/">
      <span itemprop="name">courier-mta</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/courierperlfilter.8.html">
      <span itemprop="name">courierperlfilter: Sample perl-based mail filter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>filterctl</strong> [[start] | [stop]] [perlfilter]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This is an example global mail filter that uses an embedded Perl script. "Embedded" means that the Perl interpreter is loaded once, and the same Perl code is repeatedly called to accept or reject incoming messages, one by one. Perl filtering is relatively time consuming (compared to filtering in C or C++), and excessive delays in mail filters result in incoming mail being deferred (rejected with a temporary error code). Therefore the <strong>perlfilter</strong> wrapper can create multiple <strong>perlfilter</strong> processes, so that multiple processes are used to filter incoming mail.</p><p><strong>perlfilter</strong> requires Perl 5.004 or higher. The best way to create a Perl filter is to start with the sample filter, /usr/lib/courier/perlfilter-example.pl. This filter reject messages that contain an excessively long Date: header (designed to crash certain poorly-written mail clients). Use it as a basis for writing your own filter. You can install your filter in any convenient location, then initialize the /etc/courier/filters/perlfilter configuration file, as described below. Run <strong>filterctl start perlfilter</strong> to activate filtering (if necessary, run <strong>courierfilter start</strong> to start the mail filtering subsystem).</p><h3>Setting up a Perl script</h3>
<p>Most of the ugly details of connecting the Perl script to Courier&apos;s mail filtering engine is taken care of by the sample perlfilter-example.pl script. One big no-no: the script MAY NOT change the current directory. Anything else goes, for the most part. Loading other modules and classes, pretty much anything else you can do with Perl, is allowed.</p><p>The Perl script, just like any other mail filtering module, receives a pointer to a data file and one or more control files, each time a message is submitted to Courier for delivery. The sample script calls the <strong>filterdata</strong>() function to process the data file. The data file contains the actual message. The <strong>filtercontrol</strong>() function is called to process each control file. The control file contains recipient and message metadata. There may be more than one control file for each message. The example script includes an implementation of <strong>filterdata</strong>() that blocks messages with corrupted headers. The example script doesn&apos;t do anything interesting with <strong>filtercontrol</strong>().</p><p><strong>filterdata</strong>() and <strong>filtercontrol</strong>() must return an empty string if no serious objections are raised for this message. Any other return string is interpreted as an SMTP-style error code that is used to reject the message. Care must be taken that any error messages are formatted strictly according to the format of SMTP error messages (even though the message may not actually come in via SMTP).</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CREDITS</h2>
        <div class="sectioncontent">
<p>A lot of the Perl glue code is based on examples from the perlembed manual page, and other sources.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><strong>perlfilter</strong> uses the following configuration files. Changes to the following files do not take effect until the filter has been stopped and restarted.</p><p>/etc/courier/filters/perlfilter-mode</p><p>If this file exists and contains the word "all", <strong>perlfilter</strong> will create its socket in /var/lib/courier/allfilters, otherwise the socket will be created in /var/lib/courier/filters, see \m[blue]<strong></strong><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a>\m[]\s-2\u[1]\d\s+2 for more information.</p><p>/etc/courier/filters/perlfilter-numprocs</p><p>This file contains a number that sets how many <strong>perlfilter</strong> processes are created. The default is 5 processes. There&apos;s always an extra <strong>perlfilter</strong> process that&apos;s used to clean up crashed child processes.</p><p>/etc/courier/filters/perlfilter</p><p>This file MUST exist and it must contain a single line of text with the filename of the Perl script to load.</p><p>/usr/lib/courier/perlfilter-example.pl</p><p>This is a sample Perl script of the kind that /etc/courier/filters/perlfilter points to. Use it as an example of writing your own Perl filters.</p><p>Please exercise good judgment in writing Perl-based filters. They should be reasonably fast, and do not allocate megabytes of memory. They should not be very promiscuous in creating global Perl variables, and should clean up after themselves. The current Perl wrapper does not destroy the Perl symbol table after each call to the filter script. However, do not take that for granted. This may change in the future.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO courierperlfilter&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong></strong><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a>\m[]\s-2\u[1]\d\s+2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Sam Varshavchik</strong></p><p>Author</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courierfilter.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="courierpassd.8.html"><span aria-hidden="true">&larr;</span> courierpassd.8: Change passwords from across the network using the courier authentication library</a></li>
   <li class="next"><a href="courierpop3d.8.html">courierpop3d.8: The courier pop3 server <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
