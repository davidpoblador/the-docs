<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>amzfs-sendrecv: Amanda script to create zfs sendrecv</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Amanda script to create zfs sendrecv">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="amzfs-sendrecv (8) manual">
  <meta name="twitter:description" content="Amanda script to create zfs sendrecv">
  <meta name="twitter:image" content="https://www.carta.tech/images/amanda-common-amzfs-sendrecv-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/amzfs-sendrecv.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="amzfs-sendrecv (8) manual" />
  <meta property="og:description" content="Amanda script to create zfs sendrecv" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/amanda-common-amzfs-sendrecv-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">amzfs-sendrecv<small> (8)</small></h1>
        <p class="lead">Amanda script to create zfs sendrecv</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/amzfs-sendrecv.8.html">
      <span itemprop="name">amzfs-sendrecv: Amanda script to create zfs sendrecv</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/amanda-common/">
      <span itemprop="name">amanda-common</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/amzfs-sendrecv.8.html">
      <span itemprop="name">amzfs-sendrecv: Amanda script to create zfs sendrecv</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>amzfs-sendrecv is an Amanda application implementing the Application API. It should not be run by users directly. It create a zfs snapshot of the filesystem and backup the snapshot with &apos;zfs send&apos;. Snapshot are kept after the backup is done, this increase the disk space use on the client but it is necessary to be able do to incremental backup. If you want only full backup, you can disable this feature by setting the KEEP-SNAPSHOT property to &apos;NO&apos;. Only the restoration of the complete backup is allowed, it is impossible to restore a single file.</p><p>The application is run as the amanda user, it must have many zfs privilege:</p>
<pre>
    zfs allow -ldu AMANDA_USER mount,create,rename,snapshot,destroy,send,receive FILESYSTEM
</pre>
<p>Some system doesn&apos;t have "zfs allow", but you can give the Amanda backup user the rights to manipulate ZFS filesystems by using the following command:</p>
<pre>
usermod -P "ZFS File System Management,ZFS Storage Management" AMANDA_USER
</pre>
<p>This will require that your run zfs under pfexec, set the PFEXEC property to YES.</p><p>The format of the <strong>diskdevice</strong> in the disklist (DLE) must be one of:</p>
<pre>
Desciption              Example
----------              -------
Mountpoint              /data
ZFS pool name           datapool
ZFS filesystem          datapool/database
ZFS logical volume      datapool/dbvol
</pre>
<p>The filesystem doesn&apos;t need to be mounted.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROPERTIES</h2>
        <div class="sectioncontent">
<p>This section lists the properties that control amzfs-sendrecv&apos;s functionality. See <a href="../man7/amanda-applications.7.html"><strong>amanda-applications</strong>(7)</a> for information on the Application API, application configuration.</p><p>DF-PATH</p><p>Path to the &apos;df&apos; binary, search in $PATH by default.</p><p>KEEP-SNAPSHOT</p><p>If "YES" (the default), snapshot are kept after the backup, if set to "NO" then snapshot are no kept and incremental backup will fail.</p><p>ZFS-PATH</p><p>Path to the &apos;zfs&apos; binary, search in $PATH by default.</p><p>PFEXEC-PATH</p><p>Path to the &apos;pfexec&apos; binary, search in $PATH by default.</p><p>PFEXEC</p><p>If "NO" (the default), pfexec is not used, if set to "YES" then pfexec is used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>In this example, a dumptype is defined to use amzfs-sendrecv application to backup a zfs filesystem.</p>
<pre>
 define application-tool amzfs_sendrecv {
   comment "amzfs-sendrecv"
   plugin "amzfs-sendrecv"
   #property "DF-PATH"  "/usr/sbin/df"
   #property "KEEP-SNAPSHOT" "YES"
   #property "ZFS-PATH" "/usr/sbin/zfs"
   #property "PFEXEC-PATH" "/usr/sbin/pfexec"
   #property "PFEXEC" "NO"
 }

 define dumptype user-zfs-sendrecv {
   program "APPLICATION"
   application "amzfs_sendrecv"
 }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO amzfs-sendrecv&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/amanda.8.html"><strong>amanda</strong>(8)</a>, <a href="../man5/amanda.conf.5.html"><strong>amanda.conf</strong>(5)</a>, <a href="../man5/amanda-client.conf.5.html"><strong>amanda-client.conf</strong>(5)</a>, <a href="../man7/amanda-applications.7.html"><strong>amanda-applications</strong>(7)</a></p><p>The Amanda Wiki: : http://wiki.zmanda.com/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Jean-Louis Martineau</strong> &lt;martineau@zmanda.com&gt;</p><p>Zmanda, Inc. (http://www.zmanda.com)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="amvault.8.html"><span aria-hidden="true">&larr;</span> amvault.8: Copy amanda dumps from one volume to another</a></li>
   <li class="next"><a href="amzfs-snapshot.8.html">amzfs-snapshot.8: Amanda script to create zfs snapshot <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
