<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>etterfilter: Filter compiler for ettercap content filtering engine</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Filter compiler for ettercap content filtering engine">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="etterfilter (8) manual">
  <meta name="twitter:description" content="Filter compiler for ettercap content filtering engine">
  <meta name="twitter:image" content="https://www.carta.tech/images/ettercap-common-etterfilter-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/etterfilter.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="etterfilter (8) manual" />
  <meta property="og:description" content="Filter compiler for ettercap content filtering engine" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ettercap-common-etterfilter-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">etterfilter<small> (8)</small></h1>
        <p class="lead">Filter compiler for ettercap content filtering engine</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/etterfilter.8.html">
      <span itemprop="name">etterfilter: Filter compiler for ettercap content filtering engine</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ettercap-common/">
      <span itemprop="name">ettercap-common</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/etterfilter.8.html">
      <span itemprop="name">etterfilter: Filter compiler for ettercap content filtering engine</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>etterfilter</strong> [<em>OPTIONS</em>] <em>FILE</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The etterfilter utility is used to compile source filter files into binary filter files that can be interpreted by the JIT interpreter in the <a href="../man8/ettercap.8.html"><strong>ettercap</strong>(8)</a> filter engine. You have to compile your filter scripts in order to use them in ettercap. All syntax/parse errors will be checked at compile time, so you will be sure to produce a correct binary filter for ettercap.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>GENERAL OPTIONS</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>-o</strong>, <strong>--output &lt;FILE&gt;</strong></p>
  </dt>
  <dd>
    <p>you can specify the output file for a source filter file. By default the output is filter.ef.</p>
  </dd>
  <dt>
    <p><strong>-t</strong>, <strong>--test &lt;FILE&gt;</strong></p>
  </dt>
  <dd>
    <p>you can analyze a compiled filter file with this option. etterfilter will print in a human readable form all the instructions contained in it. It is a sort of "disassembler" for binary filter files.</p>
  </dd>
  <dt>
    <p><strong>-d</strong>, <strong>--debug</strong></p>
  </dt>
  <dd>
    <p>prints some debug messages during the compilation. Use it more than once to increase the debug level ( etterfilter -ddd ... ).</p>
  </dd>
  <dt>
    <p><strong>-w</strong>, <strong>--suppress-warnings</strong></p>
  </dt>
  <dd>
    <p>Don't exit on warnings. With this option the compiler will compile the script even if it contains warnings.</p>
  </dd>
  <dt>
    <p><strong>STANDARD OPTIONS</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>-v</strong>, <strong>--version</strong></p>
  </dt>
  <dd>
    <p>Print the version and exit.</p>
  </dd>
  <dt>
    <p><strong>-h</strong>, <strong>--help</strong></p>
  </dt>
  <dd>
    <p>prints the help screen with a short summary of the available options.</p>
  </dd>
  <dt>
    <p><strong>SCRIPTS SYNTAX</strong></p>
  </dt>
  <dd>
    <p>A script is a compound of instructions. It is executed sequentially and you can make branches with the 'if' statements. 'if' and 'if/else' statements are the only supported. No loops are implemented. The syntax is almost like C code except that you have to put 'if' blocks into graph parentheses '{' '}', even if they contain only one instruction. NOTE: you have to put a space between the 'if' and the '('. You must not put the space between the function name and the '('. Example:</p><p>if (conditions) { }</p><p>func(args...);</p><p>The conditions for an 'if' statement can be either functions or comparisons. Two or more conditions can be linked together with logical operators like OR '||' and AND '&&'. Example:</p><p>if (tcp.src == 21 && search(DATA.data, "ettercap")) {</p><p>} Pay attention to the operator precedence. You cannot use parentheses to group conditions, so be careful with the order. An AND at the beginning of a conditions block will exclude all the other tests if it is evaluated as false. The parsing is left-to-right, when an operator is found: if it is an AND and the previous condition is false, all the statement is evaluated as false; if it is an OR the parsing goes on even if the condition is false. Example:</p><p>if (ip.proto == UDP || ip.proto == TCP && tcp.src == 80) {</p><p>} if (ip.proto == TCP && tcp.src == 80 || ip.proto == UDP) {</p><p>} the former condition will match all udp or http traffic. The latter is wrong, because if the packet is not tcp, the whole condition block will be evaluated as false. If you want to make complex conditions, the best way is to split them into nested 'if' blocks. Since etterfilter support both IP address families, you should care whether you use 'ip.proto' which is specific for the IPv4 address family or it's IPv6 couterpart 'ipv6.nh'. Especially for the L4 protocol matching using 'ip.proto' and/or 'ipv6.nh', you should be careful if you're really acting on the right protocol. This should be enforced using the L3 protocol identifier 'eth.proto'. Example:</p><p>if (eth.proto == IP && ip.proto == TCP && tcp.dst == 80 || tcp.src == 80) {</p><p>} if (eth.proto == IP6 && ipv6.nh == TCP && tcp.dst == 80 || tcp.src == 80) {</p><p>} if (tcp.dst == 80 || tcp.src == 80) {</p><p>} The first example correctly matches http traffic only on IPv4 while the second would match http traffic only on IPv6. The thrid example matches http regardless it's IP address familiy.</p><p>Every instruction in a block must end with a semicolon ';'. Comparisons are implemented with the '==' operator and can be used to compare numbers, strings or ip addresses. An ip address MUST be enclosed within two single quotes (eg. '192.168.0.7' or '2001:db8::2'). You can also use the 'less than' ('&lt;'), 'greater than' ('&gt;'), 'less or equal' ('&lt;=') and 'greater or equal' ('&gt;=') operators. The lvalue of a comparison must be an offset (see later) Example:</p><p>if (DATA.data + 20 == "ettercap" && ip.ttl &gt; 16) {</p><p>} Assignments are implemented with the '=' operator and the lvalue can be an offset (see later). The rvalue can be a string, an integer or a hexadecimal value. Example:</p><p>ip.ttl = 0xff;</p><p>DATA.data + 7 = "ettercap NG"; You can also use the 'inc' and 'dec' operations on the packet fields. The operators used are '+=' and '-='. The rvalue can be an integer or a hexadecimal value. Example:</p><p>ip.ttl += 5;</p><p>More examples can be found in the etter.filter.examples file.</p>
  </dd>
  <dt>
    <p><strong>OFFSET DEFINITION</strong></p>
  </dt>
  <dd>
    <p>An offset is identified by a virtual pointer. In short words, an offset is a pointer to the packet buffer. The virtual pointer is a tuple &lt;L, O, S&gt;, where L is the iso/osi level, O is the offset in that level and S is the size of the virtual pointer. You can make algebraic operations on a virtual pointer and the result is still an offset. Specifying 'vp + n' will result in a new virtual pointer &lt;L, O+n, S&gt;. And this is perfectly legal, we have changed the internal offset of that level. Virtual pointers are in the form 'name.field.subfield'. For example 'ip.ttl' is the virtual pointer for the Time To Live field in the IP header of a packet. It will be translated as &lt;L=3, O=9, S=1&gt;. Indeed it is the 9th byte of level 3 and its size is 1 byte. 'ip.ttl + 1' is the same as 'ip.proto' since the 10th byte of the IP header is the protocol encapsulated in the IP packet. Note that since etterfilter also supports processing of IPv6, the above mentioned only applies for IPv4 packets while counterpart in IPv6 would be 'ipv6.nh'. The list of all supported virtual pointers is in the file etterfilter.tbl. You can add your own virtual pointers by adding a new table or modifying the existing ones. Refer to the comments at the beginning of the file for the syntax of etterfilter.tbl file.</p>
  </dd>
  <dt>
    <p><strong>SCRIPTS FUNCTIONS</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>search(</strong><em>where</em>, <em>what</em>)</p>
  </dt>
  <dd>
    <p>this function searches the string 'what' in the buffer 'where'. The buffer can be either DATA.data or DECODED.data. The former is the payload at layer DATA (ontop TCP or UDP) as it is transmitted on the wire, the latter is the payload decoded/decrypted by dissectors.</p><p>So, if you want to search in an SSH connection, it is better to use 'DECODED.data' since 'data' will be encrypted.</p><p>The string 'what' can be binary. You have to escape it. example:</p><p>search(DATA.data, "&#92;x41&#92;x42&#92;x43")</p>
  </dd>
  <dt>
    <p><strong>regex(</strong><em>where</em>, <em>regex</em>)</p>
  </dt>
  <dd>
    <p>this function will return true if the 'regex' has matched the buffer 'where'. The considerations about 'DECODED.data' and 'DATA.data' mentioned for the function 'search' are the same for the regex function. NOTE: regex can be used only against a string buffer. example:</p><p>regex(DECODED.data, ".*login.*")</p>
  </dd>
  <dt>
    <p><strong>pcre_regex(</strong><em>where</em>, <em>pcre_regex</em> ... )</p>
  </dt>
  <dd>
    <p>this function will evaluate a perl compatible regular expression. You can match against both DATA and DECODED, but if your expression modifies the buffer, it makes sense to operate only on DATA. The function accepts 2 or 3 parameters depending on the operation you want. The two parameter form is used only to match a pattern. The three parameter form means that you want to make a substitution. In both cases, the second parameter is the search string.</p><p>You can use $n in the replacement string. These placeholders are referred to the groups created in the search string. (e.g. pcre_regex(DATA.data, "^var1=([:digit:]*)&var2=([:digit:]*)", "var1=$2&var2=$1") will swap the value of var1 and var2).</p><p>NOTE: The pcre support is optional in ettercap and will be enabled only if you have the libpcre installed. The compiler will warn you if you try to compile a filter that contains pcre expressions but you don't have libpcre. Use the -w option to suppress the warning. example:</p><p>pcre_regex(DATA.data, ".*foo$")</p><p>pcre_regex(DATA.data, "([^ ]*) bar ([^ ]*)", "foo $1 $2")</p>
  </dd>
  <dt>
    <p><strong>replace(</strong><em>what</em>, <em>with</em>)</p>
  </dt>
  <dd>
    <p>this function replaces the string 'what' with the string 'with'. They can be binary string and must be escaped. The replacement is always performed in DATA.data since is the only payload which gets forwarded. The 'DECODED.data' buffer is used only internally and never reaches the wire. example:</p><p>replace("ethercap", "ettercap")</p>
  </dd>
  <dt>
    <p><strong>inject(</strong><em>what</em>)</p>
  </dt>
  <dd>
    <p>this function injects the content of the file 'what' after the packet being processed. It always injects in DATA.data. You can use it to replace the entire packet with a fake one using the drop() function right before the inject() command. In that case the filtering engine will drop the current packet and inject the fake one. example:</p><p>inject("./fake_packet")</p>
  </dd>
  <dt>
    <p><strong>log(</strong><em>what</em>, <em>where</em>)</p>
  </dt>
  <dd>
    <p>this function dumps in the file 'where' the buffer 'what'. No information is stored about the packet, only the payload is dumped. So you will see the stream in the file. If you want to log packets in a more enhanced mode, you need to use the ettercap -L option and analyze it with <a href="../man8/etterlog.8.html"><strong>etterlog</strong>(8)</a>.</p><p>The file 'where' must be writable to the user EC_UID (see <a href="../man5/etter.conf.5.html"><strong>etter.conf</strong>(5)</a>). example:</p><p>log(DECODED.data, "/tmp/interesting.log")</p>
  </dd>
  <dt>
    <p><strong>msg(</strong><em>message</em>)</p>
  </dt>
  <dd>
    <p>this function displays a message to the user in the User Messages window. It is useful to let the user know whether a particular filter has been successful or not. example:</p><p>msg("Packet filtered successfully")</p>
  </dd>
  <dt>
    <p><strong>drop()</strong></p>
  </dt>
  <dd>
    <p>this function marks the packet "to be dropped". The packet will not be forwarded to the real destination. example:</p><p>drop()</p>
  </dd>
  <dt>
    <p><strong>kill()</strong></p>
  </dt>
  <dd>
    <p>this function kills the connection that owns the matched packet. If it is a TCP connection, a RST is sent to both sides of the connection. If it is an UDP connection, an ICMP PORT UNREACHABLE is sent to the source of the packet. example:</p><p>kill()</p>
  </dd>
  <dt>
    <p><strong>exec(</strong><em>command</em>)</p>
  </dt>
  <dd>
    <p>this function executes a shell command. You have to provide the full path to the command since it is executed without any environment. There is no way to determine if the command was successful or not. Furthermore, it is executed asynchronously since it is forked by the main process. example:</p><p>exec("/bin/cat /tmp/foo &gt;&gt; /tmp/bar")</p>
  </dd>
  <dt>
    <p><strong>execinject(</strong><em>command</em>)</p>
  </dt>
  <dd>
    <p>this function operates similar to the <strong>inject</strong> function except that it uses the output of a shell command to inject data rather than the contents of a file. It always injects in DATA.data. You can use it to replace the entire packet with a fake one using the drop() function right before the execinject() command. In that case the filtering engine will drop the current packet and inject the fake one.</p><p>example:</p><p>execinject("/bin/cat /tmp/foo")</p>
  </dd>
  <dt>
    <p><strong>exit()</strong></p>
  </dt>
  <dd>
    <p>this function causes the filter engine to stop executing the code. It is useful to stop the execution of the script on some circumstance checked by an 'if' statement. example:</p><p>exit()</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Here are some examples of using etterfilter.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>etterfilter filter.ecf -o filter.ef</strong></p>
  </dt>
  <dd>
    <p>Compiles the source filter.ecf into a binary filter.ef</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ORIGINAL AUTHORS</h2>
        <div class="sectioncontent">
<p>Alberto Ornaghi (ALoR) &lt;alor@users.sf.net&gt;</p><p>Marco Valleri (NaGA) &lt;naga@antifork.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROJECT STEWARDS</h2>
        <div class="sectioncontent">
<p>Emilio Escobar (exfil)  &lt;eescobar@gmail.com&gt;</p><p>Eric Milam (Brav0Hax)  &lt;jbrav.hax@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OFFICIAL DEVELOPERS</h2>
        <div class="sectioncontent">
<p>Mike Ryan (justfalter)  &lt;falter@gmail.com&gt;</p><p>Gianfranco Costamagna (LocutusOfBorg)  &lt;costamagnagianfranco@yahoo.it&gt;</p><p>Antonio Collarino (sniper)  &lt;anto.collarino@gmail.com&gt;</p><p>Ryan Linn   &lt;sussuro@happypacket.net&gt;</p><p>Jacob Baines   &lt;baines.jacob@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTRIBUTORS</h2>
        <div class="sectioncontent">
<p>Dhiru Kholia (kholia)  &lt;dhiru@openwall.com&gt;</p><p>Alexander Koeppe (koeppea)  &lt;format_c@online.de&gt;</p><p>Martin Bos (PureHate)  &lt;purehate@backtrack.com&gt;</p><p>Enrique Sanchez</p><p>Gisle Vanem  &lt;giva@bgnett.no&gt;</p><p>Johannes Bauer  &lt;JohannesBauer@gmx.de&gt;</p><p>Daten (Bryan Schneiders)  &lt;daten@dnetc.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO etterfilter&hellip;</h2>
        <div class="sectioncontent">
<p><em>etter.filter.examples</em></p><p><a href="../man8/ettercap.8.html"><strong>ettercap</strong>(8)</a></em> <a href="../man8/etterlog.8.html"><strong>etterlog</strong>(8)</a></em> <a href="../man5/etter.conf.5.html"><strong>etter.conf</strong>(5)</a></em> <a href="../man8/ettercap_curses.8.html"><strong>ettercap_curses</strong>(8)</a></em> <a href="../man8/ettercap_plugins.8.html"><strong>ettercap_plugins</strong>(8)</a></em> <a href="../man8/ettercap-pkexec.8.html"><strong>ettercap-pkexec</strong>(8)</a></em></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ettercap_plugins.8.html"><span aria-hidden="true">&larr;</span> ettercap_plugins.8: A collection of plugins for ettercap</a></li>
   <li class="next"><a href="etterlog.8.html">etterlog.8: Log analyzer for ettercap log files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
