<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mimedefang: Sendmail mime mail filter</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Sendmail mime mail filter">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mimedefang (8) manual">
  <meta name="twitter:description" content="Sendmail mime mail filter">
  <meta name="twitter:image" content="https://www.carta.tech/images/mimedefang-mimedefang-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/mimedefang.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mimedefang (8) manual" />
  <meta property="og:description" content="Sendmail mime mail filter" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mimedefang-mimedefang-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mimedefang<small> (8)</small></h1>
        <p class="lead">Sendmail mime mail filter</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mimedefang.8.html">
      <span itemprop="name">mimedefang: Sendmail mime mail filter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mimedefang/">
      <span itemprop="name">mimedefang</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mimedefang.8.html">
      <span itemprop="name">mimedefang: Sendmail mime mail filter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mimedefang prcap</strong></p><p><strong>mimedefang </strong>-p <em>connection</em> -m <em>mx_socket_name</em> -U <em>user</em> [<em>options</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mimedefang</strong> is a filter built around Sendmail 8.11's <em>milter</em> API for mail filters.  It collects each incoming message and runs a filter on the message.  This is useful for deleting attachments which may be a security risk on poorly-designed systems like Microsoft Windows.</p><p><strong>mimedefang</strong> does not actually run the Perl filter; instead, it communicates with <a href="../man8/mimedefang-multiplexor.8.html"><strong>mimedefang-multiplexor</strong>(8)</a>, which manages a pool of persistent Perl processes.  See the <strong>mimedefang-multiplexor</strong> man page for additional information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>If you invoke <strong>mimedefang</strong> with the single argument <strong>prcap</strong>, it prints information about the version of Milter it is linked against and exits.  Otherwise, you should invoke <strong>mimedefang</strong> as shown in the second line of the SYNOPSIS.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-U </strong><em>user</em></p>
  </dt>
  <dd>
    <p>Runs <strong>mimedefang</strong> as <em>user</em> rather than <em>root</em>.  The <em>user</em> argument must match the argument to <strong>mimedefang-multiplexor</strong>'s <strong>-U</strong> option as well.</p>
  </dd>
  <dt>
    <p><strong>-y</strong></p>
  </dt>
  <dd>
    <p>If the <strong>-y</strong> command-line option is given, MIMEDefang will call smfi_setsymlist to set the list of macros it wants.  <em>This function</em> leaked memory in versions of Sendmail prior to 8.14.4 so by default we do not call it.  If you are running an older version of sendmail, you should explicitly set the list of macros you want in the Sendmail configuration file.</p>
  </dd>
  <dt>
    <p><strong>-z </strong><em>spooldir</em></p>
  </dt>
  <dd>
    <p>Set the spool directory to <em>spooldir</em>.  If this option is omitted, the spool directory defaults to /var/spool/MIMEDefang.</p>
  </dd>
  <dt>
    <p><strong>-p </strong><em>connection</em></p>
  </dt>
  <dd>
    <p>The <strong>-p</strong> switch is required and specifies the <em>milter</em> connection type.  Typically, you should run <strong>mimedefang</strong> on the same computer as <strong>sendmail</strong>.  Therefore, you should use a UNIX-domain socket for the connection type.  The suggested value for the <strong>-p</strong> switch is <strong>mimedefang.sock</strong> under the spool directory.</p>
  </dd>
  <dt>
    <p><strong>-m </strong><em>mx_socket_name</em></p>
  </dt>
  <dd>
    <p>Specifies the socket for communicating with <a href="../man8/mimedefang-multiplexor.8.html"><strong>mimedefang-multiplexor</strong>(8)</a>.  The <em>mx_socket_name</em> specifies the path of the UNIX-domain socket.  See <a href="../man8/mimedefang-multiplexor.8.html"><strong>mimedefang-multiplexor</strong>(8)</a> for details.</p>
  </dd>
  <dt>
    <p><strong>-b </strong><em>backlog</em></p>
  </dt>
  <dd>
    <p>Sets the "backlog" argument to the <a href="../man2/listen.2.html"><strong>listen</strong>(2)</a> system call to <em>backlog</em>.  If this option is omitted, then the operating-system default backlog is used.</p>
  </dd>
  <dt>
    <p><strong>-G</strong></p>
  </dt>
  <dd>
    <p>Normally, <strong>mimedefang</strong> uses a umask of 077 when creating the milter socket and files.  If you would like the socket to be readable and writeable by the group and files to be group-readable, supply the <strong>-G</strong> option.  This causes the umask to be 007 whenever UNIX-domain sockets are created and 027 whenever files are created. <em>Note</em>: if your milter library is too old to have the smfi_opensocket() function, the <strong>-G</strong> option causes <strong>mimedefang</strong> to use a umask of 007 throughout its execution.</p><p>Note that by default, /var/spool/MIMEDefang is created with mode 0700. If you use the <strong>-G</strong> option, you probably should change the mode to 0750.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>The <strong>-d</strong> switch causes <strong>mimedefang</strong> <em>not</em> to delete the temporary spool files it creates for incoming messages.  This is for debugging purposes only and should <em>never</em> be used on a production mail server.</p>
  </dd>
  <dt>
    <p><strong>-r</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to perform a relay check before processing any messages.  It calls into a user-supplied Perl function called <strong>filter_relay</strong> with the IP address and host name of the sending relay.  (See <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a> for details.)</p>
  </dd>
  <dt>
    <p><strong>-H</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to perform a HELO check before processing any messages.  It calls into a user-supplied Perl function called <strong>filter_helo</strong> with the IP address and host name of the sending relay, and the HELO argument.  (See <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a> for details.)</p>
  </dd>
  <dt>
    <p><strong>-s</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to perform a sender check before processing the message body.  It calls into a user-supplied Perl function called <strong>filter_sender</strong> with the envelope address of the sender. (See <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a> for details.)</p>
  </dd>
  <dt>
    <p><strong>-t</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to perform recipient checks before processing the message body.  It calls into a user-supplied Perl function called <strong>filter_recipient</strong> with the envelope address of each recipient. (See <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a> for details.)</p>
  </dd>
  <dt>
    <p><strong>-q</strong></p>
  </dt>
  <dd>
    <p>Permits the multiplexor to queue new connections.  See the section QUEUEING REQUESTS in the mimedefang-multiplexor man page.  Note that this option and the <strong>-R</strong> option are mutually-exclusive.  If you supply <strong>-q</strong>, then <strong>-R</strong> is ignored.</p>
  </dd>
  <dt>
    <p><strong>-k</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> <em>not</em> to delete working directories if a filter fails.  This lets you obtain the message which caused the filter to fail and determine what went wrong.  <strong>mimedefang</strong> logs the directory containing the failed message using syslog.</p>
  </dd>
  <dt>
    <p><strong>-P </strong><em>fileName</em></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to write its process-ID (after becoming a daemon) to the specified file.</p>
  </dd>
  <dt>
    <p><strong>-R </strong><em>num</em></p>
  </dt>
  <dd>
    <p>Normally, <strong>mimedefang</strong> tempfails a new SMTP connection if there are no free slaves.  Supplying the <strong>-R</strong> <em>num</em> option makes <strong>mimedefang</strong> tempfail new connections if there are fewer than <em>num</em> free slaves, <em>unless</em> the connection is from the local host.  This allows you to favour connections from localhost so your clientmqueue doesn't build up.  Note that supplying <strong>-R 0</strong> is subtly different from omitting the option; in this case, <strong>mimedefang</strong> permits new connections from localhost to queue, but not connections from other hosts (unless you also supply the <strong>-q</strong> option.)</p><p>The purpose of the <strong>-R</strong> option is to reserve resources for clientmqueue runs.  Otherwise, on a very busy mail server, clientmqueue runs can starve for a long time, leading to delays for locally-generated or streamed mail.  We recommend using a small number for <em>num</em>; probably no more than 3 or 10% of the total number of slaves (whichever is smaller.)</p><p>Note that this option and the <strong>-q</strong> option are mutually-exclusive. If you supply <strong>-q</strong>, then <strong>-R</strong> is ignored.</p>
  </dd>
  <dt>
    <p><strong>-C</strong></p>
  </dt>
  <dd>
    <p>Conserve file descriptors by opening and closing disk files more often.  (Disk files are never held open across Milter callbacks.) While this shortens the length of time a file descriptor is open, it also leaves more opportunities for the open to fail.  We do not recommend the use of this flag except on very busy systems that exhibit failures due to a shortage of file descriptors.</p>
  </dd>
  <dt>
    <p><strong>-T</strong></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang</strong> to log the run-time of the Perl filter using syslog.</p>
  </dd>
  <dt>
    <p><strong>-x </strong><em>string</em></p>
  </dt>
  <dd>
    <p>Add <em>string</em> as the content of the X-Scanned-By: header.  If you set <em>string</em> to the empty string (i.e. -x ""), then no X-Scanned-By: header will be added.</p>
  </dd>
  <dt>
    <p><strong>-X</strong></p>
  </dt>
  <dd>
    <p>Do not add an X-Scanned-By: header.  Specifying -X is equivalent to specifying -x "".</p>
  </dd>
  <dt>
    <p><strong>-D</strong></p>
  </dt>
  <dd>
    <p>Do not fork into the background and become a daemon.  Instead, stay in the foreground.  Useful mainly for debugging or if you have a supervisory process managing <strong>mimedefang</strong>.</p>
  </dd>
  <dt>
    <p><strong>-M</strong></p>
  </dt>
  <dd>
    <p>This option is obsolete; it is accepted for backward-compatibility, but is ignored.</p>
  </dd>
  <dt>
    <p><strong>-N</strong></p>
  </dt>
  <dd>
    <p>Normally, <strong>mimedefang</strong> sees all envelope recipients, even ones that Sendmail knows to be invalid.  If you don't want Sendmail to perform a milter callback for recipients it knows to be invalid, invoke <strong>mimedefang</strong> with the -N flag.  <em>Please note that this</em> flag only works with Sendmail and Milter 8.14.0 and newer.  It has no effect if you're running an older version of Sendmail or Milter.</p>
  </dd>
  <dt>
    <p>-S <em>facility</em></p>
  </dt>
  <dd>
    <p>Specifies the syslog facility for log messages.  The default is <em>mail</em>.  See <a href="../man3/openlog.3.html"><strong>openlog</strong>(3)</a> for a list of valid facilities. You can use either the short name ("mail") or long name ("LOG_MAIL") for the facility name.</p>
  </dd>
  <dt>
    <p>-a <em>macro</em></p>
  </dt>
  <dd>
    <p>Pass the value of the specified Sendmail macro through to the Perl filter. You can repeat the -a option to write more macros than the built-in defaults.  Note that in addition to asking <strong>mimedefang</strong> to pass the macro value to the filter, you must configure Sendmail to pass the macro through to <strong>mimedefang</strong> using the confMILTER_MACROS_ENVFROM definition in Sendmail's m4 configuration file.</p>
  </dd>
  <dt>
    <p><strong>-c</strong></p>
  </dt>
  <dd>
    <p>Strip "bare" carriage-returns (CR) characters from the message body. A bare CR should never appear in an e-mail message.  Older versions of <strong>mimedefang</strong> used to strip them out automatically, but now they are left in by default.  The <strong>-c</strong> option enables the older behavior.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>Print usage information and exit.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPERATION</h2>
        <div class="sectioncontent">
<p>When <strong>mimedefang</strong> starts, it connects to <strong>sendmail</strong> using the <em>milter</em> API.  (See the Sendmail 8.11 documentation.)  For each incoming message, <strong>mimedefang</strong> creates a temporary directory and saves information in the directory.  At various phases during the SMTP conversation, <strong>mimedefang</strong> communicates with <strong>mimedefang-multiplexor</strong> to perform various operations.  <strong>mimedefang-multiplexor</strong> manages a pool of persistent Perl processes that actually perform the mail scanning operations.</p><p>When a Perl process scans an e-mail, the temporary spool directory contains certain files; details of the communication protocol between <strong>mimedefang</strong> and the Perl script are in <a href="../man7/mimedefang-protocol.7.html"><strong>mimedefang-protocol</strong>(7)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WARNINGS</h2>
        <div class="sectioncontent">
<p><strong>mimedefang</strong> does violence to the flow of e-mail.  The Perl filter is quite picky and assumes that MIME e-mail messages are well-formed. While I have tried to make the script safe, I take <em>no responsibility</em> for lost or mangled e-mail messages or any security holes this script may introduce.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>mimedefang</strong> was written by David F. Skoll &lt;dfs@roaringpenguin.com&gt;. The <strong>mimedefang</strong> home page is <em>http://www.mimedefang.org/</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mimedefang&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/mimedefang.pl.8.html"><strong>mimedefang.pl</strong>(8)</a>, <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a>, <a href="../man8/mimedefang-multiplexor.8.html"><strong>mimedefang-multiplexor</strong>(8)</a>, <a href="../man7/mimedefang-protocol.7.html"><strong>mimedefang-protocol</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="miltertest.8.html"><span aria-hidden="true">&larr;</span> miltertest.8: Milter unit test utility</a></li>
   <li class="next"><a href="mimedefang-multiplexor.8.html">mimedefang-multiplexor.8: Process pool controller for mail filters. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
