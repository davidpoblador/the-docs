<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dhcp_probe: Locate dchp and bootp servers on a directly-attached network</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Locate dchp and bootp servers on a directly-attached network">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dhcp_probe (8) manual">
  <meta name="twitter:description" content="Locate dchp and bootp servers on a directly-attached network">
  <meta name="twitter:image" content="https://www.carta.tech/images/dhcp-probe-dhcp_probe-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/dhcp_probe.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dhcp_probe (8) manual" />
  <meta property="og:description" content="Locate dchp and bootp servers on a directly-attached network" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dhcp-probe-dhcp_probe-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dhcp_probe<small> (8)</small></h1>
        <p class="lead">Locate dchp and bootp servers on a directly-attached network</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dhcp_probe.8.html">
      <span itemprop="name">dhcp_probe: Locate dchp and bootp servers on a directly-attached network</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dhcp-probe/">
      <span itemprop="name">dhcp-probe</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dhcp_probe.8.html">
      <span itemprop="name">dhcp_probe: Locate dchp and bootp servers on a directly-attached network</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>dhcp_probe [ <strong>-c</strong> <em>config_file</em> ] [ <strong>-d</strong> <em>debuglevel</em> ] [ <strong>-f</strong> ] [ <strong>-h</strong> ] [ <strong>-l</strong> <em>log_file</em> ] [ <strong>-o</strong> <em>capture_file</em> ] [ <strong>-p</strong> <em>pid_file</em> ] [ <strong>-Q</strong> <em>vlan_id</em> ] [ <strong>-s</strong> <em>capture_bufsize</em> ] [ <strong>-T</strong> ] [ <strong>-v</strong> ] [ <strong>-w</strong> <em>cwd</em> ] <em>interface_name</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>dhcp_probe attempts to discover DHCP and BootP servers on a directly-attached Ethernet network. A network administrator can use this tool to locate unauthorized DHCP and BootP servers.</p><p>The program must be run with root privilege.</p><p>The program periodically broadcasts a number of DHCP and BootP request packets out a single physical interface. Several different kinds of request packets are sent, as a DHCP or BootP server may only respond to certain requests, depending on the server's configuration. Essentially, dhcp_probe mimics a BootP or DHCP client in a variety of possible states, attempting to provoke responses from servers.</p><p>After sending each request packet, dhcp_probe listens for responses. After filtering out responses that do not appear to be in response to the probe, and responses from known DHCP and BootP servers (identified by their IP source addresses and optionally by their Ethernet source addresses), it logs any responses from unknown servers.</p><p>Optionally, responses from unknown servers may also be written to a packet capture file.</p><p>Optionally, an external program may be called each time a response from an unknown server is received.</p><p>dhcp_probe may not be able to locate all DHCP and BootP servers; see LIMITATIONS below.</p><p>As DHCP broadcasts do not ordinarily cross IP routers, dhcp_probe will locate only servers that are attached to the same physical network as the interface specified on the command line. Although BootP Relay Agents running on this network may help the broadcasts cross IP routers, these agents typically are configured to convert the broadcasts to unicasts directed to only the well-known DHCP or BootP servers located on other physical networks. As a result, BootP Relay Agents will allow your the servers to receive the requests issued by dhcp_probe, but will not cause remote unknown servers to hear these requests. Therefore, if you have multiple physical networks, you may wish to run dhcp_probe on each of these networks to discover unknown DHCP and BootP servers on each of them.</p><p>dhcp_probe functions on a single Ethernet interface specified on the command line; it does not listen on multiple interfaces. However, if the host has multiple physical interfaces, you may run an instance of dhcp_probe on each interface. If your physical interface supports 802.1Q, you can use that to create a logical interface on each VLAN, then run an instance of dhcp_probe on each logical interface.</p><p>dhcp_probe is intended for use by a network administrator. Before running dhcp_probe on any network other than one for which you are responsible, contact that network's administrator to learn if it is acceptable for you to run this software on that network. Running this software may violate on a network where you don't have permission to do so may violate that network's acceptable use policy.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AVAILABILITY</h2>
        <div class="sectioncontent">
<p>dhcp_probe is a product of the Network Systems Group at Princeton University's Office of Information Technology, and is available from http://www.net.princeton.edu/software/dhcp_probe/</p><p>Presently the product builds and runs on Solaris 9 on SPARC with gcc. The program relies on the <strong>pcap</strong>(3) and <strong>libnet</strong>(3) libraries.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-c</em><strong></strong><em>config_file</em></p>
  </dt>
  <dd>
    <p>Specifies the configuration file. If not specified, this defaults to <strong>/etc/dhcp_probe.cf</strong>. The configuration file is read at startup, and is re-read whenever a SIGHUP is received. See <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>.</p>
  </dd>
  <dt>
    <p><strong>-d</strong><em></em><strong>debuglevel</strong></p>
  </dt>
  <dd>
    <p>Sets the <em>debuglevel</em> variable that controls the amount of debugging messages generated. If not specified, this defaults to 0 (no debugging). For a summary of the types of messages produced at each debug level, see DEBUG LEVELS below.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>Specifies that the program should not fork, but instead remain in the foreground. Only use this when you are starting the program manually for testing purposes. When in the foreground, any messages produced by the program are written to <em>stderr</em> instead of to <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a> or any <em>log_file</em> you might specify with the <strong>-l</strong> option.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>Display a brief usage summary, then exit.</p>
  </dd>
  <dt>
    <p><strong>-l</strong><em></em><strong>log_file</strong></p>
  </dt>
  <dd>
    <p>Log messages to the specified file instead of to <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a>. (This option is ignored if you also specify the <strong>-f</strong> option, as that directs messages to <em>stderr</em>.) The log file is opened shortly after the program starts. It is closed and re-opened when the program receives a SIGUSR1 signal.</p>
  </dd>
  <dt>
    <p><strong>-o</strong><em></em><strong>capture_file</strong></p>
  </dt>
  <dd>
    <p>When a response packet is received from an unexpected server, write the packet to the specified file. The file is opened and truncated shortly after the program starts. It is closed and re-opened (and truncated) when the program receives a SIGUSR2 signal. The file is a <strong>pcap</strong>(3) savefile, and may be read with any program that understands the pcap savefile format; e.g. <strong>tcpdump</strong>(1).</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em></em><strong>pid_file</strong></p>
  </dt>
  <dd>
    <p>Specifies the file that will contain the program's processid. If not specified, this defaults to <strong>/var/run/dhcp_probe.pid</strong>. The <em>pid_file</em> is written shortly after the program starts, and is removed when the program exits under its own control.</p>
  </dd>
  <dt>
    <p><strong>-Q</strong><em></em><strong>vlan_id</strong></p>
  </dt>
  <dd>
    <p>Specifies that the packets we send should be tagged with an 802.1Q VLAN ID vlan_id. Valid values range from 0 to 4095. If not specified, the packets we send do not contain an 802.1Q header.</p>
  </dd>
  <dt>
    <p><strong>-s</strong><em></em><strong>capture_bufsize</strong></p>
  </dt>
  <dd>
    <p>Specifies the size of the buffer that will be used to capture all the responses (Ethernet frames) to a single request packet; responses which do not fit are silently dropped. The value is specified in bytes, and must fit into your host's range for an <em>int</em>; values outside that range may result in unpredictable results. If not specified, this defaults to 30280, which is enough for twenty maximum-size Ethernet frames (1514*20). Typical responses are Ethernet frames ranging from 342-590 bytes, so the default capture buffer size should hold over 50 of them.</p>
  </dd>
  <dt>
    <p><strong>-T</strong></p>
  </dt>
  <dd>
    <p>Enables the 'socket receive timeout' feature. On some platforms, dhcp_probe may ignore the <em>response_wait_time</em> (described in <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>), instead waiting forever for a response after it sends a probe packet. As per <strong>pcap</strong>(3), this is because the read timeout we pass to pcap_open_live() is not supported on all platforms. If you encounter this issue, try enabling our 'socket receive timeout' feature; it might help. Enabling this feature causes the program to also set a socket receive timeout on the socket underlying the pcap capture; we set this timeout to the <em>response_wait_time</em>. On some platforms, the program's socket receive timeout feature does not work; instead the program will report that it cannot set the receive timeout, and will exit.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Display the program's version number, then exit.</p>
  </dd>
  <dt>
    <p><em>-w</em><strong></strong><em>cwd</em></p>
  </dt>
  <dd>
    <p>Specifies the working directory; shortly after starting the program changes its current working directory to this. If not specified, this defaults to <em>/</em>.</p>
  </dd>
  <dt>
    <p><em>interface_name</em></p>
  </dt>
  <dd>
    <p>Specifies the name of the interface the program should use; this argument is required. This must be an Ethernet interface which is up and has been assigned an IP address.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPERATION</h2>
        <div class="sectioncontent">
<p>After initialization, the program enters its main event loop, in which it remains until you signal the program to exit with a SIGINT, SIGTERM, or SIGQUIT.</p><p>The main event loop (a.k.a. the "probe cycle") consists of the following actions, repeated until the program receives a request to quit:</p>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p>Handle any signals that have been received.</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p>Install a <strong>pcap</strong>(3) filter to listen for UDP packets destined to the BootP client port (UDP port 68).</p>
  </dd>
  <dt>
    <p>3.</p>
  </dt>
  <dd>
    <p>Broadcast a DHCP or BootP request packet out the specified interface.</p>
  </dd>
  <dt>
    <p>4.</p>
  </dt>
  <dd>
    <p>Listen for <em>response_wait_time</em> milliseconds for any responses received by the <strong>pcap</strong>(3) filter. (The <em>response_wait_time</em> defaults to 5000 milliseconds (5 seconds), and may be changed in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file.)</p><p>Any responses that contains a bootp_chaddr field not equal to the chaddr used in the probe is ignored, as are any that have incorrect bootp_htype or bootp_hlen fields. These are not responses to our probe.</p><p>Any responses from known DHCP and BootP servers are ignored. The IP source address for responses from each known server is declared using a <strong>legal_server</strong> statement in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file. Any response with an IP source address that does not appear in a <strong>legal_server</strong> statement is treated as an unknown server.</p><p>The Ethernet source address for responses from each known server is also optionaly declared using a <strong>legal_server_ethersrc</strong> statement in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file. If at least one <strong>legal_server_ethersrc</strong> is specified, then any response with an Ethernet source address that does not appear in a <strong>legal_server_ethersrc</strong> statement is treated as an unknown server. If no <strong>legal_server_ethersrc</strong> statements appear, then the response's Ethernet source address is not checked. (The <strong>legal_server_ethersrc</strong> statement is considered experimental in version 1.3.0, as it has received only limited testing.)</p><p>For each response from an unknown server:</p>
  </dd>
  <dt>
    <p>a)</p>
  </dt>
  <dd>
    <p>If the reponse packet contains a non-zero <strong>yiaddr</strong> field, and one or more <strong>lease_network_of_concern</strong> statements were specified, determine if the <strong>yiaddr</strong> value falls within any of the "Lease Networks of Concern".</p>
  </dd>
  <dt>
    <p>a)</p>
  </dt>
  <dd>
    <p>Log a message showing the response packet's source IP and Ethernet addresses. If the response packet's yiaddr is non-zero and falls within a "Lease Networks of Concern", the log message also reports that.</p>
  </dd>
  <dt>
    <p>b)</p>
  </dt>
  <dd>
    <p>If the <strong>-o</strong> option was specified, the packet is also written to a packet capture file.</p>
  </dd>
  <dt>
    <p>c)</p>
  </dt>
  <dd>
    <p>If an <em>alert_program_name</em> was specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, that program is executed, with the following arguments in order: the name of the calling program (e.g. <strong>dhcp_probe</strong>), the name of the interface on which the unexpected response packet was received, the IP source address of the packet, and the Ethernet source address of the packet. (We do not wait for the <em>alert_program_name</em> to complete; it runs in a child process.)</p>
  </dd>
  <dt>
    <p>d)</p>
  </dt>
  <dd>
    <p>If an <em>alert_program_name2</em> was specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, that program is executed, with the following required options:</p>
<pre>
   -p the name of the calling program (e.g. dhcp_probe)
   -I the name of the interface on which the unexpected response packet was received
   -i the IP source address of the packet
   -m and the Ethernet source address of the packet
</pre>
<p>If the response packet's yiaddr is non-zero and falls within a "Lease Networks of Concern", the following optional options are also passed:</p>
<pre>
   -y the non-zero yiaddr value
</pre>
<p>(We do not wait for the <em>alert_program_name2</em> to complete; it runs in a child process.)</p>
  </dd>
  <dt>
    <p>5.</p>
  </dt>
  <dd>
    <p>Remove the <strong>pcap</strong>(3)</strong> filter installed earlier.</p>
  </dd>
  <dt>
    <p>6.</p>
  </dt>
  <dd>
    <p>If any signals have arrived requesting that we quit, exit gracefully.</p>
  </dd>
  <dt>
    <p>7.</p>
  </dt>
  <dd>
    <p>Repeat steps 2-6  for each flavor of DHCP and BootP request packet the program supports (see PACKET FLAVORS below).</p>
  </dd>
  <dt>
    <p>8.</p>
  </dt>
  <dd>
    <p>Handle any signals that have been received.</p>
  </dd>
  <dt>
    <p>9.</p>
  </dt>
  <dd>
    <p>Sleep for <em>cycle_time</em> seconds. (The <em>cycle_time</em> defaults to 300 seconds, and and may be changed in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file.)</p>
  </dd>

</dl>
<p>The <strong>pcap</strong>(3) filter the program installs normally does not specify that the interface should be placed into promiscuous mode (although it is possible the interface is already in promiscuous mode for some other reason). However, if in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file you specify a <em>chaddr</em> or <em>ether_src</em> value other than the interface's actual hardware address, then the pcap filter <em>will</em> specify that the interface should be placed into promiscuous mode.</p><p>Although the filter used with <strong>pcap</strong>(3) specifies only UDP packets destined to port <em>bootpc</em> should be collected, on systems where <em>bpf</em> isn't part of the kernel, <strong>pcap</strong>(3) must implement <em>bpf</em> as part of the application. This can increase the number of packets that must be passed from the kernel to user space to be filtered. The program attempts to minimize the side-effects of this by removing the <strong>pcap</strong>(3) filter when it isn't actually listening for responses. In particular, the filter is not installed during the time the program sleeps between each probe cycle (the <em>cycle_time</em>).</p><p>If you do specify an <em>alert_program_name</em>, take care that the program you specify is safe for a privileged user to run; it is executed with the same (i.e. root) privileges as the calling program.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PACKET FLAVORS</h2>
        <div class="sectioncontent">
<p>No single request packet is likely to provoke a response from every possible BootP and DHCP server. Some servers may only response to either BootP, or DHCP, but not both. Some servers may be configured to only respond to a small set of known clients. Some DHCP servers will only provide leases to a small set of known clients, but may be willing to respond (negatively) to unknown clients that request a lease renewal on an inappropriate IP address. Therefore, dhcp_probe actually sends not one, but five different flavor request packets, in the hopes of provoking responses from a wider variety of unknown servers.</p><p>The packet flavors are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>BOOTPREQUEST</p>
  </dt>
  <dd>
    <p>This packet is typical of a BootP client requesting an IP address.</p><p>It will typically provoke a BOOTPREPLY from a BootP server willing to respond to any BootP client. (BootP servers configured to only respond to a set of known clients may not respond.)</p>
  </dd>
  <dt>
    <p>DHCPDISOVER (INIT)</p>
  </dt>
  <dd>
    <p>This packet is typical of a DHCP client in the INIT state.</p><p>The options field contains a DHCP Message Type specifying DHCPDISCOVER.</p><p>The options field contains a DHCP Client Identifier, which is computed by prepending 0x'01' to the value of <em>chaddr</em>. (The value <em>chaddr</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to the interface's Ethernet address.)</p><p>This packet will typically provoke a  DHCPOFFER from a DHCP server willing to respond to any DHCP client. (DHCP servers configured to only offer leases to a set of known clients may not respond.)</p>
  </dd>
  <dt>
    <p>DHCPREQUEST (SELECTING):</p>
  </dt>
  <dd>
    <p>This packet is typical of a DHCP client in the SELECTING state; i.e. a client which has previously issued a DHCPDISCOVER, then received a DHCPOFFER from some DHCP server.</p><p>The options field contains a DHCP Message Type specifying DHCPREQUEST.</p><p>The options field contains a DHCP Client Identifier, which is computed by prepending 0x'01' to the value of <em>chaddr</em>. (The value <em>chaddr</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to the interface's Ethernet address.)</p><p>The options field contains a DHCP Server Identifier specifying <em>server_id</em>, which should be an IP address that does not correspond to any valid DHCP Server Identifier on your network. (The value <em>server_id</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to 10.254.254.254.)</p><p>The options field contains a DHCP Requested IP Address specifying <em>client_ip_address</em>, which should be an IP address that does not correspond to any valid IP address on your network. (The value <em>client_ip_address</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to 172.31.254.254.)</p><p>This packet occassionally provokes a response from a broken DHCP server that fails to respect the DHCP Server Identifier option.</p>
  </dd>
  <dt>
    <p>DHCPREQUEST (INIT-REBOOT):</p>
  </dt>
  <dd>
    <p>This packet is typical of a DHCP client in the INIT-REBOOT state; i.e. a client which has obtained a DHCP lease in the past, is bringing up its IP stack, and hopes to obtain (or extend) a DHCP lease on the same IP address as in the past.</p><p>The options field contains a DHCP Message Type specifying DHCPREQUEST.</p><p>The options field contains a DHCP Client Identifier, which is computed by prepending 0x'01' to the value of <em>chaddr</em>. (The value <em>chaddr</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to the interface's Ethernet address.)</p><p>The options field contains a DHCP Requested IP Address specifying <em>client_ip_address</em>, which should be an IP address that does not correspond to any valid IP address on your network; ideally it should be one that is topologically inappropriate for your network. (The value <em>client_ip_address</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to 172.31.254.254.)</p><p>If the Requested IP Address option is topologically inappropriate for your network, this packet may provoke a DHCPNAK from any DHCP server that believes it is authoritative for the network's IP topology.</p>
  </dd>
  <dt>
    <p>DHCPREQUEST (REBINDING)</p>
  </dt>
  <dd>
    <p>This packet is typical of a DHCP client in the REBINDING state; i.e. a client which has obtained a DHCP lease which is between its DHCP T2 and expiration time.</p><p>The options field contains a DHCP Message Type specifying DHCPREQUEST.</p><p>The options field contains a DHCP Client Identifier, which is computed by prepending 0x'01' to the value of <em>chaddr</em>. (The value <em>chaddr</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to the interface's Ethernet address.)</p><p>The ciaddr field contains <em>client_ip_address</em>, which should be an IP address that does not correspond to any valid IP address on your network; ideally it should be one that is topologically inappropriate for your network. (The value <em>client_ip_address</em> is specified in the <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a> file, otherwise it defaults to 172.31.254.254.)</p><p>If the value of ciaddr is topologically inappropriate for your network, this packet will provoke a DHCPNAK from any DHCP server that believes it is authoritative for the network's IP topology.</p>
  </dd>

</dl>
<p>All the request packets sent by the program share the following common characteristics:</p><p>Ethernet Header</p><p>destination: ff:ff:ff:ff:ff:ff</p><p>source: <em>ether_src</em> from <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>, else interface hardware address</p><p>type: ETHERTYPE_IP (0x0800)</p><p>IP Header</p><p>version: 4</p><p>header length: 5</p><p>tos: 0</p><p>total length: 328 (20-byte IP header + 8-byte UDP header + 300-byte BootP/DHCP payload)</p><p>identifier: 1</p><p>flags: 0</p><p>fragment offset: 0</p><p>ttl: 60</p><p>protocol: IPPROTO_UDP (17)</p><p>header checksum: (computed)</p><p>source address: 0.0.0.0</p><p>destination address: 255.255.255.255</p><p>options: (none)</p><p>UDP Header</p><p>source port: PORT_BOOTPC (68)</p><p>dest port:  PORT_BOOTPS (67)</p><p>checksum: (computed)</p><p>BootP/DHCP Payload</p><p>op: BOOTREQUEST (1)</p><p>htype: HTYPE_ETHER (1)</p><p>hlen: HLEN_ETHER (6)</p><p>hops: 0</p><p>xid: 1</p><p>secs: 0</p><p>flags: 0</p><p>ciaddr: 0.0.0.0 (except for DHCPREQUEST (REBINDING) packets it is <em>client_ip_address</em> from <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>, else 172.31.254.254)</p><p>siaddr: 0.0.0.0</p><p>giaddr: 0.0.0.0</p><p>chaddr: <em>chaddr</em> from <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>, else interface hardware address</p><p>sname: (all 0's)</p><p>file: (all 0's)</p><p>options: RFC1048 cookie (0x63825363), possibly followed by DHCP options, followed by END option (0xFF), followed by PAD options (0x00) to bring the field to 64 bytes</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MULTIPLE INTERFACES</h2>
        <div class="sectioncontent">
<p>Although dhcp_probe only supports monitoring a single physical interface, you may run an instance of the program on each physical interface; each monitors a different physical network.</p><p>When running multiple copies of dhcp_probe, be sure to specify a different <em>pid_file</em> for each instance.</p><p>If you specify a <em>log_file</em> and/or a <em>capture_file</em>, be sure to specify a different one for each instance.</p><p>You may specify a different <em>config_file</em> for each instance. If you don't need to customize the settings in that file for each instance, you may use the same configuration file for all instances.</p><p>If you have multiple logical interfaces on the same physical interface, or multiple logical IP networks running on a single physical network, there is no need to run multiple instances of dhcp_probe to monitor each logical interfaces or logical network. A single instance of the program running on a physical interface is sufficient to provoke any servers on that physical network that might be willing to respond.</p><p>If your physical interface supports 802.1Q, you can use a single physical interface to monitor multiple VLANs. Use your operating system to create a logical interface on each VLAN, then run an instance of the program on each logical interface. Since the program is responsible for constructing Ethernet frame headers, you will probably need to specify the -Q option to instruct it to add to outgoing frames an 802.1Q VLAN header with the appropriate VLAN ID.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNALS</h2>
        <div class="sectioncontent">
<p>The program will respond to a number of signals:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>SIGUSR1</strong></p>
  </dt>
  <dd>
    <p>If logging to a file, close and re-open it. If the program is in the middle of a probe cycle, handling the signal is deferred until the end of the cycle. (Has no effect if logging to <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a> or if the <strong>-f</strong> option was specified.)</p>
  </dd>
  <dt>
    <p><strong>SIGUSR2</strong></p>
  </dt>
  <dd>
    <p>If capturing to a file, close and re-open it. If the program is in the middle of a probe cycle, handling the signal is deferred until the end of the cycle. (Has no effect if the <strong>-o</strong> option was not specified.)</p><p>Because re-opening the capture file causes the file to be truncated and a new <strong>pcap</strong>(3) header to be written to it, if you want to save the prior contents of the capture file, move the existing capture file aside before sending the signal.</p>
  </dd>
  <dt>
    <p><strong>SIGHUP</strong></p>
  </dt>
  <dd>
    <p>Reread the configuration file. If the program is in the middle of a probe cycle, handling the signal is deferred until the end of the cycle.</p>
  </dd>
  <dt>
    <p><strong>SIGTERM, SIGINT, SIGQUIT</strong></p>
  </dt>
  <dd>
    <p>Exit gracefully. If the program is in the middle of a probe cycle, handling the signal is deferred until the program finishes sending and receiving responses for the current flavor request packet.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LEASE NETWORKS OF CONCERN</h2>
        <div class="sectioncontent">
<p>Most rogue BootP/DHCP servers distribute private IP addresses to clients, or send DHCPNAK messages to legitimate clients. Some even more disruptive rogue BootP/DHCP servers may distribute IP addresses that fall within your own networks' IP ranges. The "Lease Networks of Concern" feature is intended to help you identify these particularly disruptive servers.</p><p>You may activate the feature by specifying the <strong>lease_network_of_concern</strong> statement in your configuration file. Use the statement multiple times to specify all your legitimate network ranges.</p><p>When a rogue BootP/DHCP server is detected, if the rogue's response packet contains a non-zero <strong>yiaddr</strong> value, the value is compared to the "Lease Networks of Concern" you specified. If the value falls within any of those network ranges, the message logged by <strong>dhcp_probe</strong> is extended to make note of this, and to report the <strong>yiaddr</strong> value. Furthermore, if you are using the <strong>alert_program_name2</strong> feature, the alert program is called with an extra <strong>-y yiaddr</strong> option so that alert program can take any additional action desired.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEBUG LEVELS</h2>
        <div class="sectioncontent">
<p>The program produces increasingly detailed output as the <em>debuglevel</em> increases. Under normal circumstances, you can run at <em>debuglevel</em> 0. Here's roughly what messages are added at each <em>debuglevel</em>.</p>
<dl class='dl-vertical'>
  <dt>
    <p>0</p>
  </dt>
  <dd>
    <p>Display the IP source (and Ethernet source) of each unexpected DHCP or BootP response packet.</p><p>Startup and shutdown notice.</p><p>Non-fatal errors in the configuration file.</p><p>Fatal errors.</p>
  </dd>
  <dt>
    <p>1</p>
  </dt>
  <dd>
    <p>At startup, show some information about the program's configuration.</p>
  </dd>
  <dt>
    <p>2</p>
  </dt>
  <dd>
    <p>Show each time we start and finish (re-)reading the configuration file.</p><p>Show each time we close and re-open the logfile or capture file.</p><p>Report on response packets that could not be parsed (e.g. truncated).</p>
  </dd>
  <dt>
    <p>3</p>
  </dt>
  <dd>
    <p>Each time we (re-)read the configuration file, echo the information we obtain from it.</p>
  </dd>
  <dt>
    <p>7</p>
  </dt>
  <dd>
    <p>For each parsable response packet, show the Ethernet source and destination, the IP source and destination, and indicate when the IP source is a legal (known) server.</p>
  </dd>
  <dt>
    <p>11</p>
  </dt>
  <dd>
    <p>For each probe cycle, show when the cycle begins and ends, when we write a packet, and when we begin and end listening for response packets.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>The program was written by Irwin Tillman of Princeton University's OIT Network Systems Group. It was written to run on Solaris, relying on the generally-available <strong>pcap</strong>(3) and <strong>libnet</strong>(3) libraries.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>/etc/dhcp_probe.cf</strong></p>
  </dt>
  <dd>
    <p>Configuration file read by the program. See <a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a>. The name of this file can be overridden by a command-line option.</p>
  </dd>
  <dt>
    <p><strong>/etc/dhcp_probe.pid</strong></p>
  </dt>
  <dd>
    <p>Contains the program's processid. The name of this file can be overridden by a command-line option.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p>dhcp_probe is not guaranteed to locate all unknown DHCP and BootP servers attached to a network. If a BootP server is configured so it only responds to certain clients (e.g. those with certain hardware addresses), it will not respond to the BOOTPREQUEST packet we sent. If a DHCP server is configured so it only responds to certain clients (e.g. those with certain hardware addresses or DHCP Client Identifiers), it will not respond to the packets we send that mimic DHCP clients in the INIT state. If a DHCP server is configured so it does not send DHCPNAK packets to clients requesting topologically-inappropriate IP addresses, it will not respond the packets we send that mimic DHCP clients in the INIT-REBOOT and REBINDING states.</p><p>The upshot is that it is possible that dhcp_probe will be unable to provoke some BootP and DHCP servers into responding at all.</p><p>Flushing out such servers can be extremely difficult. One approach is to capture all UDP/IP packet destined to the BootP client port which cross your network; since most of these packets are unicast at Layer 2, capturing is only effective if <em>all</em> such packets must pass by your capture device's Ethernet interface (e.g. the capture device is located at a network choke point, or the network does not involve any Layer 2 switching). Another approach is to do UDP port scanning for all devices listening on the BootP server port, and assume that those which are listening on that port are running a BootP or DHCP server.</p><p>Malicious BootP or DHCP servers that forge the IP source address (and possibly the Ethernet source address) of their responses to match the values specified by <strong>legal_server</strong> and <strong>legal_server_ethersrc</strong> statements will not be detected.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The packet capture buffer size is limited; if a single request packet provokes more responses than will fit into the buffer, those that do not fit are silently dropped, without any diagnostic indicating that the buffer was too small. You can adjust the size of the packet capture buffer size using the <strong>-s</strong><em></em><strong>capture_bufsize</strong> option.</p><p>We do not support non-Ethernet interfaces.</p><p>Because (re-)opening a packet capture file causes the file to be opened for writing (not appending), the contents of any existing packet capture file of the same name is lost when the program starts or receives a SIGUSR2 signal. If the file's previous contents should be preserved, move the old file aside before starting the program or sending it a SIGUSR2 signal. (This "feature" exists because opening a <strong>pcap</strong>(3) savefile always involves writing a pcap header record to the start of the file, so pcap always opens the file using mode "w".)</p><p>Because <strong>pcap</strong>(3) opens the packet capture file with a simple <a href="../man3/fopen.3.html"><strong>fopen</strong>(3)</a> without checking to see if the file already exists, dhcp_probe may be tricked into overwriting or corrupting an existing file. As dhcp_probe is run with root privileges, this is a serious concern. To avoid this problem, if you use the <strong>-o</strong> option, ensure that the directory that will contain the capture file is writable only by root.</p><p>The packet capture file that is written is unparseable after the first packet. E.g. if read with <a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a>, it reports: <em>tcpdump: pcap_loop: truncated dump file</em>.</p><p>On platforms where <strong>pcap</strong>(3) is unable to support the <em>timeout</em> argument to <em>pcap_open_live</em>, the program may not reliably detect responses from DHCP and BootP servers, or may not function at all.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dhcp_probe&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/dhcp_probe.cf.5.html"><strong>dhcp_probe.cf</strong>(5)</a></p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>pcap</strong>(3)</p>
  </dt>
  <dd>
    <p>(a.k.a. libpcap, a packet capture library), available from http://www.tcpdump.org. (An older version is available from ftp://ftp.ee.lbl.gov/libpcap.tar.Z.)</p>
  </dd>
  <dt>
    <p><strong>libnet</strong>(3)</p>
  </dt>
  <dd>
    <p>(a.k.a libwrite, a packet writing library), available from http://www.packetfactory.net/libnet</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dhcp-helper.8.html"><span aria-hidden="true">&larr;</span> dhcp-helper.8: A dhcp/bootp relay agent.</a></li>
   <li class="next"><a href="dhcpd.8.html">dhcpd.8: Dynamic host configuration protocol server <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
