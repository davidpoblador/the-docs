<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sshuttle: A transparent proxy-based vpn using ssh</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A transparent proxy-based vpn using ssh">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="sshuttle (8) manual">
  <meta name="twitter:description" content="A transparent proxy-based vpn using ssh">
  <meta name="twitter:image" content="https://www.carta.tech/images/sshuttle-sshuttle-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/sshuttle.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="sshuttle (8) manual" />
  <meta property="og:description" content="A transparent proxy-based vpn using ssh" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/sshuttle-sshuttle-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">sshuttle<small> (8)</small></h1>
        <p class="lead">A transparent proxy-based vpn using ssh</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/sshuttle.8.html">
      <span itemprop="name">sshuttle: A transparent proxy-based vpn using ssh</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/sshuttle/">
      <span itemprop="name">sshuttle</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/sshuttle.8.html">
      <span itemprop="name">sshuttle: A transparent proxy-based vpn using ssh</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>sshuttle [options...] [-r [username\@]sshserver[:port]] &lt;subnets...&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>sshuttle allows you to create a VPN connection from your machine to any remote server that you can connect to via ssh, as long as that server has python 2.3 or higher.</p><p>To work, you must have root access on the local machine, but you can have a normal account on the server.</p><p>It's valid to run sshuttle more than once simultaneously on a single client machine, connecting to a different server every time, so you can be on more than one VPN at once.</p><p>If run on a router, sshuttle can forward traffic for your entire subnet to the VPN.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>&lt;subnets...&gt;</strong></p>
  </dt>
  <dd>
    <p>a list of subnets to route over the VPN, in the form a.b.c.d[/width]. Valid examples are 1.2.3.4 (a single IP address), 1.2.3.4/32 (equivalent to 1.2.3.4), 1.2.3.0/24 (a 24-bit subnet, ie. with a 255.255.255.0 netmask), and 0/0 (`just route everything through the VPN').</p>
  </dd>
  <dt>
    <p><strong>-l, --listen=</strong><em>[ip:]port</em></p>
  </dt>
  <dd>
    <p>use this ip address and port number as the transparent proxy port. By default sshuttle finds an available port automatically and listens on IP 127.0.0.1 (localhost), so you don't need to override it, and connections are only proxied from the local machine, not from outside machines. If you want to accept connections from other machines on your network (ie. to run sshuttle on a router) try enabling IP Forwarding in your kernel, then using --listen&nbsp;0.0.0.0:0.</p>
  </dd>
  <dt>
    <p><strong>-H, --auto-hosts</strong></p>
  </dt>
  <dd>
    <p>scan for remote hostnames and update the local /etc/hosts file with matching entries for as long as the VPN is open. This is nicer than changing your system's DNS (/etc/resolv.conf) settings, for several reasons. First, hostnames are added without domain names attached, so you can ssh&nbsp;thatserver without worrying if your local domain matches the remote one. Second, if you sshuttle into more than one VPN at a time, it's impossible to use more than one DNS server at once anyway, but sshuttle correctly merges /etc/hosts entries between all running copies. Third, if you're only routing a few subnets over the VPN, you probably would prefer to keep using your local DNS server for everything else.</p>
  </dd>
  <dt>
    <p><strong>-N, --auto-nets</strong></p>
  </dt>
  <dd>
    <p>in addition to the subnets provided on the command line, ask the server which subnets it thinks we should route, and route those automatically. The suggestions are taken automatically from the server's routing table.</p>
  </dd>
  <dt>
    <p><strong>--dns</strong></p>
  </dt>
  <dd>
    <p>capture local DNS requests and forward to the remote DNS server.</p>
  </dd>
  <dt>
    <p><strong>--python</strong></p>
  </dt>
  <dd>
    <p>specify the name/path of the remote python interpreter. The default is just python, which means to use the default python interpreter on the remote system's PATH.</p>
  </dd>
  <dt>
    <p><strong>-r, --remote=</strong><em>[username\@]sshserver[:port]</em></p>
  </dt>
  <dd>
    <p>the remote hostname and optional username and ssh port number to use for connecting to the remote server. For example, example.com, testuser\@example.com, testuser\@example.com:2222, or example.com:2244.</p>
  </dd>
  <dt>
    <p><strong>-x, --exclude=</strong><em>subnet</em></p>
  </dt>
  <dd>
    <p>explicitly exclude this subnet from forwarding. The format of this option is the same as the &lt;subnets&gt; option. To exclude more than one subnet, specify the -x option more than once. You can say something like 0/0&nbsp;-x&nbsp;1.2.3.0/24 to forward everything except the local subnet over the VPN, for example.</p>
  </dd>
  <dt>
    <p><strong>-v, --verbose</strong></p>
  </dt>
  <dd>
    <p>print more information about the session. This option can be used more than once for increased verbosity. By default, sshuttle prints only error messages.</p>
  </dd>
  <dt>
    <p><strong>-e, --ssh-cmd</strong></p>
  </dt>
  <dd>
    <p>the command to use to connect to the remote server. The default is just ssh. Use this if your ssh client is in a non-standard location or you want to provide extra options to the ssh command, for example, -e&nbsp;\[aq]ssh&nbsp;-v\[aq].</p>
  </dd>
  <dt>
    <p><strong>--seed-hosts</strong></p>
  </dt>
  <dd>
    <p>a comma-separated list of hostnames to use to initialize the --auto-hosts scan algorithm. --auto-hosts does things like poll local SMB servers for lists of local hostnames, but can speed things up if you use this option to give it a few names to start from.</p>
  </dd>
  <dt>
    <p><strong>--no-latency-control</strong></p>
  </dt>
  <dd>
    <p>sacrifice latency to improve bandwidth benchmarks. ssh uses really big socket buffers, which can overload the connection if you start doing large file transfers, thus making all your other sessions inside the same tunnel go slowly. Normally, sshuttle tries to avoid this problem using a \[lq]fullness check\[rq] that allows only a certain amount of outstanding data to be buffered at a time. But on high-bandwidth links, this can leave a lot of your bandwidth underutilized. It also makes sshuttle seem slow in bandwidth benchmarks (benchmarks rarely test ping latency, which is what sshuttle is trying to control). This option disables the latency control feature, maximizing bandwidth usage. Use at your own risk.</p>
  </dd>
  <dt>
    <p><strong>-D, --daemon</strong></p>
  </dt>
  <dd>
    <p>automatically fork into the background after connecting to the remote server. Implies --syslog.</p>
  </dd>
  <dt>
    <p><strong>--syslog</strong></p>
  </dt>
  <dd>
    <p>after connecting, send all log messages to the <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a> service instead of stderr. This is implicit if you use --daemon.</p>
  </dd>
  <dt>
    <p><strong>--pidfile=</strong><em>pidfilename</em></p>
  </dt>
  <dd>
    <p>when using --daemon, save sshuttle's pid to <em>pidfilename</em>. The default is sshuttle.pid in the current directory.</p>
  </dd>
  <dt>
    <p><strong>--server</strong></p>
  </dt>
  <dd>
    <p>(internal use only) run the sshuttle server on stdin/stdout. This is what the client runs on the remote end.</p>
  </dd>
  <dt>
    <p><strong>--firewall</strong></p>
  </dt>
  <dd>
    <p>(internal use only) run the firewall manager. This is the only part of sshuttle that must run as root. If you start sshuttle as a non-root user, it will automatically run sudo or su to start the firewall manager, but the core of sshuttle still runs as a normal user.</p>
  </dd>
  <dt>
    <p><strong>--hostwatch</strong></p>
  </dt>
  <dd>
    <p>(internal use only) run the hostwatch daemon. This process runs on the server side and collects hostnames for the --auto-hosts option. Using this option by itself makes it a lot easier to debug and test the --auto-hosts feature.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Test locally by proxying all local connections, without using ssh:</p><ul>
<li>
<pre>
$&nbsp;sshuttle&nbsp;-v&nbsp;0/0

Starting&nbsp;sshuttle&nbsp;proxy.
Listening&nbsp;on&nbsp;(\[aq]0.0.0.0\[aq],&nbsp;12300).
[local&nbsp;sudo]&nbsp;Password: firewall&nbsp;manager&nbsp;ready.
c&nbsp;:&nbsp;connecting&nbsp;to&nbsp;server...
&nbsp;s:&nbsp;available&nbsp;routes:
&nbsp;s:&nbsp;&nbsp;&nbsp;192.168.42.0/24
c&nbsp;:&nbsp;connected.
firewall&nbsp;manager:&nbsp;starting&nbsp;transproxy.
c&nbsp;:&nbsp;Accept:&nbsp;192.168.42.106:50035&nbsp;-&gt;&nbsp;192.168.42.121:139.
c&nbsp;:&nbsp;Accept:&nbsp;192.168.42.121:47523&nbsp;-&gt;&nbsp;77.141.99.22:443.
&nbsp;&nbsp;&nbsp;&nbsp;...etc...
^C
firewall&nbsp;manager:&nbsp;undoing&nbsp;changes.
KeyboardInterrupt
c&nbsp;:&nbsp;Keyboard&nbsp;interrupt:&nbsp;exiting.
c&nbsp;:&nbsp;SW#8:192.168.42.121:47523:&nbsp;deleting
c&nbsp;:&nbsp;SW#6:192.168.42.106:50035:&nbsp;deleting

</pre>
</li>
</ul><p>Test connection to a remote server, with automatic hostname and subnet guessing:</p><ul>
<li>
<pre>
$&nbsp;sshuttle&nbsp;-vNHr&nbsp;example.org

Starting&nbsp;sshuttle&nbsp;proxy.
Listening&nbsp;on&nbsp;(\[aq]0.0.0.0\[aq],&nbsp;12300).
firewall&nbsp;manager&nbsp;ready.
c&nbsp;:&nbsp;connecting&nbsp;to&nbsp;server...
&nbsp;s:&nbsp;available&nbsp;routes:
&nbsp;s:&nbsp;&nbsp;&nbsp;77.141.99.0/24
c&nbsp;:&nbsp;connected.
c&nbsp;:&nbsp;seed_hosts:&nbsp;[]
firewall&nbsp;manager:&nbsp;starting&nbsp;transproxy.
hostwatch:&nbsp;Found:&nbsp;testbox1:&nbsp;1.2.3.4
hostwatch:&nbsp;Found:&nbsp;mytest2:&nbsp;5.6.7.8
hostwatch:&nbsp;Found:&nbsp;domaincontroller:&nbsp;99.1.2.3
c&nbsp;:&nbsp;Accept:&nbsp;192.168.42.121:60554&nbsp;-&gt;&nbsp;77.141.99.22:22.
^C
firewall&nbsp;manager:&nbsp;undoing&nbsp;changes.
c&nbsp;:&nbsp;Keyboard&nbsp;interrupt:&nbsp;exiting.
c&nbsp;:&nbsp;SW#6:192.168.42.121:60554:&nbsp;deleting

</pre>
</li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DISCUSSION</h2>
        <div class="sectioncontent">
<p>When it starts, sshuttle creates an ssh session to the server specified by the -r option. If -r is omitted, it will start both its client and server locally, which is sometimes useful for testing.</p><p>After connecting to the remote server, sshuttle uploads its (python) source code to the remote end and executes it there. Thus, you don't need to install sshuttle on the remote server, and there are never sshuttle version conflicts between client and server.</p><p>Unlike most VPNs, sshuttle forwards sessions, not packets. That is, it uses kernel transparent proxying (iptables&nbsp;REDIRECT rules on Linux, or ipfw&nbsp;fwd rules on BSD) to capture outgoing TCP sessions, then creates entirely separate TCP sessions out to the original destination at the other end of the tunnel.</p><p>Packet-level forwarding (eg. using the tun/tap devices on Linux) seems elegant at first, but it results in several problems, notably the `tcp over tcp' problem. The tcp protocol depends fundamentally on packets being dropped in order to implement its congestion control agorithm; if you pass tcp packets through a tcp-based tunnel (such as ssh), the inner tcp packets will never be dropped, and so the inner tcp stream's congestion control will be completely broken, and performance will be terrible. Thus, packet-based VPNs (such as IPsec and openvpn) cannot use tcp-based encrypted streams like ssh or ssl, and have to implement their own encryption from scratch, which is very complex and error prone.</p><p>sshuttle's simplicity comes from the fact that it can safely use the existing ssh encrypted tunnel without incurring a performance penalty. It does this by letting the client-side kernel manage the incoming tcp stream, and the server-side kernel manage the outgoing tcp stream; there is no need for congestion control to be shared between the two separate streams, so a tcp-based tunnel is fine.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>On MacOS 10.6 (at least up to 10.6.6), your network will stop responding about 10 minutes after the first time you start sshuttle, because of a MacOS kernel bug relating to arp and the net.inet.ip.scopedroute sysctl. To fix it, just switch your wireless off and on. Sshuttle makes the kernel setting it changes permanent, so this won't happen again, even after a reboot.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO sshuttle&hellip;</h2>
        <div class="sectioncontent">
<p><strong>ssh</strong>(1), <strong>python</strong>(1)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Avery Pennarun &lt;apenwarr@gmail.com&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ss.8.html"><span aria-hidden="true">&larr;</span> ss.8: Another utility to investigate sockets</a></li>
   <li class="next"><a href="ssm.8.html">ssm.8: System storage manager: a single tool to manage your storage <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
