<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>amcheck: Run amanda self-checks</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Run amanda self-checks">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="amcheck (8) manual">
  <meta name="twitter:description" content="Run amanda self-checks">
  <meta name="twitter:image" content="https://www.carta.tech/images/amanda-server-amcheck-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/amcheck.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="amcheck (8) manual" />
  <meta property="og:description" content="Run amanda self-checks" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/amanda-server-amcheck-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">amcheck<small> (8)</small></h1>
        <p class="lead">Run amanda self-checks</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/amcheck.8.html">
      <span itemprop="name">amcheck: Run amanda self-checks</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/amanda-server/">
      <span itemprop="name">amanda-server</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/amcheck.8.html">
      <span itemprop="name">amcheck: Run amanda self-checks</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>amcheck</strong> [-am] [-w] [-sclt] [-M&nbsp;<em>address</em>] [--client-verbose] [--exact-match] [<strong>-o</strong>&nbsp;<em>configoption</em>...] <em>config</em> [<em>host</em>&nbsp;[<em>disk</em>...]...]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Amcheck</strong> runs a number of self-checks on both the Amanda tape server host and the Amanda client hosts.</p><p>On the tape server host, <strong>amcheck</strong> can go through the same tape checking used at the start of the nightly <strong>amdump</strong> run to verify the correct tape for the next run is mounted.</p><p><strong>Amcheck</strong> can also do a self-check on all client hosts to make sure each host is running and that permissions on filesystems to be backed up are correct.</p><p>You can specify many host/disk expressions, only disks that match an expression will be checked. All disks are checked if no expressions are given.</p><p>See the <a href="../man8/amanda.8.html"><strong>amanda</strong>(8)</a> man page for more details about Amanda.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p><strong>-s</strong></p><p>Run the tape server local and tape checks (same as <strong>-lt</strong>).</p><p><strong>-c</strong></p><p>Run the client host checks. Multiple specific clients can be checked by specifying the client name.</p><p><strong>-l</strong></p><p>Run the local tests (e.g. permissions) on the server host.</p><p><strong>-t</strong></p><p>Run the tape tests on the server host.</p><p><strong>-w</strong></p><p>Enables a DESTRUCTIVE check for write-protection on the tape (which would otherwise cause the subsequent <strong>amdump</strong> to fail). If the tape is writable, this check causes all data after the tape label to be erased. If the <strong>autolabel</strong> option is enabled, this check may ERASE any non-Amanda tape in the drive or changer. The check enable the tape tests on the server host and is only made if the tape is otherwise correct.</p><p><strong>-m</strong></p><p>Nothing is printed, but mail is sent if any errors are detected. The mail goes to the <strong>mailto</strong> address specified in the <em>amanda.conf</em> file or the <em>address</em> value if <strong>-M</strong> is set.</p><p><strong>-a</strong></p><p>Like <strong>-m</strong> but the mail is always sent.</p><p><strong>-M</strong> <em>address</em></p><p>Mail the report to <em>address</em> instead of the <strong>mailto</strong> value from <em>amanda.conf</em>. Implies <strong>-m</strong>.</p><p><strong>--client-verbose</strong></p><p>Print all client messages.</p><p><strong>--exact-match</strong></p><p>The host and disk are parsed as exact values</p><p><em>host</em> [<em>disk</em>]*</p><p>Specify the host and disk on which the command will work.</p><p><strong>-o </strong><strong></strong><em>configoption</em></p><p>See the "CONFIGURATION OVERRIDE" section in <a href="../man8/amanda.8.html"><strong>amanda</strong>(8)</a>.</p><p>The default is <strong>-cs</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>In this example, both the tape server and client tests are run. The results are displayed on standard output.</p>
<pre>
% amcheck daily
Amanda Tape Server Host Check
-----------------------------
/amanda2/amanda/work: 911475 KB disk space available, that&apos;s plenty.
NOTE: skipping tape-writable test.
Tape VOL10 label ok.
Server check took 34.966 seconds.

Amanda Backup Client Hosts Check
--------------------------------
WARNING: northstar: selfcheck request timed out.  Host down?
WARNING: drinkme: selfcheck request timed out.  Host down?
WARNING: scruffy: selfcheck request timed out.  Host down?
Client check: 136 hosts checked in 51.945 seconds, 3 problems found.

(brought to you by Amanda 2.5.0)
</pre>
<p>In this example, if the line <strong>mailto csd-amanda</strong> is in <em>amanda.conf</em>, mail will be sent to <strong>csd-amanda</strong> if the server check returns an error.</p>
<pre>
% amcheck -s -m daily
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MESSAGES</h2>
        <div class="sectioncontent">
<p>fatal slot <em>slot</em>: <em>error message</em></p><p>(error) The tape changer detected some kind of fatal error while trying to load slot <em>slot</em>.</p><p>slot <em>slot</em>: <em>error message</em></p><p>(warning) The tape changer detected some kind of non-fatal error (e.g. an empty slot was detected) while trying to load slot <em>slot</em>, or an error was detected trying to read the tape label.</p><p>slot <em>slot</em>: date <em>YYYYMMDD</em> label <em>label</em> (<em>result</em>)</p><p>(info) Tape <em>label</em> in slot <em>slot</em> was loaded and found to have been last written on <em>YYYYMMDD</em>. If the tape is new, the date field will be an <em>X</em>. The <em>result</em> may be one of:</p><p>exact label match</p><p>This is the expected tape.</p><p>no match</p><p>This label does not match the <strong>labelstr</strong> pattern in <em>amanda.conf</em>. Tape scanning will continue.</p><p>active tape</p><p>This tape is still active and cannot be overwritten. Tape scanning will continue.</p><p>first labelstr match</p><p>This tape is the first one that matches the <strong>labelstr</strong> pattern in <em>amanda.conf</em>. Tape scanning will continue if necessary.</p><p>labelstr match</p><p>This tape is the next one that matches the <strong>labelstr</strong> pattern in <em>amanda.conf</em>. Tape scanning will continue.</p><p>ERROR: cannot look up dump user <em>user</em></p><p>(error) Dump user <em>user</em> from <em>amanda.conf</em> could not be found in the system password information.</p><p>ERROR: cannot look up my own uid (<em>uid</em>)</p><p>(error) User id <em>uid</em> running <strong>amcheck</strong> could not be found in the system password information.</p><p>ERROR: running as user <em>runuser</em> instead of <em>dumpuser</em></p><p>(error) <strong>Amcheck</strong> should be run as the dump user <em>dumpuser</em> from <em>amanda.conf</em> instead of <em>runuser</em>.</p><p>ERROR: program dir <em>directory</em>: not accessible</p><p>(error) The directory Amanda expects to find its auxiliary programs in, <em>directory</em>, is not accessible.</p><p>ERROR: program <em>program</em>: does not exist</p><p>(error) Program <em>program</em> needed on the tape server could not be found.</p><p>ERROR: program <em>program</em>: not a file</p><p>(error) Program <em>program</em> needed on the tape server exists but is not a file.</p><p>ERROR: program <em>program</em>: not executable</p><p>(error) Program <em>program</em> needed on the tape server exists but is not executable.</p><p>WARNING: program <em>program</em>: not setuid-root</p><p>(warning) Program <em>program</em> needed on the tape server exists but should be owned by user "root" and setuid.</p><p>ERROR: <em>XXX</em> dir <em>directory</em>: not writable</p><p>(error) Directory <em>directory</em> is either not writable, i.e. the dump user will not be able to create or remove files, or cannot be accessed, perhaps because a parent directory does not allow search permission. The <em>XXX</em> may be:</p><p>log</p><p>for the Amanda log directory (see <strong>logdir</strong> in <strong>amanda.conf</strong>)</p><p>oldlog</p><p>for the directory that holds the old log files (see <strong>logdir</strong> in <strong>amanda.conf</strong>)</p><p>info</p><p>for an Amanda database information directory (see <strong>curinfo</strong> in <strong>amanda.conf</strong>) or</p><p>index</p><p>for an Amanda index directory (see <strong>indexdir</strong> in <strong>amanda.conf</strong>)</p><p>tapelist</p><p>for the <a href="../man5/tapelist.5.html"><strong>tapelist</strong>(5)</a></p><p>NOTE: <em>XXX</em> dir <em>directory</em>: does not exist</p><p>(info) A database (info) or index directory does not exist or cannot be accessed. This might just mean this is a new client or disk, but if that is not the case, this should be treated as an error.</p><p>NOTE: it will be created on the next run</p><p>(info) This indicates the info directory listed in the previous message will be created on the next run.</p><p>ERROR: <em>XXX</em> dir <em>name</em>: not a directory</p><p>(error) <strong>Amcheck</strong> expected <em>name</em> to be a directory, but it is something else (e.g. file).</p><p>WARNING: info file file: does not exist</p><p>(warning) File <em>file</em> does not exist in the text format database. Since the parent directories do exist, the file should already have been created.</p><p>ERROR: info file name: not a file</p><p>(error) <strong>Amcheck</strong> expected <em>name</em> to be a file, but it is something else (e.g. file).</p><p>ERROR: info file file: not readable</p><p>(error) The text format database file <em>file</em> is not readable.</p><p>ERROR: log file file: not writable</p><p>(error) Log file <em>file</em> (file <strong>log</strong> in <strong>logdir</strong> from <strong>amanda.conf</strong>) is either not writable, or cannot be accessed, perhaps because a parent directory does not allow search permission.</p><p>ERROR: tape list <em>tapelist</em>: not writable</p><p>(error) <a href="../man5/tapelist.5.html"><strong>tapelist</strong>(5)</a> is not writable or was not found.</p><p>ERROR: tape list <em>tapelist</em>: parse error</p><p>(error) <a href="../man5/tapelist.5.html"><strong>tapelist</strong>(5)</a> could not be read or parsed.</p><p>WARNING: tapedev is /dev/null, dumps will be thrown away</p><p>(warning) The <strong>tapedev</strong> parameter in <strong>amanda.conf</strong> is set to /dev/null and Amanda uses that when debugging to throw all the dump images away.</p><p>WARNING: hold file file exists</p><p>(info) Hold file <em>file</em> exists and will cause <strong>amdump</strong> to pause at the beginning until it is removed.</p><p>ERROR: holding disk <em>disk</em>: statfs: <em>error message</em></p><p>(error) An error was returned from the <em>statfs</em> system call on holding disk <em>disk</em> (maybe because it does not exist).</p><p>ERROR: holding disk <em>disk</em>: not writable</p><p>(error) Holding disk <em>disk</em>, is not writable, probably because the caller does not have write permission or a parent directory does not allow search permission.</p><p>WARNING: holding disk <em>disk</em>: available space unknown <em>N</em> KB requested.</p><p>(warning) <strong>Amcheck</strong> could not determine the amount of available space on holding disk <em>disk</em> to see if there were at least <em>N</em> KBytes available.</p><p>WARNING: holding disk <em>disk</em>: only <em>F</em> KB free (<em>R</em> KB requested).</p><p>(warning) <em>amanda.conf</em> requested <em>R</em> KBytes of free space on holding disk <em>disk</em>, but only <em>F</em> KBytes were available. 10 MBytes is subtracted for each backup process (see the <strong>inparallel</strong> <em>amanda.conf</em> option) to allow for unexpected overruns.</p><p><strong>Note</strong></p><p>Even though this message is listed as a warning, it causes <strong>amcheck</strong> to exit with a non-zero status.</p><p>Holding disk <em>disk</em>: <em>N</em> KB disk space available, that&apos;s plenty.</p><p>(info) There was sufficient free space on holding disk <em>disk</em>.</p><p>WARNING: holding disk <em>disk</em>: only <em>F</em> KB free, using nothing</p><p>(warning) Holding disk <em>disk</em> has <em>F</em> KBytes of free space, but that is not enough for what is requested in <em>amanda.conf</em>.</p><p>Holding disk <em>disk</em>: <em>F</em> KB disk space available, using <em>U</em> KB</p><p>(info) Holding disk <em>disk</em> has <em>F</em> KBytes of free space and Amanda will be using up to <em>U</em> Kbytes.</p><p>WARNING: if a tape changer is not available, runtapes must be set to 1.</p><p>(warning) The <strong>runtapes</strong> <em>amanda.conf</em> option must be set to 1 if the <strong>tpchanger</strong> <em>amanda.conf</em> option is not set.</p><p>ERROR: <em>error message</em>.</p><p>(error) An error was detected while initializing the tape changer.</p><p>ERROR: <em>tape device</em>: <em>error message</em>.</p><p>(error) An error was detected while processing the tape label.</p><p>ERROR: cannot overwrite active tape <em>label</em>.</p><p>(error) Tape <em>label</em> is still active and cannot be used.</p><p>ERROR: label <em>label</em> doesn&apos;t match labelstr <em>pattern</em> .</p><p>(error) The label on tape <em>label</em> does not match the <strong>labelstr</strong> <em>amanda.conf</em> option.</p><p>(expecting a new tape)</p><p>(info) The tape is not OK and a new tape was expected.</p><p>(expecting tape <em>label</em> or a new tape)</p><p>(info) The tape is not OK and either tape <em>label</em> or a new tape was expected.</p><p>ERROR: tape <em>label</em> label ok, but is not writable.</p><p>(error) Tape <em>label</em> is OK, but the write enable test failed.</p><p>Tape <em>label</em> is writable.</p><p>(info) Tape <em>label</em> is OK and the write enable test succeeded.</p><p>NOTE: skipping tape-writable test.</p><p>(info) The tape write test (see the <strong>-w</strong> option) was not enabled.</p><p>WARNING: skipping tape test because amdump or amflush seem to be running, WARNING: if they are not, you must run amcleanup</p><p>(warning) It looked to <strong>amcheck</strong> like either <strong>amdump</strong> or <strong>amflush</strong> were running because a log file or amdump file exists. If they are not running, you probably need to run <strong>amcleanup</strong> to clear up a previous failure. Otherwise, you need to wait until they complete before running <strong>amcheck</strong>.</p><p>NOTE: skipping tape checks</p><p>(info) The tape tests are being skipped because you used the <strong>-t</strong> command line option.</p><p>WARNING: <em>compress</em> is not executable, server-compression and indexing will not work</p><p>(warning) Compression program <em>compress</em> is not executable, so compression on the tape server host and creating index files will not work.</p><p>Tape <em>label</em> label ok.</p><p>(info) Tape <em>label</em> is OK for the next run.</p><p>Server check took <em>S</em> seconds.</p><p>(info) Reports how long the tape server host checks took.</p><p>ERROR: <em>host</em>: could not resolve hostname</p><p>(error) Could not look up client hostname <em>host</em>.</p><p>Client check: <em>H</em> hosts checked in <em>S</em> seconds, <em>N</em> problems found.</p><p>(info) Reports the number of client hosts checked, how long it took and the number of errors detected.</p><p>WARNING: <em>host</em>: selfcheck request timed out. Host down?</p><p>(warning) There was no response from <em>host</em> when trying to do the client checks. The host might really be down or it might not be configured properly.</p><p>ERROR: <em>host</em> NAK: <em>message</em></p><p>(error) <em>Host</em> reported a negative acknowledgment error of <em>message</em> to the status check request.</p><p>ERROR: <em>host</em> NAK: [NAK parse failed]</p><p>(error) <strong>Amcheck</strong> could not parse the negative acknowledgment error from <em>host</em>. There might be an Amanda version mismatch between the host running <strong>amcheck</strong> and <em>host</em>.</p><p>ERROR: <em>host</em> [mutual-authentication failed]</p><p>(error) Kerberos authentication failed while contacting <em>host</em>.</p><p>ERROR: <em>host</em>: <em>message</em></p><p>(error) Error <em>message</em> was reported by the status check on <em>host</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT CODE</h2>
        <div class="sectioncontent">
<p>The exit code of <strong>amcheck</strong> is one of:</p>
<pre>
 0  = success
 1  = error
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO amcheck&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/amanda.8.html"><strong>amanda</strong>(8)</a>, <a href="../man5/amanda.conf.5.html"><strong>amanda.conf</strong>(5)</a>, <a href="../man8/amdump.8.html"><strong>amdump</strong>(8)</a></p><p>The Amanda Wiki: : http://wiki.zmanda.com/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p><strong>James da Silva</strong> &lt;jds@amanda.org&gt;</p><p><strong>Stefan G. Weichinger</strong> &lt;sgw@amanda.org&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ambsdtar.8.html"><span aria-hidden="true">&larr;</span> ambsdtar.8: Amanda application to interface with bsd tar</a></li>
   <li class="next"><a href="amcheckdb.8.html">amcheckdb.8: Check amanda database for tape consistency <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
