<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>upssched: Timer helper for scheduling events from upsmon</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Timer helper for scheduling events from upsmon">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="upssched (8) manual">
  <meta name="twitter:description" content="Timer helper for scheduling events from upsmon">
  <meta name="twitter:image" content="https://www.carta.tech/images/nut-client-upssched-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/upssched.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="upssched (8) manual" />
  <meta property="og:description" content="Timer helper for scheduling events from upsmon" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/nut-client-upssched-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">upssched<small> (8)</small></h1>
        <p class="lead">Timer helper for scheduling events from upsmon</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/upssched.8.html">
      <span itemprop="name">upssched: Timer helper for scheduling events from upsmon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/nut-client/">
      <span itemprop="name">nut-client</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/upssched.8.html">
      <span itemprop="name">upssched: Timer helper for scheduling events from upsmon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>upssched</strong></p><p><strong>Note</strong></p><p><strong>upssched</strong> should be run from <a href="../man8/upsmon.8.html"><strong>upsmon</strong>(8)</a> via the NOTIFYCMD. You should never run it directly during normal operations.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>upssched</strong> was created to allow users to execute programs at times relative to events being monitored by <a href="../man8/upsmon.8.html"><strong>upsmon</strong>(8)</a>. The original purpose was to allow for a shutdown to occur after some fixed period on battery, but there are other uses that are possible.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTEGRATION</h2>
        <div class="sectioncontent">
<p>upssched needs to be called as the NOTIFYCMD in your <a href="../man5/upsmon.conf.5.html"><strong>upsmon.conf</strong>(5)</a>. It determines what is happening based on the UPSNAME and NOTIFYTYPE environment variables. You should never have to deal with them directly.</p><p>Set the EXEC flag on the events that you want to see in upssched. For example, to make sure that upssched hears about ONLINE, ONBATT and LOWBATT events, the flags would look like this:</p>
<pre>
NOTIFYFLAG ONLINE EXEC
NOTIFYFLAG ONBATT EXEC
NOTIFYFLAG LOWBATT EXEC
</pre>
<p>If you also want to continue writing to the syslog, just add it in:</p>
<pre>
NOTIFYFLAG ONLINE SYSLOG+EXEC
NOTIFYFLAG ONBATT SYSLOG+EXEC
NOTIFYFLAG LOWBATT SYSLOG+EXEC
</pre>
<p>For a full list of notify flags, see the <a href="../man8/upsmon.8.html"><strong>upsmon</strong>(8)</a> documentation.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>See <a href="../man5/upssched.conf.5.html"><strong>upssched.conf</strong>(5)</a> for information on configuring this program.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EARLY SHUTDOWNS</h2>
        <div class="sectioncontent">
<p>To shut down the system early, define a timer that starts due to an ONBATT condition. When it triggers, make your CMDSCRIPT call your shutdown routine. It should finish by calling upsmon -c fsd so that upsmon gets to shut down the slaves in a controlled manner.</p><p>Be sure you cancel the timer if power returns (ONLINE).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEBOUNCING EVENTS</h2>
        <div class="sectioncontent">
<p>If your UPS goes on and off battery frequently, you can use this program to reduce the number of pager messages that are sent out. Rather than sending pages directly from <a href="../man8/upsmon.8.html"><strong>upsmon</strong>(8)</a>, use a short timer here. If the timer triggers with the UPS still on battery, then send the page. If the power returns before then, the timer can be cancelled and no page is necessary.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BACKGROUND</h2>
        <div class="sectioncontent">
<p>This program was written primarily to fulfill the requests of users for the early shutdown scenario. The "outboard" design of the program (relative to upsmon) was intended to reduce the load on the average system. Most people don\(cqt have the requirement of shutting down after <em>N</em> seconds on battery, since the usual OB+LB testing is sufficient.</p><p>This program was created separately so those people don\(cqt have to spend CPU time and RAM on something that will never be used in their environments.</p><p>The design of the timer handler is also geared towards minimizing impact. It will come and go from the process list as necessary. When a new timer is started, a process will be forked to actually watch the clock and eventually start the CMDSCRIPT. When a timer triggers, it is removed from the queue. Cancelling a timer will also remove it from the queue. When no timers are present in the queue, the background process exits.</p><p>This means that you will only see upssched running when one of two things is happening:</p><p>There\(cqs a timer of some sort currently running</p><p>upsmon just called it, and you managed to catch the brief instance</p><p>The final optimization handles the possibility of trying to cancel a timer when there are none running. If the timer daemon isn\(cqt running, there are no timers to cancel, and furthermore there is no need to start a clock-watcher. So, it skips that step and exits sooner.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><a href="../man5/upssched.conf.5.html"><strong>upssched.conf</strong>(5)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO upssched&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/upsmon.8.html"><strong>upsmon</strong>(8)</a></p><h3>Internet resources:</h3>
<p>The NUT (Network UPS Tools) home page: http://www.networkupstools.org/</p>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="upsrw.8.html"><span aria-hidden="true">&larr;</span> upsrw.8: Ups variable administration tool</a></li>
   <li class="next"><a href="upsset.cgi.8.html">upsset.cgi.8: Web-based ups administration program <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
