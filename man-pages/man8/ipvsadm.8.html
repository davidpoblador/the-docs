<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ipvsadm: Linux virtual server administration</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Linux virtual server administration">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ipvsadm (8) manual">
  <meta name="twitter:description" content="Linux virtual server administration">
  <meta name="twitter:image" content="https://www.carta.tech/images/ipvsadm-ipvsadm-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/ipvsadm.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ipvsadm (8) manual" />
  <meta property="og:description" content="Linux virtual server administration" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ipvsadm-ipvsadm-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ipvsadm<small> (8)</small></h1>
        <p class="lead">Linux virtual server administration</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/ipvsadm.8.html">
      <span itemprop="name">ipvsadm: Linux virtual server administration</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ipvsadm/">
      <span itemprop="name">ipvsadm</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/ipvsadm.8.html">
      <span itemprop="name">ipvsadm: Linux virtual server administration</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>ipvsadm -A|E -t|u|f </strong><em>service-address</em><strong> [-s </strong><em>scheduler</em><strong>]</strong> <strong>[-p [</strong><em>timeout</em><strong>]] [-M </strong><em>netmask</em><strong>]</strong></p><p><strong>ipvsadm -D -t|u|f </strong><em>service-address</em><strong></strong></p><p><strong>ipvsadm -C</strong></p><p><strong>ipvsadm -R</strong></p><p><strong>ipvsadm -S [-n]</strong></p><p><strong>ipvsadm -a|e -t|u|f </strong><em>service-address</em><strong> -r </strong><em>server-address</em><strong></strong> <strong>[-g|i|m] [-w </strong><em>weight</em><strong>] [-x </strong><em>upper</em><strong>] [-y </strong><em>lower</em><strong>]</strong></p><p><strong>ipvsadm -d -t|u|f </strong><em>service-address</em><strong> -r </strong><em>server-address</em><strong></strong></p><p><strong>ipvsadm -L|l [options]</strong></p><p><strong>ipvsadm -Z [-t|u|f </strong><em>service-address</em><strong>]</strong></p><p><strong>ipvsadm --set </strong><em>tcp</em><strong> </strong><em>tcpfin</em><strong> </strong><em>udp</em><strong></strong></p><p><strong>ipvsadm --start-daemon </strong><em>state</em><strong> [--mcast-interface </strong><em>interface</em><strong>]</strong> <strong>[--syncid </strong><em>syncid</em><strong>]</strong></p><p><strong>ipvsadm --stop-daemon </strong><em>state</em><strong></strong></p><p><strong>ipvsadm -h</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><a href="../man8/ipvsadm.8.html"><strong>Ipvsadm</strong>(8)</a> is used to set up, maintain or inspect the virtual server table in the Linux kernel. The Linux Virtual Server can be used to build scalable network services based on a cluster of two or more nodes. The active node of the cluster redirects service requests to a collection of server hosts that will actually perform the services. Supported features include two protocols (TCP and UDP), three packet-forwarding methods (NAT, tunneling, and direct routing), and eight load balancing algorithms (round robin, weighted round robin, least-connection, weighted least-connection, locality-based least-connection, locality-based least-connection with replication, destination-hashing, and source-hashing).</p><p>The command has two basic formats for execution:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>ipvsadm </strong><em>COMMAND</em><strong> [</strong><em>protocol</em><strong>] </strong><em>service-address</em><strong></strong></p>
  </dt>
  <dd>
    <p><strong>[</strong><em>scheduling-method</em><strong>] [</strong><em>persistence options</em><strong>]</strong></p>
  </dd>
  <dt>
    <p><strong>ipvsadm </strong><em>command</em><strong> [</strong><em>protocol</em><strong>] </strong><em>service-address</em><strong></strong></p>
  </dt>
  <dd>
    <p><strong></strong><em>server-address</em><strong> [</strong><em>packet-forwarding-method</em><strong>]</strong> <strong>[</strong><em>weight options</em><strong>]</strong></p>
  </dd>

</dl>
<p>The first format manipulates a virtual service and the algorithm for assigning service requests to real servers. Optionally, a persistent timeout and network mask for the granularity of a persistent service may be specified. The second format manipulates a real server that is associated with an existing virtual service. When specifying a real server, the packet-forwarding method and the weight of the real server, relative to other real servers for the virtual service, may be specified, otherwise defaults will be used.</p><h3>COMMANDS</h3>
<p><a href="../man8/ipvsadm.8.html"><strong>ipvsadm</strong>(8)</a> recognises the commands described below. Upper-case commands maintain virtual services. Lower-case commands maintain real servers that are associated with a virtual service.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-A, --add-service</strong></p>
  </dt>
  <dd>
    <p>Add a virtual service. A service address is uniquely defined by a triplet: IP address, port number, and protocol. Alternatively, a virtual service may be defined by a firewall-mark.</p>
  </dd>
  <dt>
    <p><strong>-E, --edit-service</strong></p>
  </dt>
  <dd>
    <p>Edit a virtual service.</p>
  </dd>
  <dt>
    <p><strong>-D, --delete-service</strong></p>
  </dt>
  <dd>
    <p>Delete a virtual service, along with any associated real servers.</p>
  </dd>
  <dt>
    <p><strong>-C, --clear</strong></p>
  </dt>
  <dd>
    <p>Clear the virtual server table.</p>
  </dd>
  <dt>
    <p><strong>-R, --restore</strong></p>
  </dt>
  <dd>
    <p>Restore Linux Virtual Server rules from stdin. Each line read from stdin will be treated as the command line options to a separate invocation of <em>ipvsadm</em>. Lines read from stdin can optionally begin with "ipvsadm".  This option is useful to avoid executing a large number or <em>ipvsadm</em>  commands when constructing an extensive routing table.</p>
  </dd>
  <dt>
    <p><strong>-S, --save</strong></p>
  </dt>
  <dd>
    <p>Dump the Linux Virtual Server rules to stdout in a format that can be read by -R|--restore.</p>
  </dd>
  <dt>
    <p><strong>-a, --add-server</strong></p>
  </dt>
  <dd>
    <p>Add a real server to a virtual service.</p>
  </dd>
  <dt>
    <p><strong>-e, --edit-server</strong></p>
  </dt>
  <dd>
    <p>Edit a real server in a virtual service.</p>
  </dd>
  <dt>
    <p><strong>-d, --delete-server</strong></p>
  </dt>
  <dd>
    <p>Remove a real server from a virtual service.</p>
  </dd>
  <dt>
    <p><strong>-L, -l, --list</strong></p>
  </dt>
  <dd>
    <p>List the virtual server table if no argument is specified. If a <em>service-address</em> is selected, list this service only. If the <em>-c</em> option is selected, then display the connection table. The exact output is affected by the other arguments given.</p>
  </dd>
  <dt>
    <p><strong>-Z, --zero</strong></p>
  </dt>
  <dd>
    <p>Zero the packet, byte and rate counters in a service or all services.</p>
  </dd>
  <dt>
    <p><strong>--set </strong><em>tcp</em><strong> </strong><em>tcpfin</em><strong> </strong><em>udp</em><strong></strong></p>
  </dt>
  <dd>
    <p>Change the timeout values used for IPVS connections. This command always takes 3 parameters,  representing  the  timeout  values (in seconds) for TCP sessions, TCP sessions after receiving a  FIN packet, and  UDP  packets, respectively.  A timeout value 0 means that the current timeout value of the  corresponding  entry  is preserved.</p>
  </dd>
  <dt>
    <p><strong>--start-daemon </strong><em>state</em><strong></strong></p>
  </dt>
  <dd>
    <p>Start the connection synchronization daemon. The <em>state</em> is to indicate that the daemon is started as <em>master</em> or <em>backup</em>. The connection synchronization daemon is implemented inside the Linux kernel. The master daemon running at the primary load balancer multicasts changes of connections periodically, and the backup daemon running at the backup load balancers receives multicast message and creates corresponding connections. Then, in case the primary load balancer fails, a backup load balancer will takeover, and it has state of almost all connections, so that almost all established connections can continue to access the service.</p>
  </dd>

</dl>
<p>The sync daemon currently only supports IPv4 connections.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--stop-daemon</strong></p>
  </dt>
  <dd>
    <p>Stop the connection synchronization daemon.</p>
  </dd>
  <dt>
    <p><strong>-h, --help</strong></p>
  </dt>
  <dd>
    <p>Display a description of the command syntax.</p>
  </dd>

</dl>

<h3>PARAMETERS</h3>
<p>The commands above accept or require zero or more of the following parameters.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-t, --tcp-service </strong><em>service-address</em><strong></strong></p>
  </dt>
  <dd>
    <p>Use TCP service. The <em>service-address</em> is of the form <em>host[:port]</em>.  <em>Host</em> may be one of a plain IP address or a hostname. <em>Port</em> may be either a plain port number or the service name of port. The <em>Port</em> may be omitted, in which case zero will be used. A <em>Port</em>  of zero is only valid if the service is persistent as the -p|--persistent option, in which case it is a wild-card port, that is connections will be accepted to any port.</p>
  </dd>
  <dt>
    <p><strong>-u, --udp-service </strong><em>service-address</em><strong></strong></p>
  </dt>
  <dd>
    <p>Use UDP service. See the -t|--tcp-service for the description of  the <em>service-address</em>.</p>
  </dd>
  <dt>
    <p><strong>-f, --fwmark-service </strong><em>integer</em><strong></strong></p>
  </dt>
  <dd>
    <p>Use a firewall-mark, an integer value greater than zero, to denote a virtual service instead of an address, port and protocol (UDP or TCP). The marking of packets with a firewall-mark is configured using the -m|--mark option to <a href="../man8/iptables.8.html"><strong>iptables</strong>(8)</a>. It can be used to build a virtual service associated with the same real servers, covering multiple IP address, port and protocol triplets. If IPv6 addresses are used, the -6 option must be used.</p><p>Using firewall-mark virtual services provides a convenient method of grouping together different IP addresses, ports and protocols into a single virtual service. This is useful for both simplifying configuration if a large number of virtual services are required and grouping persistence across what would otherwise be multiple virtual services.</p>
  </dd>
  <dt>
    <p><strong>-s, --scheduler </strong><em>scheduling-method</em><strong></strong></p>
  </dt>
  <dd>
    <p><em>scheduling-method</em>  Algorithm for allocating TCP connections and UDP datagrams to real servers.  Scheduling algorithms are implemented as kernel modules. Ten are shipped with the Linux Virtual Server:</p><p><strong>rr</strong> - Round Robin: distributes jobs equally amongst the available real servers.</p><p><strong>wrr</strong> - Weighted Round Robin: assigns jobs to real servers proportionally to there real servers' weight. Servers with higher weights receive new jobs first and get more jobs than servers with lower weights. Servers with equal weights get an equal distribution of new jobs.</p><p><strong>lc</strong> - Least-Connection: assigns more jobs to real servers with fewer active jobs.</p><p><strong>wlc</strong> - Weighted Least-Connection: assigns more jobs to servers with fewer jobs and relative to the real servers' weight (Ci/Wi). This is the default.</p><p><strong>lblc</strong> - Locality-Based Least-Connection: assigns jobs destined for the same IP address to the same server if the server is not overloaded and available; otherwise assign jobs to servers with fewer jobs, and keep it for future assignment.</p><p><strong>lblcr</strong> - Locality-Based Least-Connection with Replication: assigns jobs destined for the same IP address to the least-connection node in the server set for the IP address. If all the node in the server set are over loaded, it picks up a node with fewer jobs in the cluster and adds it in the sever set for the target. If the server set has not been modified for the specified time, the most loaded node is removed from the server set, in order to avoid high degree of replication.</p><p><strong>dh</strong> - Destination Hashing: assigns jobs to servers through looking up a statically assigned hash table by their destination IP addresses.</p><p><strong>sh</strong> - Source Hashing: assigns jobs to servers through looking up a statically assigned hash table by their source IP addresses.</p><p><strong>sed</strong> - Shortest Expected Delay: assigns an incoming job to the server with the shortest expected delay. The expected delay that the job will experience is (Ci + 1) / Ui if  sent to the ith server, in which Ci is the number of jobs on the the ith server and Ui is the fixed service rate (weight) of the ith server.</p><p><strong>nq</strong> - Never Queue: assigns an incoming job to an idle server if there is, instead of waiting for a fast one; if all the servers are busy, it adopts the Shortest Expected Delay policy to assign the job.</p>
  </dd>
  <dt>
    <p><strong>-p, --persistent [</strong><em>timeout</em><strong>]</strong></p>
  </dt>
  <dd>
    <p>Specify that a virtual service is persistent. If this option is specified, multiple requests from a client are redirected to the same real server selected for the first request.  Optionally, the <em>timeout</em> of persistent sessions may be specified given in seconds, otherwise the default of 300 seconds will be used. This option may be used in conjunction with protocols such as SSL or FTP where it is important that clients consistently connect with the same real server.</p><p><strong>Note:</strong> If a virtual service is to handle FTP connections then persistence must be set for the virtual service if Direct Routing or Tunnelling is used as the forwarding mechanism. If Masquerading is used in conjunction with an FTP service than persistence is not necessary, but the ip_vs_ftp kernel module must be used.  This module may be manually inserted into the kernel using <a href="../man8/insmod.8.html"><strong>insmod</strong>(8)</a>.</p>
  </dd>
  <dt>
    <p><strong>-M, --netmask </strong><em>netmask</em><strong></strong></p>
  </dt>
  <dd>
    <p>Specify the granularity with which clients are grouped for persistent virtual services.  The source address of the request is masked with this netmask to direct all clients from a network to the same real server. The default is <em>255.255.255.255</em>, that is, the persistence granularity is per client host. Less specific netmasks may be used to resolve problems with non-persistent cache clusters on the client side. IPv6 netmasks should be specified as a prefix length between 1 and 128. The default prefix length is 128.</p>
  </dd>
  <dt>
    <p><strong>-r, --real-server </strong><em>server-address</em><strong></strong></p>
  </dt>
  <dd>
    <p>Real server that an associated request for service may be assigned to. The <em>server-address</em> is the <em>host</em> address of a real server, and may plus <em>port</em>. <em>Host</em> can be either a plain IP address or a hostname.  <em>Port</em> can be either a plain port number or the service name of port.  In the case of the masquerading method, the host address is usually an RFC 1918 private IP address, and the port can be different from that of the associated service. With the tunneling and direct routing methods, <em>port</em> must be equal to that of the service address. For normal services, the port specified  in the service address will be used if <em>port</em> is not specified. For fwmark services, <em>port</em> may be omitted, in which case  the destination port on the real server will be the destination port of the request sent to the virtual service.</p>
  </dd>
  <dt>
    <p><strong>[packet-forwarding-method]</strong></p>
  </dt>
  <dd>
    <p><strong>-g, --gatewaying</strong>  Use gatewaying (direct routing). This is the default.</p><p><strong>-i, --ipip</strong>  Use ipip encapsulation (tunneling).</p><p><strong>-m, --masquerading</strong>  Use masquerading (network access translation, or NAT).</p><p><strong>Note:</strong>  Regardless of the packet-forwarding mechanism specified, real servers for addresses for which there are interfaces on the local node will be use the local forwarding method, then packets for the servers will be passed to upper layer on the local node. This cannot be specified by <em>ipvsadm</em>, rather it set by the kernel as real servers are added or modified.</p>
  </dd>
  <dt>
    <p><strong>-w, --weight </strong><em>weight</em><strong></strong></p>
  </dt>
  <dd>
    <p><em>Weight</em> is an integer specifying the capacity  of a server relative to the others in the pool. The valid values of <em>weight</em> are 0 through to 65535. The default is 1. Quiescent servers are specified with a weight of zero. A quiescent server will receive no new jobs but still serve the existing jobs, for all scheduling algorithms distributed with the Linux Virtual Server. Setting a quiescent server may be useful if the server is overloaded or needs to be taken out of service for maintenance.</p>
  </dd>
  <dt>
    <p><strong>-x, --u-threshold </strong><em>uthreshold</em><strong></strong></p>
  </dt>
  <dd>
    <p><em>uthreshold</em> is an integer specifying the upper connection threshold of a server. The valid values of <em>uthreshold</em> are 0 through to 65535. The default is 0, which means the upper connection threshold is not set. If <em>uthreshold</em> is set with other values, no new connections will be sent to the server when the number of its connections exceeds its upper connection threshold.</p>
  </dd>
  <dt>
    <p><strong>-y, --l-threshold </strong><em>lthreshold</em><strong></strong></p>
  </dt>
  <dd>
    <p><em>lthreshold</em> is an integer specifying the lower connection threshold of a server. The valid values of <em>lthreshold</em> are 0 through to 65535. The default is 0, which means the lower connection threshold is not set. If <em>lthreshold</em> is set with other values, the server will receive new connections when the number of its connections drops below its lower connection threshold. If <em>lthreshold</em> is not set but <em>uthreshold</em> is set, the server will receive new connections when the number of its connections drops below three forth of its upper connection threshold.</p>
  </dd>
  <dt>
    <p><strong>--mcast-interface </strong><em>interface</em><strong></strong></p>
  </dt>
  <dd>
    <p>Specify the multicast interface that the sync master daemon sends outgoing multicasts through, or the sync backup daemon listens to for multicasts.</p>
  </dd>
  <dt>
    <p><strong>--syncid </strong><em>syncid</em><strong></strong></p>
  </dt>
  <dd>
    <p>Specify the <em>syncid</em> that the sync master daemon fills in the SyncID header while sending multicast messages, or the sync backup daemon uses to filter out multicast messages not matched with the SyncID value. The valid values of <em>syncid</em> are 0 through to 255. The default is 0, which means no filtering at all.</p>
  </dd>
  <dt>
    <p><strong>-c, --connection</strong></p>
  </dt>
  <dd>
    <p>Connection output. The <em>list</em> command with this option will list current IPVS connections.</p>
  </dd>
  <dt>
    <p><strong>--timeout</strong></p>
  </dt>
  <dd>
    <p>Timeout output. The <em>list</em> command with this option will display the  timeout values (in seconds) for TCP sessions, TCP sessions after receiving a FIN packet, and UDP packets.</p>
  </dd>
  <dt>
    <p><strong>--daemon</strong></p>
  </dt>
  <dd>
    <p>Daemon information output. The <em>list</em> command with this option will display the daemon status and its multicast interface.</p>
  </dd>
  <dt>
    <p><strong>--stats</strong></p>
  </dt>
  <dd>
    <p>Output of statistics information. The <em>list</em> command with this option will display the statistics information of services and their servers.</p>
  </dd>
  <dt>
    <p><strong>--rate</strong></p>
  </dt>
  <dd>
    <p>Output of rate information. The <em>list</em> command with this option will display the rate information (such as connections/second, bytes/second and packets/second) of services and their servers.</p>
  </dd>
  <dt>
    <p><strong>--thresholds</strong></p>
  </dt>
  <dd>
    <p>Output of thresholds information. The <em>list</em> command with this option will display the upper/lower connection threshold information of each server in service listing.</p>
  </dd>
  <dt>
    <p><strong>--persistent-conn</strong></p>
  </dt>
  <dd>
    <p>Output of persistent connection information. The <em>list</em> command with this option will display the persistent connection counter information of each server in service listing. The persistent connection is used to forward the actual connections from the same client/network to the same server.</p><p>The <em>list</em> command with the -c, --connection option and this option will include persistence engine data, if any is present, when listing connections.</p>
  </dd>
  <dt>
    <p><strong>--sort</strong></p>
  </dt>
  <dd>
    <p>Sort the list of virtual services and real servers. The virtual service entries are sorted in ascending order by &lt;protocol, address, port&gt;. The real server entries are sorted in ascending order by &lt;address, port&gt;. (default)</p>
  </dd>
  <dt>
    <p><strong>--nosort</strong></p>
  </dt>
  <dd>
    <p>Do not sort the list of virtual services and real servers.</p>
  </dd>
  <dt>
    <p><strong>-n, --numeric</strong></p>
  </dt>
  <dd>
    <p>Numeric output.  IP addresses and port numbers will be printed in numeric format rather than as as host names and services respectively, which is the  default.</p>
  </dd>
  <dt>
    <p><strong>--exact</strong></p>
  </dt>
  <dd>
    <p>Expand numbers.  Display the exact value of the packet and  byte counters,  instead  of only the rounded number in K's (multiples of 1000) M's (multiples of 1000K) or G's (multiples  of 1000M).  This option is only relevant for the -L command.</p>
  </dd>
  <dt>
    <p><strong>-6, --ipv6</strong></p>
  </dt>
  <dd>
    <p>Use with -f to signify fwmark rule uses IPv6 addresses.</p>
  </dd>
  <dt>
    <p><strong>-o, --ops</strong></p>
  </dt>
  <dd>
    <p>One-packet scheduling. Used in conjunction with a UDP virtual service or a fwmark virtual service that handles only UDP packets. All connections are created such that they only schedule one packet.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE 1 - Simple Virtual Service</h2>
        <div class="sectioncontent">
<p>The following commands configure a Linux Director to distribute incoming requests addressed to port 80 on 207.175.44.110 equally to port 80 on five real servers. The forwarding method used in this example is NAT, with each of the real servers being masqueraded by the Linux Director.</p>
<pre>
ipvsadm -A -t 207.175.44.110:80 -s rr
ipvsadm -a -t 207.175.44.110:80 -r 192.168.10.1:80 -m
ipvsadm -a -t 207.175.44.110:80 -r 192.168.10.2:80 -m
ipvsadm -a -t 207.175.44.110:80 -r 192.168.10.3:80 -m
ipvsadm -a -t 207.175.44.110:80 -r 192.168.10.4:80 -m
ipvsadm -a -t 207.175.44.110:80 -r 192.168.10.5:80 -m
</pre>
<p>Alternatively, this could be achieved in a single ipvsadm command.</p>
<pre>
echo "
-A -t 207.175.44.110:80 -s rr
-a -t 207.175.44.110:80 -r 192.168.10.1:80 -m
-a -t 207.175.44.110:80 -r 192.168.10.2:80 -m
-a -t 207.175.44.110:80 -r 192.168.10.3:80 -m
-a -t 207.175.44.110:80 -r 192.168.10.4:80 -m
-a -t 207.175.44.110:80 -r 192.168.10.5:80 -m
" | ipvsadm -R
</pre>
<p>As masquerading is used as the forwarding mechanism in this example, the default route of the real servers must be set to the linux director, which will need to be configured to forward and masquerade packets. This can be achieved using the following commands:</p>
<pre>
echo "1" &gt; /proc/sys/net/ipv4/ip_forward
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE 2 - Firewall-Mark Virtual Service</h2>
        <div class="sectioncontent">
<p>The following commands configure a Linux Director to distribute incoming requests addressed to any port on 207.175.44.110 or 207.175.44.111 equally to the corresponding port on five real servers. As per the previous example, the forwarding method used in this example is NAT, with each of the real servers being masqueraded by the Linux Director.</p>
<pre>
ipvsadm -A -f 1  -s rr
ipvsadm -a -f 1 -r 192.168.10.1:0 -m
ipvsadm -a -f 1 -r 192.168.10.2:0 -m
ipvsadm -a -f 1 -r 192.168.10.3:0 -m
ipvsadm -a -f 1 -r 192.168.10.4:0 -m
ipvsadm -a -f 1 -r 192.168.10.5:0 -m
</pre>
<p>As masquerading is used as the forwarding mechanism in this example, the default route of the real servers must be set to the linux director, which will need to be configured to forward and masquerade packets. The real server should also be configured to mark incoming packets addressed to any port on 207.175.44.110 and  207.175.44.111 with firewall-mark 1. If FTP traffic is to be handled by this virtual service, then the ip_vs_ftp kernel module needs to be inserted into the kernel.  These operations can be achieved using the following commands:</p>
<pre>
echo "1" &gt; /proc/sys/net/ipv4/ip_forward
modprobe ip_tables
iptables  -A PREROUTING -t mangle -d 207.175.44.110/31 -j MARK --set-mark 1
modprobe ip_vs_ftp
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IPv6</h2>
        <div class="sectioncontent">
<p>IPv6 addresses should be surrounded by square brackets ([ and ]).</p>
<pre>
ipvsadm -A -t [2001:db8::80]:80 -s rr
ipvsadm -a -t [2001:db8::80]:80 -r [2001:db8::a0a0]:80 -m
</pre>
<p>fwmark IPv6 services require the -6 option.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>The Linux Virtual Server implements three defense strategies against some types of denial of service (DoS) attacks. The Linux Director creates an entry for each connection in order to keep its state, and each entry occupies 128 bytes effective memory. LVS's vulnerability to a DoS attack lies in the potential to increase the number entries as much as possible until the linux director runs out of memory. The three defense strategies against the attack are: Randomly drop some entries in the table. Drop 1/rate packets before forwarding them. And use secure tcp state transition table and short timeouts. The strategies are controlled by sysctl variables and corresponding entries in the /proc filesystem:</p><p>/proc/sys/net/ipv4/vs/drop_entry /proc/sys/net/ipv4/vs/drop_packet /proc/sys/net/ipv4/vs/secure_tcp</p><p>Valid values for each variable are 0 through to 3. The default value is 0, which disables the respective defense strategy. 1 and 2 are automatic modes - when there is no enough available memory, the respective strategy will be enabled and the variable is automatically set to 2, otherwise the strategy is disabled and the variable is set to 1. A value of 3 denotes that the respective strategy is always enabled.  The available memory threshold and secure TCP timeouts can be tuned using the sysctl variables and corresponding entries in the /proc filesystem:</p><p>/proc/sys/net/ipv4/vs/amemthresh /proc/sys/net/ipv4/vs/timeout_*</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><em>/proc/net/ip_vs</em></p><p><em>/proc/net/ip_vs_app</em></p><p><em>/proc/net/ip_vs_conn</em></p><p><em>/proc/net/ip_vs_stats</em></p><p><em>/proc/sys/net/ipv4/vs/am_droprate</em></p><p><em>/proc/sys/net/ipv4/vs/amemthresh</em></p><p><em>/proc/sys/net/ipv4/vs/drop_entry</em></p><p><em>/proc/sys/net/ipv4/vs/drop_packet</em></p><p><em>/proc/sys/net/ipv4/vs/secure_tcp</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_close</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_closewait</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_established</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_finwait</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_icmp</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_lastack</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_listen</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_synack</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_synrecv</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_synsent</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_timewait</em></p><p><em>/proc/sys/net/ipv4/vs/timeout_udp</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ipvsadm&hellip;</h2>
        <div class="sectioncontent">
<p>The LVS web site (http://www.linuxvirtualserver.org/) for more documentation about LVS.</p><p><a href="../man8/ipvsadm-save.8.html"><strong>ipvsadm-save</strong>(8)</a>, <a href="../man8/ipvsadm-restore.8.html"><strong>ipvsadm-restore</strong>(8)</a>, <a href="../man8/iptables.8.html"><strong>iptables</strong>(8)</a>,</p><p><a href="../man8/insmod.8.html"><strong>insmod</strong>(8)</a>, <a href="../man8/modprobe.8.html"><strong>modprobe</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">

<pre>
ipvsadm - Wensong Zhang &lt;wensong@linuxvirtualserver.org&gt;
	  Peter Kese &lt;peter.kese@ijs.si&gt;
man page - Mike Wangsmo &lt;wanger@redhat.com&gt;
	   Wensong Zhang &lt;wensong@linuxvirtualserver.org&gt;
	   Horms &lt;horms@verge.net.au&gt;
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ipv6logconv.8.html"><span aria-hidden="true">&larr;</span> ipv6logconv.8: Http server log file converter for statistics</a></li>
   <li class="next"><a href="ipvsadm-restore.8.html">ipvsadm-restore.8: Restore the ipvs table from stdin <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
