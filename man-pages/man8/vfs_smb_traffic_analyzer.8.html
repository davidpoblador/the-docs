<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>vfs_smb_traffic_analyzer: Log samba vfs read and write operations through a socket to a helper application</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Log samba vfs read and write operations through a socket to a helper application">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="vfs_smb_traffic_analyzer (8) manual">
  <meta name="twitter:description" content="Log samba vfs read and write operations through a socket to a helper application">
  <meta name="twitter:image" content="https://www.carta.tech/images/samba-vfs-modules-vfs_smb_traffic_analyzer-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/vfs_smb_traffic_analyzer.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="vfs_smb_traffic_analyzer (8) manual" />
  <meta property="og:description" content="Log samba vfs read and write operations through a socket to a helper application" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/samba-vfs-modules-vfs_smb_traffic_analyzer-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">vfs_smb_traffic_analyzer<small> (8)</small></h1>
        <p class="lead">Log samba vfs read and write operations through a socket to a helper application</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vfs_smb_traffic_analyzer.8.html">
      <span itemprop="name">vfs_smb_traffic_analyzer: Log samba vfs read and write operations through a socket to a helper application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/samba-vfs-modules/">
      <span itemprop="name">samba-vfs-modules</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vfs_smb_traffic_analyzer.8.html">
      <span itemprop="name">vfs_smb_traffic_analyzer: Log samba vfs read and write operations through a socket to a helper application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>vfs objects = smb_traffic_analyzer</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This VFS module is part of the <a href="../man7/samba.7.html"><strong>samba</strong>(7)</a> suite.</p><p>The vfs_smb_traffic_analyzer VFS module logs client file operations on a Samba server and sends this data over a socket to a helper program (in the following the "Receiver"), which feeds a SQL database. More information on the helper programs can be obtained from the homepage of the project at: http://holger123.wordpress.com/smb-traffic-analyzer/ Since the VFS module depends on a receiver that is doing something with the data, it is evolving in it&apos;s development. Therefore, the module works with different protocol versions, and the receiver has to be able to decode the protocol that is used. The protocol version 1 was introduced to Samba at September 25, 2008. It was a very simple protocol, supporting only a small list of VFS operations, and had several drawbacks. The protocol version 2 is a try to solve the problems version 1 had while at the same time adding new features. With the release of Samba 4.0.0, the module will run protocol version 2 by default.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROTOCOL VERSION 1 DOCUMENTATION</h2>
        <div class="sectioncontent">
<p>vfs_smb_traffic_analyzer protocol version 1 is aware of the following VFS operations:</p><p>write</p><p>pwrite</p><p>read</p><p>pread</p><p>vfs_smb_traffic_analyzer sends the following data in a fixed format separated by a comma through either an internet or a unix domain socket:</p>
<pre>
	BYTES|USER|DOMAIN|READ/WRITE|SHARE|FILENAME|TIMESTAMP

</pre>
<p>Description of the records:</p><p>BYTES - the length in bytes of the VFS operation</p><p>USER - the user who initiated the operation</p><p>DOMAIN - the domain of the user</p><p>READ/WRITE - either "W" for a write operation or "R" for read</p><p>SHARE - the name of the share on which the VFS operation occurred</p><p>FILENAME - the name of the file that was used by the VFS operation</p><p>TIMESTAMP - a timestamp, formatted as "yyyy-mm-dd hh-mm-ss.ms" indicating when the VFS operation occurred</p><p>IP - The IP Address (v4 or v6) of the client machine that initiated the VFS operation.</p><p>This module is stackable.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DRAWBACKS OF PROTOCOL VERSION 1</h2>
        <div class="sectioncontent">
<p>Several drawbacks have been seen with protocol version 1 over time.</p><p>Problematic parsing - Protocol version 1 uses hyphen and comma to separate blocks of data. Once there is a filename with a hyphen, you will run into problems because the receiver decodes the data in a wrong way.</p><p>Insecure network transfer - Protocol version 1 sends all it&apos;s data as plaintext over the network.</p><p>Limited set of supported VFS operations - Protocol version 1 supports only four VFS operations.</p><p>No subreleases of the protocol - Protocol version 1 is fixed on it&apos;s version, making it unable to introduce new features or bugfixes through compatible sub-releases.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION 2 OF THE PROTOCOL</h2>
        <div class="sectioncontent">
<p>Protocol version 2 is an approach to solve the problems introduced with protcol v1. From the users perspective, the following changes are most prominent among other enhancements:</p><p>The data from the module may be send encrypted, with a key stored in secrets.tdb (or secrets.ntdb). The Receiver then has to use the same key. The module does AES block encryption over the data to send.</p><p>The module now can identify itself against the receiver with a sub-release number, where the receiver may run with a different sub-release number than the module. However, as long as both run on the V2.x protocol, the receiver will not crash, even if the module uses features only implemented in the newer subrelease. Ultimately, if the module uses a new feature from a newer subrelease, and the receiver runs an older protocol, it is just ignoring the functionality. Of course it is best to have both the receiver and the module running the same subrelease of the protocol.</p><p>The parsing problems of protocol V1 can no longer happen, because V2 is marshalling the data packages in a proper way.</p><p>The module now potentially has the ability to create data on every VFS function. As of protocol V2.0, there is support for 8 VFS functions, namely write,read,pread,pwrite, rename,chdir,mkdir and rmdir. Supporting more VFS functions is one of the targets for the upcoming sub-releases.</p><p>To enable protocol V2, the protocol_version vfs option has to be used (see OPTIONS).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS WITH PROTOCOL V1 AND V2.X</h2>
        <div class="sectioncontent">
<p>smb_traffic_analyzer:mode = STRING</p><p>If STRING matches to "unix_domain_socket", the module will use a unix domain socket located at /var/tmp/stadsocket, if STRING contains an different string or is not defined, the module will use an internet domain socket for data transfer.</p><p>smb_traffic_analyzer:host = STRING</p><p>The module will send the data to the system named with the hostname STRING.</p><p>smb_traffic_analyzer:port = STRING</p><p>The module will send the data using the TCP port given in STRING.</p><p>smb_traffic_analyzer:anonymize_prefix = STRING</p><p>The module will replace the user names with a prefix given by STRING and a simple hash number. In version 2.x of the protocol, the users SID will also be anonymized.</p><p>smb_traffic_analyzer:total_anonymization = STRING</p><p>If STRING matches to &apos;yes&apos;, the module will replace any user name with the string given by the option smb_traffic_analyzer:anonymize_prefix, without generating an additional hash number. This means that any transfer data will be mapped to a single user, leading to a total anonymization of user related data. In version 2.x of the protocol, the users SID will also be anonymized.</p><p>smb_traffic_analyzer:protocol_version = STRING</p><p>If STRING matches to V1, the module will use version 1 of the protocol. If STRING is not given, the module will use version 2 of the protocol, which is the default.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Running protocol V2 on share "example_share", using an internet socket.</p>
<pre>
	<em>[example_share]</em>
	\m[blue]<strong>path = /data/example</strong>\m[]
	\m[blue]<strong>vfs_objects = smb_traffic_analyzer</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:host = examplehost</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:port = 3491</strong>\m[]

</pre>
<p>The module running on share "example_share", using a unix domain socket</p>
<pre>
	<em>[example_share]</em>
	\m[blue]<strong>path = /data/example</strong>\m[]
	\m[blue]<strong>vfs objects = smb_traffic_analyzer</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:mode = unix_domain_socket</strong>\m[]

</pre>
<p>The module running on share "example_share", using an internet socket, connecting to host "examplehost" on port 3491.</p>
<pre>
	<em>[example_share]</em>
	\m[blue]<strong>path = /data/example</strong>\m[]
	\m[blue]<strong>vfs objects = smb_traffic_analyzer</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:host = examplehost</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:port = 3491</strong>\m[]

</pre>
<p>The module running on share "example_share", using an internet socket, connecting to host "examplehost" on port 3491, anonymizing user names with the prefix "User".</p>
<pre>
	<em>[example_share]</em>
	\m[blue]<strong>path = /data/example</strong>\m[]
	\m[blue]<strong>vfs objects = smb_traffic_analyzer</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:host = examplehost</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:port = 3491</strong>\m[]
	\m[blue]<strong>smb_traffic_analyzer:anonymize_prefix = User</strong>\m[]

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This man page is correct for version 3.3 of the Samba suite.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>The original Samba software and related utilities were created by Andrew Tridgell. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed.</p><p>The original version of the VFS module and the helper tools were created by Holger Hetterich.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="vfs_shadow_copy2.8.html"><span aria-hidden="true">&larr;</span> vfs_shadow_copy2.8: Expose snapshots to windows clients as shadow copies.</a></li>
   <li class="next"><a href="vfs_streams_depot.8.html">vfs_streams_depot.8: Experimental module to store alternate data streams in a central directory. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
