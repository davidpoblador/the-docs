<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>curvetun: A lightweight curve25519 ip4/6 tunnel</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A lightweight curve25519 ip4/6 tunnel">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">curvetun<small> (8)</small></h1>
        <p class="lead">A lightweight curve25519 ip4/6 tunnel</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/curvetun.8.html">
      <span itemprop="name">curvetun: A lightweight curve25519 ip4/6 tunnel</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/netsniff-ng/">
      <span itemprop="name">netsniff-ng</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/curvetun.8.html">
      <span itemprop="name">curvetun: A lightweight curve25519 ip4/6 tunnel</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>curvetun</strong> [<em>options</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>curvetun is a lightweight, high-speed ECDH multiuser IP tunnel for Linux that is based on <strong>epoll</strong>(2). curvetun uses the Linux TUN/TAP interface and supports {IPv4, IPv6} over {IPv4, IPv6} with UDP or TCP as carrier protocols.</p><p>It has an integrated packet forwarding tree, thus multiple users with different IPs can be handled via a single tunnel device on the server side, and flows are scheduled for processing in a CPU efficient way, at least in the case of TCP as the carrier protocol.</p><p>For key management, public-key cryptography based on elliptic curves are used and packets are encrypted end-to-end by the symmetric stream cipher Salsa20 and authenticated by the MAC Poly1305, where keys have previously been computed with the ECDH key agreement protocol Curve25519.</p><p>Cryptography is based on Daniel J. Bernstein's networking and cryptography library \[lq]NaCl\[rq]. By design, curvetun does not provide any particular pattern or default port numbers that gives certainty that the connection from a particular flow is actually running curvetun.</p><p>However, if you have a further need to bypass censorship, you can try using curvetun in combination with Tor's obfsproxy or Telex. Furthermore, curvetun also protects you against replay attacks and DH man-in-the-middle attacks. Additionally, server-side syslog event logging can also be disabled to avoid revealing critical user connection data.</p>
<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>obfsproxy from the TOR project</p><p>https://www.torproject.org/projects/obfsproxy.html.en</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
     2.
  </dt>
  <dd>
    <p>Telex, anti-censorship in the network infrastructure</p><p>https://telex.cc/</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>-d &lt;tundev&gt;, --dev &lt;tundev&gt;</h3>
<p>Defines the name of the tunnel device that is being created. If this option is not set, then the default names, curves{0,1,2,..} for a curvetun server, and curvec{0,1,2,...} for a curvetun client are used.</p>
<h3>-p &lt;num&gt;, --port &lt;num&gt;</h3>
<p>Defines the port the curvetun server should listen on. There is no default port for curvetun, so setting this option for server bootstrap is mandatory. This option is for servers only.</p>
<h3>-t &lt;server&gt;, --stun &lt;server&gt;</h3>
<p>If needed, this options enables an STUN lookup in order to show public IP to port mapping and to punch a hole into the firewall. In case you are unsure what STUN server to use, simply use ''--stun stunserver.org''.</p>
<h3>-c[=alias], --client[=alias]</h3>
<p>Starts curvetun in client mode and connects to the given connection alias that is defined in the configuration file.</p>
<h3>-k, --keygen</h3>
<p>Generate private and public keypair. This must be done initially.</p>
<h3>-x, --export</h3>
<p>Export user and key combination to stdout as a one-liner.</p>
<h3>-C, --dumpc</h3>
<p>Dump all known clients that may connect to the local curvetun server and exit.</p>
<h3>-S, --dumps</h3>
<p>Dump all known servers curvetun as a client can connect to, and exit.</p>
<h3>-D, --nofork</h3>
<p>Do not fork off as a client or server on startup.</p>
<h3>-s, --server</h3>
<p>Start curvetun in server mode. Additional parameters are needed, at least the definition of the port that clients can connect to is required.</p>
<h3>-N, --no-logging</h3>
<p>Disable all curvetun logging of user information. This option can be used to enable curvetun users to connect more anonymously. This option is for servers only.</p>
<h3>-u, --udp</h3>
<p>Use UDP as a carrier protocol instead of TCP. By default, TCP is the carrier protocol. This option is for servers only.</p>
<h3>-4, --ipv4</h3>
<p>Defines IPv4 as the underlying network protocol to be used on the tunnel device. IPv4 is the default. This option is for servers only.</p>
<h3>-6, --ipv6</h3>
<p>Defines IPv6 as the underlying network protocol to be used on the tunnel device. This option is for servers only.</p>
<h3>-v, --version</h3>
<p>Show version information and exit.</p>
<h3>-h, --help</h3>
<p>Show user help and exit.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USAGE EXAMPLE</h2>
        <div class="sectioncontent">
<h3>curvetun --server -4 -u -N --port 6666 --stun stunserver.org</h3>
<p>Starts curvetun in server mode with IPv4 as network protocol and UDP as a transport carrier protocol. The curvetun server listens for incoming connections on port 6666 and performs an STUN lookup on startup to stunserver.org.</p>
<h3>curvetun --client=ethz</h3>
<p>Starts curvetun in client mode and connects to the defined connection alias ''ethz'' that is defined in the curvetun ~/.curvetun/servers configuration file.</p>
<h3>curvetun --keygen</h3>
<p>Generates initial keypairs and stores them in the ~/.curvetun/ directory.</p>
<h3>curvetun --export</h3>
<p>Export user data to stdout for configuration of a curvetun server.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CRYPTOGRAPHY</h2>
        <div class="sectioncontent">
<p>Encrypted IP tunnels are often used to create virtual private networks (VPN), where parts of the network can only be reached via an insecure or untrusted medium such as the Internet. Only a few software utilities exist to create such tunnels, or, VPNs. Two popular representatives of such software are OpenVPN and VTUN.</p><p>The latter also introduced the TUN/TAP interfaces into the Linux kernel. VTUN only has a rather basic encryption module, that does not fit today's cryptographic needs. By default, MD5 is used to create 128-Bit wide keys for the symmetric BlowFish cipher in ECB mode [1].</p><p>Although OpenSSL is used in both VTUN and OpenVPN, OpenVPN is much more feature rich regarding ciphers and user authentication. Nevertheless, letting people choose ciphers or authentication methods is not necessarily a good thing: administrators could either prefer speed over security and therefore choose weak ciphers, so that the communication system will be as good as without any cipher; they could choose weak passwords for symmetric encryption or they could misconfigure the communication system by having too much choice of ciphers and too little experience for picking the right one.</p><p>Next to the administration issues, there are also software development issues. Cryptographic libraries like OpenSSL are a huge mess and too low-level and complex to fully understand or correctly apply, so that they form further ground for vulnerabilities of such software.</p><p>In 2010, the cryptographers Tanja Lange and Daniel J. Bernstein have therefore created and published a cryptographic library for networking, which is named NaCl (pronounced ''salt''). NaCl addresses such problems as mentioned in OpenSSL and, in contrast to the rather generic use of OpenSSL, was created with a strong focus on public-key authenticated encryption based on elliptic curve cryptography, which is used in curvetun. Partially quoting Daniel J. Bernstein:</p><p>"RSA is somewhat older than elliptic-curve cryptography: RSA was introduced in 1977, while elliptic-curve cryptography was introduced in 1985. However, RSA has shown many more weaknesses than elliptic-curve cryptography. RSA's effective security level was dramatically reduced by the linear sieve in the late 1970s, by the quadratic sieve and ECM in the 1980s, and by the number-field sieve in the 1990s. For comparison, a few attacks have been developed against some rare elliptic curves having special algebraic structures, and the amount of computer power available to attackers has predictably increased, but typical elliptic curves require just as much computer power to break today as they required twenty years ago.</p><p>IEEE P1363 standardized elliptic-curve cryptography in the late 1990s, including a stringent list of security criteria for elliptic curves. NIST used the IEEE P1363 criteria to select fifteen specific elliptic curves at five different security levels. In 2005, NSA issued a new ''Suite B'' standard, recommending the NIST elliptic curves (at two specific security levels) for all public-key cryptography and withdrawing previous recommendations of RSA."</p><p>curvetun uses a particular elliptic curve, Curve25519, introduced in the following paper: Daniel J. Bernstein, ''Curve25519: new Diffie-Hellman speed records,'' pages 207-228 in Proceedings of PKC 2006, edited by Moti Yung, Yevgeniy Dodis, Aggelos Kiayias, and Tal Malkin, Lecture Notes in Computer Science 3958, Springer, 2006, ISBN 3-540-33851-9.</p><p>This elliptic curve follows all of the standard IEEE P1363 security criteria. It also follows new recommendations that achieve ''side-channel immunity'' and ''twist security'' while improving speed. What this means is that secure implementations of Curve25519 are considerably simpler and faster than secure implementations of, for example, NIST P-256; there are fewer opportunities for implementors to make mistakes that compromise security, and mistakes are more easily caught by reviewers.</p><p>An attacker who spends a billion dollars on special-purpose chips to attack Curve25519, using the best attacks available today, has about 1 chance in 1000000000000000000000000000 of breaking Curve25519 after a year of computation. One could achieve similar levels of security with 3000-bit RSA, but encryption and authentication with 3000-bit RSA are not nearly fast enough to handle tunnel traffic and would require much more space in network packets.</p>
<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>Security analysis of VTun</p><p>http://www.off.net/~jme/vtun_secu.html</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
     2.
  </dt>
  <dd>
    <p>NaCl: Networking and Cryptography library</p><p>http://nacl.cr.yp.to/</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SETUP HOWTO</h2>
        <div class="sectioncontent">
<p>If you have not run curvetun before, you need to do an initial setup once.</p><p>First, make sure that the servers and clients clocks are periodically synced, for example, by running an NTP daemon. This is necessary to protect against replay attacks. Also, make sure you have read and write access to /dev/net/tun. You should not run curvetun as root! Then, after you have assured this, the first step is to generate keys and config files. On both the client and server do:</p><p><strong>curvetun -k</strong></p><p>You are asked for a user name. You can use an email address or whatever suits you. Here, we assume you have entered 'mysrv1' on the server and 'myclient1' on the client side.</p><p>Now, all necessary files have been created under ~/.curvetun. Files include \[lq]priv.key\[rq], \[lq]pub.key\[rq], \[lq]username\[rq], \[lq]clients\[rq] and \[lq]servers\[rq].</p><p>\[lq]clients\[rq] and \[lq]servers\[rq] are empty at the beginning and need to be filled. The \[lq]clients\[rq] file is meant for the server, so that it knows what clients are allowed to connect. The \[lq]servers\[rq] file is for the client, where it can select curvetun servers to connect to. Both files are kept very simple, so that a single configuration line per client or server is sufficient.</p><p>The client needs to export its public key data for the server</p><p><strong>curvetun -x</strong></p><p>where it prints a string in the following format:</p>
<pre>
  myclient1;11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11
  &#92;_______/ &#92;_____________________________________________________________________________________________/
   username  32 byte public key for 'myclient1'
</pre>
<p>This line is transferred to the server admin (yes, we assume a manual on-site key exchange scenario where, for example, the admin sets up server and clients), where the admin then adds this entry into his ''clients'' file like:</p>
<pre>
  server$ echo "myclient1;11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:11:" &#92;
               "11:11:11:11:11:11:11:11:11:11:11:11:11:11:11" &gt;&gt; ~/.curvetun/clients
</pre>
<p>The server admin can check if the server has registered it properly as follows:</p>
<pre>
  server$ curvetun -C
</pre>
<p>which prints all parsed clients from ''~/.curvetun/clients''. This process could easily be automated or scripted with, for example, Perl and LDAP.</p><p>Now, the client ''myclient1'' is known to the server; that completes the server configuration. The next step is to tell the client where it needs to connect to the server.</p><p>We assume in this example that the tunnel server has a public IP address, e.g. 1.2.3.4, runs on port 6666 and uses UDP as a carrier protocol. In case you are behind NAT, you can use curvetun's ''--stun'' option for starting the server, to obtain your mapping. However, in this example we continue with 1.2.3.4 and 6666, UDP.</p><p>First, the server needs to export its key to the client, as follows:</p>
<pre>
  server$ curvetun -x
</pre>
<p>where it prints a string in the following format:</p>
<pre>
  mysrv1;22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22
  &#92;____/ &#92;_____________________________________________________________________________________________/
</pre>
<p> username  32 byte public key for 'mysrv1'</p>
<pre>
           ^-- you need this public key
</pre>
<p>Thus, you now have the server IP address, server port, server transport protocol and the server's public key at hand. On the client side it can be put all together in the config as follows:</p>
<pre>
  client$ echo "myfirstserver;1.2.3.4;6666;udp;22:22:22:22:22:22:22:22:22:22:" &#92;
               "22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:22:"  &#92;
               "22:22" &gt;&gt; ~/.curvetun/servers
</pre>
<p>The client can check its config using:</p>
<pre>
  client$ curvetun -S
</pre>
<p>Then we start the server with:</p>
<pre>
  server$ curvetun -s -p 6666 -u
  server# ifconfig curves0 up
  server# ifconfig curves0 10.0.0.1/24
</pre>
<p>Then, we start the client with:</p>
<pre>
  client$ curvetun -c=myfirstserver
  client# ifconfig curvec0 up
  client# ifconfig curvec0 10.0.0.2/24
</pre>
<p>Also, client-side information, errors, or warnings will appear in syslog! By now we should be able to ping the server:</p>
<pre>
  client$ ping 10.0.0.1
</pre>
<p>That's it! Routing example:</p><p>Server side's public IP on eth0 is, for example, 1.2.3.4:</p>
<pre>
  server$ ... start curvetun server ...
  server# ifconfig curves0 up
  server# ifconfig curves0 10.0.0.1/24
  server# echo 1 &gt; /proc/sys/net/ipv4/ip_forward
  server# iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
  server# iptables -A FORWARD -i eth0 -o curves0 -m state --state RELATED,ESTABLISHED -j ACCEPT
  server# iptables -A FORWARD -i curves0 -o eth0 -j ACCEPT
</pre>
<p>Client side's IP on eth0 is, for example, 5.6.7.8:</p>
<pre>
  client$ ... start curvetun client ...
  client# ... lookup your default gateway (e.g. via route, here: 5.6.7.9) ...
  client# ifconfig curvec0 up
  client# ifconfig curvec0 10.0.0.2/24
  client# route add -net 1.2.3.0 netmask 255.255.255.0 gw 5.6.7.9 dev eth0
  client# route add default gw 10.0.0.1
  client# route del default gw 5.6.7.9
</pre>
<p>That should be it, happy browsing and emailing via curvetun tunnels!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTE</h2>
        <div class="sectioncontent">
<p>This software is an experimental prototype intended for researchers. It will most likely mature over time, but it is currently not advised to use this software when life is put at risk.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Blackhole tunneling is currently not supported.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LEGAL</h2>
        <div class="sectioncontent">
<p>curvetun is licensed under the GNU GPL version 2.0.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p><strong>curvetun</strong> was originally written for the netsniff-ng toolkit by Daniel Borkmann. It is currently maintained by Tobias Klauser &lt;tklauser@distanz.ch&gt; and Daniel Borkmann &lt;dborkma@tik.ee.ethz.ch&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO curvetun&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/netsniff-ng.8.html"><strong>netsniff-ng</strong>(8)</a>, <a href="../man8/trafgen.8.html"><strong>trafgen</strong>(8)</a>, <a href="../man8/mausezahn.8.html"><strong>mausezahn</strong>(8)</a>, <a href="../man8/bpfc.8.html"><strong>bpfc</strong>(8)</a>, <a href="../man8/ifpps.8.html"><strong>ifpps</strong>(8)</a>, <a href="../man8/flowtop.8.html"><strong>flowtop</strong>(8)</a>, <a href="../man8/astraceroute.8.html"><strong>astraceroute</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Manpage was written by Daniel Borkmann.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of the Linux netsniff-ng toolkit project. A description of the project, and information about reporting bugs, can be found at http://netsniff-ng.org/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ctstat.8.html"><span aria-hidden="true">&larr;</span> ctstat.8: Unified linux network statistics</a></li>
   <li class="next"><a href="delpart.8.html">delpart.8: Tell the kernel to forget about a partition <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
