<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>darkstat: Network statistics gatherer</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Network statistics gatherer">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="darkstat (8) manual">
  <meta name="twitter:description" content="Network statistics gatherer">
  <meta name="twitter:image" content="https://www.carta.tech/images/darkstat-darkstat-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/darkstat.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="darkstat (8) manual" />
  <meta property="og:description" content="Network statistics gatherer" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/darkstat-darkstat-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">darkstat<small> (8)</small></h1>
        <p class="lead">Network statistics gatherer</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/darkstat.8.html">
      <span itemprop="name">darkstat: Network statistics gatherer</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/darkstat/">
      <span itemprop="name">darkstat</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/darkstat.8.html">
      <span itemprop="name">darkstat: Network statistics gatherer</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>darkstat</strong> [ <strong>-i</strong><em> interface</em> ] [ <strong>-r</strong><em> file</em> ] [ <strong>--snaplen</strong><em> bytes</em> ] [ <strong>--pppoe</strong> ] [ <strong>--syslog</strong> ] [ <strong>--verbose</strong> ] [ <strong>--no-daemon</strong> ] [ <strong>--no-promisc</strong> ] [ <strong>--no-dns</strong> ] [ <strong>--no-macs</strong> ] [ <strong>--no-lastseen</strong> ] [ <strong>-p</strong><em> port</em> ] [ <strong>-b</strong><em> bindaddr</em> ] [ <strong>--base</strong><em> path</em> ] [ <strong>-f</strong><em> filter</em> ] [ <strong>-l</strong><em> network/netmask</em> ] [ <strong>--local-only</strong> ] [ <strong>--chroot</strong><em> dir</em> ] [ <strong>--user</strong><em> username</em> ] [ <strong>--daylog</strong><em> filename</em> ] [ <strong>--import</strong><em> filename</em> ] [ <strong>--export</strong><em> filename</em> ] [ <strong>--pidfile</strong><em> filename</em> ] [ <strong>--hosts-max</strong><em> count</em> ] [ <strong>--hosts-keep</strong><em> count</em> ] [ <strong>--ports-max</strong><em> count</em> ] [ <strong>--ports-keep</strong><em> count</em> ] [ <strong>--highest-port</strong><em> port</em> ] [ <strong>--wait</strong><em> secs</em> ] [ <strong>--hexdump</strong> ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>darkstat</em> is a packet sniffer that runs as a background process, gathers all sorts of statistics about network usage, and serves them over HTTP.</p><p>All settings are passed on the commandline.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-i</strong><em> interface</em></p>
  </dt>
  <dd>
    <p>Capture traffic on the specified network interface. This is the only mandatory commandline argument.</p>
  </dd>
  <dt>
    <p><strong>-r</strong><em> file</em></p>
  </dt>
  <dd>
    <p>Instead of capturing live traffic, read it from a <strong>pcap</strong>(3) capture file. This is only useful for development and benchmarking. The <strong>-r</strong> and <strong>-i</strong> arguments are mutually exclusive.</p>
  </dd>
  <dt>
    <p><strong>--snaplen</strong><em> bytes</em></p>
  </dt>
  <dd>
    <p>How many bytes to capture from the start of each packet. You should not need to specify this; <em>darkstat</em> will calculate it automatically.</p>
  </dd>
  <dt>
    <p><strong>--pppoe</strong></p>
  </dt>
  <dd>
    <p>Don't use this.</p><p>Instead, capture on the tunnel interface that your PPPoE software provides, for example <strong>tun0</strong> on <em>FreeBSD</em>, <strong>pppoe0</strong> on <em>OpenBSD</em> or <em>NetBSD</em>.</p><p>If you really must, you can capture on an Ethernet interface and pass this argument to have <em>darkstat</em> decode PPPoE frames and ignore everything else. Make sure you also specify your local address with the <strong>-l</strong> argument!</p>
  </dd>
  <dt>
    <p><strong>--syslog</strong></p>
  </dt>
  <dd>
    <p>Errors, warnings, and verbose messages will go to <strong>syslog</strong> (facility daemon, priority debug) instead of <strong>stderr</strong>.</p><p>On some systems, these messages end up in <strong>/var/log/debug</strong> by default.</p>
  </dd>
  <dt>
    <p><strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>Produce more verbose debugging messages.</p>
  </dd>
  <dt>
    <p><strong>--no-daemon</strong></p>
  </dt>
  <dd>
    <p>Do not detach from the controlling terminal; stay in the foreground.</p>
  </dd>
  <dt>
    <p><strong>--no-promisc</strong></p>
  </dt>
  <dd>
    <p>Do not use promiscuous mode to capture. Note that an interface may already be in promiscuous mode, or may later enter promiscuous mode, due to circumstances beyond <em>darkstat</em>'s control. If this is a problem, use <strong>-f</strong> to specify an appropriate <strong>bpf</strong>(4) filter.</p>
  </dd>
  <dt>
    <p><strong>--no-dns</strong></p>
  </dt>
  <dd>
    <p>Do not resolve IPs to host names. This can significantly reduce memory footprint on small systems as an extra process is created for DNS resolution.</p>
  </dd>
  <dt>
    <p><strong>--no-macs</strong></p>
  </dt>
  <dd>
    <p>Do not display MAC addresses in the hosts table.</p>
  </dd>
  <dt>
    <p><strong>--no-lastseen</strong></p>
  </dt>
  <dd>
    <p>Do not display the last seen time in the hosts table.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> port</em></p>
  </dt>
  <dd>
    <p>Bind the web interface to the specified port. The default is 667.</p>
  </dd>
  <dt>
    <p><strong>-b</strong><em> bindaddr</em></p>
  </dt>
  <dd>
    <p>Bind the web interface to the specified address. The default is to listen on all interfaces.</p>
  </dd>
  <dt>
    <p><strong>--base</strong><em> path</em></p>
  </dt>
  <dd>
    <p>Specify the path of the base URL. This can be useful if <em>darkstat</em> is accessed via a reverse proxy.</p><p>For example, if you use Apache's <em>mod_proxy</em> and want to avoid a complicated setup with <em>mod_proxy_html</em> (and <em>mod_header</em> to unset the <em>Accept-Encoding</em> header), just set the base path to something like <em>stats</em> and use a config similar to the following snippet:</p><ul>
<li><p> ProxyPass /stats/ http://localhost:667/stats/  ProxyPassReverse /stats/ http://localhost:667/stats/</p></li>
</ul><p>The default is <em>/</em> (i.e. the root).</p>
  </dd>
  <dt>
    <p><strong>-f</strong><em> filter</em></p>
  </dt>
  <dd>
    <p>Use the specified filter expression when capturing traffic. The filter syntax is beyond the scope of this manual page; please refer to the <a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a> documentation.</p>
  </dd>
  <dt>
    <p><strong>-l</strong><em> network/netmask</em></p>
  </dt>
  <dd>
    <p>Define a "local network" according to the network and netmask addresses. All traffic entering or leaving this network will be graphed, as opposed to the default behaviour of only graphing traffic to and from the local host.</p><p>The rule is that if <strong>ip_addr & netmask == network</strong>, then that address is considered local. See the usage example below.</p>
  </dd>
  <dt>
    <p><strong>--local-only</strong></p>
  </dt>
  <dd>
    <p>Make the web interface only display hosts on the "local network." This is intended to be used together with the <strong>-l</strong> argument.</p>
  </dd>
  <dt>
    <p><strong>--chroot</strong><em> dir</em></p>
  </dt>
  <dd>
    <p>Force <em>darkstat</em> to <strong>chroot()</strong> into the specified directory. Without this argument, a default directory will be used, which is determined at build time. Usually <em>/var/empty</em> or <em>/var/lib/empty</em>.</p><p>For security reasons, this directory should be empty, and the user that <em>darkstat</em> is running as should not have write access to it.</p><p>However, if you wish to use <strong>--daylog</strong> or <strong>--export</strong>, <em>darkstat</em> will need write access to the chroot. If you are uncomfortable with the security implications, don't use any functionality that requires write access.</p>
  </dd>
  <dt>
    <p><strong>--user</strong><em> username</em></p>
  </dt>
  <dd>
    <p>Force <em>darkstat</em> to drop privileges to the <strong>uid</strong> and <strong>gid</strong> of the specified user. Without this argument, a default value will be used, which is set at build time. Usually <strong>nobody</strong>.</p><p>For security reasons, this should not be <strong>root</strong>.</p>
  </dd>
  <dt>
    <p><strong>--daylog</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>Log daily traffic statistics into the named file, relative to the chroot directory. If you wish to use <strong>--daylog</strong>, you must first specify a <strong>--chroot</strong> directory, and it must be writeable by the <em>darkstat</em> user. A writeable chroot has security implications; if you are uncomfortable with this, do not use the <strong>--daylog</strong> functionality.</p><p>If the daylog argument is not specified, no logging is performed.</p><p>The daylog format is:</p><p>localtime|time_t|bytes_in|bytes_out|pkts_in|pkts_outs</p><p>Lines starting with a # are comments stating when logging started and stopped.</p>
  </dd>
  <dt>
    <p><strong>--import</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>Upon starting, import a <em>darkstat</em> database from the named file, relative to the chroot directory. If you wish to use <strong>--import</strong>, you must first specify a <strong>--chroot</strong> directory. If the import is unsuccessful, <em>darkstat</em> will start with an empty database.</p>
  </dd>
  <dt>
    <p><strong>--export</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>On shutdown, or upon receiving SIGUSR1 or SIGUSR2, export the in-memory database to the named file, relative to the chroot directory. If you wish to use <strong>--export</strong>, you must first specify a <strong>--chroot</strong> directory, and it must be writeable by the <em>darkstat</em> user. A writeable chroot has security implications - if you are uncomfortable with this, do not use the <strong>--export</strong> functionality.</p>
  </dd>
  <dt>
    <p><strong>--pidfile</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>Creates a file containing the process ID of <em>darkstat</em>. This file will be unlinked upon clean shutdown. As with all pidfiles, if <em>darkstat</em> dies uncleanly, a stale pidfile can be left over.</p><p>For example, start <em>darkstat</em> with:</p><ul>
<li><p>darkstat -i fxp0 --chroot /var/run/darkstat --pidfile darkstat.pid</p></li>
</ul><p>And stop with:</p><ul>
<li><p>kill `cat /var/run/darkstat/darkstat.pid`</p></li>
</ul><p>By default, <a href="../man1/kill.1.html"><strong>kill</strong>(1)</a> will send SIGTERM, which will cause <em>darkstat</em> to shut down cleanly.</p>
  </dd>
  <dt>
    <p><strong>--hosts-max</strong><em> count</em></p>
  </dt>
  <dd>
    <p>The maximum number of hosts that will be kept in the hosts table. This is used to limit how much accounting data will be kept in memory. The number of <strong>--hosts-max</strong> must be greater than <strong>--hosts-keep</strong></p>
  </dd>
  <dt>
    <p><strong>--hosts-keep</strong><em> count</em></p>
  </dt>
  <dd>
    <p>When the hosts table hits <strong>--hosts-max</strong> and traffic is seen from a new host, we clean out the hosts table, keeping only the top <strong>--hosts-keep</strong> number of hosts, sorted by total traffic.</p>
  </dd>
  <dt>
    <p><strong>--ports-max</strong><em> count</em></p>
  </dt>
  <dd>
    <p>The maximum number of ports that will be tracked for each host. This is used to limit how much accounting data will be kept in memory. The number of <strong>--ports-max</strong> must be greater than <strong>--ports-keep</strong></p>
  </dd>
  <dt>
    <p><strong>--ports-keep</strong><em> count</em></p>
  </dt>
  <dd>
    <p>When a ports table fills up, this many ports are kept and the rest are discarded.</p>
  </dd>
  <dt>
    <p><strong>--highest-port</strong><em> port</em></p>
  </dt>
  <dd>
    <p>Ports that are numerically higher than this will not appear in the per-host ports tables, although their traffic will still be accounted for. This can be used to hide ephemeral ports. By default, all ports are tracked.</p>
  </dd>
  <dt>
    <p><strong>--wait</strong><em> secs</em></p>
  </dt>
  <dd>
    <p>Don't use this. It's a hack to help victims of <em>NetworkManager</em> and similar systems.</p><p>You should start <em>darkstat</em> after the capture interface has come up. If you can't, specifying the <strong>--wait</strong> option will make <em>darkstat</em> sleep up to the specified number of seconds for the interface to become ready. Zero means wait indefinitely.</p>
  </dd>
  <dt>
    <p><strong>--hexdump</strong></p>
  </dt>
  <dd>
    <p>Show hex dumps of received traffic. This is only for debugging, and implies <strong>--verbose</strong> and <strong>--no-daemon</strong>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USAGE EXAMPLES</h2>
        <div class="sectioncontent">
<p>To gather statistics on the <em>fxp0</em> interface:</p><ul>
<li><p>darkstat -i fxp0</p></li>
</ul><p>We want to account for traffic on the Internet-facing interface, but only serve web pages to our private local network where we have the IP address 192.168.0.1:</p><ul>
<li><p>darkstat -i fxp0 -b 192.168.0.1</p></li>
</ul><p>We want to serve web pages on the standard HTTP port:</p><ul>
<li><p>darkstat -i fxp0 -p 80</p></li>
</ul><p>We are on Optus (cable) and don't want to account for the constant ARP traffic we are receiving:</p><ul>
<li><p>darkstat -i fxp0 -f "not arp"</p></li>
</ul><p>We only want to account for SSH traffic:</p><ul>
<li><p>darkstat -i fxp0 -f "port 22"</p></li>
</ul><p>We don't want to account for traffic between internal IPs:</p><ul>
<li><p>darkstat -i fxp0 -f "not (src net 192.168.0 and dst net 192.168.0)"</p></li>
</ul><p>(For a full reference on filter syntax, refer to the <a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a> manpage)</p><p>We have a network consisting of a gateway server (192.168.1.1) and a few workstations (192.168.1.2, 192.168.1.3, etc.) and we want to graph all traffic entering and leaving the local network, not just the gateway server (which is running <em>darkstat</em>):</p><ul>
<li><p>darkstat -i fxp0 -l 192.168.1.0/255.255.255.0</p></li>
</ul><p>On some systems, we can't capture on a "decoded" interface but only on <em>nas0</em> which returns PPPoE encapsulated packets. Do PPPoE decoding, and override the local IP manually since it cannot be automatically detected. Note the /32 netmask:</p><ul>
<li><p>darkstat -i nas0 --pppoe -l 192.168.1.1/255.255.255.255</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNALS</h2>
        <div class="sectioncontent">
<p>To shut <em>darkstat</em> down cleanly, send a SIGTERM or SIGINT signal to the <em>darkstat</em> parent process.</p><p>Sending the SIGUSR1 signal will cause <em>darkstat</em> to empty out its in-memory database. If an <strong>--export</strong> file was set, it will first save the database to file. Sending SIGUSR2 will save the database without emptying it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FREQUENTLY ASKED QUESTIONS</h2>
        <div class="sectioncontent">
<h3>How many bytes does each bar on the graph represent?</h3>
<p>Hover your mouse cursor over a bar and you should get a tooltip saying exactly how many bytes in and out the bar represents.</p>
<h3>Why aren't there labels / tics / a scale on the graphs?</h3>
<p>Because implementing them is hard. And doing so <em>correctly</em>, and in a way that works across all browsers, looks pretty much impossible.</p><p>I might attempt it some day. In the meantime, patches would be gladly accepted.</p>
<h3>Why are the graphs blank? All the bars are zero.</h3>
<p>The graphs only show traffic in/out of the local host, which is determined by getting the IP address of the interface you're sniffing on.</p><p>You can use the <strong>-l</strong> argument to override the local address for accounting purposes. You can also use it to do accounting for a whole subnet by specifying an appropriate netmask.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO darkstat&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p><em>darkstat</em> was written in 2001, largely as a result of a certain Australian cable Internet provider introducing a 3GB monthly traffic limit.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Emil Mikulic and others. (see the AUTHORS file)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WEBSITE</h2>
        <div class="sectioncontent">
<p>http://unix4lyfe.org/darkstat/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="daptup.8.html"><span aria-hidden="true">&larr;</span> daptup.8: Plugin for apt[itude] and cupt to list repository changes</a></li>
   <li class="next"><a href="db2bak.8.html">db2bak.8: Directory server script for making a backup of the database <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
