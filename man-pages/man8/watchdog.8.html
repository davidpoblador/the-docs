<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>watchdog: A software watchdog daemon</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A software watchdog daemon">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="watchdog (8) manual">
  <meta name="twitter:description" content="A software watchdog daemon">
  <meta name="twitter:image" content="https://www.carta.tech/images/watchdog-watchdog-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/watchdog.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="watchdog (8) manual" />
  <meta property="og:description" content="A software watchdog daemon" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/watchdog-watchdog-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">watchdog<small> (8)</small></h1>
        <p class="lead">A software watchdog daemon</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/watchdog.8.html">
      <span itemprop="name">watchdog: A software watchdog daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/watchdog/">
      <span itemprop="name">watchdog</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/watchdog.8.html">
      <span itemprop="name">watchdog: A software watchdog daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>watchdog</strong> [<strong>-F</strong>|<strong>--foreground</strong>] [<strong>-f</strong>|<strong>--force</strong>] [<strong>-c</strong> <em>filename</em>|<strong>--config-file</strong> <em>filename</em>] [<strong>-v</strong>|<strong>--verbose</strong>] [<strong>-s</strong>|<strong>--sync</strong>] [<strong>-b</strong>|<strong>--softboot</strong>] [<strong>-q</strong>|<strong>--no-action</strong>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The Linux kernel can reset the system if serious problems are detected. This can be implemented via special watchdog hardware, or via a slightly less reliable software-only watchdog inside the kernel. Either way, there needs to be a daemon that tells the kernel the system is working fine. If the daemon stops doing that, the system is reset.</p><p><strong>watchdog</strong> is such a daemon. It opens <em>/dev/watchdog</em>, and keeps writing to it often enough to keep the kernel from resetting, at least once per minute. Each write delays the reboot time another minute. After a minute of inactivity the watchdog hardware will cause the reset. In the case of the software watchdog the ability to reboot will depend on the state of the machines and interrupts.</p><p>The watchdog daemon can be stopped without causing a reboot if the device <em>/dev/watchdog</em> is closed correctly, unless your kernel is compiled with the <em>CONFIG_WATCHDOG_NOWAYOUT</em> option enabled.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TESTS</h2>
        <div class="sectioncontent">
<p>The watchdog daemon does several tests to check the system status:</p><ul>
<li><p>Is the process table full?</p></li><li><p>Is there enough free memory?</p></li><li><p>Is there enough allocatable memory?</p></li><li><p>Are some files accessible?</p></li><li><p>Have some files changed within a given interval?</p></li><li><p>Is the average work load too high?</p></li><li><p>Has a file table overflow occurred?</p></li><li><p>Is a process still running? The process is specified by a pid file.</p></li><li><p>Do some IP addresses answer to ping?</p></li><li><p>Do network interfaces receive traffic?</p></li><li><p>Is the temperature too high? (Temperature data not always available.)</p></li><li><p>Execute a user defined command to do arbitrary tests.</p></li><li><p>Execute one or more test/repair commands found in /etc/watchdog.d.  These commands are called with the argument <strong>test</strong> or <strong>repair</strong>.</p></li>
</ul><p>If any of these checks fail watchdog will cause a shutdown. Should any of these tests except the user defined binary last longer than one minute the machine will be rebooted, too.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Available command line options are the following:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-v</strong>, <strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>Set verbose mode. Only implemented if compiled with <em>SYSLOG</em> feature. This mode will log each several infos in <em>LOG_DAEMON</em> with priority <em>LOG_INFO.</em> This is useful if you want to see exactly what happened until the watchdog rebooted the system. Currently it logs the temperature (if available), the load average, the change date of the files it checks and how often it went to sleep.</p>
  </dd>
  <dt>
    <p><strong>-s</strong>, <strong>--sync</strong></p>
  </dt>
  <dd>
    <p>Try to synchronize the filesystem every time the process is awake. Note that the system is rebooted if for any reason the synchronizing lasts longer than a minute.</p>
  </dd>
  <dt>
    <p><strong>-b</strong>, <strong>--softboot</strong></p>
  </dt>
  <dd>
    <p>Soft-boot the system if an error occurs during the main loop, e.g. if a given file is not accessible via the <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> call. Note that this does not apply to the opening of <em>/dev/watchdog</em> and <em>/proc/loadavg</em>, which are opened before the main loop starts.</p>
  </dd>
  <dt>
    <p><strong>-F</strong>, <strong>--foreground</strong></p>
  </dt>
  <dd>
    <p>Run in foreground mode, useful for running under systemd (for example).</p>
  </dd>
  <dt>
    <p><strong>-f</strong>, <strong>--force</strong></p>
  </dt>
  <dd>
    <p>Force the usage of the interval given or the maximal load average given in the config file. Without this option these values are sanity checked.</p>
  </dd>
  <dt>
    <p><strong>-c</strong> <em>config-file</em>, <strong>--config-file</strong> <em>config-file</em></p>
  </dt>
  <dd>
    <p>Use <em>config-file</em> as the configuration file instead of the default <em>/etc/watchdog.conf</em>.</p>
  </dd>
  <dt>
    <p><strong>-q</strong>, <strong>--no-action</strong></p>
  </dt>
  <dd>
    <p>Do not reboot or halt the machine. This is for testing purposes. All checks are executed and the results are logged as usual, but no action is taken. Also your hardware card or the kernel software watchdog driver is not enabled. Temperature checking is also disabled since this triggers the hardware watchdog on some cards.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTION</h2>
        <div class="sectioncontent">
<p>After <strong>watchdog</strong> starts, it puts itself into the background and then tries all checks specified in its configuration file in turn. Between each two tests it will write to the kernel device to prevent a reset. After finishing all tests watchdog goes to sleep for some time. The kernel drivers expects a write to the watchdog device every minute. Otherwise the system will be reset. <strong>watchdog</strong> will sleep for a configure interval that defaults to 1 second to make sure it triggers the device early enough.</p><p>Under high system load <strong>watchdog</strong> might be swapped out of memory and may fail to make it back in in time. Under these circumstances the Linux kernel will reset the machine. To make sure you won't get unnecessary reboots make sure you have the variable <em>realtime</em> set to <em>yes</em> in the configuration file <em>watchdog.conf</em>. This adds real time support to <strong>watchdog</strong>: it will lock itself into memory and there should  be no problem even under the highest of loads.</p><p>On system running out of memory the kernel will try to free enough memory by killing process. The <strong>watchdog</strong> daemon itself is exempted from this so-called out-of-memory killer.</p><p>Also you can specify a maximal allowed load average. Once this load average is reached the system is rebooted. You may specify maximal load averages for 1 minute, 5 minutes or 15 minutes. The default values is to disable this test. Be careful not to set this parameter too low. To set a value less then the predefined minimal value of 2, you have to use the <strong>-f</strong> option.</p><p>You can also specify a minimal amount of virtual memory you want to have available as free. As soon as more virtual memory is used action is taken by <strong>watchdog</strong>. Note, however, that watchdog does not distinguish between different types of memory usage. It just checks for free virtual memory.</p><p>If you have a watchdog card with temperature sensor you can specify the maximal allowed temperature. Once this temperature is reached the system is halted. The default value is 120. There is no unit conversion so make sure you use the same unit as your hardware. <strong>watchdog</strong> will issue warnings once the temperature increases 90%, 95% and 98% of this temperature.</p><p>When using file mode <strong>watchdog</strong> will try to <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> the given files. Errors returned by stat will <strong>not</strong> cause a reboot. For a reboot the stat call has to last at least one minute. This may happen if the file is located on an NFS mounted filesystem. If your system relies on an NFS mounted filesystem you might try this option. However, in such a case the <em>sync</em> option may not work if the NFS server is not answering.</p><p><strong>watchdog</strong> can read the pid from a pid file and see whether the process still exists. If not, action is taken by <strong>watchdog</strong>. So you can for instance restart the server from your <em>repair-binary</em>.</p><p><strong>watchdog</strong> will try periodically to fork itself to see whether the process table is full. This process will leave a zombie process until watchdog wakes up again and catches it; this is harmless, don't worry about it.</p><p>In ping mode <strong>watchdog</strong> tries to ping the given IP addresses. These addresses do not have to be a single machine. It is possible to ping to a broadcast address instead to see if at least one machine in a subnet is still living.</p><p><strong>Do not use this broadcast ping unless your MIS person a) knows about it and</strong> <strong>b) has given you explicit permission to use it!</strong></p><p><strong>watchdog</strong> will send out three ping packages and wait up to &lt;interval&gt; seconds for the reply with &lt;interval&gt; being the time it goes to sleep between two times triggering the watchdog device. Thus a unreachable network will not cause a hard reset but a soft reboot.</p><p>You can also test passively for an unreachable network by just monitoring a given interface for traffic. If no traffic arrives the network is considered unreachable causing a soft reboot or action from the repair binary.</p><p><strong>watchdog</strong> can run an external command for user-defined tests. A return code not equal 0 means an error occurred and watchdog should react. If the external command is killed by an uncaught signal this is considered an error by watchdog too. The command may take longer than the time slice defined for the kernel device without a problem. However, error messages are generated into the syslog facility. If you have enabled softboot on error the machine will be rebooted if the binary doesn't exit in half the time <strong>watchdog</strong> sleeps between two tries triggering the kernel device.</p><p>If you specify a repair binary it will be started instead of shutting down the system. If this binary is not able to fix the problem <strong>watchdog</strong> will still cause a reboot afterwards.</p><p>If the machine is halted an email is sent to notify a human that the machine is going down. Starting with version 4.4 <strong>watchdog</strong> will also notify the human in charge if the machine is rebooted.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOFT REBOOT</h2>
        <div class="sectioncontent">
<p>A soft reboot (i.e. controlled shutdown and reboot) is initiated for every error that is found. Since there might be no more processes available, watchdog does it all by himself. That means:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>Kill all processes with SIGTERM.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>After a short pause kill all remaining processes with SIGKILL.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>Record a shutdown entry in wtmp.</p>
  </dd>
  <dt>
    4.
  </dt>
  <dd>
    <p>Save the random seed from <em>/dev/urandom</em>. If the device is non-existant or there is no filename for saving this step is skipped.</p>
  </dd>
  <dt>
    5.
  </dt>
  <dd>
    <p>Turn off accounting.</p>
  </dd>
  <dt>
    6.
  </dt>
  <dd>
    <p>Turn off quota and swap.</p>
  </dd>
  <dt>
    7.
  </dt>
  <dd>
    <p>Unmount all partitions except the root partition.</p>
  </dd>
  <dt>
    8.
  </dt>
  <dd>
    <p>Remount the root partition read-only.</p>
  </dd>
  <dt>
    9.
  </dt>
  <dd>
    <p>Shut down all network interfaces.</p>
  </dd>
  <dt>
    10.
  </dt>
  <dd>
    <p>Finally reboot.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CHECK BINARY</h2>
        <div class="sectioncontent">
<p>If the return code of the check binary is not zero <strong>watchdog</strong> will assume an error and reboot the system. Be careful with this if you are using the real-time properties of watchdog since <strong>watchdog</strong> will wait for the return of this binary before proceeding. An exit code smaller than 245 is interpreted as an system error code (see <em>errno.h</em> for details). Values of 245 or larger than are special to <strong>watchdog</strong>:</p>
<dl class='dl-vertical'>
  <dt>
    <p>255 (based on -1 as unsigned 8-bit number)</p>
  </dt>
  <dd>
    <p>Reboot the system. This is not exactly an error message but a command to <strong>watchdog</strong>. If the return code is this the <strong>watchdog</strong> will not try to run a shutdown script instead.</p>
  </dd>
  <dt>
    <p>254</p>
  </dt>
  <dd>
    <p>Reset the system. This is not exactly an error message but a command to <strong>watchdog</strong>. If the return code is this the <strong>watchdog will simply refuse to write the</strong> kernel device again.</p>
  </dd>
  <dt>
    <p>253</p>
  </dt>
  <dd>
    <p>Maximum load average exceeded.</p>
  </dd>
  <dt>
    <p>252</p>
  </dt>
  <dd>
    <p>The temperature inside is too high.</p>
  </dd>
  <dt>
    <p>251</p>
  </dt>
  <dd>
    <p><em>/proc/loadavg</em> contains no (or not enough) data.</p>
  </dd>
  <dt>
    <p>250</p>
  </dt>
  <dd>
    <p>The given file was not changed in the given interval.</p>
  </dd>
  <dt>
    <p>249</p>
  </dt>
  <dd>
    <p><em>/proc/meminfo</em> contains invalid data.</p>
  </dd>
  <dt>
    <p>248</p>
  </dt>
  <dd>
    <p>Child process was killed by a signal.</p>
  </dd>
  <dt>
    <p>247</p>
  </dt>
  <dd>
    <p>Child process did not return in time.</p>
  </dd>
  <dt>
    <p>246</p>
  </dt>
  <dd>
    <p>Free for personal watchdog-specific use (was -10 as an unsigned 8-bit number).</p>
  </dd>
  <dt>
    <p>245</p>
  </dt>
  <dd>
    <p>Reserved for an unknown result, for example a slow background test that is still running so neither a success nor an error.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPAIR BINARY</h2>
        <div class="sectioncontent">
<p>The repair binary is started with one parameter: the error number that caused <strong>watchdog</strong> to initiate the boot process. After trying to repair the system the binary should exit with 0 if the system was successfully repaired and thus there is no need to boot anymore. A return value not equal 0 tells <strong>watchdog</strong> to reboot. The return code of the repair binary should be the error number of the error causing <strong>watchdog</strong> to reboot. Be careful with this if you are using the real-time properties since <strong>watchdog</strong> will wait for the return of this binary before proceeding.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TEST DIRECTORY</h2>
        <div class="sectioncontent">
<p>Executables placed in the test directory are discovered by watchdog on startup and are automatically executed.  They are bounded time-wise by the test-timeout directive in watchdog.conf.</p><p>These executables are called with either "test" as the first argument (if a test is being performed) or "repair" as the first argument (if a repair for a previously-failed "test" operation on is being performed).</p><p>The as with test binaries and repair binaries, expected exit codes for a successful test or repair operation is always zero.</p><p>If an executable's test operation fails, the same executable is automatically called with the "repair" argument as well as the return code of the previously-failed test operation.</p><p>For example, if the following execution returns 42:</p>
<pre>
    /etc/watchdog.d/my-test test
</pre>
<p>The watchdog daemon will attempt to repair the problem by calling:</p>
<pre>
    /etc/watchdog.d/my-test repair 42
</pre>
<p>This enables administrators and application developers to make intelligent test/repair commands.  If the "repair" operation is not required (or is not likely to succeed), it is important that the author of the command return a non-zero value so the machine will still reboot as expected.</p><p>Note that the watchdog daemon may interpret and act upon any of the reserved return codes noted in the Check Binary section prior to calling a given command in "repair" mode.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>None known so far.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>The original code is an example written by Alan Cox &lt;alan@lxorguk.ukuu.org.uk&gt;, the author of the kernel driver. All additions were written by Michael Meskes &lt;meskes@debian.org&gt;. Johnie Ingram &lt;johnie@netgod.net&gt; had the idea of testing the load average. He also took over the Debian specific work. Dave Cinege &lt;dcinege@psychosis.com&gt; brought up some hardware watchdog issues and helped testing this stuff.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>/dev/watchdog</em></p>
  </dt>
  <dd>
    <p>The watchdog device.</p>
  </dd>
  <dt>
    <p><em>/var/run/watchdog.pid</em></p>
  </dt>
  <dd>
    <p>The pid file of the running <strong>watchdog</strong>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO watchdog&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/watchdog.conf.5.html"><strong>watchdog.conf</strong>(5)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="watchcatd.8.html"><span aria-hidden="true">&larr;</span> watchcatd.8: Process monitoring daemon</a></li>
   <li class="next"><a href="watchquagga.8.html">watchquagga.8: A program to monitor the status of quagga daemons <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
