<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>makeuserdb: Create /etc/courier/userdb</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Create /etc/courier/userdb">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="makeuserdb (8) manual">
  <meta name="twitter:description" content="Create /etc/courier/userdb">
  <meta name="twitter:image" content="https://www.carta.tech/images/courier-authlib-userdb-makeuserdb-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/makeuserdb.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="makeuserdb (8) manual" />
  <meta property="og:description" content="Create /etc/courier/userdb" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/courier-authlib-userdb-makeuserdb-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">makeuserdb<small> (8)</small></h1>
        <p class="lead">Create /etc/courier/userdb</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/makeuserdb.8.html">
      <span itemprop="name">makeuserdb: Create /etc/courier/userdb</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/courier-authlib-userdb/">
      <span itemprop="name">courier-authlib-userdb</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/makeuserdb.8.html">
      <span itemprop="name">makeuserdb: Create /etc/courier/userdb</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>makeuserdb</strong> [-f&nbsp;<em>filename</em>] <strong>pw2userdb</strong> <strong>vchkpw2userdb</strong> [--vpopmailhome=<em>dir</em>] [--todir=<em>dir</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>makeuserdb</strong> creates /etc/courier/userdb.dat from the contents of /etc/courier/userdb. /etc/courier/userdb&apos;s contents are described later in this document. Maildrop, Courier, and other applications use /etc/courier/userdb.dat as a substitute/complement for your system password file. The usual purpose for /etc/courier/userdb.dat is to specify "virtual" accounts - accounts that do not have an associated system login. Usually (but not necessarily) all virtual accounts share the same system userid. /etc/courier/userdb.dat may also replace your system password file. Because the system password file is a text file, when there&apos;s a large number of accounts it will be significantly faster to search @userdb.dat@, which is a binary database, instead of a flat text file that the system password file usually is.</p><p>The <strong>makeuserdb</strong> command can be safely executed during normal system activity.</p><p>The <strong>-f</strong> option creates <em>filename</em>.dat from <em>filename</em>, instead of the default /etc/courier/userdb.dat from /etc/courier/userdb.</p><h3>Format of /etc/courier/userdb</h3>
<p>/etc/courier/userdb is a plain text file that can be created using any text editor. Blank lines are ignored. Lines that start with the # character are comments, and are also ignored. Other lines define properties of a single "account", one line per account. /etc/courier/userdb may be a directory instead of a plain file. In that case all files in /etc/courier/userdb are essentially concatenated, and are treated as a single file. Each line takes the following format:</p>
<pre>
<em>name</em>&lt;TAB&gt;<em>field</em>=<em>value</em>|<em>field</em>=<em>value</em>...
</pre>
<p><em>name</em> is the account name. <em>name</em> MUST contain only lowercase characters If Courier is configured to treat lowercase and uppercase account names as identical, <em>name</em> is followed by exactly one tab character, then a list of field/value pairs separated by vertical slashes. <em>field</em> is the name of the field, <em>value</em> is the field value. Fields and values themself cannot contain slashes or control characters. Fields may be specified in any order. Here are all the currently defined fields. Note that not every field is used by every application that reads /etc/courier/userdb.dat.</p><p><em>uid</em> - <em>value</em> is a (possibly) unique numerical user ID for this account.</p><p><em>gid</em> - <em>value</em> is a (possibly) unique numerical group ID for this account.</p><p><em>home</em> - <em>value</em> is the account&apos;s home directory.</p><p><em>shell</em> - <em>value</em> is the account&apos;s default login shell.</p><p><em>systempw</em> - <em>value</em> is the account&apos;s password. See \m[blue]<strong></strong><a href="../man8/userdbpw.8.html"><strong>userdbpw</strong>(8)</a>\m[]\s-2\u[1]\d\s+2 for details on how to set up this field.</p><p><em>pop3pw, esmtppw, imappw...</em> - <em>value</em> specifies a separate password used only for authenticating access using a specific service, such as POP3, IMAP, or anything else. If not defined, <em>systempw</em> is always used. This allows access to an account to be restricted only to certain services, such as POP3, even if other services are also enabled on the server.</p><p><em>mail</em> - <em>value</em> specifies the location of the account&apos;s Maildir mailbox. This is an optional field that is normally used when <strong>userdb</strong> is used to provide aliases for other mail accounts. For example, one particular multi-domain E-mail service configuration that&apos;s used by both Qmail and Courier servers is to deliver mail for a mailbox in a virtual domain, such as "user@example.com", to a local mailbox called "example-user". Instead of requiring the E-mail account holder to log in as "example-user" to download mail from this account, a <strong>userdb</strong> entry for "user@example.com" is set up with <em>mail</em> set to the location of example-user&apos;s Maildir mailbox, thus hiding the internal mail configuration from the E-mail account holder&apos;s view.</p><p><em>quota</em> - <em>value</em> specifies the maildir quota for the account&apos;s Maildir. This has nothing to do with actual filesystem quotas. Courier has a software-based Maildir quota enforcement mechanism which requires additional setup and configuration. See \m[blue]<strong></strong><strong>maildirquota</strong>(7)\m[]\s-2\u[2]\d\s+2 for additional information.</p>
<h3>/etc/courier/userdbshadow.dat</h3>
<p>All fields whose name ends with &apos;pw&apos; will NOT copied to /etc/courier/userdb.dat. These fields will be copied to /etc/courier/userdbshadow.dat. <strong>makeuserdb</strong> creates /etc/courier/userdbshadow.dat without any group and world permissions. Note that <strong>makeuserdb</strong> reports an error if <strong>/etc/courier/userdb</strong> has any group or world permissions.</p>
<h3>CONVERTING /etc/passwd and vpopmail to /etc/courier/userdb format</h3>
<p><strong>pw2userdb</strong> reads the /etc/passwd and /etc/shadow files and converts all entries to the /etc/courier/userdb format, printing the result on standard output. The output of <strong>pw2userdb</strong> can be saved as <strong>/etc/courier/userdb</strong> (or as some file in this subdirectory). Linear searches of /etc/passwd can be very slow when you have tens of thousands of accounts. Programs like <strong>maildrop</strong> always look in /etc/courier/userdb first. By saving the system password file in /etc/courier/userdb it is possible to significantly reduce the amount of time it takes to look up this information.</p><p>After saving the output of <strong>pw2userdb</strong>, you must still run <strong>makeuserdb</strong> to create /etc/courier/userdb.dat.</p><p><strong>vchkpw2userdb</strong> converts a vpopmail-style directory hierarchy to the /etc/courier/userdb format. This is an external virtual domain management package that&apos;s often used with Qmail servers.</p><p>Generally, an account named &apos;vpopmail&apos; is reserved for this purpose. In that account the file users/vpasswd has the same layout as /etc/passwd, and performs a similar function, except that all userid in users/vpasswd have the same userid. Additionally, the domains subdirectory stores virtual accounts for multiple domains. For example, domains/example.com/vpasswd has the passwd file for the domain <em>example.com</em>. Some systems also have a soft link, <em>domains/default</em>, that points to a domain that&apos;s considered a "default" domain.</p><p>The <strong>vchkpw2userdb</strong> reads all this information, and tries to convert it into the /etc/courier/userdb format. The <em>--vpopmailhost</em> option specifies the top level directory, if it is not the home directory of the vpopmail account.</p><p>The <strong>vchkpw2userdb</strong> script prints the results on standard output. If specified, the <em>--todir</em> option tries to convert all vpasswd files one at a time, saving each one individually in <em>dir</em>. For example:</p>
<pre>
mkdir /etc/courier/userdb
vchkpw2userdb --todir=/etc/courier/userdb/vpopmail
makeuserdb
</pre>
<p>It is still necessary to run <strong>makeuserdb</strong>, of course, to create the binary database file /etc/courier/userdb.dat</p><p>NOTE: You are still required to create the <strong>/etc/courier/userdb</strong> entry which maps system userids back to accounts, "<em>uid</em>=&lt;TAB&gt;<em>name</em>", if that&apos;s applicable. <strong>vchkpw2userdb</strong> will not do it for you.</p><p>NOTE: <strong>makeuserdb</strong> may complain about duplicate entries, if your "default" entries in users/vpasswd or domains/default/vpasswd are the same as anything in any other /etc/courier/userdb file. It is also likely that you&apos;ll end up with duplicate, but distinct, entries for every account in the default domain. For example, if your default domain is example.com, you&apos;ll end up with duplicate entries - you&apos;ll have entries for both <em>user</em> and <em>user@example.com</em>.</p><p>If you intend to maintain the master set of accounts using vchkpw/vpopmail, in order to avoid cleaning this up every time, you might want to consider doing the following: run <strong>vchkpw2userdb</strong> once, using the <em>--todir</em> option. Then, go into the resulting directory, and replace one of the redundant files with a soft link to /dev/null. This allows you to run <strong>vchkpw2userdb</strong> without having to go in and cleaning up again, afterwards.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<pre>
/etc/courier/userdb
/etc/courier/userdb.dat
/etc/courier/userdbshadow.dat
/etc/courier/userdb.tmp - temporary file
/etc/courier/userdbshadow.tmp - temporary file
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p><strong>makeuserdb</strong> is a Perl script, and uses Perl&apos;s portable locking. Perl&apos;s documentation notes that certain combinations of locking options may not work with some networks.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO makeuserdb&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong></strong><a href="../man8/userdb.8.html"><strong>userdb</strong>(8)</a>\m[]\s-2\u[3]\d\s+2, \m[blue]<strong></strong><strong>maildrop</strong>(8)\m[]\s-2\u[4]\d\s+2, \m[blue]<strong></strong><a href="../man8/courier.8.html"><strong>courier</strong>(8)</a>\m[]\s-2\u[5]\d\s+2, \m[blue]<strong></strong><strong>maildirquota</strong>(7)\m[]\s-2\u[2]\d\s+2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p><a href="../man8/userdbpw.8.html"><strong>userdbpw</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/userdbpw.html</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p><strong>maildirquota</strong>(7)</p><p>[set $man.base.url.for.relative.links]/maildirquota.html</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p><a href="../man8/userdb.8.html"><strong>userdb</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/userdb.html</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p><strong>maildrop</strong>(8)</p><p>[set $man.base.url.for.relative.links]/maildrop.html</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><a href="../man8/courier.8.html"><strong>courier</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courier.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="makesmtpaccess-msa.8.html"><span aria-hidden="true">&larr;</span> makesmtpaccess-msa.8: Build esmtp server access file</a></li>
   <li class="next"><a href="makeuucpneighbors.8.html">makeuucpneighbors.8: Sample courier mail filter <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
