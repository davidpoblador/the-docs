<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>vzmigrate: Migrate a container between two openvz servers</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Migrate a container between two openvz servers">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="vzmigrate (8) manual">
  <meta name="twitter:description" content="Migrate a container between two openvz servers">
  <meta name="twitter:image" content="https://www.carta.tech/images/vzctl-vzmigrate-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/vzmigrate.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="vzmigrate (8) manual" />
  <meta property="og:description" content="Migrate a container between two openvz servers" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/vzctl-vzmigrate-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">vzmigrate<small> (8)</small></h1>
        <p class="lead">Migrate a container between two openvz servers</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vzmigrate.8.html">
      <span itemprop="name">vzmigrate: Migrate a container between two openvz servers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/vzctl/">
      <span itemprop="name">vzctl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vzmigrate.8.html">
      <span itemprop="name">vzmigrate: Migrate a container between two openvz servers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>&#92;$1</strong> <em>destination_address CTID</em> <strong>-h</strong>|<strong>--help</strong>|<strong>--usage</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This utility is used to migrate a container from one (source) Hardware Node (HN) to another (destination) HN. The utility can migrate either stopped or running container. For a stopped container, simple CT private area transfer is performed (<a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a> is used for file transfer). For running containers, either traditional (with CT stop and start) or live migration is possible.</p><p>This program uses <strong>ssh</strong> as a transport layer. You will need to put ssh public key to destination node and be able to connect to node without entering password.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-r</strong>, <strong>--remove-area</strong> <strong>yes</strong> | <strong>no</strong></p>
  </dt>
  <dd>
    <p>Whether to remove a container area on source HN for the successfully migrated container. Default is <strong>yes</strong>.</p>
  </dd>
  <dt>
    <p><strong>--ssh=</strong><em>options</em></p>
  </dt>
  <dd>
    <p>Additional <em>options</em> that will be passed to ssh while establishing connection to destination HN.</p>
  </dd>
  <dt>
    <p><strong>--ssh-mux</strong></p>
  </dt>
  <dd>
    <p>Enable ssh channel multiplexing, establishing and reusing a single ssh connection to remote server. This speeds up live migration.</p>
  </dd>
  <dt>
    <p><strong>--rsync=</strong><em>options</em></p>
  </dt>
  <dd>
    <p>Additional <em>options</em> that will be passed to <strong>rsync</strong>(8). You may add options like <strong>-z</strong> to enable data compression if you are migrating over a slow link.</p>
  </dd>
  <dt>
    <p><strong>--keep-dst</strong></p>
  </dt>
  <dd>
    <p>Do not clean synced destination container private area in case of some error. It makes sense to use this option on big container migration to avoid syncing container private area again in case some error (on container stop for example) occurs during first migration attempt.</p>
  </dd>
  <dt>
    <p><strong>--live</strong></p>
  </dt>
  <dd>
    <p>Perform live migration: instead of restarting a container, checkpoint and restore are used, so there is no container downtime or service interruption. Additional steps are performed to minimize the time when a container is in suspended state. Option <strong>--online</strong> can be used as a backward-compatible alias.</p>
  </dd>
  <dt>
    <p><strong>-c</strong>, <strong>--compact</strong></p>
  </dt>
  <dd>
    <p>Compact a container image (i.e. run <strong>vzctl compact</strong>) before migration. Works for ploop only, ignored otherwise.</p>
  </dd>
  <dt>
    <p><strong>-s</strong>, <strong>--snapshot</strong></p>
  </dt>
  <dd>
    <p>Create a container snapshot (i.e. run <strong>vzctl snapshot</strong>) before migration. Works for ploop only, ignored otherwise.</p>
  </dd>
  <dt>
    <p><strong>--check-only</strong>, <strong>--dry-run</strong></p>
  </dt>
  <dd>
    <p>Do not perform actual migration, stop after preliminary checks. This is used to check if a CT can possibly be migrated. Combine with <strong>--live</strong> to enable more checks for live migration case.</p>
  </dd>
  <dt>
    <p><strong>-f</strong>|<strong>--nodeps</strong>[<strong>=</strong><em>check</em>[<strong>,</strong><em>check</em>&nbsp;...\]\]</p>
  </dt>
  <dd>
    <p>Continue migration, ignoring some or all preliminary check failures. Particular checks can be ignored by providing an argument to <strong>--nodeps</strong> option. The following options can be used (comma-separated):</p><p>&bull; <strong>cpu</strong>	- ignore cpu capabilities check;</p><p>&bull; <strong>ipv6</strong>	- ignore ipv6 module check.</p>
  </dd>
  <dt>
    <p><strong>-t</strong>, <strong>--times</strong></p>
  </dt>
  <dd>
    <p>At the end of live migration, output various timings for migration stages that affect total suspended CT time. Note that it only makes sense with <strong>--live</strong>.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Verbose mode. Causes <strong>vzmigrate</strong> to print debugging messages about its progress. Note that <strong>-v</strong> automatically implies <strong>-t</strong>. Multiple <strong>-v</strong> options increase the verbosity.</p>
  </dd>
  <dt>
    <p><strong>-h</strong>|<strong>--help</strong>|<strong>--usage</strong></p>
  </dt>
  <dd>
    <p>Print usage info and exit.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Migration of CT 101 to <strong>192.168.1.130</strong> with downtime:</p>
<pre>
   vzmigrate 192.168.1.130 101
</pre>
<p>Online migration of CT 102 to <strong>192.168.1.130</strong>:</p>
<pre>
   vzmigrate --live 192.168.1.130 102
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>0 EXIT_OK</strong></p>
  </dt>
  <dd>
    <p>Command completed successfully.</p>
  </dd>
  <dt>
    <p><strong>1 EXIT_USAGE</strong></p>
  </dt>
  <dd>
    <p>Bad command line options.</p>
  </dd>
  <dt>
    <p><strong>2 EXIT_VE_STOPPED</strong></p>
  </dt>
  <dd>
    <p>Container is stopped.</p>
  </dd>
  <dt>
    <p><strong>4 EXIT_CONNECT</strong></p>
  </dt>
  <dd>
    <p>Can't connect to destination (source) HN.</p>
  </dd>
  <dt>
    <p><strong>6 EXIT_COPY</strong></p>
  </dt>
  <dd>
    <p>Container private area copying/moving failed.</p>
  </dd>
  <dt>
    <p><strong>7 EXIT_VE_START</strong></p>
  </dt>
  <dd>
    <p>Can't start or restore destination CT.</p>
  </dd>
  <dt>
    <p><strong>8 EXIT_VE_STOP</strong></p>
  </dt>
  <dd>
    <p>Can't stop or checkpoint source CT.</p>
  </dd>
  <dt>
    <p><strong>9 EXIT_EXISTS</strong></p>
  </dt>
  <dd>
    <p>Container already exists on destination HN.</p>
  </dd>
  <dt>
    <p><strong>10 EXIT_NOTEXIST</strong></p>
  </dt>
  <dd>
    <p>Container does not exists on source HN.</p>
  </dd>
  <dt>
    <p><strong>12 EXIT_IP_INUSE</strong></p>
  </dt>
  <dd>
    <p>You attempt to migrate CT which IP address(es) are already in use on the destination node.</p>
  </dd>
  <dt>
    <p><strong>13 EXIT_QUOTA</strong></p>
  </dt>
  <dd>
    <p>Operation with CT quota failed.</p>
  </dd>
  <dt>
    <p><strong>14 EXIT_OVZ_NOT_RUNNING</strong></p>
  </dt>
  <dd>
    <p>OpenVZ is not running, or some required kernel modules are not loaded.</p>
  </dd>
  <dt>
    <p><strong>15 EXIT_APPLY_CONFIG</strong></p>
  </dt>
  <dd>
    <p>Unable to set CT name on destination node.</p>
  </dd>
  <dt>
    <p><strong>16 EXIT_PLOOP_UNSUP</strong></p>
  </dt>
  <dd>
    <p>Ploop is not supported by destination node.</p>
  </dd>
  <dt>
    <p><strong>17 EXIT_UNSUP_CPT_VER</strong></p>
  </dt>
  <dd>
    <p>CPT version incompatibility with the destination node.</p>
  </dd>
  <dt>
    <p><strong>18 EXIT_UNSUP_CPU</strong></p>
  </dt>
  <dd>
    <p>Destination node CPU incompatibility.</p>
  </dd>
  <dt>
    <p><strong>19 EXIT_CANT_READ_REMOTE_CONFIG</strong></p>
  </dt>
  <dd>
    <p>Unable to read remote vz.conf.</p>
  </dd>
  <dt>
    <p><strong>20 EXIT_LOCKED</strong></p>
  </dt>
  <dd>
    <p>Can't lock container (already locked).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO vzmigrate&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>, <a href="../man8/vzcptcheck.8.html"><strong>vzcptcheck</strong>(8)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2001-2013, Parallels, Inc. Licensed under GNU GPL.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="vzmemcheck.8.html"><span aria-hidden="true">&larr;</span> vzmemcheck.8: Show information about host memory parameters</a></li>
   <li class="next"><a href="vznnc.8.html">vznnc.8: Run a program connected to a socket <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
