<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dirvish: Disk based virtual image network backup system</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Disk based virtual image network backup system">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dirvish (8) manual">
  <meta name="twitter:description" content="Disk based virtual image network backup system">
  <meta name="twitter:image" content="https://www.carta.tech/images/dirvish-dirvish-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/dirvish.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dirvish (8) manual" />
  <meta property="og:description" content="Disk based virtual image network backup system" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dirvish-dirvish-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dirvish<small> (8)</small></h1>
        <p class="lead">Disk based virtual image network backup system</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dirvish.8.html">
      <span itemprop="name">dirvish: Disk based virtual image network backup system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dirvish/">
      <span itemprop="name">dirvish</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dirvish.8.html">
      <span itemprop="name">dirvish: Disk based virtual image network backup system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dirvish -\^-vault</strong> <em>vault</em> [ <em>OPTIONS</em> ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Create a backup image of a client directory tree.</p><p>Each image is a directory containing transfer <strong>log,</strong> <strong>summary,</strong> <strong>tree</strong> and if transfer errors were detected an <strong>rsync_error</strong> file. The transfer <strong>log</strong> retains the the output of any pre and post processing commands and the rsync log listing all files that were changed or added with some statistical information. The <strong>summary</strong> file contains all the information about how the image was created and meta-data for managing the image in config file format. Tree is the copy of the client tree.</p><p>The client directory tree is compared with an existing image to create a new image. Unchanged files are shared between images. For changed files only those parts that actually change are transfered over the network. Unchanged portions of files are copied from the reference image.</p><p>The resulting images contain complete copies of the original trees preserving ownership and file permissions. In this way even though the backups are made incrementally, each image can be used independently for restores or to make removable-media off-site copies or archives.</p><p>The removal of an image will have no effect on other images.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Each option on the command line may be specified any number of times. Those options that support lists in the config files will accumulate all of their arguments otherwise each specification will override the ones before.</p><p>As configuration files are loaded they may override options on the command line.</p><p>Each option may be unambiguously abbreviated.</p>
<dl class='dl-vertical'>
  <dt>
    <p>&#92;.BI \*d&#92;$1 " &#92;$2"</p>
  </dt>
  <dd>
    <p>Specify a branch to use.</p><p>A branch is a sequence of images.</p><p>If a vault has been specified either here or with &#92;.B \*d&#92;$1 the first time this option is used it will attempt to load the config file <em>branch_name</em> or <em>branch_name</em><strong>.conf</strong> from the vault.</p>
  </dd>
  <dt>
    <p>Load options from the specified file.</p>
  </dt>
  <dd>
    <p>If this precedes the option will not load it's own config file.</p><p>If vault has been set and <em>config-file</em> is a bare filename the presence of one in the vault will take precedence over one in the current directory. To specify one in the current directory after use <strong>./</strong> to precede the name.</p><p>The master configuration file will be read prior to processing options.</p>
  </dd>
  <dt>
    <p>Specify a time for the image to expire.</p>
  </dt>
  <dd>
    <p>See <strong>&#92;$1</strong> for details.</p><p>This does not actually expire anything. What it does do is add an <strong>Expire:</strong> field to the image summary file containing an absolute time so that a <strong>dirvish-expire</strong> or another tool outside of dirvish can decide when to remove old images.</p>
  </dd>
  <dt>
    <p>Specify a name for the image.</p>
  </dt>
  <dd>
    <p><em>image_name</em> is passed through <strong>POSIX::strftime</strong></p>
  </dd>
  <dt>
    <p>Time to use when creating the image name.</p>
  </dt>
  <dd>
    <p>If an absolute time without a date is provided it will be forced into the past. If this isn't set the current time will be used.</p>
  </dd>
  <dt>
    <p>Create an initial image.</p>
  </dt>
  <dd>
    <p>Create the image entirely from the source tree without the use of a reference image.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>Don't actually do anything.</p>
  </dt>
  <dd>
    <p>Process all configuration files, options and tests then produce a summary/configuration file on standard output and exit.</p>
  </dd>
  <dt>
    <p>Specify an existing image or a branch from which to create the new image.</p>
  </dt>
  <dd>
    <p>If a branch_name is specified, the last existing image from its history file will be used. A branch will take precedence over an image of the same name.</p>
  </dd>
  <dt>
    <p>Reset the values in an accumulating</p>
  </dt>
  <dd>
    <p><em>option</em>.</p>
  </dd>
  <dt>
    <p>&#92;.B \*d&#92;$1 " &#92;$2"</p>
  </dt>
  <dd>
    <p>Specify summary format.</p><p>A short summary will only include final used values. A long summary will include all configuration values.</p><p>Default value: <strong>&#92;$1</strong></p>
  </dd>
  <dt>
    <p>Specify the vault to store the image in.</p>
  </dt>
  <dd>
    <p>If not preceeded by this will attempt to load the config file <strong>default</strong> or <strong>default.conf</strong> within the <em>vault</em>.</p><p>If <em>branch_name</em> is specified here this will behave exactly like the option and <em>branch_name</em> or <em>branch_name</em>.conf will be attempted instead of <strong>default.conf</strong>.</p>
  </dd>
  <dt>
    <p>Print version string and exit.</p>
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT CODES</h2>
        <div class="sectioncontent">
<p>To facilitate further automation and integration of <strong>dirvish</strong> with other tools <strong>dirvish</strong> provides rationalised exit codes. The exit codes are range based.  While the code for a specific error may change from one version to another it will remain within the specified range.  So don't test for specific exit codes but instead test for a range of values. To the degree possible higher value ranges indicate more severe errors.</p>
<dl class='dl-vertical'>
  <dt>
    <p>0</p>
  </dt>
  <dd>
    <p>success</p>
  </dd>
  <dt>
    <p>1-19</p>
  </dt>
  <dd>
    <p>The backup job reported warnings.</p>
  </dd>
  <dt>
    <p>20-39</p>
  </dt>
  <dd>
    <p>An error occurred during index generation and cleanup.</p>
  </dd>
  <dt>
    <p>40-49</p>
  </dt>
  <dd>
    <p>A post-client or post-server command could not be run.</p>
  </dd>
  <dt>
    <p>50-59</p>
  </dt>
  <dd>
    <p>The post-client command reported an error. Its exit code modulo 10 is added to 50</p>
  </dd>
  <dt>
    <p>60-69</p>
  </dt>
  <dd>
    <p>The post-server command reported an error. Its exit code modulo 10 is added to 60</p>
  </dd>
  <dt>
    <p>70-79</p>
  </dt>
  <dd>
    <p>A post-client or post-server command could not be run.</p>
  </dd>
  <dt>
    <p>80-89</p>
  </dt>
  <dd>
    <p>The pre-server command reported an error. Its exit code modulo 10 is added to 80</p>
  </dd>
  <dt>
    <p>90-99</p>
  </dt>
  <dd>
    <p>The pre-server command reported an error. Its exit code modulo 10 is added to 90</p>
  </dd>
  <dt>
    <p>100-149</p>
  </dt>
  <dd>
    <p>Rsync encountered a non-fatal error.</p>
  </dd>
  <dt>
    <p>150-199</p>
  </dt>
  <dd>
    <p>Rsync encountered a fatal error.</p>
  </dd>
  <dt>
    <p>200-219</p>
  </dt>
  <dd>
    <p>An error was encountered in loading a configuration file.</p>
  </dd>
  <dt>
    <p>220-254</p>
  </dt>
  <dd>
    <p>An error was detected in the configuration.</p>
  </dd>
  <dt>
    <p>255</p>
  </dt>
  <dd>
    <p>Incorrect usage.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>/etc/dirvish/master.conf</strong></p>
  </dt>
  <dd>
    <p>alternate master configuration file.</p>
  </dd>
  <dt>
    <p><strong>/etc/dirvish.conf</strong></p>
  </dt>
  <dd>
    <p>master configuration file.</p>
  </dd>
  <dt>
    <p><strong>/etc/dirvish/</strong><em>client</em><strong>[.conf]</strong></p>
  </dt>
  <dd>
    <p>client configuration file.</p>
  </dd>
  <dt>
    <p><em>bank/vault/</em><strong>dirvish/default[.conf]</strong></p>
  </dt>
  <dd>
    <p>default vault configuration file.</p>
  </dd>
  <dt>
    <p><em>bank/vault/</em><strong>dirvish</strong><em>/branch</em><strong>[.conf]</strong></p>
  </dt>
  <dd>
    <p>branch configuration file.</p>
  </dd>
  <dt>
    <p><em>bank/vault/</em><strong>dirvish</strong><em>/branch</em><strong>.hist</strong></p>
  </dt>
  <dd>
    <p>branch history file.</p>
  </dd>
  <dt>
    <p><em>bank/vault/image/</em><strong>summary</strong></p>
  </dt>
  <dd>
    <p>image creation summary.</p>
  </dd>
  <dt>
    <p><em>bank/vault/image/</em><strong>log</strong></p>
  </dt>
  <dd>
    <p>image creation log.</p>
  </dd>
  <dt>
    <p><em>bank/vault/image/</em><strong>tree</strong></p>
  </dt>
  <dd>
    <p>actual image of source directory tree.</p>
  </dd>
  <dt>
    <p><em>bank/vault/image/</em><strong>rsync_error</strong></p>
  </dt>
  <dd>
    <p>Error output from rsync if errors or warnings were detected.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dirvish&hellip;</h2>
        <div class="sectioncontent">

<pre>
<strong>dirvish.conf</strong>(5)
<a href="../man8/dirvish-runall.8.html"><strong>dirvish-runall</strong>(8)</a>
<a href="../man8/dirvish-expire.8.html"><strong>dirvish-expire</strong>(8)</a>
<strong>dirvish-locate</strong>(8)
<strong>ssh</strong>(1)
<a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>
Time::ParseDate(3pm)
<a href="../man3/strftime.3.html"><strong>strftime</strong>(3)</a>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Dirvish was created by J.W. Schultz of Pegasystems Technologies.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS AND ISSUES</h2>
        <div class="sectioncontent">
<p>Fields set in configuration files will override command line options that have been set before the file is read. This behaviour while consistent may occasionally confuse. For this reason most command line options should be specified after any options that may cause a configuration file to be loaded.</p><p>In order to preserve permissions it is necessary for dirvish to run as root on the backup server.</p><p>The root user must have non-interactive ssh access to the client systems. It is not necessary that this access be as the root user on the client.</p><p>File ownership is preserved using numeric values so it is not necessary to have user accounts on the backup server. Making the vaults network accessible using protocols that map UIDs based on names instead of number could allow access controls on files to be violated.</p><p>Making the vaults writable by users will compromise the integrity of the backups. Therefore any access to the vaults by users should be done through a read-only mount.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="diodshowmount.8.html"><span aria-hidden="true">&larr;</span> diodshowmount.8: List diod server connections</a></li>
   <li class="next"><a href="dirvish-expire.8.html">dirvish-expire.8: Delete expired dirvish images <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
