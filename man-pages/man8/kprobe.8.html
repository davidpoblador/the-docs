<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>kprobe: Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="kprobe (8) manual">
  <meta name="twitter:description" content="Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.">
  <meta name="twitter:image" content="https://www.carta.tech/images/perf-tools-unstable-kprobe-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/kprobe.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="kprobe (8) manual" />
  <meta property="og:description" content="Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/perf-tools-unstable-kprobe-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">kprobe<small> (8)</small></h1>
        <p class="lead">Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/kprobe.8.html">
      <span itemprop="name">kprobe: Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/perf-tools-unstable/">
      <span itemprop="name">perf-tools-unstable</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/kprobe.8.html">
      <span itemprop="name">kprobe: Trace a given kprobe definition. kernel dynamic tracing. uses linux ftrace.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>kprobe</strong> [-hv] [-d secs] [-p PIDs] kprobe_definition [filter]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This will create, trace, then destroy a given kprobe. See Documentation/trace/kprobetrace.txt in the Linux kernel source for the syntax of a kprobe definition.</p><p>WARNING: This uses kernel dynamic tracing, which can cause cause kernel panics or freezes. Test, and know what you are doing, before use.</p><p>Also beware of feedback loops: tracing tcp functions over an ssh session, or writing ext4 functions to an ext4 file system. For the former, tcp trace data could be redirected to a file (as in the usage message). For the latter, trace to the screen or a different file system.</p><p>Since this uses ftrace, only the root user can use this tool.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REQUIREMENTS</h2>
        <div class="sectioncontent">
<p>FTRACE and KPROBES CONFIG, which you may already have enabled and available on recent kernels.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>-d seconds</p>
  </dt>
  <dd>
    <p>Set the duration of tracing, in seconds. Trace output will be buffered and printed at the end. This also reduces overheads by buffering in-kernel, instead of printing events as they occur.</p><p>The ftrace buffer has a fixed size per-CPU (see /sys/kernel/debug/tracing/buffer_size_kb). If you think events are missing, try increasing that size.</p>
  </dd>
  <dt>
    <p>-h</p>
  </dt>
  <dd>
    <p>Print usage message.</p>
  </dd>
  <dt>
    <p>-H</p>
  </dt>
  <dd>
    <p>Print column headers.</p>
  </dd>
  <dt>
    <p>-v</p>
  </dt>
  <dd>
    <p>Show the kprobe format file only (do not trace), identifying possible variables for use in a custom filter.</p>
  </dd>
  <dt>
    <p>-p PID</p>
  </dt>
  <dd>
    <p>Only trace kernel functions when this process ID is on-CPU.</p>
  </dd>
  <dt>
    <p>kprobe_definition</p>
  </dt>
  <dd>
    <p>A full kprobe definition, as documented by Documentation/trace/kprobetrace.txt in the Linux kernel source. See the EXAMPLES section.</p>
  </dd>
  <dt>
    <p>filter</p>
  </dt>
  <dd>
    <p>An ftrace filter definition.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>These examples may need modification to match your kernel version's function names and platform's register usage. If using platform specific registers becomes too painful in practice, consider a kernel debuginfo-based tracer, which can trace variables names instead. For example, perf_events.</p>
<dl class='dl-vertical'>
  <dt>
    <p>Trace do_sys_open() return values:</p>
  </dt>
  <dd>
    <p># <strong>kprobe 'r:myopen do_sys_open $retval'</strong></p>
  </dd>
  <dt>
    <p>Trace do_sys_open() file mode:</p>
  </dt>
  <dd>
    <p># <strong>kprobe 'p:myopen do_sys_open mode=%cx:u16'</strong></p>
  </dd>
  <dt>
    <p>Trace do_sys_open() file mode for PID 81:</p>
  </dt>
  <dd>
    <p># <strong>kprobe -p 81 'p:myopen do_sys_open mode=%cx:u16'</strong></p>
  </dd>
  <dt>
    <p>Trace do_sys_open() with filename string:</p>
  </dt>
  <dd>
    <p># <strong>kprobe 'p:myopen do_sys_open filename=+0(%si):string'</strong></p>
  </dd>
  <dt>
    <p>Trace do_sys_open() for filenames ending in "stat"</p>
  </dt>
  <dd>
    <p># <strong>kprobe 'p:myopen do_sys_open fn=+0(%si):string' 'fn ~  *stat  '</strong></p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FIELDS</h2>
        <div class="sectioncontent">
<p>The output format depends on the kernel version, and headings can be printed using -H. The format is the same as the ftrace function trace format, described in the kernel source under Documentation/trace/ftrace.txt.</p><p>Typical fields are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>TASK-PID</p>
  </dt>
  <dd>
    <p>The process name (which could include dashes), a dash, and the process ID.</p>
  </dd>
  <dt>
    <p>CPU#</p>
  </dt>
  <dd>
    <p>The CPU ID, in brackets.</p>
  </dd>
  <dt>
    <p>||||</p>
  </dt>
  <dd>
    <p>Kernel state flags. For example, on Linux 3.16 these are for irqs-off, need-resched, hardirq/softirq, and preempt-depth.</p>
  </dd>
  <dt>
    <p>TIMESTAMP</p>
  </dt>
  <dd>
    <p>Time of event, in seconds.</p>
  </dd>
  <dt>
    <p>FUNCTION</p>
  </dt>
  <dd>
    <p>Kernel function name.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OVERHEAD</h2>
        <div class="sectioncontent">
<p>This can generate a lot of trace data quickly, depending on the frequency of the traced events. Such data will cause performance overheads. This also works without buffering by default, printing function events as they happen (uses trace_pipe), context switching and consuming CPU to do so. If needed, you can try the "-d secs" option, which buffers events instead, reducing overhead. If you think the buffer option is losing events, try increasing the buffer size (buffer_size_kb).</p><p>It's a good idea to use <a href="../man8/funccount.8.html"><strong>funccount</strong>(8)</a> first, which is lower overhead, to help you select which functions you may want to trace using <a href="../man8/kprobe.8.html"><strong>kprobe</strong>(8)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOURCE</h2>
        <div class="sectioncontent">
<p>This is from the perf-tools collection:</p><ul>
<li><p>https://github.com/brendangregg/perf-tools</p></li>
</ul><p>Also look under the examples directory for a text file containing example usage, output, and commentary for this tool.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OS</h2>
        <div class="sectioncontent">
<p>Linux</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STABILITY</h2>
        <div class="sectioncontent">
<p>Unstable - in development.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Brendan Gregg</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO kprobe&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/functrace.8.html"><strong>functrace</strong>(8)</a>, <a href="../man8/funccount.8.html"><strong>funccount</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="kpartx.8.html"><span aria-hidden="true">&larr;</span> kpartx.8: Create device maps from partition tables</a></li>
   <li class="next"><a href="kprop.8.html">kprop.8: Propagate a kerberos v5 principal database to a slave server <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
