<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>kdb5_util: Kerberos database maintenance utility</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Kerberos database maintenance utility">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="kdb5_util (8) manual">
  <meta name="twitter:description" content="Kerberos database maintenance utility">
  <meta name="twitter:image" content="https://www.carta.tech/images/krb5-kdc-kdb5_util-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/kdb5_util.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="kdb5_util (8) manual" />
  <meta property="og:description" content="Kerberos database maintenance utility" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/krb5-kdc-kdb5_util-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">kdb5_util<small> (8)</small></h1>
        <p class="lead">Kerberos database maintenance utility</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/kdb5_util.8.html">
      <span itemprop="name">kdb5_util: Kerberos database maintenance utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/krb5-kdc/">
      <span itemprop="name">krb5-kdc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/kdb5_util.8.html">
      <span itemprop="name">kdb5_util: Kerberos database maintenance utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>kdb5_util</strong> [<strong>-r</strong> <em>realm</em>] [<strong>-d</strong> <em>dbname</em>] [<strong>-k</strong> <em>mkeytype</em>] [<strong>-M</strong> <em>mkeyname</em>] [<strong>-kv</strong> <em>mkeyVNO</em>] [<strong>-sf</strong> <em>stashfilename</em>] [<strong>-m</strong>] <em>command</em> [<em>command_options</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>kdb5_util allows an administrator to perform maintenance procedures on the KDC database.  Databases can be created, destroyed, and dumped to or loaded from ASCII files.  kdb5_util can create a Kerberos master key stash file or perform live rollover of the master key.</p><p>When kdb5_util is run, it attempts to acquire the master key and open the database.  However, execution continues regardless of whether or not kdb5_util successfully opens the database, because the database may not exist yet or the stash file may be corrupt.</p><p>Note that some KDC database modules may not support all kdb5_util commands.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMAND-LINE OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong></strong><strong>-r</strong><strong> </strong><em>realm</em><strong></strong></p>
  </dt>
  <dd>
    <p>specifies the Kerberos realm of the database.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-d</strong><strong> </strong><em>dbname</em><strong></strong></p>
  </dt>
  <dd>
    <p>specifies the name under which the principal database is stored; by default the database is that listed in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em>.  The password policy database and lock files are also derived from this value.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-k</strong><strong> </strong><em>mkeytype</em><strong></strong></p>
  </dt>
  <dd>
    <p>specifies the key type of the master key in the database.  The default is given by the <strong>master_key_type</strong> variable in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em>.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-kv</strong><strong> </strong><em>mkeyVNO</em><strong></strong></p>
  </dt>
  <dd>
    <p>Specifies the version number of the master key in the database; the default is 1.  Note that 0 is not allowed.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-M</strong><strong> </strong><em>mkeyname</em><strong></strong></p>
  </dt>
  <dd>
    <p>principal name for the master key in the database.  If not specified, the name is determined by the <strong>master_key_name</strong> variable in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em>.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-m</strong><strong></strong></p>
  </dt>
  <dd>
    <p>specifies that the master database password should be read from the keyboard rather than fetched from a file on disk.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-sf</strong><strong> </strong><em>stash_file</em><strong></strong></p>
  </dt>
  <dd>
    <p>specifies the stash filename of the master database password.  If not specified, the filename is determined by the <strong>key_stash_file</strong> variable in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em>.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-P</strong><strong> </strong><em>password</em><strong></strong></p>
  </dt>
  <dd>
    <p>specifies the master database password.  Using this option may expose the password to other users on the system via the process list.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDS</h2>
        <div class="sectioncontent">
<h3>create</h3>
<p><strong>create</strong> [<strong>-s</strong>]</p><p>Creates a new database.  If the <strong>-s</strong> option is specified, the stash file is also created.  This command fails if the database already exists.  If the command is successful, the database is opened just as if it had already existed when the program was first run.</p>
<h3>destroy</h3>
<p><strong>destroy</strong> [<strong>-f</strong>]</p><p>Destroys the database, first overwriting the disk sectors and then unlinking the files, after prompting the user for confirmation.  With the <strong>-f</strong> argument, does not prompt the user.</p>
<h3>stash</h3>
<p><strong>stash</strong> [<strong>-f</strong> <em>keyfile</em>]</p><p>Stores the master principal&apos;s keys in a stash file.  The <strong>-f</strong> argument can be used to override the <em>keyfile</em> specified in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em>.</p>
<h3>dump</h3>
<p><strong>dump</strong> [<strong>-b7</strong>|<strong>-ov</strong>|<strong>-r13</strong>] [<strong>-verbose</strong>] [<strong>-mkey_convert</strong>] [<strong>-new_mkey_file</strong> <em>mkey_file</em>] [<strong>-rev</strong>] [<strong>-recurse</strong>] [<em>filename</em> [<em>principals</em>...]]</p><p>Dumps the current Kerberos and KADM5 database into an ASCII file.  By default, the database is dumped in current format, "kdb5_util load_dump version 7".  If filename is not specified, or is the string "-", the dump is sent to standard output.  Options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong></strong><strong>-b7</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the dump to be in the Kerberos 5 Beta 7 format ("kdb5_util load_dump version 4").  This was the dump format produced on releases prior to 1.2.2.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-ov</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the dump to be in "ovsec_adm_export" format.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-r13</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the dump to be in the Kerberos 5 1.3 format ("kdb5_util load_dump version 5").  This was the dump format produced on releases prior to 1.8.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-r18</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the dump to be in the Kerberos 5 1.8 format ("kdb5_util load_dump version 6").  This was the dump format produced on releases prior to 1.11.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-verbose</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the name of each principal and policy to be printed as it is dumped.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-mkey_convert</strong><strong></strong></p>
  </dt>
  <dd>
    <p>prompts for a new master key.  This new master key will be used to re-encrypt principal key data in the dumpfile.  The principal keys themselves will not be changed.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-new_mkey_file</strong><strong> </strong><em>mkey_file</em><strong></strong></p>
  </dt>
  <dd>
    <p>the filename of a stash file.  The master key in this stash file will be used to re-encrypt the key data in the dumpfile.  The key data in the database will not be changed.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-rev</strong><strong></strong></p>
  </dt>
  <dd>
    <p>dumps in reverse order.  This may recover principals that do not dump normally, in cases where database corruption has occurred.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-recurse</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the dump to walk the database recursively (btree only). This may recover principals that do not dump normally, in cases where database corruption has occurred.  In cases of such corruption, this option will probably retrieve more principals than the <strong>-rev</strong> option will.</p>
  </dd>

</dl>

<h3>load</h3>
<p><strong>load</strong> [<strong>-b7</strong>|<strong>-ov</strong>|<strong>-r13</strong>] [<strong>-hash</strong>] [<strong>-verbose</strong>] [<strong>-update</strong>] <em>filename</em> [<em>dbname</em>]</p><p>Loads a database dump from the named file into the named database.  If no option is given to determine the format of the dump file, the format is detected automatically and handled as appropriate.  Unless the <strong>-update</strong> option is given, <strong>load</strong> creates a new database containing only the data in the dump file, overwriting the contents of any previously existing database.  Note that when using the LDAP KDC database module, the <strong>-update</strong> flag is required.</p><p>Options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong></strong><strong>-b7</strong><strong></strong></p>
  </dt>
  <dd>
    <p>requires the database to be in the Kerberos 5 Beta 7 format ("kdb5_util load_dump version 4").</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-ov</strong><strong></strong></p>
  </dt>
  <dd>
    <p>requires the database to be in "ovsec_adm_import" format.  Must be used with the <strong>-update</strong> option.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-r13</strong><strong></strong></p>
  </dt>
  <dd>
    <p>requires the database to be in Kerberos 5 1.3 format ("kdb5_util load_dump version 5").  This was the dump format produced on releases prior to 1.8.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-r18</strong><strong></strong></p>
  </dt>
  <dd>
    <p>requires the database to be in Kerberos 5 1.8 format ("kdb5_util load_dump version 6").  This was the dump format produced on releases prior to 1.11.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-hash</strong><strong></strong></p>
  </dt>
  <dd>
    <p>requires the database to be stored as a hash.  If this option is not specified, the database will be stored as a btree.  This option is not recommended, as databases stored in hash format are known to corrupt data and lose principals.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-verbose</strong><strong></strong></p>
  </dt>
  <dd>
    <p>causes the name of each principal and policy to be printed as it is dumped.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-update</strong><strong></strong></p>
  </dt>
  <dd>
    <p>records from the dump file are added to or updated in the existing database.  (This is useful in conjunction with an ovsec_adm_export format dump if you want to preserve per-principal policy information, since the current default format does not contain this data.)  Otherwise, a new database is created containing only what is in the dump file and the old one destroyed upon successful completion.</p><p>If specified, <em>dbname</em> overrides the value specified on the command line or the default.</p>
  </dd>

</dl>

<h3>ark</h3>
<p><strong>ark</strong> [<strong>-e</strong> <em>enc</em>:<em>salt</em>,...] <em>principal</em></p><p>Adds new random keys to <em>principal</em> at the next available key version number.  Keys for the current highest key version number will be preserved.  The <strong>-e</strong> option specifies the list of encryption and salt types to be used for the new keys.</p>
<h3>add_mkey</h3>
<p><strong>add_mkey</strong> [<strong>-e</strong> <em>etype</em>] [<strong>-s</strong>]</p><p>Adds a new master key to the master key principal, but does not mark it as active.  Existing master keys will remain.  The <strong>-e</strong> option specifies the encryption type of the new master key; see <em>Encryption_types</em> in <a href="../man5/kdc.conf.5.html"><strong>kdc.conf</strong>(5)</a></em> for a list of possible values.  The <strong>-s</strong> option stashes the new master key in the stash file, which will be created if it doesn&apos;t already exist.</p><p>After a new master key is added, it should be propagated to slave servers via a manual or periodic invocation of <a href="../man8/kprop.8.html"><strong>kprop</strong>(8)</a></em>.  Then, the stash files on the slave servers should be updated with the kdb5_util <strong>stash</strong> command.  Once those steps are complete, the key is ready to be marked active with the kdb5_util <strong>use_mkey</strong> command.</p>
<h3>use_mkey</h3>
<p><strong>use_mkey</strong> <em>mkeyVNO</em> [<em>time</em>]</p><p>Sets the activation time of the master key specified by <em>mkeyVNO</em>. Once a master key becomes active, it will be used to encrypt newly created principal keys.  If no <em>time</em> argument is given, the current time is used, causing the specified master key version to become active immediately.  The format for <em>time</em> is <em>getdate</em> string.</p><p>After a new master key becomes active, the kdb5_util <strong>update_princ_encryption</strong> command can be used to update all principal keys to be encrypted in the new master key.</p>
<h3>list_mkeys</h3>
<p><strong>list_mkeys</strong></p><p>List all master keys, from most recent to earliest, in the master key principal.  The output will show the kvno, enctype, and salt type for each mkey, similar to the output of <a href="../man1/kadmin.1.html"><strong>kadmin</strong>(1)</a></em> <strong>getprinc</strong>.  A <strong>*</strong> following an mkey denotes the currently active master key.</p>
<h3>purge_mkeys</h3>
<p><strong>purge_mkeys</strong> [<strong>-f</strong>] [<strong>-n</strong>] [<strong>-v</strong>]</p><p>Delete master keys from the master key principal that are not used to protect any principals.  This command can be used to remove old master keys all principal keys are protected by a newer master key.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong></strong><strong>-f</strong><strong></strong></p>
  </dt>
  <dd>
    <p>does not prompt for confirmation.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-n</strong><strong></strong></p>
  </dt>
  <dd>
    <p>performs a dry run, showing master keys that would be purged, but not actually purging any keys.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>-v</strong><strong></strong></p>
  </dt>
  <dd>
    <p>gives more verbose output.</p>
  </dd>

</dl>

<h3>update_princ_encryption</h3>
<p><strong>update_princ_encryption</strong> [<strong>-f</strong>] [<strong>-n</strong>] [<strong>-v</strong>] [<em>princ-pattern</em>]</p><p>Update all principal records (or only those matching the <em>princ-pattern</em> glob pattern) to re-encrypt the key data using the active database master key, if they are encrypted using a different version, and give a count at the end of the number of principals updated.  If the <strong>-f</strong> option is not given, ask for confirmation before starting to make changes.  The <strong>-v</strong> option causes each principal processed to be listed, with an indication as to whether it needed updating or not.  The <strong>-n</strong> option performs a dry run, only showing the actions which would have been taken.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO kdb5_util&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/kadmin.1.html"><strong>kadmin</strong>(1)</a></em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>MIT</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>1985-2013, MIT</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="kdb5_ldap_util.8.html"><span aria-hidden="true">&larr;</span> kdb5_ldap_util.8: Kerberos configuration utility</a></li>
   <li class="next"><a href="kded4.8.html">kded4.8: Kde daemon - triggers sycoca database updates when needed. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
