<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>vfs_shadow_copy2: Expose snapshots to windows clients as shadow copies.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Expose snapshots to windows clients as shadow copies.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="vfs_shadow_copy2 (8) manual">
  <meta name="twitter:description" content="Expose snapshots to windows clients as shadow copies.">
  <meta name="twitter:image" content="https://www.carta.tech/images/samba-vfs-modules-vfs_shadow_copy2-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/vfs_shadow_copy2.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="vfs_shadow_copy2 (8) manual" />
  <meta property="og:description" content="Expose snapshots to windows clients as shadow copies." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/samba-vfs-modules-vfs_shadow_copy2-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">vfs_shadow_copy2<small> (8)</small></h1>
        <p class="lead">Expose snapshots to windows clients as shadow copies.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vfs_shadow_copy2.8.html">
      <span itemprop="name">vfs_shadow_copy2: Expose snapshots to windows clients as shadow copies.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/samba-vfs-modules/">
      <span itemprop="name">samba-vfs-modules</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/vfs_shadow_copy2.8.html">
      <span itemprop="name">vfs_shadow_copy2: Expose snapshots to windows clients as shadow copies.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>vfs objects = shadow_copy2</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This VFS module is part of the <a href="../man7/samba.7.html"><strong>samba</strong>(7)</a> suite.</p><p>The vfs_shadow_copy2 VFS module offers a functionality similar to Microsoft Shadow Copy services. When set up properly, this module allows Microsoft Shadow Copy clients to browse through file system snapshots as "shadow copies" on Samba shares.</p><p>This is a second implementation of a shadow copy module which has the following additional features (compared to the original <strong>shadow_copy</strong>(8) module):</p><p>There is no need any more to populate your share&apos;s root directory with symlinks to the snapshots if the file system stores the snapshots elsewhere. Instead, you can flexibly configure the module where to look for the file system snapshots. This can be very important when you have thousands of shares, or use [homes].</p><p>Snapshot directories need not be in one fixed central place but can be located anywhere in the directory tree. This mode helps to support file systems that offer snapshotting of particular subtrees, for example the GPFS independent file sets.</p><p>Vanity naming for snapshots: snapshots can be named in any format compatible with str[fp]time conversions.</p><p>Timestamps can be represented in localtime rather than UTC.</p><p>The inode number of the files can optionally be altered to be different from the original. This fixes the &apos;restore&apos; button in the Windows GUI to work without a sharing violation when serving from file systems, like GPFS, that return the same device and inode number for the snapshot file and the original.</p><p>Shadow copy results are by default sorted before being sent to the client. This is beneficial for filesystems that don&apos;t read directories alphabetically (the default unix). Sort ordering can be configured and sorting can be turned off completely if the file system sorts its directory listing.</p><p>This module is stackable.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>vfs_shadow_copy2 relies on a filesystem snapshot implementation. Many common filesystems have native support for this.</p><p>Filesystem snapshots must be available under specially named directories in order to be recognized by vfs_shadow_copy2. These snapshot directory is typically a direct subdirectory of the share root&apos;s mountpoint but there are other modes that can be configured with the parameters described in detail below.</p><p>The snapshot at a given point in time is expected in a subdirectory of the snapshot directory where the snapshot&apos;s directory is expected to be a formatted version of the snapshot time. The default format which can be changed with the shadow:format option is @GMT-YYYY.MM.DD-hh.mm.ss, where:</p><p>YYYY is the 4 digit year</p><p>MM is the 2 digit month</p><p>DD is the 2 digit day</p><p>hh is the 2 digit hour</p><p>mm is the 2 digit minute</p><p>ss is the 2 digit second.</p><p>The vfs_shadow_copy2 snapshot naming convention can be produced with the following <a href="../man1/date.1.html"><strong>date</strong>(1)</a> command:</p>
<pre>
	TZ=GMT date +@GMT-%Y.%m.%d-%H.%M.%S

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>shadow:mountpoint = MOUNTPOINT</p><p>With this parameter, one can specify the mount point of the filesystem that contains the share path. Usually this mount point is automatically detected. But for some constellations, in particular tests, it can be convenient to be able to specify it.</p><p>Example: shadow:mountpoint = /path/to/filesystem</p><p>Default: shadow:mountpoint = NOT SPECIFIED</p><p>shadow:snapdir = SNAPDIR</p><p>Path to the directory where the file system of the share keeps its snapshots. If an absolute path is specified, it is used as-is. If a relative path is specified, then it is taken relative to the mount point of the filesystem of the share root. (See shadow:mountpoint.)</p><p>Note that shadow:snapdirseverywhere depends on this parameter and needs a relative path. Setting an absolute path disables shadow:snapdirseverywhere.</p><p>Note that the shadow:crossmountpoints option also requires a relative snapdir. Setting an absolute path disables shadow:crossmountpoints.</p><p>Example: shadow:snapdir = /some/absolute/path</p><p>Default: shadow:snapdir = .snapshots</p><p>shadow:basedir = BASEDIR</p><p>The basedir option allows to specify a directory between the share&apos;s mount point and the share root, relative to which the file system&apos;s snapshots are taken.</p><p>For example, if</p><p>basedir = mountpoint/rel_basedir</p><p>share_root = basedir/rel_share_root</p><p>snapshot_path = mountpoint/snapdir</p><p>or snapshot_path = snapdir if snapdir is absolute</p><p>then the snapshot of a file = mountpoint/rel_basedir/rel_share_root/rel_file at a time TIME will be found under snapshot_path/FS_GMT_TOKEN(TIME)/rel_share_root/rel_file, where FS_GMT_TOKEN(TIME) is the timestamp string belonging to TIME in the format required by the file system. (See shadow:format.)</p><p>The default for the basedir is the mount point of the file system of the share root (see shadow:mountpoint).</p><p>Note that the shadow:snapdirseverywhere and shadow:crossmountpoints options are incompatible with shadow:basedir and disable the basedir setting.</p><p>shadow:sort = asc/desc</p><p>By default, this module sorts the shadow copy data alphabetically before sending it to the client. With this parameter, one can specify the sort order. Possible known values are desc (descending, the default) and asc (ascending). If the file system lists directories alphabetically sorted, one can turn off sorting in this module by specifying any other value.</p><p>Example: shadow:sort = asc</p><p>Example: shadow:sort = none</p><p>Default: shadow:sort = desc</p><p>shadow:localtime = yes/no</p><p>This is an optional parameter that indicates whether the snapshot names are in UTC/GMT or in local time. If it is disabled then UTC/GMT is expected.</p><p>shadow:localtime = no</p><p>shadow:format = format specification for snapshot names</p><p>This is an optional parameter that specifies the format specification for the naming of snapshots in the file system. The format must be compatible with the conversion specifications recognized by str[fp]time.</p><p>Default: shadow:format = "@GMT-%Y.%m.%d-%H.%M.%S"</p><p>shadow:sscanf = yes/no</p><p>This paramter can be used to specify that the time in format string is given as an unsigned long integer (%lu) rather than a time strptime() can parse. The result must be a unix time_t time.</p><p>Default: shadow:sscanf = no</p><p>shadow:fixinodes = yes/no</p><p>If you enable shadow:fixinodes then this module will modify the apparent inode number of files in the snapshot directories using a hash of the files path. This is needed for snapshot systems where the snapshots have the same device:inode number as the original files (such as happens with GPFS snapshots). If you don&apos;t set this option then the &apos;restore&apos; button in the shadow copy UI will fail with a sharing violation.</p><p>Default: shadow:fixinodes = no</p><p>shadow:snapdirseverywhere = yes/no</p><p>If you enable shadow:snapdirseverywhere then this module will look out for snapshot directories in the current working directory and all parent directories, stopping at the mount point by default. But see shadow:crossmountpoints how to change that behaviour.</p><p>An example where this is needed are independent filesets in IBM&apos;s GPFS, but other filesystems might support snapshotting only particular subtrees of the filesystem as well.</p><p>Note that shadow:snapdirseverywhere depends on shadow:snapdir and needs it to be a relative path. Setting an absolute snapdir path disables shadow:snapdirseverywhere.</p><p>Note that this option is incompatible with the shadow:basedir option and removes the shadow:basedir setting by itself.</p><p>Example: shadow:snapdirseverywhere = yes</p><p>Default: shadow:snapdirseverywhere = no</p><p>shadow:crossmountpoints = yes/no</p><p>This option is effective in the case of shadow:snapdirseverywhere = yes. Setting this option makes the module not stop at the first mount point encountered when looking for snapdirs, but lets it search potentially all through the path instead.</p><p>An example where this is needed are independent filesets in IBM&apos;s GPFS, but other filesystems might support snapshotting only particular subtrees of the filesystem as well.</p><p>Note that shadow:snapdirseverywhere depends on shadow:snapdir and needs it to be a relative path. Setting an absolute snapdir path disables shadow:snapdirseverywhere.</p><p>Note that this option is incompatible with the shadow:basedir option and removes the shadow:basedir setting by itself.</p><p>Example: shadow:crossmountpoints = yes</p><p>Default: shadow:crossmountpoints = no</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Add shadow copy support to user home directories:</p>
<pre>
        <em>[homes]</em>
	\m[blue]<strong>vfs objects = shadow_copy2</strong>\m[]
	\m[blue]<strong>shadow:snapdir = /data/snapshots</strong>\m[]
	\m[blue]<strong>shadow:basedir = /data/home</strong>\m[]
	\m[blue]<strong>shadow:sort = desc</strong>\m[]
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<p>This is not a backup, archival, or version control solution.</p><p>With Samba or Windows servers, vfs_shadow_copy2 is designed to be an end-user tool only. It does not replace or enhance your backup and archival solutions and should in no way be considered as such. Additionally, if you need version control, implement a version control system.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This man page is correct for version 4.0 of the Samba suite.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>The original Samba software and related utilities were created by Andrew Tridgell. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="vfs_shadow_copy.8.html"><span aria-hidden="true">&larr;</span> vfs_shadow_copy.8: Make a samba share read only for a specified time period</a></li>
   <li class="next"><a href="vfs_smb_traffic_analyzer.8.html">vfs_smb_traffic_analyzer.8: Log samba vfs read and write operations through a socket to a helper application <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
