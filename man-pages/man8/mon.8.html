<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mon: Monitor services for availability, sending alarms upon failures.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Monitor services for availability, sending alarms upon failures.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mon (8) manual">
  <meta name="twitter:description" content="Monitor services for availability, sending alarms upon failures.">
  <meta name="twitter:image" content="https://www.carta.tech/images/mon-mon-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/mon.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mon (8) manual" />
  <meta property="og:description" content="Monitor services for availability, sending alarms upon failures." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mon-mon-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mon<small> (8)</small></h1>
        <p class="lead">Monitor services for availability, sending alarms upon failures.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mon.8.html">
      <span itemprop="name">mon: Monitor services for availability, sending alarms upon failures.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mon/">
      <span itemprop="name">mon</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mon.8.html">
      <span itemprop="name">mon: Monitor services for availability, sending alarms upon failures.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mon</strong> [<strong>-dfhlMSv</strong>] [<strong>-a</strong> <em>dir</em>] [<strong>-A</strong> <em>authfile</em>] [<strong>-b</strong> <em>dir</em>] [<strong>-B</strong> <em>dir</em>] [<strong>-c</strong> <em>config</em>] [<strong>-D</strong> <em>dir</em>] [<strong>-i</strong> <em>secs</em>] [<strong>-k</strong> <em>num</em>] [<strong>-l</strong> <em>[</em>statetype<em>]</em>] [<strong>-L</strong> <em>dir</em>] [<strong>-m</strong> <em>num</em>] [<strong>-p</strong> <em>num</em>] [<strong>-P</strong> <em>pidfile</em>] [<strong>-r</strong> <em>delay</em>] [<strong>-s</strong> <em>dir</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mon</strong> is a general-purpose scheduler for monitoring service availability and triggering alerts upon detecting failures. <strong>mon</strong> was designed to be open in the sense that it supports arbitrary monitoring facilities and alert methods via a common interface, which are easily implemented through programs (in C, Perl, shell, etc.), SNMP traps, and special Mon (UDP packet) traps.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-a</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Path to alert scripts. Default is <em>/usr/local/lib/mon/alert.d:alert.d</em>. Multiple alert paths may be specified by separating them with a colon.  Non-absolute paths are taken to be relative to the base directory (<em>/usr/lib/mon</em> by default).</p>
  </dd>
  <dt>
    <p><strong>-b</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Base directory for mon. scriptdir, alertdir, and statedir are all relative to this directory unless specified from /. Default is <em>/usr/lib/mon</em>.</p>
  </dd>
  <dt>
    <p><strong>-B</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Configuration file base directory. All config files are located here, including mon.cf, monusers.cf, and auth.cf.</p>
  </dd>
  <dt>
    <p><strong>-A</strong><em>authfile</em></p>
  </dt>
  <dd>
    <p>Authentication configuration file. By default this is <em>/etc/mon/auth.cf</em> if the <em>/etc/mon</em> directory exists, or <em>/usr/lib/mon/auth.cf</em> otherwise.</p>
  </dd>
  <dt>
    <p><strong>-c</strong><em>file</em></p>
  </dt>
  <dd>
    <p>Read configuration from <em>file</em>. This defaults to IR /etc/mon/mon.cf " if the " /etc/mon directory exists, otherwise to <em>/etc/mon.cf</em>.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Enable debugging mode.</p>
  </dd>
  <dt>
    <p><strong>-D</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Path to state directory.  Default is the first of <em>/var/state/mon</em>, <em>/var/lib/mon</em>, and <em>/usr/lib/mon/state.d</em> which exists.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>Fork and run as a daemon process. This is the preferred way to run <strong>mon</strong>.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>Print help information.</p>
  </dd>
  <dt>
    <p><strong>-i</strong><em>secs</em></p>
  </dt>
  <dd>
    <p>Sleep interval, in seconds. Defaults to 1. This shouldn't need to be adjusted for any reason.</p>
  </dd>
  <dt>
    <p><strong>-k</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Set log history to a maximum of <em>num</em> entries. Defaults to 100.</p>
  </dd>
  <dt>
    <p><strong>-l</strong><em>statetype</em></p>
  </dt>
  <dd>
    <p>Load state from the last saved state file. The supported saved state types are <strong>disabled</strong> for disabled watches, services, and hosts, <strong>opstatus</strong> for failure/alert/ack status of all services, and <strong>all</strong> for both.  If no statetype is provided, <strong>disabled</strong> is assumed.</p>
  </dd>
  <dt>
    <p><strong>-L</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Sets the log dir. See also <strong>logdir</strong> in the configuration file.  The default is <strong>/var/log/mon</strong> if that directory exists, otherwise <strong>log.d</strong> in the base directory.</p>
  </dd>
  <dt>
    <p><strong>-M</strong></p>
  </dt>
  <dd>
    <p>Pre-process the configuration file with the macro expansion package <em>m4</em>.</p>
  </dd>
  <dt>
    <p><strong>-m</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Set the throttle for the maximum number of processes to <em>num</em>.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Make server listen on port <em>num</em>. This defaults to 2583.</p>
  </dd>
  <dt>
    <p><strong>-S</strong></p>
  </dt>
  <dd>
    <p>Start with the scheduler stopped.</p>
  </dd>
  <dt>
    <p><strong>-P</strong><em>pidfile</em></p>
  </dt>
  <dd>
    <p>Store the server's pid in <em>pidfile</em>, the default is the first of <em>/var/run/mon/mon.pid</em>, <em>/var/run/mon.pid</em>, and <em>/etc/mon.pid</em> whose directory exists.  An empty value tells <strong>mon</strong> not to use a pid file.</p>
  </dd>
  <dt>
    <p><strong>-r</strong><em>delay</em></p>
  </dt>
  <dd>
    <p>Sets the number of seconds used to randomize the startup delay before each service is scheduled. Refer to the global <em>randstart</em> variable in the configuration file.</p>
  </dd>
  <dt>
    <p><strong>-s</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Path to monitor scripts. Default is <em>/usr/local/lib/mon/mon.d:mon.d</em>. Multiple alert paths may be specified by separating them with a colon.  Non-absolute paths are taken to be relative to the base directory (<em>/usr/lib/mon</em> by default).</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Print version information.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEFINITIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>monitor</strong></p>
  </dt>
  <dd>
    <p>A program which tests for a certain condition, returns either true or false, and optionally produces output to be passed back to the scheduler. Common monitors detect host reachability via ICMP echo messages, or connection to TCP services.</p>
  </dd>
  <dt>
    <p><strong>period</strong></p>
  </dt>
  <dd>
    <p>A period in time as interpreted by the Time::Period module.</p>
  </dd>
  <dt>
    <p><strong>alert</strong></p>
  </dt>
  <dd>
    <p>A program which sends a message when invoked by the scheduler. The scheduler calls upon an alert when it detects a failure from a monitor. An alert program accepts a set of command-line arguments from the scheduler, in addition to data via standard input.</p>
  </dd>
  <dt>
    <p><strong>hostgroup</strong></p>
  </dt>
  <dd>
    <p>A single host or list of hosts, specified as names or IP addresses.</p>
  </dd>
  <dt>
    <p><strong>service</strong></p>
  </dt>
  <dd>
    <p>A collection of parameters used to deal with monitoring a particular resource which is provided by a group. Services are usually modeled after things such as an SMTP server, ICMP echo capability, server disk space availability, or SNMP events.</p>
  </dd>
  <dt>
    <p><strong>view</strong></p>
  </dt>
  <dd>
    <p>A collection of hostgroups, used to filter mon output for client display. i.e. a 'network-services' view might be defined so your network staff can see just the hostgroups which matter to them, without having to see all hostgroups defined in Mon.</p>
  </dd>
  <dt>
    <p><strong>watch</strong></p>
  </dt>
  <dd>
    <p>A collection of services which apply to a particular group.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPERATION</h2>
        <div class="sectioncontent">
<p>When the <strong>mon</strong> scheduler starts, it reads a configuration file to determine the services it needs to monitor. The configuration file defaults to <em>/etc/mon.cf</em>, and can be specified using the <strong>-c</strong> parameter. If the <strong>-M</strong> option is specified, then the configuration file is pre-processed with <em>m4</em>. If the configuration file ends with .m4, the file is also processed by m4 automatically.</p><p>The scheduler enters a loop which handles client connections, monitor invocations, and failure alerts. Each service has a timer, specified in the configuration file as the <strong>interval</strong> variable, which tells the scheduler how frequently to invoke a monitor process. The scheduler may be temporarily stopped. While it is stopped, client access still functions, but it just doesn't schedule things. This is useful in conjunction while resetting the server, because you can do this: save the hosts and services which are disabled, reset the server with the scheduler stopped, re-disabled those hosts and services, then start the scheduler. It also allows making atomic changes across several client connections. See the <strong>moncmd</strong> man page for more information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MONITOR&nbsp;PROGRAMS</h2>
        <div class="sectioncontent">
<p>Monitor processes are invoked with the arguments specified in the configuration file, appended by the hosts from the applicable host group. For example, if the watch group is "servers", which contain the hostnames "smtp", "nntp", and "ns", and the monitor line reads as follows,</p><p>monitor fping.monitor -t 4000 -r 2</p><p>then the exectuable "fping.monitor" will be executed with these parameters:</p><p>MONITOR_DIR/fping.monitor -t 4000 -r 2 smtp nntp ns</p><p>MONITOR_DIR is actually a search path, by default <em>/usr/local/lib/mon/mon.d</em> then <em>/usr/lib/mon/mon.d</em>, but it can be overridden by the <strong>-s</strong> option or in the configuration file. If all hosts in the hostgroup have been disabled, then a warning is sent to syslog and the monitor is not run. This behavior may be overridden with the "allow_empty_group" option in the service definition. If the final argument to the "monitor" line is ";;" (it must be preceded by whitespace), then the host list will not be appended to the parameter list.</p><p>In addition to environment variables defined by the user in the service definition, <strong>mon</strong> passes certain variables to monitor process.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>MON_LAST_SUMMARY</strong></p>
  </dt>
  <dd>
    <p>The first line of the output from the last time the monitor exited. This is not the summary of the current monitor run, but the previous one.  This may be used by an alert script to provide historical context in an alert.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_OUTPUT</strong></p>
  </dt>
  <dd>
    <p>The entire output of the monitor from the last time it exited.  This is not the output of the current monitor run, but the previous one. This may be used by an alert script to provide historical context in an alert.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_FAILURE</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the last failure for this service.</p>
  </dd>
  <dt>
    <p><strong>MON_FIRST_FAILURE</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the first time this service failed.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_SUCCESS</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the last time this service passed.</p>
  </dd>
  <dt>
    <p><strong>MON_DESCRIPTION</strong></p>
  </dt>
  <dd>
    <p>The description of this service, as defined in the configuration file using the <em>description</em> tag.</p>
  </dd>
  <dt>
    <p><strong>MON_DEPEND_STATUS</strong></p>
  </dt>
  <dd>
    <p>The depend status, "o" if dependency failure, "1" otherwise.</p>
  </dd>
  <dt>
    <p><strong>MON_LOGDIR</strong></p>
  </dt>
  <dd>
    <p>The directory log files should be placed, as indicated by the <em>logdir</em> global configuration variable.</p>
  </dd>
  <dt>
    <p><strong>MON_STATEDIR</strong></p>
  </dt>
  <dd>
    <p>The directory where state files should be kept, as indicated by the <em>statedir</em> global configuration variable.</p>
  </dd>
  <dt>
    <p><strong>MON_CFBASEDIR</strong></p>
  </dt>
  <dd>
    <p>The directory where configuration files should be kept, as indicated by the <em>cfbasedir</em> global configuration variable.</p>
  </dd>

</dl>
<p>"fping.monitor" should return an exit status of 0 if it completed successfully (found no problems), or nonzero if a problem was detected. The first line of output from the monitor script has a special meaning: it is used as a brief summary of the exact failure which was detected, and is passed to the alert program. All remaining output is also passed to the alert program, but it has no required interpretation.</p><p>If a monitor for a particular service is still running, and the time comes for <strong>mon</strong> to run another monitor for that service, it will not start another monitor. For example, if the <em>interval</em> is 10s, and the monitor does not finish running within 10 seconds, then <strong>mon</strong> will wait until the first monitor exits before running another one.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ALERT DECISION LOGIC</h2>
        <div class="sectioncontent">
<p>Upon a non-zero or zero exit status, the associated alert or upalert program (respectively) is started, pending the following conditions: If an alert for a specific service is disabled, do not send an alert. If <strong>dep_behavior</strong> is set to <em>'a'</em>, or <strong>alertdepend</strong> is set, and a parent dependency is failing, then suppress the alert. If the alert has previously been acknowledged, do not send the alert, unless it is an upalert. If an alert is not within the specified period, record the failure via <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a> and do not send an alert. If the failure does not fall within a defined period, do not send an alert. No upalerts are sent without corresponding down alerts, unless <strong>no_comp_alerts</strong> is defined in the period section. An upalert will only be sent if the previous state is a failure. If an alert was already sent within the last <strong>alertevery</strong> interval, do not send another alert, <em>unless</em> the summary output from the current monitor program differs from the last monitor process. Otherwise, send an alert using each alert program listed for that period. The <strong>observe_detail</strong> argument to <strong>alertevery</strong> affects this behavior by observing the changes in the detail part of the output in addition to the summary line. If a monitor has successive failures and the summary output changes in each of them, <strong>alertevery</strong> will not suppress multiple consecutive alerts. The reasoning is that if the summary output changes, then a significant event occurred and the user should be alerted. The "strict" argument to alertevery will suppress both comparing the output from the previous monitor run to the current and prevent a successful return value of the monitor from resetting the alertevery timer. For example, "alertevery 24h strict" will only send out an alert once every 24 hours, regardless of whether the monitor output changes, or if the service stops and then starts failing.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ALERT&nbsp;PROGRAMS</h2>
        <div class="sectioncontent">
<p>Alert programs are found in the path supplied with the <strong>-a</strong> parameter, or in the <em>/usr/local/lib/mon/alert.d</em> and directories if not specified.  They are invoked with the following command-line parameters:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-s</strong><em>service</em></p>
  </dt>
  <dd>
    <p>Service tag from the configuration file.</p>
  </dd>
  <dt>
    <p><strong>-g</strong><em>group</em></p>
  </dt>
  <dd>
    <p>Host group name from the configuration file.</p>
  </dd>
  <dt>
    <p><strong>-h</strong><em>hosts</em></p>
  </dt>
  <dd>
    <p>The expanded version of the host group, space delimited, but contained in one shell "word".</p>
  </dd>
  <dt>
    <p><strong>-l</strong><em>alertevery</em></p>
  </dt>
  <dd>
    <p>The number of seconds until the next alarm will be sent.</p>
  </dd>
  <dt>
    <p><strong>-O</strong></p>
  </dt>
  <dd>
    <p>This option  is  supplied  to an alert only if the alert is being generated as a result of an expected traap timing out</p>
  </dd>
  <dt>
    <p><strong>-t</strong><em>time</em></p>
  </dt>
  <dd>
    <p>The time (in <a href="../man2/time.2.html"><strong>time</strong>(2)</a> format) of when this failure condition was detected.</p>
  </dd>
  <dt>
    <p><strong>-T</strong></p>
  </dt>
  <dd>
    <p>This option is supplied to an alert only if the alert was triggered by a trap</p>
  </dd>
  <dt>
    <p><strong>-u</strong></p>
  </dt>
  <dd>
    <p>This option is supplied to an alert only if it is being called as an upalert.</p>
  </dd>

</dl>
<p>The remaining arguments are supplied from the trailing parameters in the configuration file, after the "alert" service parameter.</p><p>As with monitor programs, alert programs are invoked with environment variables defined by the user in the service definition, in addition to the following which are explicitly set by the server:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>MON_LAST_SUMMARY</strong></p>
  </dt>
  <dd>
    <p>The first line of the output from the last time the monitor exited.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_OUTPUT</strong></p>
  </dt>
  <dd>
    <p>The entire output of the monitor from the last time it exited.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_FAILURE</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the last failure for this service.</p>
  </dd>
  <dt>
    <p><strong>MON_FIRST_FAILURE</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the first time this service failed.</p>
  </dd>
  <dt>
    <p><strong>MON_LAST_SUCCESS</strong></p>
  </dt>
  <dd>
    <p>The <a href="../man2/time.2.html"><strong>time</strong>(2)</a> of the last time this service passed.</p>
  </dd>
  <dt>
    <p><strong>MON_DESCRIPTION</strong></p>
  </dt>
  <dd>
    <p>The description of this service, as defined in the configuration file using the <em>description</em> tag.</p>
  </dd>
  <dt>
    <p><strong>MON_GROUP</strong></p>
  </dt>
  <dd>
    <p>The watch group which triggered this alarm</p>
  </dd>
  <dt>
    <p><strong>MON_SERVICE</strong></p>
  </dt>
  <dd>
    <p>The service heading which generated this alert</p>
  </dd>
  <dt>
    <p><strong>MON_RETVAL</strong></p>
  </dt>
  <dd>
    <p>The exit value of the failed monitor program, or return value as accepted from a trap.</p>
  </dd>
  <dt>
    <p><strong>MON_OPSTATUS</strong></p>
  </dt>
  <dd>
    <p>The operational status of the service.</p>
  </dd>
  <dt>
    <p><strong>MON_ALERTTYPE</strong></p>
  </dt>
  <dd>
    <p>Has one of the following values: "failure", "up", "startup", "trap", or "traptimeout", and signifies the type of alert which was triggered.</p>
  </dd>
  <dt>
    <p><strong>MON_TRAP_INTENDED</strong></p>
  </dt>
  <dd>
    <p>This is only set when an unknown mon trap is received and caught by the default/defaut watch/service. This contains colon separated entries of the trap's intended watch group and service name.</p>
  </dd>
  <dt>
    <p><strong>MON_LOGDIR</strong></p>
  </dt>
  <dd>
    <p>The directory log files should be placed, as indicated by the <em>logdir</em> global configuration variable.</p>
  </dd>
  <dt>
    <p><strong>MON_STATEDIR</strong></p>
  </dt>
  <dd>
    <p>The directory where state files should be kept, as indicated by the <em>statedir</em> global configuration variable.</p>
  </dd>
  <dt>
    <p><strong>MON_CFBASEDIR</strong></p>
  </dt>
  <dd>
    <p>The directory where configuration files should be kept, as indicated by the <em>cfbasedir</em> global configuration variable.</p>
  </dd>

</dl>
<p>The first line from standard input must be used as a brief summary of the problem, normally supplied as the subject line of an email, or text sent to an alphanumeric pager. Interpretation of all subsequent lines read from stdin is left up to the alerting program. The usual parameters are a list of recipients to deliver the notification to. The interpretation of the recipients is not specified, and is up to the alert program.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILE</h2>
        <div class="sectioncontent">
<p>The configuration file consists of zero or more global variable definitions, zero or more hostgroup definitions, and one or more watch definitions. Each watch definition may have one or more service definitions. A watch definition is terminated by a blank line, another definition, or the end of the file. A line beginning with optional leading whitespace and a pound ("#") is regarded as a comment, and is ignored.</p><p>Lines are parsed as they are read. Long lines may be continued by ending them with a backslash (" the trailing whitespace after the backslash, and the leading whitespace of the following line are removed. The end result is assembled into a single line.</p><p>Typically the configuration file has the following layout:</p><p>1. Global variable definitions</p><p>2. Hostgroup definitions</p><p>3. Watch definitions</p><p>See the "etc/example.cf" file which comes for the distribution for an example.</p><h3>Global Variables</h3>
<p>The following variables may be set to override compiled-in defaults. Command-line options will have a higher precedence than these definitions.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>alertdir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path to the alert scripts. This is the value set by the <strong>-a</strong> command-line parameter.</p><p>Multiple alert paths may be specified by separating them with a colon.  Non-absolute paths are taken to be relative to the base directory (<em>/usr/lib/mon</em> by default).</p><p>When the configuration file is read, all alerts referenced from the configuration will be looked up in each of these paths, and the full path to the first instance of the alert found is stored in a hash. This hash is only generated upon startup or after a "reset" command, so newly added alert scripts will not be recognized until a "reset" is performed.</p>
  </dd>
  <dt>
    <p><strong>mondir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path to the monitor scripts. This value may also be set by the <strong>-s</strong> command-line parameter. If this path does not begin with a "/", it will be relative to <em>basedir</em>.</p><p>Multiple alert paths may be specified by separating them with a colon. All paths must be absolute.</p><p>When the configuration file is read, all monitors referenced from the configuration will be looked up in each of these paths, and the full path to the first instance of the monitor found is stored in a hash. This hash is only generated upon startup or after a "reset" command, so newly added monitor scripts will not be recognized until a "reset" is performed.</p>
  </dd>
  <dt>
    <p><strong>statedir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path to the state directory. <strong>mon</strong> uses this directory to save various state information. If this path does not begin with a "/", it will be relative to <em>basedir</em>.</p>
  </dd>
  <dt>
    <p><strong>logdir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path to the log directory. <strong>mon</strong> uses this directory to save various logs, including the downtime log. If this path does not begin with a "/", it will be relative to <em>basedir</em>.</p>
  </dd>
  <dt>
    <p><strong>basedir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path for the state, log, monitor, and alert directories.</p>
  </dd>
  <dt>
    <p><strong>cfbasedir = </strong><em>dir</em></p>
  </dt>
  <dd>
    <p><em>dir</em> is the full path where all the config files can be found (monusers.cf, auth.cf, etc.).</p>
  </dd>
  <dt>
    <p><strong>authfile = </strong><em>file</em></p>
  </dt>
  <dd>
    <p><em>file</em> is the path to the authentication file. If the path does not begin with a "/", it will be relative to <em>cfbasedir</em>.</p>
  </dd>
  <dt>
    <p><strong>authtype = </strong><em>type [type...]</em></p>
  </dt>
  <dd>
    <p><em>type</em> is the type of authentication to use. A space-separated list of types may be specified, and they will be checked the order they are listed. As soon as a successful authentication is performed, the user is considered authenticated by mon for the duration of the session and no more authentication checks are performed.</p><p>If <em>type</em> is <strong>getpwnam</strong>, then the standard Unix passwd file authentication method will be used (calls <a href="../man3/getpwnam.3.html"><strong>getpwnam</strong>(3)</a> on the user and compares the <a href="../man3/crypt.3.html"><strong>crypt</strong>(3)</a>ed version of the password with what it gets from getpwnam). This will not work if shadow passwords are enabled on the system.</p><p>If <em>type</em> is <strong>userfile</strong>, then usernames and hashed passwords are read from <em>userfile</em>, which is defined via the <strong>userfile</strong> configuration variable.</p><p>If <em>type</em> is <strong>pam</strong>, then PAM (pluggable authentication modules) will be used for authentication. The service specified by the <strong>pamservice</strong> global will be used. If no global is given, the PAM <strong>passwd</strong> service will be used.</p><p>If <em>type</em> is <strong>trustlocal</strong>, then if the client connection comes from locahost, the username passed from the client will be trusted, and the password will be ignored.  This can be used when you want the client to handle the authentication for you.  I.e. a CGI script using one of the many apache authentication methods.</p>
  </dd>
  <dt>
    <p><strong>userfile = </strong><em>file</em></p>
  </dt>
  <dd>
    <p>This file is used when <strong>authtype</strong> is set to <em>userfile</em>. It consists of a sequence of lines of the format <strong>'username : password'</strong>. <strong>password</strong> is stored as the hash returned by the standard Unix <a href="../man3/crypt.3.html"><strong>crypt</strong>(3)</a> function. <strong>NOTE:</strong> the format of this file is compatible with the Apache file based username/password file format. It is possible to use the <em>htpasswd</em> program supplied with Apache to manage the mon userfile.</p><p>Blank lines and lines beginning with # are ignored.</p>
  </dd>
  <dt>
    <p><strong>pamservice = </strong><em>service</em></p>
  </dt>
  <dd>
    <p>The PAM service used for authentication. This is applicable only if "pam" is specified as a parameter to the <strong>authtype</strong> setting. If this global is not defined, it defaults to <strong>passwd</strong>.</p>
  </dd>
  <dt>
    <p><strong>serverbind = </strong><em>addr</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>trapbind = </strong><em>addr</em></p>
  </dt>
  <dd>
    <p><strong>serverbind</strong> and <strong>trapbind</strong> specify which address to bind the server and trap ports to, respectively. If these are not defined, the default address is INADDR_ANY, which allows connections on all interfaces. For security reasons, it could be a good idea to bind only to the loopback interface.</p>
  </dd>
  <dt>
    <p><strong>dtlogfile = </strong><em>file</em></p>
  </dt>
  <dd>
    <p><em>file</em> is a file which will be used to record the downtime log. Whenever a service fails for some amount of time and then stop failing, this event is written to the log. If this parameter is not set, no logging is done. The format of the file is as follows (# is a comment and may be ignored):</p><p><strong>timenoticed group service firstfail downtime interval summary</strong>.</p><p><strong>timenoticed</strong> is the <a href="../man2/time.2.html"><strong>time</strong>(2)</a> the service came back up.</p><p><strong>group service</strong> is the group and service which failed.</p><p><strong>firstfail</strong> is the <a href="../man2/time.2.html"><strong>time</strong>(2)</a> when the service began to fail.</p><p><strong>downtime</strong> is the number of seconds the service failed.</p><p><strong>interval</strong> is the frequency (in seconds) that the service is polled.</p><p><strong>summary</strong> is the summary line from when the service was failing.</p>
  </dd>
  <dt>
    <p><strong>monerrfile = </strong><em>filename</em></p>
  </dt>
  <dd>
    <p>By default, when mon daemonizes itself, it connects stdout and stderr to /dev/null. If <strong>monerrfile</strong> is set to a file, then stdout and stderr will be appended to that file. In all cases stdin is connected to /dev/null. If mon is told to run in the foreground and to not daemonize, then none of this applies, since stdin/stdout/stderr stay connected to whatever they were at the time of invocation.</p>
  </dd>
  <dt>
    <p><strong>dtlogging = </strong><em>yes/no</em></p>
  </dt>
  <dd>
    <p>Turns downtime logging on or off. The default is off.</p>
  </dd>
  <dt>
    <p><strong>histlength = </strong><em>num</em></p>
  </dt>
  <dd>
    <p><em>num</em> is the the maximum number of events to be retained in history list. The default is 100. This value may also be set by the <strong>-k</strong> command-line parameter.</p>
  </dd>
  <dt>
    <p><strong>historicfile = </strong><em>file</em></p>
  </dt>
  <dd>
    <p>If this variable is set, then alerts are logged to <em>file</em>, and upon startup, some (or all) of the past history is read into memory.</p>
  </dd>
  <dt>
    <p><strong>historictime = </strong><em>timeval</em></p>
  </dt>
  <dd>
    <p><em>num</em> is the amount of the history file to read upon startup. "Now" - <em>timeval</em> is read. See the explanation of <em>interval</em> in the "Service Definitions" section for a description of <em>timeval</em>.</p>
  </dd>
  <dt>
    <p><strong>serverport = </strong><em>port</em></p>
  </dt>
  <dd>
    <p><em>port</em> is the TCP port number that the server should bind to. This value may also be set by the <strong>-p</strong> command-line parameter. Normally this port is looked up via <a href="../man3/getservbyname.3.html"><strong>getservbyname</strong>(3)</a>, and it defaults to 2583.</p>
  </dd>
  <dt>
    <p><strong>trapport = </strong><em>port</em></p>
  </dt>
  <dd>
    <p><em>port</em> is the UDP port number that the trap server should bind to. Normally this port is looked up via <a href="../man3/getservbyname.3.html"><strong>getservbyname</strong>(3)</a>, and it defaults to 2583.</p>
  </dd>
  <dt>
    <p><strong>pidfile = </strong><em>path</em></p>
  </dt>
  <dd>
    <p><em>path</em> is the file the sever will store its pid in.  This value may also be set by the <strong>-P</strong> command-line parameter.</p>
  </dd>
  <dt>
    <p><strong>maxprocs = </strong><em>num</em></p>
  </dt>
  <dd>
    <p>Throttles the number of concurrently forked processes to <em>num.</em> The intent is to provide a safety net for the unlikely situation when the server tries to take on too many tasks at once.  Note that this situation has only been reported to happen when trying to use a garbled configuration file! You don't want to use a garbled configuration file now, do you?</p>
  </dd>
  <dt>
    <p><strong>cltimeout = </strong><em>secs</em></p>
  </dt>
  <dd>
    <p>Sets the client inactivity timeout to <em>secs.</em> This is meant to help thwart denial of service attacks or recover from crashed clients. <em>secs</em> is interpreted as a "1h/1m/1s" string, where "1m" = 60 seconds.</p>
  </dd>
  <dt>
    <p><strong>randstart = </strong><em>interval</em></p>
  </dt>
  <dd>
    <p>When the server starts, normally all services will not be scheduled until the interval defined in the respective service section. This can cause long delays before the first check of a service, and possibly a high load on the server if multiple things are scheduled at the same intervals. This option is used to randomize the scheduling of the first test for all services during the startup period, and immediately after the <em>reset</em> command. If <em>randstart</em> is defined, the scheduled run time of all services of all watch groups will be a random number between zero and <em>randstart</em> seconds.</p>
  </dd>
  <dt>
    <p><strong>dep_recur_limit = </strong><em>depth</em></p>
  </dt>
  <dd>
    <p>Limit dependency recursion level to <em>depth</em>. If dependency recursion (dependencies which depend on other dependencies) tries to go beyond <em>depth</em>, then the recursion is aborted and a messages is logged to syslog. The default limit is 10.</p>
  </dd>
  <dt>
    <p><strong>dep_behavior = </strong><em>{a|m|hm}</em></p>
  </dt>
  <dd>
    <p><strong>dep_behavior</strong> controls whether the dependency expression suppresses one of: the running of alerts, the running of monitors, or the passing of individual hosts to the monitors. Read more about the behavior in the "Service Definitions" section below.</p><p>This is a global setting which controls the default settings for the service-specified variable.</p>
  </dd>
  <dt>
    <p><strong>dep_memory = </strong><em>timeval</em></p>
  </dt>
  <dd>
    <p>If set, dep_memory will cause dependencies to continue to prevent alerts/monitoring for a period of time after the service returns to a normal state.  This can be used to prevent over-eager alerting when a machine is rebooting, for example.  See the explanation of <em>interval</em> in the "Service Definitions" section for a description of <em>timeval</em>.</p><p>This is a global setting which controls the default settings for the service-specified variable.</p>
  </dd>
  <dt>
    <p><strong>syslog_facility = </strong><em>facility</em></p>
  </dt>
  <dd>
    <p>Specifies the syslog facility used for logging. <strong>daemon</strong> is the default.</p>
  </dd>
  <dt>
    <p><strong>startupalerts_on_reset = </strong><em>{yes|no}</em></p>
  </dt>
  <dd>
    <p>If set to "yes", startupalerts will be invoked when the <strong>reset</strong> client command is executed. The default is "no".</p>
  </dd>
  <dt>
    <p><strong>monremote = </strong><em>program</em></p>
  </dt>
  <dd>
    <p>If set, this external program will be called by Mon when various client requests are processed.  This can be used to propagate those changes from one Mon server to another, if you have multiple monitoring machines.  An example script, <strong>monremote.pl</strong> is available in the clients directory.</p>
  </dd>

</dl>

<h3>Hostgroup Entries</h3>
<p>Hostgroup entries begin with the keyword <strong>hostgroup</strong>, and are followed by a hostgroup tag and one or more hostnames or IP addresses, separated by whitespace. The hostgroup tag must be composed of alphanumeric characters, a dash ("-"), a period ("."), or an underscore ("_"). Non-blank lines following the first hostgroup line are interpreted as more hostnames. The hostgroup definition ends with a blank line. For example:</p>
<pre>
hostgroup servers nameserver smtpserver nntpserver
	nfsserver httpserver smbserver

hostgroup router_group cisco7000 agsplus
</pre>

<h3>View Entries</h3>
<p>View entries begin with the keyword <strong>view</strong>, and are followed by a view tag and the names of one or more hostgroups.  The view tag must be composed of alphanumeric characters, a dash ("-"), a period ("."), or an underscore ("_"). Non-blank lines following the first view line are interpreted as more hostgroup names. The view definition ends with a blank line. For example:</p>
<pre>
view servers dns-servers web-servers file-servers
     mail-servers

view network-services routers switches vpn-servers
</pre>

<h3>Watch Group Entries</h3>
<p>Watch entries begin with a line that starts with the keyword <strong>watch</strong>, followed by whitespace and a single word which normally refers to a pre-defined hostgroup. If the second word is not recognized as a hostgroup tag, a new hostgroup is created whose tag is that word, and that word is its only member.</p><p>Watch entries consist of one or more service definitions.</p><p>A watch group is terminated by a blank line, the end of the file, or by a subsequent definition, "watch", "hostgroup", or otherwise.</p><p>There may be a special watch group entry called "default". If a default watch group is defined with a service entry named "default", then this definition will be used in handling traps received for an unrecognized watch and service.</p>
<h3>Service Definitions</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>service</strong><em> servicename</em></p>
  </dt>
  <dd>
    <p>A service definition begins with they keyword <strong>service</strong> followed by a word which is the tag for this service. This word must be unique among all services defined for the same watch group.</p><p>The components of a service are an interval, monitor, and one or more time period definitions, as defined below.</p><p>If a service name of "default" is defined within a watch group called "dafault" (see above), then the default/default definition will be used for handling unknown mon traps.</p><p>The following configuration parameters are valid only following a service definition:</p>
  </dd>
  <dt>
    <p><strong>VARIABLE=</strong><em>value</em></p>
  </dt>
  <dd>
    <p>Environment variables may be defined for each service, which will be included in the environment of monitors and alerts. Variables must be specified in all capital letters, must begin with an alphabetical character or an underscore, and there must be no spaces to the left of the equal sign.</p>
  </dd>
  <dt>
    <p><strong>interval</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>The keyword <strong>interval</strong> followed by a time value specifies the frequency that a monitor script will be triggered. Time values are defined as "30s", "5m", "1h", or "1d", meaning 30 seconds, 5 minutes, 1 hour, or 1 day. The numeric portion may be a fraction, such as "1.5h" or an hour and a half. This format of a time specification will be referred to as <em>timeval</em>.</p>
  </dd>
  <dt>
    <p><strong>failure_interval</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>Adjusts the polling interval to <em>timeval</em> when the service check is failing. Resets the interval to the original when the service succeeds.</p>
  </dd>
  <dt>
    <p><strong>traptimeout</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>This keyword takes the same time specification argument as <strong>interval</strong><em>,</em> and makes the service expect a trap from an external source at least that often, else a failure will be registered. This is used for a heartbeat-style service.</p>
  </dd>
  <dt>
    <p><strong>trapduration</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>If a trap is received, the status of the service the trap was delivered to will normally remain constant. If <strong>trapduration</strong> is specified, the status of the service will remain in a failure state for the duration specified by <em>timeval</em>, and then it will be reset to "success".</p>
  </dd>
  <dt>
    <p><strong>randskew</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>Rather than schedule the monitor script to run at the start of each interval, randomly adjust the interval specified by the <strong>interval</strong> parameter by plus-or-minus <strong>randskew .</strong> The skew value is specified as the <strong>interval</strong> parameter: "30s", "5m", etc... For example if <strong>interval</strong> is 1m, and <strong>randskew</strong> is "5s", then <em>mon</em> will schedule the monitor script some time between every 55 seconds and 65 seconds. The intent is to help distribute the load on the server when many services are scheduled at the same intervals.</p>
  </dd>
  <dt>
    <p><strong>monitor</strong><em> monitor-name [arg...]</em></p>
  </dt>
  <dd>
    <p>The keyword <strong>monitor</strong> followed by a script name and arguments specifies the monitor to run when the timer expires. Shell-like quoting conventions are followed when specifying the arguments to send to the monitor script. The script is invoked from the directory given with the <strong>-s</strong> argument, and all following words are supplied as arguments to the monitor program, followed by the list of hosts in the group referred to by the current watch group. If the monitor line ends with ";;" as a separate word, the host groups are not appended to the argument list when the program is invoked.</p>
  </dd>
  <dt>
    <p><strong>allow_empty_group</strong></p>
  </dt>
  <dd>
    <p>The <strong>allow_empty_group</strong> option will allow a monitor to be invoked even when the hostgroup for that watch is empty because of disabled hosts. The default behavior is not to invoke the monitor when all hosts in a hostgroup have been disabled.</p>
  </dd>
  <dt>
    <p><strong>description</strong><em> descriptiontext</em></p>
  </dt>
  <dd>
    <p>The text following <strong>description</strong> is queried by client programs, passed to alerts and monitors via an environment variable. It should contain a brief description of the service, suitable for inclusion in an email or on a web page.</p>
  </dd>
  <dt>
    <p><strong>exclude_hosts</strong><em> host [host...]</em></p>
  </dt>
  <dd>
    <p>Any hosts listed after <strong>exclude_hosts</strong> will be excluded from the service check.</p>
  </dd>
  <dt>
    <p><strong>exclude_period</strong><em> periodspec</em></p>
  </dt>
  <dd>
    <p>Do not run a scheduled monitor during the time identified by <em>periodspec</em>.</p>
  </dd>
  <dt>
    <p><strong>depend</strong><em> dependexpression</em></p>
  </dt>
  <dd>
    <p>The <strong>depend</strong> keyword is used to specify a dependency expression, which evaluates to either true of false, in the boolean sense. Dependencies are actual Perl expressions, and must obey all syntactical rules. The expressions are evaluated in their own package space so as to not accidentally have some unwanted side-effect. If a syntax error is found when evaluating the expression, it is logged via syslog.</p><p>Before evaluation, the following substitutions on the expression occur: phrases which look like "group:service" are substituted with the value of the current operational status of that specified service. These opstatus substitutions are computed recursively, so if service A depends upon service B, and service B depends upon service C, then service A depends upon service C. Successful operational statuses (which evaluate to "1") are "STAT_OK", "STAT_COLDSTART", "STAT_WARMSTART", and "STAT_UNKNOWN".  The word "SELF" (in all caps) can be used for the group (e.g. "SELF:service"), and is an abbreviation for the current watch group.</p><p>This feature can be used to control alerts for services which are dependent on other services, e.g. an SMTP test which is dependent upon the machine being ping-reachable.</p>
  </dd>
  <dt>
    <p><strong>dep_behavior</strong><em> {a|m|hm}</em></p>
  </dt>
  <dd>
    <p>The evaluation of the dependency graphs specified via the <strong>depend</strong> keyword can control the suppression of alert or monitor invocations, or the suppression of individual hosts passed to the monitor.</p><p><strong>Alert suppression</strong>. If this option is set to "a", then the dependency expression will be evaluated after the monitor for the service exits or after a trap is received. An alert will only be sent if the evaluation succeeds, meaning that none of the nodes in the dependency graph indicate failure.</p><p><strong>Monitor suppression</strong>. If it is set to "m", then the dependency expression will be evaulated before the monitor for the service is about to run. If the evaulation succeeds, then the monitor will be run. Otherwise, the monitor will not be run and the status of the service will remain the same.</p><p><strong>Host suppression</strong>. If it is set to "hm" then Mon will extract the list of "parent" services from the dependency expression.  (In fact the expression can be just a list of services.) Then when the monitor for the service is about to be run, for each host in the current hostgroup Mon will search all the parent services which are currently failing and look for the hostname in the current summary output.  If the hostname is found, this host will be excluded from this run of the monitor.  This can be used to e.g. allow an SMTP test on a group of hosts to still be run even when a single host is not ping-reachable.  If all the rest of the hosts are working fine, the service will be in an OK state, but if another host fails the SMTP test Mon can still alert about that host even though the parent dependency was failing.  The dependency expression will <strong>not</strong> be used recursively in this case.</p>
  </dd>
  <dt>
    <p><strong>alertdepend</strong><em> dependexpression</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>monitordepend</strong><em> dependexpression</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>hostdepend</strong><em> dependexpression</em></p>
  </dt>
  <dd>
    <p>These keywords allow you to specify multiple dependency expressions of different types.  Each one corresponds to the different <strong>dep_behavior</strong> settings listed above.  They will be evaluated independently in the different contexts as listed above.  If <strong>depend</strong> is present, it takes precedence over the matching keyword, depending on the <strong>dep_behavior</strong> setting.</p>
  </dd>
  <dt>
    <p><strong>dep_memory </strong><em>timeval</em></p>
  </dt>
  <dd>
    <p>If set, dep_memory will cause dependencies to continue to prevent alerts/monitoring for a period of time after the service returns to a normal state.  This can be used to prevent over-eager alerting when a machine is rebooting, for example.  See the explanation of <em>interval</em> in the "Service Definitions" section for a description of <em>timeval</em>.</p>
  </dd>
  <dt>
    <p><strong>redistribute</strong><em> alert [arg...]</em></p>
  </dt>
  <dd>
    <p>A service may have one redistribute option, which is a special form of an an alert definition.  This alert will be called on every service status update, even sequential success status updates.  This can be used to integrate Mon with another monitoring system, or to link together multiple Mon servers via an alert script that generates Mon traps.  See the "ALERT PROGRAMS" section above for a list of the parameters mon will pass automatically to alert programs.</p>
  </dd>
  <dt>
    <p><strong>unack_summary</strong></p>
  </dt>
  <dd>
    <p>Remove the "acknowledged" state from a service if the summary component of the failure message changes.  In most common usage the summary is the list of hosts that are failing, so additional hosts failing would remove an ack.</p>
  </dd>

</dl>

<h3>Period Definitions</h3>
<p>Periods are used to define the conditions which should allow alerts to be delivered.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>period</strong><em> [label:] periodspec</em></p>
  </dt>
  <dd>
    <p>A period groups one or more alarms and variables which control how often an alert happens when there is a failure. The <strong>period</strong> definition has two forms. The first takes an argument which is a period specification from Patrick Ryan's Time::Period Perl 5 module. Refer to "perldoc Time::Period" for more information.</p><p>The second form requires a label followed by a period specification, as defined above. The label is a tag consisting of an alphabetic character or underscore followed by zero or more alphanumerics or underscores and ending with a colon. This form allows multiple periods with the same period definition. One use is to have a period definition which has no <strong>alertafter</strong> or <strong>alertevery</strong> parameters for a particular time period, and another for the same time period with a different set of alerts that does contain those parameters.</p><p>Period definitions, in either the first or second form, must be unique within each service definition. For example, if you need to define two periods both for "wd {Sun-Sat}", then one or both of the period definitions must specify a label such as "period t1: wd {Sun-Sat}" and "period t2: wd {Sun-Sat}".</p>
  </dd>
  <dt>
    <p><strong>alertevery</strong><em> timeval [observe_detail | strict]</em></p>
  </dt>
  <dd>
    <p>The <strong>alertevery</strong> keyword (within a <strong>period</strong> definition) takes the same type of argument as the <strong>interval</strong> variable, and limits the number of times an alert is sent when the service continues to fail. For example, if the interval is "1h", then only the alerts in the period section will only be triggered once every hour. If the <strong>alertevery</strong> keyword is omitted in a period entry, an alert will be sent out every time a failure is detected. By default, if the summary output of two successive failures changes, then the alertevery interval is overridden, and an alert will be sent. If the string "observe_detail" is the last argument, then both the summary and detail output lines will be considered when comparing the output of successive failures. If the string "strict" is the last argument, then the output of the monitor or the state change of the service will have no effect on when alerts are sent. That is, "alertevery 24h strict" will send only one alert every 24 hours, no matter what. Please refer to the <strong>ALERT DECISION LOGIC</strong> section for a detailed explanation of how alerts are suppressed.</p>
  </dd>
  <dt>
    <p><strong>alertafter</strong><em> num</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>alertafter</strong><em> num timeval</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>alertafter</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>The <strong>alertafter</strong> keyword (within a <strong>period</strong> section) has three forms: only with the "num" argument, or with the "num timeval" arguments, or only with the "timeval" argument. In the first form, an alert will only be invoked after "num" consecutive failures.</p><p>In the second form, the arguments are a positive integer followed by an interval, as described by the <strong>interval</strong> variable above. If these parameters are specified, then the alerts for that period will only be called after that many failures happen within that interval. For example, if <strong>alertafter</strong> is given the arguments "3&nbsp;30m", then the alert will be called if 3 failures happen within 30 minutes.</p><p>In the third form, the argument is an interval, as described by the <strong>interval</strong> variable above. Alerts for that period will only be called if the service has been in a failure state for more than the length of time desribed by the interval, regardless of the number of failures noticed within that interval.</p>
  </dd>
  <dt>
    <p><strong>numalerts</strong><em> num</em></p>
  </dt>
  <dd>
    <p>This variable tells the server to call no more than <em>num</em> alerts during a failure. The alert counter is kept on a per-period basis, and is reset upon each success.</p>
  </dd>
  <dt>
    <p><strong>no_comp_alerts</strong></p>
  </dt>
  <dd>
    <p>If this option is specified, then upalerts will be called whenever the service state changes from failure to success, rather than only after a corresponding "down" alert.</p>
  </dd>
  <dt>
    <p><strong>alert</strong><em> alert [arg...]</em></p>
  </dt>
  <dd>
    <p>A period may contain multiple alerts, which are triggered upon failure of the service. An alert is specified with the <strong>alert</strong> keyword, followed by an optional <strong>exit</strong> parameter, and arguments which are interpreted the same as the <strong>monitor</strong> definition, but without the ";;" exception. The <strong>exit</strong> parameter takes the form of <strong>exit=x</strong> or <strong>exit=x-y</strong> and has the effect that the alert is only called if the exit status of the monitor script falls within the range of the <strong>exit</strong> parameter. If, for example, the alert line is <em>alert exit=10-20 mail.alert mis</em> then <em>mail-alert</em> will only be invoked with <em>mis</em> as its arguments if the monitor program's exit value is between 10 and 20. This feature allows you to trigger different alerts at different severity levels (like when free disk space goes from 8% to 3%).</p><p>See the <strong>ALERT PROGRAMS</strong> section above for a list of the pramaeters mon will pass automatically to alert programs.</p>
  </dd>
  <dt>
    <p><strong>upalert</strong><em> alert [arg...]</em></p>
  </dt>
  <dd>
    <p>An <strong>upalert</strong> is the compliment of an <strong>alert</strong>. An upalert is called when a services makes the state transition from failure to success, if a corresponding "down" alert was previously sent. The <strong>upalert</strong> script is called supplying the same parameters as the <strong>alert</strong> script, with the addition of the <strong>-u</strong> parameter which is simply used to let an alert script know that it is being called as an upalert. Multiple upalerts may be specified for each period definition. Set the per-period <strong>no_comp_alerts</strong> option to send an upalert regardless if whether or not a "down" alert was  sent.</p>
  </dd>
  <dt>
    <p><strong>startupalert</strong><em> alert [arg...]</em></p>
  </dt>
  <dd>
    <p>A <strong>startupalert</strong> is only called when the <strong>mon</strong> server starts execution, or when a "reset" command was issued to the server, depending on the setting of the <strong>startupalerts_on_reset</strong> global. Unlike other alerts, <strong>startupalerts</strong> are not called following the exit of a monitor, i.e. they are called in their own right, therefore the "exit=" argument is not applicable to <strong>startupalert.</strong></p>
  </dd>
  <dt>
    <p><strong>upalertafter</strong><em> timeval</em></p>
  </dt>
  <dd>
    <p>The <strong>upalertafter</strong> parameter is specified as a string that follows the syntax of the <strong>interval</strong> parameter ("30s", "1m", etc.), and controls the triggering of an <strong>upalert</strong>. If a service comes back up after being down for a time greater than or equal to the value of this option, an <strong>upalert</strong> will be called. Use this option to prevent upalerts to be called because of "blips" (brief outages).</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHENTICATION CONFIGURATION FILE</h2>
        <div class="sectioncontent">
<p>The file specified by the <strong>authfile</strong> variable in the configuration file (or passed via the <strong>-A</strong> parameter) will be loaded upon startup. This file defines restrictions upon which client commands may be executed by which users. It is a text file which consists of comments, command definitions, and trap authentication parameters. A comment line begins with optional whitespace followed by pound sign. Blank lines are ignored.</p><p>The file is separated into a command section and a trap section. Sections are specified by a single line containing one of the following statements:</p>
<pre>
	command section
</pre>
<p>or</p>
<pre>
	trap section
</pre>
<p>Lines following one of the above statements apply to that section until either the end of the file or another section begins.</p><p>A command definition consists of a command, followed by a colon, followed by a comma-separated list of users who may execute the command. The default is that no users may execute any commands unless they are explicitly allowed in this configuration file. For clarity, a user can be denied by prefixing the user name with "!". If the word "AUTH_ANY" is used for a username, then any authenticated user will be allowed to execute the command. If the word "all" is used for a username, then that command may be executed by any user, authenticated or not.</p><p>The trap section allows configuration of which users may send traps from which hosts. The syntax is a source host (name or ip address), whitespace, a username, whitespace, and a plaintext password for that user. If the source host is "*", then allow traps from any host. If the username is "*", then accept traps without regard for the username or password. If no hosts or users are specified, then no traps will be accepted.</p><p>An example configuration file:</p>
<pre>
command section
list:		all
reset:		root,admin
loadstate:      	root
savestate:      	root

trap section
127.0.0.1	root	r@@tp4sswrd
</pre>
<p>This means that all clients are able to perform the <strong>list</strong> command, "root" is able to perform "reset", "loadstate", "savestate", and "admin" is able to execute the "reset" command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CLIENT-SERVER&nbsp;INTERFACE</h2>
        <div class="sectioncontent">
<p>The server listens on TCP port 2583, which may be overridden using the <strong>-p</strong><em>port</em> option. Commands are a single line each, terminated by a newline. The server can handle any number of simultaneous client connections.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CLIENT&nbsp;INTERFACE&nbsp;COMMANDS</h2>
        <div class="sectioncontent">
<p>See manual page for <strong>moncmd</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MON&nbsp;TRAPPING</h2>
        <div class="sectioncontent">
<p>Mon has the facility to receive special "mon traps" from any local or remote machine. Currently, the only available method for sending mon traps are through the Mon::Client perl interface, though the UDP packet format is defined well enough to permit the writing of traps in other languages.</p><p>Traps are handled similarly to monitors: a trap sends an operational status, summary line, and description text, and mon generates an alert or upalert as necessary.</p><p>Traps can be caught by any watch/service group set up in the mon configuration file, however it is suggested that you configure watch/service groups specifically for the traps you expect to receive. When defining a special watch/service group for traps, do not include a "monitor" directive (as no monitor need be invoked). Since a monitor is not being invoked, it is not necessary for the watch definition to have a hostgroup which contains real host names. Just make up a useful name, and mon will automatically create the watch group for you.</p><p>Here is a simple config file example:</p>
<pre>
watch trap-service
	service host1-disks
		description TRAP: for host1 disk status
		period wd {Sun-Sat}
			alert mail.alert someone@your.org
			upalert mail.alert -u someone@your.org

</pre>
<p>Since mon listens on a UDP port for any trap, a default facility is available for handling traps to unknown groups or services. To enable this facility, you must include a "default" watch group with a "default" service entry containing the specifics of alarms.  If a default/default watch group and service are not configured, then unknown traps get logged via syslog, and no alarm is sent. <strong>NOTE:</strong> The default/default facility is a single entity as far as accounting and alarming go. Alarm programs which are not aware of this fact may send confusing information when a failure trap comes from one machine, followed by a success (ok) trap from a different machine. See the alarm environment variable <strong>MON_TRAP_INTENDED</strong> above for a possible way around this. It is intended that default/default be used as a facility to catch unknown traps, and should not be relied upon to catch all traps in a production environment. If you are lazy and only want to use default/default for catching all traps, it would be best to disable upalerts, and use the MON_TRAP_INTENDED environment variable in alert scripts to make the alerts more meaningful to you.</p><p>Here is an example default facility:</p>
<pre>
watch default
	service default
		description Default trap service
		period wd {Sun-Sat}
			alert mail.alert someone@your.org
			upalert mail.alert -u someone@your.org

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The <strong>mon</strong> distribution comes with an example configuration called <em>example.cf</em>. Refer to that file for more information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mon&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/moncmd.1.html"><strong>moncmd</strong>(1)</a>, <strong>Time::Period</strong>(3pm), <strong>Mon::Client</strong>(3pm)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p><strong>mon</strong> was written because I couldn't find anything out there that did just what I needed, and nothing was worth modifying to add the features I wanted. It doesn't have a cool name, and that bothers me because I couldn't think of one.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to the email address below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jim Trocki &lt;trockij@arctic.org&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="molly-guard.8.html"><span aria-hidden="true">&larr;</span> molly-guard.8: Guard against accidental shutdowns/reboots</a></li>
   <li class="next"><a href="monitor.8.html">monitor.8: Directory server script for monitoring database performance <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
