<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tc-ematch: Extended matches for use with "basic" or "flow" filters</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Extended matches for use with "basic" or "flow" filters">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="tc-ematch (8) manual">
  <meta name="twitter:description" content="Extended matches for use with "basic" or "flow" filters">
  <meta name="twitter:image" content="https://www.carta.tech/images/iproute2-tc-ematch-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/tc-ematch.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="tc-ematch (8) manual" />
  <meta property="og:description" content="Extended matches for use with "basic" or "flow" filters" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/iproute2-tc-ematch-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">tc-ematch<small> (8)</small></h1>
        <p class="lead">Extended matches for use with "basic" or "flow" filters</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tc-ematch.8.html">
      <span itemprop="name">tc-ematch: Extended matches for use with "basic" or "flow" filters</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/iproute2/">
      <span itemprop="name">iproute2</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tc-ematch.8.html">
      <span itemprop="name">tc-ematch: Extended matches for use with "basic" or "flow" filters</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>tc filter add .. basic match</strong> EXPR <strong>.. flowid ..</strong></p><p><em>EXPR</em> := <em>TERM</em> [ {  <strong>and | or</strong> } <em>EXPR</em> ]</p><p><em>TERM</em> := [ <em></em><strong>not</strong> ] { <em>MATCH</em> | '(' <em>EXPR</em> ')' } </p><p><em>MATCH</em> := <em>module</em> '(' <em>ARGS</em> ')' </p><p><em>ARGS</em> := <em>ARG1</em> <em>ARG2</em> ..</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MATCHES</h2>
        <div class="sectioncontent">
<h3>cmp</h3>
<p>Simple comparison ematch: arithmetic compare of packet data to a given value.</p><p><em>cmp</em>( <em>ALIGN</em> at <em>OFFSET</em> [ <em>ATTRS</em> ] { <em>eq</em> | <em>lt</em> | <em>gt</em> } <em>VALUE</em> )</p><p><em>ALIGN</em> := { <em>u8</em> | <em>u16</em> | <em>u32</em> } </p><p><em>ATTRS</em> := [ layer <em>LAYER</em> ] [ mask <em>MASK</em> ] [ trans ]</p><p><em>LAYER</em> := { <em>link</em> | <em>network</em> | <em>transport</em> | <em>0..2</em> }</p>
<h3>meta</h3>
<p>Metadata ematch</p><p><em>meta</em>( <em>OBJECT</em> { <em>eq</em> | <em>lt</em> |<em>gt</em> } <em>OBJECT</em> )</p><p><em>OBJECT</em> := { <em>META_ID</em> |  <em>VALUE</em> }</p><p><em>META_ID</em> := <em>id</em> [ shift <em>SHIFT</em> ] [ mask <em>MASK</em> ]</p>
<dl class='dl-vertical'>
  <dt>
    <p>meta attributes:</p>
  </dt>
  <dd>
    <p><strong>random</strong> 32 bit random value</p><p><strong>loadavg_1</strong> Load average in last 5 minutes</p><p><strong>nf_mark</strong> Netfilter mark</p><p><strong>vlan</strong> Vlan tag</p><p><strong>sk_rcvbuf</strong> Receive buffer size</p><p><strong>sk_snd_queue</strong> Send queue length</p>
  </dd>

</dl>
<p>A full list of meta attributes can be obtained via</p><p># tc filter add dev eth1 basic match 'meta(list)'</p>
<h3>nbyte</h3>
<p>match packet data byte sequence</p><p><em>nbyte</em>( <em>NEEDLE</em> at <em>OFFSET</em> [ layer <em>LAYER</em> ] )</p><p><em>NEEDLE</em> := { <em>string</em> | <em>c-escape-sequence</em>  } </p><p><em>OFFSET</em> := <em>int</em></p><p><em>LAYER</em> := { <em>link</em> | <em>network</em> | <em>transport</em> | <em>0..2</em> }</p>
<h3>u32</h3>
<p>u32 ematch</p><p><em>u32</em>( <em>ALIGN</em> <em>VALUE</em> <em>MASK</em> at [ nexthdr+ ] <em>OFFSET</em> )</p><p><em>ALIGN</em> := { <em>u8</em> | <em>u16</em> | <em>u32</em> }</p>
<h3>ipset</h3>
<p>test packet against ipset membership</p><p><em>ipset</em>( <em>SETNAME</em> <em>FLAGS</em> )</p><p><em>SETNAME</em> := <em>string</em></p><p><em>FLAGS</em> := { <em>FLAG</em> [, <em>FLAGS</em>] }</p><p>The flag options are the same as those used by the iptables "set" match.</p><p>When using the ipset ematch with the "ip_set_hash:net,iface" set type, the interface can be queried using "src,dst (source ip address, outgoing interface) or "src,src" (source ip address, incoming interface) syntax.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<p>The ematch syntax uses '(' and ')' to group expressions. All braces need to be escaped properly to prevent shell commandline from interpreting these directly.</p><p>When using the ipset ematch with the "ifb" device, the outgoing device will be the ifb device itself, e.g. "ifb0". The original interface (i.e. the device the packet arrived on) is treated as the incoming interface.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE & USAGE</h2>
        <div class="sectioncontent">
<p># tc filter add .. basic match ...</p><p># 'cmp(u16 at 3 layer 2 mask 0xff00 gt 20)'</p><p># 'meta(nfmark gt 24)' and 'meta(tcindex mask 0xf0 eq 0xf0)'</p><p># 'nbyte("ababa" at 12 layer 1)'</p><p># 'u32(u16 0x1122 0xffff at nexthdr+4)'</p><p>Check if packet source ip address is member of set named <strong>bulk</strong>:</p><p># 'ipset(bulk src)'</p><p>Check if packet source ip and the interface the packet arrived on is member of "hash:net,iface" set named <strong>interactive</strong>:</p><p># 'ipset(interactive src,src)'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>The extended match infrastructure was added by Thomas Graf.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="tc-drr.8.html"><span aria-hidden="true">&larr;</span> tc-drr.8: Deficit round robin scheduler</a></li>
   <li class="next"><a href="tc-fq_codel.8.html">tc-fq_codel.8: Fair queuing (fq) with controlled delay (codel) <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
