<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pam_tally - The login counter (tallying) module</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The login counter (tallying) module">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pam_tally<small> (8)</small></h1>
        <p class="lead">The login counter (tallying) module</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="/"><span itemprop="title">Carta.tech</span></a>
	</li>
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">man-pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man8/"><span itemprop="title">System administration commands</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man8/pam_tally.8.html"><span itemprop="title">pam_tally</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<p><strong>pam_tally.so</strong> [file=<em>/path/to/counter</em>] [onerr=[<em>fail</em>|<em>succeed</em>]] [magic_root] [even_deny_root_account] [deny=<em>n</em>] [lock_time=<em>n</em>] [unlock_time=<em>n</em>] [per_user] [no_lock_time] [no_reset] [audit] [silent] [no_log_info] <strong>pam_tally</strong> [--file&nbsp;<em>/path/to/counter</em>] [--user&nbsp;<em>username</em>] [--reset[=<em>n</em>]] [--quiet]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>This module maintains a count of attempted accesses, can reset count on success, can deny access if too many attempts fail.</p>
<p class='spacer'>

<p>pam_tally has several limitations, which are solved with pam_tally2. For this reason pam_tally is deprecated and will be removed in a future release.</p>
<p class='spacer'>

<p>pam_tally comes in two parts: <strong>pam_tally.so</strong> and <strong>pam_tally</strong>. The former is the PAM module and the latter, a stand-alone program. <strong>pam_tally</strong> is an (optional) application which can be used to interrogate and manipulate the counter file. It can display users&apos; counts, set individual counts, or clear all counts. Setting artificially high counts may be useful for blocking users without changing their passwords. For example, one might find it useful to clear all counts every midnight from a cron job. The <a href="../man8/faillog.8.html"><strong>faillog</strong>(8)</a> command can be used instead of pam_tally to to maintain the counter file.</p>
<p class='spacer'>

<p>Normally, failed attempts to access <em>root</em> will <strong>not</strong> cause the root account to become blocked, to prevent denial-of-service: if your users aren&apos;t given shell accounts and root may only login via <strong>su</strong> or at the machine console (not telnet/rsh, etc), this is safe.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<p class='spacer'>

  <p>GLOBAL OPTIONS This can be used for <em>auth</em> and <em>account</em> module types.</p>
<p class='spacer'>

  <p><strong>onerr=[</strong><strong><em>fail</em></strong><strong>|</strong><strong><em>succeed</em></strong><strong>]</strong> If something weird happens (like unable to open the file), return with <strong>PAM_SUCCESS</strong> if <strong>onerr=</strong><strong><em>succeed</em></strong> is given, else with the corresponding PAM error code.</p>
<p class='spacer'>

  <p><strong>file=</strong><strong><em>/path/to/counter</em></strong> File where to keep counts. Default is /var/log/faillog.</p>
<p class='spacer'>

  <p><strong>audit</strong> Will log the user name into the system log if the user is not found.</p>
<p class='spacer'>

  <p><strong>silent</strong> Don&apos;t print informative messages.</p>
<p class='spacer'>

<p><strong>no_log_info</strong> Don&apos;t log informative messages via <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a>.</p>
<p class='spacer'>

  <p>AUTH OPTIONS Authentication phase first checks if user should be denied access and if not it increments attempted login counter. Then on call to <a href="../man3/pam_setcred.3.html"><strong>pam_setcred</strong>(3)</a> it resets the attempts counter.</p>
<p class='spacer'>

  <p><strong>deny=</strong><strong><em>n</em></strong> Deny access if tally for this user exceeds <em>n</em>.</p>
<p class='spacer'>

  <p><strong>lock_time=</strong><strong><em>n</em></strong> Always deny for <em>n</em> seconds after failed attempt.</p>
<p class='spacer'>

  <p><strong>unlock_time=</strong><strong><em>n</em></strong> Allow access after <em>n</em> seconds after failed attempt. If this option is used the user will be locked out for the specified amount of time after he exceeded his maximum allowed attempts. Otherwise the account is locked until the lock is removed by a manual intervention of the system administrator.</p>
<p class='spacer'>

  <p><strong>magic_root</strong> If the module is invoked by a user with uid=0 the counter is not incremented. The sysadmin should use this for user launched services, like <strong>su</strong>, otherwise this argument should be omitted.</p>
<p class='spacer'>

  <p><strong>no_lock_time</strong> Do not use the .fail_locktime field in /var/log/faillog for this user.</p>
<p class='spacer'>

  <p><strong>no_reset</strong> Don&apos;t reset count on successful entry, only decrement.</p>
<p class='spacer'>

  <p><strong>even_deny_root_account</strong> Root account can become unavailable.</p>
<p class='spacer'>

  <p><strong>per_user</strong> If /var/log/faillog contains a non-zero .fail_max/.fail_locktime field for this user then use it instead of <strong>deny=</strong><strong><em>n</em></strong>/ <strong>lock_time=</strong><strong><em>n</em></strong> parameter.</p>
<p class='spacer'>

<p><strong>no_lock_time</strong> Don&apos;t use .fail_locktime filed in /var/log/faillog for this user.</p>
<p class='spacer'>

  <p>ACCOUNT OPTIONS Account phase resets attempts counter if the user is <strong>not</strong> magic root. This phase can be used optionally for services which don&apos;t call <a href="../man3/pam_setcred.3.html"><strong>pam_setcred</strong>(3)</a> correctly or if the reset should be done regardless of the failure of the account phase of other modules.</p>
<p class='spacer'>

  <p><strong>magic_root</strong> If the module is invoked by a user with uid=0 the counter is not incremented. The sysadmin should use this for user launched services, like <strong>su</strong>, otherwise this argument should be omitted.</p>
<p class='spacer'>

<p><strong>no_reset</strong> Don&apos;t reset count on successful entry, only decrement.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MODULE TYPES PROVIDED</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>The <strong>auth</strong> and <strong>account</strong> module types are provided.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUES</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>PAM_AUTH_ERR A invalid option was given, the module was not able to retrieve the user name, no valid counter file was found, or too many failed logins.</p>
<p class='spacer'>

<p>PAM_SUCCESS Everything was successful.</p>
<p class='spacer'>

<p>PAM_USER_UNKNOWN User not known.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>Add the following line to /etc/pam.d/login to lock the account after too many failed logins. The number of allowed fails is specified by /var/log/faillog and needs to be set with pam_tally or <a href="../man8/faillog.8.html"><strong>faillog</strong>(8)</a> before.</p>
<p class='spacer'>

<pre>auth     required       pam_securetty.so
auth     required       pam_tally.so per_user
auth     required       pam_env.so
auth     required       pam_unix.so
auth     required       pam_nologin.so
account  required       pam_unix.so
password required       pam_unix.so
session  required       pam_limits.so
session  required       pam_unix.so
session  required       pam_lastlog.so nowtmp
session  optional       pam_mail.so standard
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>/var/log/faillog failure logging file</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p><a href="../man8/faillog.8.html"><strong>faillog</strong>(8)</a>, <a href="../man5/pam.conf.5.html"><strong>pam.conf</strong>(5)</a>, <a href="../man5/pam.d.5.html"><strong>pam.d</strong>(5)</a>, <strong>pam</strong>(7)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>pam_tally was written by Tim Baverstock and Tomas Mraz.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pam_succeed_if.8.html"><span aria-hidden="true">&larr;</span> pam_succeed_if.8: test account characteristics</a></li>
   <li class="next"><a href="pam_tally2.8.html">pam_tally2.8: The login counter (tallying) module <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
