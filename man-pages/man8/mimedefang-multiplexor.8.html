<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mimedefang-multiplexor: Process pool controller for mail filters.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Process pool controller for mail filters.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mimedefang-multiplexor (8) manual">
  <meta name="twitter:description" content="Process pool controller for mail filters.">
  <meta name="twitter:image" content="https://www.carta.tech/images/mimedefang-mimedefang-multiplexor-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/mimedefang-multiplexor.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mimedefang-multiplexor (8) manual" />
  <meta property="og:description" content="Process pool controller for mail filters." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mimedefang-mimedefang-multiplexor-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mimedefang-multiplexor<small> (8)</small></h1>
        <p class="lead">Process pool controller for mail filters.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mimedefang-multiplexor.8.html">
      <span itemprop="name">mimedefang-multiplexor: Process pool controller for mail filters.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mimedefang/">
      <span itemprop="name">mimedefang</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/mimedefang-multiplexor.8.html">
      <span itemprop="name">mimedefang-multiplexor: Process pool controller for mail filters.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mimedefang-multiplexor </strong>[<em>options</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mimedefang-multiplexor</strong> manages a pool of Perl processes for scanning e-mail.  It is designed to work in conjunction with <a href="../man8/mimedefang.8.html"><strong>mimedefang</strong>(8)</a> and <a href="../man8/mimedefang.pl.8.html"><strong>mimedefang.pl</strong>(8)</a>.</p><p><strong>mimedefang-multiplexor</strong> opens a UNIX-domain socket and listens for requests for work from <strong>mimedefang</strong>.  As requests come in, <strong>mimedefang-multiplexor</strong> creates Perl processes as needed to scan mail.  The Perl processes are not killed when scanning is completed, but continue to run in a loop.  Perl processes are re-used for subsequent e-mail messages.  This eliminates the large overhead of starting a new Perl process for each incoming message.</p><p>To avoid memory leaks, the Perl processes are killed after they have handled some number of scans.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-U </strong><em>user</em></p>
  </dt>
  <dd>
    <p>Runs the multiplexor as <em>user</em> rather than <em>root</em>.  This option is mandatory, and must match the <strong>-U</strong> option supplied to <strong>mimedefang</strong>.</p>
  </dd>
  <dt>
    <p><strong>-m </strong><em>minSlaves</em></p>
  </dt>
  <dd>
    <p>The minimum number of Perl processes to keep running at all times.  The default is zero.</p>
  </dd>
  <dt>
    <p><strong>-x </strong><em>maxSlaves</em></p>
  </dt>
  <dd>
    <p>The maximum number of Perl processes to run simultaneously.  If a request comes in and all processes are busy, a temporary failure is signalled to the SMTP peer.  The default is 2.</p>
  </dd>
  <dt>
    <p><strong>-r </strong><em>maxRequests</em></p>
  </dt>
  <dd>
    <p>The maximum number of requests a given process handles before it is killed and a replacement started.  The default is 500.</p>
  </dd>
  <dt>
    <p><strong>-i </strong><em>idleTime</em></p>
  </dt>
  <dd>
    <p>The idle time in seconds after which to kill of excess Perl processes. That is, if the process is idle for longer than this time, and there are more than <em>minSlaves</em> running, the process is killed.  Note that this is implemented as a timer which ticks every <em>idleTime</em> seconds; therefore, processes may be idle for up to twice this time before they are killed.  The default for <em>idleTime</em> is 300 seconds.</p>
  </dd>
  <dt>
    <p><strong>-b </strong><em>busyTime</em></p>
  </dt>
  <dd>
    <p>The longest a Perl process is allowed to spend scanning an e-mail before it is declared hung up and killed.  The default is 120 seconds.</p>
  </dd>
  <dt>
    <p><strong>-Z</strong></p>
  </dt>
  <dd>
    <p>This option specifies that the multiplexor should accept and process "status updates" from busy slaves.  Note that this consumes one extra file descriptor per slave, plus a small amount of CPU time per status update.</p>
  </dd>
  <dt>
    <p><strong>-c </strong><em>cmdTime</em></p>
  </dt>
  <dd>
    <p>The timeout for communication between <strong>mimedefang-multiplexor</strong> and <strong>mimedefang</strong>, or between <strong>mimedefang-multiplexor</strong> and a Perl scanning process.  The default is 10 seconds.  This timeout should be kept quite short.</p>
  </dd>
  <dt>
    <p><strong>-w </strong><em>waitTime</em></p>
  </dt>
  <dd>
    <p>When <strong>mimedefang-multiplexor</strong> starts the initial slaves, or needs to bring the number of running slaves up to the number defined by the <strong>-m</strong> option, it does not start all the slaves at once, because this could overload your server.  Instead, it starts one slave every <em>waitTime</em> seconds.  The default value for <em>waitTime</em> is 3.</p>
  </dd>
  <dt>
    <p><strong>-W </strong><em>waitTime</em></p>
  </dt>
  <dd>
    <p>If you use this option, <strong>mimedefang-multiplexor</strong> will <em>never</em> activate a slave until <em>waitTime</em> seconds have elapsed since the last slave activation.  This could result in mail being tempfailed if slave activations do not keep pace with incoming mail.  However, it may be preferable to tempfail mail rather than allow the load on your server to spike up too quickly.  The default value for this option is 0, meaning that <strong>mimedefang-multiplexor</strong> will start slaves as quickly as necessary to keep up with incoming mail.</p>
  </dd>
  <dt>
    <p><strong>-z </strong><em>spooldir</em></p>
  </dt>
  <dd>
    <p>Set the spool directory to <em>spooldir</em>.  If this option is omitted, the spool directory defaults to /var/spool/MIMEDefang.</p>
  </dd>
  <dt>
    <p><strong>-s </strong><em>pathName</em></p>
  </dt>
  <dd>
    <p>The UNIX-domain socket on which <strong>mimedefang-multiplexor</strong> listens for requests.  This should be specified as an absolute pathname.  If this option is not supplied, it defaults to mimedefang-multiplexor.sock under the spool directory.</p>
  </dd>
  <dt>
    <p><strong>-a </strong><em>socket</em></p>
  </dt>
  <dd>
    <p>A socket for listening for requests.  This is similar to the <strong>-s</strong> socket, except that a restricted set of requests are processed.  On this socket, the multiplexor will only process requests asking for status; it will not accept any commands to do scanning or that would consume a slave.  See the SOCKET SPECIFICATION section for the format of <em>socket</em>.</p>
  </dd>
  <dt>
    <p><strong>-p </strong><em>fileName</em></p>
  </dt>
  <dd>
    <p>Causes <strong>mimedefang-multiplexor</strong> to write its process-ID (after becoming a daemon) to the specified file.</p>
  </dd>
  <dt>
    <p><strong>-f </strong><em>filter_path</em></p>
  </dt>
  <dd>
    <p>Normally, <strong>mimedefang-multiplexor</strong> executes a Perl filter script called <strong>mimedefang.pl</strong> to scan the e-mail.  However, you can have it execute any program you like by specifying the full path to the program with the <strong>-f</strong> option.  This program must obey the protocol documented in <a href="../man7/mimedefang-protocol.7.html"><strong>mimedefang-protocol</strong>(7)</a>; see that manual page for details.</p><p>Note that the <strong>-f</strong> option does <em>not</em> specify the "filter" to use with <strong>mimedefang.pl</strong>; instead, it specifies the program for <strong>mimedefang-multiplexor</strong> to execute.  You almost certainly should <em>not</em> use this option unless you wish to replace <strong>mimedefang.pl</strong> with your own program.</p>
  </dd>
  <dt>
    <p><strong>-F </strong><em>rules_path</em></p>
  </dt>
  <dd>
    <p>Specifies the path to the filter rules.  By default, <strong>/etc/mimedefang-filter</strong> is used.  If you use the <strong>-F</strong> option, its value is passed to the underlying Perl filter program using <strong>-f</strong>.</p>
  </dd>
  <dt>
    <p><strong>-l</strong></p>
  </dt>
  <dd>
    <p>Log certain events, including the output of the Perl slaves' standard-error, using syslog.  Normally, the multiplexor does not log much information.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Write debugging information about event-handling code in /var/log/mimedefang-event-debug.log.  This is only of use to people debugging <strong>mimedefang-multiplexor</strong>.</p>
  </dd>
  <dt>
    <p><strong>-R </strong><em>kbytes</em></p>
  </dt>
  <dd>
    <p>Limits the resident-set size of the slave filter processes to <em>kbytes</em> kilobytes.  This limit is not supported on all operating systems; it is known to work on Linux.</p>
  </dd>
  <dt>
    <p><strong>-M </strong><em>kbytes</em></p>
  </dt>
  <dd>
    <p>Limits the total memory space of slave filter processes to <em>kbytes</em> kilobytes.  This limit is supported on all operating systems which support the <a href="../man2/setrlimit.2.html"><strong>setrlimit</strong>(2)</a> system call.  This should include most modern UNIX systems.</p><p>We recommend that you monitor your slave filter processes and get a feel for how much memory they use.  You should then limit the memory to two or three times the worst-case that you have observed.  This can help mitigate denial-of-service attacks which use complicated MIME messages to force <strong>mimedefang.pl</strong> to consume lots of memory.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>Print usage information and exit.</p>
  </dd>
  <dt>
    <p><strong>-t </strong><em>filename</em></p>
  </dt>
  <dd>
    <p>Log statistical information to <em>filename</em>.  See the section STATISTICS for more information.</p>
  </dd>
  <dt>
    <p><strong>-T</strong></p>
  </dt>
  <dd>
    <p>Log statistical information using <a href="../man2/syslog.2.html"><strong>syslog</strong>(2)</a>.  You may use any <strong>-t</strong> and <strong>-T</strong> together, in which case statistical information is logged in a file and using <strong>syslog</strong>.</p>
  </dd>
  <dt>
    <p><strong>-u</strong></p>
  </dt>
  <dd>
    <p>Flush the statistics file after every write.  Normally, <strong>mimedefang-multiplexor</strong> does not flush the file; this is the best choice for minimizing disk I/O on a busy mail server.  However, if you wish to watch statistics entries in real-time, you should enable flushing.</p>
  </dd>
  <dt>
    <p><strong>-D</strong></p>
  </dt>
  <dd>
    <p>Do not fork into the background and become a daemon.  Instead, stay in the foreground.  Useful mainly for debugging or if you have a supervisory process managing <strong>mimedefang-multiplexor</strong>.</p>
  </dd>
  <dt>
    <p><strong>-q </strong><em>queue_size</em></p>
  </dt>
  <dd>
    <p>Normally, if all slaves are busy and <strong>mimedefang-multiplexor</strong> receives another request, it fails it with the error "No free slaves."  However, if you use the <strong>-q</strong> option, then up to <em>queue_size</em> requests will be queued.  As soon as a slave becomes free, the queued requests will be handed off in FIFO order.  If the queue is full and another request comes in, then the request is failed with "No free slaves".</p>
  </dd>
  <dt>
    <p><strong>-Q </strong><em>queue_timeout</em></p>
  </dt>
  <dd>
    <p>Queued requests should not stay on the queue indefinitely.  If a queued request cannot be processed within <em>queue_timeout</em> (default 30) seconds of being placed on the queue, it is failed with a "Queued request timed out" message.  See the section "QUEUEING REQUESTS" for more discussion.</p>
  </dd>
  <dt>
    <p><strong>-O </strong><em>sock</em></p>
  </dt>
  <dd>
    <p>Listen on a <em>notification socket</em> for connections from <em>listeners</em>. <strong>mimedefang-multiplexor</strong> can inform external programs of state changes by sending messages over a notification socket.  The external programs connect to this socket and then listen for notifications.  See the section SOCKET SPECIFICATION for the format of <em>sock</em>.</p><p>See the <a href="../man7/mimedefang-notify.7.html"><strong>mimedefang-notify</strong>(7)</a> man page for details of the notification protocol.</p>
  </dd>
  <dt>
    <p><strong>-N </strong><em>map_sock</em></p>
  </dt>
  <dd>
    <p>Listen on a <em>map socket</em> for Sendmail SOCKETMAP connections. As of Sendmail 8.13, you can define a Sendmail map type that talks to a daemon over a socket.  <strong>mimedefang-multiplexor</strong> implements that protocol; consult the <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a> man page for detils (see the SOCKET MAPS section).</p><p>See the section SOCKET SPECIFICATION for the format of <em>map_sock</em>.</p>
  </dd>
  <dt>
    <p><strong>-I </strong><em>backlog</em></p>
  </dt>
  <dd>
    <p>When <strong>mimedefang-multiplexor</strong> creates a listening socket, it calculates the "backlog" argument to <a href="../man2/listen.2.html"><strong>listen</strong>(2)</a> based on the maximum number of slaves.  However, you can explicitly set this backlog with the <strong>-I</strong> option.  Setting the backlog to a high value (around 30-50) may help on a very busy server.  If you see mail log messages saying "MXCommand: socket: Connection refused" during busy periods, then that's an indication you need a higher listen backlog.</p>
  </dd>
  <dt>
    <p><strong>-L </strong><em>interval</em></p>
  </dt>
  <dd>
    <p>Log the slave status every <em>interval</em> seconds.  This logs a line using syslog; the line looks like this:</p>
  </dd>
  <dt>
    
<pre>
Slave status: Stopped=s Idle=i Busy=b Killed=k Queued=q Msgs=m Activations=a
</pre>

  </dt>
  <dd>
    <p>Here, "Stopped" is the number of non-running slaves, "Idle" is the number of idle slaves, "Busy" is the number of busy slaves, "Killed" is the number of killed slaves yet to be reaped, "Queued" is the number of queued requests, "Msgs" is the total number of messages processed since the multiplexor began running, and "Activations" is the number of times a Perl process has been started since the multiplexor began running.</p><p>If you supply an <em>interval</em> of 0 (which is the default), no periodic status logging is performed.  If you supply an <em>interval</em> of less than 5 seconds, it is silently reset to 5 seconds.</p>
  </dd>
  <dt>
    <p><strong>-S </strong><em>facility</em></p>
  </dt>
  <dd>
    <p>Specifies the syslog facility for log messages.  The default is <em>mail</em>.  See <a href="../man3/openlog.3.html"><strong>openlog</strong>(3)</a> for a list of valid facilities. You can use either the short name ("mail") or long name ("LOG_MAIL") for the facility name.</p>
  </dd>
  <dt>
    <p><strong>-E</strong></p>
  </dt>
  <dd>
    <p>Specifies that the multiplexor should create an embedded Perl interpreter. This can improve performance dramatically.  But see the section "EMBEDDING PERL" for more information.</p>
  </dd>
  <dt>
    <p><strong>-X</strong> <em>n</em></p>
  </dt>
  <dd>
    <p>Specifies that the multiplexor should initiate a "tick" request every <em>n</em> seconds.  This causes your <em>filter_tick</em> function (if defined) to be called.  Note that you have no control over which slave executes <em>filter_tick</em>.  If all slaves are busy when a tick occurs, that tick request is skipped and a warning message is logged.</p>
  </dd>
  <dt>
    <p><strong>-P</strong> <em>n</em></p>
  </dt>
  <dd>
    <p>Specifies that the multiplexor should run <em>n</em> tick requests in parallel.  Each tick is run as often as specified with the <strong>-X</strong> argument.  (If you omit the <strong>-P</strong> option, then the multiplexor behaves as if <strong>-P 1</strong> had been specified.)</p><p>If you run parallel ticks, each tick is assigned an integer identifying its "type".  The type ranges from 0 to <em>n</em>-1.  While there may be as many as <em>n</em> tick requests running at a time, only one tick of each type will be active at any time.</p>
  </dd>
  <dt>
    <p><strong>-Y</strong> <em>label</em></p>
  </dt>
  <dd>
    <p>Sets the tag used in the multiplexor's syslog messages to <em>label</em> instead of <strong>mimedefang-multiplexor</strong>.</p>
  </dd>
  <dt>
    <p><strong>-G</strong></p>
  </dt>
  <dd>
    <p>Normally, <strong>mimedefang-multiplexor</strong> uses a umask of 027 when creating listening sockets.  If you would like the sockets to be readable and writeable by the group as well as the owner, supply the <strong>-G</strong> option.  This causes the umask to be 007 whenever UNIX-domain sockets are created.</p>
  </dd>
  <dt>
    <p><strong>-y</strong> <em>n</em></p>
  </dt>
  <dd>
    <p>Limits the maximum number of concurrent <strong>recipok</strong> checks to <em>n</em> on a per-domain basis.  The value of <em>n</em> can range from 0 (in which case no limit is applied) to <em>maxSlaves</em>, where <em>maxSlaves</em> is the argument to the <strong>-x</strong> option.  If <em>n</em> is outside that range, it is ignored (and no limit is applied.)</p><p>The <strong>recipok</strong> command ultimately invokes the <strong>filter_recipient</strong> function in your filter.  If you are doing recipient verification against servers that may be slow or unreliable, you can use the <strong>-y</strong> option to limit the number of concurrent recipient verifications per domain. That way, if one domain's server becomes very slow, it won't consume all available slaves for recipient verification.  Instead, its RCPT commands will be tempfailed and there will be slaves available to handle RCPT commands for other domains.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOCKET SPECIFICATION</h2>
        <div class="sectioncontent">
<p>The <strong>-a</strong>, <strong>-N</strong> and <strong>-O</strong> options take a socket as an argument.  This socket can be specified as:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>/path/to/socket</strong></p>
  </dt>
  <dd>
    <p>A UNIX-domain socket</p>
  </dd>
  <dt>
    <p><strong>inet:portnum</strong></p>
  </dt>
  <dd>
    <p>A TCP socket bound to port <em>portnum</em>, but which accepts connections only from the IPv4 loopback address (127.0.0.1).</p>
  </dd>
  <dt>
    <p><strong>inet_any:portnum</strong></p>
  </dt>
  <dd>
    <p>A TCP socket bound to port <em>portnum</em> which will accept connections from any address.  <em>Use inet_any with caution!</em></p>
  </dd>
  <dt>
    <p><strong>inet6:portnum</strong></p>
  </dt>
  <dd>
    <p>A TCP socket bound to port <em>portnum</em> listening on the IPv6 loopback address.</p>
  </dd>
  <dt>
    <p><strong>inet6_any:portnum</strong></p>
  </dt>
  <dd>
    <p>A TCP socket bound to port <em>portnum</em> listening on the IPv6 wildcard address.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">QUEUEING REQUESTS</h2>
        <div class="sectioncontent">
<p>Normally, if all slaves are busy, any additional requests are failed immediately.  However, the <strong>-q</strong> and <strong>-Q</strong> options allow you to queue requests for a short amount of time.  This facility is intended to gracefully handle a temporary overload; most of the time, your queue should be empty.</p><p>Because <strong>mimedefang</strong> checks the number of free slaves when a connection is opened and fails the connection if there are no free slaves, the intent of the queue is to allow SMTP transactions that are already underway to continue if there is a slight overload.  Any new connections will be failed if all slaves are busy, but existing connections are allowed to continue.  Queuing requests may improve throughput on extremely busy servers.</p><p>Note that if you supply the <strong>-q</strong> option to <strong>mimedefang</strong>, then even new connections are allowed to queue.  This may improve throughput by keeping the slave utilization higher.</p><p>The <strong>-R</strong> option to <strong>mimedefang</strong> can be used to reserve a specified number of slaves for connections from the loopback address.  Using the <strong>-R</strong> option has the side-effect of permitting new connections from the loopback address to queue.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EMBEDDING PERL</h2>
        <div class="sectioncontent">
<p>Normally, when <strong>mimedefang-multiplexor</strong> activates a slave, it forks and execs <strong>mimedefang.pl</strong>.  However, if the multiplexor was compiled with embedded Perl support, and you supply the <strong>-E</strong> command-line option, the multiplexor works like this:</p>
<dl class='dl-vertical'>
  <dt>
    <p>1</p>
  </dt>
  <dd>
    <p>It creates an embedded Perl interpreter, and sources <strong>mimedefang.pl</strong> with a special command-line argument telling it to read the filter, but not to enter the main loop.</p>
  </dd>
  <dt>
    <p>2</p>
  </dt>
  <dd>
    <p>Each time a slave is activated, the multiplexor calls fork() and runs the <strong>mimedefang.pl</strong> main loop.  This invokes <strong>filter_initialize</strong> and then runs the main loop.</p>
  </dd>

</dl>
<p>On some platforms (for example, Red Hat Linux 7.3 with Perl 5.6.1), it is not safe to destroy and recreate a Perl interpreter without causing a memory leak.  On those platforms, if you attempt to reread the filter file (by sending the multiplexor a HUP signal or reread command), the filter will <em>not</em> be re-read, and a message will be logged to syslog. On those platforms, you must kill and restart MIMEDefang if you change the filter file.</p><p>On most platforms, however, a filter reread is accomplished by destroying and re-creating the embedded interpreter, re-sourcing <strong>mimedefang.pl</strong> and killing slaves as soon as they are idle.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STATISTICS</h2>
        <div class="sectioncontent">
<p>With the <strong>-t</strong> option, <strong>mimedefang-multiplexor</strong> logs certain events to a file.  This file can be post-processed to gather statistics about the multiplexor.  You can use it to tune the number of slaves you run, adjust timeouts, and so on.</p><p>Each line of the file looks like this:</p>
<pre>
	YYYY/MM/DD:HH:MM:SS timestamp event key=val key=val...
</pre>
<p>Here, YYYY/MM/DD:HH:MM:SS is the local time of day.  Timestamp is the number of seconds since January 1, 1970.  Event is the name of an event.  The valid events are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>StartSlave</strong></p>
  </dt>
  <dd>
    <p>A slave process has been started.</p>
  </dd>
  <dt>
    <p><strong>KillSlave</strong></p>
  </dt>
  <dd>
    <p>A slave process has been killed.</p>
  </dd>
  <dt>
    <p><strong>ReapSlave</strong></p>
  </dt>
  <dd>
    <p>A dead slave process has been reaped.  It is possible to have a ReapSlave event without a previous KillSlave event if the slave process terminated abnormally.</p>
  </dd>
  <dt>
    <p><strong>StartFilter</strong></p>
  </dt>
  <dd>
    <p>A slave process has begun filtering an e-mail message.</p>
  </dd>
  <dt>
    <p><strong>EndFilter</strong></p>
  </dt>
  <dd>
    <p>A slave process has finished filtering an e-mail message.</p>
  </dd>

</dl>
<p>The possible keys in the key=value pairs are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>slave=</strong><em>n</em></p>
  </dt>
  <dd>
    <p>The slave involved in the event.  Every slave is identified by a small integer.</p>
  </dd>
  <dt>
    <p><strong>nslaves=</strong><em>n</em></p>
  </dt>
  <dd>
    <p>The total number of running slaves immediately after the event happened.</p>
  </dd>
  <dt>
    <p><strong>nbusy=</strong><em>n</em></p>
  </dt>
  <dd>
    <p>The number of busy slaves (slaves which are processing an e-mail message) immediately after the event happened.</p>
  </dd>
  <dt>
    <p><strong>reason="</strong><em>string</em><strong>"</strong></p>
  </dt>
  <dd>
    <p>The reason for a StartSlave or KillSlave event.  (Present only for these events.)</p>
  </dd>
  <dt>
    <p><strong>numRequests=</strong><em>n</em></p>
  </dt>
  <dd>
    <p>The number of e-mails processed by the slave.  Present only for an EndFilter event.</p>
  </dd>

</dl>
<p>If you send the <strong>mimedefang-multiplexor</strong> process a SIGHUP signal (kill -1 <em>pid</em>), it closes and reopens the statistics file.  This is useful during log file rotation.</p><p>If you send the <strong>mimedefang-multiplexor</strong> process a SIGINT signal (kill -INT <em>pid</em>), it terminates all active-but-idle slaves.  Also, any active-and-busy slaves terminate as soon as they finish filtering the current message.  This is useful to force a reread of the filter rules file without stopping and restarting Sendmail.</p><p>If you send the <strong>mimedefang-multiplexor</strong> process a SIGTERM signal (kill <em>pid</em>), it terminates all slaves and exits immediately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>mimedefang-mulitplexor</strong> was written by David F. Skoll &lt;dfs@roaringpenguin.com&gt;. The <strong>mimedefang</strong> home page is <em>http://www.mimedefang.org/</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mimedefang-multiplexor&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/mimedefang.pl.8.html"><strong>mimedefang.pl</strong>(8)</a>, <a href="../man5/mimedefang-filter.5.html"><strong>mimedefang-filter</strong>(5)</a>, <a href="../man8/mimedefang.8.html"><strong>mimedefang</strong>(8)</a>, <a href="../man7/mimedefang-protocol.7.html"><strong>mimedefang-protocol</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mimedefang.8.html"><span aria-hidden="true">&larr;</span> mimedefang.8: Sendmail mime mail filter</a></li>
   <li class="next"><a href="mimedefang.pl.8.html">mimedefang.pl.8: Perl script to scan mime messages. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
