<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>perdition.imap4s: Pop3 and imap4 proxy server</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Pop3 and imap4 proxy server">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="perdition.imap4s (8) manual">
  <meta name="twitter:description" content="Pop3 and imap4 proxy server">
  <meta name="twitter:image" content="https://www.carta.tech/images/perdition-perdition.imap4s-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/perdition.imap4s.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="perdition.imap4s (8) manual" />
  <meta property="og:description" content="Pop3 and imap4 proxy server" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/perdition-perdition.imap4s-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">perdition.imap4s<small> (8)</small></h1>
        <p class="lead">Pop3 and imap4 proxy server</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/perdition.imap4s.8.html">
      <span itemprop="name">perdition.imap4s: Pop3 and imap4 proxy server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/perdition/">
      <span itemprop="name">perdition</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/perdition.imap4s.8.html">
      <span itemprop="name">perdition.imap4s: Pop3 and imap4 proxy server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>perdition</strong> [options]</p><p><strong>perdition.pop3</strong> [options]</p><p><strong>perdition.pop3s</strong> [options]</p><p><strong>perdition.imap4</strong> [options]</p><p><strong>perdition.imap4s</strong> [options]</p><p><strong>perdition.imaps</strong> [options]</p><p><strong>perdition.managesieve</strong> [options]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>perdition</strong> allows users to connect to a content-free POP3, IMAP4 or ManageSieve server that will redirect them to their real POP3, IMAP4 or ManageSieve server respectively. This enables mail retrieval and sieve management for a domain to be split across multiple real mail servers on a per user basis.  This can also be used to as a POP3, IMAP4 and ManageSieve proxy especially in firewall applications.  And as a method of migrating users to new servers.</p><p>When a connection is made to perdition in POP3 mode, it reads the users authentication credentials and then refers to its popmap to find the real-server that the user's connection should be forwarded to.  A connection is made to the real-server and perdition then passes on the authentication credentials. If authentication is successful then perdition pipes data between the end-user and the real-server.  If authentication fails then the real-server connection is closed and the client connection is reset to the state it was in on initial connection. That is new authentication credentials are expected.</p><p>N.B: No IMAP authentication schemes, other than the LOGIN command are accepted.</p><p>When invoked as <strong>perdition.pop3</strong>, <strong>perdition.pop3s</strong>, <strong>perdition.imap4</strong>, <strong>perdition.imap4s</strong> or <strong>perdition.managesieve</strong> then perdition will run in POP3, POP3S, IMAP4, IMAP4S or MANAGESIEVE mode respectively, unless overridden on the command line or in the configuration file. <strong>perdition.imaps</strong> also runs perdition in IMAP4S mode and is provided to get around the truncation of process names in the /proc filesystem on Linux which can cause init scripts to fail to stop perdition correctly.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-A|--add_domain STATE[,STATE...][,STRIP_DEPTH]:</strong></p>
  </dt>
  <dd>
    <p>Appends a domain to the USER based on the IP address connected to in given state(s). The domain name to append will be the reverse-lookup of the IP address connected to. If there is no reverse lookup for this IP address, then a domain will not be appended. Probably the easiest way to enforce this mapping is to add entries to /etc/hosts.</p><p>The valid states are servername_lookup, local_authentication, remote_login and all</p><p><strong>servername_lookup:</strong> Append the domain to the username for lookup of username in Popmap. Will not take effect if client_server_specification is in effect.</p><p><strong>local_authentication:</strong> Append the domain to the username for use in local authentication. Only has effect if authenticate_in is in effect.</p><p><strong>remote_login:</strong> Send the username with the domain appended to the real-server for authentication.</p><p><strong>all:</strong> Short-Hand for all of above states.</p><p>The domain may also have leading levels striped, essentially to convert a hostname to a domain name. The depth of the strip defaults to 1, which would mean that www.au.vergenet.net would become au.vergenet.net. A depth of 2 would cause it to become vergenet.net and so forth. A depth of 0 leaves the name unchanged. The depth and may be specified by appending ",STRIP_DEPTH" to the state. For compatibility reasons the default depth is 1.</p><p>e.g. all,2</p><p>(the default value for add_domain is "")</p>
  </dd>
  <dt>
    <p><strong>--authenticate_timeout:</strong></p>
  </dt>
  <dd>
    <p>Idle timeout in seconds used while the user is unauthenticated. Zero for infinite timeout.</p>
  </dd>
  <dt>
    <p><strong>-a, --authenticate_in:</strong></p>
  </dt>
  <dd>
    <p>User is authenticated by perdition before connection to back-end server is made. Only available if perdition is compiled with pam support.</p>
  </dd>
  <dt>
    <p><strong>-B, --no_bind_banner:</strong></p>
  </dt>
  <dd>
    <p>Use the hostname derived from usname in the banner.  In inetd mode this is always the case. In non-inetd mode if this option is not in effect then the IP address used to accept a connection will be used and if -n|--no_loookup is not in effect it will be resolved.</p>
  </dd>
  <dt>
    <p><strong>-b, --bind_address SERVER[,SERVER...]:</strong></p>
  </dt>
  <dd>
    <p>Bind to these addresses and ports. interfaces with this address. Format is as per the --outgoing_server option. If the port is omitted, then the listen_port will be used.</p><p>In non-inetd mode, connections will only be accepted to the listed servers. If un-set connections will be accepted on all addresses on the listen_port.</p><p>(default "")</p>
  </dd>
  <dt>
    <p><strong>-C|--connection_logging:</strong></p>
  </dt>
  <dd>
    <p>Log interaction between clients, perdition and servers during authentication phase.</p><p><strong>Note:</strong> -d|--debug must be specified for this option to take effect.</p>
  </dd>
  <dt>
    <p><strong>--connect_relog SECONDS:</strong></p>
  </dt>
  <dd>
    <p>How often to relog the connection. For use in conjunction with POP and IMAP before SMTP. If zero then the connection will not be reloged.</p><p>(default 300)</p>
  </dd>
  <dt>
    <p><strong>-c, --client_server_specification:</strong></p>
  </dt>
  <dd>
    <p>Allow USER of the form user&lt;delimiter&gt;server[:port] to specify the server and port for a user.</p>
  </dd>
  <dt>
    <p><strong>-D, --domain_delimiter STRING:</strong></p>
  </dt>
  <dd>
    <p>Delimiter between username and domain.</p><p>(default "@")</p>
  </dd>
  <dt>
    <p><strong>-d, --debug:</strong></p>
  </dt>
  <dd>
    <p>Turn on verbose debugging.</p>
  </dd>
  <dt>
    <p><strong>-e, --explicit_domain STRING:</strong></p>
  </dt>
  <dd>
    <p>With -A, use STRING as the default domain rather than deriving from the IP address connected to.</p><p>(default NULL)</p>
  </dd>
  <dt>
    <p><strong>-F, --log_facility FACILITY:</strong></p>
  </dt>
  <dd>
    <p>Facility to log to. If the facility has a leading '/' then it will be treated as a file. If is "-" or "+" then log to stdout or stderr respectively. Otherwise it is assumed to be the name of a syslog facility. See <strong>syslog.conf</strong>(5) for valid syslog facility names.</p><p>(default "mail")</p><p>Notes: If an error occurs before options are read it may be logged to stderr. If stdout or stderr is specified as the facility, then the process will not fork and detach from the terminal.</p>
  </dd>
  <dt>
    <p><strong>-f, --config_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Name of config file to read. Command line options override options set in config file.</p><p>The default is derived as follows:</p><p>The sysconfig dir ("/etc/perdition" for example) is checked for &lt;basename&gt;.conf. If this is found then it is used. So if perdition is invoked as /usr/sbin/perdition.pop3, and /etc/perdition/perdition.pop3.conf exists then it will be used.</p><p>Next the sysconfig dir is checked for peridtion.&lt;protocol&gt;.conf, where protocol is the ASCII representation of the protocol being used, one of "imap4", "imap4s", "pop3", "pop3s" or "managesieve". So if perdition is being run in imap4 mode, and /etc/perdition/perdition.imap4.conf exists, then it is used. Note that the protocol name is lowercase.</p><p>Next the sysconfig dir is checked for perdition.conf, if it is found then it is used.</p><p>If none of these files are found then no configuration file is used.</p>
  </dd>
  <dt>
    <p><strong>-g, --group GROUP:</strong></p>
  </dt>
  <dd>
    <p>Group to run as.</p><p>(default "nobody")</p>
  </dd>
  <dt>
    <p><strong>-h, --help:</strong></p>
  </dt>
  <dd>
    <p>Display this message</p>
  </dd>
  <dt>
    <p><strong>-I, --capability STRING:</strong></p>
  </dt>
  <dd>
    <p>Deprecated in favour of --pop_capability and --imap_capability</p>
  </dd>
  <dt>
    <p><strong>--imap_capability STRING:</strong></p>
  </dt>
  <dd>
    <p>Capabilities for IMAP3 and IMAP4S</p><p>This string is taken as a string literal that will be returned when a client issues the CAPABILITY command. As such the capabilities should be space delimited.  The default is "IMAP4 IMAP4REV1". However, perdition does support RFC 2088 non-synchronising string literals, if the real servers also support this then the capability may be set to "IMAP4 IMAP4REV1 LITERAL+".</p><p>If perdition is running with ssl_mode includes to ssl_listen then the capability STARTTLS will be appended to the list of capabilities if it is not already present. Similarly this capability will be removed from the list of capabilities if present and perdition is not running with an ssl_mode that includes to ssl_listen.</p><p>Perdition may also manipulate the capability in IMAP mode to add and remove the LOGINDISABLED capability if the no_login capability is in effect or if the ssl_mode includes tls_listen_force or tls_outgoing_force.</p>
  </dd>
  <dt>
    <p><strong>-i, --inetd_mode:</strong></p>
  </dt>
  <dd>
    <p>Run in inetd mode</p>
  </dd>
  <dt>
    <p><strong>-L, --connection_limit LIMIT:</strong></p>
  </dt>
  <dd>
    <p>Maximum number of connections to accept simultaneously. A value of zero sets no limit on the number of simultaneous connections.</p><p>(default 0)</p>
  </dd>
  <dt>
    <p><strong>-l, --listen_port PORT_NUMBER|PORT_NAME:</strong></p>
  </dt>
  <dd>
    <p>Port to listen on.</p><p>The default is 110, 995, 143, 993 and 4190 for POP3, POP3S, IMAP4, IMAP4S and MANAGESIEVE mode respectively.</p>
  </dd>
  <dt>
    <p><strong>--login_disabled:</strong></p>
  </dt>
  <dd>
    <p>Do not allow users to log in. Also adds LOGINDISABLED to capability list in IMAP4 and IMAP4S mode.</p>
  </dd>
  <dt>
    <p><strong>--log_passwd STATE:</strong></p>
  </dt>
  <dd>
    <p>Log the users password.</p><p>(default "never")</p><p><strong>fail:</strong> log the password on failed connection attempts.</p><p><strong>ok:</strong> log the password on successful connection attempts.</p><p><strong></strong> never: never log the password</p><p><strong></strong> always: always log the password</p><p><strong>Note:</strong> -d|--debug must be specified for this option to take effect.</p>
  </dd>
  <dt>
    <p><strong>--lower_case state[,state...]:</strong></p>
  </dt>
  <dd>
    <p>Convert usernames to lower case according the the locale in given state(s). See A|add_domain for a description of the states.</p><p>(default "(null)")</p>
  </dd>
  <dt>
    <p><strong>--managesieve_capability STRING:</strong></p>
  </dt>
  <dd>
    <p>Capabilities for ManageSieve</p><p>This string is taken as a string literal that will be returned when a client connects or issues the CAPABILITY command. As such the capabilities should be quoted, using escape char &#92;, and double space delimited.</p><p>If perdition is running with ssl_mode includes to ssl_listen then the capability STARTTLS will be appended to the list of capabilities if it is not already present. Similary this capability will be removed from the list of capabilities if present and perdition is not running with an ssl_mode that includes to ssl_listen.</p><p>Examples</p><p>Two options, each with a value</p><p>"</p><p>Two options, but only one with a value</p><p>"</p><p>(default ""IMPLEMENTATION" "perdition"  "SIEVE" "comparator-i; octet comparator-i;ascii-casemap fileinto reject envelope encoded-character vacation subaddress comparator-i;ascii-numeric relational regex imap4flags copy include variables body enotify environment mailbox date"  "SASL" "PLAIN"  "NOTIFY" "mailto"  "VERSION" "1.19-rc2"")</p>
  </dd>
  <dt>
    <p><strong>-M, --map_library FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Library to open that provides functions to look up the server for a user. An empty ("") library means that no library will be accessed and hence, no lookup will take place.</p><p>(default "/usr/lib/libperditiondb_gdbm.so.0")</p>
  </dd>
  <dt>
    <p><strong>-m, --map_library_opt STRING:</strong></p>
  </dt>
  <dd>
    <p>String option to pass to database access function provided by the library specified by the map_library directive. The treatment of this string is up to the library. See <a href="../man5/perditiondb.5.html"><strong>perditiondb</strong>(5)</a> for more details of how individual map_libraries handle this string.</p><p>(default "")</p>
  </dd>
  <dt>
    <p><strong>--no_daemon:</strong></p>
  </dt>
  <dd>
    <p>Do not detach from terminal. Makes no sense if inetd_mode is in effect.</p>
  </dd>
  <dt>
    <p><strong>-n, --no_lookup:</strong></p>
  </dt>
  <dd>
    <p>Disable host and port lookup, implies no_bind_banner. Please note that if this option is enabled, then perdition will not resolve host or port names returned by popmap lookups, thus, your popmap must return ip addresses and port numbers.</p>
  </dd>
  <dt>
    <p><strong>-O, --ok_line:</strong></p>
  </dt>
  <dd>
    <p>Use STRING as the OK line to send to the client. Overridden by server_resp_line. OK and will be prepended to STRING, and in IMAP mode a tag will also be prepended to the string.</p><p>(default "You are so in")</p>
  </dd>
  <dt>
    <p><strong>--server_ok_line:</strong></p>
  </dt>
  <dd>
    <p>This option is deprecated and may be removed in a future release. Use server_resp_line instead. If authentication with the real-server is successful then send the servers +OK line to the client, instead of generating one.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>-o, --server_resp_line:</strong></p>
  </dt>
  <dd>
    <p>If authentication with the real-server is successful then send the servers response line to the client, instead of generating one.</p>
  </dd>
  <dt>
    <p><strong>-P, --protocol PROTOCOL:</strong></p>
  </dt>
  <dd>
    <p>Protocol to use.</p><p>(default "POP3") available protocols: "POP3, POP3S, IMAP4, IMAP4S"</p>
  </dd>
  <dt>
    <p><strong>-p, --outgoing_port PORT:</strong></p>
  </dt>
  <dd>
    <p>Default real-server port.</p><p>See listen_port for defaults.</p>
  </dd>
  <dt>
    <p><strong>-s, --outgoing_server SERVER[,SERVER...]:</strong></p>
  </dt>
  <dd>
    <p>Define a server to use if a user is not in the popmap. Format is servername|ip_address[:portname|portnumber]. Multiple servers may be delimited by a ','. If multiple servers are specified then they are used in a round robin fashion.</p><p>(default "")</p>
  </dd>
  <dt>
    <p><strong>--pid_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Path for pidfile. Must be a full path starting with a '/'. To allow perdition to remove the pid file after the owner of the perdition process is changed to a non-root user, it is advised to specify a pid file in a subdirectory of the system var state directory (usually /var/run). This subdirectory should be unique to this perdition invocation and will be created and have its owner and permissions set to allow perdition to subsequently removed the pid file.</p><p>Empty for no pid file. Not used in inetd mode.</p><p>(default &lt;var_state_dir&gt;/&lt;basename&gt;/&lt;basename&gt;.pid)</p>
  </dd>
  <dt>
    <p><strong>--pop_capability STRING:</strong></p>
  </dt>
  <dd>
    <p>Capabilities for POP3 and POP3S</p><p>The capabilities should be delimited by a '.' spaces. Up until perdition 1.18 the delimiter was two spaces, "  ". This is now deprecated and it is not valid to mix delimiters.</p><p>The default capability is "UIDL.USER".</p><p>If perdition is running with ssl_mode includes to ssl_listen then the capability STLS will be appended to the list of capabilities if it is not already present. Similarly this capability will be removed from the list of capabilities it is present and perdition is not running with an ssl_mode that includes to ssl_listen.</p>
  </dd>
  <dt>
    <p><strong>-S, --strip_domain STATE[,STATE]:</strong></p>
  </dt>
  <dd>
    <p>Allow USER of the from user&lt;delimiter&gt;domain where &lt;delimiter&gt;domain will be striped off in given state(s).See add_domain for a description of the states.</p>
  </dd>
  <dt>
    <p><strong>-t, --timeout SECONDS:</strong></p>
  </dt>
  <dd>
    <p>Idle timeout for post-authentication phase. Zero for infinite timeout.</p><p>(default 1800)</p>
  </dd>
  <dt>
    <p><strong>--tcp_keepalive:</strong></p>
  </dt>
  <dd>
    <p>Turn on TCP Keep-Alive (see RFC 1122). This will turn on TCP Keep-Alive for both incoming connections from clients as well as connections made to the real POP3, IMAP4 or managesieve server.</p><p>(default is disabled)</p>
  </dd>
  <dt>
    <p><strong>-u, --username USERNAME:</strong></p>
  </dt>
  <dd>
    <p>User to run as.</p><p>(default "nobody")</p>
  </dd>
  <dt>
    <p><strong>-U, --username_from_database:</strong></p>
  </dt>
  <dd>
    <p>If the servername in the popmap specified in the form: user&lt;delimiter&gt;domain then use the username given by the servername.  If a servername is given in this form then the domain will be used as the server to connect to, regardless of this option.</p>
  </dd>
  <dt>
    <p><strong>-q, --quiet:</strong></p>
  </dt>
  <dd>
    <p>Only log errors. Overridden by debug</p>
  </dd>
  <dt>
    <p><strong>--query_key FORMAT[,FORMAT...]:</strong></p>
  </dt>
  <dd>
    <p>Instead of using the username as supplied by the end user, possibly modified by strip_domain, use the formats specified. The formats will be used in order to query the popmap. The result from the first successful lookup will be used. The format is comprised of a string of characters, delimited by ','. The following escape codes are valid:</p><p>&#92;U: Long Username, the entire string supplied by</p>
<pre>
    the end user, less any effects of
    --strip_domain.
</pre>
<p>&#92;u: Short Username, the portion Long Username</p>
<pre>
    before the domain delimiter.
</pre>
<p>&#92;D: Domain Delimiter, as specified by</p>
<pre>
    --domain_delimiter
</pre>
<p>&#92;d: Domain the portion Long Username after the</p>
<pre>
    domain delimiter.
</pre>
<p>&#92;i: Source IP address of the connection</p><p>&#92;I: Destination IP address of the connection</p><p>&#92;p: Source port of the connection</p><p>&#92;P: Destination port of the connection</p><p>&#92;\ Literal &#92;</p><p>As a ',' is the delimiter between formats, it cannot appear within a format. All other characters other than the escape codes above, and ',' are treated as literals.</p><p>Examples</p><p>Use the supplied username, the default behaviour</p><p>&#92;U</p><p>Use the user portion of the supplied username, if this doesn't work try the domain portion of the supplied username preceded by the domain delimiter</p><p>&#92;u,&#92;D&#92;d</p><p>Use the destination IP address</p><p>&#92;I</p><p>Escape codes interspersed with literals</p><p>&#92;u&#92;da_domain,&#92;da_domain</p>
  </dd>

</dl>
<p>The options below relate to SSL/TLS support. They are not available if perdition is compiled without SSL support.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--ssl_mode MODE:</strong></p>
  </dt>
  <dd>
    <p>Use SSL and or TLS for the listening and/or outgoing connections. A comma delimited list of: none, ssl_listen, ssl_outgoing, ssl_all, tls_listen, tls_outgoing, tls_all, tls_listen_force, tls_outgoing_force, tls_all_force. TLS is defined in RFC 2595.</p><p>(default "(null)")</p><p><strong>none:</strong> Do not use SSL or TLS for any connections. This is the same as providing no option, the default.</p><p><strong>ssl_listen:</strong> When listening for incoming connections they will be treated as SSL connections.</p><p><strong>ssl_outgoing:</strong> Use SSL to connect to real pop/imap servers.</p><p><strong>ssl_all:</strong> Short-Hand for ssl_listen,ssl_outgoing.</p><p><strong>tls_listen:</strong> When listening for incoming connections they will be treated as TLS connections.</p><p><strong>tls_outgoing:</strong> Use TLS to connect to real pop/imap servers.</p><p><strong>tls_all:</strong> Short-Hand for tls_listen,tls_outgoing.</p><p><strong>tls_listen_force:</strong> Do not accept plain text authentication. In IMAP4 and IMAP4S mode, the LOGINDISABLED capability until TLS has been initialised by the client issuing a STARTTLS. In all modes mode plain-text authentication is ignored. Also sets tls_listen.</p><p><strong>tls_outgoing_force:</strong> Do not send authentication information if TLS cannot be negotiated. Also sets tls_outgoing.</p><p><strong></strong> tls_all_force: Short-Hand for tls_listen_force,tls_outgoing_force.</p>
  </dd>
  <dt>
    <p><strong>--ssl_ca_chain_file:</strong></p>
  </dt>
  <dd>
    <p>Sets the optional all-in-one file where you can assemble the certificates of Certification Authorities (CA) which form the certificate chain of the server certificate. This starts with the issuing CA certificate of the "ssl_cert_file" certificate and can range up to the root CA certificate. Such a file is simply the concatenation of the various PEM-encoded CA Certificate files, usually in certificate chain order. Overrides ssl_ca_file and ssl_ca_path.</p><p>(default NULL, no CA certificate will be used)</p>
  </dd>
  <dt>
    <p><strong>--ssl_ca_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Certificate Authorities to use when verifying certificates of real servers. Used for SSL or TLS outgoing connections.  When building the Certificate Authorities chain, ssl_ca_file is used first, if set, and then ssl_ca_path, if set.  See <strong>SSL_CTX_load_verify_locations</strong>(3) for format details.</p><p>(default "/etc/perdition/perdition.ca.pem")</p>
  </dd>
  <dt>
    <p><strong>--ssl_ca_path PATHNAME:</strong></p>
  </dt>
  <dd>
    <p>Certificate Authorities to use when verifying certificates of real servers. Used for SSL or TLS outgoing connections.  "openssh c_rehash" should be run in this directory when new certificates are added.  When building the Certificate Authorities chain, ssl_ca_file is used first, if set, and then ssl_ca_path, if set.  See <strong>SSL_CTX_load_verify_locations</strong>(3) for details.</p><p>(default "/etc/perdition/perdition.ca/")</p>
  </dd>
  <dt>
    <p><strong>--ssl_ca_accept_self_signed:</strong></p>
  </dt>
  <dd>
    <p>Accept self-signed certificate authorities.</p>
  </dd>
  <dt>
    <p><strong>--ssl_cert_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Certificate to use when listening for SSL or TLS connections. Should be in PEM format.</p><p>(default "/etc/perdition/perdition.crt.pem")</p>
  </dd>
  <dt>
    <p><strong>--ssl_cert_accept_self_signed:</strong></p>
  </dt>
  <dd>
    <p>Accept self-signed certificates. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_cert_accept_expired:</strong></p>
  </dt>
  <dd>
    <p>Accept expired certificates. This includes server certificates and certificate authority certificates. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_cert_accept_not_yet_valid:</strong></p>
  </dt>
  <dd>
    <p>Accept certificates that are not yet valid. This includes server certificates and certificate authority certificates. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_cert_verify_depth DEPTH:</strong></p>
  </dt>
  <dd>
    <p>Chain Depth to recurse to when verifying certificates. Used for SSL or TLS outgoing connections.</p><p>(default 9)</p>
  </dd>
  <dt>
    <p><strong>--ssl_key_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>Public key to use when listening for SSL or TLS connections. Should be in PEM format.</p><p>(default "/etc/perdition/perdition.key.pem")</p>
  </dd>
  <dt>
    <p><strong>--ssl_listen_ciphers STRING:</strong></p>
  </dt>
  <dd>
    <p>Cipher list when listening for SSL or TLS connections as per <strong>ciphers</strong>(1). If empty ("") then openssl's default will be used.</p><p>(default "")</p>
  </dd>
  <dt>
    <p><strong>--ssl_outgoing_ciphers STRING:</strong></p>
  </dt>
  <dd>
    <p>Cipher list when making outgoing SSL or TLS connections as per <strong>ciphers</strong>(1). If empty ("") then openssl's default will be used.</p><p>(default "")</p>
  </dd>
  <dt>
    <p><strong>--ssl_no_cert_verify:</strong></p>
  </dt>
  <dd>
    <p>Don't cryptographically verify the certificates. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_no_client_cert_verify:</strong></p>
  </dt>
  <dd>
    <p>Don't cryptographically verify the end-user's certificate. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_no_cn_verify:</strong></p>
  </dt>
  <dd>
    <p>Don't verify the real-server's common name with the name used. to connect to the server. Used for SSL or TLS outgoing connections.</p>
  </dd>
  <dt>
    <p><strong>--ssl_passphrase_fd N:</strong></p>
  </dt>
  <dd>
    <p>File descriptor to read the passphrase for the certificate from. Only the first line will be read. Only one of ssl_passphrase_fd and ssl_passphrase_file may be specified. (default 0)</p>
  </dd>
  <dt>
    <p><strong>--ssl_passphrase_file FILENAME:</strong></p>
  </dt>
  <dd>
    <p>File to read the passphrase for the certificate from. Only the first line will be read. Only one of ssl_passphrase_fd and ssl_passphrase_file may be specified. (default NULL, no file)</p>
  </dd>
  <dt>
    <p>Notes:</p>
  </dt>
  <dd>
    <p>Default value for binary flags is off.</p><p>If a string argument is empty ("") then the option will not be used unless noted otherwise.</p><p>The defaults given refer to the values if perdition is compiled with --sysconfdir=/etc as it would for many binary distributions. For the actual defaults of a given perdition binary run "perdition --help"</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USER DATABASE (POPMAP)</h2>
        <div class="sectioncontent">
<p>For information on mechanisms for resolving users to a host and port and information on the -M|--map_library and -m|--map_library_opt flags, please see <a href="../man5/perditiondb.5.html"><strong>perditiondb</strong>(5)</a>.</p><p>Note that by specifying an map library no map lookups will occur and all connections will use the -s|--outgoing_server. In this way perdition can be configured as a "pure proxy".</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STAND-ALONE MODE</h2>
        <div class="sectioncontent">
<p>Normally perdition will bind to a port, and listen for connections.  The default port is 110 in POP3 mode and 143 in IMAP4 mode, an alternate port can be specified with the -l|--listen_port command line option. In this mode perdition will fork to manage clients.</p><p><strong>Stand-Alone Mode: Debian and RPM Installation</strong></p><p>In the Debian and RPM distributions perdition can be started and stopped in stand-alone mode using:</p><p>/etc/init.d/perdition start</p><p>/etc/init.d/perdition stop</p><p>Editing /etc/sysconfig/perdition (RPM) or /etc/default/perdition (Debian) allows control of whether perdition will be started in POP3 mode, IMAP4 mode or both (or neither).</p><p>The syntax for this file is:</p>
<pre>
RUN_PERDITION=[yes|no]
FLAGS="flags"
POP3=[yes|no]
POP3_FLAGS="flags"
POP3S=[yes|no]
POP3S_FLAGS="flags"
IMAP4=[yes|no]
IMAP4_FLAGS="flags"
IMAP4S=[yes|no]
IMAP4S_FLAGS="flags"
</pre>
<p>The file is sourced into the init script so normal bash syntax applies. Blank lines are ignored, as is anything after a # on a line.</p><p>e.g.</p>
<pre>
RUN_PERDITION=yes
POP3=on
POP3_FLAGS="--ssl_mode tls_listen"
POP3S=on
IMAP4_FLAGS="--ssl_mode tls_listen"
IMAP4=on
POP3S_FLAGS="--ssl_mode ssl_listen -p 110"
IMAP4S=on
IMAP4S_FLAGS="--ssl_mode ssl_listen -p 143"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INETD MODE</h2>
        <div class="sectioncontent">
<p>Perdition can be used in conjunction with inetd. This enables perdition to benefit from tcpd where access can be controlled to some extent using /etc/hosts.allow and /etc/hosts.deny. Sample /etc/inetd.conf entries follow:</p><p>pop3  stream tcp nowait root /usr/sbin/tcpd /usr/sbin/perdition.pop3 -i</p><p>pop3s stream tcp nowait root /usr/sbin/tcpd /usr/sbin/perdition.pop3s -i</p><p>imap2 stream tcp nowait root /usr/sbin/tcpd /usr/sbin/perdition.imap4 -i</p><p>imaps stream tcp nowait root /usr/sbin/tcpd /usr/sbin/perdition.imap4s -i</p><p>inetd should then be restarted</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOCAL AUTHENTICATION</h2>
        <div class="sectioncontent">
<p>If perdition has been compiled against libpam, it may  be set up to authenticate the user locally once the USER and PASS commands are entered by specifying the -a|--authenticate_in option on the command line. This authentication happens before the connection to the foreign server is made and must succeed for a connection to the foreign server to be made.</p><p>This authentication uses PAM and a sample pam configuration file for perdition can be found in etc/pam.d/perdition in the source tree. This should be dropped into /etc/pam.d.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DOMAIN DELIMITER</h2>
        <div class="sectioncontent">
<p>A multi character domain delimiter can be set using the -d|--domain delimiter option. This sets the delimiter used in conjunction with the -S|--strip_domain and -c|--client_server_specification options.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USER PORT SPECIFICATION</h2>
        <div class="sectioncontent">
<p>If perdition is invoked with the -c|--client_server_specification flag then the user may optionally specify the server and port that perdition should connect to for the client using the syntax user&lt;delimiter&gt;host[:port].</p><p>Example:</p>
<pre>
IMAP4

0 login henry@that.host:143

POP3

user james@other.host
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IDLE TIMEOUTS</h2>
        <div class="sectioncontent">
<p>Perdition allows two idle timeouts to be configured. --authentication_timeout is used before the user has been successfully authenticated with the back-end server. And after that --timeout is used.</p><p>The default value for both timeouts is is 1800. A timeout value of 0 means that the timeouts are disabled and clients and back-end servers can idle indefinitely, though in practice a TCP timeout will be in effect.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOOP DETECTION</h2>
        <div class="sectioncontent">
<p>The greeting that perdition displays when accepting an incoming connection is "+OK POP3 Ready &lt;hostname&gt;" or "* OK IMAP4 Ready &lt;hostname&gt;" in POP3 and IMAP4 modes respectively. If when perdition connects to the back-end server the greeting string matches the greeting string of the perdition process making the connection then it is assumed that perdition is connecting to itself and a "Re-Authentication Failure" is returned to the client.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILE</h2>
        <div class="sectioncontent">
<p>The format of a line of the configuration file is:</p><p>&lt;key&gt; &lt;value&gt;</p><p>Key is either a short or long option as per perdition -h|--help, without the leading - or --.  Blank lines are ignored, as is anything including and after a # (hash) on a line. If a nbsp;precedes a new line then the lines will be concatenated. IF a nbsp;precedes any other character, including a # (hash) it will be treated as a literal. Anything inside single quotes (') will be treated as a literal. Anything other than a (') inside double quotes (") will be treated as a literal. Whitespace in keys must be escaped or quoted. Whitespace in values need not be escaped or quoted.</p><p>Options that do not make sense in the configuration file such as h|help and f|config_file  are ignored. Options specified on the command line override the options in this file.</p><p>Example configuration File.</p>
<pre>
# perdition.conf
l           110             #Short option used as key
group       mail            #Long option used as key
a                           #Option with no argument
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">POP BEFORE SMTP</h2>
        <div class="sectioncontent">
<p>Perdition supports POP before SMTP in both POP3 and IMAP4 mode by logging having logging the following messages:</p><p>When a user connects:</p><p>Connect: &lt;from_to&gt; [inetd_pid=&lt;pid&gt;]</p><p>When a user is authenticated</p><p>Auth: &lt;from_to&gt; client-secure=SECURE_STATUS authorisation_id="&lt;authorisation_id&gt;" authentication_id="&lt;authentication_id&gt;" password="&lt;password&gt;" server="&lt;servername&gt;:&lt;port&gt;" protocol=&lt;protocol&gt; server-secure=SECURE_STATUS status=failed...|ok</p><p>When a user disconnects</p><p>Close: &lt;from_to&gt; authorisation_id="&lt;authorisation_id&gt;" authentication_id="&lt;authentication_id&gt;" received=&lt;bytes&gt; sent=&lt;bytes&gt;</p><p>Where:</p><p><strong>from_to</strong> is &lt;src_ip_address&gt;:&lt;src_port&gt;-&gt;&lt;dest_ip_address&gt;:&lt;dest_port&gt;</p><p><strong>SECURE_STATUS is one of:</strong></p><p><strong>ssl:</strong> Uses SSL/TLS from the beginning of the connection. That is, IMAPS or POP3S.</p><p><strong>starttls:</strong> A STARTTLS or STLS command has been issued and SSL/TLS was subsequently negotiated.</p><p>Note that if the message is logged before SSL/TLS negotiation completed then the status will be plaintext. Even if the connection would have used starttls if successful. For example, if connecting to the real-server fails.</p><p><strong>plaintext:</strong> SSL/TLS is not in use.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOGGING</h2>
        <div class="sectioncontent">
<p>By default, logs are logged via syslog using the facility mail.  You should inspect /etc/syslog.conf to find where these logs are written.  Under Debian these logs will be written to /var/log/mail.log, under Red Hat 7.x these logs will be written to /var/log/maillog, under Solaris 8 these logs will be written to /var/log/syslog.  Normally each session will have two perdition log entries.  Logs are prepended, depending on syslog with the date, host, and perdition[&lt;pid&gt;]: .</p><p>Fatal errors are also logged with a priority of err. In stand-alone mode the startup parameters are logged on initialisation.  If the -d|--debug command line option or configuration file directive is used then startup parameters are logged regardless of other configuration directives and in both stand-alone and identd mode additional debugging messages are logged with a priority of debug. As the flag implies, this is useful for debugging but is probably too verbose for production systems. If the -q|--quiet command line option or configuration file directive is used, only errors will be logged. This is overridden by -d|--debug.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SSL/TLS Support</h2>
        <div class="sectioncontent">
<p>Perdition supports using SSLv2 and SSLv3 to encrypt sessions between end users and perdition and sessions between perdition and real servers. SSL may be used for either, both or none of these classes of connections.</p><p>The public key and certificate files should be in PEM format. As a quick guide, the files may be generated using openssl with the following command:</p>
<pre>
openssl req -new -x509 -nodes &#92;
  -out perdition.crt.pem -keyout perdition.key.pem -days 365
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Mixed-mode configurations</h2>
        <div class="sectioncontent">
<p>Perdition can be used in a mixed-mode where the end-users connect to perdition using SSL and then perdition connects to the real-servers using palin-text. Or vice versa. This is achieved using --ssl_mode and at least one of -l|--listen_port  and -p|--outgoing_port. When running this kind of configuration -P|--protocol values of IMAP and IMAPS are equivalent and likewise POP3 and POP3S are equivalent.</p><p>For example, to accept connections from end-users using POP3S on port 995 (the default POP3S port) and communicate with the real-servers using POP3 on port 110 (the default POP3 port) the following are equivalent.</p><p>--ssl_mode=ssl_listen --protocol=POP3S --outgoing_port=110</p><p>and</p><p>--ssl_mode=ssl_listen --protocol=POP3 --incoming_port=995</p><p>Perdition is not able to listen for connections from end-users using POP3/POP3S and communicate with real-servers using IMAP4/IMAP4S or vice-versa.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>/etc/perdition/perdition.conf</p>
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO perdition.imap4s&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/perditiondb.5.html"><strong>perditiondb</strong>(5)</a>, <strong>inetd</strong>(8), <strong>syslog.conf</strong>(5), <strong>syslogd</strong>(8)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p><strong>Lead</strong></p><p>Horms &lt;horms@verge.net.au&gt;</p><p><strong>Perditiondb Library Authors</strong></p><p>Frederic Delchambre &lt;dedel@freegates.be&gt;      (MySQL)</p><p>Chris Stratford: &lt;chriss@uk.uu.net&gt;           (LDAP and Berkeley DB)</p><p>Nathan Neulinger &lt;nneul@umr.edu&gt;              (NIS)</p><p><strong>Contributing Authors</strong></p><p>Daniel Roesen &lt;droesen@entire-systems.com&gt;</p><p>Clinton Work &lt;work@scripty.com&gt;</p><p>Youri &lt;ya@linkline.be&gt;</p><p>Jeremy Nelson &lt;jnelson@optusnet.com.au&gt;</p><p>Wim Bonis &lt;bonis@solution-service.de&gt;</p><p>Arvid Requate &lt;arvid@Team.OWL-Online.DE&gt;</p><p>Mikolaj J. Habryn &lt;dichro@rcpt.to&gt;</p><p>Ronny Cook &lt;ronny@asiaonline.net&gt;</p><p>Geoff Mitchell &lt;g.mitchell@videonetworks.com&gt;</p><p>Willi Langenberger &lt;wlang@wu-wien.ac.at&gt;</p><p>Matt Prigge &lt;mprigge@pobox.com&gt;</p><p>Wolfgang Breyha &lt;wolfgang.breyha@uta.at&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="perdition.imap4.8.html"><span aria-hidden="true">&larr;</span> perdition.imap4.8: Pop3 and imap4 proxy server</a></li>
   <li class="next"><a href="perdition.imaps.8.html">perdition.imaps.8: Pop3 and imap4 proxy server <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
