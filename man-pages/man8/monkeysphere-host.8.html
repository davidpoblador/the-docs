<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>monkeysphere-host: Monkeysphere host key administration tool.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Monkeysphere host key administration tool.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="monkeysphere-host (8) manual">
  <meta name="twitter:description" content="Monkeysphere host key administration tool.">
  <meta name="twitter:image" content="https://www.carta.tech/images/monkeysphere-monkeysphere-host-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/monkeysphere-host.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="monkeysphere-host (8) manual" />
  <meta property="og:description" content="Monkeysphere host key administration tool." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/monkeysphere-monkeysphere-host-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">monkeysphere-host<small> (8)</small></h1>
        <p class="lead">Monkeysphere host key administration tool.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/monkeysphere-host.8.html">
      <span itemprop="name">monkeysphere-host: Monkeysphere host key administration tool.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/monkeysphere/">
      <span itemprop="name">monkeysphere</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/monkeysphere-host.8.html">
      <span itemprop="name">monkeysphere-host: Monkeysphere host key administration tool.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>monkeysphere-host </strong><em>subcommand</em><strong> [</strong><em>args</em><strong>]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Monkeysphere</strong> is a framework to leverage the OpenPGP web of trust for SSH and TLS key-based authentication.</p><p><strong>monkeysphere-host</strong> stores and manages OpenPGP certificates for various services offered by the host.</p><p>Most subcommands take a KEYID argument, which identifies (by OpenPGP key ID (e.g. 0xDEADBEEF) or full OpenPGP fingerprint) which certificate is to be operated upon.  If only one certificate is currently managed by <strong>monkeysphere-host</strong>, the KEYID argument may be omitted, and <strong>monkeysphere-host</strong> will operate on it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUBCOMMANDS</h2>
        <div class="sectioncontent">
<p><strong>monkeysphere-host</strong> takes various subcommands:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>import-key FILE SCHEME://HOSTNAME[:PORT]</strong></p>
  </dt>
  <dd>
    <p>Import a PEM-encoded host secret key from file FILE.  If FILE is `-', then the key will be imported from stdin.  Only RSA keys are supported at the moment.  SCHEME://HOSTNAME[:PORT] is used to specify the scheme (e.g. ssh or https), fully-qualified hostname (and port) used in the user ID of the new OpenPGP key (e.g. ssh://example.net or https://www.example.net).  If PORT is not specified, then no port is added to the user ID, which means the default port for that service (e.g. 22 for ssh) is assumed.  `i' may be used in place of `import-key'.</p>
  </dd>
  <dt>
    <p><strong>show-keys [KEYID ...]</strong></p>
  </dt>
  <dd>
    <p>Output information about the OpenPGP certificate(s) for services offered by the host, including their KEYIDs.  If no KEYID is specified (or if the special string `--all' is used), output information about all certificates managed by <strong>monkeysphere-host</strong>.  `s' may be used in place of `show-keys'.</p>
  </dd>
  <dt>
    <p><strong>set-expire EXPIRE [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Extend the validity of the OpenPGP certificate specified until EXPIRE from the present.  Expiration is specified as with GnuPG (measured from today's date):</p>
<pre>
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
</pre>
<p>`e' may be used in place of `set-expire'.</p>
  </dd>
  <dt>
    <p><strong>add-servicename SCHEME://HOSTNAME[:PORT] [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Add a service-specific user ID to the specified certificate.  For example, the operator of `https://example.net' may wish to add an additional servicename of `https://www.example.net' to the certificate corresponding to the secret key used by the TLS-enabled web server. `add-name' or `n+' may be used in place of `add-servicename'.</p>
  </dd>
  <dt>
    <p><strong>revoke-servicename SCHEME://HOSTNAME[:PORT] [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Revoke a service-specific user ID from the specified certificate. `revoke-name' or `n-' may be used in place of `revoke-servicename'.</p>
  </dd>
  <dt>
    <p><strong>add-revoker REVOKER_KEYID|FILE [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Add a revoker to the specified OpenPGP certificate.  The revoker can be specified by their own REVOKER_KEYID (in which case it will be loaded from an OpenPGP keyserver), or by specifying a path to a file containing the revoker's OpenPGP certificate, or by specifying `-' to load from stdin.  `r+' may be be used in place of `add-revoker'.</p>
  </dd>
  <dt>
    <p><strong>revoke-key [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Generate (with the option to publish) a revocation certificate for given OpenPGP certificate.  If such a certificate is published, the given key will be permanently revoked, and will no longer be accepted by monkeysphere-enabled clients.  This subcommand will ask you a series of questions, and then generate a key revocation certificate, sending it to stdout.  You might want to store these certificates safely offline, to publish in case of compromise).  If you explicitly tell it to publish the revocation certificate immediately, it will send it to the public keyservers.  PUBLISH THESE CERTIFICATES ONLY IF YOU ARE SURE THE CORRESPONDING KEY WILL NEVER BE RE-USED!</p>
  </dd>
  <dt>
    <p><strong>publish-keys [KEYID ...]</strong></p>
  </dt>
  <dd>
    <p>Publish the specified OpenPGP certificates to the public keyservers. If the special string `--all' is specified, all of the host's OpenPGP certificates will be published.  `p' may be used in place of `publish-keys'.  NOTE: that there is no way to remove a key from the public keyservers once it is published!</p>
  </dd>
  <dt>
    <p><strong>version</strong></p>
  </dt>
  <dd>
    <p>Show the monkeysphere version number.  `v' may be used in place of `version'.</p>
  </dd>
  <dt>
    <p><strong>help</strong></p>
  </dt>
  <dd>
    <p>Output a brief usage summary.  `h' or `?' may be used in place of `help'.</p>
  </dd>
  <dt>
    <p><strong>diagnostics</strong></p>
  </dt>
  <dd>
    <p>Review the state of the monkeysphere server host key and report on suggested changes.  Among other checks, this includes making sure there is a valid host key, that the key is not expired, that the sshd configuration points to the right place, etc.  `d' may be used in place of `diagnostics'.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SETUP SSH SERVER CERTIFICATES</h2>
        <div class="sectioncontent">
<p>To enable users to verify your SSH host's key via the monkeysphere, an OpenPGP certificate must be made out of the host's RSA ssh key, and the certificate must be published to the Web of Trust.  Certificate publication is not done by default.  The first step is to import the host's ssh key into a monkeysphere-style OpenPGP certificate.  This is done with the import-key command.  For example:</p><p># monkeysphere-host import-key /etc/ssh/ssh_host_rsa_key ssh://host.example.org</p><p>On most systems, sshd's RSA secret key is stored at /etc/ssh/ssh_host_rsa_key.</p><p>See PUBLISHING AND CERTIFYING MONKEYSPHERE SERVICE CERTIFICATES for how to make sure your users can verify the ssh service offered by your host once the key is imported into <strong>monkeysphere-host</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SETUP WEB SERVER CERTIFICATES</h2>
        <div class="sectioncontent">
<p>You can set up your HTTPS-capable web server so that your users can verify it via the monkeysphere, without changing your server's software at all.  You just need access to a (PEM-encoded) version of the server's RSA secret key (most secret keys are already stored PEM-encoded).  The first step is to import the web server's key into a monkeysphere-style OpenPGP certificate.  This is done with the import-key command.  For example:</p><p># monkeysphere-host import-key /etc/ssl/private/host.example.net-key.pem https://host.example.net</p><p>If you don't know where the web server's key is stored on your machine, consult the configuration files for your web server. Debian-based systems using the `ssl-cert' packages often have a default self-signed certificate stored in `/etc/ssl/private/ssl-cert-snakeoil.key' ; if you're using that key, your users are getting browser warnings about it.  You can keep using the same key, but help them use the OpenPGP WoT to verify that it does belong to your web server by using something like:</p><p># monkeysphere-host import-key /etc/ssl/private/ssl-cert-snakeoil.key https://$(hostname --fqdn)</p><p>If you offer multiple HTTPS websites using the same secret key, you should add the additional website names with the `add-servicename' subcommand.</p><p>See PUBLISHING AND CERTIFYING MONKEYSPHERE SERVICE CERTIFICATES (the next section) for how to make sure your users can verify the https service offered by your host once the key is imported and any extra site names have been added.  Note that you can add or remove additional servicenames at any time, but you'll need to certify any new ones separately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PUBLISHING AND CERTIFYING MONKEYSPHERE SERVICE CERTIFICATES</h2>
        <div class="sectioncontent">
<p>Once the host key has been imported, the corresponding certificate must be published to the Web of Trust so that users can retrieve the cert when connecting to the host.  The host certificates are published to the keyserver with the publish-key command:</p><p>$ monkeysphere-host publish-key --all</p><p>In order for users accessing the system to be able to identify the host's service via the monkeysphere, at least one person (e.g. a server admin) will need to sign the host's certificate.  This is done using standard OpenPGP keysigning techniques.  Usually: pull the host's OpenPGP certificate from the keyserver, verify and sign it, and then re-publish your signature.  More than one person can certify any certificate.  Please see http://web.monkeysphere.info/doc/host-keys/ for more information and details.  Once an admin's signature is published, users accessing the host can use the certificate to validate the host's key without having to manually check the host key's fingerprint (in the case of ssh) or without seeing a nasty "security warning" in their browsers (in the case of https).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY CONSIDERATIONS</h2>
        <div class="sectioncontent">
<p>Note that <strong>monkeysphere-host</strong> currently caches a copy of all imported secret keys (stored in OpenPGP form for future manipulation) in /var/lib/monkeysphere/host/secring.gpg.  Cleartext backups of this file could expose secret key material if not handled sensitively.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>The following environment variables will override those specified in the config file (defaults in parentheses):</p>
<dl class='dl-vertical'>
  <dt>
    <p>MONKEYSPHERE_LOG_LEVEL</p>
  </dt>
  <dd>
    <p>Set the log level.  Can be SILENT, ERROR, INFO, VERBOSE, DEBUG, in increasing order of verbosity. (INFO)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_KEYSERVER</p>
  </dt>
  <dd>
    <p>OpenPGP keyserver to use. (pool.sks-keyservers.net)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_PROMPT</p>
  </dt>
  <dd>
    <p>If set to `false', never prompt the user for confirmation. (true)</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>/etc/monkeysphere/monkeysphere-host.conf</p>
  </dt>
  <dd>
    <p>System monkeysphere-host config file.</p>
  </dd>
  <dt>
    <p>/var/lib/monkeysphere/host_keys.pub.pgp</p>
  </dt>
  <dd>
    <p>A world-readable copy of the host's OpenPGP certificates in ASCII armored format.  This includes the certificates (including the public keys, servicename-based User IDs, and most recent relevant self-signatures) corresponding to every key used by Monkeysphere-enabled services on the host.</p>
  </dd>
  <dt>
    <p>/var/lib/monkeysphere/host/</p>
  </dt>
  <dd>
    <p>A locked directory (readable only by the superuser) containing copies of all imported secret keys (this is the host's GNUPGHOME directory).</p>
  </dd>
  <dt>
    <p>/etc/monkeysphere/monkeysphere-host-x509-anchors.crt or\p  /etc/monkeysphere/monkeysphere-x509-anchors.crt</p>
  </dt>
  <dd>
    <p>If monkeysphere-host is configured to query an hkps keyserver for publish-keys, it will use the PEM-encoded X.509 Certificate Authority certificates in this file to validate any X.509 certificates used by the keyserver.  If the monkeysphere-host-x509 file is present, the monkeysphere-x509 file will be ignored.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This man page was written by: Jameson Rollins &lt;jrollins@finestructure.net&gt;, Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;, Matthew Goins &lt;mjgoins@openflows.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO monkeysphere-host&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/monkeysphere.1.html"><strong>monkeysphere</strong>(1)</a>, <a href="../man7/monkeysphere.7.html"><strong>monkeysphere</strong>(7)</a>, <a href="../man1/gpg.1.html"><strong>gpg</strong>(1)</a>, <a href="../man8/monkeysphere-authentication.8.html"><strong>monkeysphere-authentication</strong>(8)</a>, <strong>ssh</strong>(1), <strong>sshd</strong>(8)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="monkeysphere-authentication.8.html"><span aria-hidden="true">&larr;</span> monkeysphere-authentication.8: Monkeysphere authentication admin tool.</a></li>
   <li class="next"><a href="monmaptool.8.html">monmaptool.8: Ceph monitor cluster map manipulation tool <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
