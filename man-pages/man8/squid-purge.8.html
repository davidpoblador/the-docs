<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>squid-purge: Magnifying glass into your squid cache</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Magnifying glass into your squid cache">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="squid-purge (8) manual">
  <meta name="twitter:description" content="Magnifying glass into your squid cache">
  <meta name="twitter:image" content="https://www.carta.tech/images/squid-purge-squid-purge-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/squid-purge.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="squid-purge (8) manual" />
  <meta property="og:description" content="Magnifying glass into your squid cache" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/squid-purge-squid-purge-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">squid-purge<small> (8)</small></h1>
        <p class="lead">Magnifying glass into your squid cache</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/squid-purge.8.html">
      <span itemprop="name">squid-purge: Magnifying glass into your squid cache</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/squid-purge/">
      <span itemprop="name">squid-purge</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/squid-purge.8.html">
      <span itemprop="name">squid-purge: Magnifying glass into your squid cache</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>squid-purge [-a] [-c cf] [-d l] [-(f|F) fn | -(e|E) re] [-p h[:p]]</strong></p>
<pre>
                [-P #] [-s] [-v] [-C dir [-H]] [-n]"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>squid-purge</strong> is used to have a look at what URLs are stored in which file within your cache. The purge tool can also be used to release objects which URLs match user specified regular expressions. A more troublesome feature is the ability to remove files squid does not seem to know about any longer.</p><p>This is a tool for expert usage only, use it under your own responsability.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SQUID PREPARATION</h2>
        <div class="sectioncontent">
<p>In order to use purge for real PURGEs, you will have to enable this feature in squid. By default, PURGE is disabled. You should watch closely for whom you enable the PURGE ability, otherwise total stranger just might wipe your cache content. The following lines will need to be added to your squid.conf (you may want to add further networks to the src_local ACL):</p><p><strong>acl purge method PURGE</strong></p><p><strong>acl src_local src 127.0.0.0/8</strong></p><p><strong>http_access allow purge src_local</strong></p><p><strong>http_access deny purge</strong></p><p>Reconfigure or restart (preferred) your squid after changing the configuration file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MODES OF OPERATION (Usage)</h2>
        <div class="sectioncontent">
<p><strong>squid-purge [-a] [-c cf] [-d l] [-(f|F) fn | -(e|E) re] [-p h[:p]]</strong></p>
<pre>
                [-P #] [-s] [-v] [-C dir [-H]] [-n]
</pre>
<p><strong>-a	is a kind of i am alive flag. It can only be activated, if</strong> your stdout is a tty. If active, it will display a little rotating line to indicate that there is actually something happening. You should not use this switch, if you capture your stdout in a file, or if your expression list produces many matches. The -a flag is also incompatible with the (default) multi cache_dir mode.</p><p>default: off		See also: -n</p><p><strong>-c cd</strong> this option lets you specify the location of the squid.conf file. Purge now understands about more than one cache_dir, and does so by parsing Squid's configuration file. It knows about both ways of Squid-2 cache_dir specifications, and will automatically try to use the correct one.</p><p>default: /usr/local/squid/etc/squid.conf</p><p><strong>-C cd</strong> if you want to rescue files from your cache, you need to specify the directory into which the files will be copied. Please note that purge will try to establish the original server's directory structure. This switch also activates copy-out mode. Please do not use copy-out mode with any purge mode (-P) other than 0.</p><p>For instance, if you specified "-C /tmp", purge will try to recreate /tmp/www.server.1/url/path/file, and so forth.</p><p>default: off		See also: -H, -P</p><p><strong>-d l</strong> lets you specify a debug level. Differents bits are reserved for different output.</p><p>default: 0</p><p><strong>-e re</strong> the "-e" options let you specify one regular expression at the</p><p><strong>-E re</strong> commandline. This is useful, if there is only a handful you want to check. Please remember to escape the shell metachars used in your regular expression. The use of single quotes around your expression is recommended. The capital letter version works case sensitive, the lower caps version does not.</p><p>default: (no default)</p><p><strong>-f fn</strong> if you have more than a handful of expression, or want to check</p><p><strong>-F fn</strong> the same set at regular intervals, the file option might be more useful to you. Each line in the text file will be regarded as one regular expression.  Again, the capital letter version works case sensitive, the lower caps version does not.</p><p>default: (no default)</p><p><strong>-H</strong> if in copy-out mode (see: -C), you can specify to keep the HTTP Header in the recreated file.</p><p>default: off		See also: -C</p><p><strong>-n</strong> by specifying the "-n" switch, you will tell purge to process one cache_dir after another, instead of doing things in parallel. If you have more than one cache_dir in your configuration purge will fork off a worker process for each cache_dir to do the checks for optimum speed, assuming a decently designed cache. Since parallel execution will put quite some load on the system and its controllers, it is sometimes preferred to use less resources,	though it will take longer.</p><p>default: parallel mode for more than one cache_dir</p><p><strong>-p h[:p]</strong> Some cache admins use a different port than 3128. The purge tool will need to connect to your cache in order to send the PURGE request (see -P). This option lets you specify the host and port to connect to. The port is optional. The port can be a name (check your /etc/services) or number. It is separated from the host name portion by a single colon, no spaces allowed.</p><p>default: localhost:3128</p><p><strong>-P #</strong> If you want to do more than just print your cache content, you will need to specify this option. Each bit is reserved for a different action. Only the use of the LSB is recommended, the rest should be considered experimental.</p><p><strong>no bit set: just print</strong></p><p><strong>bit#0 set: send PURGE for matches</strong></p><p><strong>bit#1 set: unlink object file for 404 not found PURGEs</strong></p><p><strong>bit#2 set: unlink weird object files</strong></p><p>If you use a value other than 0 or 1, you will need to slow rebuild your cache content. A warning message will remind you of that. If you use bit#1, all unsuccessful PURGEs will result in the object file in your cache directory to be removed, because squid does not seem to know about it any longer. Beware that the asyncio might try to remove it after the purge tool, and thus complains bitterly. Bit#1 only makes sense, if Bit#0 is also set, otherwise it has no effect (since the HTTP status 404 is never returned).</p><p>Bit#2 is reserved for strange files which do not even contain a URL. Beware that these files may indicate a new object squid currently intends to swap onto disk. If the file suddenly went away, or is removed when squid tries to fetch the object, it will complain bitterly. You must slow rebuild your cache, if you use this option.</p><p>It is recommended that if you dare to use bit#1 or bit#2, you should only grant the purge tool access to your squid, e.g. move the HTTP and ICP listening port of squid to a different non-standard location during the purge.</p><p>default: 0 (just print)</p><p><strong>-s</strong> If you specify this switch, all commandline parameters will be shown after they were parsed.</p><p>default: off</p><p><strong>-v</strong> be verbose in the things reported about the file. See the output section below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OUTPUT</h2>
        <div class="sectioncontent">
<p>In regular mode, the output of purge consists of four columns. If the URL contains not encoded whitespaces, it may look as if there are more columns, but the last one is the URI.</p><p> # name   meaning  - ------ -----------------------------------------------------------  1 file   name of cache file eximed which matches the re.  2 status return result of purge request, "  0" in print mode.  3 size   object size including stored headers, not file size.  4 uri    perceived uri</p><p>Example for non-verbose output in print-mode:</p><p>/cache3/00/00/0000004A   0     5682 http://graphics.userfriendly.org/images/slovenia.gif</p><p>In verbose mode, additional columns are inserted before the uri. Time stamps are reported using hexadecimal notation, and Squid's standard for reporting "no such timestamp" == -1, and "unparsable timestamp" == -2.</p><p> # name   meaning  - ------ -----------------------------------------------------------  1 file   name of cache file eximed which matches the re.  2 status return result of purge request, "  0" in print mode "-P 0".  3 size   object size including stored headers, not file size.  4 md5    MD5 of URI from file, or "(no_md5_data_available)" string.  5 ts     UTC of Value of Date: header in hex notation  6 lr     UTC of last time the object was referenced  7 ex     UTC of Expires: header  8 lr     UTC of Last-Modified: header  9 flags  Value of objects flags field in hex, see: Programmers Guide 10 refcnt number of times the object was referenced. 11 uri    STORE_META_URL uri or "strange_file"</p><p>Example for verbose output in print-mode:</p><p>/cache1/00/00/000000B7   0      406 7CFCB1D319F158ADC9CFD991BB8F6DCE 397d449b 39bf677b ffffffff 3820abfc 0460     1  http://www.netscape.com/images/nc_vera_tile.gif</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p><strong>Purge does not slow rebuild the cache for you.</strong></p><p><strong>It is still relatively slow, especially if your machine is low on memory</strong> and/or unable to hold all OS directory cache entries in main memory.</p><p><strong>should never be used on busy caches with purge modes higher than 1.</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TODO</h2>
        <div class="sectioncontent">
<p>1) use the stat() result on weird files to have a look at their ctime and mtime. If they are younger than, lets say 30 seconds, they were just created by squid and should not be removed.</p><p>2) Add a query before purging objects or removing files, and add another option to remove nagging for the experienced user.</p><p>3) The reported object size may be off by one.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Santiago Garcia Mantinan &lt;manty@debian.org&gt; based on purge's README</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="spnavd_ctl.8.html"><span aria-hidden="true">&larr;</span> spnavd_ctl.8: Daemon for 3d-input-devices</a></li>
   <li class="next"><a href="squidtaild.8.html">squidtaild.8: Squidtaild  squid log monitoring program <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
