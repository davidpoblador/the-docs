<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cman_tool: Cluster management tool</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Cluster management tool">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cman_tool (8) manual">
  <meta name="twitter:description" content="Cluster management tool">
  <meta name="twitter:image" content="https://www.carta.tech/images/cman-cman_tool-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/cman_tool.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cman_tool (8) manual" />
  <meta property="og:description" content="Cluster management tool" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cman-cman_tool-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cman_tool<small> (8)</small></h1>
        <p class="lead">Cluster management tool</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cman_tool.8.html">
      <span itemprop="name">cman_tool: Cluster management tool</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cman/">
      <span itemprop="name">cman</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cman_tool.8.html">
      <span itemprop="name">cman_tool: Cluster management tool</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>cman_tool join | leave | kill | expected | votes | version | wait | status | nodes | services | debug [options]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>cman_tool</strong> is a program that manages the cluster management subsystem CMAN. cman_tool can be used to join the node to a cluster, leave the cluster, kill another cluster node or change the value of expected votes of a cluster.</p><p>Be careful that you understand the consequences of the commands issued via cman_tool as they can affect all nodes in your cluster. Most of the time the cman_tool will only be invoked from your startup and shutdown scripts.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUBCOMMANDS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>join</em></p>
  </dt>
  <dd>
    <p>This is the main use of cman_tool. It instructs the cluster manager to attempt to join an existing cluster or (if no existing cluster exists) then to form a new one on its own.</p><p>If no options are given to this command then it will take the cluster configuration information from cluster.conf. However, it is possible to provide all the information on the command-line or to override cluster.conf values by using the command line.</p>
  </dd>
  <dt>
    <p><em>leave</em></p>
  </dt>
  <dd>
    <p>Tells CMAN to leave the cluster. You cannot do this if there are subsystems (eg DLM, GFS) active. You should dismount all GFS filesystems, shutdown CLVM, fenced and anything else using the cluster manager before using <strong>cman_tool leave.</strong> Look at 'cman_tool status' and group_tool to see how many (and which) subsystems are active.</p><p>When a node leaves the cluster, the remaining nodes recalculate quorum and this may block cluster activity if the required number of votes is not present. If this node is to be down for an extended period of time and you need to keep the cluster running, add the <strong>remove</strong> option, and the remaining nodes will recalculate quorum such that activity can continue.</p>
  </dd>
  <dt>
    <p><em>kill</em></p>
  </dt>
  <dd>
    <p>Tells CMAN to kill another node in the cluster. This will cause the local node to send a "KILL" message to that node and it will shut down.  Recovery will occur for the killed node as if it had failed.  This is a sort of remote version of "leave force" so only use if if you really know what you are doing.</p>
  </dd>
  <dt>
    <p><em>expected</em></p>
  </dt>
  <dd>
    <p>Tells CMAN a new value of expected votes and instructs it to recalculate quorum based on this value.</p><p>The recalculation takes into account the number of currently active nodes, so this option should not be used in an attempt to artificially lower the quorum value in advance of a planned shutdown of cluster nodes.  Instead, the 'cman_tool leave remove' command should be used (see the 'leave' subcommand above).</p><p>Use this option if your cluster has lost quorum due to nodes failing and you need to get it running again in a hurry.</p>
  </dd>
  <dt>
    <p><em>version</em></p>
  </dt>
  <dd>
    <p>Used alone this will report the major, minor, patch and config versions used by CMAN (also displayed in 'cman_tool status'). It can also be used with -r to tell cluster members to update the cluster configuration.</p><p>If -r is specified, cman will read the configuration file, validate it, distribute it around the cluster (if necessary) an activate it.  See the VERSION OPTIONS section below for additional options to the <strong>version</strong> command.</p>
  </dd>
  <dt>
    <p><em>wait</em></p>
  </dt>
  <dd>
    <p>Waits until the node is a member of the cluster and then returns.</p>
  </dd>
  <dt>
    <p><em>status</em></p>
  </dt>
  <dd>
    <p>Displays the local view of the cluster status.</p>
  </dd>
  <dt>
    <p><em>nodes</em></p>
  </dt>
  <dd>
    <p>Displays the local view of the cluster nodes.</p>
  </dd>
  <dt>
    <p><em>services</em></p>
  </dt>
  <dd>
    <p>Displays the local view of subsystems using cman (deprecated, group_tool should be used instead).</p>
  </dd>
  <dt>
    <p><em>debug</em></p>
  </dt>
  <dd>
    <p>Sets the debug level of the running cman daemon. Debug output will be sent to syslog level LOG_DEBUG. the <strong>-d</strong> switch specifies the new logging level. This is the same bitmask used for cman_tool join -d</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LEAVE OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-w</em></p>
  </dt>
  <dd>
    <p>Normally, "cman_tool leave" will fail if the cluster is in transition (ie another node is joining or leaving the cluster). By adding the -w flag, cman_tool will wait and retry the leave operation repeatedly until it succeeds or a more serious error occurs.</p>
  </dd>
  <dt>
    <p><em>-t &lt;seconds&gt;</em></p>
  </dt>
  <dd>
    <p>If -w is also specified then -t dictates the maximum amount of time cman_tool is prepared to wait. If the operation times out then a status of 2 is returned.</p>
  </dd>
  <dt>
    <p><em>force</em></p>
  </dt>
  <dd>
    <p>Shuts down the cluster manager without first telling any of the subsystems to close down. Use this option with extreme care as it could easily cause data loss.</p>
  </dd>
  <dt>
    <p><em>remove</em></p>
  </dt>
  <dd>
    <p>Tells the rest of the cluster to recalculate quorum such that activity can continue without this node.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPECTED OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-e &lt;expected-votes&gt;</em></p>
  </dt>
  <dd>
    <p>The new value of expected votes to use. This will usually be enough to bring the cluster back to life. Values that would cause incorrect quorum will be rejected.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">KILL OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-n &lt;nodename&gt;</em></p>
  </dt>
  <dd>
    <p>The node name of the node to be killed. This should be the unqualified node name as it appears in 'cman_tool nodes'.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSION OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-r</em></p>
  </dt>
  <dd>
    <p>Update config version. You don't need to use this when adding a new node, the new cman node will tell the rest of the cluster to read the latest version of the config file automatically.  The version present in the new configuration must be higher than the one currently in use by cman.</p><p>cman_tool version on its own will always show the current version and not the one being looked for. So be aware that the display will possibly not update immediately after you have run cman_tool version -r.</p>
  </dd>
  <dt>
    <p><em>-D&lt;option&gt;</em></p>
  </dt>
  <dd>
    <p>see "JOIN" options</p>
  </dd>
  <dt>
    <p><em>-S</em></p>
  </dt>
  <dd>
    <p>By default cman_tool version will try to distribute the new cluster.conf file using ccs_sync and ricci. If you have distributed the file yourself and/or do not have ricci installed then the -S option will skip this step. NOTE: it is still important that all nodes in the cluster have the same version of the file. Make sure that this is the case before using this option.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WAIT OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-q</em></p>
  </dt>
  <dd>
    <p>Waits until the cluster is quorate before returning. <em>-t &lt;seconds&gt;</em> Dictates the maximum amount of time cman_tool is prepared to wait. If the operation times out then a status of 2 is returned.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">JOIN OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-c &lt;clustername&gt;</em></p>
  </dt>
  <dd>
    <p>Provides a text name for the cluster. You can have several clusters on one LAN and they are distinguished by this name. Note that the name is hashed to provide a unique number which is what actually distinguishes the cluster, so it is possible that two different names can clash. If this happens, the node will not be allowed into the existing cluster and you will have to pick another name or use different port number for cluster communication.</p>
  </dd>
  <dt>
    <p><em>-p &lt;port&gt;</em></p>
  </dt>
  <dd>
    <p>UDP port number used for cluster communication. This defaults to 5405.</p>
  </dd>
  <dt>
    <p><em>-v &lt;votes&gt;</em></p>
  </dt>
  <dd>
    <p>Number of votes this node has in the cluster. Defaults to 1.</p>
  </dd>
  <dt>
    <p><em>-e &lt;expected votes&gt;</em></p>
  </dt>
  <dd>
    <p>Number of expected votes for the whole cluster. If different nodes provide different values then the highest is used. The cluster will only operate when quorum is reached - that is more than half the available votes are available to the cluster. The default for this value is the total number of votes for all nodes in the configuration file.</p>
  </dd>
  <dt>
    <p><em>-2</em></p>
  </dt>
  <dd>
    <p>Sets the cluster up for a special "two node only" mode. Because of the quorum requirements mentioned above, a two-node cluster cannot be valid. This option tells the cluster manager that there will only ever be two nodes in the cluster and relies on fencing to ensure cluster integrity. If you specify this you cannot add more nodes without taking down the existing cluster and reconfiguring it. Expected votes should be set to 1 for a two-node cluster.</p>
  </dd>
  <dt>
    <p><em>-n &lt;nodename&gt;</em></p>
  </dt>
  <dd>
    <p>Overrides the node name. By default the unqualified hostname is used. This option is also used to specify which interface is used for cluster communication.</p>
  </dd>
  <dt>
    <p><em>-N &lt;nodeid&gt;</em></p>
  </dt>
  <dd>
    <p>Overrides the node ID for this node. Normally, nodes are assigned a node id in cluster.conf. If you specify an incorrect node ID here, the node might not be allowed to join the cluster. Setting node IDs in the configuration is a far better way to do this.</p><p>Note that the node's application to join the cluster may be rejected if you try to set the nodeid to one that has already been used, or if the node was previously a member of the cluster but with a different nodeid.</p>
  </dd>
  <dt>
    <p><em>-o &lt;nodename&gt;</em></p>
  </dt>
  <dd>
    <p>Override the name this node will have in the cluster. This will normally be the hostname or the first name specified by -n. Note how this differs from -n: -n tells cman_tool how to find the host address and/or the entry in the configuration file. -o simply changes the name the node will have in the cluster and has no bearing on the actual name of the machine. Use this option will extreme caution.</p>
  </dd>
  <dt>
    <p><em>-m &lt;multicast-address&gt;</em></p>
  </dt>
  <dd>
    <p>Specifies a multicast address to use for cluster communication. This is required for IPv6 operation. You should also specify an ethernet interface to bind to this multicast address using the -i option.</p>
  </dd>
  <dt>
    <p><em>-w</em></p>
  </dt>
  <dd>
    <p>Join and wait until the node is a cluster member.</p>
  </dd>
  <dt>
    <p><em>-q</em></p>
  </dt>
  <dd>
    <p>Join and wait until the cluster is quorate. If the cluster join fails and -w (or -q) is specified, then it will be retried. Note that cman_tool cannot tell whether the cluster join was rejected by another node for a good reason or that it timed out for some benign reason; so it is strongly recommended that a timeout is also given with the wait options to join. If you don't want join to retry on failure but do want to wait, use the <strong>cman_tool join</strong> command without -w followed by <strong>cman_tool wait.</strong></p>
  </dd>
  <dt>
    <p><em>-k &lt;keyfile&gt;</em></p>
  </dt>
  <dd>
    <p>All traffic sent out by cman/corosync is encrypted. By default the security key used is simply the cluster name. If you need more security you can specify a key file that contains the key used to encrypt cluster communications. Of course, the contents of the key file must be the same on all nodes in the cluster. It is up to you to securely copy the file to the nodes.</p>
  </dd>
  <dt>
    <p><em>-t &lt;seconds&gt;</em></p>
  </dt>
  <dd>
    <p>If -w or -q is also specified then -t dictates the maximum amount of time cman_tool is prepared to wait. If the operation times out then a status of 2 is returned. Note that just because cman_tool has given up, does not mean that cman itself has stopped trying to join a cluster.</p>
  </dd>
  <dt>
    <p><em>-X</em></p>
  </dt>
  <dd>
    <p>Tells cman not to use the configuration file to get cluster information. If you use this option then cman will apply several defaults to the cluster to get it going. The cluster name will be "RHCluster", node IDs will default to the IP address of the node and remote node names will show up as Node&lt;nodeid&gt;. All of these, apart from the node names can be overridden on the cman_tool command-line if required.</p><p>If you have to set up fence devices, services or anything else in cluster.conf then this option is probably not worthwhile to you - the extra readability of sensible node names and numbers will make it worth using cluster.conf for the cluster too. But for a simple failover cluster this might save you some effort.</p><p>On each node using this configuration you will need to have the same authorization key installed. To create this key run</p><p>corosync-keygen</p><p>mv /etc/ais/authkey /etc/cluster/cman_authkey</p><p>then copy that file to all nodes you want to join the cluster.</p>
  </dd>
  <dt>
    <p><em>-C</em></p>
  </dt>
  <dd>
    <p>Overrides the default configuration module. Usually cman uses xmlconfig (cluster.conf) to load its configuration. If you have your configuration database held elsewhere (eg LDAP) and have a configuration plugin for it, then you should specify the name of the module (see the documentation for the module for the name of it - it's not necessarily the same as the filename) here.</p><p>It is possible to chain configuration modules by separating them with colons. So to add two modules (eg) 'ldapconfig' and 'ldappreproc' to the chain start cman with -C ldapconfig:ldappreproc</p><p>The default value for this is 'xmlconfig'. Note that if the -X is on the command-line then -C will be ignored.</p>
  </dd>
  <dt>
    <p><em>-A</em></p>
  </dt>
  <dd>
    <p>Don't load openais services. Normally cman_tool join will load the configuration module 'openaisserviceenablestable' which will load the services installed by openais. If you don't want to use these services or have not installed openais then this switch will disable them.</p>
  </dd>
  <dt>
    <p><em>-D</em></p>
  </dt>
  <dd>
    <p>Tells cman_tool whether to validate the configuration before loading or reloading it. By default the configuration <strong>is</strong> validated, which is equivalent to -Dfail.</p><p>-Dwarn will validate the configuration and print any messages arising, but will attempt to use it regardless of its validity.</p><p>-Dnone (or just -D) will skip the validation completely.</p><p>The -D switch does not take a space between -D and the parameter. so '-D fail' will cause an error. Use -Dfail.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NODES OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-a</em></p>
  </dt>
  <dd>
    <p>Shows the IP address(es) the nodes are communicating on.</p>
  </dd>
  <dt>
    <p><em>-n &lt;nodename&gt;</em></p>
  </dt>
  <dd>
    <p>Shows node information for a specific node. This should be the unqualified node name as it appears in 'cman_tool nodes'.</p>
  </dd>
  <dt>
    <p><em>-F &lt;format&gt;</em></p>
  </dt>
  <dd>
    <p>Specify the format of the output. The format string may contain one or more format options, each separated by a comma. Valid format options include: id, name, type, and addr.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEBUG OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>-d&lt;value&gt;</em></p>
  </dt>
  <dd>
    <p>The value is a bitmask of</p><p>2 Barriers</p><p>4 Membership messages</p><p>8 Daemon operation, including command-line interaction</p><p>16 Interaction with Corosync</p><p>32 Startup debugging (cman_tool join operations only)</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>the <strong>nodes</strong> subcommand shows a list of nodes known to cman. the state is one of the following:</p><p>M	The node is a member of the cluster</p><p>X	The node is not a member of the cluster</p><p>d	The node is known to the cluster but disallowed access to it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">
<p>cman_tool removes most environment variables before forking and running Corosync, as well as adding some of its own for setting up configuration parameters that were overridden on the command-line, the exception to this is that variable with names starting COROSYNC_ will be passed down intact as they are assumed to be used for configuring the daemon.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DISALLOWED NODES</h2>
        <div class="sectioncontent">
<p>Occasionally (but very infrequently I hope) you may see nodes marked as "Disallowed" in cman_tool status or "d" in cman_tool nodes.  This is a bit of a nasty hack to get around mismatch between what the upper layers expect of the cluster manager and corosync.</p>
<dl class='dl-vertical'>
  <dt>
    <p>If a node experiences a momentary lack of connectivity, but one that is long enough to trigger the token timeouts, then it will be removed from the cluster. When connectivity is restored corosync will happily let it rejoin the cluster with no fuss. Sadly the upper layers don't like this very much. They may (indeed probably will have) have changed their internal state while the other node was away and there is no straightforward way to bring the rejoined node up-to-date with that state. When this happens the node is marked "Disallowed" and is not permitted to take part in cman operations.</p>
  </dt>
  <dd>
    
  </dd>

</dl>
<p>If the remainder of the cluster is quorate the the node will be sent a kill message and it will be forced to leave the cluster that way. Note that fencing should kick in to remove the node permanently anyway, but it may take longer than the network outage for this to complete.</p><p>If the remainder of the cluster is inquorate then we have a problem. The likelihood is that we will have two (or more) partitioned clusters and we cannot decide which is the "right" one. In this case we need to defer to the system administrator to kill an appropriate selection of nodes to restore the cluster to sensible operation.</p><p>The latter scenario should be very rare and may indicate a bug somewhere in the code. If the local network is very flaky or busy it may be necessary to increase some of the protocol timeouts for corosync. We are trying to think of better solutions to this problem.</p><p>Recovering from this state can, unfortunately, be complicated. Fortunately, in the majority of cases, fencing will do the job for you, and the disallowed state will only be temporary. If it persists, the recommended approach it is to do a cman tool nodes on all systems in the cluster and determine the largest common subset of nodes that are valid members to each other. Then reboot the others and let them rejoin correctly. In the case of a single-node disconnection this should be straightforward, with a large cluster that has experienced a network partition it could get very complicated!</p><p>Example:</p><p>In this example we have a five node cluster that has experienced a network partition. Here is the output of cman_tool nodes from all systems:</p>
<pre>
Node  Sts   Inc   Joined               Name
   1   M   2372   2007-11-05 02:58:55  node-01.example.com
   2   d   2376   2007-11-05 02:58:56  node-02.example.com
   3   d   2376   2007-11-05 02:58:56  node-03.example.com
   4   M   2376   2007-11-05 02:58:56  node-04.example.com
   5   M   2376   2007-11-05 02:58:56  node-05.example.com

Node  Sts   Inc   Joined               Name
   1   d   2372   2007-11-05 02:58:55  node-01.example.com
   2   M   2376   2007-11-05 02:58:56  node-02.example.com
   3   M   2376   2007-11-05 02:58:56  node-03.example.com
   4   d   2376   2007-11-05 02:58:56  node-04.example.com
   5   d   2376   2007-11-05 02:58:56  node-05.example.com

Node  Sts   Inc   Joined               Name
   1   d   2372   2007-11-05 02:58:55  node-01.example.com
   2   M   2376   2007-11-05 02:58:56  node-02.example.com
   3   M   2376   2007-11-05 02:58:56  node-03.example.com
   4   d   2376   2007-11-05 02:58:56  node-04.example.com
   5   d   2376   2007-11-05 02:58:56  node-05.example.com

Node  Sts   Inc   Joined               Name
   1   M   2372   2007-11-05 02:58:55  node-01.example.com
   2   d   2376   2007-11-05 02:58:56  node-02.example.com
   3   d   2376   2007-11-05 02:58:56  node-03.example.com
   4   M   2376   2007-11-05 02:58:56  node-04.example.com
   5   M   2376   2007-11-05 02:58:56  node-05.example.com

Node  Sts   Inc   Joined               Name
   1   M   2372   2007-11-05 02:58:55  node-01.example.com
   2   d   2376   2007-11-05 02:58:56  node-02.example.com
   3   d   2376   2007-11-05 02:58:56  node-03.example.com
   4   M   2376   2007-11-05 02:58:56  node-04.example.com
   5   M   2376   2007-11-05 02:58:56  node-05.example.com
</pre>
<p>In this scenario we should kill the node node-02 and node-03. Of course, the 3 node cluster of node-01, node-04 & node-05 should remain quorate and be able to fenced the two rejoined nodes anyway, but it is possible that the cluster has a qdisk setup that precludes this.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION SYSTEMS</h2>
        <div class="sectioncontent">
<p>This section details how the configuration systems work in cman. You might need to know this if you are using the -C option to cman_tool, or writing your own configuration subsystem.</p><p>By default cman uses two configuration plugins to corosync. The first, 'xmlconfig', reads the configuration information stored in cluster.conf and stores it in an internal database, in the same schema as it finds in cluster.conf. The second plugin, 'cmanpreconfig', takes the information in that the database, adds several cman defaults, determines the corosync node name and nodeID and formats the information in a similar manner to <a href="../man5/corosync.conf.5.html"><strong>corosync.conf</strong>(5)</a>. Corosync then reads those keys to start the cluster protocol. cmanpreconfig also reads several environment variables that might be set by cman_tool which can override information in the configuration.</p><p>In the absence of xmlconfig, ie when 'cman_tool join' is run with -X switch (this removes xmlconfig from the module list), cmanpreconfig also generates several defaults so that the cluster can be got running without any configuration information - see above for the details.</p><p>Note that cmanpreconfig will not overwrite corosync keys that are explicitly set in the configuration file, allowing you to provide custom values for token timeouts etc, even though cman has its own defaults for some of those values. The exception to this is the node name/address and multicast values, which are always taken from the cman configuration keys.</p><p>Most of the extra keys that cmanpreconfig adds are outside of the /cluster/ tree and will only be seen if you dump the whole of corosync's object database. However it does add some keys into /cluster/cman that you would not normally see in a normal cluster.conf file. These are harmless, though could be confusing. The most obvious of these is the "nodename" option which is passed from cmanpreconfig to the name cman module, to save it recalculating the node name again.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cman_notify.8.html"><span aria-hidden="true">&larr;</span> cman_notify.8: Cman notification daemon run-part alike script</a></li>
   <li class="next"><a href="cmannotifyd.8.html">cmannotifyd.8: Cman notification daemon <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
