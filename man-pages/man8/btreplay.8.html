<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>btreplay: Recreate io loads recorded by blktrace</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Recreate io loads recorded by blktrace">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="btreplay (8) manual">
  <meta name="twitter:description" content="Recreate io loads recorded by blktrace">
  <meta name="twitter:image" content="https://www.carta.tech/images/blktrace-btreplay-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/btreplay.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="btreplay (8) manual" />
  <meta property="og:description" content="Recreate io loads recorded by blktrace" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/blktrace-btreplay-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">btreplay<small> (8)</small></h1>
        <p class="lead">Recreate io loads recorded by blktrace</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/btreplay.8.html">
      <span itemprop="name">btreplay: Recreate io loads recorded by blktrace</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/blktrace/">
      <span itemprop="name">blktrace</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/btreplay.8.html">
      <span itemprop="name">btreplay: Recreate io loads recorded by blktrace</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>btreplay [ </strong><em>options</em> ] &lt;<em>dev</em>...&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <em>btrecord</em> and <em>btreplay</em> tools provide the ability to record and replay IOs captured by the <em>blktrace</em> utility. Attempts are made to maintain ordering, CPU mappings and time-separation of IOs.</p><p>The <em>blktrace</em> utility provides the ability to collect detailed traces from the kernel for each IO processed by the block IO layer. The traces provide a complete timeline for each IO processed, including detailed information concerning when an IO was first received by the block IO layer &ndash; indicating the device, CPU number, time stamp, IO direction, sector number and IO size (number of sectors). Using this information, one is able to <strong>replay</strong> the IO again on the same machine or another set up entirely.</p><p>The basic operating work-flow to replay IOs would be something like:</p><ul>
<li>
<pre>
  Run <em>blktrace</em> to collect traces. Here you specify the
  device or devices that you wish to trace and later replay IOs upon. Note:
  the only traces you are interested in are <strong>QUEUE</strong> requests &ndash;
  thus, to save system resources (including storage for traces), one could
  specify the <em>-a queue</em> command line option to <em>blktrace</em>.
</pre>
</li><li>
<pre>
  While <em>blktrace</em> is running, you run the workload that you
  are interested in.
</pre>
</li><li>
<pre>
  When the work load has completed, you stop the <em>blktrace</em>
  utility (thus saving all traces over the complete workload).
</pre>
</li><li>
<pre>
  You extract the pertinent IO information from the traces saved by
  <em>blktrace</em> using the <em>btrecord</em> utility. This will parse
  each trace file created by <em>blktrace</em>, and crafty IO descriptions
  to be used in the next phase of the workload processing.
</pre>
</li><li>
<pre>
  Once <em>btrecord</em> has successfully created a series of data
  files to be processed, you can run the <em>btreplay</em> utility which
  attempts to generate the same IOs seen during the sample workload phase.
</pre>
</li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>-c &lt;<em>num</em>&gt;</p><p>--cpus=&lt;<em>num</em>&gt;</p><p>Set number of CPUs to use.</p><p>-d &lt;<em>dir</em>&gt;</p><p>--input-directory=&lt;<em>dir</em>&gt;</p><p>Set input directory. This option requires a single parameter providing the directory name for where input files are to be found. The default directory is the current directory (<em>.</em>).</p><p>-F</p><p>--find-records</p><p>Find record files automatically This option instructs <em>btreplay</em> to go find all the record files in the directory specified (either via the <em>-d</em> option, or in the default directory (<em>.</em>).</p><p>-h</p><p>--help</p><p>Show help and exit.</p><p>-i &lt;<em>basename</em>&gt;</p><p>--input-base=&lt;<em>basename</em>&gt;</p><p>Set base name for input files. Each input file has 3 fields:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p> Device identifier (taken directly from the device name of the  <em>blktrace</em> output file).</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p> <em>btrecord</em> base name &ndash; by default ``replay''.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p> The CPU number (again, taken directly from the  <em>blktrace</em> output file name).</p>
  </dd>

</dl>
<p>This option requires a single parameter that will override the default name (replay), and replace it with the specified value.</p><p>-I &lt;<em>num</em>&gt;</p><p>--iterations=&lt;<em>num</em>&gt;</p><p>Set number of iterations to run. This option requires a single parameter which specifies the number of times to run through the input files. The default value is 1</p><p>-M &lt;<em>filename</em>&gt;</p><p>--map-devs=&lt;<em>filename</em>&gt;</p><p>Specify device mappings. This option requires a single parameter which specifies the name of a file contain device mappings. The file must be very simply managed, with just two pieces of data per line:</p><ul>
<li>
<pre>
  The device name on the recorded system (with the '<em>/dev/</em>'
  removed). Example: <em>/dev/sda</em> would just be <em>sda</em>.
</pre>
</li><li>
<pre>
  The device name on the replay system to use (again, without the
  '<em>/dev/</em>' path prepended).
</pre>
</li>
</ul><p>An example file for when one would map devices <em>/dev/sda</em> and <em>/dev/sdb</em> on the recorded system to <em>dev/sdg</em> and <em>sdh</em> on the replay system would be:</p>
<pre>
sda sdg
sdb sdh
</pre>
<p>The only entries in the file that are allowed are these two element lines &ndash; we do not (yet?) support the notion of blank lines, or comment lines, or the like.</p><p>The utility allows for multiple <em>-M</em> options to be supplied on the command line.</p><p>-N</p><p>--no-stalls</p><p>Disable pre-bunch stalls. When specified on the command line, all pre-bunch stall indicators will be ignored. IOs will be replayed without inter-bunch delays.</p><p>-x &lt;<em>factor</em>&gt;</p><p>--acc-factor=&lt;<em>factor</em>&gt;</p><p>Specify acceleration factor. Default value is 1 (no acceleration).</p><p>-v</p><p>--verbose</p><p>Enable verbose output. When specified on the command line, this option instructs <em>btreplay</em> to store information concerning each <strong>stall</strong> and IO operation performed by <em>btreplay</em>. The name of each file so created will be the input file name used with an extension of <em>.rep</em> appended onto it. Thus, an input file of the name <em>sdab.replay.3</em> would generate a verbose output file with the name <em>sdab.replay.3.rep</em> in the directory specified for input files.</p><p>In addition, <em>btreplay</em> will also output to <em>stderr</em> the names of the input files being processed.</p><p>-V</p><p>--version</p><p>Show version number and exit.</p><p>-W</p><p>--write-enable</p><p>Enable writing during replay. As a precautionary measure, by default <em>btreplay</em> will not process <strong>write</strong> requests. In order to enable <em>btreplay</em> to actually <strong>write</strong> to devices one must explicitly specify the <em>-W</em> option.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p><em>btreplay</em> was written by Alan D. Brunelle.  This man page was created from the <em>btreplay</em> documentation by Bas Zoetekouw.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to &lt;linux-btrace@vger.kernel.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright &copy; 2007 Alan D. Brunelle, Alan D. Brunelle and Nathan Scott.</p><p>This is free software.  You may redistribute copies of it under the terms of the GNU General Public License &lt;http://www.gnu.org/licenses/gpl.html&gt;. There is NO WARRANTY, to the extent permitted by law.</p><p>This manual page was created for Debian by Bas Zoetekouw.  It was derived from the documentation provided by the authors and it may be used, distributed and modified under the terms of the GNU General Public License, version 2.</p><p>On Debian systems, the text of the GNU General Public License can be found in /usr/share/common-licenses/GPL-2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO btreplay&hellip;</h2>
        <div class="sectioncontent">
<p>The full documentation for btreplay can be found in /usr/share/doc/blktrace on Debian systems.</p><p>blktrace (8), blkparse (1), btrecord (8)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="btrecord.8.html"><span aria-hidden="true">&larr;</span> btrecord.8: Recreate io loads recorded by blktrace</a></li>
   <li class="next"><a href="btrfs.8.html">btrfs.8: Control a btrfs filesystem <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
