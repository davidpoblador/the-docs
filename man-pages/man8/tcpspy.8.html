<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tcpspy: Tcp/ip connection monitor</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Tcp/ip connection monitor">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="tcpspy (8) manual">
  <meta name="twitter:description" content="Tcp/ip connection monitor">
  <meta name="twitter:image" content="https://www.carta.tech/images/tcpspy-tcpspy-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/tcpspy.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="tcpspy (8) manual" />
  <meta property="og:description" content="Tcp/ip connection monitor" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/tcpspy-tcpspy-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">tcpspy<small> (8)</small></h1>
        <p class="lead">Tcp/ip connection monitor</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tcpspy.8.html">
      <span itemprop="name">tcpspy: Tcp/ip connection monitor</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/tcpspy/">
      <span itemprop="name">tcpspy</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tcpspy.8.html">
      <span itemprop="name">tcpspy: Tcp/ip connection monitor</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>tcpspy</strong> [<strong>-dp</strong>] [<strong>-e</strong> <em>rule</em>]... [<strong>-f</strong> <em>rulefile</em>]... [<strong>-F</strong> <em>facility</em>] [<strong>-I</strong> <em>interval</em>] [<strong>-U</strong> <em>user</em>] [<strong>-G</strong> <em>group</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>tcpspy</em> logs information about selected incoming and outgoing TCP/IP connections to syslog. The following information is logged: username, local address and port, remote address, port, and optionally the filename of the executable.</p><h3>Options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-e</strong><em> 'rule'</em></p>
  </dt>
  <dd>
    <p>Log only connections matching the specified rule. Rule syntax is outlined below. If this option is specified more than once, connections matching any of the specified rules are logged. You should quote the rule, as shown above.</p>
  </dd>
  <dt>
    <p><strong>-f</strong><em> rulefile</em></p>
  </dt>
  <dd>
    <p>Read rules from <em>rulefile</em>. Each rule is on a new line. The `#' character may be used to add comments; everything from this character to the end of the line is ignored.</p><p>The <strong>-e</strong> and <strong>-f</strong> options may be used together.</p>
  </dd>
  <dt>
    <p><strong>-F</strong><em> facility</em></p>
  </dt>
  <dd>
    <p>Log to syslog facility <em>facility</em> instead of the compile-time default setting. See the <strong>syslog.conf</strong>(5) manual page for a list of facilities.</p>
  </dd>
  <dt>
    <p><strong>-I</strong><em> interval</em></p>
  </dt>
  <dd>
    <p>Update the internal state every <em>interval</em> milliseconds, instead of the default of 1000 ms. Connections that last less than <em>interval</em> milliseconds may be missed, so you should experiment to find a value small enough that it catches most connections, but not so small that it causes tcpspy to use too much CPU time.</p>
  </dd>
  <dt>
    <p><strong>-U</strong><em> user</em></p>
  </dt>
  <dd>
    <p>Switch to the specified user after startup. <em>user</em> may be a numeric user id or a user name from the system password file.</p>
  </dd>
  <dt>
    <p><strong>-G</strong><em> group</em></p>
  </dt>
  <dd>
    <p>Switch to the specified group after startup. <em>group</em> may be a numeric group id or a group name from the system group file. If a username to switch to with the <strong>-U</strong> option is specified but <strong>-G</strong> is omitted, tcpspy will switch to that specified user's primary group.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Debugging mode; if this option is specified, tcpspy will not detach from the console after initialisation, and will log connections to standard output instead of syslog.</p>
  </dd>
  <dt>
    <p><strong>-p</strong></p>
  </dt>
  <dd>
    <p>Log the filename of the executable that created/accepted the connection. You may require superuser privileges to obtain this information for processes you do not own (this is a kernel limitation).</p><p>This option can greatly increase the amount of CPU time required to process each connection/disconnection.</p>
  </dd>

</dl>

<h3>Rule Syntax</h3>
<p>A rule may be specified with the <strong>-e</strong> option to log information about connections matching this rule, overriding the default of logging all connections.</p><p>The following comparison operations are defined:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>user</strong><em> uid</em></p>
  </dt>
  <dd>
    <p>True if the local user initiating or accepting the connection has the <strong>effective</strong> user id <em>uid</em>.</p>
  </dd>
  <dt>
    <p><strong>user</strong><em> \N'34'username\N'34'</em></p>
  </dt>
  <dd>
    <p>Same as above, but using a username instead of a user id.</p>
  </dd>
  <dt>
    <p><strong>ip</strong></p>
  </dt>
  <dd>
    <p>True if the connection is IPv4.</p>
  </dd>
  <dt>
    <p><strong>ip6</strong></p>
  </dt>
  <dd>
    <p>True if the connection is IPv6.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> port</em></p>
  </dt>
  <dd>
    <p>True if the local end of the connection has port number <em>port</em>.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> [low] - [high]</em></p>
  </dt>
  <dd>
    <p>True if the local end of the connection has a port number greater than or equal to <em>low</em> and less than or equal to <em>high</em>. If the form <em>low-</em> is used, high is assumed to be 65535. If the form <em>-high</em> is used, low is assumed to be 0. It is an error to omit both <em>low</em> and <em>high</em>.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> \N'34'service\N'34'</em></p>
  </dt>
  <dd>
    <p>Same as above, but using a service name from <em>/etc/services</em> instead of a port number.</p>
  </dd>
  <dt>
    <p><strong>rport</strong></p>
  </dt>
  <dd>
    <p>Same as <strong>lport</strong> but compares the port number of the remote end of the connection.</p>
  </dd>
  <dt>
    <p><strong>laddr</strong><em> n.n.n.n[/m.m.m.m]</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>laddr</strong><em> n.n.n.n/m</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>laddr</strong><em> ip6-addr[/m]</em></p>
  </dt>
  <dd>
    <p>Interpreted as a "net/mask" expression; true if "net" is equal to the bitwise AND of the local address of the connection and "mask". If no mask is specified, a default mask with all bits set (255.255.255.255) is used. The CIDR type netmask is also possible. With IPv6 only a prefix length netmask is allowed, and the length defaults to 128. Depending on the address family, these rules contain an implicit match condition "ip" or "ip6", respectively.</p>
  </dd>
  <dt>
    <p><strong>raddr</strong></p>
  </dt>
  <dd>
    <p>Same as <strong>laddr</strong> but compares the remote address.</p>
  </dd>
  <dt>
    <p><strong>exe</strong><em> \N'34'pattern\N'34'</em></p>
  </dt>
  <dd>
    <p>True if the full filename (including directory) of the executable that created/accepted the connection matches <em>pattern</em>, a <a href="../man7/glob.7.html"><strong>glob</strong>(7)</a>-style wildcard pattern.</p><p>The pattern "" (an empty string) matches connections created/accepted by processes whose executable filename is unknown.</p><p>If the <strong>-p</strong> option is not specified, a warning message will be printed, and the result of this comparison will always be true.</p>
  </dd>

</dl>
<p>Expressions (including the  comparisons listed above) may be joined together with the following logical operations:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>expr1</em><strong> or </strong><em>expr2</em></p>
  </dt>
  <dd>
    <p>True if either of <em>expr1</em> or <em>expr2</em> are true (logical OR).</p>
  </dd>
  <dt>
    <p><em>expr1</em><strong> and </strong><em>expr2</em></p>
  </dt>
  <dd>
    <p>True if both <em>expr1</em> and <em>expr2</em> are true (logical AND).</p>
  </dd>
  <dt>
    <p><strong>not</strong><em> expr</em></p>
  </dt>
  <dd>
    <p>True if <em>expr</em> is false (logical NOT).</p>
  </dd>

</dl>
<p>Rules are evaluated from left to right. Whitespace (space, tab and newline) characters are ignored between "words". Rules consisting of only whitespace match no connections, but do not cause an error. Parentheses, '(' and ')' may be placed around expressions to affect the order of evaluation.</p><p>The Examples section contains some sample rules which further demonstrate how they are constructed.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>0</p>
  </dt>
  <dd>
    <p>The daemon was successfully started</p>
  </dd>
  <dt>
    <p>&gt;0</p>
  </dt>
  <dd>
    <p>An error occurred</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNALS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>TERM</em></p>
  </dt>
  <dd>
    <p>Shut down at most <em>interval</em> milliseconds from now.</p>
  </dd>
  <dt>
    <p><em>INT</em></p>
  </dt>
  <dd>
    <p>(Debugging mode only) Handled identically to <em>TERM</em>.</p>
  </dd>

</dl>
<p>All other signals retain their default behaviour, which is documented in <a href="../man7/signal.7.html"><strong>signal</strong>(7)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>tcpspy -e 'user "joe" and rport "ssh"'</p>
  </dt>
  <dd>
    <p>Log connections made by user "joe" for the service "ssh".</p>
  </dd>
  <dt>
    <p>tcpspy -e 'not raddr 10.0.0.0/255.0.0.0 and rport 25 and (user "bob" or user "joe")'</p>
  </dt>
  <dd>
    <p>Log connections made by users "bob" and "joe" to remote port 25 on machines not on a fictional "intranet".</p>
  </dd>
  <dt>
    <p>tcpspy -e 'exe "/usr/bin/irc"'</p>
  </dt>
  <dd>
    <p>Log connections made by /usr/bin/irc (probably ircII).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Empty rule files cause <strong>tcpspy</strong> to log no connections instead of all connections.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Tim J. Robbins &lt;tim@robbins.dropbear.id.au&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO tcpspy&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man7/glob.7.html"><strong>glob</strong>(7)</a>, <a href="../man5/proc.5.html"><strong>proc</strong>(5)</a>, <a href="../man5/services.5.html"><strong>services</strong>(5)</a>, <a href="../man7/signal.7.html"><strong>signal</strong>(7)</a>, <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a>, <strong>syslog.conf</strong>(5), <a href="../man5/tcpspy.rules.5.html"><strong>tcpspy.rules</strong>(5)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="tcpick.8.html"><span aria-hidden="true">&larr;</span> tcpick.8: Tcp stream sniffer and connection tracker</a></li>
   <li class="next"><a href="tcpsvd.8.html">tcpsvd.8: Tcp/ip service daemon <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
