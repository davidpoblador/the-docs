<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>courier: The courier mail server</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The courier mail server">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="courier (8) manual">
  <meta name="twitter:description" content="The courier mail server">
  <meta name="twitter:image" content="https://www.carta.tech/images/courier-mta-courier-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/courier.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="courier (8) manual" />
  <meta property="og:description" content="The courier mail server" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/courier-mta-courier-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">courier<small> (8)</small></h1>
        <p class="lead">The courier mail server</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/courier.8.html">
      <span itemprop="name">courier: The courier mail server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/courier-mta/">
      <span itemprop="name">courier-mta</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/courier.8.html">
      <span itemprop="name">courier: The courier mail server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>courier</strong> {start | stop | restart | flush | flush&nbsp;<em>qid</em>  | clear&nbsp;<em>user@domain</em>  | clear&nbsp;all  | show&nbsp;all }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The Courier mail server is a modular multi-protocol E-mail transport agent. The <strong>courier</strong> command is an administrative command, and most of its options are only available to the superuser.</p><p>"<strong>courier start</strong>" starts the server by running <strong>/usr/lib/courier/courierctl.start</strong> in the background. "<strong>courier stop</strong>" immediately stops all the Courier mail server processes and aborts all current mail deliveries. "<strong>courier restart</strong>" restarts the Courier mail server server. A restart is often needed for certain configuration changes to take effect. "<strong>courier restart</strong>" waits for all current deliveries to complete before restarting. This is the "nice" way to restart the mail server. "<strong>courier flush</strong>" takes all undelivered messages in the queue and attempts to deliver them immediately, instead of waiting until their next scheduled attempted delivery time. "<strong>courier flush</strong>" can be optionally followed by a message queue ID in order to schedule an immediate delivery attempt for only a single message. Message queue IDs are displayed by the \m[blue]<strong></strong><a href="../man1/mailq.1.html"><strong>mailq</strong>(1)</a>\m[]\s-2\u[1]\d\s+2 command.</p><p>Please note that <strong>courier start</strong> runs the main Courier mail server scheduling engine only. It does not start any other daemons that you may have, such as the ESMTP or the IMAP daemon.</p><p>"<strong>courier show all</strong>" lists all E-mail addresses currently blacklisted for backscatter. "<strong>courier clear user@domain</strong>" manually clears &lt;user@domain&gt; from the backscatter blacklist. "<strong>courier clear all</strong>" removes all addresses from the backscatter blacklist. When the Courier mail server encounters a delivery failure to an E-mail address the Courier mail server may stop accepting any more messages to the same address in order to minimize generation of so-called "backscatter bounces". This does not occur in all cases, see "Backscatter suppression" in the Courier mail server&apos;s installation instructions for more information.</p><p>The Courier mail server will resume accepting messages to the blacklisted address if the delivery attempt originally encountered a temporary failure, and a subsequent retry succesfully delivered the message, or if more than two hours elapsed since the delivery failure. Use the "clear" command to manually clear the E-mail address from the backscatter blacklist. This may be useful if the undeliverable message is manually removed from the Courier mail server&apos;s mail queue, using the "cancel" command. Even if the message is cancelled, the Courier mail server will continue to refuse accepting mail for this address for up to two hours. The "clear" command can be use to reenable mail acceptance before then.</p><h3>CONFIGURATION FILES</h3>
<p>The Courier mail server uses several configuration files which are located in /etc/courier. These configuration files are plain text files that can be modified with any text editor. In certain instances a subdirectory is used, and all plain text files in the subdirectory are concatenated and are considered to be a single, consolidated, configuration file. Unless otherwise specified, you must run <strong>courier restart</strong> for any changes to these files to take effect.</p><p>aliasfilteracct</p><p>This file contains one line, containing the home directory of the account that&apos;s used for filtering mail addressed to local alias lists.</p><p>When mail filtering is enabled, local recipients have the ability to define mail filters which can selectively reject unwanted mail. /etc/courier/aliases may define local mail aliases that contain one or more recipients. If it is desired to use local mail filtering for mail addressed to an alias address, designate a local account that will be used to specify filtering instructions, and put its home directory into this control file. The filtering argument will be "alias-<em>address</em>" where <em>address</em> is the name of the alias. See \m[blue]<strong></strong><a href="../man7/localmailfilter.7.html"><strong>localmailfilter</strong>(7)</a>\m[]\s-2\u[2]\d\s+2 for more information.</p><p>Due to technical limitations, content filtering is not available for multiple-recipient aliases.</p><p>Changes to this file take effect immediately.</p><p>autoresponsesquota</p><p>This file sets the systemwide quota on autoreplies, if autoreplies and mail filtering are enabled. Note that this can only really be effective if there is no login access to the mail account, since this autoreply quota can be trivially overriden.</p><p>The autoresponsesquota file contains one line: "C<em>nnn</em>" or "S<em>nnn</em>" (or both strings, on the same line). C<em>nnn</em>: allow up to #nnn autoreplies to be created. S<em>nnn</em>: allow up to #nnn bytes as the total size of all autoreplies, combined. If both C<em>nnn</em> and S<em>nnn</em> are specified, both quotas apply. If this file does not exist, there is no limit on autoreplies. This quota setting applies systemwide. To override the quota setting for a particular Maildir, create the autoresponsesquota file in that Maildir (which takes precedence).</p><p>backuprelay</p><p>This file contains one line, containing a name of a machine where mail will be rerouted if it cannot be immediately delivered. Spaces are not allowed in this file.</p><p>Mail gets rerouted if it cannot be delivered after the time interval specified by the warntime configuration file. When backuprelay is provided a delayed delivery status notification will NOT be generated. The message will be rerouted even if the recipient&apos;s delivery status notification setting does not include a delayed notification request.</p><p>This feature is intended for use by relays that handle large quantities of mail, where you don&apos;t want to accumulate a large mail queue for unreachable mail servers. Please note that ALL undeliverable mail will be rerouted in this fashion. Even if the recipient of a message is a local recipient - and the recipient&apos;s mail filter is rejecting the message with a temporary error code - the message will still be rerouted if it&apos;s undeliverable after the specified amount of time.</p><p>Although currently SMTP is the only meaningful application for this feature, the Courier mail server is a protocol-independent mail server, and the backup relay function can be extended to other protocols, as they become available.</p><p>Multiple backup relays can be used by simply assigning multiple IP addresses to the same machine name. Note that the Courier mail server checks for both MX and A records for the machine specified in this configuration file.</p><p>It&apos;s important to note that when this setting is specified, warning messages get turned off for all messages, including messages addressed to local recipients. If a temporary delivery error prevents a message from being delivered to a local mailbox, it remains in the queue until the temporary error condition gets cleared. Normally, if the message remains in the queue beyond the warning interval, the warning message gets generated. When this setting is specified, the warning message gets replaced with a forward to the backup relay, but this occurs only for messages that are delivered via SMTP.</p><p>batchsize</p><p>This file contains one line, containing a single number. This number specifies the absolute maximum number of recipients for a single message. If the Courier mail server receives a message with more recipients, the message is duplicated as often as necessary until each copy of the message has no more than batchsize recipients. If batchsize is missing, it defaults to 100 recipients per message.</p><p>bofh</p><p>This configuration file configures domain-based junk mail filters. Lines in this configuration files that begin with the # character are considered comments, and are ignored. The remaining lines contain the following directives, in any order:</p><p>badfrom <em>user@domain</em></p><p>Reject all mail with the return address of &lt;user@domain&gt;.</p><p>badfrom <em>@domain</em></p><p>Reject all mail with the return address of &lt;anything@domain&gt;.</p><p>badfrom <em>@.domain</em></p><p>Reject all mail with the return address of &lt;anything@anything.domain&gt;.</p><p>badfrom <em>user@.domain</em></p><p>Reject all mail with the return address of &lt;user@anything.domain&gt;.</p><p>badmx <em>N</em></p><p>Reject all mail with a return address in any mail domain whose listed mail servers include server "<em>N</em>". "<em>N</em>" is an IP address. The <strong>BOFHCHECKDNS</strong> option in the esmtp configuration file must also be enabled (this is the default setting) in order for this additional checking to take place. Note that this is "best effort" check. A DNS failure to look up A records for hostnames returned in the MX record may hide the blacklisted server from view.</p><p>freemail <em>domain</em> [<em>domain2</em>] [<em>domain3</em>]...</p><p>Reject all mail with a return address <em>&lt;anything@domain&gt;</em> unless the mail is received from a mail relay whose hostname is in the same domain. "<em>domain2</em>" and "<em>domain3</em>" are optional, and specifies other domains that the mail relay&apos;s hostname may belong to. For example: "<em>freemail example.com domain.com</em>" specifies that mail with a return address <em>@example.com</em> will be accepted only from a mail relay with a hostname in the <em>example.com</em> or <em>domain.com</em> domain. Note that this setting requires that DNS lookup be enabled for incoming ESMTP connections (which is the default setting).</p><p>spamtrap <em>user@domain</em></p><p>Reject all mail that has <em>&lt;user@domain&gt;</em> listed as one of its recipients.</p><p><strong>Note</strong></p><p>For local mailboxes, &apos;domain&apos; must be set to the contents of the me configuration file, or the server&apos;s hostname. Also, this check is made after any alias processing takes place. Suggested usage: create a single local spamtrap account, then create aliases in the alias file that point to the spamtrap account.</p><p>maxrcpts <em>N</em> [hard]</p><p>Accept the first <em>N</em> recipient addresses per message, maximum. The remaining recipients are rejected. An optional verbatim token "hard" specifies that the remaining recipients will immediately be returned as undeliverable (otherwise the remaining recipients are rejected as "temporary unavailable", and may be accepted on a later delivery attempt). If not specified, the first 100 recipients are accepted.</p><p>opt BOFHCHECKHELO=1</p><p>Verify the hostname provided in the ESMTP HELO/EHLO statement. &ldquo;opt BOFHCHECKHELO=1&rdquo; is a global default, which may be overridden by setting the <strong>BOFHCHECKHELO</strong> environment variable in the SMTP access file. See \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2 for more information. &ldquo;opt BOFHCHECKHELO=1&rdquo; enables ESMTP HELO/EHLO checking by default, and ESMTP HELO/EHLO checking may be turned off for individual IP address ranges by setting <strong>BOFHCHECKHELO</strong> to 0 using \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2. Alternatively, HELO/EHLO checking may be turned off by default, and enabled for specific IP address ranges by using \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2 to set <strong>BOFHCHECKHELO</strong> to 1. See \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2 for more information.</p><p>opt BOFHCHECKHELO=2</p><p>Setting to <strong>BOFHCHECKHELO</strong>2 has the effect of returning a temporary SMTP error code, instead of a permanent SMTP error code, for a failed HELO/EHLO SPF check.</p><p>opt BOFHHEADERLIMIT=<em>n</em></p><p>Reject messages whose headers exceed <em>n</em> bytes in size (minimum 1,000 bytes, default 100,000 bytes).</p><p>opt BOFHNOBASE64TEXT=1</p><p>Reject messages with base64-encoded text/plain or text/html content.</p><p>opt BOFHSPFHELO=<em>keywords</em></p><p>Use Sender Policy Framework to verify the HELO or EHLO domain sent by the connecting SMTP client. See Sender Policy Framework Keywords below for a list of possible keywords.</p><p>SPF checking is not used for HELO or EHLO commands that specify an IP address instead of a domain name.</p><p><strong>Note</strong></p><p>This setting may be used in combination with opt BOFHCHECKHELO=1. The BOFHCHECKHELO=1 check is disabled if SPF verification of the HELO/EHLO results in the SPF status of &ldquo;pass&rdquo;. This makes sense: if the HELO/EHLO domains complies with the domain&apos;s SPF, it is not necessary to check it further.</p><p>opt BOFHSPFMAILFROM=<em>keywords</em></p><p>Use Sender Policy Framework to verify the return address in the MAIL FROM command sent by the connecting SMTP client. See Sender Policy Framework Keywords below for a list of possible keywords.</p><p><strong>Note</strong></p><p>No SPF checking is done for if the MAIL FROM command specifies an empty return address (a bounce). There&apos;s nothing to check.</p><p>opt BOFHSPFFROM=<em>keywords</em></p><p>Use Sender Policy Framework to verify the return address in the From: header. See Sender Policy Framework Keywords below for important information, and a list of possible keywords.</p><p>opt BOFHSPFHARDERROR=<em>keywords</em></p><p>This setting lists the unacceptable SPF results that should result in a permanent error. All other unacceptable SPF results are kicked back with a temporary error indication, inviting the sender to try again later.</p><p>The default setting for <strong>BOFHSPFHARDERROR</strong> is fail,softfail.</p><p>opt BOFHSPFTRUSTME=1</p><p>Disable all SPF checks for any connecting client that has relaying privileges (<strong>RELAYCLIENT</strong> is explicitly set, or inherited after a successful SMTP authentication).</p><p>opt BOFHSPFNOVERBOSE=1</p><p>This setting disables custom SPF rejection messages. Any SPF rejection message specified by the SPF policy is replaced by a stock, bland message. The author of this SPF implementation believes that there&apos;s a minor security issue with letting an external site control the error messages issued by your mail server. The same author does not believe that this is such a big deal, but security-sensitive minds may choose to enable this setting, and sleep easy at night.</p><p>opt BOFHSUPPRESSBACKSCATTER=<em>list</em></p><p>This is one of the two settings that controls which messages are subject to backscatter suppression. The other setting, ESMTP_BLOCKBACKSCATTER is set in the courierd configuration file, which contains further documentation.</p><p>&ldquo;list&rdquo; is a comma-separated list of message sources. The possible message sources are:</p><p>authsmtp</p><p>Messages received via SMTP from clients with relaying privileges (authenticated SMTP, or IP addresses that always have relaying privileges.</p><p>smtp</p><p>All other messages received via SMTP.</p><p>none</p><p>Do not suppress backscatter messages from any source.</p><p>The default setting is &ldquo;opt BOFHSUPPRESSBACKSCATTER=smtp&rdquo;. The other possible values are &ldquo;opt BOFHSUPPRESSBACKSCATTER=smtp,authsmtp&rdquo; (which suppresses backscatter from all SMTP mail), and &ldquo;opt BOFHSUPPRESSBACKSCATTER=none&rdquo;.</p><p>calendarmode</p><p>This configuration file enables basic calendaring features in the webmail server. Calendaring is currently considered experimental in nature, and the current implementation provides basic calendaring services. If this file does not exist, calendaring options are disabled. If this file exists it should contain a single word: "local". For example:</p>
<pre>
echo "local" &gt;/etc/courier/calendarmode
</pre>
<p>This configuration file must be globally readable, so make sure that your umask is not set too tight.</p><p>courierd</p><p>This configuration file specifies several parameters relating to general the Courier mail server configuration. A default configuration file will be installed, and you should consult its contents for additional information.</p><p>defaultdomain</p><p>This file contains one line whose contents is a valid mail domain. Most header rewriting functions will append @defaultdomain to all E-mail addresses that do not specify a domain. If defaultdomain is missing, the Courier mail server uses the contents of the me control file.</p><p>When the ESMTP server receives a &ldquo;RCPT TO&rdquo; command containing the address &lt;user@[<em>ip.address</em>]&gt;, and the IP address is the same as the IP address of the socket it&apos;s listening on, the ESMTP server replaces the IP address with the contents of the defaultdomain control file. If defaultdomain is missing, the Courier mail server uses the contents of the me control file.</p><p>The contents of defaultdomain are also appended to return addresses to mail sent from the Courier mail server&apos;s webmail server, if they don&apos;t already have a domain. If defaultdomain does not exist, the Courier mail server&apos;s webmail server obtain the machine hostname, and uses that.</p><p><strong>Note</strong></p><p>The mail domain in defaultdomain should be one of the local domains, as defined by the locals and the hosteddomains control files.</p><p>Otherwise, if a domain-less address in mail headers gets augmented with defaultdomain and the recipient replies to the message, upon receipt Courier won&apos;t recognize the recipient address as a local mailbox. This might not necessarily be wrong, but the consequences of such an action must be clearly understood.</p><p><strong>Warning</strong></p><p>If you change the contents of this configuration file, it may be necessary to rerun the <strong>makealiases</strong> command again, else your mail will promptly begin to bounce. If you don&apos;t have this configuration file defined, and you change the system&apos;s network host name, you may also need to run <strong>makealiases</strong>.</p><p>dotextension</p><p>This file contains one line whose contents specify the name of dot-files in users&apos; home directories which contain delivery instructions. If this file does not exist, the Courier mail server reads $HOME/.courier, $HOME/.courier-foo, $HOME/.courier-default, and so on. If this file contains the text "qmail", the Courier mail server will instead read $HOME/.qmail, $HOME/.qmail-foo, $HOME/.qmail-default, and so on.</p><p>dsnfrom</p><p>This file contains one line specifying the contents of the From: header that the Courier mail server puts in all delivery status notifications. This file specifies a complete header, except for the "From: " part. If dsnfrom is missing, then the Courier mail server uses the following header: "Courier mail server mail server at me" &lt;@&gt;</p><p>dsnlimit</p><p>Maximum size, in bytes, of a message whose contents are included in delivery status notifications. By default, the entire message is only included in non-delivery notices (failures). Only the headers will be returned for delay notifications (warnings) and return receipts; or for failures if the original message is larger than dsnlimit. If missing, dsnlimit is set to 32K.</p><p>The sender can request that the entire message be returned even on delayed notices or return receipts, however the Courier mail server will ignore this request if the message size exceeds this limit.</p><p>enablefiltering</p><p>This configuration file enables the global mail filtering API for selected mail sources. This file, if it exists, contains a single line of text that specifies which kind of mail will be filtered. The possible values are:</p><p>esmtp</p><p>Enables global mail filtering for mail received via ESMTP.</p><p>local</p><p>Specifies that mail received from logged on users, via sendmail, and mail forwarded from \m[blue]<strong></strong><a href="../man5/dot-courier.5.html"><strong>dot-courier</strong>(5)</a>\m[]\s-2\u[4]\d\s+2 will be filtered using the global mail filtering API.</p><p>uucp</p><p>Specifies that mail received from UUCP will be filtered.</p><p>If you want to specify more than one source of mail, such as ESMTP and local mail, specify both esmtp and local, separated by a space character.</p><p><strong>Note</strong></p><p>The global mail filtering API is described, in detail, in the \m[blue]<strong></strong><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a>\m[]\s-2\u[5]\d\s+2 manual page. This is NOT the traditional user-controlled mail filtering, such as \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2. A global mail filter is a daemon process that selectively accepts or rejects incoming mail, based on arbitrary criteria.</p><p>esmtpacceptmailfor</p><p>This file lists all domains that the Courier mail server accepts mail for via ESMTP. This file is in the same format as the locals file. If this file is missing, the Courier mail server uses the single domain specified in me (or the system machine name).</p><p>esmtpacceptmailfor.dat</p><p>This is a binary database file that lists additional domains that the Courier mail server accepts mail for, just like esmtpacceptmailfor. A binary database file will be faster than a flat text file when the number of domains is large. The Courier mail server will accept mail for domains listed in either esmtpacceptmailfor or esmtpacceptmailfor.dat. esmtpacceptmailfor.dat is created by the <strong>makeacceptmailfor</strong> command. You can use both esmtpacceptmailfor.dat and esmtpacceptmailfor at the same time. Put your most popular domains in esmtpacceptmailfor, and put the rest of them into esmtpacceptmailfor.dat.</p><p>esmtpauthclient</p><p>This configuration file configures ESMTP authentication for the ESMTP client. This is a text file of zero or more lines that contain the following fields:</p>
<pre>
relay userid password
</pre>
<p>When the Courier mail server connects to a remote ESMTP relay, the Courier mail server will authenticate itself using userid and password. These fields are separated by one or more whitespace characters. Because this file contains passwords, it must not be world or group readable, and owned by the user "daemon".</p><p>ESMTP negotiation will take place, and the Courier mail server will use a SASL authentication method supported by both the Courier mail server and the remote ESMTP server. Currently the Courier mail server supports PLAIN, LOGIN and CRAM-MD5 authentication. CRAM-MD5 is preferred over the other two, and PLAIN is preferred over LOGIN.</p><p>The Courier mail server also supports ESMTP over SSL (the ESMTP STARTTLS extension). If ESMTP STARTTLS is enabled, STARTTLS will be used to establish a secure link first. The authentication will take place afterwards, over a secure channel.</p><p>Changes to this file take effect, more or less, immediately (existing connections are not affected, but new connections will read the updated data).</p><p>esmtpd</p><p>This file is used to initialize the environment and parameters for <strong>courieresmtpd</strong>. A default file will be provided during installation. See the comments in the file for more information. For changes to this file to take effect you run the <strong>esmtpd stop</strong> command followed by <strong>esmtpd start</strong>.</p><p>esmtpdelay</p><p>This file contains one line of text that specifies how long <strong>courieresmtp</strong> waits after a failure to contact the remote mail server before another attempt is made. <strong>courieresmtp</strong> (not to be confused with <strong>courieresmtpd</strong>) delivers outgoing mail to remote mail servers. The timeout is specified as an integral number, optionally followed by m - minutes, or h - hours. Otherwise it is specified in seconds.</p><p>The <strong>courieresmtp</strong> process delivers mail that&apos;s routed to external mail relays, via ESMTP. When attempting to initally contact a mail server <strong>courieresmtp</strong> waits for the amount of time specified by esmtptimeoutconnect (see below). esmtptimeoutconnect is usually set to a relatively long period of time, in order to accomodate slow mail servers. A large number of messages queued up for an unreachable mail server can tie up delivery slots that can be put to a better use by reassigning them for mail to another domain. Although the Courier mail server does not usually assign all delivery slots for messages to the same domain (this is a tuneable parameter), it is still not very healthy to have a bunch of <strong>courieresmtp</strong> daemons spinning their wheels, doing nothing.</p><p>The situation worsens when there is a large number of mail relays that accept mail for the same domain, and all of them are unreachable due to a network failure. That&apos;s because the esmtptimeout waiting period is used for each individual mail relay. Multiply esmtptimeout by the number of servers to see how large the delay really will be.</p><p>esmtpdelay is implemented internally in the <strong>courieresmtp</strong> module. The main the Courier mail server scheduling daemon is not aware of what&apos;s happening internally in <strong>courieresmtp</strong>. When <strong>courieresmtp</strong> fails to contact any mail relay for the domain, the message is postponed, and the esmtpdelay timer is set. Any additional messages received by the same <strong>courieresmtp</strong> daemon (for the same domain), are immediately postponed without any attempt to contact a remote mail relay. When the amount of time set by esmtpdelay expires, <strong>courieresmtp</strong> will attempt to make another delivery attempt as usual.</p><p>If esmtpdelay does not exist, the default delay is five minutes. Any messages that are postponed look like any other temporary failure to <strong>courierd</strong>. Delivery attempts are rescheduled as if a real temporary failure took place. Therefore it does not make sense to set esmtpdelay to be greater than retryalpha (see below). When retryalpha is smaller is esmtpdelay, you&apos;ll just messages spinning through the mail queue, with useless delivery attempts being attempted because esmtpdelay still hasn&apos;t expired.</p><p>Occasionally you might observe somewhat strange behavior on systems with heavy mail traffic. esmtpdelay applies separately to each individual instance of <strong>courieresmtp</strong>. When a remote mail server keeps going up and down, it is possible to end up with multiple <strong>courieresmtp</strong> daemons handling mail for the same domain, but only some of them will encounter a network failure, purely by the luck of the draw. The remaining daemons will be able to establish a connection. So you&apos;ll end up with some <strong>courieresmtp</strong> daemons being able to deliver mail immediately, while the rest are still waiting patiently for esmtpdelay to expire, postponing all messages in the meantime. Some messages - but not all - will be immediately postponed without a delivery attempt, becauses they ended up getting to a daemon which is waiting for esmtpdelay to expire.</p><p>Another anomalous situation may happen when a <strong>courieresmtp</strong> daemon gets reassigned to another domain, and then receives more mail for the previous domain. This can happen when you have a lot of mail going through. Although the Courier mail server tries to shuffle all mail for same domain into one pile, the scheduler still tries to dispatch mail on "first-come, first-serve" basis, as much as possible. When that happens another delivery attempt will be made immediately, because the previous esmtpdelay was cancelled when the daemon got reassigned to another domain.</p><p>There can also be occasional abnormalities that affect systems with light traffic. When there is a domain with several mail relays of equal priority, one mail relay is chosen at random for the connection attempt. If some of the equal-priority mail relays are unreachable and a <strong>courieresmtp</strong> daemon picks it, it will start the esmtpdelay timer and refuse to deliver any more mail until it expires, even if most of the mail servers are functional. This will happen only with mail relays of the lowest priority. Otherwise, <strong>courieresmtp</strong> will always try to contact another mail relay of a still lower priority, before giving up and setting the esmtpdelay timer. Another <strong>courieresmtp</strong> daemon will not be started for the same domain if there&apos;s already an existing one, so all delivery attempts will be turned away until esmtpdelay expires. Another <strong>courieresmtp</strong> daemon will be started only in the event of multiple simultaneous delivery attempts that happen to coincide at the same time.</p><p>This is somewhat mitigated by the fact that all <strong>courieresmtp</strong> daemons are killed after a short period of total inactivity (currently one minute), so that longer intervals specified by esmtpdelay are ignored. Note, however, that receiving a message to deliver, and then postponing it immediately, does count as some activity.</p><p>esmtpdelay can be turned off by setting it to 0 seconds. esmtpdelay is designed for servers that handle heavy amount of mail that wish to avoid having outbound delivery slots tied up due to network failures, at an expense of an occasional anomalous behavior due to harmless paranoia. esmtpdelay may prove to actually make things worse for systems that carry only light mail traffic, if they are burdened with a task of exchanging mail primarily with external systems that are not properly maintained.</p><p>esmtpgreeting</p><p>The complete greeting banner displayed by <strong>courieresmtpd</strong>. Changes to this file take effect immediately.</p><p>esmtphelo</p><p>This file contains one line of text, what the Courier mail server calls itself in the EHLO or HELO command sent to a remote SMTP server. me is used if this file does not exist.</p><p>esmtphelo may also be set to a special value of &ldquo;*&rdquo;:</p>
<pre>
echo &apos;*&apos; &gt;esmtphelo
</pre>
<p>(Note the single quotes, to prevent &ldquo;*&rdquo; from being expanded by the shell). The Courier mail server will take the IP address of the local side of the connection to the remote SMTP server, look up the IP address in DNS, and use the hostname from the reverse DNS lookup. This might be useful when the Courier mail server server is multihomed. The Courier mail server will look up the local IP address of each individual connection, and use that in its EHLO or HELO command.</p><p><strong>Note</strong></p><p>Functioning DNS is required. Using the hosts file, or an equivalent, won&apos;t work. This function uses the Courier mail server&apos;s native DNS resolver, which reads /etc/resolv.conf and queries the listed DNS servers directly.</p><p><strong>Note</strong></p><p>See the section called &ldquo;Servers with multiple IP addresses&rdquo; for a better way of accomplishing the same results.</p><p>esmtproutes</p><p>This file is used by the ESMTP module, and it contains one or more lines in the following form:</p>
<pre>
<em>domain</em>:<em>relay</em>[,<em>port</em>][/SECURITY=STARTTLS][/SECURITY=REQUIRED][/SECURITY=SMTPS]
</pre>
<p><em>domain</em> is any SMTP domain. <em>relay</em> specifies a fixed mail relay for this domain. <em>relay</em> is optionally followed by a comma and a port number, to specify a port other than the default port 25. If an address&apos;s domain is not found in esmtproutes, the Courier mail server looks for MX and A records as usual (and always delivers to port 25). If the domain is found in esmtproutes, however, any MX or A records for the domain are ignored; instead the Courier mail server delivers the message to the specified relay.</p><p><em>relay</em> can be another domain, or an explicit IP address inside brackets. For example, if esmtproutes contains the following:</p>
<pre>
example.com: relay.domain.com
domain.com: [192.168.0.2]
</pre>
<p>Mail for example.com is delivered to relay.domain.com, ignoring any MX records for example.com. Mail for domain.com will be delivered to the machine at IP address 192.168.0.2. All other domains will have their MX and A records looked up.</p><p><strong>Note</strong></p><p>Unlike Qmail, the Courier mail server looks up MX and A records for relay.example.com (Qmail only looks up A records).</p><p>esmtproutes may contain comments, any line that starts with the # character is ignored. Also, wildcards are allowed:</p>
<pre>
 .example.com: [192.168.0.3],26
</pre>
<p>This specifies that any address of the form &lt;anything@anything.example.com&gt; will be delivered to the mail server at this IP address, but on port 26.</p><p>esmtproutes is read from top to bottom, stopping as soon as a first match is found.</p><p>domain may be empty, this specifies a smarthost for all domains. For example, if esmtproutes contains the following text:</p>
<pre>
example.com: relay.example.com
        :[192.168.0.4]
</pre>
<p>This specifies that all mail to example.com is rerouted to relay.example.com. All other mail is routed to the IP address 192.168.0.4.</p><p>If relay is empty, the Courier mail server interprets it as an explicit directive to use MX and A records from DNS. For example:</p>
<pre>
example.com:
:[192.168.0.4]
</pre>
<p>This uses MX and A records for all messages to example.com. All other mail is rerouted to the IP address 192.168.0.4.</p><p>The /SECURITY=STARTTLS flag indicates that mail to this domain will use the SECURITY ESMTP extension. See the Courier mail server installation notes for a description of SECURITY, what it does, and how to configure it.</p><p><strong>Note</strong></p><p>/SECURITY=STARTTLS does <em>not</em> refer to the standard implementation of SMTP over TLS, but a Courier-specific extension. Courier automatically sends mail using encryption if it&apos;s enabled and the remote server advertises STARTTLS.</p><p>/SECURITY=SMTPS uses an encrypted SMTP connection. This is an alternative to STARTTLS. Encrypted SMTP uses a different port, port 465, which must be specified explicitly:</p>
<pre>
: relay.example.com,465 /SECURITY=SMTPS
</pre>
<p>This example forwards all mail to relay.example.com on port 465 using encrypted SMTP.</p><p><strong>Note</strong></p><p>If you intend to use /SECURITY=SMTPS to forward all your mail to your provider&apos;s mail server over smtps additional you should also set ESMTP_TLS_VERIFY_DOMAIN=1, TLS_VERIFYPEER=PEER, and TLS_TRUSTCERTS to a list of trusted certificate authorities (Courier&apos;s configuration script should provide a default value for TLS_TRUSTCERTS on most platforms), in the courierd configuration file.</p><p>Otherwise, TLS still gets used to send mail, but the smarthost&apos;s certificate does not get validated. Properly-managed Internet providers should install a valid certificate, signed by a trusted authority, if they require SMTPS. Poorly-managed Internet providers will just install a self-signed certificate, and will not be able to explain why they require SMTPS, if it&apos;s trivially compromised with a man-in-the-middle attack that a non-validated certificate enables, so either find a more competent provider, or use /SECURITY=SMTPS without actually enabling all the extra validation that&apos;s actually needed to gain any kind of a secure mail transmission channel.</p><p>A combination of broken mail servers written by incompetent programmers, and poorly-managed Internet providers will result in a mail server that advertises the ability to use an encrypted connection to receive mail, but either disconnect immediately, or return an error message when the sender takes up the receiver&apos;s offer to do so.</p><p>When the Courier mail server connects to another server that claims to support an encrypted connection, tries to enable it, then fails because the other mail server drops the connection or returns an error message, all subsequent connection attempts to the same mail server will ignore the server&apos;s false advertising, and proceed to send mail without attempting to enable encryption. The Courier mail server remembers not to use the encryption with this server for the next 2-4 hours (depending on an internal log file&apos;s rotation schedule). Once the remote mail server emerges from the penalty box, the next connection attempt will try again, and see if it&apos;s still doesn&apos;t work.</p><p>The /SECURITY=REQUIRED flag blocks the Courier mail server from sending mail to the remote server unless a standard encryped connection can get established. If it&apos;s known that the given mail server should only receive encrypted mail, /SECURITY=REQUIRED prevents a man-in-the-middle attack where the remote mail server&apos;s advertisement of is STARTTLS capability gets suppressed, and the mail gets sent in the clear.</p><p><strong>Note</strong></p><p>ESMTP_TLS_VERIFY_DOMAIN=1, TLS_VERIFYPEER=PEER, and TLS_TRUSTCERTS should also be set, in the courierd configuration file, as described above, for the same reasons, in this case.</p><p>To summarize:</p><p>/SECURITY=STARTTLS</p><p>Courier-specific extension, use a private certificate authority to set up a secure mail network, while supporting regular encrypted TLS with the rest of the world.</p><p>/SECURITY=SMTPS</p><p>Use regular encrypted SSL/TLS with this mail server. Use this flag with an esmtproutes entry to a server on port 465 (smtps).</p><p>/SECURITY=REQUIRED</p><p>Must use the STARTTLS extension to open a regular encrypted TLS connection with this server on the regular SMTP port 25.</p><p>Changes to esmtproutes take effect immediately, more or less. Existing <strong>courieresmtp</strong> processes that already have an established connection will ignore any changes.</p><p>esmtptimeout</p><p>This file contains one line of text that specifies the timeout for an SMTP command. The timeout is specified as an integral number, optionally followed by m - minutes, or h - hours. Otherwise it is specified in seconds. This timeout is used for all SMTP commands, unless the SMTP command has a dedicated timeout defined by a different configuration file. The default timeout is ten minutes.</p><p>esmtptimeoutconnect</p><p>This file contains one line of text that specifies the timeout for an SMTP connection attempt. Most TCP/IP stacks wait an extraordinary long period of time for SMTP connections to go through. This configuration setting limits the amount of time the Courier mail server waits for the SMTP connection to complete. The default timeout is one minute. Set esmtptimeoutconnect to 0 in order to use whatever default timeout your TCP/IP stack uses.</p><p>esmtptimeoutdata</p><p>This file contains one line of text that specifies the timeout for transferring the message contents or individual replies. The default timeout is five minutes. You WILL HAVE TO bump this up if you&apos;re on a slow link, and you want to send large messages. A 28.8Kbps link can be optimistically expected to push 3,000 bytes per second. With a five minute cutoff, you will not be able to send or receive anything larger than about 870 Kb. You have no business sending or receiving 870 Kb messagesl, if all you have is an analog 28.8Kbps connection.</p><p>esmtptimeouthelo</p><p>This file contains one line of text that specifies the timeout for the initial EHLO or HELO command. The Courier mail server will wait this amount of time to receive the initial greeting banner from the remote SMTP server, and a response to the subsequent EHLO/HELO command. The default value is 5 minutes.</p><p>esmtptimeoutkeepalive</p><p>This file contains one line of text that specifies how often outbound SMTP sessions are kept idle after delivering a message. After the Courier mail server connects to an SMTP server and completes the attempt to deliver the message, the SMTP session is kept idle for this time interval before being shut down. If the Courier mail server receives another message for the same domain, it will be delivered using the existing SMTP session, instead of establishing a new one. Note that some SMTP servers have a very short idle timeout, Qmail&apos;s is only two minutes. The default value is 60 seconds.</p><p>Note that there&apos;s also a separate limit to the maximum number of simultaneous SMTP sessions to the same domain. That limit is currently four, which is adequate for nearly every situation, so for now it will be set by an undocumented configuration file.</p><p>esmtptimeoutkeepaliveping</p><p>This file contains one line of text that specifies how often the Courier mail server will issue a useless RSET command when the connection is idle (see esmtptimeoutkeepalive). While waiting for any more messages to deliver to the same domain, or for the esmtptimeoutkeepalive interval to expire, <strong>courieresmtp</strong> will transmit RSET commands at regular intervals specified by this configuration file. The default value is 0 seconds, which turns off the keepalive ping altogether. This configuration settings must be for a shorter time interval than esmtptimeoutkeepalive for it to make any sense. Note that other system administrators may consider this to be a very rude thing to do. Also keep in mind that this may generate quite a bit of idle traffic. If you have the Courier mail server configured for a maximum number of 200 outbound SMTP sessions and a 30 second esmtptimeoutkeepaliveping setting, then you can have as much as an average of around seven pings every second!</p><p>esmtptimeoutquit</p><p>This file contains one line of text that specifies how long the Courier mail server waits for the external SMTP server to acknowledge the QUIT command, before the Courier mail server unilaterally tears down the connection. The default value is 10 seconds. This must be a small value because the Courier mail server needs to be able to shut down quickly, on very short notice.</p><p>faxqueuetime</p><p>This file specifies how long the Courier mail server normally tries to repeatedly resend a fax message (if the courierfax module is enabled). The default E-mail message retry timeout (the queuetime setting) is one week, which is a reasonable timeout value for E-mail messages (taking into account downed circuits, or crashed servers). However, it doesn&apos;t make sense to keep trying to redeliver fax messages for a whole week.</p><p>faxqueuetime specifies the timeout for fax messages. This time interval is specified in the same way as queuetime (see queuetime for more information).</p><p>faxnotifyrc</p><p>This file specifies which mailbox the Courier mail server should deliver received faxes (if this option is enabled). See the Courier mail server&apos;s installation notes for more information.</p><p>faxrc</p><p>This file configures the Courier mail server&apos;s outbound faxing and dialing parameters. Consult the comments in the default file for additional information, and the \m[blue]<strong></strong><a href="../man8/courierfax.8.html"><strong>courierfax</strong>(8)</a>\m[]\s-2\u[7]\d\s+2 manual page for more information.</p><p>hosteddomains</p><p>This file lists locally-hosted domains. It is very similar in function to the locals control file. Any address with a domain listed in hosteddomains is considered to be a local address. The difference between hosteddomains and locals is that domains listed in hosteddomains are not removed from individual addresses before looking up the location of their mailboxes. For example, if the domain "example.com" appears in locals, the address user@example.com will have example.com removed, and then the Courier mail server will look for a local mailbox named "user".</p><p>If the domain "example.com" appears in hosteddomains instead, the Courier mail server will look for a local mailbox named "user@example.com" instead.</p><p>The contents of the hosteddomains configuration file is a list of domains, one per line, in lowercase. You must run the <strong>makehosteddomains</strong> command for any changes to take effect.</p><p>Additionally, hosteddomains can specify simple domain aliases. See the complete description in the \m[blue]<strong></strong><a href="../man8/makehosteddomains.8.html"><strong>makehosteddomains</strong>(8)</a>\m[]\s-2\u[8]\d\s+2 manual page.</p><p>ipout, ip6out</p><p>Non-default IP addresses to send outgoing ESMTP messages from. See the section called &ldquo;Servers with multiple IP addresses&rdquo; and the section called &ldquo;Simulating a server with multiple IP addresses&rdquo;, below, for more information.</p><p>ldapaddressbook</p><p>This file is used by the webmail server. It contain a default systemwide list of accessible LDAP address books. A default file will be installed, listing some common Internet address books. Each line in this file contains the following information:</p>
<pre>
name&lt;tab&gt;host&lt;tab&gt;port&lt;tab&gt;suffix&lt;tab&gt;binddn&lt;tab&gt;bindpw
</pre>
<p>"&lt;tab&gt;" is the ASCII tab character. &ldquo;name&rdquo; is the unique name for this LDAP server. &ldquo;host&rdquo; and &ldquo;port&rdquo; specify the connection parameters. &ldquo;suffix&rdquo; specifies the root LDAP entry whose subtree gets searched. The &ldquo;binddn&rdquo; and &ldquo;bindpw&rdquo; fields are not presently used (they were used in earlier version of the webmail server, before the LDAP search interface was rewritten and simplified).</p><p>ldapaliasrc</p><p>This file is used by the courierldapaliasd process. See \m[blue]<strong></strong><a href="../man8/courierldapaliasd.8.html"><strong>courierldapaliasd</strong>(8)</a>\m[]\s-2\u[9]\d\s+2 for more information.</p><p>locallowercase</p><p>If this file exists, the Courier mail server will not distinguish being lowercase and uppercase local accounts, so that john@example.com and John@example.com will refer to the same local mailbox (where example.com is your domain). Postmaster, postmaster, and POSTMASTER always refer to the same account, even if locallowercase does not exist.</p><p><strong>Note</strong></p><p>If locallowercase exists you cannot have any system accounts that contain uppercase letters. locallowercase applies only to local mail. Mail addressed to external domains will always have the case of the addresses preserved.</p><p>locals</p><p>This file contains one or more lines of text, where each line contains a valid mail domain. Any E-mail address without @domain, or with a domain that can be found in locals will be considered to be an address of a local mailbox. A domain can be specified with a leading dot:</p>
<pre>
 .domain.com
</pre>
<p>This is called a "wildcard". Any domain ending in domain.com, such as a.domain.com, b.domain.com, a.b.c.domain.com - but NOT somedomain.com - will be considered local. Note that domain.com is NOT included in this wildcard. Both "domain.com" and ".domain.com" should be listed.</p><p>Specific hosts can be excluded from the wildcard. Example:</p>
<pre>
 !host.domain.com
 .domain.com
</pre>
<p>anything.domain.com is considered to be a local domain, except for host.domain.com. Note that "!host.domain.com" must appear in locals before the .domain.com wildcard.</p><p>The "!hostname" syntax is also valid in the esmtpacceptmailfor control file.</p><p>If locals does not exist, the Courier mail server uses the contents of the me control file (note that me specifies only one domain, second and subsequent lines are ignored). Also, see hosteddomains.</p><p>localtimeout</p><p>This file specifies the watchdog timer for local mail deliveries. If a local mail delivery attempt does not complete in the proscribed time interval, the delivering process ID is killed. The time interval in localtimeout is specified in the same way as queuetime (see queuetime for more information).</p><p>logindomainlist</p><p>If this file exists then the webmail login screen will have a drop-down list whose contents will be read from this file. This file should contain a list of E-mail domains, one per line. It should be created if the Courier mail server&apos;s webmail server is used to provide mail access for more than one domain. Instead of typing "user@domain" to log in, it will only be necessary to enter "user", and select the domain from the drop-down list. If this file does not exist it will be necessary to enter the full E-mail address into the webmail login screen. The enhanced logindomainlist makes it possible to specify a separate list of domain for each virtual web site, and more control over the defaults.</p><p>What if you don&apos;t want to display a drop down menu? Administrators can now specify records that generate a hidden field in login.html, or an editable text field, allowing sqwebmail to show only one mail login domain to each user per access URL or IP address. This functionality can greatly reduce confusion for first time webmail users, and greatly speed the login process for frequent webmail users.</p><p>Finally, the new logindomainlist file offers a new tool to ease maintenance. Administrators can now use wildcards to "rewrite" the domain portion of the access URL to the mail domain equivalent. For example, the following record can rewrite the URL "mail.*.com" to the mail domain "*.com"</p><p>*.com:mail.*.com:@</p><p>This powerful wildcard functionality can ease the login process for most of your server&apos;s mail domains with just one or two logindomainlist records.</p><p>File Format</p><p>Let&apos;s take a look at the NEW logindomainlist file format:</p><p>firstfield:secondfield:thirdfield</p><p>Above, we can see that the new logindomainlist records are made up of three fields delimited by colons. But what does each field do?</p><p>First Field - the first field contains the "mail domain" for which we would like the user to log in under. The mail domain is the part of an email address after the @ symbol. For example, in the email address "user@domain.com", "domain.com" is the mail domain.</p><p>Second Field - the second field contains the "access domain". The access domain contains an URL or IP address that is used to figure out which mail domain to use by default. For example, in the following logindomainlist record:</p><p>domain1.com:domain2.com</p><p>"domain2.com" is the "access domain" and "domain1.com" is the "mail domain". If the user logs into the following URL:</p><p>http://domain2.com/cgi-bin/sqwebmail</p><p>His default "mail domain" will be "domain1.com".</p><p>Third Field - the third field may contain a modifier. The modifier may be either a single character modifier, or a group identification string. The single character modifiers and the group modifier are described in detail below.</p><p>Finally, the logindomainlist file may also contain comments and empty lines. Empty lines can be used to group records visually, and comments can be used to explain why a certain record or group of records look the way they do.</p><p>If the first character of a line is a &apos;#&apos;, then the entire line is considered a comment and is ignored. If the first character of a line contains whitespace, the entire line is assumed to be an empty line and is ignored.</p><p>Modifiers</p><p>@ - the &apos;@&apos; modifier can be used to create a hidden field on the login.html page which contains the default mail domain. In addition, this field will automatically display the default mail domain in plain text to the right of the userid text box.</p><p><strong>Note</strong></p><p>The &apos;@&apos; modifier ALLOWS the use of wildcards to automate the relationship between "access domains" and "mail domains". See the heading "<em>Wildcards</em>" below for more information about wildcarding.</p><p>- - the &apos;-&apos; modifier can be used to create an editable text field on the login.html page which contains the default mail domain.</p><p><strong>Note</strong></p><p>The &apos;-&apos; modifier ALLOWS the use of wildcards to automate the relationship between "access domains" and "mail domains". See the heading "<em>Wildcards</em>" below for more information about wildcarding.</p><p>group string - If no modifier is specified in the third field, or if the third field modifier is a group identifier string, then a drop down menu will be displayed on the login.html page. Records with the SAME group string will be displayed together in the drop down. For example, if your logindomainlist file contains the following records:</p>
<pre>
     domain1.com:domain2.com:firstgroup
     domain3.com:domain4.com:firstgroup
     domain5.com:domain6.com:firstgroup
     domain7.com:domain8.com:secondgroup
     domain9.com:domain10.com:secondgroup
</pre>
<p>And the user logs into sqwebmail with the following URL:</p><p>http://domain4.com/cgi-bin/sqwebmail</p><p>He will see a drop down containing ONLY the following domains:</p>
<pre>
     domain1.com
     domain3.com
     domain5.com
</pre>
<p>"domain3.com" will be automatically selected, or defaulted. Only the records in the firstgroup will be visible to the user. This functionality is great for organizations with more than one mail domain.</p><p><strong>Note</strong></p><p>The group string modifier does NOT allow the use of wildcards to automate the relationship between "access domains" and "mail domains". This is because drop down menus are fundamentally incompatible with wildcards.</p><p>Wildcards</p><p>If a record&apos;s modifier allows wildcarding (See "<em>Modifiers</em>" above for information about which modifiers allow wildcarding and which do not.) then the first and second fields of that record _MAY_ contain wildcards. Wildcards match against the HTTP_HOST CGI environment variable only. IP addresses can NOT be used if either the first or second fields contain the wildcard character. However, if neither the first nor second fields contain the wildcard character, then the second field can contain an IP address.</p><p>In the logindomainlist file, an asterisk (*) character in either the first and/or second field represents a wildcard. Any asterisk in the second field will be used to match an access domain. If an asterisk exists in the first field then any characters which the asterisk in the second field represents will replace the asterisk in the first field when sqwebmail determines the default mail domain. However, asterisks are not required in either the first or second fields. They are totally optional. For example, given the following logindomainlist record:</p><p>*.com:mail.*.com:@</p><p>If the user logs into sqwebmail with the following URL:</p><p>http://mail.mydomain.com/cgi-bin/sqwebmail</p><p>The asterisk in the second field will represent the string "mydomain". This string will then replace the asterisk in the first field to give the following default mail domain: mydomain.com</p><p>Similarly, if the following record exists in the logindomainlist file:</p><p>*:*:@</p><p>Then ANY URL the user uses to access sqwebmail will be automatically used for the default mail domain.</p><p>But the first field doesn&apos;t _HAVE_ to contain an asterisk. The following will work just fine:</p><p>mydomain.com:mydomain.*:@</p><p>The above example will allow the user to access the "mydomain.com" mail domain from any of the following URLs: "mydomain.org", "mydomain.net", "mydomain.us", etc...</p><p>And finally, the first field doesn&apos;t have to contain anything at all! If the first field is empty, that record will serve as an explicit no-default mail domain. No default mail domain will be specified if the second field matches the user&apos;s login URL. This is useful because the logindomainlist is searched from the top down. Any wildcard records at the bottom of the list will be overridden by records closer to the top. An "explicit no-default" record can be used to specify certain domains as "system account" domains so that no default mail domain is specified.</p><p>maildirfilterconfig</p><p>This file, if exists, sets the global defaults for mail filtering in the webmail server. Mail filtering in the webmail server is a subject worthy of special mention. A full description of how to install and configure webmail-based mail filtering is included in the installation notes for the Courier mail server. Refer to the installlation instructions for additional information.</p><p>maildirshared</p><p>This file, if exists, specifies the location of shared maildirs for the webmail and IMAP server. Normally, each mailbox must be separately configured to access every shared maildir, by the \m[blue]<strong></strong><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a>\m[]\s-2\u[10]\d\s+2 command. This file allows shared maildirs to be set globally for everyone. Everyone&apos;s webmail and IMAP server will pick up the shared maildirs specified in this file. See \m[blue]<strong></strong><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a>\m[]\s-2\u[10]\d\s+2 for more information.</p><p>maildrop</p><p>This file contains one line whose contents is a pathname to the \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 mail delivery agent. If the Courier mail server knows that the delivery agent used to delivery mail locally is \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 then certain delivery optimizations are possible. This configuration file does NOT actually specify that \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 should be used as a local mail delivery agent, it only specifies where \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 is installed. The default local mail delivery instructions are specified in the courierd configuration file. If the specified delivery instruction specify running an external program whose pathname matches the one specified by this configuration file, the Courier mail server assumes that it&apos;s \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2, and will use maildrop-specific options to optimize mail delivery.</p><p>This configuration file is initialized, by default, to point to the version of \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 that&apos;s integrated with the Courier mail server. The integrated version of \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 is configured slightly differently than the standalone version of \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2.</p><p>Although you can set the maildrop configuration file to point to some other version of the <strong>maildrop</strong> mail filter, you MUST set the maildropfilter configuration file (see below), to point to the integrated version of <strong>maildrop</strong>.</p><p>maildropfilter</p><p>This file contains one line whose contents is a pathname to the \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 mail delivery filter. In addition to being a delivery agent, maildrop can also be used as a mail filtering engine. If this file exists, the Courier mail server will be capable of invoking recipient-specified mail filters when a message is received. If the mail filtering rules reject the message, the Courier mail server will not accept the message for delivery. This means that when receiving mail via ESMTP, the Courier mail server will reject the ESMTP transaction without even accepting the message from the remote mail server.</p><p>This file is not installed by default. To activate mail filtering for local recipients, simply copy the contents of the maildrop configuration file to maildropfilter.</p><p>maildroprc</p><p>This file contains systemwide mail filtering instructions for \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 deliveries. This configuration file is optional, and is used by \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2 when it is invoked as a traditional post-delivery mail filter. See \m[blue]<strong></strong><strong>maildropfilter</strong>(6)\m[]\s-2\u[11]\d\s+2 for more information.</p><p>me</p><p>This file contains one line whose contents is a valid machine name. When a single installation of the Courier mail server is shared over a network, each machine that&apos;s running the Courier mail server must have a unique me file. If me is missing, The Courier mail server uses the result of the <strong>gethostname</strong>() system call.</p><p><strong>Warning</strong></p><p>If you change the contents of this configuration file, it may be necessary to rerun the <strong>makealiases</strong> command again, else your mail will promptly begin to bounce. If you don&apos;t have this configuration file defined, and you change the system&apos;s network host name, you may also need to run <strong>makealiases</strong>.</p><p>msgidhost</p><p>If a message does not have a Message-ID: header, the Courier mail server may decide to create one. The host portion of the new header will be set to the contents of msgidhost, which contains one line of text. If msgidhost does not exist, me will be used in its place. Changes to this file take effect immediately.</p><p>nochangingfrom</p><p>The Courier mail server&apos;s webmail server lets the contents of the From: header be set for mailed messages. If this configuration file exists, the ability to set the contents of the From: header is disabled.</p><p>queuelo, queuehi, queuefill</p><p>These configuration settings tune the Courier mail server&apos;s mail queue processing. The Courier mail server does not load the entire mail queue metadata in memory. queuelo contains a number that specifies the queue &ldquo;low watermark&rdquo; message count. queuehi contains a number that specifies the queue &ldquo;high watermark&rdquo; message count. queuefill specifies a time interval, &ldquo;queue refill&rdquo; in seconds. The number in queuefill may optionally be followed by "m", indicating that the queue refill is specified in minutes.</p><p>queuehi specifies the maximum number of messages that are loaded into memory. The Courier mail server reads the mail queue on disk until either it reads all of it, or it reads the number of messages specified by queuehi. As messages are delivered they are removed from the memory and disk. Messages that are deferred for another delivery attempt are removed from memory, but kept on the disk.</p><p>When the number of messages in memory falls below queuelo, The Courier mail server goes back to disk and attempts to fill the memory queue to the top, again.</p><p>This is, basically, a capsule summary of the mail queue processing logic. Many small, low level details are omitted; this is just an executive overview. When new messages arrive during a large mail backlog, the new messages are also loaded into the memory queue, if there&apos;s room for them. Therefore, during a large mail backlog the Courier mail server simultaneously tries to clear the existing backlog, and process any new mail at the same time. Up to the Courier mail server 0.41, all of this generally translates to the Courier mail server giving priority to newly arrived mail, and processing the backed up mail queue if spare resources are available.</p><p>The queuefill setting was added in the Courier mail server 0.42, in an attempt to keep new mail from excessively delaying existing mail during a major queue backup. queuefill specifies a time interval. When the Courier mail server completely fills the memory queue it sets a timer. After the interval given by queuefill The Courier mail server will go back and re-fill the mail queue even if the number of messages did not fall below the low watermark. If the Courier mail server finds older messages in the mail queue they will be pushed to the top of the scheduling queue, and given priority.</p><p>Smaller queuefill time intervals means more frequent trips to the disk, and more overhead. But, in exchange for that, during a mail backlog the Courier mail server will spend more time handling a greater number of delayed messages. Larger queuefill time intervals means less frequent trips to the disk, and less overhead, in exchange for less "fairness" during large mail backlogs.</p><p>queuefill defaults to five minutes, if not specified. Explicitly setting it to 0 seconds turns off the queue re-filling completely, essentially reverting to pre-0.42 behavior. The default queuelo and queuehi values are computed at run time. queuelo defaults to the larger of 200, and the sum total of configured mail delivery slots, both local and remote. queuehi, if not explicitly set, defaults to the smaller of twice the queuelo, or queuelo plus 1000.</p><p>queuetime</p><p>This file specifies how long the Courier mail server normally tries to repeatedly deliver a message, before giving up and returning it as undeliverable. Messages are immediately returned as undeliverable when a permanent failure is encountered (such as the recipient address not being valid). Attempts to deliver the message when there&apos;s a temporary, transient, error (such as the network being down) will be repeatedly made for the duration of time specified by this configuration file. This file contains a number followed by the letter &apos;w&apos; for weeks, or &apos;d&apos; for days. It is also possible to use &apos;h&apos; for hours, &apos;m&apos; for minutes, or &apos;s&apos; for seconds. Only integers are allowed, fractions are prohibited. However, you can use &apos;1w2d&apos; to specify one week and two days. If queuetime is missing, the Courier mail server makes repeated delivery attempts for one week.</p><p>retryalpha, retrybeta, retrygamma, retrydelta</p><p>These control files specify the schedule with which the Courier mail server tries to deliver each message that has a temporary, transient, delivery failure. retryalpha and retrygamma contain a time interval, specified in the same way as queuetime. retrybeta and retrymaxdelta contain small integral numbers only.</p><p>The Courier mail server will first make retrybeta delivery attempts, waiting for the time interval specified by retryalpha between each attempt. Then, the Courier mail server waits for the amount of time specified by retrygamma, then the Courier mail server will make another retrybeta delivery attempts, retryalpha amount of time apart. If still undeliverable, the Courier mail server waits retrygamma*2 amount of time before another retrybeta delivery attempts, with retryalpha amount of time apart. The next delay will be retrygamma*4 amount of time long, the next one retrygamma*8, and so on. retrymaxdelta sets the upper limit on the exponential backoff. Eventually the Courier mail server will keep waiting retrygamma*(2^retrymaxdelta) amount of time before making retrybeta delivery attempts retryalpha amount of time apart, until the queuetime interval expires.</p><p>The default values are:</p><p>retryalpha</p><p>Five minutes</p><p>retrybeta</p><p>Three times</p><p>retrygamma</p><p>Fifteen minutes</p><p>retrymaxdelta</p><p>Three</p><p>This results in the Courier mail server delivering each message according to the following schedule, in minutes: 5, 5, 5, 15, 5, 5, 30, 5, 5, 60, 5, 5, then repeating 120, 5, 5, until the message expires.</p><p>sizelimit</p><p>Maximum size of the message, in bytes, that the Courier mail server accepts for delivery. The Courier mail server rejects larger messages. If sizelimit is set to zero, The Courier mail server accepts as large message as available disk space permits. If the environment variable <strong>SIZELIMIT</strong> is set at the time a new message is received, it takes precedence and the Courier mail server uses the contents of the environment variable instead. Changes to this file take effect immediately. The <strong>SIZELIMIT</strong> environment variable is for use by individual mail submission agents. For example, it can be set by the smtpaccess configuration file (see \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2 for more information) for mail from certain IP addresses.</p><p>If sizelimit does not exist, and <strong>SIZELIMIT</strong> is not set, the maximum message size defaults to 10485760 bytes.</p><p>submitdelay</p><p>submitdelay specifies the delay before the first delivery attempt for a message that has been entered into the mail queue. Normally, the first delivery attempt is made as soon as possible. This setting delays the initial delivery attempt. It is normally used when you have a mail filter installed that detects duplicate messages arriving in a short period of time. If the mail filter detects this situation it can use the \m[blue]<strong></strong><a href="../man1/cancelmsg.1.html"><strong>cancelmsg</strong>(1)</a>\m[]\s-2\u[12]\d\s+2 command to reject duplicate messages in the queue (and return them back to the envelope sender).</p><p>submitdelay specifies a time interval in the same format as queuetime.</p><p>usexsender</p><p>If this configuration file exists, the Courier mail server&apos;s webmail server will set the X-Sender: header on all outgoing messages. This is a good idea if the webmail server allows the user to set the contents of the From: header. Note that the Courier mail server records the system userid of the sender in all locally-sent messages (which includes messages mailed by the webmail server), which is sufficient in most cases. In cases where you have many virtual accounts that share the same system userid, this configuration file provides a way to positively identify the sender of the outgoing message.</p><p>uucpme</p><p>uucpme sets the UUCP nodename of the Courier mail server mail relay. See \m[blue]<strong></strong><a href="../man8/courieruucp.8.html"><strong>courieruucp</strong>(8)</a>\m[]\s-2\u[13]\d\s+2 for more information.</p><p>uucpneighbors</p><p>uucpneighbors is used by the <strong>courieruucp</strong> module to specify the Courier mail server&apos;s configuration for relaying mail via UUCP. See \m[blue]<strong></strong><a href="../man8/courieruucp.8.html"><strong>courieruucp</strong>(8)</a>\m[]\s-2\u[13]\d\s+2 for more information.</p><p>uucprewriteheaders</p><p>If this file exists, headers of messages sent to/from UUCP addresses will be rewritten. Normally, only the message envelope sender and recipients are rewritten, the existence of this file causes the headers to be rewritten as well.</p><p>vhost.<em>ip-address</em>, vhost.<em>domain</em></p><p>Enable per-message virtual configuration settings described in the section called &ldquo;Servers with multiple IP addresses&rdquo; and the section called &ldquo;Simulating a server with multiple IP addresses&rdquo;, below, for more information.</p><p>warntime</p><p>warntime specifies an amount of time in the same format as queuetime. If a message still has not been delivered after this period of time, the Courier mail server sends a warning message (a "delayed" Delivery Status Notification) to the sender. If warntime is missing, the Courier mail server sets warntime to four hours.</p><p><strong>Note</strong></p><p>The time interval specified by warntime is only approximate. The Courier mail server sends a delayed Delivery Status Notification at the conclusion of the first attempted delivery after warntime has elapsed.</p>
<h3>Webmail template files</h3>
<p>HTML output from the webmail server is generated from the template files in /usr/lib/courier/sqwebmail/html/en-us. It is possible to translate the webmail interface into another language simply by creating another subdirectory underneath /usr/lib/courier/sqwebmail/html, then meticulously translating each .html file. Each template file contains well-formed HTML, with dynamic content marked off by tags. Note that the large comment blocks in each HTML file need to be translated too, since they are inserted as dynamic content, elsewhere.</p><p>The directory /usr/lib/courier/sqwebmail/html/en-us also contains several configuration files, in addition to the HTML template files. Doing so allows this configuration information to be defined for each available language.</p><p>CHARSET</p><p>This file consists of a single line of text, which names the character set used by the HTML template files. It is possible to specify multiple character set, by separating them with commas, provided that HTML templates use only the common portions of all listed character set.</p><p>The default English HTML templates use strictly the &ldquo;us-ascii&rdquo; subset, and the CHARSET contains utf-8,iso-8859-1. When multiple character sets are listed, the first character set that&apos;s supported by the browser is picked, so with UTF-8 capable browsers the default webmail interface will use UTF-8, falling back to ISO-8859-1 for browsers that do not support UTF-8.</p><p>footer</p><p>The contents of this file, if it exists, are appended to all messages sent by the webmail server.</p><p>ISPELLDICT</p><p>This file consists of a single line of text, which contains the name of the dictionary used for spell-checking. It is passed as an argument to <strong>ispell</strong>, or <strong>aspell</strong>.</p><p>LANGUAGE</p><p>This file consists of a single line of text, which should always be the same as the name of its directory (en-us).</p><p>LANGUAGE_PREF</p><p>This file is not needed at runtime, its contents are used during installation. See webmail/html/README_LANG in the source distribution for more information.</p><p>LOCALE</p><p>The corresponding C locale for these templates.</p><p>TIMEZONELIST</p><p>This file lists the available timezones on the login screen. See the comments in this file for more information.</p>
<h3>Sender Policy Framework Keywords</h3>
<p>The Courier mail server can perform &ldquo;Sender Policy Framework&rdquo; checks on up to three addresses for each message. This is controlled by setting the following variables: <strong>BOFHSPFHELO</strong>, <strong>BOFHSPFMAILFROM</strong>, and <strong>BOFHSPFFROM</strong>. Each variable is set to a comma-separated list of the following keywords: &ldquo;off&rdquo; - SPF verification disabled (default); &ldquo;none&rdquo;, &ldquo;neutral&rdquo;, &ldquo;pass&rdquo;, &ldquo;fail&rdquo;, &ldquo;softfail&rdquo;, &ldquo;error&rdquo;, &ldquo;unknown&rdquo; - these keywords correspond to the possible results of an SPF check, the message is accepted for the listed SPF results only, any other SPF result is rejected; &ldquo;all&rdquo; - shorthand for all possible SPF results, use &ldquo;all&rdquo; to run SPF in informational mode only, recording the SPF status in the Received-SPF: header; &ldquo;allowok&rdquo; - automatically pass the SPF verification if the sender&apos;s IP address is found in a DNS access whitelist, any whitelist given in the <strong>-allow</strong> option to <strong>couriertcpd</strong>, see the &ldquo;DNS ACCESS LISTS&rdquo; section in \m[blue]<strong></strong><a href="../man1/couriertcpd.1.html"><strong>couriertcpd</strong>(1)</a>\m[]\s-2\u[14]\d\s+2.</p><p>A rejected SPF result gets kicked back with a permanent error indication if the SPF result is listed in <strong>BOFHSPFHARDERROR</strong>, and a temporary error indication otherwise.</p><p>When enabling SPF checking, the keyword list should always include &ldquo;pass&rdquo; (it makes no sense to do otherwise) and &ldquo;none&rdquo;. The keyword list should also include &ldquo;softfail&rdquo;, &ldquo;neutral&rdquo;, and &ldquo;unknown&rdquo;. See the SPF draft for a description of these status results. At some distant future, the keyword list will only include &ldquo;pass&rdquo;, rejecting all senders without a stated policy. This might be desirable at some point in the future, but not right now.</p><p>The <strong>BOFHSPFFROM</strong> list may also include an additional keyword, &ldquo;mailfromok&rdquo;. <strong>BOFHSPFMAILFROM</strong> and <strong>BOFHSPFFROM</strong> are trade-offs. Using <strong>BOFHSPFMAILFROM</strong> is faster, and it does not require the entire message to be received, before running the SPF check. <strong>BOFHSPFFROM</strong> checking can only occur after the entire message is received, but it&apos;s more reliable. If &ldquo;mailfromok&rdquo; is listed, the From: is not checked if the MAIL FROM command was checked with the &ldquo;pass&rdquo; result.</p><p>In other words: the From: header is checked if MAIL FROM was empty, or did not pass the SPF checks. If MAIL FROM passed the SPF check the Courier mail server won&apos;t bother looking at the From: header.</p><p><strong>Note</strong></p><p>A conservative policy should not reject failed SPF checks from the From:header, because it can be counterproductive in some situations. This is because when a sender from a domain with a published SPF policy sends a message to a mailing list, the message goes through the mailing list processor&apos;s IP address, and it will fail the SPF check unless the domain SPF explicitly authorizes the mailing list processor&apos;s IP address.</p><p>This is very unlikely. The end result is that domains with a published SPF record get punished, and domains without an SPF record get off scott free. Mailing lists should be encouraged to publish their own SPF records for mailing list traffic; then the &ldquo;mailfromok&rdquo; keyword can validate the mailing list&apos;s return address, and forego checking of the &ldquo;From:&rdquo; header from the mailing list, while still checking the &ldquo;From:&rdquo; header from everyone else.</p><p>Another alternative is to use <strong>opt BOFHSPFFROM=all</strong> for advisory purposes only. Post-delivery mail filters can key off the &ldquo;Received-SPF&rdquo; header.</p><p><strong>Note</strong></p><p>The Courier mail server can add up to three &ldquo;Received-SPF&rdquo; headers of its own, one for each SPF check. The Courier mail server renames any existing &ldquo;Received-SPF&rdquo; header as &ldquo;Old-Received-SPF&rdquo;. All &ldquo;Received-SPF&rdquo; headers delivered to a local mailbox will always come from the Courier mail server.</p>
<h3>Servers with multiple IP addresses</h3>
<p>The Courier mail server&apos;s default configuration listens on port 25 on all IP addresses. If the server has more than one IP address, Courier accepts connections on any IP address. Adjust the settings in the esmtpd configuration file to explicitly list which IP addresses Courier should listenson. This also applies to the ESMTP over SSL server on port 465 configured by esmtpd-ssl, and the MSA server on port 587, configured by esmtpd-msa.</p><p>That&apos;s for incoming EMSTP. For outgoing ESMTP connections, the Courier mail server does not specify an IP address by default, and lets the server select one. The server selects a default IP address based on a server&apos;s network configuration. The selection criteria is platform specific, and is typically based on the system&apos;s IP routing tables.</p><p>The ipout and ip6out configuration files set an explicit IP address for Courier&apos;s outgoing connections:</p>
<pre>
# echo "192.168.0.1" &gt;/etc/courier/ipout
# echo "fec0::230:48ff:fec4:429c" &gt;/etc/courier/ip6out
</pre>
<p>This example specifies 192.168.0.1 as the IP address to make connections from for IPv4 destinations, and fec0::230:48ff:fec4:429c for IPv6 destinations.</p><p>If the Courier mail server runs on a host with two IPv4 addresses, 192.168.0.1, 192.168.1.1, the above example uses 192.168.0.1 to send the relayed message to IPv4 destinations even if Courier received the message from a client that connected to the other addresses.</p><p>If the Courier mail server accepts an ESMTP connection and a message from an authenticated client with relaying privileges, in a smarthost role, and forwards the message via ESMTP, Courier normally uses the server&apos;s default IP address, or the one set by ipout or ipout6. When the Courier mail servers runs on more than one IP address, it&apos;s possible to selectively set the outgoing IP address based on which one of those IP addresses the message was received at. A simple, basic configuration forwards the message from the same IP addresses it was received from, but it doesn&apos;t have to be, it can be a different one.</p><p>The first step is to enable a per-message, non-default configuration settings, like the outgoing IP address, by creating a zero-length vhost.<em>ip-address</em> file:</p>
<pre>
# touch &gt;/etc/courier/vhost.192.168.0.1
# touch &gt;"/etc/courier/vhost.fec0::230:48ff:fec4:429c"
</pre>
<p>This enables non-default settings for messages received from a client that connects to one of these IP addresses. These two IP addresses (one IPv4 and one IPv6 address) are, presumably, two of the server&apos;s IP addresses. This is not a client&apos;s IP address, these are the server&apos;s IP addresses. These may be the only two IP addresses the server has, or the server can have more IP addresses, but these are the only two IP addresses for which custom settings get enabled.</p><p>One such custom setting would be a different IP address for outgoing connections depending on the IP address of the connection the message was originally received from:</p>
<pre>
# echo "192.168.0.1" &gt;/etc/courier/ipout.192.168.0.1
# echo "192.168.1.1" &gt;/etc/courier/ipout.192.168.1.1
</pre>
<p>&ldquo;ipout.<em>address</em>&rdquo; sets the IP address for outgoing connections for messages received from a client connection to &ldquo;<em>address</em>&rdquo; only. Just an ipout applies to all other messages, except ones which have an ipout.<em>address</em> in existence. The above example specifies that, on a server with these two IP addresses, messages received from a client that&apos;s connected to either IP address get forwarded (from a client that normally authenticates and receives relaying privileges) using a connection from the same IP address. If the server has any other IP addresses, the IP address in ipout takes effect (or the default system-specified IP address).</p><p>For convenience, an empty ipout.<em>address</em> gets interpreted as if it contains the same <em>address</em>. The above example is equivalent to:</p>
<pre>
# touch /etc/courier/ipout.192.168.0.1
# touch /etc/courier/ipout.192.168.1.1
</pre>
<p>The formal configuration rules are as follows, for a message received from IP address &ldquo;<em>address</em>&rdquo;, which may be an IPv4 or an IPv6 address:</p><p>The IPv4 address and the IPv6 address for outgoing ESMTP connections get specified by the contents of /etc/courier/ipout.<em>address</em> and /etc/courier/ip6out.<em>address</em>, respectively.</p><p>If the file exists, but is empty, the same <em>address</em> becomes the IP address for the outgoing connection.</p><p>The above rules are in effect only if /etc/courier/vhost.<em>address</em> exists,</p><p>If the file does not exist, or if /etc/courier/vhost.<em>address</em> does not exist, the contents of /etc/courier/ipout, for IPv4 connections, and /etc/courier/ip6out, for IPv6 connections set the IP address.</p><p>Otherwise, the Courier mail server uses the default IP address determined by the system&apos;s network configuration.</p><p>In /etc/courier/ipout.<em>address</em> and /etc/courier/ip6out.<em>address</em>, an address of "0" also specifies the system&apos;s default IP address.</p><p>It is possible for the Courier mail server to receive a message from an IPv6 connection, and forward it to an IPv4 address, or vice versa. The <em>address</em> portion of /etc/courier/ipout.<em>address</em> and /etc/courier/ip6out.<em>address</em>, specifies the IP address the client used to connect to Courier and may be either an IPv4 or an IPv6 address, in both cases! For example:</p>
<pre>
# echo "192.168.0.1" &gt;/etc/courier/ipout.192.168.0.1
# echo "fec0::230:48ff:fec4:429c" &gt;/etc/courier/ip6out.192.168.0.1
</pre>
<p>This means that when a client connects to the Courier mail server using the IP address 192.168.0.1 and relays a message, if the message gets forwarded to an IPv4 address, Courier uses the same IP address, and if it gets forwarded to an IPv6 address Courier uses this IPv6 address. The above also probably means that:</p>
<pre>
# echo "192.168.0.1" &gt;"/etc/courier/ipout.fec0::230:48ff:fec4:429c"
# echo "fec0::230:48ff:fec4:429c" &gt;"/etc/courier/ipout.fec0::230:48ff:fec4:429c"
</pre>
<p>So if an IPv6 client connects to Courier on this IPv6 address and relays a message, Courier uses the same IPv6 address, or 192.168.0.1 depending on the destination.</p><p><strong>Note</strong></p><p>Notwithstanding the IP address set in an ipout or an ip6out file, the server&apos;s network configuration must be able to actually establish a network connection to the destination address from the explicitly specified IP address. Specifying an explicit IP address for outgoing connections implies that the IP addresses are fully and globally routable.</p><p>Additionally, for all other configuration files described in this manual page, the Courier mail server uses &ldquo;filename.<em>address</em>&rdquo; if it exists, in place of &ldquo;filename&rdquo; when processing messages received from &ldquo;address&rdquo;, either an IPv4 or an IPv6 address.</p><p>This is used in all contexts where it makes sense to do so:</p>
<pre>
# echo "relay.example.com" &gt;/etc/courier/me.192.168.0.1
# echo "firewall.example.com" &gt;/etc/courier/me.192.168.1.1
</pre>
<p>This example specifies &ldquo;relay.example.com&rdquo; as the contents of the me configuration file, described earlier in this manual page, when processing messages received by clients that connect to 192.168.0.1, and &ldquo;firewall.example.com&rdquo; for processing messages received by clients that connect to 192.168.1.1.</p><p>&ldquo;me&rdquo; is the default hostname for most common Courier mail server configuration settings, such as the server&apos;s name in the ESMTP greeting banner, what Courier calls itself in the ESMTP <strong>EHLO/HELO</strong> commands, and other contexts, unless overridden by a more specific setting.</p><p><strong>Note</strong></p><p>The IP address-specific configuration settings get used only in the context of processing messages, and have no impact on other parts of the Courier mail server that do not have a direct relationship to a specific message. One such example would be when Courier authenticates a client&apos;s username or password. This is not directly related to any message the client may or may not send after it authenticates, so this happens in exactly the same way no matter which IP address the client connected to.</p>
<h3>Simulating a server with multiple IP addresses</h3>
<p>As described in the previous section, the existence of vhost.<em>ip-address</em> enables configuration settings only for messages that were received at one of the IP addresses that the Courier mail server accepts connections on.</p><p>It&apos;s possible to partially achieve the same end results by creating vhost.<em>domain</em>:</p>
<pre>
# touch &gt;/etc/courier/vhost.example.com
</pre>
<p>This enables per-message specific configuration for messages received from authenticated clients whose authenticated ID ends with &ldquo;@example.com&rdquo;. If the server has more than one IP address, but, for whatever reason, only receives mail on one of them but wants to use the other one for outgoing mail for this domain:</p>
<pre>
# echo &apos;192.168.0.1&apos; &gt;/etc/courier/ipout.example.com
</pre>
<p>This sets this IP address for all outgoing messages with a &ldquo;@example.com&rdquo; authenticated client. It&apos;s important to note the following limitations:</p><p>The Courier authentication library (see installation instructions) must be configured with accounts and mailboxes that follow the &ldquo;user@domain&rdquo; format.</p><p>Not all configuration settings can be customized in a <em>setting</em>.<em>domain</em>. The trivial example would be the ESMTP server banner. The mail server emits the banner before it&apos;s ready to receive the first message, so no return address-based customization is possible, of course, to select an ESMTP server banner. Additionally, the &ldquo;me&rdquo; configuration setting gets set before the return address is received, so the contents of a domain-specific &ldquo;me&rdquo; may not be in effect in all contexts.</p><p>Anyone can use any return address they wish. Some mitigation is possible, of course, using measures such as SPF, but it would be mistake to believe that this is much more than just eye candy.</p><p>Both an IP address and domain-based &ldquo;vhost&rdquo;s are allowed. An IP address-based vhost takes precedence.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Flushing a single message will not work if the message queue is backed up. When that happens, your only available option is to flush the entire queue.</p><p><strong>courier start</strong> fails if the Courier mail server has detected a fatal operational error. In this situation the top-level <strong>courierd</strong> daemon sleeps for a minute, before automatically restarting. During this sleep interval courier stop does not work.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO courier&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong></strong><a href="../man1/cancelmsg.1.html"><strong>cancelmsg</strong>(1)</a>\m[]\s-2\u[12]\d\s+2, \m[blue]<strong></strong><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a>\m[]\s-2\u[10]\d\s+2, \m[blue]<strong></strong><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a>\m[]\s-2\u[6]\d\s+2, \m[blue]<strong></strong><a href="../man1/preline.1.html"><strong>preline</strong>(1)</a>\m[]\s-2\u[15]\d\s+2, \m[blue]<strong></strong><a href="../man1/sendmail.1.html"><strong>sendmail</strong>(1)</a>\m[]\s-2\u[16]\d\s+2, \m[blue]<strong></strong><a href="../man1/testmxlookup.1.html"><strong>testmxlookup</strong>(1)</a>\m[]\s-2\u[17]\d\s+2, \m[blue]<strong></strong><a href="../man5/dot-courier.5.html"><strong>dot-courier</strong>(5)</a>\m[]\s-2\u[4]\d\s+2, \m[blue]<strong></strong><strong>authlib</strong>(7)\m[]\s-2\u[18]\d\s+2, \m[blue]<strong></strong><a href="../man8/courierfax.8.html"><strong>courierfax</strong>(8)</a>\m[]\s-2\u[7]\d\s+2, \m[blue]<strong></strong><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a>\m[]\s-2\u[5]\d\s+2, \m[blue]<strong></strong><a href="../man8/filterctl.8.html"><strong>filterctl</strong>(8)</a>\m[]\s-2\u[5]\d\s+2, \m[blue]<strong></strong><a href="../man8/courierldapaliasd.8.html"><strong>courierldapaliasd</strong>(8)</a>\m[]\s-2\u[9]\d\s+2, \m[blue]<strong></strong><a href="../man8/courierpop3d.8.html"><strong>courierpop3d</strong>(8)</a>\m[]\s-2\u[19]\d\s+2, \m[blue]<strong></strong><a href="../man8/courierpop3d.8.html"><strong>courierpop3d</strong>(8)</a>\m[]\s-2\u[19]\d\s+2, \m[blue]<strong></strong><strong>couriertcpd</strong>(8)\m[]\s-2\u[14]\d\s+2, \m[blue]<strong></strong><a href="../man8/courieruucp.8.html"><strong>courieruucp</strong>(8)</a>\m[]\s-2\u[13]\d\s+2, \m[blue]<strong></strong><a href="../man8/esmtpd.8.html"><strong>esmtpd</strong>(8)</a>\m[]\s-2\u[20]\d\s+2, \m[blue]<strong></strong><a href="../man8/imapd.8.html"><strong>imapd</strong>(8)</a>\m[]\s-2\u[21]\d\s+2, \m[blue]<strong></strong><a href="../man7/localmailfilter.7.html"><strong>localmailfilter</strong>(7)</a>\m[]\s-2\u[2]\d\s+2, \m[blue]<strong></strong><a href="../man1/mailq.1.html"><strong>mailq</strong>(1)</a>\m[]\s-2\u[1]\d\s+2, \m[blue]<strong></strong><a href="../man8/makeacceptmailfor.8.html"><strong>makeacceptmailfor</strong>(8)</a>\m[]\s-2\u[22]\d\s+2, \m[blue]<strong></strong><a href="../man8/makealiases.8.html"><strong>makealiases</strong>(8)</a>\m[]\s-2\u[23]\d\s+2, \m[blue]<strong></strong><a href="../man8/makehosteddomains.8.html"><strong>makehosteddomains</strong>(8)</a>\m[]\s-2\u[8]\d\s+2, \m[blue]<strong></strong><a href="../man8/makepercentrelay.8.html"><strong>makepercentrelay</strong>(8)</a>\m[]\s-2\u[24]\d\s+2, \m[blue]<strong></strong><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a>\m[]\s-2\u[3]\d\s+2, \m[blue]<strong></strong><a href="../man8/makeuserdb.8.html"><strong>makeuserdb</strong>(8)</a>\m[]\s-2\u[25]\d\s+2, \m[blue]<strong></strong><strong>pw2userdb</strong>(8)\m[]\s-2\u[25]\d\s+2, \m[blue]<strong></strong><a href="../man8/mkesmtpdcert.8.html"><strong>mkesmtpdcert</strong>(8)</a>\m[]\s-2\u[26]\d\s+2, \m[blue]<strong></strong><a href="../man8/mkimapdcert.8.html"><strong>mkimapdcert</strong>(8)</a>\m[]\s-2\u[27]\d\s+2, \m[blue]<strong></strong><a href="../man8/pop3d.8.html"><strong>pop3d</strong>(8)</a>\m[]\s-2\u[28]\d\s+2, \m[blue]<strong></strong><a href="../man8/submit.8.html"><strong>submit</strong>(8)</a>\m[]\s-2\u[29]\d\s+2, \m[blue]<strong></strong><a href="../man8/userdb.8.html"><strong>userdb</strong>(8)</a>\m[]\s-2\u[30]\d\s+2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Sam Varshavchik</strong></p><p>Author</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p><a href="../man1/mailq.1.html"><strong>mailq</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/mailq.html</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p><a href="../man7/localmailfilter.7.html"><strong>localmailfilter</strong>(7)</a></p><p>[set $man.base.url.for.relative.links]/localmailfilter.html</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p><a href="../man8/makesmtpaccess.8.html"><strong>makesmtpaccess</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makesmtpaccess.html</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p><a href="../man5/dot-courier.5.html"><strong>dot-courier</strong>(5)</a></p><p>[set $man.base.url.for.relative.links]/dot-courier.html</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><a href="../man8/courierfilter.8.html"><strong>courierfilter</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courierfilter.html</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p><a href="../man1/maildrop.1.html"><strong>maildrop</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/maildrop.html</p>
  </dd>
  <dt>
     7.
  </dt>
  <dd>
    <p><a href="../man8/courierfax.8.html"><strong>courierfax</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courierfax.html</p>
  </dd>
  <dt>
     8.
  </dt>
  <dd>
    <p><a href="../man8/makehosteddomains.8.html"><strong>makehosteddomains</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makehosteddomains.html</p>
  </dd>
  <dt>
     9.
  </dt>
  <dd>
    <p><a href="../man8/courierldapaliasd.8.html"><strong>courierldapaliasd</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courierldapaliasd.html</p>
  </dd>
  <dt>
    10.
  </dt>
  <dd>
    <p><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/maildirmake.html</p>
  </dd>
  <dt>
    11.
  </dt>
  <dd>
    <p><strong>maildropfilter</strong>(6)</p><p>[set $man.base.url.for.relative.links]/maildropfilter.html</p>
  </dd>
  <dt>
    12.
  </dt>
  <dd>
    <p><a href="../man1/cancelmsg.1.html"><strong>cancelmsg</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/cancelmsg.html</p>
  </dd>
  <dt>
    13.
  </dt>
  <dd>
    <p><a href="../man8/courieruucp.8.html"><strong>courieruucp</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courieruucp.html</p>
  </dd>
  <dt>
    14.
  </dt>
  <dd>
    <p><a href="../man1/couriertcpd.1.html"><strong>couriertcpd</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/couriertcpd.html</p>
  </dd>
  <dt>
    15.
  </dt>
  <dd>
    <p><a href="../man1/preline.1.html"><strong>preline</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/preline.html</p>
  </dd>
  <dt>
    16.
  </dt>
  <dd>
    <p><a href="../man1/sendmail.1.html"><strong>sendmail</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/sendmail.html</p>
  </dd>
  <dt>
    17.
  </dt>
  <dd>
    <p><a href="../man1/testmxlookup.1.html"><strong>testmxlookup</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/testmxlookup.html</p>
  </dd>
  <dt>
    18.
  </dt>
  <dd>
    <p><strong>authlib</strong>(7)</p><p>[set $man.base.url.for.relative.links]/authlib.html</p>
  </dd>
  <dt>
    19.
  </dt>
  <dd>
    <p><a href="../man8/courierpop3d.8.html"><strong>courierpop3d</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/courierpop3d.html</p>
  </dd>
  <dt>
    20.
  </dt>
  <dd>
    <p><a href="../man8/esmtpd.8.html"><strong>esmtpd</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/esmtpd.html</p>
  </dd>
  <dt>
    21.
  </dt>
  <dd>
    <p><a href="../man8/imapd.8.html"><strong>imapd</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/imapd.html</p>
  </dd>
  <dt>
    22.
  </dt>
  <dd>
    <p><a href="../man8/makeacceptmailfor.8.html"><strong>makeacceptmailfor</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makeacceptmailfor.html</p>
  </dd>
  <dt>
    23.
  </dt>
  <dd>
    <p><a href="../man8/makealiases.8.html"><strong>makealiases</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makealiases.html</p>
  </dd>
  <dt>
    24.
  </dt>
  <dd>
    <p><a href="../man8/makepercentrelay.8.html"><strong>makepercentrelay</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makepercentrelay.html</p>
  </dd>
  <dt>
    25.
  </dt>
  <dd>
    <p><a href="../man8/makeuserdb.8.html"><strong>makeuserdb</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/makeuserdb.html</p>
  </dd>
  <dt>
    26.
  </dt>
  <dd>
    <p><a href="../man8/mkesmtpdcert.8.html"><strong>mkesmtpdcert</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/mkesmtpdcert.html</p>
  </dd>
  <dt>
    27.
  </dt>
  <dd>
    <p><a href="../man8/mkimapdcert.8.html"><strong>mkimapdcert</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/mkimapdcert.html</p>
  </dd>
  <dt>
    28.
  </dt>
  <dd>
    <p><a href="../man8/pop3d.8.html"><strong>pop3d</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/pop3d.html</p>
  </dd>
  <dt>
    29.
  </dt>
  <dd>
    <p><a href="../man8/submit.8.html"><strong>submit</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/submit.html</p>
  </dd>
  <dt>
    30.
  </dt>
  <dd>
    <p><a href="../man8/userdb.8.html"><strong>userdb</strong>(8)</a></p><p>[set $man.base.url.for.relative.links]/userdb.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="corosync_overview.8.html"><span aria-hidden="true">&larr;</span> corosync_overview.8: Corosync overview</a></li>
   <li class="next"><a href="courier-mtaconfig.8.html">courier-mtaconfig.8: Show configuration parameters for the courier mta <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
