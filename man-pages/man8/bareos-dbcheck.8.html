<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>bareos-dbcheck: Bareos's catalog database check/clean program</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Bareos's catalog database check/clean program">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="bareos-dbcheck (8) manual">
  <meta name="twitter:description" content="Bareos's catalog database check/clean program">
  <meta name="twitter:image" content="https://www.carta.tech/images/bareos-database-tools-bareos-dbcheck-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/bareos-dbcheck.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="bareos-dbcheck (8) manual" />
  <meta property="og:description" content="Bareos's catalog database check/clean program" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/bareos-database-tools-bareos-dbcheck-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">bareos-dbcheck<small> (8)</small></h1>
        <p class="lead">Bareos's catalog database check/clean program</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/bareos-dbcheck.8.html">
      <span itemprop="name">bareos-dbcheck: Bareos's catalog database check/clean program</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/bareos-database-tools/">
      <span itemprop="name">bareos-database-tools</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/bareos-dbcheck.8.html">
      <span itemprop="name">bareos-dbcheck: Bareos's catalog database check/clean program</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dbcheck</strong> [<em>options</em>] <em>working-directory</em> <em>bareos-database</em> <em>user</em> <em>password</em> [<em>dbhost</em>] [<em>dbport</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This manual page documents briefly the <strong>bareos-dbcheck</strong> command.</p><p>bareos-dbcheck will not repair your database if it is broken. Please see your vendor's instructions for fixing broken database.</p><p>bareos-dbcheck is a simple program that will search for logical inconsistencies in the Bareos tables in your database, and optionally fix them. It is a database maintenance routine, in the sense that it can detect and remove unused rows, but it is not a database repair routine. To repair a database, see the tools furnished by the database vendor.  Normally dbcheck should never need to be run, but if Bareos has crashed or you have a lot of Clients, Pools, or Jobs that you have removed, it could be useful.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>A summary of options is included below.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-?</strong></p>
  </dt>
  <dd>
    <p>Show version and usage of program.</p>
  </dd>
  <dt>
    <p><strong>-b</strong></p>
  </dt>
  <dd>
    <p>If specified, dbcheck will run in batch mode, and it will proceed to examine and fix (if -f is set) all programmed inconsistency checks. By default, dbcheck will enter interactive mode (see below).</p>
  </dd>
  <dt>
    <p><strong>-B</strong></p>
  </dt>
  <dd>
    <p>print catalog configuration and exit.</p>
  </dd>
  <dt>
    <p><strong>-c</strong><em>config</em></p>
  </dt>
  <dd>
    <p>If the -c option is given with the Director's conf file, there is no need to enter any of the command line arguments, in particular the working directory as dbcheck will read them from the file.</p>
  </dd>
  <dt>
    <p><strong>-C</strong><em>catalog</em></p>
  </dt>
  <dd>
    <p>catalog name in the director conf file.</p>
  </dd>
  <dt>
    <p><strong>-d</strong><em>nnn</em></p>
  </dt>
  <dd>
    <p>set debug level to <em>nnn</em>.</p>
  </dd>
  <dt>
    <p><strong>-dt</strong></p>
  </dt>
  <dd>
    <p>print timestamp in debug output.</p>
  </dd>
  <dt>
    <p><strong>-D</strong><em>drivername</em></p>
  </dt>
  <dd>
    <p>Specify the database driver name (default NULL) &lt;postgresql|mysql|sqlite3&gt;.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>If specified, dbcheck will repair (fix) the inconsistencies it finds. Otherwise, it will report only.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Set verbose mode.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTERACTIVE MODE</h2>
        <div class="sectioncontent">
<p>In interactive mode dbcheck will prompt with the following:</p><p>Hello, this is the database check/correct program. Please select the function you want to perform.</p>
<pre>
     1) Toggle modify database flag
     2) Toggle verbose flag
     3) Repair bad Filename records
     4) Repair bad Path records
     5) Eliminate duplicate Filename records
     6) Eliminate duplicate Path records
     7) Eliminate orphaned Jobmedia records
     8) Eliminate orphaned File records
     9) Eliminate orphaned Path records
    10) Eliminate orphaned Filename records
    11) Eliminate orphaned FileSet records
    12) Eliminate orphaned Client records
    13) Eliminate orphaned Job records
    14) Eliminate all Admin records
    15) Eliminate all Restore records
    16) All (3-15)
    17) Quit
</pre>
<p>Select function number:</p><p>By entering 1 or 2, you can toggle the modify database flag (-f option) and the verbose flag (-v).  It can be helpful and reassuring to turn off the modify database flag, then select one or more of the consistency checks (items 3 through 9) to see what will be done, then toggle the modify flag on and re-run the check.</p><p>The inconsistencies examined are the following:</p><p>Duplicate filename records.  This can happen if you accidentally run two</p>
<pre>
   copies of Bareos at the same time, and they are both adding filenames
   simultaneously.  It is a rare occurrence, but will create an
   inconsistent database.  If this is the case, you will receive error
   messages during Jobs warning of duplicate database records.  If you are
   not getting these error messages, there is no reason to run this check.
</pre>
<p>Repair bad Filename records.  This checks and corrects filenames that have</p>
<pre>
   a trailing slash.  They should not.
</pre>
<p>Repair bad Path records.  This checks and corrects path names that do not</p>
<pre>
   have a trailing slash.  They should.
</pre>
<p>Duplicate path records.  This can happen if you accidentally run two copies</p>
<pre>
   of Bareos at the same time, and they are both adding filenames
   simultaneously.  It is a rare occurrence, but will create an
   inconsistent database.  See the item above for why this occurs and how
   you know it is happening.
</pre>
<p>Orphaned JobMedia records.  This happens when a Job record is deleted</p>
<pre>
   (perhaps by a user issued SQL statement), but the corresponding JobMedia
   record (one for each Volume used in the Job) was not deleted.  Normally,
   this should not happen, and even if it does, these records generally do
   not take much space in your database.  However, by running this check,
   you can eliminate any such orphans.
</pre>
<p>Orphaned File records.  This happens when a Job record is deleted (perhaps</p>
<pre>
   by a user issued SQL statement), but the corresponding File record (one
   for each Volume used in the Job) was not deleted.  Note, searching for
   these records can be very time consuming (i.e.  it may take hours) for a
   large database.  Normally this should not happen as Bareos takes care to
   prevent it.  Just the same, this check can remove any orphaned File
   records.  It is recommended that you run this once a year since orphaned
   File records can take a large amount of space in your database.  You
   might want to ensure that you have indexes on JobId, FilenameId, and
   PathId for the File table in your catalog before running this command.
</pre>
<p>Orphaned Path records.  This condition happens any time a directory is</p>
<pre>
   deleted from your system and all associated Job records have been
   purged.  During standard purging (or pruning) of Job records, Bareos
   does not check for orphaned Path records.  As a consequence, over a
   period of time, old unused Path records will tend to accumulate and use
   space in your database.  This check will eliminate them.  It is
   recommended that you run this check at least once a year.
</pre>
<p>Orphaned Filename records.  This condition happens any time a file is</p>
<pre>
   deleted from your system and all associated Job records have been
   purged.  This can happen quite frequently as there are quite a large
   number of files that are created and then deleted.  In addition, if you
   do a system update or delete an entire directory, there can be a very
   large number of Filename records that remain in the catalog but are no
   longer used.
</pre>

<pre>
   During standard purging (or pruning) of Job records, Bareos does not
   check for orphaned Filename records.  As a consequence, over a period of
   time, old unused Filename records will accumulate and use space in your
   database.  This check will eliminate them.  It is strongly recommended
   that you run this check at least once a year, and for large database
   (more than 200 Megabytes), it is probably better to run this once every
   6 months.
</pre>
<p>Orphaned Client records.  These records can remain in the database long</p>
<pre>
   after you have removed a client.
</pre>
<p>Orphaned Job records.  If no client is defined for a job or you do not run</p>
<pre>
   a job for a long time, you can accumulate old job records.  This option
   allow you to remove jobs that are not attached to any client (and thus
   useless).
</pre>
<p>All Admin records. This command will remove all Admin records,</p>
<pre>
   regardless of their age.
</pre>
<p>All Restore records. This command will remove all Restore records,</p>
<pre>
   regardless of their age.
</pre>
<p>By the way, I personally run dbcheck only where I have messed up my database due to a bug in developing Bareos code, so normally you should never need to run dbcheck inspite of the recommendations given above, which are given so that users don't waste their time running dbcheck too often.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO bareos-dbcheck&hellip;</h2>
        <div class="sectioncontent">
<p><strong>bls</strong>(1), <strong>bextract</strong>(1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This manual page was written by Jose Luis Tallon &lt;jltallon@adv-solutions.net&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="bareos.8.html"><span aria-hidden="true">&larr;</span> bareos.8: Backup archiving recovery open sourced</a></li>
   <li class="next"><a href="bareos-dir.8.html">bareos-dir.8: Bareos director <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
