<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cyrus-reconstruct: Reconstruct mailboxes</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Reconstruct mailboxes">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cyrus-reconstruct (8) manual">
  <meta name="twitter:description" content="Reconstruct mailboxes">
  <meta name="twitter:image" content="https://www.carta.tech/images/cyrus-common-cyrus-reconstruct-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/cyrus-reconstruct.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cyrus-reconstruct (8) manual" />
  <meta property="og:description" content="Reconstruct mailboxes" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cyrus-common-cyrus-reconstruct-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cyrus-reconstruct<small> (8)</small></h1>
        <p class="lead">Reconstruct mailboxes</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cyrus-reconstruct.8.html">
      <span itemprop="name">cyrus-reconstruct: Reconstruct mailboxes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cyrus-common/">
      <span itemprop="name">cyrus-common</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cyrus-reconstruct.8.html">
      <span itemprop="name">cyrus-reconstruct: Reconstruct mailboxes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>cyrreconstruct</strong> [ <strong>-C</strong> <em>config-file</em> ] [ <strong>-p</strong> <em>partition</em> ] [ <strong>-x</strong> ] [ <strong>-r</strong> ] [ <strong>-f</strong> ]</p>
<pre>
            [
</pre>
<p><strong>-k</strong> ] [ <strong>-s</strong> ] [ <strong>-g</strong> ] [ <strong>-G</strong> ] [ <strong>-R</strong> ] [ <strong>-o</strong> ] [ <strong>-O</strong> ] <em>mailbox</em>...</p><p><strong>cyrreconstruct</strong> [ <strong>-C</strong> <em>config-file</em> ] <strong>-m</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>cyrreconstruct</em> rebuilds one or more IMAP mailboxes.  When invoked with the <strong>-m</strong> switch, it rebuilds the master mailboxes file.  It can be used to recover from almost any sort of data corruption.</p><p>If <em>cyrreconstruct</em> can find existing header and index files, it attempts to preserve any data in them that is not derivable from the message files themselves. The state <em>cyrreconstruct</em> attempts to preserve includes the flag names, flag state, and internaldate. <em>cyrreconstruct</em> derives all other information from the message files.</p><p><em>cyrreconstruct</em> reads its configuration options out of the <a href="../man5/imapd.conf.5.html"><strong>imapd.conf</strong>(5)</a> file unless specified otherwise by <strong>-C</strong>.  Any mailbox directory underneath the path specified in the <em>partition-news</em> configuration option is assumed to be in news format.</p><p><em>cyrreconstruct</em> does not adjust the quota usage recorded in any quota root files.  After running <em>cyrreconstruct</em>, it is advisable to run <strong>cyrquota</strong>(8) with the <em>-f</em> switch in order to fix the quota root files.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-C</strong><em> config-file</em></p>
  </dt>
  <dd>
    <p>Read configuration options from <em>config-file</em>.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> partition</em></p>
  </dt>
  <dd>
    <p>Search for the listed (non-existant) mailboxes on the indicated partition. Create the mailboxes in the database in addition to reconstructing them. (not compatible with the use of wildcards)</p>
  </dd>
  <dt>
    <p><strong>-x</strong></p>
  </dt>
  <dd>
    <p>When processing a mailbox which is not in the mailbox list (e.g. via the -p or -f options), do not import the metadata from the mailbox, instead create it anew (this specifically affects at least the mailbox's seen state unique identifier, user flags, and ACL).</p>
  </dd>
  <dt>
    <p><strong>-r</strong></p>
  </dt>
  <dd>
    <p>Recursively reconstruct all sub-mailboxes of the mailboxes or mailbox prefixes given as arguments.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>Examine the filesystem underneath mailbox, adding all directories with a cyrus.header found there as new mailboxes.  Useful for restoring mailboxes from backups.</p>
  </dd>
  <dt>
    <p><strong>-s</strong></p>
  </dt>
  <dd>
    <p>Don't stat underlying files.  This makes reconstruct run faster, at the expense of not noticing some issues (like zero byte files or size mistmatches).  "reconstruct -s" should be quite fast.</p>
  </dd>
  <dt>
    <p><strong>-n</strong></p>
  </dt>
  <dd>
    <p>Don't make any changes.  This gives equivalent behaviour to <em>chk_cyrus</em> where problems are reported, but not fixed.</p>
  </dd>
  <dt>
    <p><strong>-G</strong></p>
  </dt>
  <dd>
    <p>Force re-parsing of the underlying message (checks GUID correctness). Reconstruct with -G should fix all possible individual message issues, including corrupted data files.</p>
  </dd>
  <dt>
    <p><strong>-R</strong></p>
  </dt>
  <dd>
    <p>Perform a UID upgrade operation on GUID mismatch files.  Use this option if you think your index is corrupted rather than your message files, or if all backup attempts have failed and you're happy to be served the missing files.</p>
  </dd>
  <dt>
    <p><strong>-U</strong></p>
  </dt>
  <dd>
    <p>Use this option if you have corrupt message files in your spool and have been unable to restore them from backup.  This will make the mailbox IOERROR free and fix replication. <strong>WARNING</strong> this deletes corrupt message files for ever - so make sure you've exhausted other options first!</p>
  </dd>
  <dt>
    <p><strong>-o</strong></p>
  </dt>
  <dd>
    <p>Ignore odd files in your mailbox disk directories.  Probably useful if you are using some tool which adds additional tracking files.</p>
  </dd>
  <dt>
    <p><strong>-O</strong></p>
  </dt>
  <dd>
    <p>Delete odd files.  This is the opposite of '-o'.</p>
  </dd>
  <dt>
    <p><strong>-m</strong></p>
  </dt>
  <dd>
    <p><strong>NOTE: CURRENTLY UNAVAILABLE</strong></p><p>Rebuild the <em>mailboxes</em> file.  Use whatever data in the existing <em>mailboxes</em> file it can scavenge, then scans all partitions listed in the <a href="../man5/imapd.conf.5.html"><strong>imapd.conf</strong>(5)</a> file for additional mailboxes.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>You want to reconstruct the index files for a user, you have recovered a deleted mail file from backup and given it a suitable name (eg user/ben-lacy/33.), but it is not visible since it is not indexed:</p>
<pre>
reconstruct -r user.ben-lacy
</pre>
<p>If you have the <strong>unixhierarchysep:yes</strong> option set in <strong>/etc/imapd.conf</strong> you would need to run:</p>
<pre>
reconstruct -r user/ben.lacy
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>/etc/imapd.conf</strong></p>
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cyrus-quota.8.html"><span aria-hidden="true">&larr;</span> cyrus-quota.8: Report and optionally fix quota usage</a></li>
   <li class="next"><a href="cyrus-squatter.8.html">cyrus-squatter.8: Create squat indexes for mailboxes <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
