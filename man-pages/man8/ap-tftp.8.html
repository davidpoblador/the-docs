<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ap-tftp: Tftp client for upgrading atmel at76c510 wisoc-based aps</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Tftp client for upgrading atmel at76c510 wisoc-based aps">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ap-tftp (8) manual">
  <meta name="twitter:description" content="Tftp client for upgrading atmel at76c510 wisoc-based aps">
  <meta name="twitter:image" content="https://www.carta.tech/images/ap-utils-ap-tftp-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/ap-tftp.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ap-tftp (8) manual" />
  <meta property="og:description" content="Tftp client for upgrading atmel at76c510 wisoc-based aps" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ap-utils-ap-tftp-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ap-tftp<small> (8)</small></h1>
        <p class="lead">Tftp client for upgrading atmel at76c510 wisoc-based aps</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/ap-tftp.8.html">
      <span itemprop="name">ap-tftp: Tftp client for upgrading atmel at76c510 wisoc-based aps</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ap-utils/">
      <span itemprop="name">ap-utils</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/ap-tftp.8.html">
      <span itemprop="name">ap-tftp: Tftp client for upgrading atmel at76c510 wisoc-based aps</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>ap-tftp</strong> <strong>-i</strong> <em>IP</em> <strong>-f</strong> <em>firmware.rom</em> <strong>[-c</strong> <em>community</em> <strong>]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>ap-tftp</strong> utility is used to upgrade or downgrade firmware in Access Points based on ATMEL AT76C510 VNET-B WiSOC (Wireless System On Chip). It should work for most (if not all) models with INTERSIL radio chipset, as well as those based on RFMD radio. However, so far it has only been tested on the following hardware: WLink WEN-2021, i-Tec AP GOLD, smartBridges airPOINT PRO (all with INTERSIL radio), and Tellus A14 (RFMD radio). If you have an AP with ATMEL AT76C510 and either INTERSIL or RFMD radio chipset, there's near 100% chance it will work for you, too.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PREFACE: FIRMWARE TYPES</h2>
        <div class="sectioncontent">
<p>Functionally, there basically exist 2 types of firmware for ATMEL-based APs: an " <strong>Access Point</strong> firmware (often referred to as <strong>AP firmware</strong> ), and <strong>Wireless Adapter</strong> firmware (referred to as <strong>WA firmware</strong> ). Many hardware vendors produce their own more or less modified firmware derivatives, but usually they keep up with the naming scheme introduced by ATMEL:</p><h3>APs with INTERSIL radios</h3>
<p>For APs with INTERSIL radios, the AP firmware file typically uses naming scheme such as "1.4x.y.rom" (for example "1.4j.1.rom", "1.4k.2.rom", etc.), while the WA firmware files typically exist under names such as "0.01.ab.rom" (for example "0.01.09.rom", "0.01.11.rom", etc.). The values "x", "y", and "ab" indicate the firmware revision.</p>
<h3>APs with RFMD radios</h3>
<p>For APs with RFMD radios, the AP firmware files are known under names like "0.2.x.yz.rom" (such as "0.2.2.11.rom", "0.2.2.18.rom", etc.), while the WA firmware uses names as "0.3.b.c.rom" (for example "0.3.2.5.rom", "0.3.2.6.rom"), or "0.4.b.c.rom" for WA+ firmware (which is a variant of WA firmware that offers limited multiple MACs transparency in client mode) - for example "0.4.2.7.rom". Again, the numbers change according to the firmware revision.</p><p>To descend in even greater complexity, there usually exist 2 files for each firmware revision in the ATMEL+RFMD world: one so-called <strong>primary firmware</strong> (the bigger file of the two; it contains base firmware as well as the embedded webserver), and a second file with so-called <strong>backup firmware</strong> (the smaller file of the two, it contains just the base firmware). The name of secondary firmware always uses '0' in the third number field (such as "0.2.0.18.rom"). <strong>You'll always need to upgrade with backup firmware FIRST, unless its manufacturer states otherwise.</strong></p>
<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    
  </dd>

</dl>
<p><strong>WARNING!!! WARNING!!! WARNING!!! WARNING!!! WARNING!!!</strong></p><ul>
<li><p><strong>WA firmwares</strong> and their derivatives <strong>ARE _NOT_ SUPPORTED</strong> by ap-utils!!! They may appear to partially work with ap-utils, but you can cause harm to your AP if you use ap-config with such firmware. Do not complain if you use ap-config with such firmware and it damages your AP!</p></li><li><p>Since some hardware vendors keep up the bad habit of producing their own firmwares using the original ATMEL firmware naming scheme, it is easy to find firmwares from different hardware vendors for ATMEL-based APs with <strong>exactly the same name and sometimes even the length</strong> (for example, firmware "1.4j.1.rom" exists in many incarnations, but their content differs). They may use different structures and offsets for reading configuration data in the flash memory without content validity checks, so <strong>NEVER EVER USE FIRMWARE FROM ANOTHER HARDWARE VENDOR THAN THE ONE THAT IS MANUFACTURING YOUR AP, UNLESS EXPLICITLY STATED OTHERWISE! IF YOU DO SO, YOU MAY IRREVERSIBLY DAMAGE YOUR AP!</strong></p></li><li><p>BEWARE! AP boards from several vendors may contain hardware design bugs, that will totally prevent it from successfull upgrade. <strong>Any attempt to upgrade such device, either via TFTP or DFU utility will fail and irreversibly damage content of its flash memory! If your vendor does NOT provide ANY firmware nor tools to perform upgrade for your device, it means (unless stated otherwise), that IT IS UNSAFE TO TRY UPGRADING and YOU SHOULD NOT ATTEMPT TO UPGRADE YOUR DEVICE AT ALL!</strong> Example of such board with bug in hardware design is Tellus A13 (also sold as i-Tec AP GOLD with blue front).</p></li><li><p>ATMEL AT76C510-based APs are notoriously known for their firmware upgrade design flaw: firmware validation checks and subsequent permission for upgrade are not performed by the AP itself, but in the TFTP upgrade client. This means that anyone with proper TFTP client, having access to your AP via its ethernet port, may _try_ to upload incorrect firmware (or even no-firmware file!) to your AP, causing irreversible damage to your AP. Hence:</p><ul>
<li><p><strong>SECURE YOUR AP ON IP (LAYER 3) BASIS! SET UP YOUR AP (AND ITS WIRELESS CLIENTS) WITH IP FROM A DIFFERENT IP SEGMENT THAN THE ONE IT IS PHYSICALLY ON. TO ACCESS AP ON SUCH DIFFERENT SEGMENT, YOU MAY USE IP-ALIAS INTERFACE (on Linux).</strong></p></li><li><p><strong>FOR APs IN Access Point client MODE, USE ap-config AND IN 'Config -&gt; Bridge' MENU, CHANGE THE VALUE OF 'Configuration-enabled port(s):' TO 'Wireless'. THIS WAY, USER BEHIND Access Point client DEVICE WONT BE ABLE TO REACH ITS MANAGEMENT IP, AND SUBSEQUENTLY (S)HE WONT BE ABLE TO CAUSE ANY DAMAGE WITH TFTP.</strong> Note that setting Conf.-enabled port to 'Wireless' may be risky if you intend to reconfigure the device through Wireless media (bad values could be written to the AP due to wireless media unreliability). You should choose what is of greater risk for you.</p></li>
</ul><ul>
<li><p><strong>Users of ATMEL+INTERSIL devices:</strong> If your AP firmware vendor extensions are auto-detected as <strong>SBRIDGES</strong> by ap-config, it means that your AP uses firmware made by smartBridges PTE: you will need to pass extra '-c community' to ap-tftp in order to perform actual upgrade. <strong>BY ALL MEANS, AVOID UPGRADE OF DEVICE THAT CONTAINS smartBridges FIRMWARE, with non-smartBridges FIRMWARE, AND VICE VERSA, even if the firmware names may look similar (see the warning above).</strong> Although there are checks in ap-tftp, that should avoid something such, be careful, and DO NOT TRY, UNDER ANY CIRCUMSTANCES, to circumvent this protection - if you do, you'd most likely end up with damaged flash content in your device. You got the warning.</p></li>
</ul>
<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    <p>Remember: All firmware files with revision "1.4j.4" onwards are from smartBridges: unless you possess a device that is autodetected with 'SBRIDGES' vendor extension, DO NOT TRY TO UPGRADE TO smartBridges FIRMWARE!</p><ul>
<li><p><strong>Users of ATMEL+RFMD devices:</strong> If you are running <strong>primary</strong> firmware &lt; 0.2.2.20, you <strong>should upgrade as soon as possible! AP</strong> firmware of version 0.2.2.19 and lower contains serious 'death by reconfiguration' bug, which, if triggered, may irreversibly damage content in flash memory of your AP. The event to trigger is usually changing & writing some settings in the 'Bridge' menu. So if you run such firmware, please upgrade. You may also look into README to see whether 'Firmware available free of charge for ATMEL12350 MIB devices' (section) applies to your AP.</p></li>
</ul>
  </dd>
  <dt>
    
  </dt>
  <dd>
    
  </dd>

</dl>
<p><strong>GENERAL HINTS AND RECOMMENDATIONS PRIOR UPGRADING</strong></p><ul>
<li><p>IF POSSIBLE, PLACE YOUR AP BEHIND A FIREWALL SO THAT YOU PREVENT ACCESS TO ITS MANAGEMENT IP FOR UNWANTED THIRD PARTIES</p></li><li><p>Avoid upgrading your AP via its wireless port, if possible. Due to the unreliable nature of wireless media and UDP protocol used for upgrade, anything could happen - although there is CRC-like check in the firmware, that prevents flashing of (firmware) file that has possibly been altered during transmission, upgrade process interruption might cause damage (but even this is not very likely). You may upgrade AP via its wireless port only if you're 101% sure the wireless connection to the target device is reliable.</p></li><li><p>If you experience upgrade timeout in the 'middle' of the upgrade progress, it is usually ok to wait until the utility completely times out, and repeat the command afterwards. You may also experience 'catch up' (very short network break, so utility will resume uploading firmware to your AP).</p></li><li><p>In case when firmware upgrade fails, <strong>ap-tftp</strong> will show an error code returned by the TFTP server in AP. Note that although RFC 1350 defines 8 TFTP error messages, the TFTP server in the AP is not compliant to this RFC and the error codes returned may NOT correspond to those messages (but ap-tftp will always display corresponding RFC-defined error message, if possible, although it may really have nothing to do with the returned error code meaning). In the case the message for error code returned is not defined in RFC 1350, just the error code alone will be displayed.</p></li><li><p>If you want to upgrade firmware in an AP on a network where no DHCP server is available, it is advisable to assign static IP address and disable DHCP option on the device, so that you can verify, whether it is alive, using 'ping' command immediately after the upgrade succeeds (generally immediately after the device boots up), and you dont have to wait until AP's attempts to contact DHCP server time out. This is also especially useful if you need to do 2-step upgrade (using 'backup' and 'primary' firmware) - see above.</p></li><li><p>Firmware of APs based on ATMEL AT76C510 provides an interresting 'arp ping' feature. After AP boot-up, it is possible to remotely and TEMPORARILY (to next AP reboot) reconfigure its IP address, provided that within certain time period (several tens of seconds after boot-up), the AP receives ICMP ECHO request with target MAC address equal to its own. To set up IP in the AP using this method, do the following:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>From the IP range your AP is connected to, pick up an unused IP you want to set on the AP using 'arp ping'.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>Set up static ARP entry associating the MAC address of your AP with the IP you selected in paragraph 1. Typically, you need to issue (as root) something like: 'arp -s required_AP_IP AP_MAC'. Consult manpage for 'arp' utility, if your 'arp' utility uses different syntax.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>Right after the AP boots, run 'ping required_AP_IP'. You need to wait few seconds prior seeing first AP response.</p>
  </dd>

</dl>
<ul>
<li><p><strong>Users of ATMEL+RFMD devices:</strong> To <strong>DOWNGRADE</strong> to <strong>AP</strong> firmware with lower revision number than the one thats currently in the device, you'll need to temporarily 'upgrade' to any <strong>WA</strong> firmware available for your device (as step-in-the-middle). This will 'unlock' your device for downgrading to previous <strong>AP</strong> firmware version.</p></li>
</ul></li>
</ul></li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-i IP</strong></p>
  </dt>
  <dd>
    <p>IP address of the AP you want upgrade firmware in.</p>
  </dd>
  <dt>
    <p><strong>-f firmware.rom</strong></p>
  </dt>
  <dd>
    <p>Full path to and name of the firmware file for your AP.</p>
  </dd>
  <dt>
    <p><strong>-c community</strong></p>
  </dt>
  <dd>
    <p>To be used ONLY with APs manufactured by smartBridges PTE. The given community must match with any of three three communities currently defined in the AP configuration - firmware upgrade will be allowed only upon the match. matches</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES OF USE</h2>
        <div class="sectioncontent">
<h3>Upgrading AP firmware in a device with INTERSIL radio and non-smartBridges firmware</h3>

<dl class='dl-vertical'>
  <dt>
    <p>ap-tftp -i 192.168.0.1 -f 1.4j.3.rom</p>
  </dt>
  <dd>
    
  </dd>

</dl>

<h3>Upgrading AP firmware in a device with INTERSIL radio and smartBridges firmware</h3>

<dl class='dl-vertical'>
  <dt>
    <p>ap-tftp -i 192.168.0.24 -f 1.4k.5.rom -c private</p>
  </dt>
  <dd>
    
  </dd>

</dl>

<h3>Upgrading AP firmware in a device with RFMD radio:</h3>

<dl class='dl-vertical'>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.2.0.20.rom</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.2.2.20.rom</p>
  </dt>
  <dd>
    
  </dd>

</dl>

<h3>Downgrading AP firmware in a device with RFMD radio:</h3>

<dl class='dl-vertical'>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.3.0.6.rom</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.3.2.6.rom</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.2.0.19.rom</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>ap-tftp -i 192.168.1.100 -f 0.2.2.19.rom</p>
  </dt>
  <dd>
    
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">KNOWN BUGS</h2>
        <div class="sectioncontent">
<p>This utility has not been verified on and will probably not work on big-endian architectures. Its use is discouraged in such environment.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jan Rafaj &lt;jr-aputils at cedric dot unob dot cz&gt;</p><p>http://ap-utils.polesye.net</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ap-tftp&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/ap-config.8.html"><strong>ap-config</strong>(8)</a>, <a href="../man8/ap-trapd.8.html"><strong>ap-trapd</strong>(8)</a>, <a href="../man8/ap-auth.8.html"><strong>ap-auth</strong>(8)</a>, <a href="../man8/ap-mrtg.8.html"><strong>ap-mrtg</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ap-rrd.8.html"><span aria-hidden="true">&larr;</span> ap-rrd.8: Ap statistics translators</a></li>
   <li class="next"><a href="ap-trapd.8.html">ap-trapd.8: A snmp trap processing daemon <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
