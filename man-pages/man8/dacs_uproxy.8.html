<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dacs_uproxy: Minimal http proxying</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Minimal http proxying">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dacs_uproxy (8) manual">
  <meta name="twitter:description" content="Minimal http proxying">
  <meta name="twitter:image" content="https://www.carta.tech/images/dacs-dacs_uproxy-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/dacs_uproxy.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dacs_uproxy (8) manual" />
  <meta property="og:description" content="Minimal http proxying" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dacs-dacs_uproxy-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dacs_uproxy<small> (8)</small></h1>
        <p class="lead">Minimal http proxying</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dacs_uproxy.8.html">
      <span itemprop="name">dacs_uproxy: Minimal http proxying</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dacs/">
      <span itemprop="name">dacs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/dacs_uproxy.8.html">
      <span itemprop="name">dacs_uproxy: Minimal http proxying</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dacs_uproxy</strong> [<em>\m[blue]</em><strong>dacsoptions</strong>\m[]\s-2\u[1]\d\s+2]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This web service is part of the <strong>DACS</strong> suite.</p><p>The <strong>dacs_uproxy</strong> web service accepts an incoming HTTP request (the initial request), then reissues a nearly identical HTTP request to a different URL (the proxied request) and returns its unaltered response. The initial request must use either the GET or POST HTTP method; the proxied request will use the same method as the initial request. Note that the origin server (the web server that receives the proxied request) will see a request that originates at the host that runs <strong>dacs_uproxy</strong>, not the host that issues the initial request.</p><p>When run on a firewall host, the program can be useful for forwarding incoming requests to interior hosts. An origin server does not need to be running <strong>DACS</strong>. All access control is performed by the jurisdiction that runs <strong>dacs_uproxy</strong>. Similarly, the program can be useful for forwarding requests that originate behind the firewall, subject to access control permission.</p><p><strong>dacs_uproxy</strong> is not a transparent proxy server. A request URL must be explicitly addressed to it and include a (partial) name for the target resource.</p><p><strong>Security</strong></p><p>The program must be configured with care because it can expose otherwise inaccessible hosts to arbitrary HTTP requests from any source that can connect to <strong>dacs_uproxy</strong>.</p><p>Particular care must be taken if a program that is invoked by <strong>dacs_uproxy</strong> generates a redirect that may be handled internally by the program&apos;s web server. In this event the new request arising from the redirection <em>will not automatically be subjected to access control</em> because the new request does come through <strong>dacs_uproxy</strong>. Therefore, local redirects must be avoided by proxied web services, resources that might be invoked through a local redirect must be publicly accessible, or authorization checking must somehow be arranged for these resources.</p><p>Access control rules are primarily responsible for expressing restrictions on what can be proxied and who can use this service. By default, all access to this service is denied. Additionally, \m[blue]<strong>UPROXY_APPROVED</strong>\m[]\s-2\u[2]\d\s+2 directives must be configured to allow proxying to specific origin servers.</p><p>Although in its current form the program has the effect of anonymizing the proxied request, this is more of a bug than a feature. Future versions may forward an initial request&apos;s headers and other information.</p><p>With the exception of the Cookie header, most request headers that accompany the initial request are sent with the proxied request. <strong>dacs_uproxy</strong> makes no attempt to "impersonate" the user&apos;s host, however. Therefore, to the origin server it appears as if the request is coming from <strong>dacs_uproxy</strong> and the IP address from which the forwarded request is sent. Any cookies sent with the initial request are interpreted by <strong>dacs_uproxy</strong> (e.g., to identify the user making the request for access control purposes). At present, it is not possible to forward cookies with the proxied request.</p><p>So that the proxied web service can tell that it is being invoked by <strong>dacs_uproxy</strong>, an extension header named DACS-Uproxy-Via is included with the forwarded request. Its value is the URL of <strong>dacs_uproxy</strong> with the proxied host appended. With Apache, its value can be accessed from the environment variable <strong>HTTP_DACS_UPROXY_VIA</strong>.</p><p>If <strong>dacs_uproxy</strong> is passed a \m[blue]<strong>DACS_APPROVAL</strong>\m[]\s-2\u[3]\d\s+2 value, that value is forwarded with the request through the DACS-Uproxy-Approval header and made available by Apache in the <strong>HTTP_DACS_UPROXY_APPROVAL</strong> environment variable. A program invoked indirectly through <strong>dacs_uproxy</strong> can use this information to confirm that <strong>DACS</strong> authorized the request.</p><p>If the forwarded request generates a redirect (a 3xx class HTTP status code is returned), it causes <strong>dacs_uproxy</strong> to return the redirection request.</p><p>The program is a minimal or "micro" HTTP proxy, hence the <em>u</em> in <strong>dacs_uproxy</strong> should really be the Greek letter <em>mu</em>.</p><h3>Web Service Arguments</h3>
<p>With some exceptions, all arguments passed to <strong>dacs_uproxy</strong> are forwarded to the proxied request and are not interpreted by <strong>dacs_uproxy</strong>. The first exception is \m[blue]<strong>DACS_ACS</strong>\m[]\s-2\u[4]\d\s+2. Another exception is <em>DACS_UPROXY</em>; if its value is DEBUG, debugging output is produced. Neither of these arguments is forwarded with the proxied request.</p>
<h3>Operation</h3>
<p>A specification of the proxied request appears as a component of the initial request. It is best to explain this with an example. Let us assume that the URL for the <strong>dacs_uproxy</strong> that the client wants to use is https://example.com/cgi-bin/dacs/dacs_uproxy. Let us also assume that the client wants to access a web service at foo.example.com (the proxied host) and that this web service can be invoked from example.com (the proxying host) as https://foo.example.com/cgi-bin/some_app. To achieve this, the client would invoke this URL:</p>
<pre>
https://example.com/cgi-bin/dacs/dacs_uproxy/foo.example.com/cgi-bin/some_app
</pre>
<p>Note that no scheme is included with the name of the proxied host. A port number may follow it, however, and any path components that follow are appended (after the mapping specified by UPROXY_APPROVED) to form the final proxied URL.</p><p>For this example to be authorized, an access control rule must grant the user access to the initial URL. Whether there is additional access control enforced at the proxied host is the responsibility of a web administrator. A simple rule that grants access to any authenticated user looks like this:</p>
<pre>
&lt;acl_rule status="enabled"&gt;
  &lt;services&gt;
    &lt;service url_expr=&apos;"${Conf::dacs_cgi_bin_prefix}/dacs_uproxy"&apos;/&gt;
    &lt;service url_expr=&apos;"${Conf::dacs_cgi_bin_prefix}/dacs_uproxy/*"&apos;/&gt;
  &lt;/services&gt;

  &lt;rule order="allow,deny"&gt;
   &lt;allow&gt;
     user("auth")
   &lt;/allow&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>Most sophisticated rules may of course be used to further constrain how <strong>dacs_uproxy</strong> can be used and by whom.</p><p>The \m[blue]<strong>UPROXY_APPROVED</strong>\m[]\s-2\u[2]\d\s+2 directive must be configured before <strong>dacs_uproxy</strong> will do anything, even if otherwise permitted by an access control rule.</p><p>If SSL is used for the proxied request, the usual <strong>DACS</strong> configuration directives for SSL apply - see \m[blue]<strong>dacs.conf</strong>(5)</strong>\m[]\s-2\u[5]\d\s+2. SSL can be used for the proxied request independently of whether it is used for the initial request.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>The program exits 0 if everything was fine, 1 if an error occurred.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The implementation may not yet fully conform to \m[blue]<strong>RFC 2616</strong>\m[]\s-2\u[6]\d\s+2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dacs_uproxy&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong>RFC 2616</strong>\m[]\s-2\u[6]\d\s+2</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Distributed Systems Software (\m[blue]<strong>www.dss.ca</strong>\m[]\s-2\u[7]\d\s+2)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYING</h2>
        <div class="sectioncontent">
<p>Copyright2003-2012 Distributed Systems Software. See the \m[blue]<strong>LICENSE</strong>\m[]\s-2\u[8]\d\s+2 file that accompanies the distribution for licensing information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>dacsoptions</p><p>http://dacs.dss.ca/man/dacs.1.html#dacsoptions</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p>UPROXY_APPROVED</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#UPROXY_APPROVED</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p>DACS_APPROVAL</p><p>http://dacs.dss.ca/man/dacs_acs.8.html#dacs_approval</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p>DACS_ACS</p><p>http://dacs.dss.ca/man/dacs_acs.8.html#dacs_acs_argument</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><strong>dacs.conf</strong>(5)</p><p>http://dacs.dss.ca/man/dacs.conf.5.html</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p>RFC 2616</p><p>http://www.rfc-editor.org/rfc/rfc2616.txt</p>
  </dd>
  <dt>
     7.
  </dt>
  <dd>
    <p>www.dss.ca</p><p>http://www.dss.ca</p>
  </dd>
  <dt>
     8.
  </dt>
  <dd>
    <p>LICENSE</p><p>http://dacs.dss.ca/man/../misc/LICENSE</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dacs_transform.8.html"><span aria-hidden="true">&larr;</span> dacs_transform.8: Rule-based document transformation</a></li>
   <li class="next"><a href="dacs_version.8.html">dacs_version.8: Display dacs version information <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
