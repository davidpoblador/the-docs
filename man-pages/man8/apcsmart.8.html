<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>apcsmart: Driver for american power conversion smart protocol ups equipment</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Driver for american power conversion smart protocol ups equipment">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="apcsmart (8) manual">
  <meta name="twitter:description" content="Driver for american power conversion smart protocol ups equipment">
  <meta name="twitter:image" content="https://www.carta.tech/images/nut-server-apcsmart-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/apcsmart.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="apcsmart (8) manual" />
  <meta property="og:description" content="Driver for american power conversion smart protocol ups equipment" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/nut-server-apcsmart-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">apcsmart<small> (8)</small></h1>
        <p class="lead">Driver for american power conversion smart protocol ups equipment</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/apcsmart.8.html">
      <span itemprop="name">apcsmart: Driver for american power conversion smart protocol ups equipment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/nut-server/">
      <span itemprop="name">nut-server</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/apcsmart.8.html">
      <span itemprop="name">apcsmart: Driver for american power conversion smart protocol ups equipment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>apcsmart</strong> -h</p><p><strong>apcsmart</strong> -a &apos;UPS_NAME&apos; [-x option=value ...]</p><p><strong>Note</strong></p><p>This man page only documents the hardware-specific features of the apcsmart driver. For information about the core driver, see <a href="../man8/nutupsdrv.8.html"><strong>nutupsdrv</strong>(8)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORTED HARDWARE</h2>
        <div class="sectioncontent">
<p>The apcsmart driver should recognize (or at the very least work with) majority of Smart-UPS models - which includes Smart-UPS, Matrix-UPS and Back-UPS lineups, among few other ones.</p><p>Currently we can roughly divide APC hardware into 3 groups (note that the division isn&apos;t strict by any means, and the borders between those are pretty fuzzy):</p><p>[very] "old" models</p><p>These models usually have old APC logo, white color and <em>no</em> programmable eeprom; You won&apos;t find them listed anywhere on APC\(cqs site either. The support for those will be usually based on driver&apos;s compatibility tables, or if the model (firmware) is not listed in those - the driver will try to follow the very basic subset of features, while still trying to remain useful. Despite "smart" tagname, they often tend to behave in pretty dumb way (see the section below about shutdown behaviour).</p><p><strong>Example models:</strong></p><p>Smart-UPS 2000I</p><p>Smart-UPS 900I</p><p>"new" models</p><p>These models usually come from late 1990s / pre-2009 times. They are often referred as "3rd. gen". For the most part, they have programmable eeprom, report supported commands and capabilites, and should work just fine with the apcsmart driver.</p><p>"microlink" models</p><p>WARNING: these are not <em>natively</em> supported by apcsmart (or apcupsd for that matter, if you\(cqre wondering). Around 2007 APC (now APC Schneider) decided to go back to its proprietry roots and all the new models (SMT, SMX, SURTD) use completely different protocol and cables. If you purchased a new APC UPS, that uses cable with rj45 on the one end, and db-9 on the other - then you have such model. Your only option to support it through <strong>NUT</strong> is to purchase "legacy communications card" - part #AP9620 (google &apos;AP9620&apos; for more details). Or if that&apos;s not an option, rely on official software.</p><p>Another thing to remember is that Smart protocol is not USB protocol. If you have UPS with both USB and serial ports, then depending on how you connect it, you will need either apcsmart or usbhid-ups driver.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CABLING</h2>
        <div class="sectioncontent">
<p>This driver expects to see a 940-0024C cable or a clone by default. You can switch to the 940-0095B dual-mode cable support with the &apos;cable=&apos; definition described below.</p><p>If your 940-xx24X cable is broken or missing, use this diagram to build a clone:</p><p>http://www.networkupstools.org/cables.html#_940_0024c_clone</p><p><strong>Note</strong></p><p>The "xx" is either "00" for a short cable, or the number of feet of a longer cable. The "X" is a letter representing the minor revision of the physical cable and its connectors ("C" and "E" are commonly found revisions). All minor revisions should use the same pin-outs and wiring.</p><p>You can specify alternate cable in <a href="../man5/ups.conf.5.html"><strong>ups.conf</strong>(5)</a>:</p><p><strong>cable</strong>=940-0095B</p><p>Alternatively, you can also provide it on the command line using:</p><p>-x <strong>cable</strong>=940-0095B</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TTY MODES</h2>
        <div class="sectioncontent">
<p>By default the driver works in canonical mode, but it showed to be a problem in windows systems. Furthermore there\(cqs a possibility of some obscure serial cards or serial-usb convertes that could cause problems as well. You can use &apos;ttymode=&apos; option to force non-canonical discipline in <a href="../man5/ups.conf.5.html"><strong>ups.conf</strong>(5)</a>:</p><p><strong>ttymode</strong>=raw</p><p>Alternatively, you can also provide it on the command line using:</p><p>-x <strong>ttymode</strong>=raw</p><p><strong>Note</strong></p><p>Any other value will make the driver work in the canonical mode.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPLANATION OF SHUTDOWN METHODS SUPPORTED BY APC UPSES</h2>
        <div class="sectioncontent">
<p>APC hardware supports a lot of shutdown methods, that themselves can differ in behaviour quite a bit, depending on the model.</p><p><strong>S</strong> (soft hibernate)</p><p>This is most basic command present in probably all APC models. It will hibernate the UPS, and subsequently wake it up when the mains supply returns. <strong>The command doesn&apos;t work if UPS is running on mains.</strong></p><p>"old" models</p><p>The behaviour here is unfortunately pretty primitive - when the power returns, the UPS just wakes up. No grace periods, no min. battery charge condition, etc. This is probably not what you want.</p><p>"new" models</p><p>The behaviour here is as expected - the power is cut off after the eeprom defined grace period. The UPS will wake up when the power returns, after the eeprom defined delay AND if the eeprom defined min. battery charge level is met. The delay is counted from the power&apos;s return.</p><p><strong>CS</strong> (aka "force OB hack")</p><p>This is a trick to make UPS power down even if it&apos;s running on mains. Immediately before issuing <strong>S</strong>, "simulate power failure" is issued. The remaining behaviour is as in <strong>S</strong> case.</p><p>The name came from APC CS models, where such trick was used to power down UPSes in consistent fashion using only <strong>S</strong>. It&apos;s better to use <strong>@nnn</strong> command if your UPS supports it (and is not too old, see below).</p><p><strong>@nnn</strong> (hard hibernate)</p><p>This is basic command used to hibernate UPS regardless if it&apos;s running on batteries or on mains. The option takes 3 digits argument which can be used to specify additional wakeup delay (in 6 minute units).</p><p>"old" models</p><p>The behaviour is - unfortunately - similary primitive to <strong>S</strong>. The UPS unconditionally wakes up after nnn*6 minutes - <strong>it doesn&apos;t care if the power returned !</strong> If nnn = 000, then UPS will do precisely nothing. On those models you&apos;re better specifying nnn &gt; 0, if you can estimate the kind of power problems that might be happening in your environment. Another thing to consider with "old" models - you might lose the connection with the UPS, until it wakes up (with <strong>S</strong>, the serial connection is kept alive).</p><p>"new" models</p><p>All the usual variables defined in eeprom are respected (see <strong>S</strong>). Additionally, if nnn &gt; 0, the nnn*6 minutes are added to eeprom defined delay. UPS will not power up if it&apos;s running on batteries, contrary to what "old" models used to do - the combined delay is counted from the moment of power return.</p><p>Supposedly there exist models that take 2 digits instead of 3. Just in case, NUT also supports such variation. You have to provide exactly 2 digits to trigger it (<strong>awd</strong> option, or argument to one of the supported instant commands).</p><p><strong>K</strong> (delayed poweroff)</p><p>This is permanent poweroff - the UPS will not wake up automatically. On newer units, it will respect applicable eeprom variables.</p><p><strong>Z</strong> (instant poweroff)</p><p>This is also permanent poweroff - the UPS will not wake up automatically. The poweroff is executed immediately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SHUTDOWN CONTROL BY NUT</h2>
        <div class="sectioncontent">
<p>There are three options used to control the shutdown behaviour.</p><p><strong>sdtype</strong>=[0-5]</p><p>This option takes a single digit (0-5) as an argument. See below for details.</p><p><strong>advorder</strong>=no|[0-4]+</p><p>This option takes string of digits as an argument. Methods listed are tried in turn until one of them succeedes. Note that the meaning of digits is different from <strong>sdtype</strong>. See below for details.</p><p><strong>awd</strong>=[0-9]{1,3}</p><p>This option lets you specify additional wakeup delay used by <strong>@</strong>. If you provide exactly 2 digits, the driver will try 2 digits variation (see previous section for more info). Otherwise standard 3 digits variation is used. <strong>Note: the time unit is 6 minutes !</strong></p><p>Keep in mind that <strong>sdtype</strong> and <strong>advorder</strong> are mutually exclusive. If <strong>advorder</strong> is provided, <strong>sdtype</strong> is ignored. If <strong>advorder</strong> is set to &apos;no&apos;, <strong>sdtype</strong> is used instead.</p><p>If nothing is provided, <strong>NUT</strong> will assume <strong>sdtype</strong>=0 - which is generally fine for anything not too ancient or not too quirky.</p><h3>SDTYPE</h3>
<p>The values permitted are from 0 to 5. Only one can be specified. Anything else will cause apcsmart to exit.</p><p>0</p><p>issue soft hibernate (<strong>S</strong>) if the UPS is running on batteries, otherwise issue hard hibernate (<strong>@</strong>)</p><p>1</p><p>issue soft hibernate (<strong>S</strong>) (if on batteries), and if it fails (or on mains) - try hard hibernate (<strong>@</strong>)</p><p>2</p><p>issue instant poweroff (<strong>Z</strong>)</p><p>3</p><p>issue delayed poweroff (<strong>K</strong>)</p><p>4</p><p>issue "force OB hack" (<strong>CS</strong>)</p><p>5</p><p>issue hard hibernate (<strong>@</strong>)</p><p><strong>Note</strong></p><p>Hard hibernate&apos;s additional wakeup delay can be provided by <strong>awd</strong>.</p>
<h3>ADVORDER</h3>
<p>The argument is either a word &apos;no&apos;, or a string of 1 - 5 digits in [0 - 4] range. Each digit maps to the one of shutdown methods supported by APC UPSes. Methods listed in this way are tried in order, until one of them succedes.</p><p>If <strong>advorder</strong> is undefined or set to &apos;no&apos;, <strong>sdtype</strong> is used instead.</p><p>The mapping is as follows:</p><table class="table table-striped">
<tr>
<th>  0 </th>
<th>  soft hibernate (<strong>S</strong>) </th></tr>

<tr>
<td>  1 </td>
<td>  hard hibernate (<strong>@</strong>) </td></tr>

<tr>
<td>  2 </td>
<td>  delayed poweroff (<strong>K</strong>) </td></tr>

<tr>
<td>  3 </td>
<td>  instant poweroff (<strong>Z</strong>) </td></tr>

<tr>
<td>  4 </td>
<td>  "force OB hack" (<strong>CS</strong>) </td></tr>
</table><p><strong>Note</strong></p><p>Hard hibernate&apos;s additional wakeup delay can be provided by <strong>awd</strong>.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IGNORING LB STATE</h2>
        <div class="sectioncontent">
<p>APC units - even if they report LB mode - will not go into shutdown automatically. This gives us even more control with reference to "when to actually shutdown psu". Since version 2.6.2, NUT supports <strong>ignorelb</strong> option in driver&apos;s section of <a href="../man5/ups.conf.5.html"><strong>ups.conf</strong>(5)</a>. When such option is in effect, the core driver will ignore LB state as reported by specific driver and start shutdown basing the decision <em>only</em> on two conditions:</p><p>battery.charge &lt; battery.charge.low</p><p><strong>OR</strong></p><p>battery.runtime &lt; battery.runtime.low</p><p>Of course - if any of the variables are not available, the appropriate condition is not checked. If you want to explicitly disable one of the conditions, simply override the right hand variable causing the condition to always evaluate to false (you can even provide negative numbers).</p><p>APC UPSes don&apos;t have battery.charge.low - you will have to define it if you want to use such condition (prefix the variable with override. or default.).</p><p>"New" units have battery.runtime.low, but depending on battery quality, firmware version, calibration and UPS load - this variable can be underestimated quite a bit - especially right after going into OB state. This in turn can cause LB to be asserted, which under normal conditions will cause <strong>NUT</strong> to initiate the shutdown. You might want to disable this condition entirely, when relying on <strong>ignorelb</strong> option (this was actually the main motivation behind introduction of such feature).</p><p>Simple example:</p>
<pre>
[apc]
    ignorelb
    override.battery.charge.low = 15
    override.battery.runtime.low = -1
</pre>
<p>This would cause apcsmart to go into shutdown <em>only</em> if detected battery charge &lt; 15%. Runtime condition is always false in this example.</p><p>You could ask - why bother ? Well, the reason is already hinted above. APC units can be very picky about the batteries, and their firmware can underestimate the remaining runtime (especially right after going into OB state). <strong>ignorelb</strong> option and <strong>override.*</strong> let you remain in control of the UPS, not UPS in control of you.</p><p>Furthermore, this allows to specify conditions similary to how it\(cqs done in apcupsd daemon, so it should be welcome by people used to that software.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORTED INSTANT COMMANDS</h2>
        <div class="sectioncontent">
<p>The apcsmart driver exposes following instant commands:</p><p>shutdown.return</p><p>executes soft hibernate</p><p>shutdown.return cs</p><p>executes "force OB hack"</p><p>shutdown.return at:&lt;nbr&gt;</p><p>executes "hard hibernate" with &lt;nbr&gt;*6 minutes additional wakeup delay (&lt;nbr&gt; format is the same as of <strong>awd</strong> option)</p><p>shutdown.stayoff</p><p>executes "delayed poweroff"</p><p>load.off</p><p>executes "instant poweroff"</p><p>All the above commands must be issued 2nd time to have any effect (no less than 3 seconds, and no more than 15 seconds after the initial call). Those commands are mostly useful for manual testing, when your machine is not powered by the UPS you&apos;re testing.</p><p>Other supported commands:</p><p>load.on</p><p>test.panel.start</p><p>test.failure.start</p><p>test.battery.start</p><p>test.battery.stop</p><p>bypass.start</p><p>bypass.stop</p><p>calibrate.start</p><p>calibrate.stop</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PREVIOUS DRIVER VERSION</h2>
        <div class="sectioncontent">
<p>Previous driver is still available as apcsmart-old - should there be any need to use earlier version (bugs, incompatiblities with new functionality, etc.). In due time apcsmart-old will be phased out completely, but this won\(cqt happen until the new version gets solid exposure with no pending issues.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Some older APC UPS models return bogus data in the status register during a front panel test. This is usually detected and discarded, but some other unexpected values have occasionally slipped through.</p><p>APC UPS models with both USB and serial ports require a power cycle when switching from USB communication to serial, and perhaps vice versa.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Nigel Metheringham &lt;Nigel.Metheringham@Intechnology.co.uk&gt; (drawing heavily on the original apcsmart driver by Russell Kroll). This driver was called newapc for a time and was renamed in the 1.5 series. In 2.6.2 it was renamed to apcsmart-old, being superseded by updated version with new features, which is maintained by Michal Soltys &lt;soltys@ziu.info&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO apcsmart&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/nutupsdrv.8.html"><strong>nutupsdrv</strong>(8)</a>, <a href="../man5/ups.conf.5.html"><strong>ups.conf</strong>(5)</a></p><h3>Internet resources:</h3>
<p>The NUT (Network UPS Tools) home page: http://www.networkupstools.org/</p>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="apachectl.8.html"><span aria-hidden="true">&larr;</span> apachectl.8: Apache http server control interface</a></li>
   <li class="next"><a href="apcsmart-old.8.html">apcsmart-old.8: Driver for american power conversion smart protocol ups equipment <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
