<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tmpreaper: Removes files which haven't been accessed for a period of time</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Removes files which haven't been accessed for a period of time">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="tmpreaper (8) manual">
  <meta name="twitter:description" content="Removes files which haven't been accessed for a period of time">
  <meta name="twitter:image" content="https://www.carta.tech/images/tmpreaper-tmpreaper-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/tmpreaper.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="tmpreaper (8) manual" />
  <meta property="og:description" content="Removes files which haven't been accessed for a period of time" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/tmpreaper-tmpreaper-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">tmpreaper<small> (8)</small></h1>
        <p class="lead">Removes files which haven't been accessed for a period of time</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tmpreaper.8.html">
      <span itemprop="name">tmpreaper: Removes files which haven't been accessed for a period of time</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/tmpreaper/">
      <span itemprop="name">tmpreaper</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/tmpreaper.8.html">
      <span itemprop="name">tmpreaper: Removes files which haven't been accessed for a period of time</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>tmpreaper</strong> [-htvfmMsaT] [--help] [--test] [--verbose] [--force] [--delay=x] [--runtime=x] [--showdeleted] [--ctime] [--mtime] [--mtime-dir] [--symlinks] [--all] [[--protect '&lt;shell_pattern&gt;']...] &lt;time_spec&gt; &lt;dirs&gt;...</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>tmpreaper</strong> recursively searches for and removes files and empty directories which haven't been accessed for a given number of seconds. Normally, it's used to clean up directories which are used for temporary holding space, such as "/tmp".  Please read the <strong>WARNINGS</strong> section of this manual.</p><p>When changing directories, <strong>tmpreaper</strong> is very sensitive to possible race condition security exploits[1], and will exit with an error if one is detected.  It does not follow symbolic links in the directories it's cleaning (even if a symbolic link is given as its argument), never performs <strong>chdir("..")</strong>, will not switch file systems, and only removes empty directories and regular files. Unless your machine is one with lots of relatively untrusted users, such as an ISP or school, you don't need this program; `find ... -exec rm ...' works just as well when you don't have to be concerned about people trying to exploit the race condition on you.</p><p><strong>tmpreaper</strong> will stop itself after almost one minute with an appropriate warning message, as attempts to keep it running long enough so that it runs in parallel with another instance of itself may also lead to possible vulnerabilities. Normally, <strong>tmpreaper</strong> won't need that amount of time. If your system is so slow that it does, try to configure things so that this doesn't happen. As a last resort, the <strong>--runtime=x</strong> option can be used to set the number of seconds after which the timeout occurs; the default setting is 55 seconds.</p><p><strong>tmpreaper</strong> dates files by their <em>atime</em>, not their <em>mtime</em>, unless you select the <strong>--mtime</strong> option.  If files aren't being removed when <strong>ls -l</strong> implies they should be, use <a href="../man1/stat.1.html"><strong>stat</strong>(1)</a></strong> or <strong>ls</strong> --time=access to examine the file's <em>atime</em> and see if that helps to explain the problem.</p><p>Additionally, <strong>tmpreaper</strong> can be instructed to also check the <em>ctime</em> (inode change time, which is updated e.g. when the file is created or permissions are changed). This is primarily useful when <strong>tmpreaper</strong> is used to clean up directories that are accessible as a Samba share; DOS (and Windows) PCs preserve the <em>mtime</em> and the <em>atime</em> when copying to a new file, so that it appears that the newly created file is old. <strong>tmpreaper</strong> will remove such files is the <em>atime</em> is beyond the removal time, even though they were just created. This is avoided by using the <strong>--ctime</strong> option.</p><p>As testing the contents of subdirectories will update those directories' <em>atime</em>, empty directories won't be removed. To circumvent this problem you can use the <strong>--mtime-dir</strong> option, which will switch on <em>mtime</em> checking for directories only. Using <strong>--mtime-dir</strong> in addition to <strong>--mtime</strong> doesn't do anything useful.</p><p>The <em>&lt;time_spec&gt;</em> parameter defines the age threshold for removing files. If the file has not been accessed for <em>&lt;time_spec&gt;</em>, it becomes eligible for removal.  The <em>&lt;time_spec&gt;</em> should be a number, defaulting to hours, optionally suffixed by one character: `d' for days, `h' for hours, `m' for minutes, or `s' for seconds. Following the time option, one or more directories must be given for <strong>tmpreaper</strong> to clean up.</p><p>On linux ext2/ext3 filesystems, no errors will be given when trying to remove files marked as immutable. A common situation for this (nowadays) is the ext3 .journal file. However, there may of course be other files marked as such by the system administrator.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>&lt;noargs&gt;, -h, --help</strong></p>
  </dt>
  <dd>
    <p>Print a brief version, copyright, and usage statement on stderr, then exit with error status 1.</p>
  </dd>
  <dt>
    <p><strong>-t, --test</strong></p>
  </dt>
  <dd>
    <p>Don't actually remove any files, but go through the motions, checking through the directory, then pretend to remove the eligible files.</p>
  </dd>
  <dt>
    <p><strong>-v, --verbose</strong></p>
  </dt>
  <dd>
    <p>Print a verbose display. Two levels of verbosity are available---use this option twice to get the most verbose output.  The <strong>--test</strong> option automaticly sets <strong>--verbose</strong> once.</p><p>Higher numbers mean more output (max. is 3).</p><p>To force normal verbosity after <strong>--test</strong>, use "--verbose=0". This will generally only show error messages. Use "--test --verbose=0 --showdeleted" to give a shellscript-like list of actions that would have been done (see the <strong>--showdeleted</strong> description below).</p>
  </dd>
  <dt>
    <p><strong>--showdeleted</strong></p>
  </dt>
  <dd>
    <p>Show what files and directories are deleted. The output is in the form of shell commands, i.e. "rm /dir/dir2/file" and "rmdir /dir/dir2".</p><p>When used together with --test, this option will still cause the "shell commands" to be printed, although nothing is really done. Note that this may show more than without --test, as problems removing the file won't be detected (e.g. immutable files).</p>
  </dd>
  <dt>
    <p><strong>-f, --force</strong></p>
  </dt>
  <dd>
    <p>Remove files even if EUID doesn't have write access (<em>akin to </em><strong>rm -f</strong>). Normally, files owned by the current EUID, with no write bit set are not removed.</p>
  </dd>
  <dt>
    <p><strong>--delay=x</strong></p>
  </dt>
  <dd>
    <p>Delay execution at the start for a random time, up to <em>x</em> seconds; if no value is specified, the default maximum time to delay is 256 seconds. This is an option useful in cron scripts to make the execution of tmpreaper less predictable, thus making things a little harder for those who would attempt to use tmpreaper to thwart security.</p>
  </dd>
  <dt>
    <p><strong>-T x, --runtime=x</strong></p>
  </dt>
  <dd>
    <p>Execution of tmpreaper will aborted after <em>x</em> seconds; this is to prevent attacks that create many, many files. By default the timeout is set to 55 seconds. A value of 0 will disable this feature, which is not advised as this feature prevents possible race-conditions between different instances of <strong>tmpreaper</strong>.</p>
  </dd>
  <dt>
    <p><strong>-m, --mtime</strong></p>
  </dt>
  <dd>
    <p>Base the decision of whether to remove the file on its <em>mtime</em>, rather than on its <em>atime</em>.</p>
  </dd>
  <dt>
    <p><strong>-M, --mtime-dir</strong></p>
  </dt>
  <dd>
    <p>Base the decision of whether to remove the directory on its <em>mtime</em>, rather than on its <em>atime</em>.</p>
  </dd>
  <dt>
    <p><strong>-c, --ctime</strong></p>
  </dt>
  <dd>
    <p>Base the decision of whether to remove the file on its <em>ctime</em>, <strong>in addition to</strong> its <em>atime</em>. Only applicable if the <strong>--mtime</strong> options is not given!</p>
  </dd>
  <dt>
    <p><strong>-s, --symlinks</strong></p>
  </dt>
  <dd>
    <p>Remove symlinks too, not just regular files and directories.</p>
  </dd>
  <dt>
    <p><strong>-a, --all</strong></p>
  </dt>
  <dd>
    <p>Remove all file types, not just regular files, symlinks, and directories.</p>
  </dd>
  <dt>
    <p><strong>--protect </strong><em>'&lt;shell_pattern&gt;'</em></p>
  </dt>
  <dd>
    <p>Protect the files that match the <em>&lt;shell_pattern&gt;</em> from deletion.  This option may be used more than once.  It has no one letter abbreviation, you must spell out the full word "protect".</p><p>If you do not enclose the <em>&lt;shell_pattern&gt;</em> in single quotes, the shell will perform the expansion before <strong>tmpreaper</strong> reads its argument array.  The program does not support that syntax, so you <em>must</em> use single quotes around the glob pattern.</p><p><strong>tmpreaper</strong> will <a href="../man2/chdir.2.html"><strong>chdir</strong>(2)</a></em> into each of the directories you've specified for cleanup, and check for files matching the <em>&lt;shell_pattern&gt;</em> there.  It then builds a list of them, and uses that to protect them from removal.  For example:</p><p><strong>tmpreaper</strong> --test --verbose --protect &#92;  '.X*-{lock,unix,unix/*}' --protect '.ICE-{unix{/*,}}' &#92;  5d /tmp  # 5 day grace period</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TIPS</h2>
        <div class="sectioncontent">
<p>As long as there are files present inside a subdirectory, it won't get removed.  You can use a non-writable, self-owned file, perhaps named ".tmpreaper", or, if you are su, a file that has the ext2fs <em>immutable</em> attribute set, to keep a subdirectory from being deleted.  Of course, you could just as easily use use the <strong>--protect</strong> option to obtain the same result.</p><p>Because the command line argument processing is implemented with GNU <a href="../man3/getopt_long.3.html"><strong>getopt_long</strong>(3)</a></strong>[2], you may order the arguments thusly, if it pleases you:</p><p><strong>tmpreaper</strong> --test --verbose 5h &#92;  --protect './tmp/{blah?,dir{/blah4,}}' ./tmp &#92;  --protect '/tmp/.X*' /tmp</p><p> ... Note that if you use <strong>--all</strong> or <strong>--symlinks</strong>, it will have global effect.  If you only want it turned on for one directory, you must use separate commands.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WARNINGS</h2>
        <div class="sectioncontent">
<p><strong>Please do not ever run </strong><strong>tmpreaper</strong> on `/'!!! There are no safeguards against this built into the program, because that would make it difficult to use in a chrooted environment.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO tmpreaper&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/chattr.1.html"><strong>chattr</strong>(1)</a> <a href="../man2/chdir.2.html"><strong>chdir</strong>(2)</a> <a href="../man8/chroot.8.html"><strong>chroot</strong>(8)</a> <strong>cron</strong>(1) <a href="../man3/getopt_long.3.html"><strong>getopt_long</strong>(3)</a> <em>ls</em>(1) <a href="../man1/lsattr.1.html"><strong>lsattr</strong>(1)</a> <em>rm</em>(1) <a href="../man1/stat.1.html"><strong>stat</strong>(1)</a></p>
<pre>
[1]  http://seclists.org/lists/bugtraq/1996/May/0046.html or
     http://www.security-express.com/archives/bugtraq/1996_2/0054.html

     http://linuxgazette.net/18/tmp.html
     (formerly http://www.linuxgazette.com/issue18/tmp.html)

     http://linuxgazette.net/20/followup.html
</pre>
<p>[2] info:(libc)Long Options</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<pre>
    Karl M. Hegbloom &lt;karlheg@debian.org&gt;
</pre>
<p>Mostly based on `tmpwatch-1.2/1.4', by:</p>
<pre>
    Erik Troan &lt;ewt@redhat.com&gt;
</pre>
<p>Now being maintained for Debian by:</p>
<pre>
    Paul Slootman &lt;paul@debian.org&gt;
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="tlsdated.8.html"><span aria-hidden="true">&larr;</span> tlsdated.8: Secure parasitic rdate replacement daemon</a></li>
   <li class="next"><a href="tnat64.8.html">tnat64.8: Library for intercepting outgoing network connections and redirecting them through the nat64. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
