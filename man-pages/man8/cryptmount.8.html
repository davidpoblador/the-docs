<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cryptmount: Mount/unmount/configure an encrypted filesystem</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Mount/unmount/configure an encrypted filesystem">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cryptmount (8) manual">
  <meta name="twitter:description" content="Mount/unmount/configure an encrypted filesystem">
  <meta name="twitter:image" content="https://www.carta.tech/images/cryptmount-cryptmount-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/cryptmount.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cryptmount (8) manual" />
  <meta property="og:description" content="Mount/unmount/configure an encrypted filesystem" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cryptmount-cryptmount-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cryptmount<small> (8)</small></h1>
        <p class="lead">Mount/unmount/configure an encrypted filesystem</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cryptmount.8.html">
      <span itemprop="name">cryptmount: Mount/unmount/configure an encrypted filesystem</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cryptmount/">
      <span itemprop="name">cryptmount</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/cryptmount.8.html">
      <span itemprop="name">cryptmount: Mount/unmount/configure an encrypted filesystem</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>cryptmount </strong><em>TARGET</em> [<em>TARGET ...</em>]</p><p><strong>cryptmount --unmount </strong><em>TARGET</em> [<em>TARGET ...</em>]</p><p><strong>cryptmount --change-password </strong><em>TARGET</em></p><p><strong>cryptmount --generate-key </strong><em>SIZE</em><strong> </strong><em>TARGET</em></p><p><strong>cryptmount --swapon </strong><em>TARGET</em></p><p><strong>cryptmount --swapoff </strong><em>TARGET</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>cryptmount</strong> allows an encrypted filesystem to be mounted or unmounted, without requiring superuser privileges, and assists the superuser in creating new encrypted filesystems. After initial configuration of the filesystem by the system administrator, the user needs only to provide the decryption password for that filing system in order for <strong>cryptmount</strong> to automatically configure device-mapper and loopback targets before mounting the filesystem.</p><p><strong>cryptmount</strong> was written in response to differences between the newer device-mapper infrastructure of the linux-2.6 kernel series, and the older cryptoloop infrastructure which allowed ordinary users access to encrypted filesystems directly through <strong>mount</strong> (8).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-a --all</strong></p>
  </dt>
  <dd>
    <p>act on all available targets, e.g. for mounting all targets.</p>
  </dd>
  <dt>
    <p><strong>-m --mount</strong></p>
  </dt>
  <dd>
    <p>mount the specified target, configuring any required device-mapper or loopback devices. The user will be asked to supply a password to unlock the decryption key for the filesystem.</p>
  </dd>
  <dt>
    <p><strong>-u --unmount</strong></p>
  </dt>
  <dd>
    <p>unmount the specified target, and deconfigure any underlying device-mapper or loopback devices. No password is required, although the operation will fail if the filesystem is in use, or if a non-root user tries to unmount a filesystem mounted by a different user.</p>
  </dd>
  <dt>
    <p><strong>-S --status</strong></p>
  </dt>
  <dd>
    <p>provide information on whether the specified target is currently mounted or not</p>
  </dd>
  <dt>
    <p><strong>-l --list</strong></p>
  </dt>
  <dd>
    <p>lists all available targets, including basic information about the filesystem and mount point of each.</p>
  </dd>
  <dt>
    <p><strong>-c --change-password</strong></p>
  </dt>
  <dd>
    <p>change the password protecting the decryption key for a given filesystem.</p>
  </dd>
  <dt>
    <p><strong>-g --generate-key </strong><em>size</em><strong></strong></p>
  </dt>
  <dd>
    <p>setup a decryption key for a new filesystem. <em>size</em> gives the length of the key in bytes.</p>
  </dd>
  <dt>
    <p><strong>-e --reuse-key </strong><em>existing-target</em><strong></strong></p>
  </dt>
  <dd>
    <p>setup a decryption key for a new filesystem, using an existing key from another filesystem, for example to translate between different file-formats for storing a single key. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-f --config-fd </strong><em>num</em><strong></strong></p>
  </dt>
  <dd>
    <p>read configuration information about targets from file-descriptor <em>num</em> instead of the default configuration file. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-w --passwd-fd </strong><em>num</em><strong></strong></p>
  </dt>
  <dd>
    <p>read passwords from file-descriptor <em>num</em> instead of from the terminal, e.g. for using cryptmount within scripts or GUI wrappers. Each password is read once only, in contrast to terminal-based operation where new passwords would be requested twice for verification.</p>
  </dd>
  <dt>
    <p><strong>-p --prepare</strong></p>
  </dt>
  <dd>
    <p>prepare all the device-mapper and loopback devices needed to access a target, but do not mount. This is intended to allow the superuser to install a filesystem on an encrypted device.</p>
  </dd>
  <dt>
    <p><strong>-r --release</strong></p>
  </dt>
  <dd>
    <p>releases all device-mapper and loopback devices associated with a particular target. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-s --swapon</strong></p>
  </dt>
  <dd>
    <p>enable the specified target for paging and swapping. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-x --swapoff</strong></p>
  </dt>
  <dd>
    <p>disable the specified target for paging and swapping. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-k --key-managers</strong></p>
  </dt>
  <dd>
    <p>list all the available formats for protecting the filesystem access keys.</p>
  </dd>
  <dt>
    <p><strong>-B --system-boot</strong></p>
  </dt>
  <dd>
    <p>setup all targets which have declared a "bootaction" parameter. This will typically be used to automatically mount encrypted filesystems, or setup encrypted swap partitions, on system startup. This option is only available to the superuser.</p>
  </dd>
  <dt>
    <p><strong>-Q --system-shutdown</strong></p>
  </dt>
  <dd>
    <p>close-down all targets which have declared a "bootaction" parameter. This is essentially the opposite of the "--system-boot" option.</p>
  </dd>
  <dt>
    <p><strong>-n --safetynet</strong></p>
  </dt>
  <dd>
    <p>attempts to close-down any mounted targets that should normally have been shutdown with --unmount or --swapoff. This option is only available to the superuser, and intended <strong>exclusively</strong> for use during shutdown/reboot of the operating system.</p>
  </dd>
  <dt>
    <p><strong>-v --version</strong></p>
  </dt>
  <dd>
    <p>show the version-number of the installed program.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN CODES</h2>
        <div class="sectioncontent">
<p><strong>cryptmount</strong> returns zero on success. A non-zero value indicates a failure of some form, as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>1</strong></p>
  </dt>
  <dd>
    <p>unrecognized command-line option;</p>
  </dd>
  <dt>
    <p><strong>2</strong></p>
  </dt>
  <dd>
    <p>unrecognized filesystem target name;</p>
  </dd>
  <dt>
    <p><strong>3</strong></p>
  </dt>
  <dd>
    <p>failed to execute helper program;</p>
  </dd>
  <dt>
    <p><strong>100</strong></p>
  </dt>
  <dd>
    <p>insufficient privilege;</p>
  </dd>
  <dt>
    <p><strong>101</strong></p>
  </dt>
  <dd>
    <p>security failure in installation.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE USAGE</h2>
        <div class="sectioncontent">
<p>In order to create a new encrypted filesystem managed by cryptmount, you can use the supplied 'cryptmount-setup' program, which can be used by the superuser to interactively configure a basic setup.</p><p>Alternatively, a manual setup allows more control of configuration settings. Before doing so, one should ensure that kernel support for /dev/loop and /dev/mapper is available, e.g. via</p>
<pre>
    modprobe -a loop dm-crypt
</pre>
<p>Now suppose that we wish to setup a new encrypted filesystem, that will have a target-name of "opaque". If we have a free disk partition available, say /dev/hdb63, then we can use this directly to store the encrypted filesystem. Alternatively, if we want to store the encrypted filesystem within an ordinary file, we need to create space using a recipe such as:</p>
<pre>
    dd if=/dev/zero of=/home/opaque.fs bs=1M count=512
</pre>
<p>and then replace all occurences of '/dev/hdb63' in the following with '/home/opaque.fs'. (/dev/urandom can be used in place of /dev/zero, debatably for extra security, but is rather slower.)</p><p>First, we need to add an entry in /etc/cryptmount/cmtab, which describes the encryption that will be used to protect the filesystem itself and the access key, as follows:</p>
<pre>
    opaque {
        dev=/dev/hdb63 dir=/home/crypt
        fstype=ext2 mountoptions=defaults cipher=twofish
        keyfile=/etc/cryptmount/opaque.key
        keyformat=builtin
    }
</pre>
<p>Here, we will be using the "twofish" algorithm to encrypt the filesystem itself, with the built-in key-manager being used to protect the decryption key (to be stored in /etc/cryptmount/opaque.key).</p><p>In order to generate a secret decryption key (in /etc/cryptmount/opaque.key) that will be used to encrypt the filesystem itself, we can execute, as root:</p>
<pre>
    cryptmount --generate-key 32 opaque
</pre>
<p>This will generate a 32-byte (256-bit) key, which is known to be supported by the Twofish cipher algorithm, and store it in encrypted form after asking the system administrator for a password.</p><p>If we now execute, as root:</p>
<pre>
    cryptmount --prepare opaque
</pre>
<p>we will then be asked for the password that we used when setting up /etc/cryptmount/opaque.key, which will enable <strong>cryptmount</strong> to setup a device-mapper target (/dev/mapper/opaque). (If you receive an error message of the form <strong>device-mapper ioctl cmd 9 failed: Invalid argument ,</strong> this may mean that you have chosen a key-size that isn't supported by your chosen cipher algorithm. You can get some information about suitable key-sizes by checking the output from "more /proc/crypto", and looking at the "min keysize" and "max keysize" fields.)</p><p>We can now use standard tools to create the actual filesystem on /dev/mapper/opaque:</p>
<pre>
    mke2fs /dev/mapper/opaque
</pre>
<p>(It may be advisable, after the filesystem is first mounted, to check that the permissions of the top-level directory created by mke2fs are appropriate for your needs.)</p><p>After executing</p>
<pre>
    cryptmount --release opaque
    mkdir /home/crypt
</pre>
<p>the encrypted filesystem is ready for use. Ordinary users can mount it by typing</p>
<pre>
    cryptmount -m opaque
</pre>
<p>or</p>
<pre>
    cryptmount opaque
</pre>
<p>and unmount it using</p>
<pre>
    cryptmount -u opaque
</pre>
<p><strong>cryptmount</strong> keeps a record of which user mounted each filesystem in order to provide a locking mechanism to ensure that only the same user (or root) can unmount it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PASSWORD CHANGING</h2>
        <div class="sectioncontent">
<p>After a filesystem has been in use for a while, one may want to change the access password. For an example target called "opaque", this can be performed by executing:</p>
<pre>
    cryptmount --change-password opaque
</pre>
<p>After successfully supplying the old password, one can then choose a new password which will be used to re-encrypt the access key for the filesystem. (The filesystem itself is not altered or re-encrypted.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LUKS ENCRYPTED FILESYSTEMS</h2>
        <div class="sectioncontent">
<p><strong>cryptmount</strong> can be used to provide easy access to encrypted filesystems compatible with the Linux Unified Key Setup (LUKS) capabilities of the <strong>cryptsetup</strong> application.</p><p>In order to access an existing LUKS partition, an entry needs to be created within /etc/cryptmount/cmtab. For example, if the hard-disk partition /dev/hdb62 is used to contain a LUKS encrypted ext3 filesystem, an entry of the form:</p>
<pre>
    LUKS {
        keyformat=luks
        dev=/dev/hdb62          keyfile=/dev/hdb62
        dir=/home/luks-dir      fstype=ext3
    }
</pre>
<p>would allow this to be mounted via <strong>cryptmount</strong> beneath /home/luks-dir by executing</p>
<pre>
    cryptmount LUKS
</pre>
<p><strong>cryptmount</strong> will also allow any user that knows one of the access-passwords to change their password via</p>
<pre>
    cryptmount --change-password LUKS
</pre>
<p><strong>cryptmount</strong> also provides basic support for creating new LUKS encrypted filesystems, which can be placed within ordinary files as well as disk partitions, via the '--generate-key' recipe shown above. However, to exploit the full range of functionality within LUKS, such as for adding multiple passwords, one needs to use <strong>cryptsetup</strong></p><p>It is strongly recommended that you do not attempt to use LUKS support in combination with cryptmount's features for storing <em>multiple</em> encrypted filesystems within a single disk partition or an ordinary file. This is because of assumptions within the cryptsetup-luks design that the LUKS key-material is always stored at the beginning of the disk partition.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><em>/etc/cryptmount/cmtab</em> - main configuration file</p><p><em>/run/cryptmount.status</em> - record of mounted filesystems</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO cryptmount&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/cmtab.5.html"><strong>cmtab</strong>(5)</a>, <a href="../man8/cryptmount-setup.8.html"><strong>cryptmount-setup</strong>(8)</a>, <a href="../man8/cryptsetup.8.html"><strong>cryptsetup</strong>(8)</a>, <a href="../man8/mount.8.html"><strong>mount</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The author would be grateful for any <strong>constructive</strong> suggestions and bug-reports, via &lt;rwpenney@users.sourceforge.net&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT NOTICE</h2>
        <div class="sectioncontent">
<p><strong>cryptmount</strong> is Copyright 2005-2014 RW Penney</p><p>and is supplied with NO WARRANTY. Licencing terms are as described in the file "COPYING" within the cryptmount source distribution.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cryptdisks_stop.8.html"><span aria-hidden="true">&larr;</span> cryptdisks_stop.8: Wrapper around cryptsetup that parses /etc/crypttab.</a></li>
   <li class="next"><a href="cryptmount-setup.8.html">cryptmount-setup.8: Setup a new encrypted filesystem <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
