<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sg_write_buffer: Send scsi write buffer commands</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Send scsi write buffer commands">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="sg_write_buffer (8) manual">
  <meta name="twitter:description" content="Send scsi write buffer commands">
  <meta name="twitter:image" content="https://www.carta.tech/images/sg3-utils-sg_write_buffer-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/sg_write_buffer.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="sg_write_buffer (8) manual" />
  <meta property="og:description" content="Send scsi write buffer commands" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/sg3-utils-sg_write_buffer-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">sg_write_buffer<small> (8)</small></h1>
        <p class="lead">Send scsi write buffer commands</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/sg_write_buffer.8.html">
      <span itemprop="name">sg_write_buffer: Send scsi write buffer commands</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/sg3-utils/">
      <span itemprop="name">sg3-utils</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/sg_write_buffer.8.html">
      <span itemprop="name">sg_write_buffer: Send scsi write buffer commands</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>sg_write_buffer</strong> [<em>--bpw=CS</em>] [<em>--help</em>] [<em>--id=ID</em>] [<em>--in=FILE</em>] [<em>--length=LEN</em>] [<em>--mode=MO</em>] [<em>--offset=OFF</em>] [<em>--raw</em>] [<em>--skip=SKIP</em>] [<em>--specific=MS</em>] [<em>--verbose</em>] [<em>--version</em>] <em>DEVICE</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Sends one or more SCSI WRITE BUFFER commands to <em>DEVICE</em>, along with data provided by the user. In some cases no data is required, or data can be read from the file given in the <em>--in=FILE</em> option, or data is read from stdin when either <em>--raw</em> or <em>--in=-</em> is given.</p><p>Some WRITE BUFFER command variants do not have associated data to send to the device. For example "activate_mc" activates deferred microcode that was sent via prior WRITE BUFFER commands.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Arguments to long options are mandatory for short options as well.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-b</strong>, <strong>--bpw</strong>=<em>CS</em></p>
  </dt>
  <dd>
    <p>where <em>CS</em> is the chunk size in bytes. This will be the maximum number of bytes sent per WRITE BUFFER command. So if <em>CS</em> is less than the effective length then multiple WRITE BUFFER commands are sent, each taking the next chunk from the read data and inceasing the buffer offset field in the WRITE BUFFER command by the appropriate amount. The default is a chunk size of 0 which is interpreted as a very large number hence only one WRITE BUFFER command will be sent. This option should only be used with modes that "download microcode, with offsets ..."; namely either mode 0x6, 0x7, 0xd or 0xe.</p><p>The number in <em>CS</em> can optionally be followed by ",act" or ",activate". In this case after WRITE BUFFER commands have been sent until the effective length is exhausted another WRITE BUFFER command with its mode set to "Activate deferred microcode mode" [mode 0xf] is sent.</p>
  </dd>
  <dt>
    <p><strong>-h</strong>, <strong>--help</strong></p>
  </dt>
  <dd>
    <p>output the usage message then exit. If used multiple times also prints the mode names and their acronyms.</p>
  </dd>
  <dt>
    <p><strong>-i</strong>, <strong>--id</strong>=<em>ID</em></p>
  </dt>
  <dd>
    <p>this option sets the buffer id field in the cdb. <em>ID</em> is a value between 0 (default) and 255 inclusive.</p>
  </dd>
  <dt>
    <p><strong>-I</strong>, <strong>--in</strong>=<em>FILE</em></p>
  </dt>
  <dd>
    <p>read data from file <em>FILE</em> that will be sent with the WRITE BUFFER command.  If <em>FILE</em> is '-' then stdin is read until an EOF is detected (this is the same action as <em>--raw</em>). Data is read from the beginning of <em>FILE</em> except in the case when it is a regular file and the <em>--skip=SKIP</em> option is given.</p>
  </dd>
  <dt>
    <p><strong>-l</strong>, <strong>--length</strong>=<em>LEN</em></p>
  </dt>
  <dd>
    <p>where <em>LEN</em> is the length, in bytes, of data to be written to the device. If not given (and the length cannot be deduced from <em>--in=FILE</em> or <em>--raw</em>) then defaults to zero. If the option is given and the length deduced from <em>--in=FILE</em> or <em>--raw</em> is less (or no data is provided), then bytes of 0xff are used as fill bytes.</p>
  </dd>
  <dt>
    <p><strong>-m</strong>, <strong>--mode</strong>=<em>MO</em></p>
  </dt>
  <dd>
    <p>this option sets the MODE field in the cdb. <em>MO</em> is a value between 0 (default) and 31 inclusive. Alternatively an abbreviation can be given. See the MODES section below. To list the available mode abbreviations at run time give an invalid one (e.g. '--mode=xxx') or use the '-hh' option.</p>
  </dd>
  <dt>
    <p><strong>-o</strong>, <strong>--offset</strong>=<em>OFF</em></p>
  </dt>
  <dd>
    <p>this option sets the BUFFER OFFSET field in the cdb. <em>OFF</em> is a value between 0 (default) and 2**24-1 . It is a byte offset.</p>
  </dd>
  <dt>
    <p><strong>-r</strong>, <strong>--raw</strong></p>
  </dt>
  <dd>
    <p>read data from stdin until an EOF is detected. This data is sent with the WRITE BUFFER command to <em>DEVICE</em>. The action of this option is the same as using '--in=-'.</p>
  </dd>
  <dt>
    <p><strong>-s</strong>, <strong>--skip</strong>=<em>SKIP</em></p>
  </dt>
  <dd>
    <p>this option is only active when <em>--in=FILE</em> is given and <em>FILE</em> is a regular file, rather than stdin. Data is read starting at byte offset <em>SKIP</em> to the end of file (or the amount given by <em>--length=LEN</em>). If not given the byte offset defaults to 0 (i.e. the start of the file).</p>
  </dd>
  <dt>
    <p><strong>-S</strong>, <strong>--specific</strong>=<em>MS</em></p>
  </dt>
  <dd>
    <p><em>MS</em> is the MODE SPECIFIC field in the cdb. This is a 3-bit field so the values 0 to 7 are accepted. This field was introduced in SPC-4 revision 32 and can be used to specify additional events that activate deferred microcode (when <em>MO</em> is 0xD).</p>
  </dd>
  <dt>
    <p><strong>-v</strong>, <strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>increase the level of verbosity, (i.e. debug output).</p>
  </dd>
  <dt>
    <p><strong>-V</strong>, <strong>--version</strong></p>
  </dt>
  <dd>
    <p>print the version string and then exit.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MODES</h2>
        <div class="sectioncontent">
<p>Following is a list of WRITE BUFFER command settings for the MODE field. First is an acronym accepted by the <em>MO</em> argument of this utility. Following the acronym in square brackets are the corresponding decimal and hex values that may also be given for <em>MO</em>. The following are listed in numerical order.</p>
<dl class='dl-vertical'>
  <dt>
    <p>hd  [0, 0x0]</p>
  </dt>
  <dd>
    <p>Combined header and data (obsolete in SPC-4).</p>
  </dd>
  <dt>
    <p>vendor  [1, 0x1]</p>
  </dt>
  <dd>
    <p>Vendor specific.</p>
  </dd>
  <dt>
    <p>data  [2, 0x2]</p>
  </dt>
  <dd>
    <p>Data (was called "Write Data" in SPC-3).</p>
  </dd>
  <dt>
    <p>dmc  [4, 0x4]</p>
  </dt>
  <dd>
    <p>Download microcode and activate (was called "Download microcode" in SPC-3).</p>
  </dd>
  <dt>
    <p>dmc_save  [5, 0x5]</p>
  </dt>
  <dd>
    <p>Download microcode, save, and activate (was called "Download microcode and save" in SPC-3).</p>
  </dd>
  <dt>
    <p>dmc_offs  [6, 0x6]</p>
  </dt>
  <dd>
    <p>Download microcode with offsets and activate (was called "Download microcode with offsets" in SPC-3).</p>
  </dd>
  <dt>
    <p>dmc_offs_save  [7, 0x7]</p>
  </dt>
  <dd>
    <p>Download microcode with offsets, save, and activate (was called "Download microcode with offsets and save" in SPC-3).</p>
  </dd>
  <dt>
    <p>echo  [10, 0xa]</p>
  </dt>
  <dd>
    <p>Write data to echo buffer (was called "Echo buffer" in SPC-3).</p>
  </dd>
  <dt>
    <p>dmc_offs_ev_defer  [13, 0xd]</p>
  </dt>
  <dd>
    <p>Download microcode with offsets, select activation events, save, and defer activate (introduced in SPC-4).</p>
  </dd>
  <dt>
    <p>dmc_offs_defer  [14, 0xe]</p>
  </dt>
  <dd>
    <p>Download microcode with offsets, save, and defer activate (introduced in SPC-4).</p>
  </dd>
  <dt>
    <p>activate_mc  [15, 0xf]</p>
  </dt>
  <dd>
    <p>Activate deferred microcode (introduced in SPC-4).</p>
  </dd>
  <dt>
    <p>en_ex  [26, 0x1A]</p>
  </dt>
  <dd>
    <p>Enable expander communications protocol and Echo buffer (obsolete in SPC-4).</p>
  </dd>
  <dt>
    <p>dis_ex  [27, 0x1B]</p>
  </dt>
  <dd>
    <p>Disable expander communications protocol (obsolete in SPC-4).</p>
  </dd>
  <dt>
    <p>deh  [28, 0x1C]</p>
  </dt>
  <dd>
    <p>Download application client error history (was called "Download application log" in SPC-3).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>If no <em>--length=LEN</em> is given this utility reads up to 8 MiB of data from the given file <em>FILE</em> (or stdin). If a larger amount of data is required then the <em>--length=LEN</em> option should be given.</p><p>The user should be aware that most operating systems have limits on the amount of data that can be sent with one SCSI command. In Linux this depends on the pass through mechanism used (e.g. block SG_IO or the sg driver) and various setting in sysfs in the Linux lk 2.6/3 series (e.g. /sys/block/sda/queue/max_sectors_kb). Devices (i.e. logical units) also typically have limits on the maximum amount of data they can handle in one command. These two limitations suggest that modes containing the word "offset" togther with the <em>--bpw=CS</em> option are required as firmware files get larger and larger. And <em>CS</em> can be quite small, for example 4096 bytes, resulting in many WRITE BUFFER commands being sent.</p><p>Downloading incorrect microcode into a device has the ability to render that device inoperable. One would hope that the device vendor verifies the data before activating it. If the SCSI WRITE BUFFER command is given values in its cdb (e.g. <em>LEN</em>) that are inappropriate (e.g. too large) then the device should respond with a sense key of ILLEGAL REQUEST and an additional sense code of INVALID FIELD in CDB. If a WRITE BUFFER command (or a sequence of them) fails due to device vendor verification checks then it should respond with a sense key of ILLEGAL REQUEST and an additional sense code of COMMAND SEQUENCE ERROR.</p><p>Each WRITE BUFFER command is assigned a timeout of 120 seconds.</p><p>All numbers given with options are assumed to be decimal. Alternatively numerical values can be given in hexadecimal preceded by either "0x" or "0X" (or has a trailing "h" or "H").</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The following sends new firmware to an enclosure. Sending a 1.5 MB file in one WRITE BUFFER command caused the enclosure to lock up temporarily and did not update the firmware. Breaking the firmware file into 4 KB chunks (an educated guess) was more successful:</p>
<pre>
  sg_write_buffer -b 4k -m dmc_offs_save -I firmware.bin /dev/sg4
</pre>
<p>The firmware update occurred in the following enclosure power cycle. With a modern enclosure the Extended Inquiry VPD page gives indications in which situations a firmware upgrade will take place.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p>The exit status of sg_write_buffer is 0 when it is successful. Otherwise see the <a href="../man8/sg3_utils.8.html"><strong>sg3_utils</strong>(8)</a> man page.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Written by Luben Tuikov and Douglas Gilbert.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to &lt;dgilbert at interlog dot com&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright &copy; 2006-2014 Luben Tuikov and Douglas Gilbert</p><p>This software is distributed under a FreeBSD license. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO sg_write_buffer&hellip;</h2>
        <div class="sectioncontent">
<p><strong>sg_read_buffer(sg3_utils)</strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="sg_wr_mode.8.html"><span aria-hidden="true">&larr;</span> sg_wr_mode.8: Write (modify) scsi mode page</a></li>
   <li class="next"><a href="sg_write_long.8.html">sg_write_long.8: Send scsi write long command <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
