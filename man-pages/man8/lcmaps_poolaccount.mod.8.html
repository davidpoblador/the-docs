<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lcmaps_poolaccount.mod: Lcmaps plugin to switch user identity by pool accounts</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Lcmaps plugin to switch user identity by pool accounts">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="lcmaps_poolaccount.mod (8) manual">
  <meta name="twitter:description" content="Lcmaps plugin to switch user identity by pool accounts">
  <meta name="twitter:image" content="https://www.carta.tech/images/lcmaps-plugins-basic-poolaccount-lcmaps_poolaccount.mod-8.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man8/lcmaps_poolaccount.mod.8.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="lcmaps_poolaccount.mod (8) manual" />
  <meta property="og:description" content="Lcmaps plugin to switch user identity by pool accounts" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/lcmaps-plugins-basic-poolaccount-lcmaps_poolaccount.mod-8.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">lcmaps_poolaccount.mod<small> (8)</small></h1>
        <p class="lead">Lcmaps plugin to switch user identity by pool accounts</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/">
      <span itemprop="name">System administration commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/lcmaps_poolaccount.mod.8.html">
      <span itemprop="name">lcmaps_poolaccount.mod: Lcmaps plugin to switch user identity by pool accounts</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/lcmaps-plugins-basic-poolaccount/">
      <span itemprop="name">lcmaps-plugins-basic-poolaccount</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man8/lcmaps_poolaccount.mod.8.html">
      <span itemprop="name">lcmaps_poolaccount.mod: Lcmaps plugin to switch user identity by pool accounts</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>lcmaps_poolaccount.mod</strong> [<strong>-gridmapfile</strong> <em>gridmapfile</em>] [<strong>-gridmapdir</strong> <em>gridmapdir</em>] [<strong>-override_inconsistency</strong>] [<strong>-max_mappings_per_credential</strong> <em>max nr of mappings</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This plugin is a Acquisition Plugin and will provide the LCMAPS system with Pool Account information. To do this it needs to look up the Distinguished Name (DN) from a user's certificate in the gridmapfile. If this DN is found in the gridmapfile the plugin now knows to which pool of local system accounts the user will be mapped. The poolname (starting with a dot ('.') instead of an alphanumeric character) will be converted into the an account from a list of local accounts. This list is located in the &#92; gridmapdir and is made out of filenames. These filenames correspond to the system poolaccount names. (E.g. if a DN corresponds to <strong>.test</strong> in the gridmapfile, it will be mapped to <strong>test001</strong>, <strong>test002</strong>, etc., which names can be found in the gridmapdir.</p><p>If there is no pool account assigned to the user yet, the plugin will get a directory listing of the gridmapdir.  This list will contain usernames corresponding to system accounts specially designated for pool accounting.  If the plugin resolved the mapping of a certain pool name, let's say '.test', the plugin will look into the directory list and will find the first available file in the list corresponding with 'test' (e.g. 'test001') by checking the number of links to its i-node.  If this number is 1, this account is still available.  To lease this account a second hard link is created, named after the URL-encoded, decapitalized DN.</p><p>When a user returns to this site the plugin will look for the DN of the user (URL encoded) in this directory. If found, the corresponding poolaccount will be assigned to the user.</p><p>The plugin will resolve the UID, GID and all the secondary GIDs belonging to the poolaccount. When this has been done and there weren't any problems detected, the plugin will add this information to a datastructure in the Plugin Manager. For version 1.6.0 and newer, if a <strong> requested username </strong> is specified (such as via the gsisshd) this needs to match the resulting poolaccount for the plugin to succeed, see <strong> NOTES </strong>. The plugin will finish its run with a <strong>LCMAPS_MOD_SUCCESS</strong>. This result will be reported to the Plugin Manager which started this plugin and it will forward this result to the Evaluation Manager, which will take appropriate actions for the next plugin to run. Normally this plugin would be followed by an Enforcement plugin that can apply these gathered credentials in a way that is appropriate to a system administration's needs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-gridmapfile </strong><em>gridmapfile</em></p>
  </dt>
  <dd>
    <p>If this option is set, it will override the default path of the gridmapfile.  It is advised to use an absolute path to the gridmapfile to avoid usage of the wrong file(path).</p>
  </dd>
  <dt>
    <p><strong>-gridmapdir </strong><em>gridmapdir</em></p>
  </dt>
  <dd>
    <p>If this option is set, it will override the default path to the gridmapdir. It is advised to use an absolute path to the gridmapdir to avoid usage of the wrong path.</p>
  </dd>
  <dt>
    <p><strong>-override_inconsistency</strong></p>
  </dt>
  <dd>
    <p>Moving a user from one pool to another (because of a VO change) should only be done by changing the gridmapfile indicating the new pool for this user.  If a user has already been mapped previously to a poolaccount, there is a link present between this poolaccount and his DN.  In the good old days prior to LCMAPS, a 'pool change' would still result in a mapping to the old pool account, neglecting the administrative changes in the gridmapfile.  LCMAPS corrects this behaviour: By default the poolaccount plugin will fail if the pool designated by the gridmapfile doesn't match the previously mapped poolaccount leasename.  If the site doesn't want a failure on this inconsistency it can turn on this parameter.  When the inconsistency is detected the plugin will automatically unlink the previous mapping and will proceed by making a new lease from the new pool.</p>
  </dd>
  <dt>
    <p><strong>-max_mappings_per_credential </strong><em>max nr of mappings</em></p>
  </dt>
  <dd>
    <p>This value indicates the maximum number of accounts a user, or more specifically a set of credentials (=DN + FQANS), can be mapped to. Normally this number is 1. But if each job should run under its own account the number should be increased. The leasename (or poolindex) in this case looks like:</p><ul>
<li><p>url_encoded(&lt;DN&gt;):mapcount=&lt;mapnumber&gt;)</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>-no_wildcard</strong></p>
  </dt>
  <dd>
    <p>If this option is set, wildcards cannot be used in the grid-mapfile (on by default)</p>
  </dd>
  <dt>
    <p><strong>-strict_poolprefix_match </strong>{<strong>yes</strong>|<strong>no</strong>}</p>
  </dt>
  <dd>
    <p>Default is 'yes'. If this is set to 'yes', a line in the gridmapfile like &lt;DN&gt;.pool will result in accounts matching the regexp 'pool[0-9]+'. Otherwise it will be allowed to match 'pool.*' (legacy behaviour).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>LCMAPS_MOD_SUCCESS</strong></p>
  </dt>
  <dd>
    <p>Success.</p>
  </dd>
  <dt>
    <p><strong>LCMAPS_MOD_FAIL</strong></p>
  </dt>
  <dd>
    <p>Failure.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Since version 1.6.0 the poolaccount plugin also takes the <strong> requested</strong> username  (such as forwarded by gsissh) into consideration. When present, the resulting poolaccount has to match it in order for the plugin to succeed. This requires LCMAPS version 1.6.0 or newer.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any errors to the Nikhef Grid Middleware Security Team &lt;grid-mw-security-support@nikhef.nl&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO lcmaps_poolaccount.mod&hellip;</h2>
        <div class="sectioncontent">
<p><strong>lcmaps.db</strong>(5), <a href="../man3/lcmaps.3.html"><strong>lcmaps</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>LCMAPS and the LCMAPS plug-ins were written by the Grid Middleware Security Team &lt;grid-mw-security@nikhef.nl&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lcmaps_localaccount.mod.8.html"><span aria-hidden="true">&larr;</span> lcmaps_localaccount.mod.8: Lcmaps plugin to switch user identity</a></li>
   <li class="next"><a href="lcmaps_posix_enf.mod.8.html">lcmaps_posix_enf.mod.8: Lcmaps plugin to switch user identity <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
