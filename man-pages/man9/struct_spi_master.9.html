<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>struct_spi_master: Interface to spi master controller</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Interface to spi master controller">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="struct_spi_master (9) manual">
  <meta name="twitter:description" content="Interface to spi master controller">
  <meta name="twitter:image" content="https://www.carta.tech/images/linux-manual-3.16-struct_spi_master-9.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man9/struct_spi_master.9.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="struct_spi_master (9) manual" />
  <meta property="og:description" content="Interface to spi master controller" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/linux-manual-3.16-struct_spi_master-9.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">struct_spi_master<small> (9)</small></h1>
        <p class="lead">Interface to spi master controller</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man9/">
      <span itemprop="name">Kernel routines</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man9/struct_spi_master.9.html">
      <span itemprop="name">struct_spi_master: Interface to spi master controller</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/linux-manual-3.16/">
      <span itemprop="name">linux-manual-3.16</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man9/struct_spi_master.9.html">
      <span itemprop="name">struct_spi_master: Interface to spi master controller</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
struct spi_master {
  struct device dev;
  struct list_head list;
  s16 bus_num;
  u16 num_chipselect;
  u16 dma_alignment;
  u16 mode_bits;
  u32 bits_per_word_mask;
#define SPI_BPW_MASK(bits) BIT((bits) - 1)
#define SPI_BIT_MASK(bits) (((bits) == 32) ? ~0U : (BIT(bits) - 1))
#define SPI_BPW_RANGE_MASK(min# max) (SPI_BIT_MASK(max) - SPI_BIT_MASK(min - 1))
  u32 min_speed_hz;
  u32 max_speed_hz;
  u16 flags;
#define SPI_MASTER_HALF_DUPLEX	<strong>BIT</strong>(0)
#define SPI_MASTER_NO_RX	<strong>BIT</strong>(1)
#define SPI_MASTER_NO_TX	<strong>BIT</strong>(2)
#define SPI_MASTER_MUST_RX      <strong>BIT</strong>(3)
#define SPI_MASTER_MUST_TX      <strong>BIT</strong>(4)
  spinlock_t bus_lock_spinlock;
  struct mutex bus_lock_mutex;
  bool bus_lock_flag;
  int (* setup) (struct spi_device *spi);
  int (* transfer) (struct spi_device *spi,struct spi_message *mesg);
  void (* cleanup) (struct spi_device *spi);
  bool queued;
  struct kthread_worker kworker;
  struct task_struct * kworker_task;
  struct kthread_work pump_messages;
  spinlock_t queue_lock;
  struct list_head queue;
  struct spi_message * cur_msg;
  bool busy;
  bool running;
  bool rt;
  bool auto_runtime_pm;
  bool cur_msg_prepared;
  struct completion xfer_completion;
  size_t max_dma_len;
  int (* prepare_transfer_hardware) (struct spi_master *master);
  int (* transfer_one_message) (struct spi_master *master,struct spi_message *mesg);
  int (* unprepare_transfer_hardware) (struct spi_master *master);
  int (* prepare_message) (struct spi_master *master,struct spi_message *message);
  int (* unprepare_message) (struct spi_master *master,struct spi_message *message);
  void (* set_cs) (struct spi_device *spi, bool enable);
  int (* transfer_one) (struct spi_master *master, struct spi_device *spi,struct spi_transfer *transfer);
  int * cs_gpios;
};
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MEMBERS</h2>
        <div class="sectioncontent">
<p>dev</p><p>device interface to this driver</p><p>list</p><p>link with the global spi_master list</p><p>bus_num</p><p>board-specific (and often SOC-specific) identifier for a given SPI controller.</p><p>num_chipselect</p><p>chipselects are used to distinguish individual SPI slaves, and are numbered from zero to num_chipselects. each slave has a chipselect signal, but it&apos;s common that not every chipselect is connected to a slave.</p><p>dma_alignment</p><p>SPI controller constraint on DMA buffers alignment.</p><p>mode_bits</p><p>flags understood by this controller driver</p><p>bits_per_word_mask</p><p>A mask indicating which values of bits_per_word are supported by the driver. Bit n indicates that a bits_per_word n+1 is supported. If set, the SPI core will reject any transfer with an unsupported bits_per_word. If not set, this value is simply ignored, and it&apos;s up to the individual driver to perform any validation.</p><p>min_speed_hz</p><p>Lowest supported transfer speed</p><p>max_speed_hz</p><p>Highest supported transfer speed</p><p>flags</p><p>other constraints relevant to this driver</p><p>bus_lock_spinlock</p><p>spinlock for SPI bus locking</p><p>bus_lock_mutex</p><p>mutex for SPI bus locking</p><p>bus_lock_flag</p><p>indicates that the SPI bus is locked for exclusive use</p><p>setup</p><p>updates the device mode and clocking records used by a device&apos;s SPI controller; protocol code may call this. This must fail if an unrecognized or unsupported mode is requested. It&apos;s always safe to call this unless transfers are pending on the device whose settings are being modified.</p><p>transfer</p><p>adds a message to the controller&apos;s transfer queue.</p><p>cleanup</p><p>frees controller-specific state</p><p>queued</p><p>whether this master is providing an internal message queue</p><p>kworker</p><p>thread struct for message pump</p><p>kworker_task</p><p>pointer to task for message pump kworker thread</p><p>pump_messages</p><p>work struct for scheduling work to the message pump</p><p>queue_lock</p><p>spinlock to syncronise access to message queue</p><p>queue</p><p>message queue</p><p>cur_msg</p><p>the currently in-flight message</p><p>busy</p><p>message pump is busy</p><p>running</p><p>message pump is running</p><p>rt</p><p>whether this queue is set to run as a realtime task</p><p>auto_runtime_pm</p><p>the core should ensure a runtime PM reference is held while the hardware is prepared, using the parent device for the spidev</p><p>cur_msg_prepared</p><p>spi_prepare_message was called for the currently in-flight message</p><p>xfer_completion</p><p>used by core <strong>transfer_one_message</strong></p><p>max_dma_len</p><p>Maximum length of a DMA transfer for the device.</p><p>prepare_transfer_hardware</p><p>a message will soon arrive from the queue so the subsystem requests the driver to prepare the transfer hardware by issuing this call</p><p>transfer_one_message</p><p>the subsystem calls the driver to transfer a single message while queuing transfers that arrive in the meantime. When the driver is finished with this message, it must call <strong>spi_finalize_current_message</strong> so the subsystem can issue the next message</p><p>unprepare_transfer_hardware</p><p>there are currently no more messages on the queue so the subsystem notifies the driver that it may relax the hardware by issuing this call</p><p>prepare_message</p><p>set up the controller to transfer a single message, for example doing DMA mapping. Called from threaded context.</p><p>unprepare_message</p><p>undo any work done by <strong>prepare_message</strong>.</p><p>set_cs</p><p>set the logic level of the chip select line. May be called from interrupt context.</p><p>transfer_one</p><p>transfer a single spi_transfer. - return 0 if the transfer is finished, - return 1 if the transfer is still in progress. When the driver is finished with this transfer it must call <strong>spi_finalize_current_transfer</strong> so the subsystem can issue the next transfer. Note: transfer_one and transfer_one_message are mutually exclusive; when both are set, the generic subsystem does not call your transfer_one callback.</p><p>cs_gpios</p><p>Array of GPIOs to use as chip select lines; one per CS number. Any individual value may be -ENOENT for CS lines that are not GPIOs (driven by the SPI controller itself).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Each SPI master controller can communicate with one or more <em>spi_device</em> children. These make a small bus, sharing MOSI, MISO and SCK signals but not chip select signals. Each device may be configured to use a different clock rate, since those shared signals are ignored unless the chip is selected.</p><p>The driver for an SPI controller manages access to those devices through a queue of spi_message transactions, copying data between CPU memory and an SPI slave device. For each such message it queues, it calls the message&apos;s completion function when the transaction completes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="struct_spi_driver.9.html"><span aria-hidden="true">&larr;</span> struct_spi_driver.9: Host side protocol driver</a></li>
   <li class="next"><a href="struct_spi_message.9.html">struct_spi_message.9: One multi-segment spi transaction <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
