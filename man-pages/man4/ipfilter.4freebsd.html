<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ipfilter: Introduction to ip packet filtering</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Introduction to ip packet filtering">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ipfilter (4freebsd) manual">
  <meta name="twitter:description" content="Introduction to ip packet filtering">
  <meta name="twitter:image" content="https://www.carta.tech/images/freebsd-manpages-ipfilter-4freebsd.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man4freebsd/ipfilter.4freebsd.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ipfilter (4freebsd) manual" />
  <meta property="og:description" content="Introduction to ip packet filtering" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/freebsd-manpages-ipfilter-4freebsd.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ipfilter<small> (4freebsd)</small></h1>
        <p class="lead">Introduction to ip packet filtering</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4freebsd/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4freebsd/ipfilter.4freebsd.html">
      <span itemprop="name">ipfilter: Introduction to ip packet filtering</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/freebsd-manpages/">
      <span itemprop="name">freebsd-manpages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4freebsd/ipfilter.4freebsd.html">
      <span itemprop="name">ipfilter: Introduction to ip packet filtering</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>IP Filter is a TCP/IP packet filter, suitable for use in a firewall environment. To use, it can either be used as a loadable kernel module or incorporated into your UNIX kernel; use as a loadable kernel module where possible is highly recommended. Scripts are provided to install and patch system files, as required.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FEATURES</h2>
        <div class="sectioncontent">
<p>The IP packet filter can:</p><ul>
<li><p>explicitly deny/permit any packet from passing through</p></li><li><p>distinguish between various interfaces</p></li><li><p>filter by IP networks or hosts</p></li><li><p>selectively filter any IP protocol</p></li><li><p>selectively filter fragmented IP packets</p></li><li><p>selectively filter packets with IP options</p></li><li><p>send back an ICMP error/TCP reset for blocked packets</p></li><li><p>keep packet state information for TCP, UDP and ICMP packet flows</p></li><li><p>keep fragment state information for any IP packet, applying the same rule to all fragments.</p></li><li><p>act as a Network Address Translator (NAT)</p></li><li><p>use redirection to setup true transparent proxy connections</p></li><li><p>provide packet header details to a user program for authentication</p></li><li><p>in addition, supports temporary storage of pre-authenticated rules for passing packets through</p></li>
</ul><p>Special provision is made for the three most common Internet protocols, TCP, UDP and ICMP. The IP Packet filter allows filtering of:</p><ul>
<li><p>Inverted host/net matchingTCP/UDP packets by port number or a port number range</p></li><li><p>ICMP packets by type/code</p></li><li><p>"established" TCP packets</p></li><li><p>On any arbitrary combination of TCP flags</p></li><li><p>"short" (fragmented) IP packets with incomplete headers can be filtered</p></li><li><p>any of the 19 IP options or 8 registered IP security classes TOS (Type of Service) field in packets</p></li>
</ul><p>To keep track of the performance of the IP packet filter, a logging device is used which supports logging of:</p><ul>
<li><p>the TCP/UDP/ICMP and IP packet headers</p></li><li><p>the first 128 bytes of the packet (including headers)</p></li>
</ul><p>A packet can be logged when:</p><ul>
<li><p>it is successfully passed through</p></li><li><p>it is blocked from passing through</p></li><li><p>it matches a rule setup to look for suspicious packets</p></li>
</ul><p>IP Filter keeps its own set of statistics on:</p><ul>
<li><p>packets blocked</p></li><li><p>packets (and bytes!) used for accounting</p></li><li><p>packets passed</p></li><li><p>packets logged</p></li><li><p>attempts to log which failed (buffer full)</p></li><li><p>and much more, for packets going both in and out.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Tools</h2>
        <div class="sectioncontent">
<p>The current implementation provides a small set of tools, which can easily be used and integrated with regular unix shells and tools. A brief description of the tools provided:</p><p><strong>ipf</strong>(8) reads in a set of rules, from either stdin or a file, and adds them to the kernels current list (appending them). It can also be used to flush the current filter set or delete individual filter rules. The file format is described in <strong>ipf</strong>(5).</p><p><strong>ipfs</strong>(8) is a utility to temporarily lock the IP Filter kernel tables (state tables and NAT mappings) and write them to disk. After that the system can be rebooted, and ipfs can be used to read these tables from disk and restore them into the kernel. This way the system can be rebooted without the connections being terminated.</p><p><strong>ipfstat</strong>(8) interrogates the kernel for statistics on packet filtering, so far, and retrieves the list of filters in operation for inbound and outbound packets.</p><p><strong>ipftest</strong>(1) reads in a filter rule file and then applies sample IP packets to the rule file. This allows for testing of filter list and examination of how a packet is passed along through it.</p><p><strong>ipmon</strong>(8) reads buffered data from the logging device (default is /dev/ipl) for output to either:</p><ul>
<li><p>screen (standard output)</p></li><li><p>file</p></li><li><p>syslog</p></li>
</ul><p><strong>ipsend</strong>(1) generates arbitary IP packets for ethernet connected machines.</p><p><strong>ipresend</strong>(1) reads in a data file of saved IP packets (ie snoop/tcpdump/etherfind output) and sends it back across the network.</p><p><strong>iptest</strong>(1) contains a set of test "programs" which send out a series of IP packets, aimed at testing the strength of the TCP/IP stack at which it is aimed at. WARNING: this may crash machine(s) targeted!</p><p><strong>ipnat</strong>(8) reads in a set of rules, from either stdin or a file and adds them to the kernels current list of active NAT rules. NAT rules can also be deleted using ipnat. The format of the configuration file to be used with ipnat is described in <strong>ipnat</strong>(5).</p><p>For use in your own programs (e.g. for writing of transparent application proxies), the programming interface and the associated ioctl's are documented in <strong>ipf</strong>(4).</p><p>Documentation on ioctl's and the format of data saved to the logging character device is provided in <strong>ipl</strong>(4) so that you may develop your own applications to work with or in place of any of the above.</p><p>Similar, the interface to the NAT code is documented in <strong>ipnat</strong>(4).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PACKET PROCESSING FLOW</h2>
        <div class="sectioncontent">
<p>The following diagram illustrates the flow of TCP/IP packets through the various stages introduced by IP Filter.</p>
<pre>
                                   IN
                                    |
                                    V
          +-------------------------+--------------------------+
          |                         |                          |
          |                         V                          |
          |            Network Address Translation             |
          |                         |                          |
          |         authenticated   |                          |
          |       +-------&lt;---------+                          |
          |       |                 |                          |
          |       |                 V                          |
          |       V           IP Accounting                    |
          |       |                 |                          |
          |       |                 V                          |
          |       |        Fragment Cache Check--+             |
          |       |                 |            |             |
          |       V                 V            V             |
          |       |         Packet State Check--&gt;+             |
          |       |                 |            |             |
          |       |       +-&gt;--+    |            |             |
          |       |       |    |    V            |             |
          |       V   groups   IP Filtering      V             |
          |       |       |    |    |            |             |
          |       |       +--&lt;-+    |            |             |
          |       |                 |            |             |
          |       +----------------&gt;|&lt;-----------+             |
          |                         |                          |
          |                         V                          |
          |                +---&lt;----+                          |
          |                |        |                          |
          |            function     |                          |
          |                |        V                          |
          |                +---&gt;----+                          |
          |                         |                          |
          |                         V                          |
       +--|---&lt;--- fast-route ---&lt;--+                          |
       |  |                         |                          |
       |  |                         V                          |
       |  +-------------------------+--------------------------+
       |                            |
       |                        pass only
       |                            |
       |                            V
       V               [KERNEL TCP/IP Processing]
       |                            |
       |  +-------------------------+--------------------------+
       |  |                         |                          |
       |  |                         V                          |
       |  |                Fragment Cache Check--+             |
       |  |                         |            |             |
       |  |                         V            V             |
       |  |                 Packet State Check--&gt;+             |
       |  |                         |            |             |
       |  |                         V            |             |
       V  |                    IP Filtering      |             |
       |  |                         |            V             |
       |  |                         |&lt;-----------+             |
       |  |                         V                          |
       |  |                   IP Accounting                    |
       |  |                         |                          |
       |  |                         V                          |
       |  |            Network Address Translation             |
       |  |                         |                          |
       |  |                         V                          |
       |  +-------------------------+--------------------------+
       |                            |
       |                        pass only
       V                            |
       +---------------------------&gt;|
                                    V
                                   OUT
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MORE INFORMATION</h2>
        <div class="sectioncontent">
<p>More information (including pointers to the FAQ and the mailing list) can be obtained from the sofware's official homepage: www.ipfilter.org</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ipfilter&hellip;</h2>
        <div class="sectioncontent">
<p><strong>ipf</strong>(4), <strong>ipf</strong>(5), <strong>ipf</strong>(8), <strong>ipfilter</strong>(5), <strong>ipfs</strong>(8), <strong>ipfstat</strong>(8), <strong>ipftest</strong>(1), <strong>ipl</strong>(4), <strong>ipmon</strong>(8), <strong>ipnat</strong>(8), <strong>ipnat</strong>(4),</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ipf.4freebsd.html"><span aria-hidden="true">&larr;</span> ipf.4freebsd: Packet filtering kernel interface</a></li>
   <li class="next"><a href="ipl.4freebsd.html">ipl.4freebsd: Ip packet log device <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
