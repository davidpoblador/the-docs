<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>adapt: Mesh adaptation</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Mesh adaptation">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="adapt (4rheolef) manual">
  <meta name="twitter:description" content="Mesh adaptation">
  <meta name="twitter:image" content="https://www.carta.tech/images/librheolef-dev-adapt-4rheolef.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man4rheolef/adapt.4rheolef.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="adapt (4rheolef) manual" />
  <meta property="og:description" content="Mesh adaptation" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/librheolef-dev-adapt-4rheolef.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">adapt<small> (4rheolef)</small></h1>
        <p class="lead">Mesh adaptation</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4rheolef/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4rheolef/adapt.4rheolef.html">
      <span itemprop="name">adapt: Mesh adaptation</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/librheolef-dev/">
      <span itemprop="name">librheolef-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man4rheolef/adapt.4rheolef.html">
      <span itemprop="name">adapt: Mesh adaptation</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSYS</h2>
        <div class="sectioncontent">
<p> geo adapt (const field& phi);  geo adapt (const field& phi, const adapt_option_type& opts);</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p> The function <strong>adapt</strong> implements the mesh adaptation procedure,  based on the <strong>gmsh</strong> (isotropic) or <strong>bamg</strong> (anisotropic) mesh generators.  The <strong>bamg</strong> mesh generator is the default in two dimension.  For dimension one or three, <strong>gmsh</strong> is the only generator supported yet.  In the two dimensional case, the <strong>gmsh</strong> correspond to the <strong>opts.generator="gmsh"</strong>.</p><p> The strategy based on a metric determined from the Hessian of  a scalar governing field, denoted as <strong>phi</strong>, and that is supplied by the user.  Let us denote by <strong>H=Hessian(phi)</strong> the Hessian tensor of the field <strong>phi</strong>.  Then, <strong>|H|</strong> denote the tensor that has the same eigenvector as <strong>H</strong>,  but with absolute value of its eigenvalues:</p>
<pre>
  |H| = Q*diag(|lambda_i|)*Qt
</pre>
<p> The metric <strong>M</strong> is determined from <strong>|H|</strong>.  Recall that an isotropic metric is such that <strong>M(x)=hloc(x)^(-2)*Id</strong>  where <strong>hloc(x)</strong> is the element size field and <strong>Id</strong> is the  identity <strong>d*d</strong> matrix, and <strong>d=1,2,3</strong> is the physical space dimension.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GMSH ISOTROPIC METRIC</h2>
        <div class="sectioncontent">

<pre>
            max_(i=0..d-1)(|lambda_i(x)|)*Id
  M(x) = -----------------------------------------
         err*hcoef^2*(sup_y(phi(y))-inf_y(phi(y)))
</pre>
<p> Notice that the denominator involves a global (absolute) normalization  <strong>sup_y(phi(y))-inf_y(phi(y))</strong> of the governing field <strong>phi</strong>  and the two parameters <strong>opts.err</strong>, the target error,  and <strong>opts.hcoef</strong>, a secondary normalization parameter (defaults to 1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BAMG ANISOTROPIC METRIC</h2>
        <div class="sectioncontent">
<p> There are two approach for the normalization of the metric.  The first one involves a global (absolute) normalization:</p>
<pre>
                         |H(x))|
  M(x) = -----------------------------------------
         err*hcoef^2*(sup_y(phi(y))-inf_y(phi(y)))
</pre>
<p> The first one involves a local (relative) normalization:</p>
<pre>
                         |H(x))|
  M(x) = -----------------------------------------
         err*hcoef^2*(|phi(x)|, cutoff*max_y|phi(y)|)
</pre>
<p> Notice that the denominator involves a local value <strong>phi(x)</strong>.  The parameter is provided by the optional variable <strong>opts.cutoff</strong>;  its default value is <strong>1e-7</strong>.  The default strategy is the local normalization.  The global normalization can be enforced by setting  <strong>opts.additional="-AbsError"</strong>.</p><p> When choosing global or local normalization ?</p><p> When the governing field <strong>phi</strong> is bounded,  i.e. when <strong>err*hcoef^2*(sup_y(phi(y))-inf_y(phi(y)))</strong>  will converge versus mesh refinement to a bounded value,  the global normalization defines a metric that is mesh-independent  and thus the adaptation loop will converge.</p><p> Otherwise, when <strong>phi</strong> presents singularities, with unbounded  values (such as corner singularity, i.e. presents peacks when represented  in elevation view), then the mesh adaptation procedure  is more difficult. The global normalization  divides by quantities that can be very large  and the mesh adaptation  can diverges when focusing on the singularities.  In that case, the local normalization is preferable.  Moreover, the focus on singularities can also be controled  by setting <strong>opts.hmin</strong> not too small.</p><p> The local normalization has been choosen as the default since it is  more robust. When your field <strong>phi</strong> does not present singularities,  then you can swith to the global numbering that leads to a best  equirepartition of the error over the domain.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IMPLEMENTATION</h2>
        <div class="sectioncontent">

<pre>
struct adapt_option_type {
    typedef std::vector&lt;int&gt;::size_type size_type;
    std::string generator;
    bool isotropic;
    Float err;
    Float errg;
    Float hcoef;
    Float hmin;
    Float hmax;
    Float ratio;
    Float cutoff;
    size_type n_vertices_max;
    size_type n_smooth_metric;
    bool splitpbedge;
    Float thetaquad;
    Float anisomax;
    bool clean;
    std::string additional;
    bool double_precision;
    Float anglecorner;  // angle below which bamg considers 2 consecutive edge to be part of
                        // the same spline
    adapt_option_type() :
        generator(""),
        isotropic(true), err(1e-2), errg(1e-1), <strong>hcoef</strong>(1), hmin(0.0001), hmax(0.3), <strong>ratio</strong>(0), cutoff(1e-7),
        n_vertices_max(50000), <strong>n_smooth_metric</strong>(1),
        splitpbedge(true), thetaquad(std::numeric_limits&lt;Float&gt;::max()),
        anisomax(1e6), clean(false), additional("-RelError"), double_precision(false),
        <strong>anglecorner</strong>(0)
     {}
};
template &lt;class T, class M&gt;
geo_basic&lt;T,M&gt;
adapt (
  const field_basic&lt;T,M&gt;& phi,
  const adapt_option_type& options = adapt_option_type());
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="next"><a href="catchmark.4rheolef.html">catchmark.4rheolef: Iostream manipulator <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
