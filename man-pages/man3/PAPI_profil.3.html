<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PAPI_profil: Generate a histogram of hardware counter overflows vs. pc addresses.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Generate a histogram of hardware counter overflows vs. pc addresses.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="PAPI_profil (3) manual">
  <meta name="twitter:description" content="Generate a histogram of hardware counter overflows vs. pc addresses.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libpapi-dev-PAPI_profil-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/PAPI_profil.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PAPI_profil (3) manual" />
  <meta property="og:description" content="Generate a histogram of hardware counter overflows vs. pc addresses." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libpapi-dev-PAPI_profil-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">PAPI_profil<small> (3)</small></h1>
        <p class="lead">Generate a histogram of hardware counter overflows vs. pc addresses.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/PAPI_profil.3.html">
      <span itemprop="name">PAPI_profil: Generate a histogram of hardware counter overflows vs. pc addresses.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libpapi-dev/">
      <span itemprop="name">libpapi-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/PAPI_profil.3.html">
      <span itemprop="name">PAPI_profil: Generate a histogram of hardware counter overflows vs. pc addresses.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p><strong>C Interface:</strong></p><p>#include &lt;<strong>papi.h</strong>&gt;</p><p> int <strong>PAPI_profil</strong>(void *buf, unsigned bufsiz, unsigned long offset, unsigned scale, int EventSet, int EventCode, int threshold, int flags );</p><p><strong>Fortran Interface</strong></p><p>The profiling routines have no Fortran interface.</p><p><strong>Parameters:</strong></p><p><em>*buf</em> -- pointer to a buffer of bufsiz bytes in which the histogram counts are stored in an array of unsigned short, unsigned int, or unsigned long long values, or 'buckets'. The size of the buckets is determined by values in the flags argument.</p><p><em>bufsiz</em> -- the size of the histogram buffer in bytes. It is computed from the length of the code region to be profiled, the size of the buckets, and the scale factor as discussed above.</p><p><em>offset</em> -- the start address of the region to be profiled.</p><p><em>scale</em> -- broadly and historically speaking, a contraction factor that indicates how much smaller the histogram buffer is than the region to be profiled. More precisely, scale is interpreted as an unsigned 16-bit fixed-point fraction with the decimal point implied on the left. Its value is the reciprocal of the number of addresses in a subdivision, per counter of histogram buffer. Below is a table of representative values for scale.</p><p><em>EventSet</em> -- The PAPI EventSet to profile. This EventSet is marked as profiling-ready, but profiling doesn't actually start until a <strong>PAPI_start()</strong> call is issued.</p><p><em>EventCode</em> -- Code of the Event in the EventSet to profile. This event must already be a member of the EventSet.</p><p><em>threshold</em> -- minimum number of events that must occur before the PC is sampled. If hardware overflow is supported for your component, this threshold will trigger an interrupt when reached. Otherwise, the counters will be sampled periodically and the PC will be recorded for the first sample that exceeds the threshold. If the value of threshold is 0, profiling will be disabled for this event.</p><p><em>flags</em> -- bit pattern to control profiling behavior. Defined values are shown in the table above.</p><p><strong>Return values:</strong></p><p><em>PAPI_OK</em></p><p><em>PAPI_EINVAL</em> One or more of the arguments is invalid.</p><p><em>PAPI_ENOMEM</em> Insufficient memory to complete the operation.</p><p><em>PAPI_ENOEVST</em> The EventSet specified does not exist.</p><p><em>PAPI_EISRUN</em> The EventSet is currently counting events.</p><p><em>PAPI_ECNFLCT</em> The underlying counter hardware can not count this event and other events in the EventSet simultaneously.</p><p><em>PAPI_ENOEVNT</em> The PAPI preset is not available on the underlying hardware.</p><p><strong>PAPI_profil()</strong> provides hardware event statistics by profiling the occurence of specified hardware counter events. It is designed to mimic the UNIX SVR4 profil call.</p><p>The statistics are generated by creating a histogram of hardware counter event overflows vs. program counter addresses for the current process. The histogram is defined for a specific region of program code to be profiled, and the identified region is logically broken up into a set of equal size subdivisions, each of which corresponds to a count in the histogram.</p><p>With each hardware event overflow, the current subdivision is identified and its corresponding histogram count is incremented. These counts establish a relative measure of how many hardware counter events are occuring in each code subdivision.</p><p>The resulting histogram counts for a profiled region can be used to identify those program addresses that generate a disproportionately high percentage of the event of interest.</p><p>Events to be profiled are specified with the EventSet and EventCode parameters. More than one event can be simultaneously profiled by calling <strong>PAPI_profil()</strong> several times with different EventCode values. Profiling can be turned off for a given event by calling <strong>PAPI_profil()</strong> with a threshold value of 0.</p><p><strong>Representative values for the scale variable</strong></p>
<pre>
  HEX      DECIMAL  DEFININTION
  0x20000  131072   Maps precisely one instruction address to a unique bucket in buf.
  0x10000   65536   Maps precisely two instruction addresses to a unique bucket in buf.
  0x0FFFF   65535   Maps approximately two instruction addresses to a unique bucket in buf.
  0x08000   32768   Maps every four instruction addresses to a bucket in buf.
  0x04000   16384   Maps every eight instruction addresses to a bucket in buf.
  0x00002       2   Maps all instruction addresses to the same bucket in buf.
  0x00001       1   Undefined.
  0x00000       0   Undefined.
</pre>
<p>Historically, the scale factor was introduced to allow the allocation of buffers smaller than the code size to be profiled. Data and instruction sizes were assumed to be multiples of 16-bits. These assumptions are no longer necessarily true. <strong>PAPI_profil()</strong> has preserved the traditional definition of scale where appropriate, but deprecated the definitions for 0 and 1 (disable scaling) and extended the range of scale to include 65536 and 131072 to allow for exactly two addresses and exactly one address per profiling bucket.</p><p>The value of bufsiz is computed as follows:</p><p>bufsiz = (end - start)*(bucket_size/2)*(scale/65536) where</p><ul>
<li><p>bufsiz - the size of the buffer in bytes</p></li><li><p>end, start - the ending and starting addresses of the profiled region</p></li><li><p>bucket_size - the size of each bucket in bytes; 2, 4, or 8 as defined in flags</p></li>
</ul><p><strong>Defined bits for the flags variable:</strong></p><ul>
<li><p>PAPI_PROFIL_POSIX Default type of profiling, similar to profil (3).</p></li><li><p>PAPI_PROFIL_RANDOM Drop a random 25% of the samples.</p></li><li><p>PAPI_PROFIL_WEIGHTED Weight the samples by their value.</p></li><li><p>PAPI_PROFIL_COMPRESS Ignore samples as values in the hash buckets get big.</p></li><li><p>PAPI_PROFIL_BUCKET_16 Use unsigned short (16 bit) buckets, This is the default bucket.</p></li><li><p>PAPI_PROFIL_BUCKET_32 Use unsigned int (32 bit) buckets.</p></li><li><p>PAPI_PROFIL_BUCKET_64 Use unsigned long long (64 bit) buckets.</p></li><li><p>PAPI_PROFIL_FORCE_SW Force software overflow in profiling.</p></li>
</ul><p><strong>Example</strong></p>
<pre>
* int retval;
* unsigned long length;
* PAPI_exe_info_t *prginfo;
* unsigned short *profbuf;
*
* if ((prginfo = PAPI_get_executable_info()) == NULL)
*    <strong>handle_error</strong>(1);
*
* length = (unsigned long)(prginfo-&gt;text_end - prginfo-&gt;text_start);
*
* profbuf = (unsigned short *)malloc(length);
* if (profbuf == NULL)
*    <strong>handle_error</strong>(1);
* memset(profbuf,0x00,length);
*
* if ((retval = PAPI_profil(profbuf, length, start, 65536, EventSet,
*     PAPI_FP_INS, 1000000, PAPI_PROFIL_POSIX | PAPI_PROFIL_BUCKET_16))
*    != PAPI_OK)
*    handle_error(retval);
*

</pre>
<p><strong>See Also:</strong></p><p><strong>PAPI_overflow</strong></p><p><strong>PAPI_sprofil</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for PAPI from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="PAPI_preload_info_t.3.html"><span aria-hidden="true">&larr;</span> PAPI_preload_info_t.3: Papi_preload_info_t -</a></li>
   <li class="next"><a href="PAPI_query_event.3.html">PAPI_query_event.3: Query if papi event exists. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
