<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mail::DKIM::Verifier: Verifies a dkim-signed message</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Verifies a dkim-signed message">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Mail::DKIM::Verifier (3pm) manual">
  <meta name="twitter:description" content="Verifies a dkim-signed message">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmail-dkim-perl-Mail::DKIM::Verifier-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Mail::DKIM::Verifier.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Mail::DKIM::Verifier (3pm) manual" />
  <meta property="og:description" content="Verifies a dkim-signed message" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmail-dkim-perl-Mail::DKIM::Verifier-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Mail::DKIM::Verifier<small> (3pm)</small></h1>
        <p class="lead">Verifies a dkim-signed message</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Mail::DKIM::Verifier.3pm.html">
      <span itemprop="name">Mail::DKIM::Verifier: Verifies a dkim-signed message</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmail-dkim-perl/">
      <span itemprop="name">libmail-dkim-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Mail::DKIM::Verifier.3pm.html">
      <span itemprop="name">Mail::DKIM::Verifier: Verifies a dkim-signed message</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use Mail::DKIM::Verifier;

  # create a verifier object
  my $dkim = Mail::DKIM::Verifier-&gt;new();

  # read an email from a file handle
  $dkim-&gt;load(*STDIN);

  # or read an email and pass it into the verifier, incrementally
  while (&lt;STDIN&gt;)
  {
      # remove local line terminators
      chomp;
      s/&#92;015$//;

      # use SMTP line terminators
      $dkim-&gt;PRINT("$_&#92;015&#92;012");
  }
  $dkim-&gt;CLOSE;

  # what is the result of the verify?
  my $result = $dkim-&gt;result;

  # there might be multiple signatures, what is the result per signature?
  foreach my $signature ($dkim-&gt;signatures)
  {
      print "signature identity: " . $signature-&gt;identity . "&#92;n";
      print "verify result: " . $signature-&gt;result_detail . "&#92;n";
  }

  # the alleged author of the email may specify how to handle email
  foreach my $policy ($dkim-&gt;policies)
  {
      die "fraudulent message" if ($policy-&gt;apply($dkim) eq "reject");
  }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The verifier object allows an email message to be scanned for \s-1DKIM\s0 and DomainKeys signatures and those signatures to be verified. The verifier tracks the state of the message as it is read into memory. When the message has been completely read, the signatures are verified and the results of the verification can be accessed.</p><p>To use the verifier, first create the verifier object. Then start \*(L"feeding\*(R" it the email message to be verified. When all the _headers_ have been read, the verifier:</p><p> 1. checks whether any DomainKeys/DKIM signatures were found  2. queries for the public keys needed to verify the signatures  3. sets up the appropriate algorithms and canonicalization objects  4. canonicalizes the headers and computes the header hash</p><p>Then, when the _body_ of the message has been completely fed into the verifier, the body hash is computed and the signatures are verified.</p><p>The results of the verification can be checked with \*(L"<em>result()</em>\*(R" or \*(L"<em>signatures()</em>\*(R".</p><p>Messages that do not verify may be checked against the alleged sender's published signing policy with \*(L"<em>policies()</em>\*(R" and \*(L"<em>apply()</em>\*(R" in Mail::DKIM::Policy.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR</h2>
        <div class="sectioncontent">
<h3>\fInew()\fP</h3>
<p>Constructs an object-oriented verifier.</p><p>  my $dkim = Mail::DKIM::Verifier-&gt;new();</p><p>  my $dkim = Mail::DKIM::Verifier-&gt;new(%options);</p><p>The only option supported at this time is:</p>
<dl class='dl-vertical'>
  <dt>
    Debug_Canonicalization
  </dt>
  <dd>
    <p>if specified, the canonicalized message for the first signature is written to the referenced string or file handle.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>\s-1\fIPRINT\s0()\fP</h3>
<p>Feeds part of the message to the verifier.</p><p>  $dkim-&gt;PRINT("a line of the message&#92;015&#92;012");   $dkim-&gt;PRINT("more of");   $dkim-&gt;PRINT(" the message&#92;015&#92;012bye&#92;015&#92;012");</p><p>Feeds content of the message being verified into the verifier. The \s-1API\s0 is designed this way so that the entire message does \s-1NOT\s0 need to be read into memory at once.</p><p>Please note that although the \s-1<em>PRINT\s0()</em> method expects you to use SMTP-style line termination characters, you should \s-1NOT\s0 use the SMTP-style dot-stuffing technique described in \s-1RFC\s0 2821 section 4.5.2. Nor should you use a &lt;\s-1CR\s0&gt;&lt;\s-1LF\s0&gt;.&lt;\s-1CR\s0&gt;&lt;\s-1LF\s0&gt; sequence to terminate the message.</p>
<h3>\s-1\fICLOSE\s0()\fP</h3>
<p>Call this when finished feeding in the message.</p><p>  $dkim-&gt;CLOSE;</p><p>This method finishes the canonicalization process, computes a hash, and verifies the signature.</p>
<h3>\fIfetch_author_domain_policies()\fP</h3>
<p>Retrieves \s-1ADSP\s0 records from \s-1DNS\s0.</p><p>  my @policies = $dkim-&gt;fetch_author_domain_policies;   foreach my $policy (@policies)   {       my $policy_result = $policy-&gt;apply($dkim);   }</p><p>This method will retrieve all applicable \*(L"author-domain-signing-practices\*(R" published in \s-1DNS\s0 for this message. Author policies are keyed to the email address(es) in the From: header, i.e. the claimed author of the message.</p><p>This method returns a *list* of policy records, since there is allowed to be zero or multiple email addresses in the From: header.</p><p>The result of the <em>apply()</em> method is one of: \*(L"accept\*(R", \*(L"reject\*(R", \*(L"neutral\*(R".</p><p>See also: \*(L"<em>policies()</em>\*(R".</p>
<h3>\fIfetch_author_policy()\fP</h3>
<p>Retrieves a signing policy from \s-1DNS\s0.</p><p>  my $policy = $dkim-&gt;fetch_author_policy;   my $policy_result = $policy-&gt;apply($dkim);</p><p>This method retrieves the \s-1DKIM\s0 Sender Signing Practices record as described in Internet Draft draft-ietf-dkim-ssp-00-01dc. This Internet Draft is now obsolete; this method is only kept for backward-compatibility purposes.</p><p>Please use the \*(L"<em>policies()</em>\*(R" method instead.</p>
<h3>\fIfetch_sender_policy()\fP</h3>
<p>Retrieves a signing policy from \s-1DNS\s0.</p><p>  my $policy = $dkim-&gt;fetch_sender_policy;   my $policy_result = $policy-&gt;apply($dkim);</p><p>The \*(L"sender\*(R" policy is the sender signing policy as described by the DomainKeys specification, now available in \s-1RFC4870\s0(historical). I call it the \*(L"sender\*(R" policy because it is keyed to the email address in the Sender: header, or the From: header if there is no Sender header. This is the person whom the message claims as the \*(L"transmitter\*(R" of the message (not necessarily the author).</p><p>If the email being verified has no From or Sender header from which to get an email address (which violates email standards), then this method will \*(C`die\*(C'.</p><p>The result of the <em>apply()</em> method is one of: \*(L"accept\*(R", \*(L"reject\*(R", \*(L"neutral\*(R".</p><p>See also: \*(L"<em>policies()</em>\*(R".</p>
<h3>\fIload()\fP</h3>
<p>Load the entire message from a file handle.</p><p>  $dkim-&gt;load($file_handle);</p><p>Reads a complete message from the designated file handle, feeding it into the verifier. The message must use &lt;\s-1CRLF\s0&gt; line terminators (same as the \s-1SMTP\s0 protocol).</p>
<h3>\fImessage_originator()\fP</h3>
<p>Access the \*(L"From\*(R" header.</p><p>  my $address = $dkim-&gt;message_originator;</p><p>Returns the \*(L"originator address\*(R" found in the message, as a Mail::Address object. This is typically the (first) name and email address found in the From: header. If there is no From: header, then an empty Mail::Address object is returned.</p><p>To get just the email address part, do:</p><p>  my $email = $dkim-&gt;message_originator-&gt;address;</p><p>See also \*(L"<em>message_sender()</em>\*(R".</p>
<h3>\fImessage_sender()\fP</h3>
<p>Access the \*(L"From\*(R" or \*(L"Sender\*(R" header.</p><p>  my $address = $dkim-&gt;message_sender;</p><p>Returns the \*(L"sender\*(R" found in the message, as a Mail::Address object. This is typically the (first) name and email address found in the Sender: header. If there is no Sender: header, it is the first name and email address in the From: header. If neither header is present, then an empty Mail::Address object is returned.</p><p>To get just the email address part, do:</p><p>  my $email = $dkim-&gt;message_sender-&gt;address;</p><p>The \*(L"sender\*(R" is the mailbox of the agent responsible for the actual transmission of the message. For example, if a secretary were to send a message for another person, the \*(L"sender\*(R" would be the secretary and the \*(L"originator\*(R" would be the actual author.</p>
<h3>\fIpolicies()\fP</h3>
<p>Retrieves applicable signing policies from \s-1DNS\s0.</p><p>  my @policies = $dkim-&gt;policies;   foreach my $policy (@policies)   {       $policy_result = $policy-&gt;apply($dkim);       # $policy_result is one of "accept", "reject", "neutral"   }</p><p>This method searches for and returns any signing policies that would apply to this message. Signing policies are selected based on the domain that the message *claims* to be from. So, for example, if a message claims to be from security@bank, and forwarded by trusted@listserv, when in reality the message came from foe@evilcorp, this method would check for signing policies for security@bank and trusted@listserv. The signing policies might tell whether foe@evilcorp (the real sender) is allowed to send mail claiming to be from your bank or your listserv.</p><p>I say \*(L"might tell\*(R", because in reality this is still really hard to specify with any accuracy. In addition, most senders do not publish useful policies.</p>
<h3>\fIresult()\fP</h3>
<p>Access the result of the verification.</p><p>  my $result = $dkim-&gt;result;</p><p>Gives the result of the verification. The following values are possible:</p>
<dl class='dl-vertical'>
  <dt>
    pass
  </dt>
  <dd>
    <p>Returned if a valid DKIM-Signature header was found, and the signature contains a correct value for the message.</p>
  </dd>
  <dt>
    fail
  </dt>
  <dd>
    <p>Returned if a valid DKIM-Signature header was found, but the signature does not contain a correct value for the message.</p>
  </dd>
  <dt>
    invalid
  </dt>
  <dd>
    <p>Returned if a DKIM-Signature could not be checked because of a problem in the signature itself or the public key record. I.e. the signature could not be processed.</p>
  </dd>
  <dt>
    temperror
  </dt>
  <dd>
    <p>Returned if a DKIM-Signature could not be checked due to some error which is likely transient in nature, such as a temporary inability to retrieve a public key. A later attempt may produce a better result.</p>
  </dd>
  <dt>
    none
  </dt>
  <dd>
    <p>Returned if no DKIM-Signature headers (valid or invalid) were found.</p>
  </dd>

</dl>
<p>In case of multiple signatures, the \*(L"best\*(R" result will be returned. Best is defined as \*(L"pass\*(R", followed by \*(L"fail\*(R", \*(L"invalid\*(R", and \*(L"none\*(R". To examine the results of individual signatures, use the \*(L"<em>signatures()</em>\*(R" method to retrieve the signature objects. See \*(L"<em>result()</em>\*(R" in Mail::DKIM::Signature.</p>
<h3>\fIresult_detail()\fP</h3>
<p>Access the result, plus details if available.</p><p>  my $detail = $dkim-&gt;result_detail;</p><p>The detail is constructed by taking the result (e.g. \*(L"pass\*(R", \*(L"fail\*(R", \*(L"invalid\*(R" or \*(L"none\*(R") and appending any details provided by the verification process in parenthesis.</p><p>The following are possible results from the <em>result_detail()</em> method:</p><p>  pass   fail (bad RSA signature)   fail (OpenSSL error: ...)   fail (message has been altered)   fail (body has been altered)   invalid (bad identity)   invalid (invalid domain in d tag)   invalid (missing q tag)   invalid (missing d tag)   invalid (missing s tag)   invalid (unsupported version 0.1)   invalid (unsupported algorithm ...)   invalid (unsupported canonicalization ...)   invalid (unsupported query protocol ...)   invalid (signature is expired)   invalid (public key: not available)   invalid (public key: unknown query type ...)   invalid (public key: syntax error)   invalid (public key: unsupported version)   invalid (public key: unsupported key type)   invalid (public key: missing p= tag)   invalid (public key: invalid data)   invalid (public key: does not support email)   invalid (public key: does not support hash algorithm &apos;sha1&apos;)   invalid (public key: does not support signing subdomains)   invalid (public key: revoked)   invalid (public key: granularity mismatch)   invalid (public key: granularity is empty)   invalid (public key: OpenSSL error: ...)   none</p>
<h3>\fIsignature()\fP</h3>
<p>Access the message's \s-1DKIM\s0 signature.</p><p>  my $sig = $dkim-&gt;signature;</p><p>Accesses the signature found and verified in this message. The returned object is of type Mail::DKIM::Signature.</p><p>In case of multiple signatures, the signature with the \*(L"best\*(R" result will be returned. Best is defined as \*(L"pass\*(R", followed by \*(L"fail\*(R", \*(L"invalid\*(R", and \*(L"none\*(R".</p>
<h3>\fIsignatures()\fP</h3>
<p>Access all of this message's signatures.</p><p>  my @all_signatures = $dkim-&gt;signatures;</p><p>Use $signature-&gt;result or $signature-&gt;result_detail to access the verification results of each signature.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jason Long, &lt;jlong@messiah.edu&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2006-2009 by Messiah College</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself, either Perl version 5.8.6 or, at your option, any later version of Perl 5 you may have available.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Mail::DKIM::TextWrap.3pm.html"><span aria-hidden="true">&larr;</span> Mail::DKIM::TextWrap.3pm: Text wrapping module written for use with dkim</a></li>
   <li class="next"><a href="Mail::Field::Received.3pm.html">Mail::Field::Received.3pm: Mostly rfc822-compliant parser of received headers <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
