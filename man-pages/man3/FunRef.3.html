<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FunRef: The funtools reference handle</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The funtools reference handle">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="FunRef (3) manual">
  <meta name="twitter:description" content="The funtools reference handle">
  <meta name="twitter:image" content="https://www.carta.tech/images/libfuntools-dev-FunRef-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/FunRef.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="FunRef (3) manual" />
  <meta property="og:description" content="The funtools reference handle" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libfuntools-dev-FunRef-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">FunRef<small> (3)</small></h1>
        <p class="lead">The funtools reference handle</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/FunRef.3.html">
      <span itemprop="name">FunRef: The funtools reference handle</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libfuntools-dev/">
      <span itemprop="name">libfuntools-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/FunRef.3.html">
      <span itemprop="name">FunRef: The funtools reference handle</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>A description of how to use a Funtools reference handle to connect a Funtools input file to an output file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The Funtools reference handle connects a Funtools input file to a Funtools output file so that parameters (or even whole extensions) can be copied from the one to the other. To make the connection, the Funtools handle of the input file is passed to the final argument of the <em>FunOpen()</em> call for the output file:</p>
<pre>
  if( !(ifun = FunOpen(argv[1], "r", NULL)) )
    gerror(stderr, "could not FunOpen input file: %s&#92;n", argv[1]);
  if( !(ofun = FunOpen(argv[2], "w", ifun)) )
    gerror(stderr, "could not FunOpen output file: %s&#92;n", argv[2]);
</pre>
<p>It does not matter what type of input or output file (or extension) is opened, or whether they are the same type. When the output image or binary table is written using <em>FunImagePut()</em> or <em>FunTableRowPut()</em> an appropriate header will be written first, with parameters copied from the input extension. Of course, invalid parameters will be removed first, e.g., if the input is a binary table and the output is an image, then binary table parameters such as \s-1TFORM\s0, \s-1TUNIT\s0, etc. parameters will not be copied to the output.</p><p>Use of a reference handle also allows default values to be passed to <em>FunImagePut()</em> in order to write out an output image with the same dimensions and data type as the input image. To use the defaults from the input, a value of 0 is entered for dim1, dim2, and bitpix. For example:</p><p>  fun = FunOpen(argv[1], "r", NULL);   fun2 = FunOpen(argv[2], "w", fun);   buf = FunImageGet(fun, NULL, NULL);   ... process image data ...   FunImagePut(fun2, buf, 0, 0, 0, NULL);</p><p>Of course, you often want to get information about the data type and dimensions of the image for processing. The above code is equivalent to the following:</p><p>  fun = FunOpen(argv[1], "r", NULL);   fun2 = FunOpen(argv[2], "w", fun);   buf = FunImageGet(fun, NULL, NULL);   FunInfoGet(fun, FUN_SECT_DIM1, &dim1, FUN_SECT_DIM2, &dim2,              FUN_SECT_BITPIX, &bitpix, 0);   ... process image data ...   FunImagePut(fun2, buf, dim1, dim2, bitpix, NULL);</p><p>It is possible to change the reference handle for a given output Funtools handle using the <em>FunInfoPut()</em> routine:</p><p>  /* make the new extension the reference handle for the output file */   FunInfoPut(fun2, FUN_IFUN, &fun, 0);</p><p>When this is done, Funtools specially resets the output file to start a new output extension, which is connected to the new input reference handle. You can use this mechanism to process multiple input extensions into a single output file, by successively opening the former and setting the reference handle for the latter. For example:</p><p>  /* open a new output FITS file */   if( !(fun2 = FunOpen(argv[2], "w", NULL)) )     gerror(stderr, "could not FunOpen output file: %s&#92;n", argv[2]);   /* process each input extension in turn */   for(ext=0; ;ext++){     /* get new extension name */     sprintf(tbuf, "%s[%d]", argv[1], ext);     /* open it -- if we cannot open it, we are done */     if( !(fun=FunOpen(tbuf, "r", NULL)) )       break;     /* make the new extension the reference handle for the output file */     FunInfoPut(fun2, FUN_IFUN, &fun, 0);     ... process ...     /* flush output extension (write padding, etc.) */     FunFlush(fun2, NULL);     /* close the input extension */     FunClose(fun);   }</p><p>In this example, the output file is opened first. Then each successive input extension is opened, and the output reference handle is set to the newly opened input handle. After data processing is performed, the output extension is flushed and the input extension is closed, in preparation for the next input extension.</p><p>Finally, a reference handle can be used to copy other extensions from the input file to the output file.  Copy of other extensions is controlled by adding a \*(L"C\*(R" or \*(L"c\*(R" to the mode string of the <em>FunOpen()</em> call <strong>of the input reference file</strong>.  If \*(L"C\*(R" is specified, then other extensions are <strong>always</strong> copied (i.e., copy is forced by the application).  If \*(L"c\*(R" is used, then other extensions are copied if the user requests copying by adding a plus sign \*(L"+\*(R" to the extension name in the bracket specification.  For example, the <strong>funtable</strong> program utilizes user-specified \*(L"c\*(R" mode so that the second example below will copy all extensions:</p><p>  # copy only the EVENTS extension   csh&gt; funtable "test.ev[EVENTS,circle(512,512,10)]" foo.ev   # copy ALL extensions   csh&gt; funtable "test.ev[EVENTS+,circle(512,512,10)]" foo.ev</p><p>When extension copy is specified in the input file, the call to <em>FunOpen()</em> on the input file delays the actual file open until the output file also is opened (or until I/O is performed on the input file, which ever happens first). Then, when the output file is opened, the input file is also opened and input extensions are copied to the output file, up to the specific extension being opened. Processing of input and output extensions then proceed.</p><p>When extension processing is complete, the remaining extensions need to be copied from input to output. This can be done explicitly, using the <em>FunFlush()</em> call with the \*(L"copy=remaining\*(R" plist:</p><p>  FunFlush(fun, "copy=remaining");</p><p>Alternatively, this will happen automatically, if the output file is closed <strong>before</strong> the input file:</p><p>  /* we could explicitly flush remaining extensions that need copying */   /* FunFlush(fun2, "copy=remaining"); */   /* but if we close output before input, end flush is done automatically  */   FunClose(fun2);   FunClose(fun);</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO FunRef&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/funtools.7.html"><strong>funtools</strong>(7)</a> for a list of Funtools help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="FunParamPut.3.html"><span aria-hidden="true">&larr;</span> FunParamPut.3: Put a funtools param value</a></li>
   <li class="next"><a href="FunTableRowGet.3.html">FunTableRowGet.3: Get funtools rows <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
