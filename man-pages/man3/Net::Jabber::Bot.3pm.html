<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Net::Jabber::Bot: Automated bot creation with safeties</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Automated bot creation with safeties">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Net::Jabber::Bot (3pm) manual">
  <meta name="twitter:description" content="Automated bot creation with safeties">
  <meta name="twitter:image" content="https://www.carta.tech/images/libnet-jabber-bot-perl-Net::Jabber::Bot-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Net::Jabber::Bot.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Net::Jabber::Bot (3pm) manual" />
  <meta property="og:description" content="Automated bot creation with safeties" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libnet-jabber-bot-perl-Net::Jabber::Bot-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Net::Jabber::Bot<small> (3pm)</small></h1>
        <p class="lead">Automated bot creation with safeties</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Net::Jabber::Bot.3pm.html">
      <span itemprop="name">Net::Jabber::Bot: Automated bot creation with safeties</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libnet-jabber-bot-perl/">
      <span itemprop="name">libnet-jabber-bot-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Net::Jabber::Bot.3pm.html">
      <span itemprop="name">Net::Jabber::Bot: Automated bot creation with safeties</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>Version 2.1.5</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Program design: This is a Moose based Class.</p><p>The idea behind the module is that someone creating a bot should not really have to know a whole lot about how the Jabber protocol works in order to use it. It also allows us to abstract away all the things that can get a bot maker into trouble. Essentially the object helps protect the coders from their own mistakes.</p><p>All someone should have to know and define in the program away from the object is:</p>
<dl class='dl-vertical'>
  <dt>
    1. Config - Where to connect, how often to do things, timers, etc
  </dt>
  <dd>
    
  </dd>
  <dt>
    2. A subroutine to be called by the bot object when a new message comes in.
  </dt>
  <dd>
    
  </dd>
  <dt>
    3. A subroutine to be called by the bot object every so often that lets the user do background activities (check logs, monitor web pages, etc.),
  </dt>
  <dd>
    
  </dd>

</dl>
<p>The object at present has the following enforced safeties as long as you do not override safety mode:</p>
<dl class='dl-vertical'>
  <dt>
    1. Limits messages per second, configurable at start up, (Max is 5 per second) by requiring a sleep timer in the message sending subroutine each time one is sent.
  </dt>
  <dd>
    
  </dd>
  <dt>
    2. Endless loops of responding to self prevented by now allowing the bot message processing subroutine to know about messages from self
  </dt>
  <dd>
    
  </dd>
  <dt>
    3. Forum join grace period to prevent bot from reacting to historical messages
  </dt>
  <dd>
    
  </dd>
  <dt>
    4. Configurable aliases the bot will respond to per forum
  </dt>
  <dd>
    
  </dd>
  <dt>
    5. Limits maximum message size, preventing messages that are too large from being sent (largest configurable message size limit is 1000).
  </dt>
  <dd>
    
  </dd>
  <dt>
    6. Automatic chunking of messages to split up large messages in message sending subroutine
  </dt>
  <dd>
    
  </dd>
  <dt>
    7. Limit on messages per hour. (max configurable limit of 125) Messages are visible via log4perl, but not ever be sent once the message limit is reached for that hour.
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>new</strong>
  </dt>
  <dd>
    <p>Minimal:</p>
<pre>
    my $bot = Net::Jabber::Bot-&gt;new(
                                  server =&gt; 'host.domain.com' # Name of server when sending messages internally.
                                , conference_server =&gt; 'conference.host.domain.com'
                                , port =&gt; 522
                                , username =&gt; 'username'
                                , password =&gt; 'pasword'
                                , safety_mode =&gt; 1
                                , message_function =&gt; &#92;&new_bot_message
                                , background_function =&gt; &#92;&background_checks
                                , forums_and_responses =&gt; &#92;%forum_list
                            );
</pre>
<p>All options:</p>
<pre>
    my $bot = Net::Jabber::Bot-&gt;new(
                                  server =&gt; 'host.domain.com' # Name of server when sending messages internally.
                                , conference_server =&gt; 'conference.host.domain.com'
                                , server_host =&gt; 'talk.domain.com' # used to specify what jabber server to connect to on connect?
                                , tls =&gt; 0 # set to 1 for google
                                , connection_type =&gt; 'tcpip'
                                , port =&gt; 522
                                , username =&gt; 'username'
                                , password =&gt; 'pasword'
                                , alias =&gt; 'cpan_bot'
                                , message_function =&gt; &#92;&new_bot_message
                                , background_function =&gt; &#92;&background_checks
                                , loop_sleep_time =&gt; 15
                                , process_timeout =&gt; 5
                                , forums_and_responses =&gt; &#92;%forum_list
                                , ignore_server_messages =&gt; 1
                                , ignore_self_messages =&gt; 1
                                , out_messages_per_second =&gt; 4
                                , max_message_size =&gt; 1000
                                , max_messages_per_hour =&gt; 100
                            );
</pre>
<p>Setup the object and connect to the server. Hash values are passed to new as a hash. The following initialization variables can be passed. Only marked variables are required (\s-1TODO\s0)</p>
<dl class='dl-vertical'>
  <dt>
    <strong>safety_mode</strong>
  </dt>
  <dd>
    
<pre>
    safety_mode = (1,0)
</pre>
<p>Determines if the bot safety features are turned on and enforced. This mode is on by default. Many of the safety features are here to assure you do not crash your favorite jabber server with floods, etc. \s-1DO\s0 \s-1NOT\s0 turn it off unless you're sure you know what you're doing (not just Sledge Hammer ceratin)</p>
  </dd>
  <dt>
    <strong>server</strong>
  </dt>
  <dd>
    <p>Jabber server name</p>
  </dd>
  <dt>
    <strong>server_host</strong>
  </dt>
  <dd>
    <p>Defaults to the same value set for 'server' above. This is where the bot initially connects. For google for instance, you should set this to 'gmail.com'</p>
  </dd>
  <dt>
    <strong>conference_server</strong>
  </dt>
  <dd>
    <p>conferencee server (usually conference.$server_name)</p>
  </dd>
  <dt>
    <strong>port</strong>
  </dt>
  <dd>
    <p>Defaults to 5222</p>
  </dd>
  <dt>
    <strong>tls</strong> Boolean value. defaults to 0. for google, it is know that this value must be 1 to work.
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>connection_type</strong> defaults to 'tcpip' also takes 'http'
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>username</strong>
  </dt>
  <dd>
    <p>The user you authenticate with to access the server. Not full name, just the stuff to the left of the @...</p>
  </dd>
  <dt>
    <strong>password</strong>
  </dt>
  <dd>
    <p>password to get into the server</p>
  </dd>
  <dt>
    <strong>alias</strong>
  </dt>
  <dd>
    <p>This will be your nickname in rooms, as well as the login resource (which can't have duplicates). I couldn't come up with any reason these should not be the same so hardcoded them to be the same.</p>
  </dd>
  <dt>
    <strong>forums_and_responses</strong>
  </dt>
  <dd>
    <p>A hash ref which lists the forum names to join as the keys and the values are an array reference to a list of strings they are supposed to be responsive to. The array is order sensitive and an empty string means it is going to respond to all messages in this forum. Make sure you list this last. The found 'response string' is assumed to be at the beginning of the message. The message_funtion function will be called with the modified string. alias = jbot:, attention:     example1:</p><p>    message: &apos;jbot: help&apos;</p><p>    passed to callback: &apos;help&apos;</p>
  </dd>
  <dt>
    <strong>message_function</strong>
  </dt>
  <dd>
    <p>The subroutine the bot will call when a new message is recieved by the bot. Only called if the bot's logic decides it's something you need to know about.</p>
  </dd>
  <dt>
    <strong>background_function</strong>
  </dt>
  <dd>
    <p>The subroutine the bot will call when every so often (loop_sleep_time) to allow you to do background activities outside jabber stuff (check logs, web pages, etc.)</p>
  </dd>
  <dt>
    <strong>loop_sleep_time</strong>
  </dt>
  <dd>
    <p>Frequency background function is called.</p>
  </dd>
  <dt>
    <strong>process_timeout</strong>
  </dt>
  <dd>
    <p>Time <em>Process()</em> will wait if no new activity is received from the server</p>
  </dd>
  <dt>
    <strong>ignore_server_messages</strong>
  </dt>
  <dd>
    <p>Boolean value as to whether we should ignore messages sent to us from the jabber server (addresses can be a little cryptic and hard to process)</p>
  </dd>
  <dt>
    <strong>ignore_self_messages</strong>
  </dt>
  <dd>
    <p>Boolean value as to whether we should ignore messages sent by us. \s-1BE\s0 \s-1CAREFUL\s0 if you turn this on!!! Turning this on risks potentially endless loops. If you're going to do this, please be sure safety is turned on at least initially.</p>
  </dd>
  <dt>
    <strong>out_messages_per_second</strong>
  </dt>
  <dd>
    <p>Limits the number of messages per second. Number must be &lt;gt&gt; 0 default: 5 safety: 5</p>
  </dd>
  <dt>
    <strong>max_message_size</strong>
  </dt>
  <dd>
    <p>Specify maximimum size a message can be before it's split and sent in pieces. default: 1,000,000 safetey: 1,000</p>
  </dd>
  <dt>
    <strong>max_messages_per_hour</strong>
  </dt>
  <dd>
    <p>Limits the number of messages per hour before we refuse to send them default: 125 safetey: 166</p>
  </dd>

</dl>

  </dd>
  <dt>
    <strong>JoinForum</strong>
  </dt>
  <dd>
    <p>Joins a jabber forum and sleeps safety time. Also prevents the object from responding to messages for a grace period in efforts to get it to not respond to historical messages. This has failed sometimes. \s-1NOTE:\s0 No error detection for join failure is present at the moment. (\s-1TODO\s0)</p>
  </dd>
  <dt>
    <strong>Process</strong>
  </dt>
  <dd>
    <p>Mostly calls it's client connection's \*(L"Process\*(R" call. Also assures a timeout is enforced if not fed to the subroutine You really should not have to call this very often. You should mostly be calling <em>Start()</em> and just let the Bot kernel handle all this.</p>
  </dd>
  <dt>
    <strong>Start</strong>
  </dt>
  <dd>
    <p>Primary subroutine save new called by the program. Does an endless loop of: 1. Process 2. If Process failed, Reconnect to server over larger and larger timeout 3. run background process fed from new, telling it who I am and how many loops we have been through. 4. Enforce a sleep to prevent server floods.</p>
  </dd>
  <dt>
    <strong>ReconnectToServer</strong>
  </dt>
  <dd>
    <p>You should not ever need to use this. the <em>Start()</em> kernel usually figures this out and calls it. Internal process 1. Disconnects 3. Re-initializes</p>
  </dd>
  <dt>
    <strong>Disconnect</strong>
  </dt>
  <dd>
    <p>Disconnects from server if client object is defined. Assures the client object is deleted.</p>
  </dd>
  <dt>
    <strong>IsConnected</strong>
  </dt>
  <dd>
    <p>Reports connect state (true/false) based on the status of client_start_time.</p>
  </dd>
  <dt>
    <strong>_process_jabber_message</strong> - \s-1DO\s0 \s-1NOT\s0 \s-1CALL\s0
  </dt>
  <dd>
    <p>Handles incoming messages.</p>
  </dd>
  <dt>
    <strong>get_responses</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;get_ident($forum_name); Returns the array of messages we are monitoring for in supplied forum or replies with undef.</p>
  </dd>
  <dt>
    <strong>_jabber_in_iq_message</strong> - \s-1DO\s0 \s-1NOT\s0 \s-1CALL\s0
  </dt>
  <dd>
    <p>Called when the client receives new messages during Process of this type.</p>
  </dd>
  <dt>
    <strong>_jabber_presence_message</strong> - \s-1DO\s0 \s-1NOT\s0 \s-1CALL\s0
  </dt>
  <dd>
    <p>Called when the client receives new presence messages during Process. Mostly we are just pushing the data down into the client \s-1DB\s0 for later processing.</p>
  </dd>
  <dt>
    <strong>respond_to_self_messages</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;respond_to_self_messages($value = 1); Tells the bot to start reacting to it&#92;'s own messages if non-zero is passed. Default is 1.</p>
  </dd>
  <dt>
    <strong>get_messages_this_hour</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;get_messages_this_hour(); replys with number of messages sent so far this hour.</p>
  </dd>
  <dt>
    <strong>get_safety_mode</strong>
  </dt>
  <dd>
    <p>Validates that we are in safety mode. Returns a bool as long as we are an object, otherwise returns undef</p>
  </dd>
  <dt>
    <strong>SendGroupMessage</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;SendGroupMessage($name, $message); Tells the bot to send a message to the recipient room name</p>
  </dd>
  <dt>
    <strong>SendPersonalMessage</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;SendPersonalMessage($recipient, $message); How to send an individual message to someone. $recipient must read as user@server/Resource or it will not send.</p>
  </dd>
  <dt>
    <strong>SendJabberMessage</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;SendJabberMessage($recipient, $message, $message_type, $subject); The master subroutine to send a message. Called either by the user, SendPersonalMessage, or SendGroupMessage. Sometimes there is call to call it directly when you do not feel like figuring you messaged you. Assures message size does not exceed a limit and chops it into pieces if need be. \s-1NOTE:\s0 non-printable characters (unicode included) will be stripped before sending to the server via:</p>
<pre>
    s/[^[:print:]]+/./xmsg
</pre>

  </dd>
  <dt>
    <strong>SetForumSubject</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;SetForumSubject($recipient, $subject); Sets the subject of a forum</p>
  </dd>
  <dt>
    <strong>ChangeStatus</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;ChangeStatus($presence_mode, $status_string); Sets the Bot's presence status. $presence mode could be something like: (Chat, Available, Away, Ext. Away, Do Not Disturb). $status_string is an optional comment to go with your presence mode. It is not required.</p>
  </dd>
  <dt>
    <strong>GetRoster</strong>
  </dt>
  <dd>
    <p>    $bot-&gt;GetRoster(); Returns a list of the people logged into the server. I suspect we really want to know who is in a paticular forum right? In which case we need another sub for this.</p>
  </dd>
  <dt>
    <strong>GetStatus</strong>
  </dt>
  <dd>
    <p>Need documentation from Yago on this sub.</p>
  </dd>
  <dt>
    <strong>AddUser</strong>
  </dt>
  <dd>
    <p>Need documentation from Yago on this sub.</p>
  </dd>
  <dt>
    <strong>RmUser</strong>
  </dt>
  <dd>
    <p>Need documentation from Yago on this sub.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Todd Rinaldo \*(C`&lt;perl-net-jabber-bot@googlegroups.com) &gt;\*(C'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any bugs or feature requests to \*(C`perl-net-jabber-bot@googlegroups.com\*(C', or through the web interface at &lt;http://code.google.com/p/perl-net-jabber-bot/issues/entry&gt;. I will be notified, and then you'll automatically be notified of progress on your bug as I make changes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>You can find documentation for this module with the perldoc command.</p><p>    perldoc Net::Jabber::Bot</p><p>You can also look for information at:</p><ul>
<li><p>AnnoCPAN: Annotated \s-1CPAN\s0 documentation &lt;http://annocpan.org/dist/Net-Jabber-Bot&gt;</p></li><li><p>\s-1CPAN\s0 Ratings &lt;http://cpanratings.perl.org/d/Net-Jabber-Bot&gt;</p></li><li><p>Search \s-1CPAN\s0 &lt;http://search.cpan.org/dist/Net-Jabber-Bot&gt;</p></li><li><p>Project homepage &lt;http://code.google.com/p/perl-net-jabber-bot/&gt;</p></li><li><p>Google Issue Tracker (reporting bugs) &lt;http://code.google.com/p/perl-net-jabber-bot/issues/entry&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT & LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright 2007 Todd E Rinaldo, all rights reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Net::Ifconfig::Wrapper.3pm.html"><span aria-hidden="true">&larr;</span> Net::Ifconfig::Wrapper.3pm: Provides a unified way to configure network interfaces on freebsd, openbsd, solaris, linux, os x, and winnt (from win2k).  version 0.11</a></li>
   <li class="next"><a href="Net::Jifty.3pm.html">Net::Jifty.3pm: Interface to online jifty applications <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
