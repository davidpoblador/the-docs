<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ORLite::Migrate: Extremely light weight sqlite-specific schema migration</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Extremely light weight sqlite-specific schema migration">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ORLite::Migrate (3pm) manual">
  <meta name="twitter:description" content="Extremely light weight sqlite-specific schema migration">
  <meta name="twitter:image" content="https://www.carta.tech/images/liborlite-migrate-perl-ORLite::Migrate-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/ORLite::Migrate.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ORLite::Migrate (3pm) manual" />
  <meta property="og:description" content="Extremely light weight sqlite-specific schema migration" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liborlite-migrate-perl-ORLite::Migrate-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ORLite::Migrate<small> (3pm)</small></h1>
        <p class="lead">Extremely light weight sqlite-specific schema migration</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/ORLite::Migrate.3pm.html">
      <span itemprop="name">ORLite::Migrate: Extremely light weight sqlite-specific schema migration</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liborlite-migrate-perl/">
      <span itemprop="name">liborlite-migrate-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/ORLite::Migrate.3pm.html">
      <span itemprop="name">ORLite::Migrate: Extremely light weight sqlite-specific schema migration</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  # Build your ORM class using a patch timeline
  # stored in the shared files directory.
  use ORLite::Migrate {
      create       =&gt; 1,
      file         =&gt; &apos;sqlite.db&apos;,
      timeline     =&gt; File::Spec-&gt;catdir(
          File::ShareDir::module_dir(&apos;My::Module&apos;), &apos;patches&apos;,
      ),
      user_version =&gt; 8,
  };

  # migrate-1.pl - A trivial schema patch
  #!/usr/bin/perl

  use strict;
  use DBI ();

  # Locate the SQLite database
  my $file = &lt;STDIN&gt;;
  chomp($file);
  unless ( -f $file and -w $file ) {
      die "SQLite file $file does not exist";
  }

  # Connect to the SQLite database
  my $dbh = DBI-&gt;connect("dbi:SQLite(RaiseError=&gt;1):$file");
  unless ( $dbh ) {
    die "Failed to connect to $file";
  }

  $dbh-&gt;do( &lt;&lt;&apos;END_SQL&apos; );
  create table foo (
      id integer not null primary key,
      name varchar(32) not null
  )
  END_SQL
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>SQLite is a light weight single file \s-1SQL\s0 database that provides an excellent platform for embedded storage of structured data.</p><p>ORLite is a light weight single class Object-Relational Mapper (\s-1ORM\s0) system specifically designed for (and limited to only) work with SQLite.</p><p>ORLite::Migrate is a light weight single class Database Schema Migration enhancement for ORLite.</p><p>It provides a simple implementation of schema versioning within the SQLite database using the built-in \*(C`user_version\*(C' pragma (which is set to zero by default).</p><p>When setting up the \s-1ORM\s0 class, an additional \*(C`timeline\*(C' parameter is provided, which should be either a monolithic timeline class, or a directory containing standalone migration scripts.</p><p>A <strong>\*(L"timeline\*(R"</strong> is a set of revisioned schema changed, to be applied in order and representing the evolution of the database schema over time. The end of the timeline, representing by the highest revision number, represents the \*(L"current\*(R" anticipated schema for the application.</p><p>Because the patch sequence can be calculated from any arbitrary starting version, by keeping the historical set of changes in your application as schema patches it is possible for the user of any older application version to install the most current version of an application and have their database upgraded smoothly and safely.</p><p>The recommended location to store the migration timeline is a shared files directory, locatable using one of the functions from File::ShareDir.</p><p>The timeline for your application can be specified in two different forms, with different advantages and disadvantages.</p><h3>Timeline Directories</h3>
<p>A Timeline Directory is a directory on the filesystem containing a set of Perl scripts named in a consistent pattern.</p><p>These patch scripts are named in the form <em>migrate-$version.pl</em>, where $version is the schema version to migrate to. A typical timeline directory will look something like the following.</p><p>  migrate-01.pl   migrate-02.pl   migrate-03.pl   migrate-04.pl   migrate-05.pl   migrate-06.pl   migrate-07.pl   migrate-08.pl   migrate-09.pl   migrate-10.pl</p><p>ORLite::Migrate formulates a migration plan that starts at the current database \*(C`user_version\*(C' pragma value, executing the migration script that has the version \*(C`user_version + 1\*(C', then executing \*(C`user_version + 2\*(C' and so on.</p><p>It will continue stepping forwards until it runs out of patches to execute.</p><p>The main advantage of a timeline directory is that each patch is run in its own process and interpreter. Hundreds of patches can be produced by many different authors, with certainty that the changes described in each will be executed as intended.</p><p>The main disadvantage of using a timeline directory is that your application <strong>must</strong> be able to identify the Perl interpreter it is run in so that it can execute a sub-process. This may be difficult or impossible for cases such as PAR-packaged applications and Perl interpreters embedded inside .exe wrappers or larger non-Perl applications.</p><p>In general, it is recommended that you use the timeline directory approach unless you encounter a situation in which sub-process execution (or locating the patch files) is difficult.</p>
<h3>Timeline Classes</h3>
<p>A timeline class places all of the schema patches into a single Perl module, with each patch represented as a method name.</p><p>The following is an example of a trivial timeline class.</p><p>  package t::lib::MyTimeline;</p><p>  use strict;   use base &apos;ORLite::Migrate::Timeline&apos;;</p><p>  my $UPGRADE1 = &lt;&lt;&apos;END_SQL&apos;;</p><p>  create table foo (       id integer not null primary key,       name varchar(32) not null   );</p><p>  insert into foo values ( 1, &apos;foo&apos; )</p><p>  END_SQL</p><p>  sub upgrade1 {       my $self = shift;       foreach ( split /;&#92;s+/, $UPGRADE1 ) {           $self-&gt;do($_);       }       return 1;   }</p><p>  sub upgrade2 {       $_[0]-&gt;do("insert into foo values ( 2, &apos;bar&apos; )");   }</p><p>  sub upgrade3 {       $_[0]-&gt;do("insert into foo values ( 3, &apos;baz&apos; )");   }</p><p>  1;</p><p>As with the patch files, the current state of the \*(C`user_version\*(C' pragma will be examined, and each \*(C`upgradeN\*(C' method will be called to advance the schema forwards.</p><p>The main advantage of a timeline class is that you will not need to execute sub-processes, and so a timeline class will continue to function even in unusual or exotic process contents such as \s-1PAR\s0 packaging or .exe wrappers.</p><p>The main disadvantage of a timeline class is that the entire timeline code must be loaded into memory no matter how many patch steps are needed (and stay in memory after the migration has completed), and all patches share a common interpreter and thus can potentially pollute or corrupt each other.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>Bugs should be reported via the \s-1CPAN\s0 bug tracker at</p><p>http://rt.cpan.org/NoAuth/ReportBug.html?Queue=ORLite-Migrate &lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=ORLite-Migrate&gt;</p><p>For other issues, contact the author.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Adam Kennedy &lt;adamk@cpan.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2009 - 2012 Adam Kennedy.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p><p>The full text of the license can be found in the \s-1LICENSE\s0 file included with this module.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ORLite.3pm.html"><span aria-hidden="true">&larr;</span> ORLite.3pm: Extremely light weight sqlite-specific orm</a></li>
   <li class="next"><a href="ORLite::Migrate::Timeline.3pm.html">ORLite::Migrate::Timeline.3pm: Orlite::migrate timelines contained in a single class <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
