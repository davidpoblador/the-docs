<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FunLib: The funtools programming interface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The funtools programming interface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="FunLib (3) manual">
  <meta name="twitter:description" content="The funtools programming interface">
  <meta name="twitter:image" content="https://www.carta.tech/images/libfuntools-dev-FunLib-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/FunLib.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="FunLib (3) manual" />
  <meta property="og:description" content="The funtools programming interface" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libfuntools-dev-FunLib-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">FunLib<small> (3)</small></h1>
        <p class="lead">The funtools programming interface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/FunLib.3.html">
      <span itemprop="name">FunLib: The funtools programming interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libfuntools-dev/">
      <span itemprop="name">libfuntools-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/FunLib.3.html">
      <span itemprop="name">FunLib: The funtools programming interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>A description of the Funtools library.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Introduction to the Funtools Programming Interface</strong></p><p>To create a Funtools application, you need to include the funtools.h definitions file in your code:</p>
<pre>
  #include &lt;funtools.h&gt;
</pre>
<p>You then call Funtools subroutines and functions to access Funtools data. The most important routines are:</p><ul>
<li><p>FunOpen: open a Funtools file</p></li><li><p>FunInfoGet: get info about an image or table</p></li><li><p>FunImageGet: retrieve image data</p></li><li><p>FunImageRowGet: retrieve image data by row</p></li><li><p>FunImagePut: output image data</p></li><li><p>FunImageRowPut: output image data by row</p></li><li><p>FunColumnSelect: select columns in a table for access</p></li><li><p>FunTableRowGet: retrieve rows from a table</p></li><li><p>FunTableRowPut: output rows to a table</p></li><li><p>FunClose: close a Funtools file</p></li>
</ul><p>Your program must be linked against the libfuntools.a library, along with the math library. The following libraries also might be required on your system:</p><ul>
<li><p>\-lsocket \-lnsl for socket support</p></li><li><p>\-ldl           for dynamic loading</p></li>
</ul><p>For example, on a Solaris system using gcc, use the following link line:</p><p>  gcc -o foo foo.c -lfuntools -lsocket -lnsl -ldl -lm</p><p>On a Solaris system using Solaris cc, use the following link line:</p><p>  gcc -o foo foo.c -lfuntools -lsocket -lnsl -lm</p><p>On a Linux system using gcc, use the following link line:</p><p>  gcc -o foo foo.c -lfuntools -ldl -lm</p><p>Once configure has built a Makefile on your platform, the required \*(L"extra\*(R" libraries (aside from \-lm, which always is required) are specified in that file's \s-1EXTRA_LIBS\s0 variable. For example, under Linux you will find:</p><p>  grep EXTRA_LIBS Makefile   EXTRA_LIBS      =  -ldl   ...</p><p>The Funtools library contains both the zlib library (http://www.gzip.org/zlib/) and Doug Mink's \s-1WCS\s0 library (http://tdc\-www.harvard.edu/software/wcstools/).  It is not necessary to put these libraries on a Funtools link line. Include files necessary for using these libraries are installed in the Funtools include directory.</p><p><strong>Funtools Programming Tutorial</strong></p><p>The <em>FunOpen()</em> function is used to open a \s-1FITS\s0 file, an array, or a raw event file:</p><p>  /* open the input FITS file for reading */   ifun = FunOpen(iname, "r", NULL);   /* open the output FITS file for writing, and connect it to the input file */   ofun = FunOpen(iname, "w", ifun);</p><p>A new output file can inherit header parameters automatically from existing input file by passing the input Funtools handle as the last argument to the new file's <em>FunOpen()</em> call as shown above.</p><p>For image data, you then can call <em>FunImageGet()</em> to read an image into memory.</p><p>  float buf=NULL;   /* extract and bin the data section into an image buffer */   buf = FunImageGet(fun, NULL, "bitpix=-32");</p><p>If the (second) buf argument to this call is \s-1NULL\s0, buffer space is allocated automatically. The (third) plist argument can be used to specify the return data type of the array.  If \s-1NULL\s0 is specified, the data type of the input file is used.</p><p>To process an image buffer, you would generally make a call to <em>FunInfoGet()</em> to determine the dimensions of the image (which may have been changed from the original file dimensions due to Funtools image sectioning on the command line). In a \s-1FITS\s0 image, the index along the dim1 axis varies most rapidly, followed by the dim2 axis, etc. Thus, to access each pixel in an 2D image, use a double loop such as:</p><p>  buf = FunImageGet(fun, NULL, "bitpix=-32");   FunInfoGet(fun, FUN_SECT_DIM1, &dim1, FUN_SECT_DIM2, &dim2, 0);   for(i=1; i&lt;=dim2; i++){     for(j=1; j&lt;=dim1; j++){       ... process buf[((i-1)*dim1)+(j-1)] ...     }   }</p><p>or:</p><p>  buf = FunImageGet(fun, NULL, "bitpix=-32");   FunInfoGet(fun, FUN_SECT_DIM1, &dim1, FUN_SECT_DIM2, &dim2, 0);   for(i=0; i&lt;(dim1*dim2); i++){     ... process buf[i] ...   }</p><p>Finally, you can write the resulting image to disk using <em>FunImagePut()</em>:</p><p>  FunImagePut(fun2, buf, dim1, dim2, -32, NULL);</p><p>Note that Funtools automatically takes care of book-keeping tasks such as reading and writing \s-1FITS\s0 headers (although you can, of course, write your own header or add your own parameters to a header).</p><p>For binary tables and raw event files, a call to <em>FunOpen()</em> will be followed by a call to the <em>FunColumnSelect()</em> routine to select columns to be read from the input file and/or written to the output file:</p><p>  typedef struct evstruct{     double time;     int time2;   } *Ev, EvRec;   FunColumnSelect(fun, sizeof(EvRec), NULL,                   "time",      "D",     "rw",  FUN_OFFSET(Ev, time),                   "time2",     "J",     "w",   FUN_OFFSET(Ev, time2),                   NULL);</p><p>Columns whose (third) mode argument contains an \*(L"r\*(R" are \*(L"readable\*(R", i.e., columns will be read from the input file and converted into the data type specified in the call's second argument. These columns values then are stored in the specified offset of the user record structure.  Columns whose mode argument contains a \*(L"w\*(R" are \*(L"writable\*(R", i.e., these values will be written to the output file. The <em>FunColumnSelect()</em> routine also offers the option of automatically merging user columns with the original input columns when writing the output rows.</p><p>Once a set of columns has been specified, you can retrieve rows using <em>FunTableRowGet()</em>, and write the rows using <em>FunTableRowPut()</em>:</p><p>  Ev ebuf, ev;   /* get rows -- let routine allocate the array */   while( (ebuf = (Ev)FunTableRowGet(fun, NULL, MAXROW, NULL, &got)) ){     /* process all rows */     for(i=0; i&lt;got; i++){       /* point to the i'th row */       ev = ebuf+i;       /* time2 is generated here */       ev-&gt;time2 = (int)(ev-&gt;time+.5);       /* change the input time as well */       ev-&gt;time = -(ev-&gt;time/10.0);     }     /* write out this batch of rows with the new column */     FunTableRowPut(fun2, (char *)ebuf, got, 0, NULL);     /* free row data */     if( ebuf ) free(ebuf);   }</p><p>The input rows are retrieved into an array of user structs, which can be accessed serially as shown above. Once again, Funtools automatically takes care of book-keeping tasks such as reading and writing \s-1FITS\s0 headers (although you can, of course, write your own header or add your own parameters to a header).</p><p>When all processing is done, you can call <em>FunClose()</em> to close the file(s):</p><p>  FunClose(fun2);   FunClose(fun);</p><p>These are the basics of processing \s-1FITS\s0 files (and arrays or raw event data) using Funtools. The routines in these examples are described in more detail below, along with a few other routines that support parameter access, data flushing, etc.</p><p><strong>Compiling and Linking</strong></p><p>To create a Funtools application, a software developer will include the funtools.h definitions file in Funtools code:</p><p>  #include &lt;funtools.h&gt;</p><p>The program is linked against the libfuntools.a library, along with the math library (and the dynamic load library, if the latter is available on your system):</p><p>  gcc -o foo foo.c -lfuntools -ldl -lm</p><p>If gcc is used, Funtools filtering can be performed using dynamically loaded shared objects that are built at run\-time. Otherwise, filtering is performed using a slave process.</p><p>Funtools has been built on the following systems:</p><ul>
<li><p>Sun/Solaris 5.X</p></li><li><p>Linux/RedHat Linux 5.X,6.X,7.X</p></li><li><p>Dec Alpha/OSF1 V4.X</p></li><li><p>WindowsNT/Cygwin 1.0</p></li><li><p>\s-1SGI/IRIX64\s0 6.5</p></li>
</ul><p><strong>A Short Digression on Subroutine Order</strong></p><p>There is a natural order for all I/O access libraries. You would not think of reading a file without first opening it, or writing a file after closing it. A large part of the experiment in funtools is to use the idea of \*(L"natural order\*(R" as a means of making programming easier. We do this by maintaining the state of processing for a given funtools file, so that we can do things like write headers and flush extension padding at the right time, without you having to do it.</p><p>For example, if you open a new funtools file for writing using <em>FunOpen()</em>, then generate an array of image data and call <em>FunImagePut()</em>, funtools knows to write the image header automatically. There is no need to think about writing a standard header. Of course, you can add parameters to the file first by calling one of the <em>FunParamPut()</em> routines, and these parameters will automatically be added to the header when it is written out.  There still is no need to write the header explicitly.</p><p>Maintaining state in this way means that there are certain rules of order which should be maintained in any funtools program. In particular, we strongly recommend the following ordering rules be adhered to:</p><ul>
<li><p>When specifying that input extensions be copied to an output file via a reference handle, open the output file <strong>before</strong> reading the input file. (Otherwise the initial copy will not occur).</p></li><li><p>Always write parameters to an output file using one of the <em>FunParamPut()</em> calls <strong>before</strong> writing any data. (This is a good idea for all \s-1FITS\s0 libraries, to avoid having to recopy data is the \s-1FITS\s0 header needs to be extended by adding a single parameter.)</p></li><li><p>If you retrieve an image, and need to know the data type, use the \s-1FUN_SECT_BITPIX\s0 option of <em>FunInfoGet()</em>, <strong>after</strong> calling <em>FunImageGet()</em>, since it is possible to change the value of \s-1BITPIX\s0 from the latter.</p></li><li><p>When specifying that input extensions be copied to an output file via a reference handle, close the output file <strong>before</strong> closing input file, or else use <em>FunFlush()</em> explicitly on the output file <strong>before</strong> closing the input file. (Otherwise the final copy will not occur).</p></li>
</ul><p>We believe that these are the natural rules that are implied in most \s-1FITS\s0 programming tasks. However, we recognize that making explicit use of \*(L"natural order\*(R" to decide what automatic action to take on behalf of the programmer is experimental.  Therefore, if you find that your needs are not compatible with our preferred order, please let us know \*(-- it will be most illuminating for us as we evaluate this experiment.</p><p><strong>Funtools Programming Examples</strong></p><p>The following complete coding examples are provided to illustrate the simplicity of Funtools applications.  They can be found in the funtest subdirectory of the Funtools distribution.  In many cases, you should be able to modify one of these programs to generate your own Funtools program:</p><ul>
<li><p>evread.c: read and write binary tables</p></li><li><p>evcols.c: add column and rows to binary tables</p></li><li><p>evmerge.c: merge new columns with existing columns</p></li><li><p>evnext.c: manipulate raw data pointers</p></li><li><p>imblank.c: blank out image values below a threshold</p></li><li><p>asc2fits.c: convert a specific \s-1ASCII\s0 table to \s-1FITS\s0 binary table</p></li>
</ul><p><strong>The Funtools Programming Reference Manual</strong></p><p>#include &lt;funtools.h&gt;</p><p>Fun FunOpen(char *name, char *mode, Fun ref)</p><p>void *FunImageGet(Fun fun, void *buf, char *plist)</p><p>int FunImagePut(Fun fun, void *buf, int dim1, int dim2, int bitpix, char *plist)</p><p>void * FunImageRowGet(Fun fun, void *buf, int rstart, int rstop, char *plist)</p><p>void * FunImageRowPut(Fun fun, void *buf, int rstart, int rstop, int dim1, int dim2, int bitpix, char *plist)</p><p>int FunColumnSelect(Fun fun, int size, char *plist, ...)</p><p>void FunColumnActivate(Fun fun, char *s, char *plist)</p><p>int FunColumnLookup(Fun fun, char *s, int which, char **name, int *type, int *mode, int *offset, int *n, int *width)</p><p>void *FunTableRowGet(Fun fun, void *rows, int maxrow, char *plist, int *nrow)</p><p>int FunTableRowPut(Fun fun, void *rows, int nev, int idx, char *plist)</p><p>int FunParamGetb(Fun fun, char *name, int n, int defval, int *got)</p><p>int FunParamGeti(Fun fun, char *name, int n, int defval, int *got)</p><p>double FunParamGetd(Fun fun, char *name, int n, double defval, int *got)</p><p>char *FunParamGets(Fun fun, char *name, int n, char *defval, int *got)</p><p>int FunParamPutb(Fun fun, char *name, int n, int value, char *comm, int append)</p><p>int FunParamPuti(Fun fun, char *name, int n, int value, char *comm, int append)</p><p>int FunParamPutd(Fun fun, char *name, int n, double value, int prec, char *comm, int append)</p><p>int FunParamPuts(Fun fun, char *name, int n, char *value, char *comm, int append)</p><p>int FunInfoGet(Fun fun, int type, ...)</p><p>int FunInfoPut(Fun fun, int type, ...)</p><p>void FunFlush(Fun fun, char *plist)</p><p>void FunClose(Fun fun)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO FunLib&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/funtools.7.html"><strong>funtools</strong>(7)</a> for a list of Funtools help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="FunInfoPut.3.html"><span aria-hidden="true">&larr;</span> FunInfoPut.3: Put information into a funtools struct</a></li>
   <li class="next"><a href="FunOpen.3.html">FunOpen.3: Open a funtools data file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
