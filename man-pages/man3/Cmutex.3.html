<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cmutex: Lcg mutex inferface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Lcg mutex inferface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Cmutex (3) manual">
  <meta name="twitter:description" content="Lcg mutex inferface">
  <meta name="twitter:image" content="https://www.carta.tech/images/liblcgdm-dev-Cmutex-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/Cmutex.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Cmutex (3) manual" />
  <meta property="og:description" content="Lcg mutex inferface" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liblcgdm-dev-Cmutex-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Cmutex<small> (3)</small></h1>
        <p class="lead">Lcg mutex inferface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Cmutex.3.html">
      <span itemprop="name">Cmutex: Lcg mutex inferface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liblcgdm-dev/">
      <span itemprop="name">liblcgdm-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Cmutex.3.html">
      <span itemprop="name">Cmutex: Lcg mutex inferface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;Cmutex.h&gt;</strong></p><p><strong>void Cmutex_init(int (*</strong><em>lockroutine</em><strong>)(void *</strong><em>addr</em><strong>, int </strong><em>timeout</em><strong>), int (*</strong><em>unlockroutine</em><strong>)(void * </strong><em>addr</em><strong>));</strong></p><p><strong>int Cmutex_lock(void *</strong><em>addr</em><strong>, int </strong><em>timeout</em><strong>);</strong></p><p><strong>int Cmutex_unlock(void *</strong><em>addr</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Cmutex</strong> is a common API interface for application compiled or not with the multithread flag. If the application do never initialize the <strong>Cmutex</strong> package, using <strong>Cmutex_init</strong>, and two arguments that are the addresses of the mutex lock and unlock functions, <strong>lockfunction</strong> and <strong>unlockfunction</strong> respectively, then all <strong>Cmutex</strong> calls are dummy operations.</p><p>Otherwise any call to <strong>Cmutex_lock</strong> will raise a call to <strong>lockfunction</strong> , and any call to <strong>Cmutex_unlock</strong> will raise a call to <strong>unlockfunction.</strong></p><p>Please note that the <strong>Cmutex</strong> package is initially meant to be interfaced with <strong>Cthread</strong> only.</p><p><strong>Cmutex_lock</strong> takes as argument the address <strong>addr</strong> of anything that is static in your userspace, such as a 'static int variable;' address (see <strong>EXAMPLE</strong> section below), and a <strong>timeout</strong> expressed in second unit.</p><p> If <strong>timeout</strong> is lower than zero, the operation will block until the mutex is granted. If it is zero, the operation will try to have the mutex and immediately return, possibly with failure. If it is greater than zero, operation will exit if the timeout is reached. Please refer to <strong>Cthread_mutex_timedlock</strong> description in the <strong>Cthread</strong> man page.</p><p>Return code of <strong>Cmutex_lock</strong> is 0 if success, -1 on failure. If failure the <strong>serrno</strong> error code is set appropriately.</p><p><strong>Cmutex_unlock</strong> releases a lock that you previously gained using <strong>Cmutex_lock</strong> and the same address value <strong>addr.</strong></p><p> Return code is 0 if success and -1 on failure, error code is then in the <strong>serrno</strong> variable.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">
<p>If the <strong>Cthread</strong> interface is chosen and activated, the errors value are in the <strong>serrno</strong> variable:</p><p><strong>SECTHREADINIT</strong></p><p>LCG Thread interface initialization error</p><p>A thread initialisation call failed. In principle, on UNIX this will be a call to pthread_mutex_init (and possibly pthread_mutexattr_init) that failed, on Windows/NT this might be a call to CreateMutex.</p><p><strong>SECTHREADERR</strong></p><p>LCG Thread interface failure in calling your thread library</p><p>A thread call to your native system library (like the pthread one on UNIX) failed. Please note that this is differentiated to the Cthread initialization and can happen if you are using too much thread keys, for example. This is really a run-time error only concerning your operating system thread interface. Any other system call failure, but not a thread one, and not at the initialisation step, will set serrno to <strong>SEINTERNAL</strong></p><p><strong>SEOPNOTSUP</strong></p><p>Operation not supported</p><p>This can be generated only if you compiled Cthread with a -DCTHREAD_PROTO flag that Cthread do not know about. Check your LCG configuration site.def.</p><p><strong>SEINTERNAL</strong></p><p>Internal error</p><p>You can have more information by compiling the Cthread package with the flag -DCTHREAD_DEBUG, and catching the printout on your stderr stream. This is any system call that failed (like malloc()), except those to the thread library (for which SECTHREADERR or SECTHREADINIT is to  be found), or any critical internal run-time error (such as a non correct value found in some Cthread internal structures).</p><p><strong>SETIMEDOUT</strong> (routines with a timeout parameter only)</p><p>Timed out</p><p>You called a routine with a timeout value greater than zero that reached the maximum number of timeout seconds in waiting state.</p><p><strong>EINVAL</strong></p><p>Invalid parameters</p><p>You called a routine with invalid parameter(s). Please check your code.</p><p><strong>EDEADLK</strong></p><p>Deadlock</p><p>Mutex is already locked by the calling thread (<strong>PTHREAD_MUTEX_ERRORCHECK</strong> mutexes only, this is not the default and should not happen via <strong>Cmutex</strong>)</p><p><strong>EBUSY</strong></p><p>Device or resource busy</p><p>Mutex is already locked by another thread.</p><p><strong>EPERM</strong></p><p>Permission denied</p><p>Mutex is now owned by the calling thread (<strong>PTHREAD_MUTEX_ERRORCHECK</strong> mutexes only, this is not the default and should not happen via <strong>Cmutex</strong>)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
/*
 * Here follows an example. The call to <strong>Cthread_init</strong> routine shows
 * that multi-threaded mode is explicitly activated by the application
 * (you will then have to link with the thread library). Neverthless,
 * you can very well call some other external library, and leave as it is
 * the <strong>Cmutex</strong> calls.
 */
#include &lt;Cmutex.h&gt;
#include &lt;Cthread_api.h&gt;
#include &lt;serrno.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;log.h&gt;

int this;
extern int Cthread_debug;

int main() {
  Cthread_init();        /* Comment this and Cmutex calls will become dummy */

  initlog("testit",LOG_INFO,"");

  if (Cmutex_lock(&this,10) != 0) {
    fprintf(stderr,"### Cmutex_lock (%s)&#92;n",sstrerror(serrno));
  }
  if (Cmutex_unlock(&this) != 0) {
    fprintf(stderr,"### Cmutex_unlock (%s)&#92;n",sstrerror(serrno));
  }
}
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Cmutex&hellip;</h2>
        <div class="sectioncontent">
<p><strong>Cthread</strong>, <strong>serrno</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>LCG Grid Deployment</strong> Team</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ClsfyVolume.3.html"><span aria-hidden="true">&larr;</span> ClsfyVolume.3: Create/destroy a preclassified volume for fast rendering</a></li>
   <li class="next"><a href="Cnetdb.3.html">Cnetdb.3: Lcg netdb utilities <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
