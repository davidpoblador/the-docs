<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ORLite::Migrate::Timeline: Orlite::migrate timelines contained in a single class</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Orlite::migrate timelines contained in a single class">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ORLite::Migrate::Timeline (3pm) manual">
  <meta name="twitter:description" content="Orlite::migrate timelines contained in a single class">
  <meta name="twitter:image" content="https://www.carta.tech/images/liborlite-migrate-perl-ORLite::Migrate::Timeline-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/ORLite::Migrate::Timeline.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ORLite::Migrate::Timeline (3pm) manual" />
  <meta property="og:description" content="Orlite::migrate timelines contained in a single class" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liborlite-migrate-perl-ORLite::Migrate::Timeline-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ORLite::Migrate::Timeline<small> (3pm)</small></h1>
        <p class="lead">Orlite::migrate timelines contained in a single class</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/ORLite::Migrate::Timeline.3pm.html">
      <span itemprop="name">ORLite::Migrate::Timeline: Orlite::migrate timelines contained in a single class</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liborlite-migrate-perl/">
      <span itemprop="name">liborlite-migrate-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/ORLite::Migrate::Timeline.3pm.html">
      <span itemprop="name">ORLite::Migrate::Timeline: Orlite::migrate timelines contained in a single class</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  package My::Timeline;

  use strict;
  use base &apos;ORLite::Migrate::Timeline&apos;;

  sub upgrade1 { $_[0]-&gt;do(&lt;&lt;&apos;END_SQL&apos;) }
  CREATE TABLE foo (
      bar INTEGER NOT NULL PRIMARY KEY,
  )
  END_SQL

  sub upgrade2 {
      my $self = shift;
      $self-&gt;do(&apos;TRUNCATE TABLE foo&apos;);
      foreach ( 1 .. 10 ) {
          $self-&gt;do( &apos;INSERT INTO foo VALUES ( ? )&apos;, {}, $_ );
      }
  }

  1;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The default ORLite::Migrate timeline implementation makes use of separate Perl \*(L"patch\*(R" scripts to move the database schema timeline forwards.</p><p>This solution is preferred because the separate scripts provide process isolation between your migration and run-time code. That is, the code that migrates the schema a single step forwards is guarenteed to never use the same variables or load the same modules or interact strangely with any other patch scripts, or with the main program.</p><p>However, to execute a sub-script your program needs to reliably know where the Perl executable that launched it is and in some situations this is difficult or infeasible.</p><p><strong>ORLite::Migrate::Timeline</strong> provides an alternative mechanism for specifying the migration timeline which adds the ability to run migration timelines in strange Perl environments at the cost of losing process isolation for your patch code.</p><p>When using this method, extra caution should be taken to avoid all use of global variables, and to strictly avoid loading large amounts of data into memory or using magic Perl modules such as Aspect or UNIVERSAL::isa which might have a global impact on your program.</p><p>To use this method, create a new class which inherits from ORLite::Migrate::Timeline and create a \*(C`upgrade1\*(C' method. When encountering a new unversioned SQLite database, the migration planner will execute this \*(C`upgrade1\*(C' method and set the schema version to 1 once completed.</p><p>To make further changes to the schema, you add additional \*(C`upgrade2\*(C', \*(C`upgrade3\*(C' and so on.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>A series of convenience methods are provided for you by the base class to assist in making your schema patch code simpler and easier.</p><h3>new</h3>
<p>  my $timeline = My::Class-&gt;new(       dbh =&gt; $DBI_db_object,   );</p><p>The \*(C`new\*(C' method is called internally by ORLite::Migrate on the timeline class you specify to construct the timeline object.</p><p>The constructor takes a single parameter which should be a DBI::db database connection to your SQLite database.</p><p>Returns an instance of your timeline class, or throws an exception (dies) if not passed a \s-1DBI\s0 connection object, or the database handle is not \*(C`AutoCommit\*(C'.</p>
<h3>upgrade</h3>
<p>  $timeline-&gt;upgrade(10);</p><p>The \*(C`update\*(C' method is called on the timeline object by ORLite::Migrate to trigger the sequential execution of the individual \*(C`upgradeN\*(C' methods.</p><p>The first method to be called will be the method one greater than the current value of the \*(C`user_revision\*(C' pragma, and the last method to be called will be the target revision, the first parameter to the method.</p><p>As all upgrade methods are contained in a single class, a high level of control is assumed and so the execution plan will not be calculated in advance. The \*(C`upgrade\*(C' method will simply start rolling forwards and keep going until it reaches the target version (or die's trying).</p><p>Returns true if all (zero or more) upgrade methods executed without throwing an exception.</p><p>Throws an exception (dies) if any \*(C`upgradeN\*(C' method throws an exception, or if the migration process expects to find a particular numeric \*(C`upgradeN\*(C' method and cannot do so.</p>
<h3>do</h3>
<p>The \*(C`do\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`do\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectall_arrayref</h3>
<p>The \*(C`selectall_arrayref\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectall_arrayref\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectall_hashref</h3>
<p>The \*(C`selectall_hashref\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectall_hashref\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectcol_arrayref</h3>
<p>The \*(C`selectcol_arrayref\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectcol_arrayref\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectrow_array</h3>
<p>The \*(C`selectrow_array\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectrow_array\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectrow_arrayref</h3>
<p>The \*(C`selectrow_arrayref\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectrow_arrayref\*(C'. It takes the same parameters and returns the same results.</p>
<h3>selectrow_hashref</h3>
<p>The \*(C`selectrow_hashref\*(C' method is a convenience which provides a direct wrapper over the \s-1DBI\s0 method \*(C`selectrow_hashref\*(C'. It takes the same parameters and returns the same results.</p>
<h3>pragma</h3>
<p>  # Get a pragma value   my $locking = $self-&gt;pragma(&apos;locking_mode&apos;);</p><p>  # Set a pragma value   $self-&gt;pragma( synchronous =&gt; 0 );</p><p>The \*(C`pragma\*(C' method provides a convenience over the top of the \*(C`PRAGMA\*(C' \s-1SQL\s0 statement, and allows the convenience query and change of SQLite pragmas.</p><p>For example, if your application wanted to switch SQLite auto vacuuming off and instead control vacuuming of the database manually, you could do something like the following.</p><p>    # Disable auto-vacuuming because we&apos;ll only fill this once.     # Do a one-time vacuum so we start with a clean empty database.     $dbh-&gt;pragma( auto_vacuum =&gt; 0 );     $dbh-&gt;do(&apos;VACUUM&apos;);</p>
<h3>table_exists</h3>
<p>The \*(C`table_exists\*(C' method is a convenience to check for the existance of a table already. Most of the time this isn't going to be needed because the schema revisioning itself guarentees there is or is not an existing table of a particular name.</p><p>However, occasionally you may encounter a situation where your ORLite module is sharing a SQLite database with other code, or you are taking over control of a table from a plugin, or similar.</p><p>In these situations it provides a small amount of added safety to be able to say things like.</p><p>  sub upgrade25 {       my $self = shift;       if ( $self-&gt;table_exists(&apos;foo&apos;) ) {           $self-&gt;do(&apos;DROP TABLE foo&apos;);       }   }</p><p>Returns true (1) if the table exists or false (0) if not.</p>
<h3>column_exists</h3>
<p>The \*(C`column_exists\*(C' method is a convenience to check for the existance of a column already. It has somewhat less uses than the similar \*(C`table_exists\*(C' and is mainly used when a column may exist on various miscellaneous developer versions of databases, or where the table structure may be variable across different groups of users.</p><p>Returns true (1) if the table exists or false (0) if not.</p>
<h3>dbh</h3>
<p>If you need to do something to the database outside the scope of the methods described above, the \*(C`dbh\*(C' method can be used to get access to the database connection directly.</p><p>This is discouraged as it can allow your migration code to create changes that might cause unexpected problems. However, in the 1% of cases where the methods above are not enough, using it with caution will allow you to make changes that would not otherwise be possible.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>Bugs should be reported via the \s-1CPAN\s0 bug tracker at</p><p>http://rt.cpan.org/NoAuth/ReportBug.html?Queue=ORLite-Migrate &lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=ORLite-Migrate&gt;</p><p>For other issues, contact the author.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Adam Kennedy &lt;adamk@cpan.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2009 - 2012 Adam Kennedy.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p><p>The full text of the license can be found in the \s-1LICENSE\s0 file included with this module.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ORLite::Migrate.3pm.html"><span aria-hidden="true">&larr;</span> ORLite::Migrate.3pm: Extremely light weight sqlite-specific schema migration</a></li>
   <li class="next"><a href="ORLite::Statistics.3pm.html">ORLite::Statistics.3pm: Statistics enhancement package for orlite <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
