<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Template::Plugin::DBI: Template interface to the dbi module</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Template interface to the dbi module">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Template::Plugin::DBI (3pm) manual">
  <meta name="twitter:description" content="Template interface to the dbi module">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtemplate-plugin-dbi-perl-Template::Plugin::DBI-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Template::Plugin::DBI.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Template::Plugin::DBI (3pm) manual" />
  <meta property="og:description" content="Template interface to the dbi module" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtemplate-plugin-dbi-perl-Template::Plugin::DBI-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Template::Plugin::DBI<small> (3pm)</small></h1>
        <p class="lead">Template interface to the dbi module</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Template::Plugin::DBI.3pm.html">
      <span itemprop="name">Template::Plugin::DBI: Template interface to the dbi module</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtemplate-plugin-dbi-perl/">
      <span itemprop="name">libtemplate-plugin-dbi-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Template::Plugin::DBI.3pm.html">
      <span itemprop="name">Template::Plugin::DBI: Template interface to the dbi module</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Making an implicit database connection:</p>
<pre>
    # ...using positional arguments
    [% USE DBI(&apos;dbi:driver:dbname&apos;, &apos;user&apos;, &apos;pass&apos;) %]

    # ...using named parameters
    [% USE DBI( database = &apos;dbi:driver:dbname&apos;,
                username = &apos;user&apos;,
                password = &apos;pass&apos; )
    %]

    # ...using short named parameters (4 lzy ppl and bad typsits)
    [% USE DBI( db   = &apos;driver:dbname&apos;,
                user = &apos;user&apos;,
                pass = &apos;pass&apos; )
    %]

    # ...or an existing DBI database handle
    [% USE DBI( dbh = my_dbh_ref ) %]
</pre>
<p>Making explicit database connections:</p><p>    [% USE DBI %]</p><p>    [% DBI.connect(db, user, pass) %]        ...</p><p>    [% DBI.connect(new_db, new_user, new_pass) %]        ...</p><p>    [% DBI.disconnect %]      # final disconnect is optional</p><p>Making an automagical database connection using \s-1DBI_DSN\s0 environment variable:</p><p>    [% USE DBI %]</p><p>Making database queries:</p><p>    # single step query     [% FOREACH user = DBI.query(&apos;SELECT * FROM users&apos;) %]        [% user.uid %] blah blah [% user.name %] etc. etc.     [% END %]</p><p>    # two stage prepare/execute     [% query = DBI.prepare(&apos;SELECT * FROM users WHERE uid = ?&apos;) %]</p><p>    [% FOREACH user = query.execute(&apos;sam&apos;) %]        ...     [% END %]</p><p>    [% FOREACH user = query.execute(&apos;abw&apos;) %]        ...     [% END %]</p><p>Making non-SELECT statements:</p><p>    [% IF DBI.do("DELETE FROM users WHERE uid = &apos;$uid&apos;") %]        The user &apos;[% uid %]&apos; was successfully deleted.     [% END %]</p><p>Using named \s-1DBI\s0 connections:</p><p>    [% USE one = DBI(...) %]     [% USE two = DBI(...) %]</p><p>    [% FOREACH item = one.query("SELECT ...etc...") %]        ...     [% END %]</p><p>    [% FOREACH item = two.query("SELECT ...etc...") %]        ...     [% END %]</p><p>Tieing to a database table (via Tie::DBI):</p><p>    [% people = DBI.tie(&apos;users&apos;, &apos;uid&apos;) %]</p><p>    [% me = people.abw %]   # =&gt; SELECT * FROM users WHERE uid=&apos;abw&apos;</p><p>    I am [% me.name %]</p><p>    # clobber option allows table updates (see Tie::DBI)     [% people = DBI.tie(&apos;users&apos;, &apos;uid&apos;, clobber=1) %]</p><p>    [% people.abw.name = &apos;not a number&apos; %]</p><p>    I am [% people.abw.name %]   # I am a free man!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This Template Toolkit plugin module provides an interface to the Perl \s-1DBI/DBD\s0 modules, allowing you to integrate \s-1SQL\s0 queries into your template documents.  It also provides an interface via the Tie::DBI module (if installed on your system) so that you can access database records without having to embed any \s-1SQL\s0 in your templates.</p><p>A \s-1DBI\s0 plugin object can be created as follows:</p><p>    [% USE DBI %]</p><p>This creates an uninitialised \s-1DBI\s0 object.  You can then open a connection to a database using the <em>connect()</em> method.</p><p>    [% DBI.connect(&apos;dbi:driver:dbname&apos;, &apos;user&apos;, &apos;pass&apos;) %]</p><p>The \s-1DBI\s0 connection can be opened when the plugin is created by passing arguments to the constructor, called from the \s-1USE\s0 directive.</p><p>    [% USE DBI(&apos;dbi:driver:dbname&apos;, &apos;user&apos;, &apos;pass&apos;) %]</p><p>You can also use named parameters to provide the data source connection string, user name and password.</p><p>    [% USE DBI(database =&gt; &apos;dbi:driver:dbname&apos;,                username =&gt; &apos;user&apos;,                password =&gt; &apos;pass&apos;)  %]</p><p>For backwards compatability with previous versions of this plugin, you can also spell 'database' as 'data_source'.</p><p>    [% USE DBI(data_source =&gt; &apos;dbi:driver:dbname&apos;,                username    =&gt; &apos;user&apos;,                password    =&gt; &apos;pass&apos;)  %]</p><p>Lazy Template hackers may prefer to use 'db', 'dsn' or 'connect' as a shorthand form of the 'database' parameter, and 'user' and 'pass' as shorthand forms of 'username' and 'password', respectively.  You can also drop the 'dbi:' prefix from the database connect string because the plugin will add it on for you automagically.</p><p>    [% USE DBI(db   =&gt; &apos;driver:dbname&apos;,                user =&gt; &apos;user&apos;,                pass =&gt; &apos;pass&apos;)  %]</p><p>Any additional \s-1DBI\s0 attributes can be specified as named parameters. The 'PrintError' attribute defaults to 0 unless explicitly set true.</p><p>    [% USE DBI(db, user, pass, ChopBlanks=1) %]</p><p>An alternate variable name can be provided for the plugin as per regular Template Toolkit syntax:</p><p>    [% USE mydb = DBI(&apos;dbi:driver:dbname&apos;, &apos;user&apos;, &apos;pass&apos;) %]</p><p>    [% FOREACH item = mydb.query(&apos;SELECT * FROM users&apos;) %]        ...     [% END %]</p><p>You can also specify the \s-1DBI\s0 plugin name in lower case if you prefer:</p><p>    [% USE dbi(dsn, user, pass) %]</p><p>    [% FOREACH item = dbi.query(&apos;SELECT * FROM users&apos;) %]        ...     [% END %]</p><p>The <em>disconnect()</em> method can be called to explicitly disconnect the current database, but this generally shouldn't be necessary as it is called automatically when the plugin goes out of scope.  You can call <em>connect()</em> at any time to open a connection to another database.  The previous connection will be closed automatically.</p><p>Internally, the \s-1DBI\s0 <em>connect_cached()</em> method is used instead of the <em>connect()</em> method.  This allows for connection caching in a server environment, such as when the Template Toolkit is used from an Apache mod_perl handler.  In such a case, simply enable the mod_env module and put in a line such as:</p><p>    SetEnv DBI_DSN "dbi:mysql:dbname;host=dbhost;                               user=uname;password=pword"</p><p>(\s-1NOTE:\s0 the string shown here is split across 2 lines for the sake of reasonable page formatting, but you should specify it all as one long string with no spaces or newlines).</p><p>You can then use the \s-1DBI\s0 plugin without any parameters or the need to explicitly call <em>connect()</em>.</p><p>Once you've loaded a \s-1DBI\s0 plugin and opened a database connection using one of the techniques shown above, you can then make queries on the database using the familiar dotted notation:</p><p>    [% FOREACH user = DBI.query(&apos;SELECT * FROM users&apos;) %]        [% user.uid %] blah blah [% user.name %] etc. etc.     [% END %]</p><p>The <em>query()</em> method prepares a query and executes it all in one go. If you want to repeat a query with different parameters then you can use a separate prepare/execute cycle.</p><p>    [% query = DBI.prepare(&apos;SELECT * FROM users WHERE uid = ?&apos;) %]</p><p>    [% FOREACH user = query.execute(&apos;sam&apos;) %]        ...     [% END %]</p><p>    [% FOREACH user = query.execute(&apos;abw&apos;) %]        ...     [% END %]</p><p>The <em>query()</em> and <em>execute()</em> methods return an iterator object which manages the result set returned.  You can save a reference to the iterator and access methods like <em>size()</em> to determine the number of rows returned by a query.</p><p>    [% users = DBI.query(&apos;SELECT * FROM users&apos;) %]     [% users.size %] records returned</p><p>or even</p><p>    [% DBI.query(&apos;SELECT * FROM users&apos;).size %]</p><p>When used within a \s-1FOREACH\s0 loop, the iterator is always aliased to the special \*(C`loop\*(C' variable.  This makes it possible to do things like this:</p><p>    [% FOREACH user = DBI.query(&apos;SELECT * FROM users&apos;) %]        [% loop.count %]/[% loop.size %]: [% user.name %]     [% END %]</p><p>to generate a result set of the form:</p><p>    1/3: Jerry Garcia     2/3: Kurt Cobain     3/3: Freddie Mercury</p><p>See Template::Iterator for further details on iterators and the methods that they implement.</p><p>The \s-1DBI\s0 plugin also provides the <em>do()</em> method to execute non-SELECT statements like this:</p><p>    [% IF DBI.do("DELETE FROM users WHERE uid = &apos;$uid&apos;") %]        The user &apos;[% uid %]&apos; was successfully deleted.     [% END %]</p><p>The plugin also allows you to create a tie to a table in the database using the Tie::DBI module.  Simply call the <em>tie()</em> method, passing the name of the table and the primary key as arguments.</p><p>    [% people = DBI.tie(&apos;person&apos;, &apos;uid&apos;) %]</p><p>You can then access records in the database table as if they were entries in the 'people' hash.</p><p>    My name is [% people.abw.name %]</p><p>\s-1IMPORTANT\s0 \s-1NOTE:\s0 the \s-1XS\s0 Stash (Template::Stash::XS) does not currently support access to tied hashes.  If you are using the \s-1XS\s0 stash and having problems then you should try enabling the regular stash instead.  You can do this by setting $Template::Config::STASH to 'Template::Stash' before instantiating the Template object.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OBJECT METHODS</h2>
        <div class="sectioncontent">
<p>Establishes a database connection.  This method accepts both positional and named parameter syntax.  e.g.</p><p>    [% DBI.connect( &apos;dbi:driver:dbname&apos;, &apos;timmy&apos;, &apos;sk8D00Dz&apos; ) %]</p><p>    [% DBI.connect( database = &apos;dbi:driver:dbname&apos;                     username = &apos;timmy&apos;                     password = &apos;sk8D00Dz&apos; ) %]</p><p>The connect method allows you to connect to a data source explicitly. It can also be used to reconnect an exisiting object to a different data source.</p><p>If you already have a database handle then you can instruct the plugin to reuse it by passing it as the 'dbh' parameter.</p><p>    [% DBI.connect( dbh = my_dbh_ref ) %]</p><h3>query($sql,[&#92;%args],[@bind_values])</h3>
<p>This method submits an \s-1SQL\s0 query to the database and creates an iterator object to return the results.  This may be used directly in a \s-1FOREACH\s0 directive as shown below.  Data is automatically fetched a row at a time from the query result set as required for memory efficiency.</p><p>    [% FOREACH user = DBI.query(&apos;SELECT * FROM users&apos;) %]        Each [% user.field %] can be printed here     [% END %]</p>
<h3>prepare($sql,[&#92;%args])</h3>
<p>Prepare a query for later execution.  This returns a compiled query object (of the Template::Plugin::DBI::Query class) on which the <em>execute()</em> method can subsequently be called.</p><p>    [% query = DBI.prepare(&apos;SELECT * FROM users WHERE id = ?&apos;) %]</p>
<h3>execute(@bind_values)</h3>
<p>Execute a previously prepared query.  This method should be called on the query object returned by the <em>prepare()</em> method.  Returns an iterator object which can be used directly in a \s-1FOREACH\s0 directive.</p><p>    [% query = DBI.prepare(&apos;SELECT * FROM users WHERE manager = ?&apos;) %]</p><p>    [% FOREACH minion = query.execute(&apos;abw&apos;) %]        [% minion.name %]     [% END %]</p><p>    [% FOREACH minion = query.execute(&apos;sam&apos;) %]        [% minion.name %]     [% END %]</p>
<h3>do($sql,[&#92;%attr,[@bind_values]])</h3>
<p>The <em>do()</em> method executes a sql statement from which no records are returned.  It will return true if the statement was successful</p><p>    [% IF DBI.do("DELETE FROM users WHERE uid = &apos;sam&apos;") %]        The user was successfully deleted.     [% END %] Returns a reference to a hash array tied to a table in the database, implemented using the Tie::DBI module.  You should pass the name of the table and the key field as arguments.</p><p>    [% people = DBI.tie(&apos;users&apos;, &apos;uid&apos;) %]</p><p>Or if you prefer, you can use the 'table' and 'key' named parameters.</p><p>    [% people = DBI.tie(table=&apos;users&apos;, key=&apos;uid&apos;) %]</p><p>In this example, the Tie::DBI module will convert the accesses into the 'people' hash into \s-1SQL\s0 queries of the form:</p><p>    SELECT * FROM users WHERE uid=?</p><p>For example:</p><p>    [% me = people.abw %]</p><p>The record returned can then be accessed just like a normal hash.</p><p>    I am [% me.name %]</p><p>You can also do things like this to iterate through all the records in a table.</p><p>    [% FOREACH uid = people.keys.sort;             person = people.$uid     %]         * [% person.id %] : [% person.name %]     [% END %]</p><p>With the 'clobber' (or '\s-1CLOBBER\s0') option set you can update the record and have those changes automatically permeated back into the database.</p><p>    [% people = DBI.tie(&apos;users&apos;, &apos;uid&apos;, clobber=1) %]</p><p>    [% people.abw.name = &apos;not a number&apos; %]</p><p>    I am [% people.abw.name %]  # I am a free man!</p><p>And you can also add new records.</p><p>    [% people.newguy = {            name = &apos;Nobby Newguy&apos;            ...other fields...        }     %]</p><p>See Tie::DBI for further information on the '\s-1CLOBBER\s0' option. Calls the <em>quote()</em> method on the underlying \s-1DBI\s0 handle to quote the value specified in the appropriate manner for its type.</p>
<h3>dbh</h3>
<p>  [% DBI.dbh() %]</p><p>Return the database handle currently in use by the plugin.</p>
<h3>disconnect</h3>
<p>  [% DBI.disconnect() %]</p><p>Disconnects the current database.</p>
<h3>fetch</h3>
<p>  [% DBI.fetch(&apos;Name&apos;) %]</p><p>Fetches an attribute from the connected database handle. Throws an exception when not connected.</p>
<h3>store</h3>
<p>  [% DBI.store(&apos;RowCacheSize&apos;,0) %]</p><p>Stores an attribute in the connected database handle. Throws an exception when not connected.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ITERATOR METHODS</h2>
        <div class="sectioncontent">
<h3>get_all</h3>
<p>  [% allhash = result.get_all() %]</p><p>Returns all (remaining) rows as a hash.</p>
<h3>get_all_list</h3>
<p>  [% allhash = result.get_all_list() %]</p><p>Returns all (remaining) rows as a list.</p>
<h3>rows</h3>
<p>Returns the number of affected rows of the executed statement.</p>
<h3>get_colnames</h3>
<p>Returns the lowercase column names ($sth attribute \*(C`-&gt;{NAME_lc}\*(C').</p>
<h3>get_COLnames</h3>
<p>Returns the uppercase column names ($sth attribute \*(C`-&gt;{NAME_uc}\*(C').</p>
<h3>fetch</h3>
<p>Fetches an attribute from the statement handle.</p><p>  [% result.fetch(&apos;FetchHashKeyName&apos;) %]</p>
<h3>store</h3>
<p>Stores an attribute to the statement handle.</p><p>  [% result.store(&apos;FetchHashKeyName&apos;,&apos;NAME_lc&apos;) %]</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>The \s-1DBI\s0 plugin was originally written by Simon A Matthews, and distributed as a separate module.  It was integrated into the Template Toolkit distribution for version 2.00 and includes contributions from Andy Wardley, Craig Barratt, Dave Hodgkinson and Rafael Kitover. Andy Wardley extracted it back into a separate distribution in May 2006. After that, in 2010 Jens Rehsack maintains this distribution.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>  Copyright (C) 1999-2006 Simon Matthews, Andy Wardley.  All Rights Reserved.   Copyright (C) 2010 Jens Rehsack.  All Rights Reserved</p><p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Template::Plugin::DBI&hellip;</h2>
        <div class="sectioncontent">
<p>Template Template::Plugins, \s-1DBI\s0, Tie::DBI</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Template::Plugin::Cycle.3pm.html"><span aria-hidden="true">&larr;</span> Template::Plugin::Cycle.3pm: Cyclically insert into a template from a sequence of values</a></li>
   <li class="next"><a href="Template::Plugin::GD.3pm.html">Template::Plugin::GD.3pm: Gd plugin(s) for the template toolkit <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
