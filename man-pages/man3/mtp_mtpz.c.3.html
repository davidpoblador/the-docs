<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mtp_mtpz.c: Mtpz.c</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Mtpz.c">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mtp_mtpz.c (3) manual">
  <meta name="twitter:description" content="Mtpz.c">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmtp-doc-mtp_mtpz.c-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/mtp_mtpz.c.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mtp_mtpz.c (3) manual" />
  <meta property="og:description" content="Mtpz.c" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmtp-doc-mtp_mtpz.c-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mtp_mtpz.c<small> (3)</small></h1>
        <p class="lead">Mtpz.c</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/mtp_mtpz.c.3.html">
      <span itemprop="name">mtp_mtpz.c: Mtpz.c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmtp-doc/">
      <span itemprop="name">libmtp-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/mtp_mtpz.c.3.html">
      <span itemprop="name">mtp_mtpz.c: Mtpz.c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include 'config.h'</p><p>#include 'libmtp.h'</p><p>#include 'unicode.h'</p><p>#include 'ptp.h'</p><p>#include 'libusb-glue.h'</p><p>#include 'device-flags.h'</p><p>#include 'playlist-spl.h'</p><p>#include 'util.h'</p><p>#include 'mtpz.h'</p><p>#include &lt;gcrypt.h&gt;</p><p>#include &lt;stdlib.h&gt;</p><p>#include &lt;unistd.h&gt;</p><p>#include &lt;string.h&gt;</p><p>#include &lt;sys/types.h&gt;</p><p>#include &lt;sys/stat.h&gt;</p><p>#include &lt;time.h&gt;</p><p>#include &lt;errno.h&gt;</p><h3>Data Structures</h3>
<p>struct <strong>mtpz_rsa_struct</strong></p>
<h3>Macros</h3>
<p>#define <strong>MTPZ_HASHSTATE_84</strong>   5</p><p>#define <strong>MTPZ_HASHSTATE_88</strong>   6</p><p>#define <strong>MTPZ_ENCRYPTIONLOBYTE</strong>(val)   (((val) &gt;&gt; 24) & 0xFF)</p><p>#define <strong>MTPZ_ENCRYPTIONBYTE1</strong>(val)   (((val) &gt;&gt; 16) & 0xFF)</p><p>#define <strong>MTPZ_ENCRYPTIONBYTE2</strong>(val)   (((val) &gt;&gt;  8) & 0xFF)</p><p>#define <strong>MTPZ_ENCRYPTIONBYTE3</strong>(val)   (((val) &gt;&gt;  0) & 0xFF)</p><p>#define <strong>MTPZ_SWAP</strong>(x)   mtpz_bswap32(x)</p>
<h3>Typedefs</h3>
<p>typedef struct <strong>mtpz_rsa_struct</strong> <strong>mtpz_rsa_t</strong></p>
<h3>Functions</h3>
<p>int <strong>mtpz_loaddata</strong> ()</p><p><strong>mtpz_rsa_t</strong> * <strong>mtpz_rsa_init</strong> (const unsigned char *modulus, const unsigned char *priv_key, const unsigned char *pub_exp)</p><p>void <strong>mtpz_rsa_free</strong> (<strong>mtpz_rsa_t</strong> *)</p><p>int <strong>mtpz_rsa_decrypt</strong> (int flen, unsigned char *from, int tlen, unsigned char *to, <strong>mtpz_rsa_t</strong> *rsa)</p><p>int <strong>mtpz_rsa_sign</strong> (int flen, unsigned char *from, int tlen, unsigned char *to, <strong>mtpz_rsa_t</strong> *rsa)</p><p>void <strong>mtpz_encryption_cipher</strong> (unsigned char *data, unsigned int len, char encrypt)</p><p>void <strong>mtpz_encryption_cipher_advanced</strong> (unsigned char *key, unsigned int key_len, unsigned char *data, unsigned int data_len, char encrypt)</p><p>unsigned char * <strong>mtpz_encryption_expand_key</strong> (unsigned char *constant, int key_len, int count, int *out_len)</p><p>void <strong>mtpz_encryption_expand_key_inner</strong> (unsigned char *constant, int key_len, unsigned char **out, int *out_len)</p><p>void <strong>mtpz_encryption_inv_mix_columns</strong> (unsigned char *expanded, int offset, int rounds)</p><p>void <strong>mtpz_encryption_decrypt_custom</strong> (unsigned char *data, unsigned char *seed, unsigned char *expanded)</p><p>void <strong>mtpz_encryption_encrypt_custom</strong> (unsigned char *data, unsigned char *seed, unsigned char *expanded)</p><p>void <strong>mtpz_encryption_encrypt_mac</strong> (unsigned char *hash, unsigned int hash_length, unsigned char *seed, unsigned int seed_len, unsigned char *out)</p><p>uint16_t <strong>ptp_mtpz_handshake</strong> (<strong>PTPParams</strong> *params)</p>
<h3>Variables</h3>
<p>unsigned char <strong>mtpz_aes_rcon</strong> []</p><p>unsigned char <strong>mtpz_aes_sbox</strong> []</p><p>unsigned char <strong>mtpz_aes_invsbox</strong> []</p><p>unsigned int <strong>mtpz_aes_ft1</strong> []</p><p>unsigned int <strong>mtpz_aes_ft2</strong> []</p><p>unsigned int <strong>mtpz_aes_ft3</strong> []</p><p>unsigned int <strong>mtpz_aes_ft4</strong> []</p><p>unsigned int <strong>mtpz_aes_rt1</strong> []</p><p>unsigned int <strong>mtpz_aes_rt2</strong> []</p><p>unsigned int <strong>mtpz_aes_rt3</strong> []</p><p>unsigned int <strong>mtpz_aes_rt4</strong> []</p><p>unsigned int <strong>mtpz_aes_gb11</strong> []</p><p>unsigned int <strong>mtpz_aes_gb14</strong> []</p><p>unsigned int <strong>mtpz_aes_gb13</strong> []</p><p>unsigned int <strong>mtpz_aes_gb9</strong> []</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2011-2012 Sajid Anwar sajidanwar94@gmail.com</p><p>This library is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p><p>This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</p><p>You should have received a copy of the GNU Lesser General Public License along with this library; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</p><p>This file provides mtp zune cryptographic setup interfaces. It is also used with Windows Phone 7, but Microsoft/Nokiad seem to have discontinued MTPZ on Windows Phone 8.</p><p>DISCLAIMER:</p><p>The intention of this implementation is for users to be able to interoperate with their devices, i.e. copy music to them in operating systems other than Microsoft Windows, so it can be played back on the device. We do not provide encryption keys and constants in libmtp, we never will. You have to have these on file in your home directory in $HOME/.mtpz-data, and we suggest that you talk to Microsoft about providing the proper numbers if you want to use this facility.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Variable Documentation</h2>
        <div class="sectioncontent">
<h3>unsigned char mtpz_aes_invsbox</h3>
<p><strong>Initial value:</strong></p>
<pre>
=
{
        0x52, 0x09, 0x6A, 0xD5, 0x30, 0x36, 0xA5, 0x38,  0xBF, 0x40, 0xA3, 0x9E, 0x81, 0xF3, 0xD7, 0xFB,
        0x7C, 0xE3, 0x39, 0x82, 0x9B, 0x2F, 0xFF, 0x87,  0x34, 0x8E, 0x43, 0x44, 0xC4, 0xDE, 0xE9, 0xCB,
        0x54, 0x7B, 0x94, 0x32, 0xA6, 0xC2, 0x23, 0x3D,  0xEE, 0x4C, 0x95, 0x0B, 0x42, 0xFA, 0xC3, 0x4E,
        0x08, 0x2E, 0xA1, 0x66, 0x28, 0xD9, 0x24, 0xB2,  0x76, 0x5B, 0xA2, 0x49, 0x6D, 0x8B, 0xD1, 0x25,
        0x72, 0xF8, 0xF6, 0x64, 0x86, 0x68, 0x98, 0x16,  0xD4, 0xA4, 0x5C, 0xCC, 0x5D, 0x65, 0xB6, 0x92,
        0x6C, 0x70, 0x48, 0x50, 0xFD, 0xED, 0xB9, 0xDA,  0x5E, 0x15, 0x46, 0x57, 0xA7, 0x8D, 0x9D, 0x84,
        0x90, 0xD8, 0xAB, 0x00, 0x8C, 0xBC, 0xD3, 0x0A,  0xF7, 0xE4, 0x58, 0x05, 0xB8, 0xB3, 0x45, 0x06,
        0xD0, 0x2C, 0x1E, 0x8F, 0xCA, 0x3F, 0x0F, 0x02,  0xC1, 0xAF, 0xBD, 0x03, 0x01, 0x13, 0x8A, 0x6B,
        0x3A, 0x91, 0x11, 0x41, 0x4F, 0x67, 0xDC, 0xEA,  0x97, 0xF2, 0xCF, 0xCE, 0xF0, 0xB4, 0xE6, 0x73,
        0x96, 0xAC, 0x74, 0x22, 0xE7, 0xAD, 0x35, 0x85,  0xE2, 0xF9, 0x37, 0xE8, 0x1C, 0x75, 0xDF, 0x6E,
        0x47, 0xF1, 0x1A, 0x71, 0x1D, 0x29, 0xC5, 0x89,  0x6F, 0xB7, 0x62, 0x0E, 0xAA, 0x18, 0xBE, 0x1B,
        0xFC, 0x56, 0x3E, 0x4B, 0xC6, 0xD2, 0x79, 0x20,  0x9A, 0xDB, 0xC0, 0xFE, 0x78, 0xCD, 0x5A, 0xF4,
        0x1F, 0xDD, 0xA8, 0x33, 0x88, 0x07, 0xC7, 0x31,  0xB1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xEC, 0x5F,
        0x60, 0x51, 0x7F, 0xA9, 0x19, 0xB5, 0x4A, 0x0D,  0x2D, 0xE5, 0x7A, 0x9F, 0x93, 0xC9, 0x9C, 0xEF,
        0xA0, 0xE0, 0x3B, 0x4D, 0xAE, 0x2A, 0xF5, 0xB0,  0xC8, 0xEB, 0xBB, 0x3C, 0x83, 0x53, 0x99, 0x61,
        0x17, 0x2B, 0x04, 0x7E, 0xBA, 0x77, 0xD6, 0x26,  0xE1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0C, 0x7D
}
</pre>

<h3>unsigned char mtpz_aes_rcon</h3>
<p><strong>Initial value:</strong></p>
<pre>
=
{
        0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a
}
</pre>

<h3>unsigned char mtpz_aes_sbox</h3>
<p><strong>Initial value:</strong></p>
<pre>
=
{
        0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01,
        0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d,
        0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4,
        0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc,
        0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7,
        0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2,
        0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e,
        0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84,
        0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb,
        0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb,
        0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c,
        0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5,
        0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c,
        0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d,
        0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a,
        0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb,
        0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3,
        0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d,
        0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a,
        0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6,
        0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e,
        0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9,
        0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9,
        0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf,
        0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99,
        0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16
}
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for libmtp from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mtp_mtpdevice_list_struct.3.html"><span aria-hidden="true">&larr;</span> mtp_mtpdevice_list_struct.3: Mtpdevice_list_struct</a></li>
   <li class="next"><a href="mtp_mtpz.h.3.html">mtp_mtpz.h.3: Mtpz.h <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
