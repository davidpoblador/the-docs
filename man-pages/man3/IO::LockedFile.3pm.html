<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IO::LockedFile: Supply object methods for locking files</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Supply object methods for locking files">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="IO::LockedFile (3pm) manual">
  <meta name="twitter:description" content="Supply object methods for locking files">
  <meta name="twitter:image" content="https://www.carta.tech/images/libio-lockedfile-perl-IO::LockedFile-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/IO::LockedFile.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="IO::LockedFile (3pm) manual" />
  <meta property="og:description" content="Supply object methods for locking files" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libio-lockedfile-perl-IO::LockedFile-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">IO::LockedFile<small> (3pm)</small></h1>
        <p class="lead">Supply object methods for locking files</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/IO::LockedFile.3pm.html">
      <span itemprop="name">IO::LockedFile: Supply object methods for locking files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libio-lockedfile-perl/">
      <span itemprop="name">libio-lockedfile-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/IO::LockedFile.3pm.html">
      <span itemprop="name">IO::LockedFile: Supply object methods for locking files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use IO::LockedFile;

  # create new locked file object. $file will hold a file handle.
  # if the file is already locked, the method will not return until the
  # file is unlocked
  my $file = new IO::LockedFile("&gt;locked1.txt");

  # when we close the file - it become unlocked.
  $file-&gt;close();

  # suppose we did not have the line above, we can also delete the
  # object, and the file is automatically unlocked and closed.
  $file = undef;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>In its simplistic use, the <strong>IO::LockedFile</strong> class gives us the same interface of the <strong>IO::File</strong> class with the unique difference that the files we deal with are locked using the <strong>Flock</strong> mechanism (using the \*(C`flock\*(C' function).</p><p>If during the running of the process, it crashed - the file will be automatically unlocked. Actually - if the <strong>IO::LockedFile</strong> object goes out of scope, the file is automatically closed and unlocked.</p><p>So, if you are just interested in having locked files with \*(C`flock\*(C', you can skip most of the documentation below.</p><p>If, on the other hand, you are interested in locking files with other schemes then <strong>Flock</strong>, or you want to control the behavior of the locking (having non blocking lock for example), read on.</p><p>Actually the class <strong>IO::LockedFile</strong> is kind of abstract class.</p><p>Why abstract? Because methods of this class call the methods \*(C`lock\*(C' and \*(C`unlock\*(C'. But those methods are not really implemented in this class. They suppose to be implemented in the derived classes of <strong>IO::LockedFile</strong>.</p><p>Why \*(L"kind\*(R" of abstract? Because the constructor of this class will return an object!</p><p>How abstract class can create objects? This is done by having the constructor returning object that is actually an object of one of the derived classes of <strong>IO::LockedFile</strong>.</p><p>So by default the constructor of <strong>IO::LockedFile</strong> will return an object of <strong>IO::LockedFile::Flock</strong>. For example, the following:</p><p>   use IO::LockedFile;    $lock = new IO::LockedFile("&gt;bla");    print ref($lock);</p><p>Will give:</p><p>   IO::LockedFile::Flock</p><p>So what are the conclusions here?</p><p>First of all - do not be surprised to get object of derived class from the constructor of <strong>IO::LockedFile</strong>.</p><p>Secondly - by changing the default behavior of the constructor of <strong>IO::LockedFile</strong>, we can get object of other class which means that we have a locked file that is locked with other scheme.</p><p>The default behavior of the constructor is determined by the global options.</p><p>We can access this global options, or the options per object using the method \*(C`set_option\*(C' and \*(C`get_option\*(C'.</p><p>We can set the global options in the use line:</p><p>  use IO::LockedFile &apos;Flock&apos;; # set the default scheme to be Flock</p><p>  use IO::LockedFile ( scheme =&gt; Flock );</p><p>We can also set the options of a new object by passing the options to the constructor, as we will see below. We can change the options of an existing object by using the \*(C`set_option\*(C' method.</p><p>Which options are available?</p>
<dl class='dl-vertical'>
  <dt>
    <em>scheme</em>
  </dt>
  <dd>
    <p>The <em>scheme</em> let us define which derived class we use for the object we create. See below which derived classes are available. The default scheme is 'Flock'.</p>
  </dd>
  <dt>
    <em>block</em>
  </dt>
  <dd>
    <p>The <em>block</em> option can be 1 or 0 (true or false). If it is 1, a call to the \*(C`open\*(C' method or to the constructor will be blocked if the file we try to open is already locked. This means that those methods will not return till the file is unlocked. If the value of the <em>block</em> option is 0, the \*(C`open\*(C' and the constructor will return immediately in any case. If the file is locked, those methods will return undef. The default value of the <em>block</em> option is 1.</p>
  </dd>
  <dt>
    <em>lock</em>
  </dt>
  <dd>
    <p>The <em>lock</em> option can be 1 or 0 (true or false). It defines if the file we open when we create the object will be opened locked. Sometimes, we want to have a file that can be locked, yet we do not want to open it locked from the beginning. For example if we want to print into a log file, usually we want to lock that file only when we print into it. Yet, it might be that when we open the file in the beginning we do not print into it immediately. In that case we will prefer to open the file as unlocked, and later we will lock it when needed. The default value of the <em>lock</em> option is 1.</p>
  </dd>

</dl>
<p>There might be extra options that are used by one of the derived classes. So according to the scheme you choose to use, please look in the manual page of the class that implement that scheme.</p><p>Finally, some information that is connected to a certain scheme will be found in the classes that are derived from this class. For example, compatibility issues will be discussed in each derived classes.</p><p>The classes that currently implement the interface that <strong>IO::LockedFile</strong> defines are:</p><ul>
<li><p><strong>IO::LockedFile::Flock</strong></p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    new ( \s-1FILENAME\s0 [,MODE [,PERMS]] )
  </dt>
  <dd>
    <p>Creates an object that belong to one of the derived classes of \*(C`IO::LockedFile\*(C'. If it receives any parameters, they are passed to the method \*(C`open\*(C'. if the \*(C`open\*(C' fails, the object is destroyed. Otherwise, it is returned to the caller. The object will be the file handle of that opened file.</p>
  </dd>
  <dt>
    new ( \s-1OPTIONS\s0, \s-1FILENAME\s0 [,MODE [,PERMS]] )
  </dt>
  <dd>
    <p>This version of the constructor is the same as above, with the difference that we send as the first parameter a reference to a hash - \s-1OPTIONS\s0. This hash let us change for this object only, the options from the default options. So for example if we want to change the <em>lock</em> option from its default we can do it as follow:</p>
<pre>
  $file = new IO::LockedFile( { lock =&gt; 0 },
                              \*(L"&gt;locked_later.txt\*(R" );
</pre>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    open ( \s-1FILENAME\s0 [,MODE [,PERMS]] )
  </dt>
  <dd>
    <p>The method let us open the file \s-1FILENAME\s0. By default, the file will be opened as a locked file, and if the file that is opened is already locked, the method will not return until the file is unlocked. Of course this default behavior can be controlled by setting other options. The object will be the file handle of that opened file. The parameters that should be provided to this method are the same as the parameters that the method \*(C`open\*(C' of <strong>IO::File</strong> accepts. (like \*(L"&gt;file.txt\*(R" for example). Note that the open method checks if the file is opened for reading or for writing, and only then calls the lock method of the derived class that is being used. This way, for example, when using the <strong>Flock</strong> scheme, the lock will be a shared lock for a file that is being read, and exclusive lock for a file that is opened to be write.</p>
  </dd>
  <dt>
    close ( )
  </dt>
  <dd>
    <p>The file will be closed and unlocked. The method returns the same as the close method of <strong>IO::File</strong>.</p>
  </dd>
  <dt>
    lock ( )
  </dt>
  <dd>
    <p>Practically this method does nothing, and returns 1 (true). This method will be overridden by the derived class that implements the scheme we use. When it is overridden, the method suppose to lock the file according to the scheme we use. If the file is already locked, and the <em>block</em> option is 1 (true), the method will not return until the file is unlocked, and locked again by the method. If the <em>block</em> option is 0 (false), the method will return 0 immediately. Besides, the lock method is aware if the file was opened for reading or for writing. Thus, for example, when using the <strong>Flock</strong> scheme, the method will create a shared lock for a file that is being read, and exclusive lock for a file that is opened to be write.</p>
  </dd>
  <dt>
    unlock ( )
  </dt>
  <dd>
    <p>Practically this method does nothing, and returns 1 (true). This method will be overridden by the derived class that implements the scheme we use. When it is overridden, the method suppose to unlock the file according to the scheme we use, and return 1 (true) on success and 0 (false) on failure.</p>
  </dd>
  <dt>
    have_lock ( )
  </dt>
  <dd>
    <p>Will return 1 (true) if the file is already locked by this object. Will return 0 (false) otherwise. Note that this will not tell us anything about the situation of the file itself - thus we should not use this method in order to check if the file is locked by someone else.</p>
  </dd>
  <dt>
    print ( )
  </dt>
  <dd>
    <p>This method is exactly like the \*(C`print\*(C' method of <strong>IO::Handle</strong>, with the difference that when using this method, if the file is unlocked, then before printing to it, it will be locked and afterward it will be unlocked.</p>
  </dd>
  <dt>
    truncate ( )
  </dt>
  <dd>
    <p>This method is exactly like the \*(C`truncate\*(C' method of <strong>IO::Handle</strong>, with the difference that when using this method, if the file is unlocked, then before truncating it, it will be locked and afterward it will be unlocked.</p>
  </dd>
  <dt>
    is_writable ( )
  </dt>
  <dd>
    <p>This method will return 1 (true) if the file was opened to write. Will return 0 (false) otherwise.</p>
  </dd>
  <dt>
    should_block ( )
  </dt>
  <dd>
    <p>This method will return 1 (true) if the block option set to 1. Will return 0 (false) otherwise.</p>
  </dd>
  <dt>
    should_lock ( )
  </dt>
  <dd>
    <p>This method will return 1 (true) if the lock option set to 1. Will return 0 (false) otherwise.</p>
  </dd>
  <dt>
    get_scheme ( )
  </dt>
  <dd>
    <p>This method will return the name of the scheme that is currently used.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Rani Pinchuk, rani@cpan.org</p><p>Rob Napier, rnapier@employees.org</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (c) 2001-2002 Ockham Technology N.V. & Rani Pinchuk. All rights reserved. This package is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO IO::LockedFile&hellip;</h2>
        <div class="sectioncontent">
<p><em>IO::File</em>\|(3), <em>IO::LockedFile::Flock</em>\|(3)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="IO::Lines.3pm.html"><span aria-hidden="true">&larr;</span> IO::Lines.3pm: Io:: interface for reading/writing an array of lines</a></li>
   <li class="next"><a href="IO::LockedFile::Flock.3pm.html">IO::LockedFile::Flock.3pm: Implements the io::lockedfile class for the flock scheme. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
