<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DBIx::Class::Tree::NestedSet: Manage trees of data using the nested set model</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Manage trees of data using the nested set model">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="DBIx::Class::Tree::NestedSet (3pm) manual">
  <meta name="twitter:description" content="Manage trees of data using the nested set model">
  <meta name="twitter:image" content="https://www.carta.tech/images/libdbix-class-tree-nestedset-perl-DBIx::Class::Tree::NestedSet-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/DBIx::Class::Tree::NestedSet.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DBIx::Class::Tree::NestedSet (3pm) manual" />
  <meta property="og:description" content="Manage trees of data using the nested set model" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libdbix-class-tree-nestedset-perl-DBIx::Class::Tree::NestedSet-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">DBIx::Class::Tree::NestedSet<small> (3pm)</small></h1>
        <p class="lead">Manage trees of data using the nested set model</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Class::Tree::NestedSet.3pm.html">
      <span itemprop="name">DBIx::Class::Tree::NestedSet: Manage trees of data using the nested set model</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libdbix-class-tree-nestedset-perl/">
      <span itemprop="name">libdbix-class-tree-nestedset-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Class::Tree::NestedSet.3pm.html">
      <span itemprop="name">DBIx::Class::Tree::NestedSet: Manage trees of data using the nested set model</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Create a table for your tree data.</p>
<pre>
    CREATE TABLE Department (
      id       INTEGER PRIMARY KEY AUTOINCREMENT,
      root_id  integer,
      lft      integer NOT NULL,
      rgt      integer NOT NULL,
      level    integer NOT NULL,
      name     text NOT NULL,
    );
</pre>
<p>In your Schema or \s-1DB\s0 class add Tree::NestedSet to the top of the component list.</p><p>  _\|_PACKAGE_\|_-&gt;load_components(qw( Tree::NestedSet ... ));</p><p>Specify the columns required by the module.</p><p>  package My::Department;   _\|_PACKAGE_\|_-&gt;tree_columns({       root_column     =&gt; &apos;root_id&apos;,       left_column     =&gt; &apos;lft&apos;,       right_column    =&gt; &apos;rgt&apos;,       level_column    =&gt; &apos;level&apos;,   });</p><p>Using it:</p><p>  my $root        = My::Department-&gt;create({ ... });   my $child       = $root-&gt;add_to_children({ ... });</p><p>  my $rs          = $root-&gt;children;   my @descendants = $root-&gt;children;</p><p>  my $parent      = $child-&gt;parent;   my $rs          = $child-&gt;ancestors;   my @ancestors   = $child-&gt;ancestors;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module provides methods for working with nested set trees. The nested tree model is a way of representing hierarchical information in a database. This takes a different approach to the Adjacency List implementation. (see DBIx::Class::Tree::AdjacencyList which uses \*(C`parent\*(C' relationships in a recursive manner.</p><p>The NestedSet implementation can be more efficient for most searches than the Adjacency List Implementation, for example, to obtain all descendants requires recursive queries in the Adjacency List implementation but is a single query in the NestedSet implementation.</p><p>The trade-off is that NestedSet inserts are more expensive so it is most useful if you have an application that does many reads but few inserts.</p><p>More about NestedSets can be found at &lt;http://en.wikipedia.org/wiki/Nested_set_model&gt;</p><p>Oh, and although I give some code examples of familial relationships (where there are usually two parents), both Adjacency List and NestedSet implementations can only have one parent.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATIONS</h2>
        <div class="sectioncontent">
<p>This module automatically creates several relationships.</p><h3>root</h3>
<p>  $root_node = $node-&gt;root;</p><p>A belongs_to relation to the root of $nodes tree.</p>
<h3>nodes</h3>
<p>  $all_nodes = $node-&gt;nodes;   $new_node  = $node-&gt;add_to_nodes({name =&gt; &apos;Mens Wear&apos;});</p><p>A has_many relationship to all the nodes of $nodes tree.</p><p>Adding to this relationship creates a rightmost child to $node.</p>
<h3>parent</h3>
<p>  $parent = $node-&gt;parent;</p><p>A belongs_to relationship to the parent node of $nodes tree.</p><p>Note that only the root node does not have a parent.</p>
<h3>children</h3>
<p>  $rs          = $node-&gt;children;   @children    = $node-&gt;children;   $child       = $node-&gt;add_to_children({name =&gt; &apos;Toys&apos;});</p><p>A has_many relation to the children of $node.</p><p>Adding to this relationship creates a rightmost child to $node.</p>
<h3>descendants</h3>
<p>  $rs          = $node-&gt;descendants;   @descendants = $node-&gt;descendants;   $child       = $node-&gt;add_to_descendants({name =&gt; &apos;Mens Wear&apos;});</p><p>A has_many relation to the descendants of $node.</p><p>Adding to this relationship creates a rightmost child to $node.</p>
<h3>ancestors</h3>
<p>  $rs          = $node-&gt;ancestors;   @ancestors   = $node-&gt;ancestors;   $parent      = $node-&gt;add_to_ancestors({name =&gt; &apos;Head office&apos;});</p><p>A has_many relation to the ancestors of $node.</p><p>Adding to this relationship creates a new node in place of $node and makes it the parent of $node. All descendants of $node will likewise be pushed town the hierarchy.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>Many methods have alternative names, e.g. \*(C`left_siblings\*(C' and \*(C`previous_siblings\*(C'</p><p>This is in deference to the DBIx::Class::Ordered module which uses terms \*(C`previous\*(C' \*(C`next\*(C' \*(C`first\*(C' and \*(C`last\*(C'.</p><p>Similarly DBIx::Class::Tree::AdjacencyList::Ordered uses terms \*(C`append\*(C', \*(C`prepend\*(C', \*(C`before\*(C' and \*(C`after\*(C'</p><p>However, my preference to use terms \*(C`left\*(C' and \*(C`right\*(C' consistently when using this module. However, the other names are available if you are more familiar with those modules.</p><h3>tree_columns</h3>
<p>  _\|_PACKAGE_\|_-&gt;tree_columns({       left_column   =&gt; &apos;lft&apos;,       right_column  =&gt; &apos;rgt&apos;,       root_column   =&gt; &apos;root_id&apos;,       level_column  =&gt; &apos;level&apos;,   });</p><p>Declare the name of the columns defined in the database schema.</p><p>None of these columns should be modified outside if this module. left_column and right_column are unlikely to be of any use to your application. They should be integer fields.</p><p>Multiple trees are allowed in the same table, each tree will have a unique value in the root_column. In the current implementation this should be an integer field</p><p>The level_column may be of use in your application, it defines the depth of each node in the tree (with the root at level zero).</p>
<h3>create</h3>
<p>  my $tree    = $schema-&gt;resultset(&apos;My::Department&apos;)-&gt;create({       name    = &apos;Head Office&apos;,   });</p><p>  my $tree    = $schema-&gt;resultset(&apos;My::Department&apos;)-&gt;create({       name    = &apos;UK Office&apos;,       root_id = $uk_office_ident,   });</p><p>Creates a new root node.</p><p>If the root_column (root_id) is not provided then it defaults to producing a node where the root_column has the same value as the primary key. This will croak if the table is defined with multiple key primary index.</p><p>Note that no checks (yet) are made to stop you creating another key with the same root_id as an existing tree. If you do so you will get into a terrible mess!</p>
<h3>delete</h3>
<p>  $department-&gt;delete;</p><p>This will delete the node and all descendants. Cascade Delete is turned off in the has_many relationships \*(C`nodes\*(C' \*(C`children\*(C' \*(C`descendants\*(C' so that delete \s-1DTRT\s0.</p>
<h3>is_root</h3>
<p>  if ($node-&gt;is_root) {       print "Node is a root&#92;n";   }</p><p>Returns true if the $node is a root node</p>
<h3>is_branch</h3>
<p>  $has_children = $node-&gt;is_branch;</p><p>Returns true if the node is a branche (i.e. has children)</p>
<h3>is_leaf</h3>
<p>  $is_terminal_node = $node-&gt;is_leaf;</p><p>Returns true if the node is a leaf (i.e. it has no children)</p>
<h3>siblings</h3>
<p>  @siblings    = $node-&gt;siblings;   $siblings_rs = $node-&gt;siblings;</p><p>Returns all siblings of this $node excluding $node itself.</p><p>Since a root node has no siblings it returns undef.</p>
<h3>left_siblings (or previous_siblings)</h3>
<p>  @younger_siblings    = $node-&gt;left_siblings;   $younger_siblings_rs = $node-&gt;left_siblings;</p><p>Returns all siblings of this $node to the left this $node.</p><p>Since a root node has no siblings it returns undef.</p>
<h3>right_siblings (or next_siblings)</h3>
<p>  @older_siblings      = $node-&gt;right_siblings;   $older_siblings_rs   = $node-&gt;right_siblings;</p><p>Returns all siblings of this $node to the right of this $node.</p><p>Since a root node has no siblings it returns undef.</p>
<h3>left_sibling (or previous_sibling)</h3>
<p>  $younger_sibling = $node-&gt;left_sibling;</p><p>Returns the sibling immediately to the left of this $node (if any).</p>
<h3>right_sibling (or next_sibling)</h3>
<p>  $older_sibling = $node-&gt;right_sibling;</p><p>Returns the sibling immediately to the right of this $node (if any).</p>
<h3>leftmost_sibling (or first_sibling)</h3>
<p>  $youngest_sibling = $node-&gt;leftmost_sibling;</p><p>Returns the left most sibling relative to this $node (if any).</p><p>Does not return this $node if this node is the leftmost sibling.</p>
<h3>rightmost_sibling (or last_sibling)</h3>
<p>  $oldest_sibling = $node-&gt;rightmost_sibling;</p><p>Returns the right most sibling relative to this $node (if any).</p><p>Does not return this $node if this node is the rightmost sibling.</p>
<h3>\s-1CREATE\s0 \s-1METHODS\s0</h3>
<p>The following create methods create a new node in relation to an existing node.</p>
<h3>create_right_sibling</h3>
<p>  $bart-&gt;create_right_sibling({ name =&gt; &apos;Lisa&apos; });</p><p>Create a new node as a right sibling to $bart.</p>
<h3>create_left_sibling</h3>
<p>  $bart-&gt;create_left_sibling({ name =&gt; &apos;Maggie&apos; });</p><p>Create a new node as a left sibling to $bart.</p>
<h3>create_rightmost_child</h3>
<p>  $homer-&gt;create_rightmost_child({ name =&gt; &apos;Lisa&apos; });</p><p>Create a new node as a rightmost child to $homer</p>
<h3>create_leftmost_child</h3>
<p>  $homer-&gt;create_leftmost_child({ name =&gt; &apos;Maggie&apos; });</p><p>Create a new node as a leftmost child to $homer</p>
<h3>\s-1ATTACH\s0 \s-1METHODS\s0</h3>
<p>The following attach methods take an existing node (and all of it's descendants) and attaches them to the tree in relation to an existing node.</p><p>The node being inserted can either be from the same tree (as identified by the root_column) or from another tree. If the root of another tree is attached then the whole of that tree becomes a sub-tree of this node's tree.</p><p>The only restriction is that the node being attached cannot be an ancestor of this node.</p><p>When attaching multiple nodes we try to \s-1DWIM\s0 so that the order they are specified in the call represents the order they appear in the siblings list.</p><p>e.g. if we had a parent with children A,B,C,D,E</p><p>and we attached nodes 1,2,3 in the following calls, we expect the following results.</p><p>  $parent-&gt;attach_rightmost_child    1,2,3 gives us children A,B,C,D,E,1,2,3</p><p>  $parent-&gt;attach_leftmost_child     1,2,3 gives us children 1,2,3,A,B,C,D,E</p><p>  $child_C-&gt;attach_right_sibling     1,2,3 gives us children A,B,C,1,2,3,D,E</p><p>  $child_C-&gt;attach_left_sibling      1,2,3 gives us children A,B,1,2,3,C,D,E</p><p>  $child_C-&gt;attach_rightmost_sibling 1,2,3 gives us children A,B,C,D,E,1,2,3</p><p>  $child_C-&gt;attach_leftmost_sibling  1,2,3 gives us children 1,2,3,A,B,C,D,E</p>
<h3>attach_rightmost_child (or append_child)</h3>
<p>  $parent-&gt;attach_rightmost_child($other_node);   $parent-&gt;attach_rightmost_child($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $parent as the rightmost children.</p>
<h3>attach_leftmost_child</h3>
<p>  $parent-&gt;attach_leftmost_child($other_node);   $parent-&gt;attach_leftmost_child($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $parent as the leftmost children.</p>
<h3>attach_right_sibling (or attach_after)</h3>
<p>  $node-&gt;attach_right_sibling($other_node);   $node-&gt;attach_right_sibling($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $node as it's siblings.</p>
<h3>attach_left_sibling</h3>
<p>  $node-&gt;attach_left_sibling($other_node);   $node-&gt;attach_left_sibling($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $node as it's left siblings.</p>
<h3>attach_rightmost_sibling</h3>
<p>  $node-&gt;attach_rightmost_sibling($other_node);   $node-&gt;attach_rightmost_sibling($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $node as it's rightmost siblings.</p>
<h3>attach_leftmost_sibling</h3>
<p>  $node-&gt;attach_leftmost_sibling($other_node);   $node-&gt;attach_leftmost_sibling($other_node_1, $other_node_2, ...);</p><p>Attaches the other_nodes to $node as it's leftmost siblings.</p>
<h3>move_left (or move_previous)</h3>
<p>  $node-&gt;move_left;</p><p>Exchange the $node with the sibling immediately to the left and return the node it exchanged with.</p><p>If the $node is already the leftmost node then no exchange takes place and the method returns undef.</p>
<h3>move_right (or move_next)</h3>
<p>  $node-&gt;move_right;</p><p>Exchange the $node with the sibling immediately to the right and return the node it exchanged with.</p><p>If the $node is already the rightmost node then no exchange takes place and the method returns undef.</p>
<h3>move_leftmost (or move_first)</h3>
<p>  $node-&gt;move_leftmost;</p><p>Exchange the $node with the leftmost sibling and return the node it exchanged with.</p><p>If the $node is already the leftmost node then no exchange takes place and the method returns undef.</p>
<h3>move_rightmost (or move_last)</h3>
<p>  $node-&gt;move_rightmost;</p><p>Exchange the $node with the rightmost sibling and return the node it exchanged with.</p><p>If the $node is already the rightmost node then no exchange takes place and the method returns undef.</p>
<h3>\s-1CUTTING\s0 \s-1METHODS\s0</h3>

<h3>take_cutting</h3>
<p>Cuts the invocant and its descendants out of the tree they are in, making the invocant the root of a new tree. Returns the modified invocant.</p>
<h3>dissolve</h3>
<p>Dissolves the entire thread, that is turn each node of the thread into a single-item tree of its own.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<h3>Multiple Column Primary Keys</h3>
<p>Support for Multiple Column Primary Keys is limited (mainly because I rarely use them) but I have tried to make it possible to use them. Please let me know if this does not work as well as you expect.</p>
<h3>discard_changes</h3>
<p>By the nature of Nested Set implementations, moving, inserting or deleting nodes in the tree will potentially update many (sometimes most) other nodes.</p><p>Even if you have preloaded some of the objects, if you make a change to one object the other objects will not reflect their new value until you have reloaded them from the database. (see \*(L"discard_changes\*(R" in DBIx::Class::Row)</p><p>A simple demonstration of this</p><p>  $grampa   = $schema-&gt;schema-&gt;resultset(&apos;Simpsons&apos;)-&gt;create({ name =&gt; &apos;Abraham&apos; });   $homer    = $grampa-&gt;add_children({name =&gt; &apos;Homer&apos;});   $bart     = $homer-&gt;add_children({name =&gt; &apos;Bart&apos;});</p><p>The methods in this module will do their best to keep instances that they know about updated. For example the first call to \*(C`add_children\*(C' in the above example will update $grampa and $homer with the latest changes to the database.</p><p>However, the second call to \*(C`add_children\*(C' only knows about $homer and $bart and in adding a new node to the tree it will update the $grampa node in the database. To ensure you have the latest changes do the following.</p><p>  $grampa-&gt;discard_changes.</p><p>Not doing so will have unpredictable results.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Code by Ian Docherty &lt;pause@iandocherty.com&gt;</p><p>Based on original code by Florian Ragwitz &lt;rafl@debian.org&gt;</p><p>Incorporating ideas and code from Pedro Melo &lt;melo@simplicidade.org&gt;</p><p>Special thanks to Moritz Lenz who sent in lots of patches and changes for version 0.08</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (c) 2009-2011 The above authors</p><p>This is free software; you can redistribute it and/or modify it under the same terms as Perl itself, either Perl version 5.10.0 or, at your option, any later version of Perl 5 you may have available.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="DBIx::Class::TimeStamp.3pm.html"><span aria-hidden="true">&larr;</span> DBIx::Class::TimeStamp.3pm: Dbix::class extension to update and create date and time based fields</a></li>
   <li class="next"><a href="DBIx::Class::UUIDColumns.3pm.html">DBIx::Class::UUIDColumns.3pm: Implicit uuid columns <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
