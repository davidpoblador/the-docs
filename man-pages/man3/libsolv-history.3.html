<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libsolv-history: How the libsolv library came into existence</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="How the libsolv library came into existence">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libsolv-history (3) manual">
  <meta name="twitter:description" content="How the libsolv library came into existence">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsolv-doc-libsolv-history-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libsolv-history.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libsolv-history (3) manual" />
  <meta property="og:description" content="How the libsolv library came into existence" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsolv-doc-libsolv-history-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libsolv-history<small> (3)</small></h1>
        <p class="lead">How the libsolv library came into existence</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libsolv-history.3.html">
      <span itemprop="name">libsolv-history: How the libsolv library came into existence</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsolv-doc/">
      <span itemprop="name">libsolv-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libsolv-history.3.html">
      <span itemprop="name">libsolv-history: How the libsolv library came into existence</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p>This project was started in May 2007 when the zypp folks decided to switch to a database to speed up installation. As I am not a big fan of databases, I (mls) wondered if there would be really some merit of using one for solving, as package dependencies of all packages have to be read in anyway.</p><p>Back in 2002, I researched that using a dictionary approach for storing dependencies can reduce the packages file to 1/3 of its size. Extending this idea a bit more, I decided to store all strings and relations as unique 32-bit numbers. This has three big advantages:</p><p>because of the unification, testing whether two strings are equal is the same as testing the equality of two numbers, thus very fast</p><p>much space is saved, as numbers do not take up as much space as strings the internal memory representation does not take more space on a 64-bit system where a pointer is twice the size of a 32-bit number</p><p>Thus, the solv format was created, which stores a repository as a string dictionary, a relation dictionary and then all packages dependencies. Tests showed that reading and merging multiple solv repositories takes just some milliseconds.</p><h3>Early solver experiments</h3>
<p>Having a new repository format was one big step, but the other area where libzypp needed improvement was the solver. Libzypp\(cqs solver was a port from the Red Carpet solver, which was written to update packages in an already installed system. Using it for the complete installation progress brought it to its limits. Also, the added extensions like support for weak dependencies and patches made it fragile and unpredictable.</p><p>As I was not very pleased with the way the solver worked, I looked at other solver algorithms. I checked smart, yum and apt, but could not find a convincing algorithm. My own experiments also were not very convincing, they worked fine for some problems but failed miserably for other corner cases.</p>
<h3>Using SAT for solving</h3>
<p>SUSE\(cqs hack week at the end of June 2007 turned out to be a turning point for the solver. Googling for solver algorithms, I stumbled over some note saying that some people are trying to use SAT algorithms to improve solving on Debian. Looking at the SAT entry in Wikipedia, it was easy to see that this indeed was the missing piece: SAT algorithms are well researched and there are quite some open source implementations. I decided to look at the minisat code, as it is one of the fastest solvers while consisting of too many lines of code.</p><p>Of course, directly using minisat would not work, as a package solver does not need to find just one correct solution, but it also has to optimize some metrics, i.e. keep as many packages installed as possible. Thus, I needed to write my own solver incorporation the ideas and algorithms used in minisat. This wasn\(cqt very hard, and at the end of the hack week the solver calculated the first right solutions.</p>
<h3>Selling it to libzypp</h3>
<p>With those encouraging results, I went to Klaus Kaempf, the system management architect at SUSE. We spoke about how to convince the team to make libzypp switch to the new solver. Fortunately, libzypp comes with a plethora of solver test cases, so we decided to make the solver pass most of the test cases first. Klaus wrote a "deptestomatic" implementation to check the test cases. Together with Stephan Kulow, who is responsible for the openSUSE distribution, we tweaked and extended the solver until most of the test cases looked good.</p><p>Duncan Mac-Vicar Prett, the team lead of the YaST team, also joined development by creating Ruby bindings for the solver. Later, Klaus improved the bindings and ported them to some other languages.</p>
<h3>The attribute store</h3>
<p>The progress with the repository format and the solver attracted another hacker to the project: Michael Matz from the compiler team. He started with improving the repository parsers so that patches and content files also generate solvables. After that, he concentrated on storing all of the other metadata of the repositories that are not used for solving, like the package summaries and descriptions. At the end of October, a first version of this "attribute store" was checked in. Its design goals were:</p><p>space efficient storage of attributes</p><p>paging/on demand loading of data</p><p>page compression</p><p>The first version of the attribute store used a different format for storing information, we later merged this format with the solv file format.</p>
<h3>libzypp integration</h3>
<p>Integration of the sat-solver into libzypp also started in October 2007 by Stefan Schubert and Michael Andres from the YaST team. The first versions supported both the old solver and the new one by using the old repository read functions and converting the old package data in-memory into a sat solver pool. Solvers could be switched with the environment variable ZYPP_SAT_SOLVER. The final decision to move to the new solver was made in January of 2008, first just by making the new solver the default one, later by completely throwing out the old solver code. This had the advantage that the internal solvable storage could also be done by using the solver pool, something Michael Matz already played with in a proof of concept implementation showing some drastic speed gains. The last traces of the old database code were removed in February.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Michael Schroeder &lt;mls@suse.de&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libsolv-constantids.3.html"><span aria-hidden="true">&larr;</span> libsolv-constantids.3: Fixed ids for often used strings</a></li>
   <li class="next"><a href="libsolv-pool.3.html">libsolv-pool.3: Libsolvs pool object <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
