<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>asmerge: Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="asmerge (3x) manual">
  <meta name="twitter:description" content="Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge">
  <meta name="twitter:image" content="https://www.carta.tech/images/libafterimage-dev-asmerge-3x.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3x/asmerge.3x.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="asmerge (3x) manual" />
  <meta property="og:description" content="Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libafterimage-dev-asmerge-3x.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">asmerge<small> (3x)</small></h1>
        <p class="lead">Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/asmerge.3x.html">
      <span itemprop="name">asmerge: Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libafterimage-dev/">
      <span itemprop="name">libafterimage-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/asmerge.3x.html">
      <span itemprop="name">asmerge: Asmerge- demonstrates blending of multiple image using different algorithms libafterimage/tutorials/asmerge</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">NAMEASMerge</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Scaling and blending of arbitrary number of images using libAfterImage.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>We will attempt to interpret command line arguments as sequence of image filenames, geometries and blending types. We'll then try and load all the images, scaling first one to requested size, and blending others at specifyed locations of the first image. We then display the result in simple window. After that we would want to wait, until user closes our window.</p><p>New steps described in this tutorial are : Step 1. Layers. Step 2. Merging methods. Step 3. Layer parameters. Step 4. Actual blending of the set of images.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asmerge&hellip;</h2>
        <div class="sectioncontent">
<p>Tutorial 1: ASView  - explanation of basic steps needed to use</p>
<pre>
                      libAfterImage and some other simple things.
</pre>
<p>Tutorial 2: ASScale - image scaling basics. Tutorial 3: ASTile  - image tiling and tinting</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOURCE</h2>
        <div class="sectioncontent">
<p>#include "../afterbase.h" #include "../afterimage.h" #include "common.h"</p><p>char *burning_rose[] = {</p>
<pre>
    "asmerge",
    "rose512.jpg",
    "add",
    "back.xpm:512x386",
    "hue",
    "fore.xpm:512x386"
</pre>
<p>};</p><p>void usage() {</p>
<pre>
    printf( "Usage: asmerge [-h]|[image op1 image1 [op2 image2 [...]]]&#92;n");
    printf( "Where: image  - is background image filename&#92;n");
    printf( "       image1 - is first overlay's filename&#92;n");
    printf( "       op1,op2,... - overlay operation."
            " Supported operations are :&#92;n");
    list_scanline_merging( stdout,
            "         %-15.15s- %s&#92;n");
</pre>
<p>}</p><p>int main(int argc, char* argv[]) {</p>
<pre>
    Display *dpy = NULL;
    ASVisual *asv ;
    int screen = 0, depth = 0;
    int to_width = 1, to_height = 1;
    ASImageLayer *layers ;
    int layers_num = 0, i;
    ASImage *merged_im ;
</pre>

<pre>
    /* see ASView.1 : */
    set_application_name( argv[0] );
</pre>
<p>#if (HAVE_AFTERBASE_FLAG==1)</p>
<pre>
    set_output_threshold(OUTPUT_LEVEL_DEBUG);
</pre>
<p>#endif</p>
<pre>
    if( argc == 2 && strncmp(argv[1],"-h", 2) == 0 )
    {
        usage();
        return 0;
    }
    if( argc &lt;= 3 )
    {
        show_error( "not enough arguments, please see usage:%s", " ");
        usage() ;
        printf( "Using the default,          printf( "&#92;n&#92;trose512.jpg add back.xpm:512x386 hue "
                "fore.xpm:512x386&#92;n");
        argv = &(burning_rose[0]) ;
        argc = 6;
    }
</pre>
<p>#ifndef X_DISPLAY_MISSING</p>
<pre>
    dpy = XOpenDisplay(NULL);
    _XA_WM_DELETE_WINDOW = XInternAtom( dpy, "WM_DELETE_WINDOW", False);
    screen = DefaultScreen(dpy);
    depth = DefaultDepth( dpy, screen );
</pre>
<p>#endif</p>
<pre>
    /* see ASView.3 : */
    asv = create_asvisual( dpy, screen, depth, NULL );
</pre>

<pre>
    /* see ASMerge.1 : */
    layers = safecalloc( argc/2, sizeof(ASImageLayer) );
</pre>

<pre>
    for( i = 1 ; i &lt; argc ; i++ )
    {
        int x = 0, y = 0;
        unsigned int width, height ;
        int geom_flags = 0 ;
        char *separator;
        char *filename ;
        /* see ASMerge.2 */
        if( i &gt; 1 )
        {
            /* see blend_scanlines_name2func() : */
            if((layers[layers_num].merge_scanlines =
                 blend_scanlines_name2func( argv[i] )) == NULL )
                continue ;
            if( ++i &gt;= argc )
                break;
        }
        if( (separator = strchr( argv[i], ':' )) != NULL )
        {   /* see ASTile.1 : */
            geom_flags = XParseGeometry( separator+1,
                                         &x, &y, &width, &height);
            filename = mystrndup( argv[i], separator-argv[i] );
        }else
            filename = argv[i] ;
        layers[layers_num].im = file2ASImage( filename, 0xFFFFFFFF,
                                              SCREEN_GAMMA, 100, getenv("IMAGE_PATH"), NULL );
        if( filename != argv[i] )
            free( filename );
        if( layers[layers_num].im != NULL )
        {
            if( !get_flags(geom_flags, WidthValue) )
                width = layers[layers_num].im-&gt;width  ;
            if( !get_flags(geom_flags, HeightValue) )
                height = layers[layers_num].im-&gt;height ;
            /* see ASMerge.3 : */
            if( layers[layers_num].merge_scanlines == NULL )
                layers[layers_num].merge_scanlines =
                    alphablend_scanlines ;
            layers[layers_num].clip_width = width ;
            layers[layers_num].clip_height = height ;
            if( layers_num &gt; 0 )
            {
                layers[layers_num].dst_x = x ;
                layers[layers_num].dst_y = y ;
            }else
            {
                to_width = width ;
                to_height = height ;
                if( width != layers[layers_num].im-&gt;width ||
                    height != layers[layers_num].im-&gt;height )
                {
                    ASImage *scaled_bottom ;
                    /* see ASScale.2 : */
                    scaled_bottom = scale_asimage( asv,
                                                   layers[layers_num].im,
                                                   width, height,
                                                   False, 100,
                                                ASIMAGE_QUALITY_DEFAULT );
                    destroy_asimage( &(layers[layers_num].im) );
                    layers[layers_num].im = scaled_bottom ;
                }
            }
            ++layers_num ;
        }
    }
</pre>

<pre>
    if( layers_num &lt;= 0 )
    {
        show_error( "there is no images to merge. Aborting");
        return 2;
    }
</pre>

<pre>
    /* see ASMerge.4 */
    merged_im = merge_layers( asv, layers, layers_num,
                              to_width, to_height,
</pre>
<p>#ifndef X_DISPLAY_MISSING</p>
<pre>
                              ASA_XImage,
</pre>
<p>#else</p>
<pre>
                              ASA_ASImage,
</pre>
<p>#endif</p>
<pre>
                              0, ASIMAGE_QUALITY_DEFAULT );
    while( --layers_num &gt;= 0 )
        destroy_asimage( &(layers[layers_num].im) );
    free( layers );
</pre>

<pre>
    if( merged_im )
    {
</pre>
<p>#ifndef X_DISPLAY_MISSING</p>
<pre>
    /* see ASView.4 : */
        Window w = create_top_level_window( asv, DefaultRootWindow(dpy),
                                            32, 32,
                                            to_width, to_height,
                                            1, 0, NULL,
                                            "ASMerge", NULL );
        if( w != None )
        {
            Pixmap p ;
</pre>

<pre>
            XMapRaised   (dpy, w);
            /* see ASView.5 : */
            p = asimage2pixmap( asv, DefaultRootWindow(dpy), merged_im,
                            NULL, True );
</pre>

<pre>
            destroy_asimage( &merged_im );
            /* see common.c: set_window_background_and_free() : */
            p = set_window_background_and_free( w, p );
            /* see common.c: wait_closedown() : */
        }
        wait_closedown(w);
        dpy = NULL;
</pre>
<p>#else</p>
<pre>
        /* writing result into the file */
        ASImage2file( merged_im, NULL, "asmerge.jpg", ASIT_Jpeg, NULL );
        destroy_asimage( &merged_im );
</pre>
<p>#endif</p>
<pre>
    }
</pre>
<p>#ifdef DEBUG_ALLOCS</p>
<pre>
    build_xpm_colormap(NULL);
    print_unfreed_mem();
</pre>
<p>#endif</p>
<pre>
    return 0 ;
</pre>
<p>}</p><p>libAfterImage/tutorials/ASMerge.1 [4.1]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 1. Layers.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>libAfterImage performs blending/merging of different images, using arrays of ASImageLayer structures, with first element representing the bottommost image. Each structure specifies exact position on resulting image where overlay should be blended to, tint of the overlay, size, to which overlay should be tiled, overlay's origin, and overlay's background color. Arbitrary number of layers can be merged whithin single run.</p><p>Accordingly all that is needed to merge bunch of images is to create array of ASImageLayer structures and fill it up appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    layers = safecalloc( argc/2, sizeof(ASImageLayer) );
</pre>
<p>libAfterImage/tutorials/ASMerge.2 [4.2]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 2. Merging methods.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Each layer can be merged in using its own method. There are about 15 different methods implemented in libAfterImage, and user app can implement other methods of its own. To specify method all that is needed is to set merge_scanlines member of ASImageLayer to pointer to the function, implementing specific method.</p><p>libAfterImage provides facility to parse method name strings into actuall function pointers. That could be used to simplifi scripting, etc.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
       if((layers[layers_num].merge_scanlines =
           blend_scanlines_name2func( argv[i] )) == NULL )
           continue ;
</pre>
<p>NOTE All layers MUST have valid merge_scanlines pointer, even the bottommost layer, despite the fact that it has nothing to be merged with. If merge_scanlines is set to NULL - this layer will be ignored. That could be used to turn on/off particular layers. libAfterImage/tutorials/ASMerge.3 [4.3]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 3. Layer parameters.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Several ASImageLayer members are mandatory and cannot be set to 0. Such as : im - image to be merged; clip_width, clip_height - this will be used to tile the image; merge_scanlines - must be set to a pointer to the function implementing merging method. If any of this is set to 0  - then layer will be ignored. The rest of the parameters are optional. Note thou that tint parameter will tint overlay's RGB components and alpha component, as the result it could be used to make opaque images - semitransparent.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    if( layers[layers_num].merge_scanlines == NULL )
        layers[layers_num].merge_scanlines =
            alphablend_scanlines ;
    layers[layers_num].clip_width = width ;
    layers[layers_num].clip_height = height ;
    if( layers_num &gt; 0 )
    {
        layers[layers_num].dst_x = x ;
        layers[layers_num].dst_y = y ;
    }
</pre>
<p>libAfterImage/tutorials/ASMerge.4 [4.4]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 4. Actual blending of the set of images.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>After set of layers has been prepared - it can be passed to merge_layers() function, that will create new ASImage of specifyed size, and then blend all the layers together to fill this image.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
        merged_im = merge_layers( asv, layers, layers_num,
                                  to_width, to_height,
                                  ASA_ASImage, 0,
                                  ASIMAGE_QUALITY_DEFAULT );
        while( --layers_num &gt;= 0 )
            destroy_asimage( &(layers[layers_num].im) );
        free( layers );
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>After we've blended layers - we no longer need ASImageLayer array. So proceeding to clean it up, by destroying overlay AsImages first, and then freeing array itself.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asmerge&hellip;</h2>
        <div class="sectioncontent">
<p>merge_asimage().</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="asimagexml.3x.html"><span aria-hidden="true">&larr;</span> asimagexml.3x: Asimagexml- xml schema to be used for scripting image manipulation by afterstep and ascompose libafterimage/asimagexml</a></li>
   <li class="next"><a href="asscale.3x.html">asscale.3x: Asscale- demonstrates image loading and scaling libafterimage/tutorials/asscale <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
