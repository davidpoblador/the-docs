<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Eval::Closure: Safely and cleanly create closures via string eval</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Safely and cleanly create closures via string eval">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Eval::Closure (3pm) manual">
  <meta name="twitter:description" content="Safely and cleanly create closures via string eval">
  <meta name="twitter:image" content="https://www.carta.tech/images/libeval-closure-perl-Eval::Closure-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Eval::Closure.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Eval::Closure (3pm) manual" />
  <meta property="og:description" content="Safely and cleanly create closures via string eval" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libeval-closure-perl-Eval::Closure-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Eval::Closure<small> (3pm)</small></h1>
        <p class="lead">Safely and cleanly create closures via string eval</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Eval::Closure.3pm.html">
      <span itemprop="name">Eval::Closure: Safely and cleanly create closures via string eval</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libeval-closure-perl/">
      <span itemprop="name">libeval-closure-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Eval::Closure.3pm.html">
      <span itemprop="name">Eval::Closure: Safely and cleanly create closures via string eval</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>version 0.11</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use Eval::Closure;

  my $code = eval_closure(
      source      =&gt; &apos;sub { $foo++ }&apos;,
      environment =&gt; {
          &apos;$foo&apos; =&gt; &#92;1,
      },
  );

  warn $code-&gt;(); # 1
  warn $code-&gt;(); # 2

  my $code2 = eval_closure(
      source =&gt; &apos;sub { $code-&gt;() }&apos;,
  ); # dies, $code isn&apos;t in scope
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>String eval is often used for dynamic code generation. For instance, \*(C`Moose\*(C' uses it heavily, to generate inlined versions of accessors and constructors, which speeds code up at runtime by a significant amount. String eval is not without its issues however - it's difficult to control the scope it's used in (which determines which variables are in scope inside the eval), and it's easy to miss compilation errors, since eval catches them and sticks them in $@ instead.</p><p>This module attempts to solve these problems. It provides an \*(C`eval_closure\*(C' function, which evals a string in a clean environment, other than a fixed list of specified variables. Compilation errors are rethrown automatically.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS</h2>
        <div class="sectioncontent">
<h3>eval_closure(%args)</h3>
<p>This function provides the main functionality of this module. It is exported by default. It takes a hash of parameters, with these keys being valid:</p>
<dl class='dl-vertical'>
  <dt>
    source
  </dt>
  <dd>
    <p>The string to be evaled. It should end by returning a code reference. It can access any variable declared in the \*(C`environment\*(C' parameter (and only those variables). It can be either a string, or an arrayref of lines (which will be joined with newlines to produce the string).</p>
  </dd>
  <dt>
    environment
  </dt>
  <dd>
    <p>The environment to provide to the eval. This should be a hashref, mapping variable names (including sigils) to references of the appropriate type. For instance, a valid value for environment would be \*(C`{ &apos;@foo&apos; =&gt; [] }\*(C' (which would allow the generated function to use an array named @foo). Generally, this is used to allow the generated function to access externally defined variables (so you would pass in a reference to a variable that already exists). In perl 5.18 and greater, the environment hash can contain variables with a sigil of \*(C`&\*(C'. This will create a lexical sub in the evaluated code (see \*(L"The 'lexical_subs' feature\*(R" in feature). Using a \*(C`&\*(C' sigil on perl versions before lexical subs were available will throw an error.</p>
  </dd>
  <dt>
    alias
  </dt>
  <dd>
    <p>If set to true, the coderef returned closes over the variables referenced in the environment hashref. (This feature requires Devel::LexAlias.) If set to false, the coderef closes over a <em>shallow copy</em> of the variables. If this argument is omitted, Eval::Closure will currently assume false, but this assumption may change in a future version.</p>
  </dd>
  <dt>
    description
  </dt>
  <dd>
    <p>This lets you provide a bit more information in backtraces. Normally, when a function that was generated through string eval is called, that stack frame will show up as \*(L"(eval n)\*(R", where 'n' is a sequential identifier for every string eval that has happened so far in the program. Passing a \*(C`description\*(C' parameter lets you override that to something more useful (for instance, Moose overrides the description for accessors to something like \*(L"accessor foo at MyClass.pm, line 123\*(R").</p>
  </dd>
  <dt>
    line
  </dt>
  <dd>
    <p>This lets you override the particular line number that appears in backtraces, much like the \*(C`description\*(C' option. The default is 1.</p>
  </dd>
  <dt>
    terse_error
  </dt>
  <dd>
    <p>Normally, this function appends the source code that failed to compile, and prepends some explanatory text. Setting this option to true suppresses that behavior so you get only the compilation error that Perl actually reported.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>No known bugs.</p><p>Please report any bugs to GitHub Issues at https://github.com/doy/eval-closure/issues &lt;https://github.com/doy/eval-closure/issues&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Eval::Closure&hellip;</h2>
        <div class="sectioncontent">
<ul>
<li><p>Class::MOP::Method::Accessor This module is a factoring out of code that used to live here</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>You can find this documentation for this module with the perldoc command.</p><p>    perldoc Eval::Closure</p><p>You can also look for information at:</p><ul>
<li><p>MetaCPAN https://metacpan.org/release/Eval-Closure &lt;https://metacpan.org/release/Eval-Closure&gt;</p></li><li><p>Github https://github.com/doy/eval-closure &lt;https://github.com/doy/eval-closure&gt;</p></li><li><p>\s-1RT:\s0 \s-1CPAN\s0's request tracker http://rt.cpan.org/NoAuth/Bugs.html?Dist=Eval-Closure &lt;http://rt.cpan.org/NoAuth/Bugs.html?Dist=Eval-Closure&gt;</p></li><li><p>\s-1CPAN\s0 Ratings http://cpanratings.perl.org/d/Eval-Closure &lt;http://cpanratings.perl.org/d/Eval-Closure&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Based on code from Class::MOP::Method::Accessor, by Stevan Little and the Moose Cabal.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jesse Luehrs &lt;doy@tozt.net&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>This software is copyright (c) 2013 by Jesse Luehrs.</p><p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Env::Path.3pm.html"><span aria-hidden="true">&larr;</span> Env::Path.3pm: Advanced operations on path variables</a></li>
   <li class="next"><a href="Eval::Context.3pm.html">Eval::Context.3pm:  <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
