<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>curl_formadd: Add a section to a multipart/formdata http post</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Add a section to a multipart/formdata http post">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="curl_formadd (3) manual">
  <meta name="twitter:description" content="Add a section to a multipart/formdata http post">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcurl4-doc-curl_formadd-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/curl_formadd.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="curl_formadd (3) manual" />
  <meta property="og:description" content="Add a section to a multipart/formdata http post" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcurl4-doc-curl_formadd-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">curl_formadd<small> (3)</small></h1>
        <p class="lead">Add a section to a multipart/formdata http post</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/curl_formadd.3.html">
      <span itemprop="name">curl_formadd: Add a section to a multipart/formdata http post</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcurl4-doc/">
      <span itemprop="name">libcurl4-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/curl_formadd.3.html">
      <span itemprop="name">curl_formadd: Add a section to a multipart/formdata http post</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;curl/curl.h&gt;</strong></p><p><strong>CURLFORMcode curl_formadd(struct curl_httppost ** </strong><em>firstitem,</em> <strong>struct curl_httppost ** </strong><em>lastitem,</em><strong> ...);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>curl_formadd() is used to append sections when building a multipart/formdata HTTP POST (sometimes referred to as RFC2388-style posts). Append one section at a time until you've added all the sections you want included and then you pass the <em>firstitem</em> pointer as parameter to <a href="../man3/CURLOPT_HTTPPOST.3.html"><strong>CURLOPT_HTTPPOST</strong>(3)</a></strong>. <em>lastitem</em> is set after each <a href="../man3/curl_formadd.3.html"><strong>curl_formadd</strong>(3)</a></em> call and on repeated invokes it should be left as set to allow repeated invokes to find the end of the list faster.</p><p>After the <em>lastitem</em> pointer follow the real arguments.</p><p>The pointers <em>firstitem</em> and <em>lastitem</em> should both be pointing to NULL in the first call to this function. All list-data will be allocated by the function itself. You must call <a href="../man3/curl_formfree.3.html"><strong>curl_formfree</strong>(3)</a></em> on the <em>firstitem</em> after the form post has been done to free the resources.</p><p>Using POST with HTTP 1.1 implies the use of a "Expect: 100-continue" header. You can disable this header with <a href="../man3/CURLOPT_HTTPHEADER.3.html"><strong>CURLOPT_HTTPHEADER</strong>(3)</a></em> as usual.</p><p>First, there are some basics you need to understand about multipart/formdata posts. Each part consists of at least a NAME and a CONTENTS part. If the part is made for file upload, there are also a stored CONTENT-TYPE and a FILENAME. Below, we'll discuss what options you use to set these properties in the parts you want to add to your post.</p><p>The options listed first are for making normal parts. The options from <em>CURLFORM_FILE</em> through <em>CURLFORM_BUFFERLENGTH</em> are for file upload parts.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    CURLFORM_COPYNAME
  </dt>
  <dd>
    <p>followed by a string which provides the <em>name</em> of this part. libcurl copies the string so your application doesn't need to keep it around after this function call. If the name isn't NUL-terminated, or if you'd like it to contain zero bytes, you must set its length with <strong>CURLFORM_NAMELENGTH</strong>. The copied data will be freed by <a href="../man3/curl_formfree.3.html"><strong>curl_formfree</strong>(3)</a></em>.</p>
  </dd>
  <dt>
    CURLFORM_PTRNAME
  </dt>
  <dd>
    <p>followed by a string which provides the <em>name</em> of this part. libcurl will use the pointer and refer to the data in your application, so you must make sure it remains until curl no longer needs it. If the name isn't NUL-terminated, or if you'd like it to contain zero bytes, you must set its length with <strong>CURLFORM_NAMELENGTH</strong>.</p>
  </dd>
  <dt>
    CURLFORM_COPYCONTENTS
  </dt>
  <dd>
    <p>followed by a pointer to the contents of this part, the actual data to send away. libcurl copies the provided data, so your application doesn't need to keep it around after this function call. If the data isn't null terminated, or if you'd like it to contain zero bytes, you must set the length of the name with <strong>CURLFORM_CONTENTSLENGTH</strong>. The copied data will be freed by <a href="../man3/curl_formfree.3.html"><strong>curl_formfree</strong>(3)</a></em>.</p>
  </dd>
  <dt>
    CURLFORM_PTRCONTENTS
  </dt>
  <dd>
    <p>followed by a pointer to the contents of this part, the actual data to send away. libcurl will use the pointer and refer to the data in your application, so you must make sure it remains until curl no longer needs it. If the data isn't NUL-terminated, or if you'd like it to contain zero bytes, you must set its length  with <strong>CURLFORM_CONTENTSLENGTH</strong>.</p>
  </dd>
  <dt>
    CURLFORM_CONTENTSLENGTH
  </dt>
  <dd>
    <p>followed by a long giving the length of the contents. Note that for <em>CURLFORM_STREAM</em> contents, this option is mandatory.</p><p>If you pass a 0 (zero) for this option, libcurl will instead do a strlen() on the contents to figure out the size. If you really want to send a zero byte content then you must make sure strlen() on the data pointer returns zero.</p>
  </dd>
  <dt>
    CURLFORM_FILECONTENT
  </dt>
  <dd>
    <p>followed by a filename, causes that file to be read and its contents used as data in this part. This part does <em>not</em> automatically become a file upload part simply because its data was read from a file.</p>
  </dd>
  <dt>
    CURLFORM_FILE
  </dt>
  <dd>
    <p>followed by a filename, makes this part a file upload part. It sets the <em>filename</em> field to the basename of the provided filename, it reads the contents of the file and passes them as data and sets the content-type if the given file match one of the internally known file extensions.  For <strong>CURLFORM_FILE</strong> the user may send one or more files in one part by providing multiple <strong>CURLFORM_FILE</strong> arguments each followed by the filename (and each <em>CURLFORM_FILE</em> is allowed to have a <em>CURLFORM_CONTENTTYPE</em>).</p>
  </dd>
  <dt>
    CURLFORM_CONTENTTYPE
  </dt>
  <dd>
    <p>is used in combination with <em>CURLFORM_FILE</em>. Followed by a pointer to a string which provides the content-type for this part, possibly instead of an internally chosen one.</p>
  </dd>
  <dt>
    CURLFORM_FILENAME
  </dt>
  <dd>
    <p>is used in combination with <em>CURLFORM_FILE</em>. Followed by a pointer to a string, it tells libcurl to use the given string as the <em>filename</em> in the file upload part instead of the actual file name.</p>
  </dd>
  <dt>
    CURLFORM_BUFFER
  </dt>
  <dd>
    <p>is used for custom file upload parts without use of <em>CURLFORM_FILE</em>.  It tells libcurl that the file contents are already present in a buffer.  The parameter is a string which provides the <em>filename</em> field in the content header.</p>
  </dd>
  <dt>
    CURLFORM_BUFFERPTR
  </dt>
  <dd>
    <p>is used in combination with <em>CURLFORM_BUFFER</em>. The parameter is a pointer to the buffer to be uploaded. This buffer must not be freed until after <a href="../man3/curl_easy_cleanup.3.html"><strong>curl_easy_cleanup</strong>(3)</a></em> is called. You must also use <em>CURLFORM_BUFFERLENGTH</em> to set the number of bytes in the buffer.</p>
  </dd>
  <dt>
    CURLFORM_BUFFERLENGTH
  </dt>
  <dd>
    <p>is used in combination with <em>CURLFORM_BUFFER</em>. The parameter is a long which gives the length of the buffer.</p>
  </dd>
  <dt>
    CURLFORM_STREAM
  </dt>
  <dd>
    <p>Tells libcurl to use the <a href="../man3/CURLOPT_READFUNCTION.3.html"><strong>CURLOPT_READFUNCTION</strong>(3)</a></em> callback to get data. The parameter you pass to <em>CURLFORM_STREAM</em> is the pointer passed on to the read callback's fourth argument. If you want the part to look like a file upload one, set the <em>CURLFORM_FILENAME</em> parameter as well. Note that when using <em>CURLFORM_STREAM</em>, <em>CURLFORM_CONTENTSLENGTH</em> must also be set with the total expected length of the part. (Option added in libcurl 7.18.2)</p>
  </dd>
  <dt>
    CURLFORM_ARRAY
  </dt>
  <dd>
    <p>Another possibility to send options to curl_formadd() is the <strong>CURLFORM_ARRAY</strong> option, that passes a struct curl_forms array pointer as its value. Each curl_forms structure element has a CURLformoption and a char pointer. The final element in the array must be a CURLFORM_END. All available options can be used in an array, except the CURLFORM_ARRAY option itself!  The last argument in such an array must always be <strong>CURLFORM_END</strong>.</p>
  </dd>
  <dt>
    CURLFORM_CONTENTHEADER
  </dt>
  <dd>
    <p>specifies extra headers for the form POST section.  This takes a curl_slist prepared in the usual way using <strong>curl_slist_append</strong> and appends the list of headers to those libcurl automatically generates. The list must exist while the POST occurs, if you free it before the post completes you may experience problems.</p><p>When you've passed the HttpPost pointer to <a href="../man3/curl_easy_setopt.3.html"><strong>curl_easy_setopt</strong>(3)</a></em> (using the <a href="../man3/CURLOPT_HTTPPOST.3.html"><strong>CURLOPT_HTTPPOST</strong>(3)</a></em> option), you must not free the list until after you've called <a href="../man3/curl_easy_cleanup.3.html"><strong>curl_easy_cleanup</strong>(3)</a></em> for the curl handle.</p><p>See example below.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>0 means everything was ok, non-zero means an error occurred corresponding to a CURL_FORMADD_* constant defined in <em>&lt;curl/curl.h&gt;</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
 struct curl_httppost* post = NULL;
 struct curl_httppost* last = NULL;
 char namebuffer[] = "name buffer";
 long namelength = strlen(namebuffer);
 char buffer[] = "test buffer";
 char htmlbuffer[] = "&lt;HTML&gt;test buffer&lt;/HTML&gt;";
 long htmlbufferlength = strlen(htmlbuffer);
 struct curl_forms forms[3];
 char file1[] = "my-face.jpg";
 char file2[] = "your-face.jpg";
 /* add null character into htmlbuffer, to demonstrate that
    transfers of buffers containing null characters actually work
 */
 htmlbuffer[8] = '&#92;0';

 /* Add simple name/content section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "name",
              CURLFORM_COPYCONTENTS, "content", CURLFORM_END);

 /* Add simple name/content/contenttype section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "htmlcode",
              CURLFORM_COPYCONTENTS, "&lt;HTML&gt;&lt;/HTML&gt;",
              CURLFORM_CONTENTTYPE, "text/html", CURLFORM_END);

 /* Add name/ptrcontent section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "name_for_ptrcontent",
              CURLFORM_PTRCONTENTS, buffer, CURLFORM_END);

 /* Add ptrname/ptrcontent section */
 curl_formadd(&post, &last, CURLFORM_PTRNAME, namebuffer,
              CURLFORM_PTRCONTENTS, buffer, CURLFORM_NAMELENGTH,
              namelength, CURLFORM_END);

 /* Add name/ptrcontent/contenttype section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "html_code_with_hole",
              CURLFORM_PTRCONTENTS, htmlbuffer,
              CURLFORM_CONTENTSLENGTH, htmlbufferlength,
              CURLFORM_CONTENTTYPE, "text/html", CURLFORM_END);

 /* Add simple file section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "picture",
              CURLFORM_FILE, "my-face.jpg", CURLFORM_END);

 /* Add file/contenttype section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "picture",
              CURLFORM_FILE, "my-face.jpg",
              CURLFORM_CONTENTTYPE, "image/jpeg", CURLFORM_END);

 /* Add two file section */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "pictures",
              CURLFORM_FILE, "my-face.jpg",
              CURLFORM_FILE, "your-face.jpg", CURLFORM_END);

 /* Add two file section using CURLFORM_ARRAY */
 forms[0].option = CURLFORM_FILE;
 forms[0].value  = file1;
 forms[1].option = CURLFORM_FILE;
 forms[1].value  = file2;
 forms[2].option  = CURLFORM_END;

 /* Add a buffer to upload */
 curl_formadd(&post, &last,
              CURLFORM_COPYNAME, "name",
              CURLFORM_BUFFER, "data",
              CURLFORM_BUFFERPTR, record,
              CURLFORM_BUFFERLENGTH, record_length,
              CURLFORM_END);

 /* no option needed for the end marker */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "pictures",
              CURLFORM_ARRAY, forms, CURLFORM_END);
 /* Add the content of a file as a normal post text value */
 curl_formadd(&post, &last, CURLFORM_COPYNAME, "filecontent",
              CURLFORM_FILECONTENT, ".bashrc", CURLFORM_END);
 /* Set the form info */
 curl_easy_setopt(curl, CURLOPT_HTTPPOST, post);

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO curl_formadd&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/curl_easy_setopt.3.html"><strong>curl_easy_setopt</strong>(3)</a>,  <a href="../man3/curl_formfree.3.html"><strong>curl_formfree</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="curl_escape.3.html"><span aria-hidden="true">&larr;</span> curl_escape.3: Url encodes the given string</a></li>
   <li class="next"><a href="curl_formfree.3.html">curl_formfree.3: Free a previously build multipart/formdata http post chain <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
