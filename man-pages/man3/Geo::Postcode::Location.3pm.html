<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geo::Postcode::Location: Helper class for geo::postcode that handles grid reference lookups</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Helper class for geo::postcode that handles grid reference lookups">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Geo::Postcode::Location (3pm) manual">
  <meta name="twitter:description" content="Helper class for geo::postcode that handles grid reference lookups">
  <meta name="twitter:image" content="https://www.carta.tech/images/libgeo-postcode-perl-Geo::Postcode::Location-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Geo::Postcode::Location.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Geo::Postcode::Location (3pm) manual" />
  <meta property="og:description" content="Helper class for geo::postcode that handles grid reference lookups" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libgeo-postcode-perl-Geo::Postcode::Location-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Geo::Postcode::Location<small> (3pm)</small></h1>
        <p class="lead">Helper class for geo::postcode that handles grid reference lookups</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Geo::Postcode::Location.3pm.html">
      <span itemprop="name">Geo::Postcode::Location: Helper class for geo::postcode that handles grid reference lookups</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libgeo-postcode-perl/">
      <span itemprop="name">libgeo-postcode-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Geo::Postcode::Location.3pm.html">
      <span itemprop="name">Geo::Postcode::Location: Helper class for geo::postcode that handles grid reference lookups</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  $Geo::Postcode::Location::datafile = &apos;/usr/local/lib/postcodes.db&apos;;
  my ($x, $y) = Geo::Postcode-&gt;coordinates(&apos;EC1R 8BB&apos;);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Geo::Postcode::Location holds the gridref-lookup functions of Geo::Postcode. It is separated here to minimise the footprint of the main module and to facilitate subclassing.</p><p>It doesn't really have a useful direct interface, since it requires an object of Geo::Postcode (or a subclass) and is most easily reached through that object, but it does have a couple of configuration variables and there is method documentation here for anyone interested in subclassing it or changing the data source.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GRIDREF DATA</h2>
        <div class="sectioncontent">
<p>There are at least three ways to supply your own gridref data.</p><ul>
<li><p>replace the data file If you can get your data into a SQLite file, all you have to do is set the either \*(C`Geo::Postcode::Location::datafile\*(C' or $ENV{\s-1POSTCODE_DATA\s0} to the full path to your data file:   $Geo::Postcode::Location::datafile = &apos;/home/site/data/postcodes.db&apos;;   # or   PerlSetEnv POSTCODE_DATA /home/site/data/postcodes.db I've included (in ./useful) an idiot script that I use to turn .csv data into a SQLite file suitable for use with this module.</p></li><li><p>replace the database handle The query that we use to retrieve location information is very simple, and should work with any \s-1DBI\s0 database handle. If your application already makes available a suitable database handle, or you would like to create one externally and make sure it is reused, it should just work:   $Geo::Postcode::Location::dbh = $my_dbh;   $Geo::Postcode::Location::tablename = &apos;postcodedata&apos;;   my ($x, $y) = Geo::Postcode-&gt;coordinates(&apos;EC1Y 8PQ&apos;); If running under mod_perl, you probably don't want to share the handle like that. You can achieve the same thing with instance methods and avoid side-effects, but you have to make the calls at the right time:   my $postcode = Geo::Postcode-&gt;new(&apos;EC1Y 8PQ&apos;);   $postcode-&gt;location-&gt;dbh( $my_dbh );   $postcode-&gt;location-&gt;tablename( &apos;postcodedata&apos; );   my ($x, $y) = $postcode-&gt;coordinates;</p></li><li><p>override the lookup mechanism in subclass The data-retrieval process is divided up to make this as simple as possible: see the method descriptions below for details. You should be able to replace the data source by overriding \*(C`dbh\*(C' or redo the whole lookup by replacing \*(C`retrieve\*(C'.   $Geo::Postcode-&gt;location_class(&apos;My::Location&apos;);</p><p>  package My::Location;   use base qw(Geo::Postcode::Location);   sub dbh { ... }</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>new ()</h3>
<p>Constructs and returns a location object. Must be supplied with a postcode object of the class dictated by \*(C`postcode_class\*(C'.</p>
<h3>postcode_class ()</h3>
<p>Returns the full name of the postcode class we should be expecting.</p>
<h3>postcode ()</h3>
<p>Returns the postcode object used to construct this object.</p>
<h3>retrieve ()</h3>
<p>Retrieves location information for this postcode. This method is called during construction, retrieves all the necessary information in one go, so all the rest have to do is look up internal values.</p>
<h3>disconnect_after_use ()</h3>
<p>If this returns a true value, then dbh-&gt;disconnect will be called after location information is retrieved.</p>
<h3>dbh ()</h3>
<p>Accepts, returns - and creates, if necessary - the \s-1DBI\s0 handle that will be used to retrieve location information.</p><p>This is only separate to make it easy to override.</p>
<h3>datafile ( path_to_file )</h3>
<p>Accepts and returns the location of the SQLite file we expect to provide location data.</p><p>If no file path is supplied, or found by checking $Geo::Postcode::Location::datafile and $ENV{POSTCODE_DATA}, then we will scan the path to locate the default data file that is installed with this module.</p>
<h3>tablename ()</h3>
<p>Sets and gets the name of the database table that should be expected to hold postcode data.</p>
<h3>cols ()</h3>
<p>Returns a list of the columns we should pull from the database row into the location object's internal hash (and also provide as instance methods). This isn't used in the \s-1SQL\s0 query (which just SELECTs *), so we don't mind if columns are missing.</p>
<h3>\s-1AUTOLOAD\s0 ()</h3>
<p>Turns the columns defined by \*(C`cols\*(C' into lookup methods. You can't set values this way: the whole module is strictly read-only.</p>
<h3>gridref ()</h3>
<p>Returns a proper concatenated grid reference for this postcode, in classic Ordnance Survey \s-1AA123456\s0 form rather than the all-digits version we use internally.</p><p>See http://www.ordnancesurvey.co.uk/oswebsite/freefun/nationalgrid/nghelp2.html or the more sober http://vancouver-webpages.com/peter/osgbfaq.txt</p><p>for more about grid references.</p><p>Unlike other grid methods here, this one will also strip redundant trailing zeros from the eastings and northings for the sake of readability.</p>
<h3>distance_from ()</h3>
<p>We prefer to use grid references to calculate distances, since they're laid out nicely on a flat plane and don't require us to remember our A-levels. This method just returns a single distance value.</p><p>You can specify the units of distance by setting $Geo::Postcode::Location::units or passing in a second parameter. Either way it must be one of 'miles', 'km' or 'm'. The default is 'km'.</p>
<h3>bearing_to ()</h3>
<p>Returns the angle from grid north, in degrees clockwise, of the line from this postcode to the postcode object supplied.</p>
<h3>friendly_bearing_to ()</h3>
<p>Returns a readable approximation of the bearing from here to there, in a form like '\s-1NW\s0' or '\s-1SSE\s0'.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>William Ross, wross@cpan.org</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2004 William Ross, spanner ltd.</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Geo::Postcode.3pm.html"><span aria-hidden="true">&larr;</span> Geo::Postcode.3pm: Uk postcode validation and location</a></li>
   <li class="next"><a href="Geography::Countries.3pm.html">Geography::Countries.3pm: 2-letter, 3-letter, and numerical codes for countries. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
