<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>asview: Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="asview (3x) manual">
  <meta name="twitter:description" content="Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview">
  <meta name="twitter:image" content="https://www.carta.tech/images/libafterimage-dev-asview-3x.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3x/asview.3x.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="asview (3x) manual" />
  <meta property="og:description" content="Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libafterimage-dev-asview-3x.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">asview<small> (3x)</small></h1>
        <p class="lead">Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/asview.3x.html">
      <span itemprop="name">asview: Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libafterimage-dev/">
      <span itemprop="name">libafterimage-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3x/asview.3x.html">
      <span itemprop="name">asview: Asview- demonstrates loading and displaying of images libafterimage/tutorials/asview</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">NAMEASView</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Simple image viewer based on libAfterImage.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>All we want to do here is to get image filename from the command line, then load this image, and display it in simple window. After that we would want to wait, until user closes our window.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOURCE</h2>
        <div class="sectioncontent">
<p>#define DO_CLOCKING</p><p>#include "../afterbase.h" #include "../afterimage.h" #include "common.h"</p><p>#ifdef DO_CLOCKING #if TIME_WITH_SYS_TIME # include &lt;sys/time.h&gt; # include &lt;time.h&gt; #else # if HAVE_SYS_TIME_H #  include &lt;sys/time.h&gt; # else #  include &lt;time.h&gt; # endif #endif #endif</p><p>void usage() {</p>
<pre>
    printf( "Usage: asview [-h]|[image]&#92;n");
    printf( "Where: image - filename of the image to display.&#92;n");
</pre>
<p>}</p><p>int main(int argc, char* argv[]) {</p>
<pre>
    char *image_file = "rose512.jpg" ;
    ASImage *im ;
    ASVisual *asv ;
    int screen = 0, depth = 24;
    Display *dpy = NULL;
</pre>

<pre>
    /* see ASView.1 : */
    set_application_name( argv[0] );
</pre>
<p>#if (HAVE_AFTERBASE_FLAG==1)</p>
<pre>
    set_output_threshold(OUTPUT_LEVEL_DEBUG);
</pre>
<p>#ifdef DEBUG_ALLOCS</p>
<pre>
    fprintf( stderr, "have DEBUG_ALLOCS&#92;n");
</pre>
<p>#endif #ifdef AFTERBASE_DEBUG_ALLOCS</p>
<pre>
    fprintf( stderr, "have AFTERBASE_DEBUG_ALLOCS&#92;n");
</pre>
<p>#endif #endif</p>
<pre>
    if( argc &gt; 1 )
    {
        if( strcmp( argv[1], "-h" ) == 0 )
        {
            usage();
            return 0;
        }
        image_file = argv[1] ;
    }else
    {
        show_warning(   "Image filename was not specified. "
                        "Using default:          usage();
    }
</pre>
<p>#ifndef X_DISPLAY_MISSING</p>
<pre>
    dpy = XOpenDisplay(NULL);
    XSynchronize (dpy, True);
    _XA_WM_DELETE_WINDOW = XInternAtom( dpy, "WM_DELETE_WINDOW",
                                        False);
    screen = DefaultScreen(dpy);
    depth = DefaultDepth( dpy, screen );
</pre>
<p>#endif</p>
<pre>
    /* see ASView.3 : */
    asv = create_asvisual( dpy, screen, depth, NULL );
    /* asv = create_asvisual_for_id( dpy, screen, depth, 0x28, None, NULL ); */
</pre>

<pre>
    /* see ASView.2 : */
    im = file2ASImage( image_file, 0xFFFFFFFF, SCREEN_GAMMA, 0, getenv("IMAGE_PATH"), NULL );
</pre>

<pre>
    /* The following could be used to dump JPEG version of the image into
     * stdout : */
    /*  ASImage2file( im, NULL, NULL, ASIT_Jpeg, NULL );
        ASImage2file( im, NULL, "asview.png", ASIT_Png, NULL );
        ASImage2file( im, NULL, "asview.gif", ASIT_Gif, NULL );
    */
</pre>

<pre>
    if( im != NULL )
    {
</pre>
<p>#ifndef X_DISPLAY_MISSING</p>
<pre>
        Window w ;
</pre>
<p>#if 0</p>
<pre>
        /* test example for get_asimage_channel_rects() : */
        XRectangle *rects ; unsigned int rects_count =0; int i ;
        rects = get_asimage_channel_rects( im, IC_ALPHA, 10,
                                            &rects_count );
        fprintf( stderr, " %d rectangles generated : &#92;n", rects_count );
        for( i = 0 ; i &lt; rects_count ; ++i )
            fprintf( stderr, "&#92;trect[%d]=%dx%d%+d%+d;&#92;n",
                     i, rects[i].width, rects[i].height,
                     rects[i].x, rects[i].y );
</pre>
<p>#endif</p><p>#if 0</p>
<pre>
        /* test example for fill_asimage : */
        fill_asimage(asv, im, 0, 0, 50, 50, 0xFFFF0000);
        fill_asimage(asv, im, 50, 50, 100, 50, 0xFFFF0000);
        fill_asimage(asv, im, 0, 100, 200, 50, 0xFFFF0000);
        fill_asimage(asv, im, 150, 0, 50, 50, 0xFFFF0000);
</pre>
<p>#endif #if 0</p>
<pre>
        /* test example for conversion to argb32 :*/
        {
            ASImage *tmp = tile_asimage( asv, im, 0, 0, im-&gt;width, im-&gt;height, TINT_NONE, ASA_ARGB32,
                                          0, ASIMAGE_QUALITY_DEFAULT );
            destroy_asimage( &im );
            set_flags( tmp-&gt;flags, ASIM_DATA_NOT_USEFUL|ASIM_XIMAGE_NOT_USEFUL );
            im = tmp ;
        }
</pre>
<p>#endif</p>
<pre>
        /* see ASView.4 : */
        w = create_top_level_window( asv, DefaultRootWindow(dpy), 32, 32,
                                     im-&gt;width, im-&gt;height, 1, 0, NULL,
                                     "ASView", image_file );
        if( w != None )
        {
            Pixmap p ;
</pre>

<pre>
            XMapRaised   (dpy, w);
            XSync(dpy,False);
            /* see ASView.5 : */
            p = create_visual_pixmap( asv, DefaultRootWindow(dpy), im-&gt;width, im-&gt;height, 0 );
</pre>

<pre>
            {
                START_TIME(started);
                /* for( int i = 0 ; i &lt; 100 ; ++i )  To test performance! */
                asimage2drawable( asv, p, im, NULL, 0, 0, 0, 0, im-&gt;width, im-&gt;height, False);
                SHOW_TIME("", started);
            }
            /* print_storage(NULL); */
            destroy_asimage( &im );
            /* see common.c:set_window_background_and_free(): */
            p = set_window_background_and_free( w, p );
        }
        /* see common.c: wait_closedown() : */
        wait_closedown(w);
        dpy = NULL;
</pre>

<pre>
        /* no longer need this - lets clean it up :*/
        destroy_asvisual( asv, False );
        asv = NULL ;
</pre>
<p>#else</p>
<pre>
        /* writing result into the file */
        ASImage2file( im, NULL, "asview.png", ASIT_Png, NULL );
</pre>
<p>#endif</p>
<pre>
    }
</pre>
<p>#ifdef DEBUG_ALLOCS</p>
<pre>
    /* different cleanups of static memory pools : */
    flush_ashash_memory_pool();
    asxml_var_cleanup();
    custom_color_cleanup();
    build_xpm_colormap( NULL );
    flush_default_asstorage();
    /* requires libAfterBase */
    print_unfreed_mem();
</pre>
<p>#endif</p>
<pre>
    return 0 ;
</pre>
<p>}</p><p>libAfterImage/tutorials/ASView.1 [1.1]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 1. Initialization.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>libAfterImage requires only 2 global things to be setup, and both of those are inherited from libAfterBase: dpy - pointer to open X display- naturally that is something we cannot live without; application name - used in all the text output, such as error and warning messages and also debugging messages if such are enabled. The following two line are about all that is required to setup both of this global variables :</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    set_application_name( argv[0] );
    dpy = XOpenDisplay(NULL);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>First line is setting up application name from command line's program name. Second opens up X display specified in DISPLAY env. variable. Naturally based on application purpose different parameters can be passed to these functions, such as some custom display string.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asview&hellip;</h2>
        <div class="sectioncontent">
<p>libAfterBase, set_application_name(), XOpenDisplay(), Display, libAfterImage/tutorials/ASView.2 [1.2]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 2. Loading image file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>At this point we are ready to load image from file into memory. Since libAfterImage does not use any X facilities to store image - we don't have to create any window or anything else yet. Even dpy is optional here - it will only be used to try and parse names of colors from .XPM images.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    im = file2ASImage( image_file, 0xFFFFFFFF, SCREEN_GAMMA, 0, NULL);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>We used compression set to 0, as we do not intend to store image in memory for any considerable amount of time, and we want to avoid additional processing overhead related to image compression. If image was loaded successfully, which is indicated by returned pointer being not NULL, we can proceed to creation of the window and displaying of the image.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asview&hellip;</h2>
        <div class="sectioncontent">
<p>file2ASImage() libAfterImage/tutorials/ASView.3 [1.3]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 3. Preparation of the visual.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>At this point we have to obtain Visual information, as window creation is highly dependent on Visual being used. In fact when X creates a window it ties it to a particular Visual, and all its attributes, such as colormap, pixel values, pixmaps, etc. must be associated with the same Visual. Accordingly we need to acquire ASVisual structure, which is our abstraction layer from them naughty X Visuals. :</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    asv = create_asvisual( dpy, screen, depth, NULL );
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>If any Window or Pixmap is created based on particular ASVisual, then this ASVisual structure must not be destroyed untill all such Windows and Pixmaps are destroyed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asview&hellip;</h2>
        <div class="sectioncontent">
<p>See create_asvisual() for details. libAfterImage/tutorials/ASView.4 [1.4]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 4. Preparation of the window.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Creation of top level window consists of several steps of its own: a) create the window of desired size and placement b) set ICCCM hints on the window c) select appropriate events on the window c) map the window. First two steps has been moved out into create_top_level_window() function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
    w = create_top_level_window( asv, DefaultRootWindow(dpy), 32, 32,
                                 im-&gt;width, im-&gt;height, 1, 0, NULL,
                                 "ASView" );
    if( w != None )
    {
        XSelectInput (dpy, w, (StructureNotifyMask | ButtonPress));
        XMapRaised   (dpy, w);
    }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Map request should be made only for window that has all its hints set up already, so that Window Manager can read them right away. We want to map window as soon as possible so that User could see that something really is going on, even before image is displayed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asview&hellip;</h2>
        <div class="sectioncontent">
<p>ASImage, create_top_level_window() libAfterImage/tutorials/ASView.5 [1.5]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Step 5. Displaying the image.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The simplest way to display image in the window is to convert it into Pixmap, then set Window's background to this Pixmap, and, at last, clear the window, so that background shows up.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p> p = asimage2pixmap( asv, DefaultRootWindow(dpy), im, NULL, False );  destroy_asimage( &im );</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>We no longer need ASImage after we transferred it onto the Pixmap, so we better destroy it to conserve resources.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO asview&hellip;</h2>
        <div class="sectioncontent">
<p>asimage2pixmap(), destroy_asimage(), set_window_background_and_free()</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="astile.3x.html"><span aria-hidden="true">&larr;</span> astile.3x: Astile- demonstrates image tiling/cropping and tinting libafterimage/tutorials/astile</a></li>
   <li class="next"><a href="asvisual.3x.html">asvisual.3x: Asvisual- abstraction layer on top of x visuals, focusing on color handling libafterimage/asvisual.h <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
