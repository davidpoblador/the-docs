<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shadow: Specify shading lookup tables for rendering shadows</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Specify shading lookup tables for rendering shadows">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Shadow (3) manual">
  <meta name="twitter:description" content="Specify shading lookup tables for rendering shadows">
  <meta name="twitter:image" content="https://www.carta.tech/images/libvolpack1-dev-Shadow-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/Shadow.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Shadow (3) manual" />
  <meta property="og:description" content="Specify shading lookup tables for rendering shadows" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libvolpack1-dev-Shadow-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Shadow<small> (3)</small></h1>
        <p class="lead">Specify shading lookup tables for rendering shadows</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Shadow.3.html">
      <span itemprop="name">Shadow: Specify shading lookup tables for rendering shadows</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libvolpack1-dev/">
      <span itemprop="name">libvolpack1-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Shadow.3.html">
      <span itemprop="name">Shadow: Specify shading lookup tables for rendering shadows</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;volpack.h&gt;</p><p>&#92;$1 <strong>vpSetShadowLookupShader(</strong><em>vpc, color_channels, num_materials,</em> color_field, color_table, color_table_size, weight_field, weight_table, weight_table_size, shadow_table, shadow_table_size<strong>)</strong></p><ul>
<li><p>vpContext *<em>vpc;</em> int <em>color_channels, num_materials;</em> int <em>color_field;</em> float *<em>color_table;</em> int <em>color_table_size;</em> int <em>weight_field;</em> float *<em>weight_table;</em> int <em>weight_table_size;</em> float *<em>shadow_table;</em> int <em>shadow_table_size;</em></p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ARGUMENTS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <em>vpc</em>
  </dt>
  <dd>
    <p>VolPack context from <strong>vpCreateContext.</strong></p>
  </dd>
  <dt>
    <em>color_channels</em>
  </dt>
  <dd>
    <p>The number of color channels per pixel (1 or 3).</p>
  </dd>
  <dt>
    <em>num_materials</em>
  </dt>
  <dd>
    <p>The number of material types.</p>
  </dd>
  <dt>
    <em>color_field</em>
  </dt>
  <dd>
    <p>Field number for voxel field containing color lookup table index.</p>
  </dd>
  <dt>
    <em>color_table</em>
  </dt>
  <dd>
    <p>Color lookup table.</p>
  </dd>
  <dt>
    <em>color_table_size</em>
  </dt>
  <dd>
    <p>Size of color lookup table in bytes.</p>
  </dd>
  <dt>
    <em>weight_field</em>
  </dt>
  <dd>
    <p>Field number for voxel field containing material weight lookup table index.</p>
  </dd>
  <dt>
    <em>weight_table</em>
  </dt>
  <dd>
    <p>Material weight lookup table.</p>
  </dd>
  <dt>
    <em>weight_table_size</em>
  </dt>
  <dd>
    <p>Size of material weight lookup table in bytes.</p>
  </dd>
  <dt>
    <em>shadow_table</em>
  </dt>
  <dd>
    <p>Shadow color lookup table.</p>
  </dd>
  <dt>
    <em>shadow_table_size</em>
  </dt>
  <dd>
    <p>Size of shadow color lookup table in bytes.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>vpSetShadowLookupShader</strong> is used to specify lookup tables that define a shading function for rendering a volume with shadows.  It should be used instead of <strong>vpSetLookupShader</strong> when shadows are enabled.</p><p>VolPack supports a fast, one-pass shadow algorithm.  The algorithm computes the fraction of light from a given light source that reaches each voxel.  The fraction is then used to attenuate the diffuse and specular shading terms associated with that light source, producing a dark shadow in areas that are hidden from the light source.  The implementation uses lookup tables so that most of the shading calculation can be precomputed.</p><p>In order to compute the shadows in a single pass the algorithm places a restriction on the direction of the light source: the light casting the shadows must not be more than 45 degrees from the viewing direction.  The quality of the shadows may degrade if the angle approaches 45 degrees.  The current implementation allows shadows to be cast only from one light source.  Additional lights may be enabled, but they will not cast shadows.</p><p>To make a rendering with shadows, the following steps must be performed:</p><ul>
<li><p>Call <strong>vpSetShadowLookupShader</strong> to define the lookup tables (see discussion below).</p></li><li><p>Call <strong>vpSeti</strong> with the VP_SHADOW_LIGHT option to specify which light will cast shadows.  The current implementation only allows one light to be specified.</p></li><li><p>Call <strong>vpSeti</strong> with the VP_SHADOW_BIAS option to set the shadow bias value (see discussion below).</p></li><li><p>Call <strong>vpEnable</strong> with the VP_SHADOW option to enable shadows.</p></li><li><p>Call <strong>vpShadeTable</strong> as usual to initialize the lookup tables.</p></li><li><p>Call one of the rendering routines.</p></li>
</ul><p><strong>vpSetShadowLookupShader</strong> defines the lookup tables required for the shading and shadowing algorithm.  The first nine arguments are identical to the arguments for <strong>vpSetLookupShader</strong> (see the corresponding man page).  The remaining two arguments specify an additional color lookup table, <em>shadow_table,</em> with the same dimensions as <em>color_table</em>.  The contents of the table will be initialized by <strong>vpShadeTable</strong>.</p><p>The call to <strong>vpSeti</strong> with the VP_SHADOW_BIAS option specifies an offset to eliminate self-shadowing.  Self-shadowing is an intrinsic problem when implementing shadow algorithms for volume rendering. Consider a single voxelized object consisting of an opaque core surrounded by a "halo" of lower-opacity voxels (necessary for the scene to be band-limited).  As a light ray pierces the halo its strength is attenuated.  By the time the light reaches the high-opacity region a significant fraction of the light may be obscured, resulting in a general darkening of the image even if no shadows should be present.  The problem can be corrected by moving the shadow a small distance along the direction of the light rays.  VP_SHADOW_BIAS specifies the distance of the bias in units of voxels.  The optimal value depends on the data set.  Increase the bias until it has no more effect on overall image brightness, but do not increase it too far or small features in the data will no longer produce correct shadows.</p><p><strong>vpShadeTable</strong> initializes the shading lookup tables.  It operates differently when shadows are enabled.  Instead of computing one color for each surface normal vector and storing the results in <em>color_table,</em> the routine computes two colors terms.  The first term is the portion of the voxel color due to the diffuse and specular components of the shadow light.  This value is stored in <em>shadow_table</em>.  The second term contains the contribution of all other light source and the ambient light term, and is stored in <em>color_table.</em>  During rendering the color of a voxel is computed by extracting a surface normal from the voxel, using the surface normal to index both <em>color_table</em> and <em>shadow_table,</em> attenuating the value from <em>shadow_table</em> by the local strength of the shadow light, and then adding the two terms together.  The local strength of the shadow light is found by extracting a value from the shadow buffer, an internal data structure that is updated during rendering.</p><p>The values in the shading lookup tables may be initialized before or after calling <strong>vpSetShadowLookupShader.</strong>  Typically <strong>vpSetShadowLookupShader</strong> is called once at the beginning of a rendering session, and then <strong>vpShadeTable</strong> is called whenever the user changes the lighting and shading parameters or the viewing direction.</p><p>The shadow buffer is an internal 2D array used to maintain state during rendering.  There are several state variables that can be used to query its current size in pixels (VP_SHADOW_WIDTH and VP_SHADOW_HEIGHT) and to suggest a size (VP_SHADOW_WIDTH_HINT and VP_SHADOW_HEIGHT_HINT).  The required size depends on the volume size and the shadow light's direction.  Normally the buffer is automatically resized when necessary.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STATE VARIABLES</h2>
        <div class="sectioncontent">
<p>Information about the current shading table parameters can be retrieved with the following state variable codes (see <strong>vpGeti</strong>(3)): VP_COLOR_CHANNELS, VP_SHADE_COLOR_TABLE, VP_SHADE_COLOR_SIZE, VP_SHADE_WEIGHT_TABLE, VP_SHADE_WEIGHT_SIZE, VP_SHADE_COLOR_FIELD, VP_SHADE_WEIGHT_FIELD, VP_MATERIAL_COUNT, VP_SHADOW, VP_SHADOW_LIGHT, VP_SHADOW_WIDTH_HINT, VP_SHADOW_HEIGHT_HINT, VP_SHADOW_WIDTH, VP_SHADOW_HEIGHT, VP_SHADOW_COLOR_TABLE, VP_SHADOW_COLOR_SIZE, VP_SHADOW_BIAS</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">
<p>The normal return value is VP_OK.  The following error return values are possible:</p>
<dl class='dl-vertical'>
  <dt>
    VPERROR_BAD_VALUE
  </dt>
  <dd>
    <p>One or more of the arguments has an invalid value or is out of range.</p>
  </dd>
  <dt>
    VPERROR_LIMIT_EXCEEDED
  </dt>
  <dd>
    <p>The <em>num_materials</em> argument has exceeded an internal limit. Change the value of VP_MAX_MATERIAL in volpack.h and recompile the VolPack library.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Shadow&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/VolPack.3.html"><strong>VolPack</strong>(3)</a>, <strong>vpCreateContext</strong>(3), <strong>vpShadeTable</strong>(3), <strong>vpSetLookupShader</strong>(3)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ShadeTable.3.html"><span aria-hidden="true">&larr;</span> ShadeTable.3: Compute the contents of the shading lookup table</a></li>
   <li class="next"><a href="Shell.3.html">Shell.3: Shell  the shell widget class "shell" "widget class" "shell" <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
