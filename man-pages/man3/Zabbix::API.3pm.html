<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Zabbix::API: Access the json-rpc api of a zabbix server</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Access the json-rpc api of a zabbix server">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Zabbix::API (3pm) manual">
  <meta name="twitter:description" content="Access the json-rpc api of a zabbix server">
  <meta name="twitter:image" content="https://www.carta.tech/images/libzabbix-api-perl-Zabbix::API-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Zabbix::API.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Zabbix::API (3pm) manual" />
  <meta property="og:description" content="Access the json-rpc api of a zabbix server" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libzabbix-api-perl-Zabbix::API-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Zabbix::API<small> (3pm)</small></h1>
        <p class="lead">Access the json-rpc api of a zabbix server</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Zabbix::API.3pm.html">
      <span itemprop="name">Zabbix::API: Access the json-rpc api of a zabbix server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libzabbix-api-perl/">
      <span itemprop="name">libzabbix-api-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Zabbix::API.3pm.html">
      <span itemprop="name">Zabbix::API: Access the json-rpc api of a zabbix server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use Zabbix::API;

  my $zabbix = Zabbix::API-&gt;new(server =&gt; &apos;http://example.com/zabbix/api_jsonrpc.php&apos;,
                                verbosity =&gt; 0);

  eval { $zabbix-&gt;login(user =&gt; &apos;calvin&apos;,
                        password =&gt; &apos;hobbes&apos;) };

  if ($@) { die &apos;could not authenticate&apos; };

  my $items = $zabbix-&gt;fetch(&apos;Item&apos;, params =&gt; { search =&gt; { ... } });
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module manages authentication and querying to a Zabbix server via its JSON-RPC interface.  (Zabbix v1.8+ is required for \s-1API\s0 usage; prior versions have no JSON-RPC \s-1API\s0 at all.)</p><p>What you need to start out is probably the \*(C`fetch\*(C' method in \*(C`Zabbix::API\*(C'; be sure to check out also what the various \*(C`Zabbix::API::Foo\*(C' classes do, as this is how you'll be manipulating the objects you have just fetched.</p><p>Finally, there are examples in the \*(C`examples/\*(C' folder (well, at least one) and in the unit tests.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    new(server =&gt; \s-1URL\s0, [verbosity =&gt; \s-1INT\s0], [env_proxy =&gt; \s-1BOOL\s0])
  </dt>
  <dd>
    <p>This is the main constructor for the Zabbix::API class.  It creates a LWP::UserAgent instance but does <strong>not</strong> open any connections yet. \*(C`env_proxy\*(C' is passed to the LWP::UserAgent constructor, so if it is set to a true value then the \s-1UA\s0 should follow $http_proxy and others. \*(C`server\*(C' is misleading, as the \s-1URL\s0 expected is actually the whole path to the JSON-RPC page, which usually is \*(C`http://example.com/zabbix/api_jsonrpc.php\*(C'. Returns an instance of the \*(C`Zabbix::API\*(C' class.</p>
  </dd>
  <dt>
    login(user =&gt; \s-1STR\s0, password =&gt; \s-1STR\s0)
  </dt>
  <dd>
    <p>Send login information to the Zabbix server and set the auth cookie if the authentication was successful. Due to the current state of flux of the Zabbix \s-1API\s0, this may or may not work depending on your version of Zabbix.  \*(C`user.authenticate\*(C' is marked as having been introduced in version 1.8; so is \*(C`user.login\*(C', which deprecates \*(C`authenticate\*(C'.  Our method uses \*(C`login\*(C'.  Version 1.8.4 is confirmed as working with \*(C`login\*(C'.</p>
  </dd>
  <dt>
    <em>logout()</em>
  </dt>
  <dd>
    <p>Try to log out properly.  Unfortunately, the \*(C`user.logout\*(C' method is completely undocumented and does not appear to work at the moment (see the bug report here: https://support.zabbix.com/browse/ZBX-3907 &lt;https://support.zabbix.com/browse/ZBX-3907&gt;).  Users of this distribution are advised not to log out at all.  They will <strong>not be able to log back in</strong> until the server has decided their ban period is over (around 30s).  Furthermore, another bug in Zabbix (resolved in 1.8.5) prevents successful logins to reset the failed logins counter, which means that after three (possibly non-consecutive) failed logins every failed login triggers the ban period. The test suite logs in and out once per test file.  The logout method does not work.  There are more than three test files.  Do the math :(</p>
  </dd>
  <dt>
    raw_query(method =&gt; \s-1STR\s0, [params =&gt; \s-1HASHREF\s0])
  </dt>
  <dd>
    <p>Send a JSON-RPC query to the Zabbix server.  The \*(C`params\*(C' hashref should contain the method's parameters; query parameters (query \s-1ID\s0, auth cookie, JSON-RPC version, and \s-1HTTP\s0 request headers) are set by the method itself. Return a \*(C`HTTP::Response\*(C' object. If the verbosity is set to 1, will print the \*(C`HTTP::Response\*(C' to \s-1STDOUT\s0.  If set to 2, will print the Data::Dumper output of same (it also contains the \*(C`HTTP::Request\*(C' being replied to). If the verbosity is strictly greater than 0, the internal LWP::UserAgent instance will also print \s-1HTTP\s0 request progress.</p>
  </dd>
  <dt>
    query(method =&gt; \s-1STR\s0, [params =&gt; \s-1HASHREF\s0])
  </dt>
  <dd>
    <p>Wrapper around \*(C`raw_query\*(C' that will return the decoded result data instead.</p>
  </dd>
  <dt>
    api_version
  </dt>
  <dd>
    <p>Query the Zabbix server for the \s-1API\s0 version number and return it.</p>
  </dd>
  <dt>
    fetch(\s-1CLASS\s0, [params =&gt; \s-1HASHREF\s0])
  </dt>
  <dd>
    <p>This method fetches objects from the server.  The \s-1PARAMS\s0 hashref should contain \s-1API\s0 method parameters that identify the objects you're trying to fetch, for instance:   $zabbix-&gt;fetch(&apos;Item&apos;, params =&gt; { search =&gt; { key_ =&gt; &apos;system.uptime&apos; } }); The default value of \s-1PARAMS\s0 is an empty hashref, which should mean \*(L"fetch every object of type \s-1CLASS\s0\*(R". The method delegates a lot of work to the \s-1CLASS\s0 so that it can be as generic as possible.  Any \s-1CLASS\s0 name in the \*(C`Zabbix::API\*(C' namespace is usable as long as it descends from \*(C`Zabbix::API::CRUDE\*(C' (to be precise, it should implement a number of methods, some of which \*(C`CRUDE\*(C' implements, some of which are provided by specialized subclasses provided in the distribution).  The string \*(C`Zabbix::API::\*(C' will be prepended if it is missing. Returns an arrayref of \s-1CLASS\s0 instances.</p>
  </dd>
  <dt>
    fetch_single(\s-1CLASS\s0, [params =&gt; \s-1HASHREF\s0])
  </dt>
  <dd>
    <p>Like \*(C`fetch\*(C', but also checks how many objects the server sent back. If no objects were sent, returns \*(C`undef\*(C'.  If one object was sent, returns that.  If more objects were sent, throws an exception.  This helps against malformed queries; Zabbix tends to return <strong>all</strong> objects of a class when a query contains strange parameters (like \*(L"searhc\*(R" or \*(L"fliter\*(R").</p>
  </dd>
  <dt>
    useragent
  </dt>
  <dd>
    <p>Accessor for the LWP::UserAgent object that handles \s-1HTTP\s0 queries and responses.  Several useful options can be set: timeout, redirects, etc.</p>
  </dd>
  <dt>
    verbosity([\s-1VERBOSITY\s0])
  </dt>
  <dd>
    <p>Mutator for the verbosity level. Implemented verbosities so far are 0, 1 and 2, where:</p>
<dl class='dl-vertical'>
  <dt>
    0
  </dt>
  <dd>
    <p>does not emit any messages,</p>
  </dd>
  <dt>
    1
  </dt>
  <dd>
    <p>prints out the \*(C`LWP::UserAgent\*(C' progress messages and the responses sent by the Zabbix server,</p>
  </dd>
  <dt>
    2
  </dt>
  <dd>
    <p>prints out the \*(C`LWP::UserAgent\*(C' progress messages and dumps to stdout (via \*(C`Data::Dumper\*(C') the queries sent to the server and the responses received.</p>
  </dd>

</dl>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOW-LEVEL ACCESS</h2>
        <div class="sectioncontent">
<p>Several attributes are available if you want to dig into the class' internals, through the standard blessed-hash-as-an-instance mechanism.  Those are:</p>
<dl class='dl-vertical'>
  <dt>
    server
  </dt>
  <dd>
    <p>A string containing the \s-1URL\s0 to which JSON-RPC queries should be POSTed.</p>
  </dd>
  <dt>
    verbosity
  </dt>
  <dd>
    <p>Verbosity level.  So far levels 0 to 2 are supported (i.e. do something different).</p>
  </dd>
  <dt>
    cookie
  </dt>
  <dd>
    <p>A string containing the current session's auth cookie, or the empty string if unauthenticated.</p>
  </dd>
  <dt>
    env_proxy
  </dt>
  <dd>
    <p>Direct access to the LWP::UserAgent <strong>initial</strong> configuration regarding proxies.  Setting this attribute after construction does nothing.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS AND MISSING FEATURES</h2>
        <div class="sectioncontent">
<h3>\s-1THE\s0 \s-1GREAT\s0 \s-1RACE\s0 \s-1CONDITION\s0</h3>
<p>Consider the following:</p><p>  my $host = $zabbix-&gt;fetch(&apos;Host&apos;, params =&gt; ...);</p><p>  my $same_host = Zabbix::API::Host-&gt;new(root =&gt; $zabbix,                                          params =&gt; same...);</p><p>  $same_host-&gt;push;</p><p>  is_deeply($host, $same_host); # yup   isnt($host, $same_host); # also yup</p><p>This means you can change the attribute A in $host and push it, and it will change on the server; then you can change some other attribute B in $same_host and push it, and it will change on the server... and attribute A will be changed back to its old value before you changed it in $host since $host and $same_host are different references to different objects and don't know about each other!  Of course this is also true if someone else is fiddling with the hosts directly on the web interface or in any other way.</p><p>To work around this, you have to \*(C`pull()\*(C' just before you start changing things.</p>
<h3>\s-1MOOSE\s0, \s-1ABSENCE\s0 \s-1OF\s0</h3>
<p>The distribution doesn't use Moose, because it was written with light dependencies in mind.  This is actually a problem in that I do not have the time to write proper accessors to cover all types of manipulations one might expect on, for instance, a graph's items.  Hence to push (in the stack sense) a new item into a graph's list of items, you have to use the push builtin on the dereferenced items mutator, instead of writing something like</p><p>  $graph-&gt;items-&gt;push($foo);</p><p>which would be easy to allow with Moose traits.  Plus, I had to write boilerplate validation code, which would have been taken care of by Moose at least where types and type coercions are concerned.</p>
<h3>\s-1OTHER\s0 \s-1BUGS\s0 \s-1THAT\s0 \s-1ARE\s0 \s-1NOT\s0 \s-1RELATED\s0 \s-1TO\s0 \s-1THE\s0 \s-1ABSENCE\s0 \s-1OF\s0 \s-1MOOSE\s0</h3>
<p>It is quite slow.  The server itself does not appear to be lightning fast; at least a recent Zabbix (1.8.5) on a Debian squeeze \s-1VM\s0 takes a couple seconds to reply to even trivial JSON-RPC queries.  This is compounded by the fact that Zabbix::API is being extra paranoid about default values and name/id collisions and fetches data maybe more often than necessary, for instance immediately before and after a \*(C`push()\*(C'.</p><p>Several types of objects are not implemented in this distribution; feel free to contribute them or write your own distribution (see Zabbix::API::CRUDE for the gory \s-1API\s0 details).</p><p>The \*(C`logout\*(C' business.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Zabbix::API&hellip;</h2>
        <div class="sectioncontent">
<p>The Zabbix \s-1API\s0 documentation, at &lt;http://www.zabbix.com/documentation/start&gt;</p><p>LWP::UserAgent</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Fabrice Gabolde &lt;fabrice.gabolde@uperto.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2011, 2012, 2013 \s-1SFR\s0</p><p>This library is free software; you can redistribute it and/or modify it under the terms of the GPLv3.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="YAML::Shell.3pm.html"><span aria-hidden="true">&larr;</span> YAML::Shell.3pm: The yaml test shell</a></li>
   <li class="next"><a href="Zabbix::API::Action.3pm.html">Zabbix::API::Action.3pm: Zabbix action objects <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
