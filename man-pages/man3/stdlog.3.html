<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>stdlog: Standard logging library</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Standard logging library">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="stdlog (3) manual">
  <meta name="twitter:description" content="Standard logging library">
  <meta name="twitter:image" content="https://www.carta.tech/images/liblogging-stdlog-dev-stdlog-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/stdlog.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="stdlog (3) manual" />
  <meta property="og:description" content="Standard logging library" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liblogging-stdlog-dev-stdlog-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">stdlog<small> (3)</small></h1>
        <p class="lead">Standard logging library</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/stdlog.3.html">
      <span itemprop="name">stdlog: Standard logging library</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liblogging-stdlog-dev/">
      <span itemprop="name">liblogging-stdlog-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/stdlog.3.html">
      <span itemprop="name">stdlog: Standard logging library</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
#include &lt;liblogging/stdlog.h&gt;

const char* stdlog_version(void);

int stdlog_init(int options);
void stdlog_deinit();

stdlog_channel_t stdlog_open(const char *ident,
          const int options, const int facility,
          const char *channelspec);
int stdlog_log(stdlog_channel_t channel, const int severity,
               const char *fmt, ...);
int stdlog_log_b(stdlog_channel_t channel, const int severity,
               char *buf, const size_t lenbuf,
               const char *fmt, ...);
int stdlog_vlog(stdlog_channel_t channel, const int severity,
               const char *fmt, va_list ap);
int stdlog_vlog_b(stdlog_channel_t channel, const int severity,
               char *buf, const size_t lenbuf,
               const char *fmt, va_list ap);
void stdlog_close(stdlog_channel_t channel);

size_t stdlog_get_msgbuf_size(void);
const char *stdlog_get_dflt_chanspec(void);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>stdlog_version()</strong> returns the version string for the library currently being used (e.g. "1.0.2"). It may be called at any time. If a specific (minimal) version of the library is required, it is suggested to do runtime checks via <strong>stdlog_version()</strong> before <strong>stdlog_init()</strong> is called.</p><p><strong>stdlog_init()</strong> is used to initialize the logging system. It must only be called once during the lifetime of a process. If no special options are desired, stdlog_init() is optional. If it is not called, the first call to any of the other calls will initiate it. This feature is primarily for backward compatibility with how the legacy <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a></strong> API worked. It does not play well with multi-threaded applications. With them, call stdlog_init() explicitly from the startup thread. The parameter <em>options</em> contains one or more of the library options specified in their own section below.</p><p><strong>stdlog_deinit(void)</strong> is used to clean up resources including closing file handles at library exit. No library calls are permitted after it has been called. It&apos;s usage is optional if no cleanup is required (this will leave resource leaks which will be reported by tools like valgrind).</p><p><strong>stdlog_open()</strong> is used to open a log channel which can be used in consecutive calls to <em>stdlog_log()</em>. The string given to <em>ident</em> is used to identify the message source. It&apos;s handling is depending on the output driver. For example, the file: and syslog: drivers prepend it to the message, while the journal: driver ignores it (as the journal automatically identifies messages based on the application who submits them. In general, you can think of it as being equivalent to the <em>ident</em> specified in the traditional <a href="../man3/openlog.3.html"><strong>openlog</strong>(3)</a></strong> call. The value given in <em>options</em> controls handling of the channel. It can be used to override options set during <strong>stdlog_init()</strong>. Note that for signal-safeness you need to specify <strong>STDLOG_SIGSAFE</strong>. The <em>facility</em> field contains a facility similar to the traditional syslog facility. Again, it is driver-dependent on how this field is actually used. The <em>channelspec</em> filed is a <strong>channel specification</strong> string, which allows to control the destination of this channel. To use the default output channel specification, provide NULL to <em>channelspec</em>. Doing so is highly suggested if there is no pressing need to do otherwise.</p><p><strong>stdlog_close()</strong> is used to close the associated channel. The channel specifier must not be used after <em>stdlog_close()</em> has been called. If done so, unpredictable behavior will happen, as the memory it points to has been free&apos;ed.</p><p><strong>stdlog_log()</strong> is the equivalent to the <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a></strong> call. It offers a similar interface, but there are notable differences. The <em>channel</em> parameter is used to specify the log channel to use to. Use <em>NULL</em> to select the default channel. This is sufficient for most applications. The <em>severity</em> field contains a syslog-like severity.  The remaining arguments are a format, as in <a href="../man3/printf.3.html"><strong>printf</strong>(3)</a></strong> and any arguments required by the format. Note that some restrictions apply to the format in signal-safe mode (described below). The <strong>stdlog_log()</strong> supports log message sizes of slightly less than 4KiB. The exact size depends on the log driver and parameters specified in <strong>stdlog_open()</strong>. The reason is that the log drivers may need to add headers and trailers to the message text, and this is done inside the same 4KiB buffer that is also used for the actual message text. For example, the "syslog:" driver adds a traditional syslog header, which among others contains the <em>ident</em> string provided by <strong>stdlog_open()</strong>. If the complete log message does not fit into the buffer, it is silently truncated. The formatting buffer is allocated on the stack.</p><p>Note that the 4Kib buffer size is a build time default. As such, distributions may change it. To obtain the size limit that the linked in instance of libloggin-stdlog was build with, use <strong>stdlog_get_msgbuf_size()</strong>. You may also use the <strong>stdlogctl</strong>(1)</strong> utility to find out the build time settings for the installed version of liblogging-stdlog.</p><p><strong>stdlog_log_b()</strong> is almost equivalent to <strong>stdlog_log()</strong>, except that the caller can provide a formatting work buffer. This is done via the <em>buf</em> and <em>buflen</em> parameters. This permits to use both smaller and larger buffer sizes. For embedded systems (or signal handlers), this may be convenient to reduce the amount of stack space required. Also, it is useful if very large messages are to be logged. Note that while there is no upper limit on the buffer size per se, the log drivers may have some limits. In general, up to 64KiB of buffer should work with all drivers.</p><p>The <strong>stdlog_vlog()</strong> and <strong>stdlog_vlog_b()</strong> calls are equivalent to <strong>stdlog_log()</strong> and <strong>stdlog_log_b()</strong> except that they take a <em>va_list</em> argument.</p><p>Use <strong>stdlog_get_dflt_chanspec()</strong> to obtain the default channel specification. This must be called only after <strong>stdlog_init()</strong> has been called.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Options modify library behavior. They can be specified in <strong>stdlog_init()</strong> and <strong>stdlog_open()</strong> calls. The <strong>stdlog_init()</strong> call is used to set default options. These are applied if channels are automatically created or the <em>STDLOG_USE_DFLT_OPTS</em> option is used in <strong>stdlog_open()</strong>. Otherwise, options provided to <strong>stdlog_open()</strong> are not affected by the global option set.</p><p>The following options can be given:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>STDLOG_USE_DFLT_OPTS</strong></p>
  </dt>
  <dd>
    <p>is used to indicate that the <strong>stdlog_open()</strong> call shall use the default global options. If this option is given, on other options can be set. Trying to do so results in an error. Note that this option is <em>not</em> valid to for the <strong>stdlog_init()</strong> call.</p>
  </dd>
  <dt>
    <p><strong>STDLOG_SIGSAFE</strong></p>
  </dt>
  <dd>
    <p>request signal-safe mode. If and only if this is specified library calls are signal-safe. Some restrictions apply in signal-safe mode. See description below for details.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FACILITIES</h2>
        <div class="sectioncontent">
<p>The following facilities are supported. Please note that they are mimicked after the traditional syslog facilities, but liblogging-stdlog uses different numerical values. This is necessary to provide future enhancements. Do <strong>not</strong> use the LOG_xxx #defines from syslog.h but the following STDLOG_xxx defines:</p>
<pre>
STDLOG_KERN     - kernel messages
STDLOG_USER     - random user-level messages
STDLOG_MAIL     - mail system
STDLOG_DAEMON   - system daemons
STDLOG_AUTH     - security/authorization messages
STDLOG_SYSLOG   - messages generated internally by syslogd
STDLOG_LPR      - line printer subsystem
STDLOG_NEWS     - network news subsystem
STDLOG_UUCP     - UUCP subsystem
STDLOG_CRON     - clock daemon
STDLOG_AUTHPRIV - security/authorization messages (private)
STDLOG_FTP      - ftp daemon

STDLOG_LOCAL0   - reserved for application use
STDLOG_LOCAL1   - reserved for application use
STDLOG_LOCAL2   - reserved for application use
STDLOG_LOCAL3   - reserved for application use
STDLOG_LOCAL4   - reserved for application use
STDLOG_LOCAL5   - reserved for application use
STDLOG_LOCAL6   - reserved for application use
STDLOG_LOCAL7   - reserved for application use
</pre>
<p>Regular applications should use facilities in the <strong>STDLOG_LOCALx</strong> range. Non-privileged applications may not be able to use all of the system-defined facilities. Note that it is also safe to refer to application specific facilities via</p>
<pre>
STDLOG_LOCAL0 + offset
</pre>
<p>if offset is in the range of 0 to 7.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEVERITY</h2>
        <div class="sectioncontent">
<p>The following severities are supported:</p>
<pre>
STDLOG_EMERG   - system is unusable
STDLOG_ALERT   - action must be taken immediately
STDLOG_CRIT    - critical conditions
STDLOG_ERR     - error conditions
STDLOG_WARNING - warning conditions
STDLOG_NOTICE  - normal but significant condition
STDLOG_INFO    - informational
STDLOG_DEBUG   - debug-level messages
</pre>
<p>These reflect the traditional syslog severity mappings. Note that different output drivers may have different needs and may map severities into a smaller set.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">THREAD- AND SIGNAL-SAFENESS</h2>
        <div class="sectioncontent">
<p>These calls are thread- and signal-safe:</p><ul>
<li><p><strong>stdlog_version()</strong></p></li><li><p><strong>stdlog_get_msgbuf_size()</strong></p></li><li><p><strong>stdlog_get_dflt_chanspec()</strong></p><p>These calls are <strong>not</strong> thread- or signal-safe:</p></li><li><p><strong>stdlog_init()</strong></p></li><li><p><strong>stdlog_deinit()</strong></p></li><li><p><strong>stdlog_open()</strong></p></li><li><p><strong>stdlog_close()</strong></p><p>For <strong>stdlog_log()</strong>, <strong>stdlog_vlog()</strong>, <strong>stdlog_log_b()</strong>, and <strong>stdlog_vlog_b()</strong>, it depends:</p></li><li><p>if the channel has been opened with the <em>STDLOG_SIGSAFE</em> option, the call is both thread-safe and signal-safe.</p></li><li><p>if the library has been initialized by <strong>stdlog_init()</strong> or the channel has been opened by <strong>stdlog_open()</strong>, the call is thread-safe but <strong>not</strong> signal-safe.</p></li><li><p>if the library has not been initialized and the default (NULL) channel is used, the call is neither thread- nor signal-safe.</p><p>For <strong>stdlog_log_b()</strong> and <strong>stdlog_vlog_b()</strong> the caller must also ensure that the provided formatting buffer supports the desired thread- and signal-safeness. For example, if a static buffer is used, thread-safeness is not given. For signal-safeness, typically a buffer allocated on the signal handler&apos;s stack is needed.</p><p>For multi-threaded applications, it is <strong>highly recommended</strong> to initialize the library via <strong>stdlog_init()</strong> on the main thread <strong>before</strong> any other threads are started.</p><p>Thread- and signal-safeness, if given, does not require different channels. It is perfectly fine to use the same channel in multiple threads. Note however that interrupted system calls will not be retried. An error will be returned instead. This may happen if a thread is inside a <strong>stdlog_log()</strong> call while an async signal handler using that same call is activated. Depending on timing, the first call may or may not complete successfully. It is the caller&apos;s chore to check return status and do retries if necessary.</p><p>Finally, thread- and signal-safeness depend on the log driver. At the time of this writing, the "syslog:" and "file:" drivers are thread- and signal-safe while the current "journal:" driver is thread- but not signal-safe. To the best of our knowledge, the systemd team is working on making the API we depend on signal-safe. If this is done, the driver itself is also signal-safe (the restriction results from the journal API).</p></li>
</ul><h3>RESRICTIONS IN SIGNAL-SAFE MODE</h3>
<p>When signal-safeness is requested, the set of supported printf formats is restricted. This is due to the fact that the standard printf routines cannot be called and so a smaller signal-safe printf implementation that is part of <em>liblogging-stdlog</em> is used instead.</p><p>It has the following restrictions:</p><ul>
<li><p>flag characters are not supported</p></li><li><p>field width and precision fields are accepted but silently ignored</p></li><li><p>the following length modifiers are supported: <strong>l, ll, h, hh, z</strong></p></li><li><p>the following conversion specifiers are supported: <strong>s, i, d, u, x, X,</strong> p, c, f (where <strong>f</strong> is always formatted as "%.2f")</p></li><li><p>only the following control character escapes are supported: <strong>&#92;n, &#92;r, &#92;t, &#92;&#92;</strong>. Please note that it is <strong>not</strong> advisable to include control characters in log records. Log drivers and log back-end systems may remove them.</p></li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CHANNEL SPECIFICATIONS</h2>
        <div class="sectioncontent">
<p>The channel is described via a single-line string. Currently, the following channels can be selected:</p><ul>
<li><p>"syslog:", which is the traditional syslog output to /dev/log</p></li><li><p>"uxsock:&lt;name&gt;", which writes messages to the local unix socket <em>name</em>. The message is formatted in traditional syslog-format.</p></li><li><p>"journal:", which emits messages via the native systemd journal API</p></li><li><p>"file:&lt;name&gt;", which writes messages in a syslog-like format to the file specified as <em>name</em></p><p>If no channel specification is given, the default is "syslog:". The default channel can be set via the <strong>LIBLOGGING_STDLOG_DFLT_LOG_CHANNEL</strong> environment variable.</p><p>Not all output channel drivers are available on all platforms. For example, the "journal:" driver is not available on BSD. It is highly suggested that application developers <strong>never</strong> hard-code any channel specifiers inside their code but rather permit the administrator to configure these. If there is no pressing need to select different channel drivers, it is suggested to rely on the default channel spec, which always can be set by the system administrator.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>When successful <strong>stdlog_init()</strong> and <strong>stdlog_log()</strong> return zero and something else otherwise. <strong>stdlog_open()</strong> returns a channel descriptor on success and <em>NULL</em> otherwise. In case of failure <em>errno</em> is set appropriately.</p><p>Note that the traditional <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a></strong> API does not return any success state, so any failures are silently ignored. In most cases, this works sufficiently reliably. If this level of reliability is sufficient, the return code of <strong>stdlog_log()</strong> does not need to be checked. This is probably the case for most applications.</p><p>If finding out about the success of the logging operation is vital to the application, the return code can be checked. Note that you must not try to find out the exact failure cause. If the return is non-zero, something in the log system did not work correctly. It is suggested that the logging operation is re-tried in this case, and if it fails again it is suggested that the channel is closed and re-opened and then the operation re-tried. During failures, partial records may be logged. This is the same what could happen with <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a></strong>. Again, in general it should not be necessary to check the return code of <strong>stdlog_log()</strong>.</p><p>The <strong>stdlog_deinit()</strong> and <strong>stdlog_close()</strong> calls do not return any status.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>A typical single-threaded application just needs to know about the <strong>stdlog_log()</strong> call:</p>
<pre>
stdlog_log(NULL, STDLOG_NOTICE, "New session %d of user %s",
           sessid, username);
</pre>
<p>Being thread- and signal-safe requires a little bit more of setup:</p>
<pre>
/* on main thread */
status = stdlog_init(STDLOG_SIGSAFE);

/* here comes the rest of the code, including worker
 * thread startup.
 */


/* And do this in threads, signal handlers, etc: */
stdlog_log(NULL, STDLOG_NOTICE, "New session %d of user %s",
           sessid, username);
</pre>
<p>If you need just a small formatting buffer (or a large one), you can provide the memory yourself:</p>
<pre>
char buf[512];
stdlog_log_b(NULL, STDLOG_NOTICE, buf, sizeof(buf),
             "New session %d of user %s", sessid, username);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO stdlog&hellip;</h2>
        <div class="sectioncontent">
<p><strong>stdlogctl</strong>(1)</strong>, <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a></strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>This page is part of the <em>liblogging</em> project, and is available under the same BSD 2-clause license as the rest of the project.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Rainer Gerhards &lt;rgerhards@adiscon.com&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="stdio_ext.3.html"><span aria-hidden="true">&larr;</span> stdio_ext.3: Interfaces to stdio file structure</a></li>
   <li class="next"><a href="stdout.3.html">stdout.3: Standard i/o streams <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
