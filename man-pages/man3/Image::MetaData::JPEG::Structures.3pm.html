<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Image::MetaData::JPEG::Structures: This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Image::MetaData::JPEG::Structures (3pm) manual">
  <meta name="twitter:description" content="This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libimage-metadata-jpeg-perl-Image::MetaData::JPEG::Structures-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Image::MetaData::JPEG::Structures.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Image::MetaData::JPEG::Structures (3pm) manual" />
  <meta property="og:description" content="This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libimage-metadata-jpeg-perl-Image::MetaData::JPEG::Structures-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Image::MetaData::JPEG::Structures<small> (3pm)</small></h1>
        <p class="lead">This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Image::MetaData::JPEG::Structures.3pm.html">
      <span itemprop="name">Image::MetaData::JPEG::Structures: This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libimage-metadata-jpeg-perl/">
      <span itemprop="name">libimage-metadata-jpeg-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Image::MetaData::JPEG::Structures.3pm.html">
      <span itemprop="name">Image::MetaData::JPEG::Structures: This document describes the structure of a jpeg file; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">THE STRUCTURE OF JPEG PICTURES</h2>
        <div class="sectioncontent">
<p>The \s-1JPEG\s0 (Joint Photographic Experts Group) \s-1ISO\s0 standard is a lossy image compression mechanism developed before 1990, designed for compressing colour or gray-scale photo-realistic images (it performs poorly on line-art drawings). The \s-1JPEG\s0 mechanism is designed to exploit known limitations of the human eye, in particular the fact that colour changes are perceived less accurately than changes in brightness. Note that although the \*(L"baseline\*(R" \s-1JPEG\s0 format is patent-free, there are patents associated with some optional features, namely arithmetic coding and hierarchical storage. For this reason, these optional features are never used on the Web (good job, patent fans ...). \s-1JPEG\s0 refers only to a class of compression algorithms, not to a specific file format. In order to produce files with embedded \s-1JPEG\s0 streams, a number of file format (semi-)standards have been adapted or devised, some of which are listed in the format section. The structure of a well formed \s-1JPEG\s0 file can be described by the following pseudo production rules (for sake of simplicity, some additional constraints between tables and \s-1SOF\s0 segments are neglected).</p>
<pre>
        JPEG        --&gt; (SOI)(misc)*(image)?(EOI)
        (image)     --&gt; (hierarch.)|(non-hier.)
        (hierarch.) --&gt; (DHP)(frame)+
        (frame)     --&gt; (misc)*(EXP)?(non-hier.)
        (non-hier.) --&gt; (SOF)(scan)+
        (scan)      --&gt; (misc)*(SOS)(data)*(ECS)(DNL)?
        (data)      --&gt; (ECS)(RST)
        (misc)      --&gt; (DQT)|(DHT)|(DAC)|(DRI)|(COM)|(APP)

        (SOI) = Start Of Image
        (EOI) = End Of Image
        (SOF) = Start Of Frame header (10 types)
        (SOS) = Start Of Scan header
        (ECS) = Entropy Coded Segment (row data, not a real segment)
        (DNL) = Define Number of Lines segment
        (DHP) = Define Hierarchical P??? segment
        (EXP) = EXPansion segment
        (RST) = ReSTart segment (8 types)
        (DQT) = Define Quantisation Table
        (DHT) = Define Huffman coding Table
        (DAC) = Define Arithmetic coding Table
        (DRI) = Define Restart Interval
        (COM) = COMment segment
        (APP) = APPlication segment
</pre>
<p>This package does not check that a \s-1JPEG\s0 file is really correct; it accepts a looser syntax, were segments and \s-1ECS\s0 blocks are just contiguous (basically, because it does not need to display the image!). All meta-data information is concentrated in the (COM*) and (\s-1APP\s0) Segments, exception made for some records in the (SOF*) segment (e.g. image dimensions).</p><p>  Reference: B&lt;"Digital compression and coding of continuous-tone still              images: requirements and guidelines", CCITT recommend. T.81, 1992,              The International Telegraph and Telephone Consultative Committee,              standard ISO/IEC IS 10918-1 or ITU-T Recommendation T.81&gt;.        Also: B&lt;"The JPEG still picture compression standard", G.K.Wallace,              1991, IEEE Transactions on Consumer Electronics&gt;.</p><h3>A \s-1SHORT\s0 \s-1HISTORY\s0 \s-1OF\s0 \s-1JPEG\s0 \s-1FILE\s0 \s-1FORMATS\s0</h3>
<p><em>\s-1TIFF\s0 [not supported]</em></p><p>The \s-1TIFF\s0 (Tagged Image File Format) is one of the most popular and flexible raster file formats for digital images, and is the de-facto standard graphics format for high colour depths. It was initially developed by Aldus (in 1986) and is now maintained (or neglected) by Adobe. Multiple images (e.g., fax pages) can be stored in a single \s-1TIFF\s0 file, each page in a separate \s-1IFD\s0 (Image File Directory), all \s-1IFD\s0's being linked in a linear structure. The designers of \s-1TIFF\s0 wanted to be able to include all sorts of image information in the file (tags), like geometry, size, data arrangement and various compression options. However, lack of full \s-1TIFF\s0 support by the first publicly available readers resulted in a \*(L"reduced standard\*(R", so that even today most \s-1TIFF\s0 files contain only 32-bit uncompressed images. Support for \s-1JPEG\s0 streams was included in version 6.0 (in 1992), but it was badly designed, so that \s-1JPEG/TIFF\s0 files are nowadays very uncommon (some changes were proposed in various technical notes in 1995 and 2002, but they never made it to version 7.0).</p><p>  Reference: B&lt;"TIFF (TM)", revision 6.0, June 1992, Adobe Developers              Association, Adobe Systems Incorporated, Mountain View, CA, USA&gt;.        Also: B&lt;"Adobe PageMaker 6.0: TIFF Technical Notes", September 1995&gt;,              B&lt;"Adobe Photoshop: TIFF Technical Notes", March 2002&gt;.</p><p><em>\s-1JFIF\s0</em></p><p>The \s-1JFIF\s0 (\s-1JPEG\s0 File Interchange Format) was created by Eric Hamilton at C-Cube Microsystems in 1991 for storing JPEG-encoded data, and put into the public domain together with example reference software. \s-1JFIF\s0 is designed to allow files containing JPEG-encoded data streams to be exchanged between otherwise incompatible systems and applications. A \s-1JFIF\s0 file basically consists of a \s-1JPEG\s0 file with an \s-1APP0\s0 segment of \s-1JFIF\s0 or \s-1JFXX\s0 type at the beginning, providing information missing from the \s-1JPEG\s0 stream: version number, horizontal and vertical pixel density, pixel aspect ratio and an optional thumbnail (extended \s-1JFIF\s0 files can contain also compressed thumbnails). \s-1JFIF\s0 files conform to the general file interchange specifications in \s-1ISO/IEC\s0 10918-1.</p><p>  Reference: B&lt;"JPEG File Interchange Format", version 1.02, September 1992,              Eric Hamilton, C-Cube Microsystems, Milpitas, CA, USA&gt;.</p><p><em>\s-1SPIFF\s0 [not supported yet]</em></p><p>The \s-1SPIFF\s0 (Still Picture Interchange File Format) is an official file format released in 1996 by the Joint Photographic Experts Group. It can contain image data streams encoded with a variety of compression mechanism, including \s-1JPEG\s0 and \s-1JBIG\s0. When \s-1JPEG\s0 was standardised, disagreements among \s-1ISO\s0 committees prevented a standard \s-1JPEG\s0 file format from being created. The de-facto format that appeared was \s-1JFIF\s0, with which a \s-1JPEG/SPIFF\s0 file is backward compatible. In addition to the image data, \s-1SPIFF\s0 includes information necessary to render it on common output devices, within the constraints imposed by that device. \s-1SPIFF\s0 appears not to be widely adopted; most producers prefer simple \s-1JFIF\s0 files.</p><p>  Reference: B&lt;ISO/IEC IS 10918-1, part 3&gt; (extensions to the standard).</p><p><em>\s-1CIFF\s0 [not supported yet]</em></p><p>The \s-1CIFF\s0 (Camera Image File Format) is a JPEG-based image file format developed by some camera makers in 1997, and constitutes an evolution of the \s-1JFIF\s0. A \s-1CIFF\s0 file has a standard \s-1JFIF\s0 \s-1APP0\s0 segment, immediately followed by another \s-1APP0\s0 segment holding information specific to a particular digital camera in a particular format. \s-1CIFF\s0 was not at all successful and was rapidly replaced by DCF/Exif.</p><p>  Reference: B&lt;"CIFF: Specification on Image Data File",              version 1.0 rev.4, December 1997, Canon corporation&gt;.</p><p><em>Exif and \s-1DCT\s0</em></p><p>The Exif (Exchangeable image file format), developed by the \s-1JEITA\s0 (1996 v.1.0, 1997 v.1.1, 1998 v.2.1, 2002 v.2.2) standard was aimed at realizing a common format for the image files used with digital still cameras and other related equipment. Exif is paired with a set of naming conventions and directory layout for files in a camera memory (\s-1DCF\s0 or Design rule for Camera File system, 1999). An Exif file is a valid \s-1JPEG\s0 file with application marker segments (\s-1APP1\s0 and \s-1APP2\s0) inserted. Uncompressed files are recorded in \s-1TIFF-6\s0 format. Related attribute information is stored in the tag information format defined in \s-1TIFF-6\s0 (i.e., in a chain of \s-1IFD\s0's in the \s-1APP1\s0 segment). Information specific to the camera system and not defined in \s-1TIFF\s0 is stored in private tags registered for Exif. The Exif image file specification also specifies the method for recording thumbnails. The \s-1APP2\s0 segment is used when recording Flashpix extensions. Exif is the most common \s-1JPEG\s0 file format used by digital cameras nowadays.</p><p>  Reference: B&lt;JEITA CP-3451, "Exchangeable image file format for digital              still cameras: Exif Version 2.2", April 2002, Japan Electronics              and Information Technology Industries Association&gt;.</p>
<h3>Structure of a \s-1JFIF\s0 \s-1APP0\s0 segment</h3>
<p>\s-1APP0\s0 segments are used in the old \s-1JFIF\s0 standard to store information about the picture dimensions and an optional thumbnail. The format of a \s-1JFIF\s0 \s-1APP0\s0 segment is as follows (note that the size of thumbnail data is 3n, where n = Xthumbnail * Ythumbnail, and it is present only if n is not zero; only the first 8 records are mandatory):</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Identifier       5 bytes  ("JFIF&#92;000" = 0x4a46494600)     MajorVersion     1 byte   major version (e.g. 0x01)     MinorVersion     1 byte   minor version (e.g. 0x01 or 0x02)     Units            1 byte   units (0: densities give aspect ratio                                      1: density values are dots per inch                                      2: density values are dots per cm)     Xdensity         2 bytes  horizontal pixel density     Ydensity         2 bytes  vertical pixel density     Xthumbnail       1 byte   thumbnail horizontal pixel count     Ythumbnail       1 byte   thumbnail vertical pixel count     ThumbnailData   3n bytes  thumbnail image</p><p>There is also an <em>extended</em> \s-1JFIF\s0 (only possible for \s-1JFIF\s0 versions 1.02 and above). In this case the identifier is not \s-1JFIF\s0 but \s-1JFXX\s0. This extension allows for the inclusion of differently encoded thumbnails. The syntax in this case is modified as follows:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Identifier       5 bytes  ("JFXX&#92;000" = 0x4a46585800)     ExtensionCode    1 byte   (0x10 Thumbnail coded using JPEG                                0x11 Thumbnail using 1 byte/pixel                                0x13 Thumbnail using 3 bytes/pixel)</p><p>Then, depending on the extension code, there are other records to define the thumbnail. If the thumbnail is coded using a <em>\s-1JPEG\s0 stream</em>, a binary \s-1JPEG\s0 stream immediately follows the extension code (the byte count of this file is included in the byte count of the \s-1APP0\s0 Segment). This stream conforms to the syntax for a \s-1JPEG\s0 file (\s-1SOI\s0 .... \s-1SOF\s0 ... \s-1EOI\s0); however, no '\s-1JFIF\s0' or '\s-1JFXX\s0' marker Segments should be present:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     JPEGThumbnail  ... bytes  a variable length JPEG picture</p><p>If the thumbnail is stored using one byte per pixel, after the extension code one should find a palette and an indexed \s-1RGB\s0. The records are as follows (remember that n = Xthumbnail * Ythumbnail):</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Xthumbnail       1 byte    thumbnail horizontal pixel count     YThumbnail       1 byte    thumbnail vertical pixel count     ColorPalette   768 bytes   24-bit RGB values for the colour palette                                (defining the colours represented by each                                 value of an 8-bit binary encoding)     1ByteThumbnail   n bytes   8-bit indexed values for the thumbnail</p><p>If the thumbnail is stored using three bytes per pixel, there is no colour palette, so the previous fields simplify into:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Xthumbnail       1 byte    thumbnail horizontal pixel count     YThumbnail       1 byte    thumbnail vertical pixel count     3BytesThumbnail 3n bytes 24-bit RGB values for the thumbnail</p>
<h3>Structure of an Exif \s-1APP1\s0 segment</h3>
<p>Exif (Exchangeable Image File format) \s-1JPEG\s0 files use \s-1APP1\s0 segments in order not to conflict with \s-1JFIF\s0 files (which use \s-1APP0\s0). Exif \s-1APP1\s0 segments store a great amount of information on photographic parameters for digital cameras and are the preferred way to store thumbnail images nowadays. They can also host an additional section with \s-1GPS\s0 data. The reference document for Exif 2.2 and the Interoperability standards are respectively:</p><p>   B&lt;"Exchangeable image file format for digital still cameras:     Exif Version 2.2", JEITA CP-3451, Apr 2002    Japan Electronic Industry Development Association (JEIDA)&gt;</p><p>   B&lt;"Design rule for Camera File system", (DCF), v1.0     English Version 1999.1.7, Adopted December 1998    Japan Electronic Industry Development Association (JEIDA)&gt;</p><p>The \s-1TIFF\s0 (Tagged Image File format) standard documents, as well as some updates and corrections, are also useful:</p><p>   B&lt;- "TIFF(TM) Revision 6.0, Final", June 3, 1992, Adobe Devel. Association    - ISO 12639, "Graphic technology -- Prepress digital data exchange          -- Tag image file format for image  technology (TIFF/IT)"    - ISO 12234-2, "Electronic still-picture imaging -- Removable memory          -- Part 2: TIFF/EP image data format"    - DRAFT - TIFF CLASS F, October 1, 1991    - DRAFT - TIFF Technical Note #2, 17-Mar-95 (updates for JPEG-in-TIFF)    - "Adobe Pagemaker 6.0 TIFF Technical Notes", (1,2,3 and OPI), 14-Sep-1995&gt;</p><p>Exif \s-1APP1\s0 segments are made up by an identifier, a \s-1TIFF\s0 header and a sequence of IFDs (Image File Directories) and subIFDs. The high level IFDs are only two (\s-1IFD0\s0, for photographic parameters, and \s-1IFD1\s0 for thumbnail parameters); they can be followed by thumbnail data. The structure is as follows:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Identifier       6 bytes   ("Exif&#92;000&#92;000" = 0x457869660000), not stored     Endianness       2 bytes   &apos;II&apos; (little-endian) or &apos;MM&apos; (big-endian)     Signature        2 bytes   a fixed value = 42     IFD0_Pointer     4 bytes   offset of 0th IFD (usually 8), not stored     IFD0                ...    main image IFD     IFD0@SubIFD         ...    Exif private tags (optional, linked by IFD0)     IFD0@SubIFD@Interop ...    Interoperability IFD (optional,linked by SubIFD)     IFD0@GPS            ...    GPS IFD (optional, linked by IFD0)     APP1@IFD1           ...    thumbnail IFD (optional, pointed to by IFD0)     ThumbnailData       ...    Thumbnail image (optional, 0xffd8.....ffd9)</p><p>So, each Exif \s-1APP1\s0 segment starts with the identifier string \*(L"Exif&#92;000&#92;000\*(R"; this avoids a conflict with other applications using \s-1APP1\s0, for instance \s-1XMP\s0 data. The three following fields (Endianness, Signature and IFD0_Pointer) constitute the so called <em>\s-1TIFF\s0 header</em>. The offset of the 0th \s-1IFD\s0 in the \s-1TIFF\s0 header, as well as \s-1IFD\s0 links in the following IFDs, is given with respect to the beginning of the \s-1TIFF\s0 header (i.e. the address of the '\s-1MM\s0' or '\s-1II\s0' pair). This means that if the 0th \s-1IFD\s0 begins (as usual) immediately after the end of the \s-1TIFF\s0 header, the offset value is 8. An Exif segment is the only part of a \s-1JPEG\s0 file whose endianness is not fixed to big-endian.</p><p>If the thumbnail is present it is located after the 1st \s-1IFD\s0. There are 3 possible formats: \s-1JPEG\s0 (only this is compressed), \s-1RGB\s0 \s-1TIFF\s0, and YCbCr \s-1TIFF\s0. It seems that \s-1JPEG\s0 and 160x120 pixels are recommended for Exif ver. 2.1 or higher (mandatory for \s-1DCF\s0 files). Since the segment size for a segment is recorded in 2 bytes, thumbnails are limited to slightly less than 64KB.</p><p>Each \s-1IFD\s0 block is a structured sequence of records, called, in the Exif jargon, <em>Interoperability arrays</em>. The beginning of the 0th \s-1IFD\s0 is given by the 'IFD0_Pointer' value. The structure of an \s-1IFD\s0 is the following:</p><p>    [Record name]    [size]   [description]     ---------------------------------------                      2 bytes  number n of Interoperability arrays                    12n bytes  the n arrays (12 bytes each)                      4 bytes  link to next IFD (can be zero)                        ...    additional data area</p><p>The next_link field of the 0th \s-1IFD\s0, if non-null, points to the beginning of the 1st \s-1IFD\s0. The 1st \s-1IFD\s0 as well as all other sub-IFDs must have next_link set to zero. The thumbnail location and size is given by some interoperability arrays in the 1st \s-1IFD\s0. The structure of an Interoperability array is:</p><p>    [Record name]    [size]   [description]     ---------------------------------------                      2 bytes  Tag (a unique 2-byte number)                      2 bytes  Type (one out of 12 types)                      4 bytes  Count (the number of values)                      4 bytes  Value Offset (value or offset)</p><p>The possible types are the same as for the Record class, exception made for nibbles and references (see \*(L"Managing a \s-1JPEG\s0 Record object\*(R" in Image::MetaData::JPEG). Indeed, the Record class is modelled after interoperability arrays, and each interoperability array gets stored as a Record with given tag, type, count and values. The \*(L"value offset\*(R" field gives the offset from the \s-1TIFF\s0 header base where the value is recorded. It contains the actual value if it is not larger than 4 bytes (32 bits). If the value is shorter than 4 bytes, it is recorded in the lower end of the 4-byte area (smaller offsets). For further details see the section \*(L"Valid tags for Exif \s-1APP1\s0 data\*(R" in Image::MetaData::JPEG::TagLists.</p>
<h3>Structure of an \s-1XMP\s0 \s-1APP1\s0 segment</h3>
<p>\s-1XMP\s0 (eXtensible Metadata Platform) \s-1JPEG\s0 files use \s-1APP1\s0 segments in order to store metadata information; the storage format (serialisation) is \s-1RDF\s0 (Resource Description Framework) implemented as an application of \s-1XML\s0. \s-1XMP\s0 Exif \s-1APP1\s0 segments can store all information stored in Exif and \s-1IPTC\s0 segments, as well as custom and future schemas. The reference document for \s-1XMP\s0 3.2 can be requested from Adobe Systems Incorporated:</p><p>   B&lt;"XMP Specification", version 3.2, June 2005, Adobe Systems Inc.,    345 Park Avenue, San Jose, CA 95110-2704, L&lt;http://www.adobe.com&gt;&gt;</p><p>   B&lt;See also: L&lt;http://xml.coverpages.org/xmp.html&gt;&gt;    B&lt;See also: L&lt;http://www.w3.org/TR/REC-rdf-syntax/&gt;&gt;</p><p>\s-1XMP\s0 \s-1APP1\s0 segments are made up by an identifier and a Unicode \s-1XMP\s0 packet (the encoding is usually \s-1UTF-8\s0, but it can also be \s-1UTF-16\s0 or \s-1UTF-32\s0, both big-endian or little-endian). The packet cannot be split in multiple segments, so there is a maximum size of approximately 64KB. The structure is very simple: a fixed \s-1XMP\s0 namespace \s-1URI\s0 (null terminated, and without quotation marks) followed by the \s-1XMP\s0 packet:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     Identifier      29 bytes   http://ns.adobe.com/xap/1.0/&#92;000     &lt;XMP packet&gt;       ...     the actual Unicode XMP packet</p><p>The packet content is sandwiched between a header and a trailer, and may contain padding whitespaces at the end. The <em>xpacket</em> header has two mandatory attributes, <em>begin</em> and <em>id</em> (order is important), separated by exactly one space (U+0020). Attribute values, here and in the following, are enclosed by single quotes (U+0027) or double quotes (U+0022). The value of <em>begin</em> must be the Unicode <em>zero-width non-breaking space</em> (U+FEFF), to be used as a byte-order marker during blind scans; an empty value is also acceptable (for backward compatibility), and stands for \s-1UTF-8\s0. The value of <em>id</em> is fixed. Other attributes, like (deprecated) <em>bytes</em> or <em>encoding</em>, may be ignored. A padding of 2KB or 4KB, with a newline every 100 spaces, is recommended. The <em>end</em> attribute of the trailer may have a value of \*(L"r\*(R" (read-only) or \*(L"w\*(R" (modifiable).</p><p>    Header      &lt;?xpacket begin="..." id="W5M0MpCehiHzreSzNTczkc9d" ...?&gt;     Content       ... serialised XMP data (see later) ...     Padding       ... padding with XML whitespaces ...     Trailer     &lt;?xpacket end="w"?&gt;</p><p>The structure of the packet content is as follows. There is an optional <em>x:xmpmeta</em> (or <em>x:xapmeta</em> for older files) element, with a mandatory <em>xmlns:x</em> attribute set to \*(L"adobe:ns:meta/\*(R" and other optional attributes, which can be ignored (currently, Adobe's toolkit stores its version in <em>x:xmptk</em>). Inside it (or at top level, if it is absent), there is exactly one <em>rdf:RDF</em> element with an attribute specifying the <em>xmlns:rdf</em> namespace (other namespaces, whose role is not clear to me, can be listed here as additional attributes). Inside the <em>rdf:RDF</em> element then, all \s-1XMP\s0 properties are stored inside one or more <em>rdf:Description</em> elements:</p><p>    &lt;x:xmpmeta xmlns:x=&apos;adobe:ns:meta/&apos; ..opt.attributes..&gt;        &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;           &lt;rdf:Description ...&gt; .... &lt;/rdf:Description&gt;           &lt;rdf:Description ...&gt; .... &lt;/rdf:Description&gt;           .........           &lt;rdf:Description ...&gt; .... &lt;/rdf:Description&gt;        &lt;/rdf:RDF&gt;     &lt;/x:xmpmeta&gt;</p><p><strong>rdf:Description</strong> elements and schemas are usually in one-to-one correspondence, although this is just a convention and not a rule. Each element has two mandatory attributes, <em>rdf:about</em> and <em>xmlns:NAME</em>. The <em>rdf:about</em> attribute is usually empty (it can however contain an application specific \s-1URI\s0), and its value <strong>must</strong> be shared among all <em>rdf:Description</em> elements. The <em>xmlns:NAME</em> attribute specifies the local namespace prefix (\s-1NAME\s0 stands for the actual prefix). Additional namespaces can be specified via <em>xmlns</em> attributes.</p><p>    &lt;rdf:Description rdf:about="" xmlns:NAME="..."&gt;        &lt;NAME:propname1 ...&gt; .... &lt;/NAME:propname1&gt;        &lt;NAME:propname2 ...&gt; .... &lt;/NAME:propname2&gt;           .........        &lt;NAME:propnameN ...&gt; .... &lt;/NAME:propnameN&gt;     &lt;/rdf:Description&gt;</p><p>Properties can come in various flavours. A <strong>simple property</strong> is just some literal value between opening and closing tags carrying the property name; there exists also an abbreviated form where properties are listed as attributes of the <em>rdf:Description</em> tag (in this case there is no closing <em>rdf:Description</em> tag, and the opening tags ends with the '/' character). Simple properties can have qualifiers (attributes). This is an example of a description element with only simple properties:</p><p>    &lt;rdf:Description rdf:about="" xmlns:xap="http://ns.adobe.com/xap/1.0/"&gt;        &lt;xap:CreatorTool&gt;Adobe Photoshop Elements 3.0&lt;/xap:CreatorTool&gt;        &lt;xap:ModifyDate&gt;2005-05-12T44:39:11+03:00&lt;/xap:ModifyDate&gt;     &lt;/rdf:Description&gt;                                   or</p><p>    &lt;rdf:Description rdf:about="" xmlns:xap="http://ns.adobe.com/xap/1.0/"        xap:CreatorTool="Adobe Photoshop Elements 3.0"        xap:ModifyDate="2005-06-13T23:38:11+02:00"/&gt;</p><p>A <strong>structured property</strong> is characterised by a <em>rdf:Description</em> block instead of a simple content. The inner description block, which does not allow for an <em>rdf:about</em> attribute, contains one or more named properties (which can, of course, contain further substructures). This is an example of a description element with one structured property:</p><p>    &lt;rdf:Description rdf:about="" xmlns:xmpTPg="..an URI.."&gt;        &lt;xmpTPg:MaxPageSize&gt;           &lt;rdf:Description xmlns:stDim="..another URI.."&gt; ---.   Content              &lt;stDim:w&gt;21&lt;/stDim:w&gt;                           |   of  the              &lt;stDim:h&gt;27&lt;/stDim:h&gt;                           | MaxPageSize              &lt;stDim:unit&gt;centimetres&lt;/stDim:unit&gt;            |  structured           &lt;/rdf:Description&gt;                -----------------&apos;   property        &lt;/xmpTPg:MaxPageSize&gt;     &lt;/rdf:Description&gt;</p><p>An <strong>array property</strong> is, on the other hand, just an array of same-type properties. It can come in three varieties: as a <em>Bag</em> (an unordered set), as a <em>Seq</em>uence (an ordered list) and as an <em>Alt</em>ernative list (see later). As for structured properties, each item in the array is a property and can contain further substructures. The item list is delimited by an <em>rdf:Bag</em>, an <em>rdf:Seq</em>, or an <em>rdf:Alt</em> tag pair, respectively. Each item is delimited by a pair of <em>rdf:li</em> tags. The following example illustrates an unordered array property with three items:</p><p>    &lt;rdf:Description rdf:about="" xmlns:dc="..an URI.."&gt;        &lt;dc:subject&gt;           &lt;rdf:Bag&gt;                         ----------------.   Content              &lt;rdf:li&gt;metadata&lt;/rdf:li&gt;                      |   of  the              &lt;rdf:li&gt;schema&lt;/rdf:li&gt;                        |  unordered              &lt;rdf:li&gt;XMP&lt;/rdf:li&gt;                           |    array           &lt;/rdf:Bag&gt;                        ----------------&apos;  dc:subject        &lt;/dc:subject&gt;     &lt;/rdf:Description&gt;</p><p>A simple property (but, currently, not a structured or array property) can have <em>qualifiers</em>. For instance, items in an array property can be qualified; in this case, the content of <em>rdf:li</em> is not text, but an <em>rdf:Description</em> (without attributes) containing the actual value (as <em>rdf:value</em>) and the qualifiers as additional properties; a qualifier name belongs to a secondary namespace, specified as an attribute of the outer <em>rdf:Description</em>. The following example illustrates the use of property qualifiers:</p><p>    &lt;rdf:Description rdf:about="" xmlns:dc="..1stURI.." xmlns:ns="..2ndURI.."&gt;        &lt;dc:creator&gt;           &lt;rdf:Seq&gt;              &lt;rdf:li&gt;                       ----------------.  An element                 &lt;rdf:Description&gt;                           |    of the                    &lt;rdf:value&gt;William Gilbert&lt;/rdf:value&gt;   | ordered array                    &lt;ns:role&gt;lyricist&lt;/ns:role&gt;              |  dc:creator                 &lt;/rdf:Description&gt;                          |    with a              &lt;/rdf:li&gt;                      ----------------&apos;   qualifier              &lt;rdf:li&gt;                 &lt;rdf:Description&gt;                    &lt;rdf:value&gt;Arthur Sullivan&lt;/rdf:value&gt;                    &lt;ns:role&gt;composer&lt;/ns:role&gt;                 &lt;/rdf:Description&gt;              &lt;/rdf:li&gt;           &lt;/rdf:Seq&gt;        &lt;/dc:creator&gt;     &lt;/rdf:Description&gt;</p><p>Text properties in an <em>alternative array property</em> may have a special qualifier (the <em>xml:lang</em> property) specifying the language of the text. In this case, the serialisation is different: <em>xml:lang</em> for each item of the array becomes an attribute of the <em>rdf:li</em> tag. The default value is indicated by a special value of the qualifier, or is taken from the first item in the list. The following example illustrates an array of <em>language alternatives</em>:</p><p>    &lt;xmp:Title&gt;        &lt;rdf:Alt&gt;                            ----------------.     List of           &lt;rdf:li xml:lang="x-default"&gt;Title&lt;/rdf:li&gt;       |  alternatives           &lt;rdf:li xml:lang="en-us"&gt;Title&lt;/rdf:li&gt;           |  corresponding           &lt;rdf:li xml:lang="fr-fr"&gt;Titre&lt;/rdf:li&gt;           |  to xmp:Title;           &lt;rdf:li xml:lang="it-it"&gt;Titolo&lt;/rdf:li&gt;          |  the  language        &lt;/rdf:Alt&gt;                           ----------------&apos;   is xml:lang     &lt;/xmp:Title&gt;</p><p>The interpretation of the values of properties conforming to the previously described syntax is done with the aid of the <strong>schema</strong> corresponding to the property namespace. The most common schemas in \s-1JPEG\s0 files are the following ones (note, however, that \s-1XMP\s0 is intrinsically extensible, so this list will never be exhaustive):</p>
<dl class='dl-vertical'>
  <dt>
    Dublin Core schema =item \s-1XMP\s0 basic schema =item \s-1XMP\s0 rights management schema =item \s-1XMP\s0 media management schema =item \s-1XMP\s0 basic job ticket schema =item \s-1XMP\s0 paged-text schema =item \s-1XMP\s0 dynamic media schema =item Adobe Photoshop schema =item Camera row schema =item Exif schemas =item \s-1IPTC\s0 schema
  </dt>
  <dd>
    
  </dd>

</dl>

<h3>Structure of a Photoshop-style \s-1APP13\s0 segment</h3>
<p>The Adobe's Photoshop program, a de-facto standard for image manipulation, uses the \s-1APP13\s0 segment for storing non-graphic information, such as layers, paths, \s-1IPTC\s0 data and more. The unit for this kind of information is called a \*(L"resource data block\*(R" (because they hold data that was stored in the Macintosh's resource fork in early versions of Photoshop). The content of an \s-1APP13\s0 segment is formed by an identifier string (usually \*(L"Photoshop 3.0&#92;000\*(R", but also 'Adobe_Photoshop2.5:', used by earlier versions, is accepted; in this case some additional undocumented bytes are read (resolution info?) and saved in a root 'Resolution' record) followed by a sequence of resource data blocks; a resource block has the following structure:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     (Type)           4 bytes  Photoshop uses &apos;8BIM&apos; from ver 4.0 on     (ID)             2 bytes  a unique identifier, e.g., "&#92;004&#92;004" for IPTC     (Name)             ...    a Pascal string (padded to make size even)     (Size)           4 bytes  actual size of resource data     (Data)             ...    resource data, padded to make size even</p><p>(a Pascal string is made up of a single byte, giving the string length, followed by the string itself, padded to make size even including the length byte; since the string length is explicit, there is no need of a terminating null character). The signature (type) is usually '8BIM', but Photoshop used '8BPS' up to version 3.0, and some rogue program (Adobe PhotoDeluxe?) is using '\s-1PHUT\s0' (\*(L"PHotoshop User Tags\*(R" ?) for path information (ID=7d0-bb7). Valid Image Resource IDs are listed in the Photoshop-style tags' list section. In general a resource block contains only a few bytes, but there is an important block, the \s-1IPTC\s0 block, which can be quite large; the structure of this block is analysed in more detail in the \s-1IPTC\s0 data block section.</p><p>The reference document for the Photoshop file format is:</p><p>   B&lt;"Adobe Photoshop 6.0: File Formats Specifications",    Adobe System Inc., ver.6.0, rel.2, November 2000&gt;.</p><p>Another interesting source of information is:</p><p>   B&lt;"&#92;"Solo&#92;" Image File Format. RichTIFF and its     replacement by &#92;"Solo&#92;" JFIF", version 2.0a,    Coatsworth Comm. Inc., Brampton, Ontario, Canada&gt;</p><p><em>Structure of an \s-1IPTC\s0 data block</em></p><p>An \s-1IPTC/NAA\s0 resource data block of a Photoshop-style \s-1APP13\s0 segment embeds an \s-1IPTC\s0 stream conforming to the standard defined by the International Press and Telecommunications Council (\s-1IPTC\s0) and the Newspaper Association of America (\s-1NAA\s0) for exchanging interoperability information related to various news objects. The data part of a resource block, an \s-1IPTC\s0 stream, is simply a sequence of units called <em>datasets</em>; no preamble nor count is present. Each dataset consists of a unique tag header and a data field (the list of valid tags [dataset numbers] can be found in section about \s-1IPTC\s0 data). A standard tag header is used when the data field size is less than 32768 bytes; otherwise, an extended tag header is used. The datasets do not need to show up in numerical order according to their tag. The structure of a dataset is:</p><p>    [Record name]    [size]   [description]     ---------------------------------------     (Tag marker)     1 byte   this must be 0x1c     (Record number)  1 byte   always 2 for 2:xx datasets     (Dataset number) 1 byte   this is what we call a "tag"     (Size specifier) 2 bytes  data length (&lt; 32768 bytes) or length of ...     (Size specifier)  ...     data length (&gt; 32767 bytes only)     (Data)            ...     (its length is specified before)</p><p>So, standard datasets have a 5 bytes tag header; the last two bytes in the header contain the data field length, the most significant bit being always 0. For extended datasets instead, these two bytes contain the length of the (following) data field length, the most significant bit being always 1. The value of the most significant bit thus distinguishes \*(L"standard\*(R" from \*(L"extended\*(R"; in digital photographies, I assume that the datasets which are actually used (a subset of the standard) are always standard; therefore, we likely do not have the \s-1IPTC\s0 block spanning more than one \s-1APP13\s0 segment. The record types defined by the IPTC-NAA standard are the following (but the \*(L"pseudo\*(R"-standard by Adobe for \s-1APP13\s0 \s-1IPTC\s0 data is restricted to the first application record, 2:xx, and sometimes to the envelope record, 1:xx, I believe, because everything else can be accomodated more simply by other \s-1JPEG\s0 Segments):</p><p>    [Record name]                [dataset record number]     ----------------------------------------------------     Object Envelop Record                 1:xx     Application Records:             2:xx through 6:xx     Pre-ObjectData Descriptor Record:     7:xx     ObjectData Record:                    8:xx     Post-ObjectData Descriptor Record:    9:xx</p><p>The reference document for the \s-1IPTC\s0 standard is:</p><p>   B&lt;"IPTC-NAA: Information Interchange Model", version 4, 1-Jul-1999,    ComitE&lt;eacute&gt; International des TE&lt;eacute&gt;lE&lt;eacute&gt;communications de Presse&gt;</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Stefano Bettelli, <strong>bettelli@cpan.org</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2004,2005,2006 by Stefano Bettelli</p><p>This library is free software; you can redistribute it and/or modify it under the terms of the \s-1GNU\s0 General Public License. See the \s-1COPYING\s0 and \s-1LICENSE\s0 file for the license terms.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Image::MetaData::JPEG::Structures&hellip;</h2>
        <div class="sectioncontent">
<p>The main documentation page for the Image::MetaData::JPEG module.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Image::MetaData::JPEG::MakerNotes.3pm.html"><span aria-hidden="true">&larr;</span> Image::MetaData::JPEG::MakerNotes.3pm: This document contains random information and details on makernotes; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope. the note on makernote parsing in the main manual page is of particular interest.</a></li>
   <li class="next"><a href="Image::MetaData::JPEG::TagLists.3pm.html">Image::MetaData::JPEG::TagLists.3pm: This document contains a collection of tag tables for jpeg segments; it is an appendix to the main manual page of the image::metadata::jpeg module, which the reader should refer to for further details and the general scope. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
