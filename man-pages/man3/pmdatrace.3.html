<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmdatrace: Application-level performance instrumentation services</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Application-level performance instrumentation services">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmdatrace<small> (3)</small></h1>
        <p class="lead">Application-level performance instrumentation services</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmdatrace.3.html">
      <span itemprop="name">pmdatrace: Application-level performance instrumentation services</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmdatrace.3.html">
      <span itemprop="name">pmdatrace: Application-level performance instrumentation services</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;pcp/trace.h&gt;</p>
<pre>
int pmtracebegin(const char *<em>tag</em>);
int pmtraceend(const char *<em>tag</em>);
int pmtraceabort(const char *<em>tag</em>);
int pmtracepoint(const char *<em>tag</em>);
int pmtraceobs(const char *<em>tag</em>, double <em>value</em>);
int pmtracecounter(const char *<em>tag</em>, double <em>value</em>);
char *pmtraceerrstr(int <em>code</em>);
int pmtracestate(int <em>flags</em>);
</pre>
<p>cc ... -lpcp_trace</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FORTRAN SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
character*(*) <em>tag</em>
integer <em>code</em>
integer <em>flags</em>
integer <em>state</em>
character*(*) <em>estr</em>
real*8 <em>value</em>
</pre>

<pre>
<em>code</em> = pmtracebegin(<em>tag</em>)
<em>code</em> = pmtraceend(<em>tag</em>)
<em>code</em> = pmtraceabort(<em>tag</em>)
<em>code</em> = pmtracepoint(<em>tag</em>)
<em>code</em> = pmtraceobs(<em>tag</em>, <em>value</em>)
<em>code</em> = pmtracecounter(<em>tag</em>, <em>value</em>)
pmtraceerrstr(<em>code</em>, <em>estr</em>)
<em>state</em> = pmtracestate(<em>flags</em>)
</pre>

<pre>
f77 ... -lpcp_trace  or<strong>  f90 ... -lpcp_trace</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">JAVA SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>

import sgi.pcp.trace;

int trace.pmtracebegin(String <em>tag</em>);
int trace.pmtraceend(String <em>tag</em>);
int trace.pmtraceabort(String <em>tag</em>);
int trace.pmtracepoint(String <em>tag</em>);
int trace.pmtraceobs(String <em>tag</em>, double <em>value</em>);
int trace.pmtracecounter(String <em>tag</em>, double <em>value</em>);
String trace.pmtraceerrstr(int <em>code</em>);
int trace.pmtracestate(int <em>flags</em>);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <em>pcp_trace</em> library functions provide a mechanism for identifying sections of a program as transactions or events for use by the trace Performance Metrics Domain Agent (refer to <a href="../man1/pmdatrace.1.html"><strong>pmdatrace</strong>(1)</a> and <strong>PMDA</strong>(3)).</p><p>The monitoring of transactions using the Performance Co-Pilot (PCP) infrastructure is initiated through a call to <strong>pmtracebegin</strong>. Time will be recorded from the end of each <strong>pmtracebegin</strong> call to the start of the following call to <strong>pmtraceend</strong>, where the same <em>tag</em> identifier is used in both calls. Following from this, no visible recording will occur until at least one call to <strong>pmtraceend</strong> is made referencing a <em>tag</em> previously used in a call to <strong>pmtracebegin</strong>.</p><p>A transaction which is currently in progress can be cancelled by calling <strong>pmtraceabort</strong>. No transaction data gathered for that particular transaction will be exported, although data from previous and subsequent successful transactions with that <em>tag</em> name are still exported.  This is most useful when an error condition arises during transaction processing and the transaction does not run to completion.</p><p>The <em>tag</em> argument to <strong>pmtracebegin</strong>, <strong>pmtraceend</strong> and <strong>pmtraceabort</strong> is used to uniquely identify each transaction within the <em>pcp_trace</em> library and later by the trace PMDA as the instance domain identifiers for the transaction performance metrics which it exports. These routines are most useful when used around blocks of code which are likely to be executed a number of times over some relatively long time period (in a daemon process, for example).</p><p><strong>pmtracebegin</strong> has two distinct roles - firstly as the initiator of a new transaction, and secondly as a mechanism for setting a new start time. Similarly, <strong>pmtraceend</strong> is used to register a new <em>tag</em> and its initial state with the trace PMDA, or alternatively to update the statistics which the PMDA currently associates with the given <em>tag</em>.</p><p>A second form of program instrumentation can be obtained from <strong>pmtracepoint</strong>. This is a simpler form of monitoring as it exports only the number of times that a particular point in a program has been passed.  This differs to the transaction monitoring offered by <strong>pmtracebegin</strong> and <strong>pmtraceend</strong>, which exports a running count of successful transaction completions as well as statistics on the time interval between the start and end points of each transaction. This function is most useful when start and end points are not well defined. Examples of this would be when the code branches in such a way that a transaction cannot be clearly identified, or when processing does not follow a transactional model, or the desired instrumentation is akin to event rates rather than event service times.</p><p>The <strong>pmtraceobs</strong> and <strong>pmtracecounter</strong> functions have similar semantics to <strong>pmtracepoint</strong>, but also allow an arbitrary numeric <em>value</em> to be passed to the trace PMDA. The most recent <em>value</em> for each <em>tag</em> is then immediately available from the PMDA.  The only difference between <strong>pmtraceobs</strong> and <strong>pmtracecounter</strong> is that the value exported via <strong>pmtracecounter</strong> is assumed to be a monotonically increasing counter value (e.g. the number of bytes read from a socket), whereas the value exported via <strong>pmtraceobs</strong> can be any value at all.</p><p><strong>pmtracestate</strong> allows the application to set state <em>flags</em> which are honoured by subsequent calls to the <em>pcp_trace</em> library routines. There are currently two types of flag - debugging flags and the asynchronous protocol flag.  A single call may specify a number of <em>flags</em> together, combined using a (bitwise) logical OR operation, and overrides the previous state setting.</p><p>The debugging flags to <strong>pmtracestate</strong> cause <em>pcp_trace</em> to print diagnostic messages on the standard output stream at important processing points. The default protocol used between the trace PMDA and individual <em>pcp_trace</em> client applications is a synchronous protocol, which allows for dropped connections to be reestablished at a later stage should this become possible. An asynchronous protocol is also available which does not provide the reconnection capability, but which does away with much of the overhead inherent in synchronous communication. This behaviour can be toggled using the <strong>pmtracestate</strong> call, but must be called before other calls to the library.  This differs to the debugging state behaviour, which can be altered at any time. <strong>pmtracestate</strong> returns the previous state (setting prior to being called).</p><p>The following table describes each of the <strong>pmtracestate</strong> <em>flags</em> - examples of the use of these flags in each supported language are given in the demo applications (refer to the ``FILES'' section below).</p><table class="table table-striped">
<tr>
<th>State Flags</th>
<th>Semantics</th>
<th></th></tr>

<tr>
<td>0  NONE</td>
<td>Synchronous PDUs and no diagnostics (default)</td>
<td></td></tr>

<tr>
<td>1  API</td>
<td>Shows processing just below the API (debug)</td>
<td></td></tr>

<tr>
<td>2  COMMS</td>
<td>Shows network-related activity (debug)</td>
<td></td></tr>

<tr>
<td>4  PDU</td>
<td>Shows app&lt;-&gt;PMDA IPC traffic (debug)</td>
<td></td></tr>

<tr>
<td>8  PDUBUF</td>
<td>Shows internal IPC buffer management (debug)</td>
<td></td></tr>

<tr>
<td>16 NOAGENT</td>
<td>No PMDA communications at all (debug)</td>
<td></td></tr>

<tr>
<td>32 ASYNC</td>
<td>Use the asynchronous PDU protocol (control)</td>
<td></td></tr>
</table><p>Should any of the <em>pcp_trace</em> library functions return a negative value, an error has occurred.  This can be diagnosed further using the <strong>pmtraceerrstr</strong> routine, which takes the negative return value as its <em>code</em> argument, and in the C-callable interface returns a pointer to the associated error message. This points into a static error table, and should therefore not be passed to <a href="../man3/free.3.html"><strong>free</strong>(3)</a>. The Fortran-callable interface has a slightly different syntax, requiring the destination character array to be passed in as the second argument. The Java-callable interface returns a UTF-8 string, created using the JNI (Java Native Interface) routine <strong>NewStringUTF</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>The <em>pcp_trace</em> routines communicate with the trace PMDA via a socket connection, which by default uses TCP/IP port number 4323.  This can be over-ridden by setting <strong>PCP_TRACE_PORT</strong> to a different port number when the application is started.  The host where the trace PMDA is running is by default the localhost, but this can be changed using <strong>PCP_TRACE_HOST</strong>. When attempting to connect to a remote trace PMDA, after some specified time interval has elapsed, the connection attempt will be aborted and an error status will be returned.  The default timeout interval is 3 seconds, and this can be modified by setting <strong>PCP_TRACE_TIMEOUT</strong> in the environment to a real number of seconds for the desired timeout.  This is most useful in cases where the remote host is at the end of a slow network, requiring longer latencies to establish the connection correctly.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>The <em>pcp_trace</em> Java class interface has been developed and verified using version 1.1 of the Java Native Interface (JNI) specification.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>$PCP_DEMOS_DIR/trace/*.c</strong></p>
  </dt>
  <dd>
    <p>Sample C programs and source for <a href="../man1/pmtrace.1.html"><strong>pmtrace</strong>(1)</a>. Use <strong>make</strong>(1) to build these programs.</p>
  </dd>
  <dt>
    <p><strong>$PCP_DEMOS_DIR/trace/fapp1.f</strong></p>
  </dt>
  <dd>
    <p>Sample Fortran program. Call `make fortran77' or `make fortran90' to build this program.</p>
  </dd>
  <dt>
    <p><strong>$PCP_DEMOS_DIR/trace/japp1.java</strong></p>
  </dt>
  <dd>
    <p>Sample Java program. `make java' builds the java class file.</p>
  </dd>
  <dt>
    <p><strong>/usr/java/classes/sgi/pcp/trace.java</strong></p>
  </dt>
  <dd>
    <p>Java trace class definition.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a>. Values for these variables may be obtained programmatically using the <strong>pmGetConfig</strong>(3) function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmdatrace&hellip;</h2>
        <div class="sectioncontent">
<p><strong>file:$PCP_DOC_DIR/Tutorial/trace.html,</strong> <strong>pcp.man.tutorial,</strong> Provided the, <strong>make</strong>(1), <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>, <a href="../man1/pmdatrace.1.html"><strong>pmdatrace</strong>(1)</a>, <a href="../man1/pmprobe.1.html"><strong>pmprobe</strong>(1)</a>, <a href="../man1/pmtrace.1.html"><strong>pmtrace</strong>(1)</a>, Relevant information is also available from the on-line PCP Tutorial, subsystem from the PCP images has been installed, access the URL and from your web browser.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>A negative return value from a <em>pcp_trace</em> function indicates that an error has occurred - if this is the case, the return value can be passed to <strong>pmtraceerrstr</strong> to obtain the associated error message.</p><p>Success is indicated by a return value of zero.</p><p><strong>pmtracestate</strong> also returns an integer representing the state <em>flags</em> which were set prior to the call.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEAT</h2>
        <div class="sectioncontent">
<p>Applications that use <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a> should exercise caution because the static fields in <em>struct hostent</em> may not be preserved across some <em>pcp_trace</em> calls. In particular, <strong>pmtracebegin</strong>, <strong>pmtraceend</strong>, <strong>pmtracepoint</strong>, <strong>pmtracecounter</strong>, and <strong>pmtraceobs</strong> may all call <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a> internally.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmdatext.3.html"><span aria-hidden="true">&larr;</span> pmdatext.3: Extract metric help text for a pmda</a></li>
   <li class="next"><a href="pmdelprofile.3.html">pmdelprofile.3: Delete instance(s) from the current pmapi instance profile <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
