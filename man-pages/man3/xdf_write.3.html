<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>xdf_write: Write samples to a xdf file</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Write samples to a xdf file">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="xdf_write (3) manual">
  <meta name="twitter:description" content="Write samples to a xdf file">
  <meta name="twitter:image" content="https://www.carta.tech/images/libxdffileio-dev-xdf_write-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/xdf_write.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="xdf_write (3) manual" />
  <meta property="og:description" content="Write samples to a xdf file" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libxdffileio-dev-xdf_write-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">xdf_write<small> (3)</small></h1>
        <p class="lead">Write samples to a xdf file</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/xdf_write.3.html">
      <span itemprop="name">xdf_write: Write samples to a xdf file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libxdffileio-dev/">
      <span itemprop="name">libxdffileio-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/xdf_write.3.html">
      <span itemprop="name">xdf_write: Write samples to a xdf file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;xdfio.h&gt;</strong></p><p><strong>ssize_t xdf_write(struct xdf* </strong><em>xdf</em><strong>, size_t </strong><em>ns</em><strong>, ...);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>xdf_write</strong>() writes <em>ns</em> samples to the xDF file referenced by <em>xdf</em>. This file should have been opened with mode <strong>XDF_WRITE</strong> and <strong>xdf_prepare_arrays</strong>(3) should have been successfully called on it. <strong>xdf_write</strong>() will fail otherwise).</p><p>The data to be added should be contained in arrays specified by pointers provided in the variable list of arguments of the function.  The function expects the same number of arrays as specified by previous call to <a href="../man3/xdf_define_arrays.3.html"><strong>xdf_define_arrays</strong>(3)</a>. The internal organisation of the data in the arrays should have been specified previously with calls to <a href="../man3/xdf_set_chconf.3.html"><strong>xdf_set_chconf</strong>(3)</a>.</p><p>In addition, it is important to note that none of the arrays should overlap.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>The function returns the number of the samples successfully added to the xDF file in case of success. Otherwise -1 is returned and <em>errno</em> is set appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>EINVAL</strong></p>
  </dt>
  <dd>
    <p><em>xdf</em> is NULL</p>
  </dd>
  <dt>
    <p><strong>EPERM</strong></p>
  </dt>
  <dd>
    <p>No successfull call to <a href="../man3/xdf_prepare_transfer.3.html"><strong>xdf_prepare_transfer</strong>(3)</a> have been done on <em>xdf</em> or it has been opened using the mode <strong>XDF_READ</strong>.</p>
  </dd>
  <dt>
    <p><strong>EFBIG</strong></p>
  </dt>
  <dd>
    <p>An attempt was made to write a file that exceeds the implementation-defined maximum file size or the process's file size limit, or to write at a position past the maximum allowed offset.</p>
  </dd>
  <dt>
    <p><strong>EINTR</strong></p>
  </dt>
  <dd>
    <p>The call was interrupted by a signal before any data was written; see <a href="../man7/signal.7.html"><strong>signal</strong>(7)</a>.</p>
  </dd>
  <dt>
    <p><strong>EIO</strong></p>
  </dt>
  <dd>
    <p>A low-level I/O error occurred while modifying the inode.</p>
  </dd>
  <dt>
    <p><strong>ENOSPC</strong></p>
  </dt>
  <dd>
    <p>The device containing the xDF file has no room for the data.</p>
  </dd>
  <dt>
    <p><strong>ESTALE</strong></p>
  </dt>
  <dd>
    <p>Stale file handle. This error can occur for NFS and for other file systems</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PERFORMANCE CONSIDERATION</h2>
        <div class="sectioncontent">
<p>By design of the library, a call to <strong>xdf_write</strong>() is "almost" ensured to be executed in a linear time, i.e. given a fixed configuration of an xDF file, for the same number of samples to be passed, a call <strong>xdf_write</strong> will almost take always the same time to complete. This time increases linearly with the number of samples. This insurance is particularly useful for realtime processing of data, since storing the data will impact the main loop in a predictible way.</p><p>This is achieved by double buffering the data for writing. A front and a back buffer are available: the front buffer is filled with the incoming data, and swapped with the back buffer when full. This swap signals a background thread to convert, reorganise, scale and save to the disk the data contained in the full buffer making it afterwards available for the next swap.</p><p>This approach ensures a linear calltime of <strong>xdf_write</strong>() <em>providing</em> that I/O subsystem is not saturated neither all processing units (cores or processors), i.e. the application is neither I/O bound nor CPU bound.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DATA SAFETY</h2>
        <div class="sectioncontent">
<p>The library makes sure that data written to xDF files are safely stored on stable storage on a regular basis but because of double buffering, there is a risk to loose data in case of problem. However, the design of the <strong>xdf_write</strong>() <em>ensures</em> that if a problem occurs (no more disk space, power supply cut), <em>at most</em> two records of data plus the size of the chunks of data supplied to the function will be lost.</p><p>As an example, assuming you record a xDF file at 256Hz using records of 256 samples and you feed <strong>xdf_write</strong>() with chunks of 8 samples, you are ensured to receive notification of failure after at most 520 samples corresponding to a lose of at most a little more than 2s of data in case of problems.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
<strong></strong>
/* Assume xdf references a xDF file opened for writing whose
channels source their data in 2 arrays of float whose strides
are the length of respectively 4 and 6 float values,
i.e. 16 and 24 bytes (in most platforms)*/
#define NS    3
float array1[NS][4], array2[NS][6];
unsigned int strides = {4*sizeof(float), 6*sizeof(float)};
unsigned int i;

xdf_define_arrays(xdf, 2, strides);
if (xdf_prepare_transfer(xdf))
	return 1;

for (i=0; i&lt;45; i+=NS) {
	/* Update the values contained in array1 and array2*/
	...

	/* Write the values to the file */
        if (xdf_write(xdf, NS, array1, array2))
		return 1;
}

xdf_close(xdf);

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO xdf_write&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/xdf_set_chconf.3.html"><strong>xdf_set_chconf</strong>(3)</a>, <a href="../man3/xdf_define_arrays.3.html"><strong>xdf_define_arrays</strong>(3)</a>, <a href="../man3/xdf_prepare_transfer.3.html"><strong>xdf_prepare_transfer</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="xdf_set_conf.3.html"><span aria-hidden="true">&larr;</span> xdf_set_conf.3: Set or get the configuration of xdf file</a></li>
   <li class="next"><a href="xdr.3.html">xdr.3: Library routines for external data representation <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
