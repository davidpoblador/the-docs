<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pcreprecompile: Perl-compatible regular expressions</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Perl-compatible regular expressions">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pcreprecompile (3) manual">
  <meta name="twitter:description" content="Perl-compatible regular expressions">
  <meta name="twitter:image" content="https://www.carta.tech/images/mariadb-pcreprecompile-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/pcreprecompile.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pcreprecompile (3) manual" />
  <meta property="og:description" content="Perl-compatible regular expressions" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mariadb-pcreprecompile-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pcreprecompile<small> (3)</small></h1>
        <p class="lead">Perl-compatible regular expressions</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pcreprecompile.3.html">
      <span itemprop="name">pcreprecompile: Perl-compatible regular expressions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mariadb/">
      <span itemprop="name">mariadb</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pcreprecompile.3.html">
      <span itemprop="name">pcreprecompile: Perl-compatible regular expressions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SAVING AND RE-USING PRECOMPILED PCRE PATTERNS</h2>
        <div class="sectioncontent">
<p>If you are running an application that uses a large number of regular expression patterns, it may be useful to store them in a precompiled form instead of having to compile them every time the application is run. If you are not using any private character tables (see the <strong>pcre_maketables()</strong> documentation), this is relatively straightforward. If you are using private tables, it is a little bit more complicated. However, if you are using the just-in-time optimization feature, it is not possible to save and reload the JIT data.</p><p>If you save compiled patterns to a file, you can copy them to a different host and run them there. If the two hosts have different endianness (byte order), you should run the <strong>pcre[16|32]_pattern_to_host_byte_order()</strong> function on the new host before trying to match the pattern. The matching functions return PCRE_ERROR_BADENDIANNESS if they detect a pattern with the wrong endianness.</p><p>Compiling regular expressions with one version of PCRE for use with a different version is not guaranteed to work and may cause crashes, and saving and restoring a compiled pattern loses any JIT optimization data.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SAVING A COMPILED PATTERN</h2>
        <div class="sectioncontent">
<p>The value returned by <strong>pcre[16|32]_compile()</strong> points to a single block of memory that holds the compiled pattern and associated data. You can find the length of this block in bytes by calling <strong>pcre[16|32]_fullinfo()</strong> with an argument of PCRE_INFO_SIZE. You can then save the data in any appropriate manner. Here is sample code for the 8-bit library that compiles a pattern and writes it to a file. It assumes that the variable <em>fd</em> refers to a file that is open for output:</p>
<pre>
  int erroroffset, rc, size;
  char *error;
  pcre *re;
</pre>

<pre>
  re = pcre_compile("my pattern", 0, &error, &erroroffset, NULL);
  if (re == NULL) { ... handle errors ... }
  rc = pcre_fullinfo(re, NULL, PCRE_INFO_SIZE, &size);
  if (rc &lt; 0) { ... handle errors ... }
  rc = fwrite(re, 1, size, fd);
  if (rc != size) { ... handle errors ... }
</pre>
<p>In this example, the bytes that comprise the compiled pattern are copied exactly. Note that this is binary data that may contain any of the 256 possible byte values. On systems that make a distinction between binary and non-binary data, be sure that the file is opened for binary output.</p><p>If you want to write more than one pattern to a file, you will have to devise a way of separating them. For binary data, preceding each pattern with its length is probably the most straightforward approach. Another possibility is to write out the data in hexadecimal instead of binary, one pattern to a line.</p><p>Saving compiled patterns in a file is only one possible way of storing them for later use. They could equally well be saved in a database, or in the memory of some daemon process that passes them via sockets to the processes that want them.</p><p>If the pattern has been studied, it is also possible to save the normal study data in a similar way to the compiled pattern itself. However, if the PCRE_STUDY_JIT_COMPILE was used, the just-in-time data that is created cannot be saved because it is too dependent on the current environment. When studying generates additional information, <strong>pcre[16|32]_study()</strong> returns a pointer to a <strong>pcre[16|32]_extra</strong> data block. Its format is defined in the section on matching a pattern in the <strong>pcreapi</strong> documentation. The <em>study_data</em> field points to the binary study data, and this is what you must save (not the <strong>pcre[16|32]_extra</strong> block itself). The length of the study data can be obtained by calling <strong>pcre[16|32]_fullinfo()</strong> with an argument of PCRE_INFO_STUDYSIZE. Remember to check that <strong>pcre[16|32]_study()</strong> did return a non-NULL value before trying to save the study data.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RE-USING A PRECOMPILED PATTERN</h2>
        <div class="sectioncontent">
<p>Re-using a precompiled pattern is straightforward. Having reloaded it into main memory, called <strong>pcre[16|32]_pattern_to_host_byte_order()</strong> if necessary, you pass its pointer to <strong>pcre[16|32]_exec()</strong> or <strong>pcre[16|32]_dfa_exec()</strong> in the usual way.</p><p>However, if you passed a pointer to custom character tables when the pattern was compiled (the <em>tableptr</em> argument of <strong>pcre[16|32]_compile()</strong>), you must now pass a similar pointer to <strong>pcre[16|32]_exec()</strong> or <strong>pcre[16|32]_dfa_exec()</strong>, because the value saved with the compiled pattern will obviously be nonsense. A field in a <strong>pcre[16|32]_extra()</strong> block is used to pass this data, as described in the section on matching a pattern in the <strong>pcreapi</strong> documentation.</p><p><strong>Warning:</strong> The tables that <strong>pcre_exec()</strong> and <strong>pcre_dfa_exec()</strong> use must be the same as those that were used when the pattern was compiled. If this is not the case, the behaviour is undefined.</p><p>If you did not provide custom character tables when the pattern was compiled, the pointer in the compiled pattern is NULL, which causes the matching functions to use PCRE's internal tables. Thus, you do not need to take any special action at run time in this case.</p><p>If you saved study data with the compiled pattern, you need to create your own <strong>pcre[16|32]_extra</strong> data block and set the <em>study_data</em> field to point to the reloaded study data. You must also set the PCRE_EXTRA_STUDY_DATA bit in the <em>flags</em> field to indicate that study data is present. Then pass the <strong>pcre[16|32]_extra</strong> block to the matching function in the usual way. If the pattern was studied for just-in-time optimization, that data cannot be saved, and so is lost by a save/restore cycle.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPATIBILITY WITH DIFFERENT PCRE RELEASES</h2>
        <div class="sectioncontent">
<p>In general, it is safest to recompile all saved patterns when you update to a new PCRE release, though not all updates actually require this.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<pre>
Philip Hazel
University Computing Service
Cambridge CB2 3QH, England.
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REVISION</h2>
        <div class="sectioncontent">

<pre>
Last updated: 12 November 2013
Copyright (c) 1997-2013 University of Cambridge.
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pcreposix.3.html"><span aria-hidden="true">&larr;</span> pcreposix.3: Perl-compatible regular expressions.</a></li>
   <li class="next"><a href="pcresample.3.html">pcresample.3: Perl-compatible regular expressions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
