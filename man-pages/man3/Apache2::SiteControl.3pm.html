<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Apache2::SiteControl: Perl web site authentication/authorization system</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Perl web site authentication/authorization system">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Apache2::SiteControl (3pm) manual">
  <meta name="twitter:description" content="Perl web site authentication/authorization system">
  <meta name="twitter:image" content="https://www.carta.tech/images/libapache2-sitecontrol-perl-Apache2::SiteControl-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Apache2::SiteControl.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Apache2::SiteControl (3pm) manual" />
  <meta property="og:description" content="Perl web site authentication/authorization system" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libapache2-sitecontrol-perl-Apache2::SiteControl-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Apache2::SiteControl<small> (3pm)</small></h1>
        <p class="lead">Perl web site authentication/authorization system</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache2::SiteControl.3pm.html">
      <span itemprop="name">Apache2::SiteControl: Perl web site authentication/authorization system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libapache2-sitecontrol-perl/">
      <span itemprop="name">libapache2-sitecontrol-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache2::SiteControl.3pm.html">
      <span itemprop="name">Apache2::SiteControl: Perl web site authentication/authorization system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>See samples/site for complete example. Note, this module is intended for mod_perl. See Apache2::SiteControl for mod_perl2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Apache2::SiteControl is a set of perl object-oriented classes that implement a fine-grained security control system for a web-based application. The intent is to provide a clear, easy-to-integrate system that does not require the policies to be written into your application components. It attempts to separate the concerns of how to show and manipulate data from the concerns of who is allowed to view and manipulate data and why.</p><p>For example, say your web application is written in HTML::Mason. Your individual \*(L"screens\*(R" are composed of Mason modules, and you would like to keep those as clean as possible, but decisions have to be made about what to allow as the component is processed. SiteControl attempts to make that as easy as possible.</p><h3>\s-1DEVELOPER\s0'S \s-1VIEWPOINT\s0 - \s-1EXAMPLE\s0</h3>
<p>In this document we use HTML::Mason to create examples of how to use the control mechanisms, but any mod_perl based system should be supportable.</p><p>A good mason component tries to do most of the perl processing in a separate block, so that simple substitutions can be made in \s-1HTML\s0 in the rest of the page. This makes it much easier for web developers and perl developers to co-exist on a project.</p><p>The SiteControl system tries to make it possible to continue to follow this model. You obtain a user object and permission manager from the SiteControl system. These are intended to be opaque data types to the page designer, and are defined elsewhere (see \s-1USERS\s0). The actual web page component should carry these objects around without implementing anything in the way of policy.</p><p>For example, your mason component might look like this:</p>
<pre>
   &lt;HTML&gt;
      &lt;HEAD&gt; ... &lt;/HEAD&gt;
   % if($manager-&gt;can($currentUser, "edit", $table)) {
         &lt;FORM METHOD=POST ACTION="..."&gt;
            &lt;P&gt;&lt;INPUT TYPE=TEXT NAME="x" VALUE="&lt;% $table-&gt;{x} %&gt;"&gt;
            ...
         &lt;/FORM&gt;
   % } else {
         &lt;P&gt;x is &lt;% $table-&gt;{x} %&gt;
   % }

   &lt;%init&gt;
   my $currentUser = Apache2::SiteControl-&gt;getCurrentUser($r);
   my $manager = Apache2::SiteControl-&gt;getPermissionManager($r);

   ... application specific stuff...
   i.e.

   my $table = ...
   &lt;/%init&gt;
</pre>
<p>Notice that the component does not bother looking at the user object, and there is no policy code...just a request for permission:</p><p>   if($manager-&gt;can($currentUser, "do something to", $resource))</p><p>Of course the developer needs to know <em>something</em> about the underlying system. For example, the action string \*(L"do something to\*(R" is rather arbitrary. These can be anything, and must be specified as rule actions. It is recommended that you use some form of Perl constants for these instead of strings, but that is up to you.</p><p>The resource is intended to be less opaque. This is likely the object that the page developer wants to muck with, and so probably knows the internals of that object a bit better. This is the crossover point from what SiteControl can figure out on its own to information you have to supply.</p><p>The default behavior is for the manager to deny any request.  In order for a request to be approved, someone has to write a rule that joins together the user, action, and resource and makes a decision about the permissibility of the action.</p><p>If all you want is login and user tracking (but no permission manager), then it is safe to ignore the permission manager altogether.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USERS</h2>
        <div class="sectioncontent">
<p>Users and Rules are the central components of the SiteControl system. The user object must be Apache2::SiteControl::User (or a subclass). See Apache2::SiteControl::User for a description of what it supports (session storage, logout, etc.).  The glue to SiteControl is the UserFactory, which you can define or accept the default of Apache2::SiteControl::UserFactory (recommended).</p><p>Whenever a login attempt succeeds, the factory returns an object that represents a valid, logged-in user. See Apache2::SiteControl::UserFactory for more information.</p><h3>\s-1PERMISSION\s0 \s-1MANAGER\s0</h3>
<p>Each site will have a permission manager. There is usually no need for you to subclass Apache2::SiteControl::PermissionManager, but you do need to create one and populate it with your access rules. You do this by creating a factory class, which looks something like this:</p><p>   package samples::site::MyPermissionFactory;</p><p>   use Apache2::SiteControl::PermissionManager;    use Apache2::SiteControl::GrantAllRule;    use samples::site::EditControlRule;</p><p>   use base qw(Apache2::SiteControl::ManagerFactory);</p><p>   our $manager;</p><p>   sub getPermissionManager    {       return $manager if defined($manager);</p><p>      $manager = new Apache2::SiteControl::PermissionManager;       $manager-&gt;addRule(new Apache2::SiteControl::GrantAllRule);       $manager-&gt;addRule(new samples::site::EditControlRule);</p><p>      return $manager;    }</p><p>   1;</p><p>The primary goal of your factory is to produce an instance of a permission manager that knows the rules for permitting access to your site. This is an easy process that involves calling the constructor (via new) and then calling addRule one or more times.</p>
<h3>\s-1RULES\s0</h3>
<p>The PermissionManager is the object that the site developers ask about what is allowed and what is not. As you saw in the previous section, you create a manager, and add some rules.</p><p>Each rule is a custom-written class that implements some aspect of your site's access logic. Rules can choose to grant or deny a request. The following is a pretty complex example that demonstrates the features of a rule.</p><p>Most rules with either specifically grant permission, or deny it. Most will not deal with both possibilities. In this example we are assuming that the user is implemented as an object that has attributes which can be retrieved with a getAttribute method (of course, you would have to have implemented that as well). The basic action that this rule handles is called \*(L"beat up\*(R", so the site makes calls like:</p><p>   if($referee-&gt;can($userA, "beat up", $userB)) { ... }</p><p>In terms of English, we would describe the rule \*(L"If A is taller than B, then we say that A can beat up B. If A is less skilled than B, then we say that A cannot beat up B\*(R".  The rule looks like this:</p><p>   package samples::FightRules;</p><p>   use strict;    use warnings;    use Carp;    use Apache2::SiteControl::Rule;</p><p>   use base qw(Apache2::SiteControl::Rule);</p><p>   sub grants($$$$)    {       my $this = shift;       my $user = shift;       my $action = shift;       my $resource = shift;</p><p>      if($action eq "beat up" && $resource-&gt;isa("Apache2::SiteControl::User")) {          my ($h1, $h2);          $h1 = $user-&gt;getAttribute("height");          $h2 = $resource-&gt;getAttribute("height");          return 1 if(defined($h1) && defined($h2) && $h1 &gt; $h2);       }</p><p>      return 0;    }</p><p>   sub denies($$$$)    {       my $this = shift;       my $user = shift;       my $action = shift;       my $resource = shift;</p><p>      if($action eq "beat up" && $resource-&gt;isa("Apache2::SiteControl::User")) {          my ($s1, $s2);          $s1 = $user-&gt;getAttribute("skill");          $s2 = $resource-&gt;getAttribute("skill");          return 1 if(defined($s1) && defined($s2) && $s1 &lt; $s2);       }</p><p>      return 0;    }</p><p>   1;</p><p>The PermissionManager will only give permission if <em>at least</em> one rule grants permission, <em>and</em> no rule denies it.</p><p>I think it is clearer to separate rules like the previous one into separate rule classes altogether. A HeightMakesMightRule and a DefenseSkillRule. Splitting into two rules makes things clearer, and there is no limit to the number of rules that the PermissionManager can check.</p><p>It is important that your rules never grant or deny a request they do not understand, so it is a good idea to use type checking to prevent strangeness. <strong>Assertions should not be used</strong> if you expect different rules to accept different resource types or user types, since each rule is used on every access request.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPORT</h2>
        <div class="sectioncontent">
<p>None by default.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Apache2::SiteControl&hellip;</h2>
        <div class="sectioncontent">
<p>Apache2::SiteControl::UserFactory, Apache::SiteControl::ManagerFactory, Apache2::SiteControl::PermissionManager, Apache::SiteControl::Rule</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This module was written by Tony Kay, &lt;tkay@uoregon.edu&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>This modules is covered by the \s-1GNU\s0 public license.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Apache2::AuthCASSimple.3pm.html"><span aria-hidden="true">&larr;</span> Apache2::AuthCASSimple.3pm: Apache2 module to authentificate through a cas server</a></li>
   <li class="next"><a href="Apache2::SiteControl::GrantAllRule.3pm.html">Apache2::SiteControl::GrantAllRule.3pm: A rule that grants permission to do everything. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
