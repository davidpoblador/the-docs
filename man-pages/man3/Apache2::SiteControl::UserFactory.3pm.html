<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Apache2::SiteControl::UserFactory: User factory/persistence</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="User factory/persistence">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Apache2::SiteControl::UserFactory (3pm) manual">
  <meta name="twitter:description" content="User factory/persistence">
  <meta name="twitter:image" content="https://www.carta.tech/images/libapache2-sitecontrol-perl-Apache2::SiteControl::UserFactory-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Apache2::SiteControl::UserFactory.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Apache2::SiteControl::UserFactory (3pm) manual" />
  <meta property="og:description" content="User factory/persistence" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libapache2-sitecontrol-perl-Apache2::SiteControl::UserFactory-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Apache2::SiteControl::UserFactory<small> (3pm)</small></h1>
        <p class="lead">User factory/persistence</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache2::SiteControl::UserFactory.3pm.html">
      <span itemprop="name">Apache2::SiteControl::UserFactory: User factory/persistence</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libapache2-sitecontrol-perl/">
      <span itemprop="name">libapache2-sitecontrol-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache2::SiteControl::UserFactory.3pm.html">
      <span itemprop="name">Apache2::SiteControl::UserFactory: User factory/persistence</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This class is responsible for creating user objects (see Apache2::SiteControl::User) and managing the interfacing of those objects with a persistent session store.  The default implementation uses Apache::Session::File to store the various attributes of the user to disk.</p><p>If you want to do your own user management, then you should leave the User class alone, and subclass only this factory. The following methods are required:</p>
<dl class='dl-vertical'>
  <dt>
    makeUser($$)
  </dt>
  <dd>
    <p>This method is called with the Apache Request object, username, password, and all other credential_# fields from the login form.  It must create and return an instance of Apache2::SiteControl::User (using new...See User), and store that information (along with the session key stored in cookie format in the request) in some sort of permanent storage.  This method is called in response to a login, so it should invalidate any existing session for the given user name (so that a user can be logged in only once).  This method must return the key to use as the browser session key, or undef if it could not create the user.</p>
  </dd>
  <dt>
    findUser($$)
  </dt>
  <dd>
    <p>This method is passed the apache request and the session key (which you defined in makeUser).  This method is called every time a \*(L"logged in\*(R" user makes a request. In other words the user objects are not persistent in memory (each request gets a new \*(L"copy\*(R" of the state). This method uses the session key (which was stored in a browser cookie) to figure out what user to restore. The implementation is required to look up the user by the session key, recreate a Apache2::SiteControl::User object and return it. It must restore all user attributes that have been saved via saveAttribute (below).</p>
  </dd>
  <dt>
    invalidate($$)
  </dt>
  <dd>
    <p>This method is passed the apache request object and a previously created user object. It should delete the user object from permanent store so that future request to find that user fails unless makeUser has been called to recreate it. The session \s-1ID\s0 (which you made up in makeUser) is available from $user-&gt;{sessionid}.</p>
  </dd>
  <dt>
    saveAttribute($$$)
  </dt>
  <dd>
    <p>This method is automatically called whenever a user has a new attribute value. The incoming arguments are the apache request, the user object, and the name of the attribute to save (you can read it with $user-&gt;getAttribute($name)). This method must save the attribute in a such a way that later calls to findUser will be able to restore the attribute to the user object that is created. The session id you created for this user (in makeUser) is available in $user-&gt;{sessionid}.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Apache Config Directives</h2>
        <div class="sectioncontent">
<p>The following is a list of configuration variables that can be set with apache's PerlSetVar to configure the behavior of this class:</p>
<dl class='dl-vertical'>
  <dt>
    SiteControlDebug  (default 0):
  </dt>
  <dd>
    <p>Debug mode</p>
  </dd>
  <dt>
    SiteControlLocks  (default /tmp):
  </dt>
  <dd>
    <p>Where the locks are stored</p>
  </dd>
  <dt>
    SiteControlSessions (default /tmp):
  </dt>
  <dd>
    <p>Where the session data is stored</p>
  </dd>
  <dt>
    SiteControlUsermap (default none):
  </dt>
  <dd>
    <p>Where the usernames are mapped to session files. Required if you want multiple session detection. If unset a single userid can be used to log in multiple times simultaneously.</p>
  </dd>
  <dt>
    SiteControlUserFactory (default: Apache2::SiteControl::UserFactory)
  </dt>
  <dd>
    <p>An implementation like this module.</p>
  </dd>
  <dt>
    UserObjectSaveOtherCredentials (default: 0)
  </dt>
  <dd>
    <p>Indicates that other form data from the login screen (credential_2, credential_3, etc.) should be saved in the session data. The keys will be credential_2, etc.  name of the user factory to use when making user objects. These are useful if your web application has other login choices (i.e. service, database, etc.) that you need to know about at login.</p>
  </dd>
  <dt>
    UserObjectSavePassword (default 0)
  </dt>
  <dd>
    <p>Indicates that the password should be saved in the local session data, so that it is available to other parts of the web app (and not just the auth system). This might be necessary if you are logging the user in and out of services on the back end (like in webmail and database apps).</p>
  </dd>
  <dt>
    UserObjectPasswordCipher (default \s-1CAST5\s0)
  </dt>
  <dd>
    <p>The \s-1CBC\s0 cipher used for encrypting the user passwords in the session files (See Crypt::CBC for info on allowed ciphers...this value is passed directly to Crypt::CBC-&gt;new). If you are saving user passwords, they will be encrypted when stored in the apache session files. This gives a little bit of added security, and makes the apache config the only sensitive file (since that is where you configure the key itself) instead of every random session file that is laying around on disk. There is a global variable in this package called $encryption_key, which will be used if this variable is not set. The suggested method is to set the encryption key during server startup using a random value (i.e. from /dev/random), so that all server forks will inherit the value.</p>
  </dd>
  <dt>
    UserObjectPasswordKey
  </dt>
  <dd>
    <p>The key to use for encryption of the passwords in the session files. See UserObjectPasswordCipher above.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Apache2::SiteControl::UserFactory&hellip;</h2>
        <div class="sectioncontent">
<p>Apache2::SiteControl::User, Apache::SiteControl::PermissionManager, Apache2::SiteControl::Rule, Apache::SiteControl</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This module was written by Tony Kay, &lt;tkay@uoregon.edu&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Apache2::SiteControl is covered by the \s-1GPL\s0.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Apache2::SiteControl::User.3pm.html"><span aria-hidden="true">&larr;</span> Apache2::SiteControl::User.3pm: User representations</a></li>
   <li class="next"><a href="Apache::ASP.3pm.html">Apache::ASP.3pm:  <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
