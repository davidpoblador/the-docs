<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tie::EncryptedHash: Hashes (and objects based on hashes) with encrypting fields.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Hashes (and objects based on hashes) with encrypting fields.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Tie::EncryptedHash (3pm) manual">
  <meta name="twitter:description" content="Hashes (and objects based on hashes) with encrypting fields.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtie-encryptedhash-perl-Tie::EncryptedHash-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Tie::EncryptedHash.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tie::EncryptedHash (3pm) manual" />
  <meta property="og:description" content="Hashes (and objects based on hashes) with encrypting fields." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtie-encryptedhash-perl-Tie::EncryptedHash-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Tie::EncryptedHash<small> (3pm)</small></h1>
        <p class="lead">Hashes (and objects based on hashes) with encrypting fields.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tie::EncryptedHash.3pm.html">
      <span itemprop="name">Tie::EncryptedHash: Hashes (and objects based on hashes) with encrypting fields.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtie-encryptedhash-perl/">
      <span itemprop="name">libtie-encryptedhash-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tie::EncryptedHash.3pm.html">
      <span itemprop="name">Tie::EncryptedHash: Hashes (and objects based on hashes) with encrypting fields.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    use Tie::EncryptedHash;

    my %s = ();
    tie %s, Tie::EncryptedHash, &apos;passwd&apos;;

    $s{foo}  = "plaintext";     # Normal field, stored in plaintext.
    print $s{foo};              # (plaintext)

    $s{_bar} = "signature";     # Fieldnames that begin in single
                                # underscore are encrypted.
    print $s{_bar};             # (signature)  Though, while the password
                                # is set, they behave like normal fields.
    delete $s{_\|_password};      # Delete password to disable access
                                # to encrypting fields.
    print $s{_bar};             # (Blowfish NuRVFIr8UCAJu5AWY0w...)

    $s{_\|_password} = &apos;passwd&apos;;  # Restore password to gain access.
    print $s{_bar};             # (signature)

    $s{_baz}{a}{b} = 42;        # Refs are fine, we encrypt them too.
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Tie::EncryptedHash augments Perl hash semantics to build secure, encrypting containers of data.  Tie::EncryptedHash introduces special hash fields that are coupled with encrypt/decrypt routines to encrypt assignments at \s-1<em>STORE\s0()</em> and decrypt retrievals at \s-1<em>FETCH\s0()</em>.  By design, <em>encrypting fields</em> are associated with keys that begin in single underscore.  The remaining keyspace is used for accessing normal hash fields, which are retained without modification.</p><p>While the password is set, a Tie::EncryptedHash behaves exactly like a standard Perl hash.  This is its <em>transparent mode</em> of access.  Encrypting and normal fields are identical in this mode.  When password is deleted, encrypting fields are accessible only as ciphertext.  This is Tie::EncryptedHash's <em>opaque mode</em> of access, optimized for serialization.</p><p>Encryption is done with <em>Crypt::CBC</em>\|(3) which encrypts in the cipher block chaining mode with Blowfish, \s-1DES\s0 or \s-1IDEA\s0.  Tie::EncryptedHash uses Blowfish by default, but can be instructed to employ any cipher supported by <em>Crypt::CBC</em>\|(3).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MOTIVATION</h2>
        <div class="sectioncontent">
<p>Tie::EncryptedHash was designed for storage and communication of key material used in public key cryptography algorithms.  I abstracted out the mechanism for encrypting selected fields of a structured data record because of the sheer convenience of this data security method.</p><p>Quite often, applications that require data confidentiality eschew strong cryptography in favor of OS-based access control mechanisms because of the additional costs of cryptography integration.  Besides cipher implementations, which are available as ready-to-deploy perl modules, use of cryptography in an application requires code to aid conversion and representation of encrypted data.  This code is usually encapsulated in a data access layer that manages encryption, decryption, access control and re-structuring of flat plaintext according to a data model. Tie::EncryptedHash provides these functions under the disguise of a Perl hash so perl applications can use strong cryptography without the cost of implementing a complex data access layer.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTION</h2>
        <div class="sectioncontent">
<h3>Tied Hash</h3>
<p>\*(C`tie %h, Tie::EncryptedHash, &apos;Password&apos;, &apos;Cipher&apos;;\*(C'</p><p>Ties %h to Tie::EncryptedHash and sets the value of password and cipher to 'Password' and 'Cipher'.  Both arguments are optional.</p>
<h3>Blessed Object</h3>
<p>\*(C`$h = new Tie::EncryptedHash _\|_password =\*(C' 'Password',</p>
<pre>
                         _\|_cipher =&gt; 'Cipher';&gt;
</pre>
<p>The <em>new()</em> constructor returns an object that is both tied and blessed into Tie::EncryptedHash.  Both arguments are optional.  When used in this manner, Tie::EncryptedHash behaves like a class with encrypting data members.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RESERVED ATTRIBUTES</h2>
        <div class="sectioncontent">
<p>The attributes _\|_password, _\|_cipher and _\|_hide are reserved for communication with object methods.  They are \*(L"write-only\*(R" from everywhere except the class to which the hash is tied.  _\|_scaffolding is inaccessible. Tie::EncryptedHash stores the current encryption password and some transient data structures in these fields and restricts access to them on need-to-know basis.</p><h3>_\|_password</h3>
<p>\*(C`$h{_\|_password} = "new password"; delete $h{_\|_password};\*(C'</p><p>The password is stored under the attribute \*(C`_\|_password\*(C'.  In addition to specifying a password at construction, assigning to the _\|_password attribute sets the current encryption password to the assigned value.  Deleting the _\|_password unsets it and switches the hash into opaque mode.</p>
<h3>_\|_cipher</h3>
<p>\*(C`$h{_\|_cipher} = &apos;DES&apos;; $h{_\|_cipher} = &apos;Blowfish&apos;;\*(C'</p><p>The cipher used for encryption/decryption is stored under the attribute _\|_cipher.  The value defaults to 'Blowfish'.</p>
<h3>_\|_hide</h3>
<p>\*(C`$h{_\|_hide} = 1;\*(C'</p><p>Setting this attribute <em>hides</em> encrypting fields in opaque mode.  'undef' is returned at \s-1<em>FETCH\s0()</em> and \s-1<em>EXISTS\s0()</em>.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BEHAVIOR</h2>
        <div class="sectioncontent">
<h3>References</h3>
<p>A reference stored in an encrypting field is serialized before encryption. The data structure represented by the reference is folded into a single line of ciphertext which is stored under the first level key.  In the opaque mode, therefore, only the first level of keys of the hash will be visible.</p>
<h3>Opaque Mode</h3>
<p>The opaque mode introduces several other constraints on access of encrypting fields.  Encrypting fields return ciphertext on \s-1<em>FETCH\s0()</em> unless _\|_hide attribute is set, which forces Tie::EncryptedHash to behave as if encrypting fields don't exist.  Irrespective of _\|_hide, however, \s-1<em>DELETE\s0()</em> and \s-1<em>CLEAR\s0()</em> fail in opaque mode.  So does \s-1<em>STORE\s0()</em> on an existing encrypting field. Plaintext assignments to encrypting fields are silently ignored, but ciphertext assignments are fine.  Ciphertext assignments can be used to move data between different EncryptedHashes.</p>
<h3>Multiple Passwords and Ciphers</h3>
<p>Modality of Tie::EncryptedHash's access system breaks down when more than one password is used to with different encrypting fields.  This is a feature.  Tie::EncryptedHash lets you mix passwords and ciphers in the same hash.  Assign new values to _\|_password and _\|_cipher and create a new encrypting field.  Transparent mode will be restricted to fields encrypted with the current password.</p>
<h3>Error Handling</h3>
<p>Tie::Encrypted silently ignores access errors.  It doesn't carp/croak when you perform an illegal operation (like assign plaintext to an encrypting field in opaque mode).  This is to prevent data lossage, the kind that results from abnormal termination of applications.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">QUIRKS</h2>
        <div class="sectioncontent">
<h3>Autovivification</h3>
<p>Due to the nature of autovivified references (which spring into existence when an undefined reference is dereferenced), references are stored as plaintext in transparent mode.  Analogous ciphertext representations are maintained in parallel and restored to encrypting fields when password is deleted.  This process is completely transparent to the user, though it's advisable to delete the password after the final assignment to a Tie::EncryptedHash.  This ensures plaintext representations and scaffolding data structures are duly flushed.</p>
<h3>Data::Dumper</h3>
<p>Serialization of references is done with Data::Dumper, therefore the nature of data that can be assigned to encrypting fields is limited by what Data::Dumper can grok.  We set $Data::Dumper::Purity = 1, so self-referential and recursive structures should be \s-1OK\s0.</p>
<h3>Speed</h3>
<p>Tie::EncryptedHash'es keep their contents encrypted as much as possible, so there's a rather severe speed penalty.  With Blowfish, \s-1<em>STORE\s0()</em> on EncryptedHash can be upto 70 times slower than a standard perl hash. Reference \s-1<em>STORE\s0()</em>'es will be quicker, but speed gain will be adjusted at \s-1<em>FETCH\s0()</em>.  \s-1<em>FETCH\s0()</em> is about 35 times slower than a standard perl hash.  \s-1DES\s0 affords speed improvements of upto 2x, but is not considered secure for long-term storage of data.  These values were computed on a \s-1DELL\s0 \s-1PIII-300\s0 Mhz notebook with 128 Mb \s-1RAM\s0 running perl 5.003 on Linux 2.2.16.  Variations in speed might be different on your machine.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STANDARD USAGE</h2>
        <div class="sectioncontent">
<p>The standard usage for this module would be something along the lines of: populate Tie::EncryptedHash with sensitive data, delete the password, serialize the encrypted hash with Data::Dumper, store the result on disk or send it over the wire to another machine.  Later, when the sensitive data is required, procure the EncryptedHash, set the password and accesses the encrypted data fields.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Tie::EncryptedHash&hellip;</h2>
        <div class="sectioncontent">
<p><em>Data::Dumper</em>\|(3), <em>Crypt::CBC</em>\|(3), <em>Crypt::DES</em>\|(3), <em>Crypt::Blowfish</em>\|(3), <em>Tie::SecureHash</em>\|(3)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">
<p>The framework of Tie::EncryptedHash derives heavily from Damian Conway's Tie::SecureHash.  Objects that are blessed as well as tied are just one of the pleasant side-effects of stealing Damian's code.  Thanks to Damian for this brilliant module.</p><p>PacificNet (http://www.pacificnet.net) loaned me the aforementioned notebook to hack from the comfort of my bed.  Thanks folks!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Vipul Ved Prakash &lt;mail@vipul.net&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>This module is distributed under the same license as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Tie::DxHash.3pm.html"><span aria-hidden="true">&larr;</span> Tie::DxHash.3pm: Keeps insertion order; allows duplicate keys</a></li>
   <li class="next"><a href="Tie::Hash::Regex.3pm.html">Tie::Hash::Regex.3pm: Match hash keys using regular expressions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
