<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Csec_api: Provides authentication in lcg services</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Provides authentication in lcg services">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Csec_api (3) manual">
  <meta name="twitter:description" content="Provides authentication in lcg services">
  <meta name="twitter:image" content="https://www.carta.tech/images/liblcgdm-dev-Csec_api-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/Csec_api.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Csec_api (3) manual" />
  <meta property="og:description" content="Provides authentication in lcg services" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liblcgdm-dev-Csec_api-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Csec_api<small> (3)</small></h1>
        <p class="lead">Provides authentication in lcg services</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Csec_api.3.html">
      <span itemprop="name">Csec_api: Provides authentication in lcg services</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liblcgdm-dev/">
      <span itemprop="name">liblcgdm-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/Csec_api.3.html">
      <span itemprop="name">Csec_api: Provides authentication in lcg services</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Header file:</p><p><strong>#include &lt;Csec_api.h&gt;</strong></p><p>On the client side:</p><p><strong>int Csec_client_initContext(Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>service_type,</em> <strong>Csec_protocol *</strong><em>protocols</em><strong>);</strong></p><p><strong>int Csec_client_establishContext(Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>socket</em><strong>);</strong></p><p><strong>int Csec_client_setSecurityOpts(Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>opt</em><strong>);</strong></p><p><strong>int Csec_client_setAuthorizationId(Csec_context_t *</strong><em>ctx,</em> <strong>const char *</strong><em>mech,</em> <strong>const char *</strong><em>name</em><strong>);</strong></p><p><strong>int Csec_client_setVOMS_data(Csec_context_t *</strong><em>ctx,</em> <strong>const char *</strong><em>voname,</em> <strong>char **</strong><em>fqan,</em> <strong>int </strong><em>nbfqan</em><strong>);</strong></p><p>On the server side:</p><p><strong>int Csec_server_initContext(Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>service_type</em><strong>,</strong> <strong>Csec_protocol *</strong><em>protocols</em><strong>);</strong></p><p><strong>int Csec_server_reinitContext (Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>service_type</em><strong>,</strong> <strong>Csec_protocol *</strong><em>protocols</em><strong>);</strong></p><p><strong>int Csec_server_establishContext (Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>socket</em><strong>);</strong></p><p><strong>int Csec_server_getClientId(Csec_context_t *</strong><em>ctx,</em> <strong>char **</strong><em>mech,</em> <strong>char **</strong><em>name</em><strong>);</strong></p><p><strong>int Csec_server_getAuthorizationId(Csec_context_t *</strong><em>ctx,</em> <strong>char **</strong><em>mech,</em> <strong>char **</strong><em>name</em><strong>);</strong></p><p><strong>int Csec_server_getDelegatedCredentials(Csec_context_t *</strong><em>ctx,</em> <strong>char **</strong><em>mech,</em><strong> void ** </strong><em>buf,</em><strong> size_t *</strong><em>size</em><strong>);</strong></p><p><strong>int Csec_server_setSecurityOpts(Csec_context_t *</strong><em>ctx,</em> <strong>int </strong><em>opt</em><strong>);</strong></p><p><strong>char *Csec_server_get_client_ca(Csec_context_t *</strong><em>ctx);</em></p><p><strong>char *Csec_server_get_client_vo(Csec_context_t *</strong><em>ctx);</em></p><p><strong>char **Csec_server_get_client_fqans(Csec_context_t *</strong><em>ctx,</em> <strong>int *</strong><em>nbfqan);</em></p><p>Common functions:</p><p><strong>int Csec_clearContext(Csec_context_t *</strong><em>ctx</em><strong>);</strong></p><p><strong>int Csec_getErrorMessage();</strong></p><p><strong>int Csec_getErrorMessageSummary(size_t </strong><em>maxlen</em><strong>);</strong></p><p><strong>int Csec_mapToLocalUser(const char *</strong><em>mech,</em> <strong>const char *</strong><em>name,</em> <strong>char *</strong><em>username,</em> <strong>size_t </strong><em>username_size,</em> <strong>uid_t *</strong><em>uid,</em> <strong>gid_t *</strong><em>gid</em><strong>);</strong></p><p><strong>Csec_context_t * Csec_get_default_context();</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Csec_api</strong> functions allow for the implimentation of strong authentication mechanisms in LCG servers and clients. Csec_api is integrated with the LCG framework for errors.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>Csec_client_initContext, Csec_server_initContext, Csec_server_reinitContext</strong></p>
  </dt>
  <dd>
    <p>allow to initialize the <strong>Csec_context_t</strong> structure. The service type parameter defines which type of key will be used by the service. Its value can be:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>CSEC_SERVICE_TYPE_HOST</strong></p>
  </dt>
  <dd>
    <p>A normal host key (e.g. host/machine_name@DOMAIN for KRB5) will be used</p>
  </dd>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p>CSEC_SERVICE_TYPE_CENTRAL A  LCG Central host type key (e.g. castorcentral/machine_name@DOMAIN for KRB5) will be used</p>
  </dd>
  <dt>
    <p><strong>CSEC_SERVICE_TYPE_DISK</strong></p>
  </dt>
  <dd>
    <p>A  LCG disk host type key (e.g. castordisk/machine_name@DOMAIN for KRB5) will be used</p>
  </dd>
  <dt>
    <p><strong>CSEC_SERVICE_TYPE_TAPE</strong></p>
  </dt>
  <dd>
    <p>A  LCG tape host type key (e.g. castortape/machine_name@DOMAIN for KRB5) will be used</p>
  </dd>

</dl>

  </dd>
  <dt>
    <p><strong>Csec_client_establishContext, Csec_server_establishContext</strong></p>
  </dt>
  <dd>
    <p>Given an initialized context and an opened socket, establish a security context according to the chosen security mechanism.</p>
  </dd>
  <dt>
    <p><strong>Csec_client_setSecurityOpts, Csec_server_setSecurityOpts</strong></p>
  </dt>
  <dd>
    <p>Given an initialized context, but one that has not yet been used to establish a security context these functions allow the selection of various options. Currently supported are:</p>
<pre>
    CSEC_OPT_DELEG_FLAG
</pre>

<pre>
      Requests that delegated credentials from the client are made available to the server. Either the client or server may set this option and it will automaticaly limit the selection of authentication method to one that supports delegation. (Currently only GSI)
</pre>

<pre>
    CSEC_OPT_NODELEG_FLAG
</pre>

<pre>
      This directs that client/server to disallow delegation. If the other side requests delegation the establishing of a security context will fail.
</pre>
<p>If neither side sets any options the default behaviour is to not delegate a credential.</p>
  </dd>
  <dt>
    <p><strong>Csec_server_getClientId</strong></p>
  </dt>
  <dd>
    <p>Allows a server to retrieve the authentication mechanism and identification name (eg. principal or DN) from an established context, ctx. If either of mech or name are NULL no pointer will be returned. The strings that are returned are associated to the context, ctx, so should only be used while the context ctx is valid. If required they should be copied before the context is reset or cleared.</p>
  </dd>
  <dt>
    <p><strong>Csec_client_setAuthorizationId, Csec_server_getAuthorizationId</strong></p>
  </dt>
  <dd>
    <p>On the client side an 'AuthorizationId' may be set against an initialized but not yet established context. The AuthorizationId, consisting of the pair mech and name, may be treated as any arbitrary pair of strings up to CA_MAXCSECPROTOLEN, CA_MAXCSECNAMELEN in length. The strings will be made available to the server. mech is supposed to represent the mechanism type and name should be an identifying string such as principal or DN.</p><p>On the server side, the AuthorizationId may be retrieved after the security context is established. If the client did not set any id the server will receive an error when Csec_server_getAuthorizationId() is called. Pointers to the mechanism and the name will be returned in mech and name. Either may be set to NULL, in which case no pointer is returned. Upon successful return the list of VOMS fqans and the VOMS voname available to the server will also be reset to those which the client set manually, or will be emptied if the client did not set any. The strings returned are associated with the context and should be copied before the context is reset or cleared.</p>
  </dd>
  <dt>
    <p><strong>Csec_server_getDelegatedCredential</strong></p>
  </dt>
  <dd>
    <p>Allows a server to retrieve a copy of any delegated credential available from an established context, ctx. The credential is returned in buf. The size of the data in the buffer is returned in size. The data should be treated as an opaque structure, the meaning of which depends on the authentication scheme that was used. The scheme name is returned in mech. Currently only mech 'GSI' supports credential delegation and the client or server must request delegation passing by setting the appropriate flag with Csec_client_setSecurityOpts() or Csec_server_setSecurityOpts(). The GSI credential data is suitable for passing to gss_import_cred(). mech and buf will point to data conatined within the context, ctx, and should only be used while ctx remains valid.</p>
  </dd>
  <dt>
    <p><strong>Csec_mapToLocalUser</strong></p>
  </dt>
  <dd>
    <p>This function determines whether an ID (mechanism, name pair) can be mapped to a local uid/gid and/or username. If the username is wanted a buffer should be passed in username, the size of which is indicated with username_size. If the uid/gid are required uid and gid should be passed. Any of username, uid or gid may be NULL in which case they are not returned. If both uid and gid are NULL and username is non-NULL the mapped username is not required to exist on the local system. ie. the function will succeed as long as a mapping exists. If either of uid or gid are non-NULL the mapping and local username must exist, otherwise Csec_mapToLocalUser() will return an error.</p>
  </dd>
  <dt>
    <p><strong>Csec_clearContext</strong></p>
  </dt>
  <dd>
    <p>Clears the context and deallocates the memory used.</p>
  </dd>
  <dt>
    <p><strong>Csec_get_default_context</strong></p>
  </dt>
  <dd>
    <p>Utility function that provides the applications with one default per thread security context that can be used by the security layer.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERROR HANDLING</h2>
        <div class="sectioncontent">
<p>In case of errors in the Csec_pai layer, the functions return -1 (or NULL for the functions returning strings), the serrno is set accordingly. It is possible to get the detailed error message by using the <strong>Csec_getErrorMessage()</strong> or <strong>Csec_getErrorMessageSummary()</strong> functions. The Csec_getErrorMessageSummary() function will return a summary message that should need at most maxlen bytes of storage (including the terminating null). The detail of the message may be cut in various ways to reduce the length to fix in the specified length.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>CSEC_MECH</strong></p>
  </dt>
  <dd>
    <p>environment variable or <strong>CSEC MECH</strong> entry in <strong>/etc/shift.conf</strong></p><p>This environment variable contains the list of protocols to be used for authentication. The variable has precedence over the LCG configuration file.</p><p>On the client side, this list is used to choose which security mechanism should be used to address the server. On the server side, this is is of list of mechanisms that should be accepted by the server.</p>
  </dd>
  <dt>
    <p><strong>CSEC_TRACE</strong></p>
  </dt>
  <dd>
    <p>If defined switches the tracing on in the LCG security module. Tracing information is sent to stderr, unless <strong>CSEC_TRACEFILE is defined.</strong></p>
  </dd>
  <dt>
    <p><strong>CSEC_TRACEFILE</strong></p>
  </dt>
  <dd>
    <p>If defined, the LCG security tracing information is written to afile which name is the value of this variable.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY MECHANISMS</h2>
        <div class="sectioncontent">
<p>The currently supported methods for authentication are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>KRB5</strong></p>
  </dt>
  <dd>
    <p>Kerberos 5 mechanism</p>
  </dd>
  <dt>
    <p><strong>KRB4</strong></p>
  </dt>
  <dd>
    <p>Kerberos 4 mechanism</p>
  </dd>
  <dt>
    <p><strong>GSI</strong></p>
  </dt>
  <dd>
    <p>Globus Security Infrastructure</p>
  </dd>
  <dt>
    <p><strong>ID</strong></p>
  </dt>
  <dd>
    <p>Unsecure protocol, should be used for testing only.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTE ON THREAD SAFETY</h2>
        <div class="sectioncontent">
<p>If the Csec_api library was compiled thread safe (eg. was built defining the _THREAD_SAFE macro, which is the standard way) then the library should be thread safe. If the application using Csec_api also defines _THREAD_SAFE, Csec attempts to use thread safe versions of any underlying security libraries that are used for the authentication service.</p><p>For instance, in the case of GSI the thread safe version of Globus may, in areas other than security, sometimes create threads. If the application using Csec_api needs to link to the GSI libraries for its own use then threading flavour should be consistent. Therefore if the non threaded Globus libraries are required then do not define the _THREAD_SAFE macro.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>LCG Grid Deployment</strong> Team</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Csched.3.html"><span aria-hidden="true">&larr;</span> Csched.3: Lcg scheduling inferface</a></li>
   <li class="next"><a href="Cthread.3.html">Cthread.3: Lcg thread inferface <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
