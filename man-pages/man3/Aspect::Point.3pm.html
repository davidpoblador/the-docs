<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aspect::Point: The join point context</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The join point context">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Aspect::Point (3pm) manual">
  <meta name="twitter:description" content="The join point context">
  <meta name="twitter:image" content="https://www.carta.tech/images/libaspect-perl-Aspect::Point-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Aspect::Point.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Aspect::Point (3pm) manual" />
  <meta property="og:description" content="The join point context" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libaspect-perl-Aspect::Point-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Aspect::Point<small> (3pm)</small></h1>
        <p class="lead">The join point context</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Aspect::Point.3pm.html">
      <span itemprop="name">Aspect::Point: The join point context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libaspect-perl/">
      <span itemprop="name">libaspect-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Aspect::Point.3pm.html">
      <span itemprop="name">Aspect::Point: The join point context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  # An anonymous function suitable for use as advice code
  # across all advice types (as it uses no limited access methods)
  my $advice_code = sub {
      print $_-&gt;type;           # The advice type (&apos;before&apos;)
      print $_-&gt;pointcut;       # The matching pointcut ($pointcut)
      print $_-&gt;enclosing;      # Access cflow pointcut advice context
      print $_-&gt;sub_name;       # The full package_name::sub_name
      print $_-&gt;package_name;   # The package name (&apos;Person&apos;)
      print $_-&gt;short_name;     # The sub name (a get or set method)
      print $_-&gt;self;           # 1st parameter to the matching sub
      print ($_-&gt;args)[1];      # 2nd parameter to the matching sub
      $_-&gt;original-&gt;( x =&gt; 3 ); # Call matched sub independently
      $_-&gt;<strong>return_value</strong>(4)       # Set the return value
  };
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Advice code is called when the advice pointcut is matched. In this code, there is often a need to access information about the join point context of the advice. Information like:</p><p>What is the actual sub name matched?</p><p>What are the parameters in this call that we matched?</p><p>Sometimes you want to change the context for the matched sub, such as appending a parameter or even stopping the matched sub from being called at all.</p><p>You do all these things through the \*(C`Join Point\*(C', which is an object that isa Aspect::Point. It is the only parameter provided to the advice code. It provides all the information required about the match context, and allows you to change the behavior of the matched sub.</p><p>Note: Modifying parameters through the context in the code of an <em>after</em> advice, will have no effect, since the matched sub has already been called.</p><p>In a future release this will be fixed so that the context for each advice type only responds to the methods relevant to that context, with the rest throwing an exception.</p><h3>Cflows</h3>
<p>If the pointcut of an advice is composed of at least one \*(C`cflow\*(C' the advice code may require not only the context of the advice, but the join point context of the cflows as well.</p><p>This is required if you want to find out, for example, what the name of the sub that matched a cflow. In the synopsis example above, which method from \*(C`Company\*(C' started the chain of calls that eventually reached the get/set on \*(C`Person\*(C'?</p><p>You can access cflow context in the synopsis above, by calling:</p><p>  $point-&gt;enclosing</p><p>You get it from the main advice join point by calling a method named after the context key used in the cflow spec (which is \*(L"enclosing\*(R" if a custom name was not provided, in line with AspectJ terminology). In the synopsis pointcut definition, the cflow part was equivalent to:</p><p>  cflow enclosing =&gt; qr/^Company::/         ^^^^^^^^^</p><p>An Aspect::Point::Static will be created for the cflow, and you can access it using the \*(C`enclosing\*(C' method.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Print parameters to matched sub:</p><p>  before {       print join &apos;,&apos;, $_-&gt;args;   } $pointcut;</p><p>Append a parameter:</p><p>  before {       $_-&gt;args( $_-&gt;args, &apos;extra parameter&apos; );   } $pointcut;</p><p>Don't proceed to matched sub, return 4 instead:</p><p>  before {       shift-&gt;<strong>return_value</strong>(4);   } $pointcut;</p><p>Call matched sub again and again until it returns something defined:</p><p>  after {       my $point  = shift;       my $return = $point-&gt;return_value;       while ( not defined $return ) {           $return = $point-&gt;original($point-&gt;params);       }       $point-&gt;return_value($return);   } $pointcut;</p><p>Print the name of the \*(C`Company\*(C' object that started the chain of calls that eventually reached the get/set on \*(C`Person\*(C':</p><p>  before {       print shift-&gt;enclosing-&gt;self-&gt;name;   } $pointcut;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>type</h3>
<p>The \*(C`type\*(C' method is a convenience provided in the situation something has a Aspect::Point method and wants to know the advice declarator it is made for.</p><p>Returns "before" in Aspect::Advice::Before advice, "after" in Aspect::Advice::After advice, or "around" in Aspect::Advice::Around advice.</p>
<h3>pointcut</h3>
<p>  my $pointcut = $_-&gt;pointcut;</p><p>The \*(C`pointcut\*(C' method provides access to the original join point specification (as a tree of Aspect::Pointcut objects) that the current join point matched against.</p><p>Please note that the pointcut returned is the full and complete pointcut tree, due to the heavy optimisation used on the actual pointcut code when it is run there is no way at the time of advice execution to indicate which specific conditions in the pointcut tree matched and which did not.</p><p>Returns an object which is a sub-class of Aspect::Pointcut.</p>
<h3>original</h3>
<p>  $_-&gt;original-&gt;( 1, 2, 3 );</p><p>In a pointcut, the \*(C`original\*(C' method returns a \*(C`CODE\*(C' reference to the original function before it was hooked by the Aspect weaving process.</p><p>Calls made to the function are unprotected, parameters and calling context will not be replicated into the function, return params and exception will not be caught.</p>
<h3>sub_name</h3>
<p>  # Prints "Full::Function::name"   before {       print $_-&gt;sub_name . "&#92;n";   } call &apos;Full::Function::name&apos;;</p><p>The \*(C`sub_name\*(C' method returns a string with the full resolved function name at the join point the advice code is running at.</p>
<h3>package_name</h3>
<p>  # Prints "Just::Package"   before {       print $_-&gt;package_name . "&#92;n";   } call &apos;Just::Package::name&apos;;</p><p>The \*(C`package_name\*(C' parameter is a convenience wrapper around the \*(C`sub_name\*(C' method. Where \*(C`sub_name\*(C' will return the fully resolved function name, the \*(C`package_name\*(C' method will return just the namespace of the package of the join point.</p>
<h3>short_name</h3>
<p>  # Prints "name"   before {       print $_-&gt;short_name . "&#92;n";   } call &apos;Just::Package::name&apos;;</p><p>The \*(C`short_name\*(C' parameter is a convenience wrapper around the \*(C`sub_name\*(C' method. Where \*(C`sub_name\*(C' will return the fully resolved function name, the \*(C`short_name\*(C' method will return just the name of the function.</p>
<h3>args</h3>
<p>  # Add a parameter to the function call   $_-&gt;args( $_-&gt;args, &apos;more&apos; );</p><p>The \*(C`args\*(C' method allows you to get or set the list of parameters to a function. It is the method equivalent of manipulating the @_ array.</p><p>It uses a slightly unusual calling convention based on list context, but does so in a way that allows your advice code to read very naturally.</p><p>To summarise the situation, the three uses of the \*(C`args\*(C' method are listed below, along with their @_ equivalents.</p><p>  # Get the parameters as a list   my @list = $_-&gt;args;     # my $list = @_;</p><p>  # Get the number of parameters   my $count = $_-&gt;args;    # my $count = @_;</p><p>  # Set the parameters   $_-&gt;args( 1, 2, 3 );     # @_ = ( 1, 2, 3 );</p><p>As you can see from the above example, when \*(C`args\*(C' is called in list context it returns the list of parameters. When it is called in scalar context, it returns the number of parameters. And when it is called in void context, it sets the parameters to the passed values.</p><p>Although this is somewhat unconventional, it does allow the most common existing uses of the older \*(C`params\*(C' method to be changed directly to the new \*(C`args\*(C' method (such as the first example above).</p><p>And unlike the original, you can legally call \*(C`args\*(C' in such a way as to set the function parameters to be an empty list (which you could not do with the older \*(C`params\*(C' method).</p><p>  # Set the function parameters to a null list   $_-&gt;args();</p>
<h3>self</h3>
<p>  after {       $_-&gt;self-&gt;save;   } My::Foo::set;</p><p>The \*(C`self\*(C' method is a convenience provided for when you are writing advice that will be working with object-oriented Perl code. It returns the first parameter to the method (which should be object), which you can then call methods on.</p><p>The result is advice code that is much more natural to read, as you can see in the above example where we implement an auto-save feature on the class \*(C`My::Foo\*(C', writing the contents to disk every time a value is set without error.</p><p>At present the \*(C`self\*(C' method is implemented fairly naively, if used outside of object-oriented code it will still return something (including \*(C`undef\*(C' in the case where there were no parameters to the join point function).</p>
<h3>wantarray</h3>
<p>  # Return differently depending on the calling context   if ( $_-&gt;wantarray ) {       $_-&gt;<strong>return_value</strong>(5);   } else {       $_-&gt;return_value(1, 2, 3, 4, 5);   }</p><p>The \*(C`wantarray\*(C' method returns the \*(L"wantarray\*(R" in perlfunc context of the call to the function for the current join point.</p><p>As with the core Perl \*(C`wantarray\*(C' function, returns true if the function is being called in list context, false if the function is being called in scalar context, or \*(C`undef\*(C' if the function is being called in void context.</p><p><strong>Backcompatibility Note:</strong></p><p>Prior to Aspect 0.98 the wantarray context of the call to the join point was available not only via the \*(C`wantarray\*(C' method, but the advice code itself was called in matching wantarray context to the function call, allowing you to use plain \*(C`wantarray\*(C' in the advice code as well.</p><p>As all the other information about the join point was available through methods, having this one piece of metadata available different was becoming an oddity.</p><p>The \*(C`wantarray\*(C' context of the join point is now <strong>only</strong> available by the \*(C`wantarray\*(C' method.</p>
<h3>exception</h3>
<p>  unless ( $_-&gt;exception ) {       $_-&gt;exception(&apos;Kaboom&apos;);   }</p><p>The \*(C`exception\*(C' method is used to get the current die message or exception object, or to set the die message or exception object.</p>
<h3>return_value</h3>
<p>  # Add an extra value to the returned list   $_-&gt;return_value( $_-&gt;return_value, &apos;thing&apos; );</p><p>The \*(C`return_value\*(C' method is used to get or set the return value for the join point function, in a similar way to the normal Perl \*(C`return\*(C' keyword.</p><p>As with the \*(C`args\*(C' method, the \*(C`return_value\*(C' method is sensitive to the context in which it is called.</p><p>When called in list context, the \*(C`return_value\*(C' method returns the join point return value as a list. If the join point is called in scalar context, this will be a single-element list containing the scalar return value. If the join point is called in void context, this will be a null list.</p><p>When called in scalar context, the \*(C`return_value\*(C' method returns the join point return value as a scalar. If the join point is called in list context, this will be the number of vales in the return list. If the join point is called in void context, this will be \*(C`undef\*(C'</p><p>When called in void context, the \*(C`return_value\*(C' method sets the return value for the join point using semantics identical to the \*(C`return\*(C' keyword.</p><p>Because of this change in behavior based on the context in which \*(C`return_value\*(C' is called, you should generally always set \*(C`return_value\*(C' in it's own statement to prevent accidentally calling it in non-void context.</p><p>  # Return null (equivalent to "return;")   $_-&gt;return_value;</p><p>In advice types that can be triggered by an exception, or need to determine whether to continue to the join point function, setting a return value via \*(C`return_value\*(C' is seen as implicitly indicating that any exception should be suppressed, or that we do <strong>not</strong> want to continue to the join point function.</p><p>When you call the \*(C`return_value\*(C' method this does \s-1NOT\s0 trigger an immediate \*(C`return\*(C' equivalent in the advice code, the lines after \*(C`return_value\*(C' will continue to be executed as normal (to provide an opportunity for cleanup operations to be done and so on).</p><p>If you use \*(C`return_value\*(C' inside an if/else structure you will still need to do an explicit \*(C`return\*(C' if you wish to break out of the advice code.</p><p>Thus, if you wish to break out of the advice code as well as return with an alternative value, you should do the following.</p><p>  return $_-&gt;return_value(&apos;value&apos;);</p><p>This usage of \*(C`return_value\*(C' appears to be contrary to the above instruction that setting the return value should always be done on a standalone line to guarentee void context.</p><p>However, in Perl the context of the current function is inherited by a function called with return in the manner shown above. Thus the usage of \*(C`return_value\*(C' in this way alone is guarenteed to also set the return value rather than fetch it.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Adam Kennedy &lt;adamk@cpan.org&gt;</p><p>Marcel Gru\*:nauer &lt;marcel@cpan.org&gt;</p><p>Ran Eilam &lt;eilara@cpan.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2001 by Marcel Gru\*:nauer</p><p>Some parts copyright 2009 - 2013 Adam Kennedy.</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Aspect::Modular.3pm.html"><span aria-hidden="true">&larr;</span> Aspect::Modular.3pm: First generation base class for reusable aspects</a></li>
   <li class="next"><a href="Aspect::Point::Functions.3pm.html">Aspect::Point::Functions.3pm: Allow point context methods to be called as functions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
