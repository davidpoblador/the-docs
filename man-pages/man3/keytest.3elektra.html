<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>keytest: Methods to do various tests on keys.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Methods to do various tests on keys.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="keytest (3elektra) manual">
  <meta name="twitter:description" content="Methods to do various tests on keys.">
  <meta name="twitter:image" content="https://www.carta.tech/images/elektra-doc-keytest-3elektra.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3elektra/keytest.3elektra.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="keytest (3elektra) manual" />
  <meta property="og:description" content="Methods to do various tests on keys." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/elektra-doc-keytest-3elektra.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">keytest<small> (3elektra)</small></h1>
        <p class="lead">Methods to do various tests on keys.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3elektra/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3elektra/keytest.3elektra.html">
      <span itemprop="name">keytest: Methods to do various tests on keys.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/elektra-doc/">
      <span itemprop="name">elektra-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3elektra/keytest.3elektra.html">
      <span itemprop="name">keytest: Methods to do various tests on keys.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p>Methods to do various tests on Keys.</p><p>To use them:</p>
<pre>
#include &lt;kdb.h&gt;

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Function Documentation</h2>
        <div class="sectioncontent">
<h3>int keyCmp (const Key *k1, const Key *k2)</h3>
<p>Compare the name of two keys.</p><p><strong>Returns:</strong></p><p>a number less than, equal to or greater than zero if k1 is found, respectively, to be less than, to match, or be greater than k2.</p><p>The comparison is based on a strcmp of the keynames, and iff they match a strcmp of the owner will be used to distuingish. If even this matches the keys are found to be exactly the same and 0 is returned. These two keys can't be used in the same KeySet.</p><p><strong>keyCmp()</strong> defines the sorting order for a KeySet.</p><p>The following 3 points are the rules for null values. They only take account when none of the preceding rules matched.</p><ul>
<li><p>A null pointer will be found to be smaller than every other key. If both are null pointers, 0 is returned.</p></li><li><p>A null name will be found to be smaller than every other name. If both are null names, 0 is returned.</p></li><li><p>No owner will be found to be smaller then every other owner. If both don't have a owner, 0 is returned.</p></li>
</ul><p><strong>Note:</strong></p><p>the owner will only be used if the names are equal.</p><p>Often is enough to know if the other key is less then or greater then the other one. But Sometimes you need more precise information, see <strong>keyRel()</strong>.</p><p>Given any Keys k1 and k2 constructed with <strong>keyNew()</strong>, following equation hold true:</p>
<pre>
// keyCmp(0,0) == 0
// keyCmp(k1,0) ==  1
// keyCmp(0,k2) == -1
</pre>
<p>You can write similar equation for the other rules.</p><p>Here are some more examples with equation:</p>
<pre>
Key *k1 = keyNew("user/a", KEY_END);
Key *k2 = keyNew("user/b", KEY_END);

// keyCmp(k1,k2) &lt; 0
// keyCmp(k2,k1) &gt; 0

</pre>

<pre>
Key *k1 = keyNew("user/a", KEY_OWNER, "markus", KEY_END);
Key *k2 = keyNew("user/a", KEY_OWNER, "max", KEY_END);

// keyCmp(k1,k2) &lt; 0
// keyCmp(k2,k1) &gt; 0
</pre>
<p><strong>Warning:</strong></p><p>Do not try to strcmp the <strong>keyName()</strong> yourself because the used strcmp implementation is allowed to differ from simple ascii comparison.</p><p><strong>Parameters:</strong></p><p><em>k1</em> the first key object to compare with</p><p><em>k2</em> the second key object to compare with</p><p><strong>See also:</strong></p><p><strong>ksAppendKey()</strong>, <strong>ksAppend()</strong> will compare keys when appending</p><p><strong>ksLookup()</strong> will compare keys during searching</p>
<h3>\fBkeyswitch_t\fP keyCompare (const Key *key1, const Key *key2)</h3>
<p>Compare 2 keys.</p><p>The returned flags bit array has 1s (differ) or 0s (equal) for each key meta info compared, that can be logically ORed using <strong>keyswitch_t</strong><strong> flags. </strong><strong>KEY_NAME </strong><strong>, </strong><strong>KEY_VALUE </strong><strong>, </strong><strong>KEY_OWNER </strong><strong>, </strong><strong>KEY_COMMENT </strong><strong>, </strong><strong>KEY_UID </strong><strong>, </strong><strong>KEY_GID </strong><strong>, </strong><strong>KEY_MODE </strong><strong> and</strong></p><p><strong>A very simple example would be</strong></p>
<pre>
Key *key1, *key;
uint32_t changes;

// omited key1 and key2 initialization and manipulation

changes=keyCompare(key1,key2);

if (changes == 0) printf("key1 and key2 are identicall\n");

if (changes & KEY_VALUE)
        printf("key1 and key2 have different values\n");

if (changes & KEY_UID)
        printf("key1 and key2 have different UID\n");

</pre>
<p><strong>Example of very powerful specific Key lookup in a KeySet:</strong></p>
<pre>
KDB *handle = kdbOpen();
KeySet *ks=<strong>ksNew</strong>(0);
Key *base = keyNew ("user/sw/MyApp/something", KEY_END);
Key *current;
uint32_t match;
uint32_t interests;


kdbGetByName(handle, ks, "user/sw/MyApp", 0);

// we are interested only in key type and access permissions
interests=(KEY_TYPE | KEY_MODE);

ksRewind(ks);   // put cursor in the beginning
while ((curren=ksNext(ks))) {
        match=keyCompare(current,base);

        if ((~match & interests) == interests)
                printf("Key %s has same type and permissions of base key",keyName(current));

        // continue walking in the KeySet....
}

// now we want same name and/or value
interests=(KEY_NAME | KEY_VALUE);

// we don't really need ksRewind(), since previous loop achieved end of KeySet
ksRewind(ks);
while ((current=ksNext(ks))) {
        match=keyCompare(current,base);

        if ((~match & interests) == interests) {
                printf("Key %s has same name, value, and sync status
                        of base key",keyName(current));
        }
        // continue walking in the KeySet....
}

keyDel(base);
ksDel(ks);
kdbClose (handle);

</pre>
<p><strong>Returns:</strong></p><p>a bit array pointing the differences</p><p><strong>Parameters:</strong></p><p><em>key1</em> first key</p><p><em>key2</em> second key</p><p><strong>See also:</strong></p><p><strong>keyswitch_t</strong></p>
<h3>int keyIsBelow (const Key *key, const Key *check)</h3>
<p>Check if the key check is below the key key or not.</p><p>Example:</p>
<pre>
key user/sw/app
check user/sw/app/key

</pre>
<p>returns true because check is below key</p><p>Example:</p>
<pre>
key user/sw/app
check user/sw/app/folder/key

</pre>
<p>returns also true because check is indirect below key</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><em>check</em> the key to find the relative position of</p><p><strong>Returns:</strong></p><p>1 if check is below key</p><p>0 if it is not below or if it is the same key</p><p><strong>See also:</strong></p><p><strong>keySetName()</strong>, <strong>keyGetName()</strong>, <strong>keyIsDirectBelow()</strong></p>
<h3>int keyIsBinary (const Key *key)</h3>
<p>Check if a key is binary type.</p><p>The function checks if the key is a binary. Opposed to string values binary values can have '&#92;0' inside the value and may not be terminated by a null character. Their disadvantage is that you need to pass their size.</p><p>Make sure to use this function and don't test the binary type another way to ensure compatibility and to write less error prone programs.</p><p><strong>Returns:</strong></p><p>1 if it is binary</p><p>0 if it is not</p><p>-1 on NULL pointer</p><p><strong>See also:</strong></p><p><strong>keyGetBinary()</strong>, <strong>keySetBinary()</strong></p><p><strong>Parameters:</strong></p><p><em>key</em> the key to check</p>
<h3>int keyIsDir (const Key *key)</h3>
<p>Check if the mode for the key has access privileges.</p><p>In the filesys backend a key represented through a file has the mode 664, but a key represented through a folder 775. <strong>keyIsDir()</strong> checks if all 3 executeable bits are set.</p><p>If any executable bit is set it will be recognized as a directory.</p><p><strong>Note:</strong></p><p>keyIsDir may return true even though you can't access the directory.</p><p>To know if you can access the directory, you need to check, if your</p><ul>
<li><p>user ID is equal the key's user ID and the mode & 100 is true</p></li><li><p>group ID is equal the key's group ID and the mode & 010 is true</p></li><li><p>mode & 001 is true</p></li>
</ul><p>Accessing does not mean that you can get any value or comments below, see <strong>Modes</strong> for more information.</p><p><strong>Note:</strong></p><p>currently mountpoints can only where <strong>keyIsDir()</strong> is true (0.7.0) but this is likely to change.</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><strong>Returns:</strong></p><p>1 if key is a directory, 0 otherwise</p><p>-1 on NULL pointer</p><p><strong>See also:</strong></p><p><strong>keySetDir()</strong>, <strong>keySetMode()</strong></p>
<h3>int keyIsDirectBelow (const Key *key, const Key *check)</h3>
<p>Check if the key check is direct below the key key or not.</p>
<pre>
Example:
key user/sw/app
check user/sw/app/key

returns true because check is below key

Example:
key user/sw/app
check user/sw/app/folder/key

does not return true, because there is only a indirect relation
</pre>
<p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><em>check</em> the key to find the relative position of</p><p><strong>Returns:</strong></p><p>1 if check is below key</p><p>0 if it is not below or if it is the same key</p><p>-1 on null pointer</p><p><strong>See also:</strong></p><p><strong>keyIsBelow()</strong>, <strong>keySetName()</strong>, <strong>keyGetName()</strong></p>
<h3>int keyIsInactive (const Key *key)</h3>
<p>Check whether a key is inactive or not.</p><p>In elektra terminology any key is inactive if the it's basename starts with '.'. Inactive keys must not have any meaning to applications, they are reserved for users and administrators.</p><p>To remove a whole hierarchy in elektra, don't forget to pass option_t::KDB_O_INACTIVE to <strong>kdbGet()</strong> to receive the inactive keys in order to remove them.</p><p>Otherwise you should not fetch these keys.</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><strong>Returns:</strong></p><p>1 if the key is inactive, 0 otherwise</p><p>-1 on NULL pointer or when key has no name</p>
<h3>int keyIsString (const Key *key)</h3>
<p>Check if a key is string type.</p><p>String values are null terminated and are not allowed to have any '&#92;0' characters inside the string.</p><p>Make sure to use this function and don't test the string type another way to ensure compatibility and to write less error prone programs.</p><p><strong>Returns:</strong></p><p>1 if it is string</p><p>0 if it is not</p><p>-1 on NULL pointer</p><p><strong>See also:</strong></p><p><strong>keyGetString()</strong>, <strong>keySetString()</strong></p><p><strong>Parameters:</strong></p><p><em>key</em> the key to check</p>
<h3>int keyIsSystem (const Key *key)</h3>
<p>Check whether a key is under the system namespace or not</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><strong>Returns:</strong></p><p>1 if key name begins with system, 0 otherwise</p><p>-1 on NULL pointer</p><p><strong>See also:</strong></p><p><strong>keyIsUser()</strong>, <strong>keySetName()</strong>, <strong>keyName()</strong></p>
<h3>int keyIsUser (const Key *key)</h3>
<p>Check whether a key is under the user namespace or not.</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><strong>Returns:</strong></p><p>1 if key name begins with user, 0 otherwise</p><p>-1 on NULL pointer</p><p><strong>See also:</strong></p><p><strong>keyIsSystem()</strong>, <strong>keySetName()</strong>, <strong>keyName()</strong></p>
<h3>int keyNeedSync (const Key *key)</h3>
<p>Test if a key needs to be synced to backend storage.</p><p>If any key modification took place the key will be flagged with KEY_FLAG_SYNC so that <strong>kdbSet()</strong> knows which keys were modified and which not.</p><p>After <strong>keyNew()</strong> the flag will normally be set, but after <strong>kdbGet()</strong> and <strong>kdbSet()</strong> the flag will be removed. When you modify the key the flag will be set again.</p><p>In your application you can make use of that flag to know if you changed something in a key after a <strong>kdbGet()</strong> or <strong>kdbSet()</strong>.</p><p><strong>Note:</strong></p><p>Note that also changes in the meta data will set that flag.</p><p><strong>See also:</strong></p><p><strong>keyNew()</strong></p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><strong>Returns:</strong></p><p>1 if key was changed in memory, 0 otherwise</p><p>-1 on NULL pointer</p>
<h3>int keyRel (const Key *key, const Key *check)</h3>
<p>Information about the relation in the hierarchy between two keys.</p><p>Unlike <strong>keyCmp()</strong> the number gives information about hierarchical information.</p><ul>
<li><p>If the keys are the same 0 is returned. So it is the key itself.</p></li>
</ul>
<pre>
user/key
user/key

</pre>

<pre>
keySetName (key, "user/key/folder");
keySetName (check, "user/key/folder");
succeed_if (keyRel (key, check) == 0, "should be same");
</pre>
<p><strong>Note:</strong></p><p>this relation can be checked with <strong>keyCmp()</strong> too.</p><ul>
<li><p>If the key is direct below the other one 1 is returned. That means that, in terms of hierarchy, no other key is between them - it is a direct child.</p></li>
</ul>
<pre>
user/key/folder
user/key/folder/child

</pre>

<pre>
keySetName (key, "user/key/folder");
keySetName (check, "user/key/folder/child");
succeed_if (keyRel (key, check) == 1, "should be direct below");
</pre>
<ul>
<li><p>If the key is below the other one, but not directly 2 is returned. This is also called grand-child.</p></li>
</ul>
<pre>
user/key/folder
user/key/folder/any/depth/deeper/grand-child

</pre>

<pre>
keySetName (key, "user/key/folder");
keySetName (check, "user/key/folder/any/depth/deeper/grand-child");
succeed_if (keyRel (key, check) &gt;= 2, "should be below (but not direct)");
succeed_if (keyRel (key, check) &gt; 0, "should be below");
succeed_if (keyRel (key, check) &gt;= 0, "should be the same or below");
</pre>
<ul>
<li><p>If a invalid or null ptr key is passed, -1 is returned</p></li><li><p>If the keys have no relations, but are not invalid, -2 is returned.</p></li><li><p>If the keys are in the same hierarchy, a value smaller then -2 is returned. It means that the key is not below.</p></li>
</ul>
<pre>
user/key/myself
user/key/sibling

</pre>

<pre>
keySetName (key, "user/key/folder");
keySetName (check, "user/notsame/folder");
succeed_if (keyRel (key, check) &lt; -2, "key is not below, but same namespace");
</pre>

<pre>

</pre>
<p>TODO Below is an idea how it could be extended: It could continue the search into the other direction if any (grand-)parents are equal.</p><ul>
<li><p>If the keys are direct below a key which is next to the key, -2 is returned. This is also called nephew. (TODO not implemented)</p></li>
</ul>
<pre>
user/key/myself
user/key/sibling

</pre>
<ul>
<li><p>If the keys are direct below a key which is next to the key, -2 is returned. This is also called nephew. (TODO not implemented)</p></li>
</ul>
<pre>
user/key/myself
user/key/sibling/nephew

</pre>
<ul>
<li><p>If the keys are below a key which is next to the key, -3 is returned. This is also called grand-nephew. (TODO not implemented)</p></li>
</ul>
<pre>
user/key/myself
user/key/sibling/any/depth/deeper/grand-nephew

</pre>
<p>The same holds true for the other direction, but with negative values. For no relation INT_MIN is returned.</p><p><strong>Note:</strong></p><p>to check if the keys are the same, you must use <strong>keyCmp()</strong> == 0! <strong>keyRel()</strong> does not give you the information if it did not find a relation or if it is the same key.</p><p><strong>Returns:</strong></p><p>dependend on the relation: 2.. if below 1.. if direct below 0.. if the same -1.. on null or invalid keys -2.. if none of any other relation -3.. if same hierarchy (none of those below) -4.. if sibling (in same hierarchy) -5.. if nephew (in same hierarchy)</p><p><strong>Parameters:</strong></p><p><em>key</em> the key object to work with</p><p><em>check</em> the second key object to check the relation with</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for Elektra from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="keyset.3elektra.html"><span aria-hidden="true">&larr;</span> keyset.3elektra: Methods to manipulate keysets.</a></li>
   <li class="next"><a href="mergeconflict.hpp.3elektra.html">mergeconflict.hpp.3elektra: Models a merge conflict. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
