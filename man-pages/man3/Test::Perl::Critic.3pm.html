<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test::Perl::Critic: Use perl::critic in test programs</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Use perl::critic in test programs">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Test::Perl::Critic (3pm) manual">
  <meta name="twitter:description" content="Use perl::critic in test programs">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtest-perl-critic-perl-Test::Perl::Critic-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Test::Perl::Critic.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Test::Perl::Critic (3pm) manual" />
  <meta property="og:description" content="Use perl::critic in test programs" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtest-perl-critic-perl-Test::Perl::Critic-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Test::Perl::Critic<small> (3pm)</small></h1>
        <p class="lead">Use perl::critic in test programs</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Test::Perl::Critic.3pm.html">
      <span itemprop="name">Test::Perl::Critic: Use perl::critic in test programs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtest-perl-critic-perl/">
      <span itemprop="name">libtest-perl-critic-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Test::Perl::Critic.3pm.html">
      <span itemprop="name">Test::Perl::Critic: Use perl::critic in test programs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Test one file:</p>
<pre>
  use Test::Perl::Critic;
  use Test::More tests =&gt; 1;
  critic_ok($file);
</pre>
<p>Or test all files in one or more directories:</p><p>  use Test::Perl::Critic;   all_critic_ok($dir_1, $dir_2, $dir_N );</p><p>Or test all files in a distribution:</p><p>  use Test::Perl::Critic;   all_critic_ok();</p><p>Recommended usage for \s-1CPAN\s0 distributions:</p><p>  use strict;   use warnings;   use File::Spec;   use Test::More;   use English qw(-no_match_vars);</p><p>  if ( not $ENV{TEST_AUTHOR} ) {       my $msg = &apos;Author test.  Set $ENV{TEST_AUTHOR} to a true value to run.&apos;;       plan( skip_all =&gt; $msg );   }</p><p>  eval { require Test::Perl::Critic; };</p><p>  if ( $EVAL_ERROR ) {      my $msg = &apos;Test::Perl::Critic required to criticise code&apos;;      plan( skip_all =&gt; $msg );   }</p><p>  my $rcfile = File::Spec-&gt;catfile( &apos;t&apos;, &apos;perlcriticrc&apos; );   Test::Perl::Critic-&gt;import( -profile =&gt; $rcfile );   all_critic_ok();</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Test::Perl::Critic wraps the Perl::Critic engine in a convenient subroutine suitable for test programs written using the Test::More framework.  This makes it easy to integrate coding-standards enforcement into the build process.  For ultimate convenience (at the expense of some flexibility), see the criticism pragma.</p><p>If you have an large existing code base, you might prefer to use Test::Perl::Critic::Progressive.</p><p>If you'd like to try Perl::Critic without installing anything, there is a web-service available at &lt;http://perlcritic.com&gt;.  The web-service does not yet support all the configuration features that are available in the native Perl::Critic \s-1API\s0, but it should give you a good idea of what it does.  You can also invoke the perlcritic web-service from the command line by doing an HTTP-post, such as one of these:</p><p>  $&gt; POST http://perlcritic.com/perl/critic.pl &lt; MyModule.pm   $&gt; lwp-request -m POST http://perlcritic.com/perl/critic.pl &lt; MyModule.pm   $&gt; wget -q -O - --post-file=MyModule.pm http://perlcritic.com/perl/critic.pl</p><p>Please note that the perlcritic web-service is still alpha code.  The \s-1URL\s0 and interface to the service are subject to change.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUBROUTINES</h2>
        <div class="sectioncontent">
<p>Okays the test if Perl::Critic does not find any violations in $FILE.  If it does, the violations will be reported in the test diagnostics.  The optional second argument is the name of test, which defaults to \*(L"Perl::Critic test for $FILE\*(R". If you use this form, you should emit your own Test::More plan first. Runs \*(C`critic_ok()\*(C' for all Perl files beneath the given list of @DIRECTORIES.  If @DIRECTORIES is empty or not given, this function tries to find all Perl files in the <em>blib/</em> directory.  If the <em>blib/</em> directory does not exist, then it tries the <em>lib/</em> directory.  Returns true if all files are okay, or false if any file fails. This subroutine emits its own Test::More plan, so you do not need to specify an expected number of tests yourself.</p>
<dl class='dl-vertical'>
  <dt>
    all_code_files ( [@DIRECTORIES] )
  </dt>
  <dd>
    <p><strong>\s-1DEPRECATED:\s0</strong> Use the \*(C`all_perl_files\*(C' subroutine that is exported by Perl::Critic::Utils instead. Returns a list of all the Perl files found beneath each \s-1DIRECTORY\s0, If @DIRECTORIES is an empty list, defaults to <em>blib/</em>.  If <em>blib/</em> does not exist, it tries <em>lib/</em>.  Skips any files in \s-1CVS\s0 or Subversion directories. A Perl file is:</p><ul>
<li><p>Any file that ends in <em>.PL</em>, <em>.pl</em>, <em>.pm</em>, or <em>.t</em></p></li><li><p>Any file that has a first line with a shebang containing 'perl'</p></li>
</ul>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>Perl::Critic is highly configurable.  By default, Test::Perl::Critic invokes Perl::Critic with its default configuration.  But if you have developed your code against a custom Perl::Critic configuration, you will want to configure Test::Perl::Critic to do the same.</p><p>Any arguments passed through the \*(C`use\*(C' pragma (or via \*(C`Test::Perl::Critic-&gt;import()\*(C' )will be passed into the Perl::Critic constructor.  So if you have developed your code using a custom <em>~/.perlcriticrc</em> file, you can direct Test::Perl::Critic to use your custom file too.</p><p>  use Test::Perl::Critic (-profile =&gt; &apos;t/perlcriticrc&apos;);   all_critic_ok();</p><p>Now place a copy of your own <em>~/.perlcriticrc</em> file in the distribution as <em>t/perlcriticrc</em>.  Then, \*(C`critic_ok()\*(C' will be run on all Perl files in this distribution using this same Perl::Critic configuration.  See the Perl::Critic documentation for details on the <em>.perlcriticrc</em> file format.</p><p>Any argument that is supported by the Perl::Critic constructor can be passed through this interface.  For example, you can also set the minimum severity level, or include & exclude specific policies like this:</p><p>  use Test::Perl::Critic (-severity =&gt; 2, -exclude =&gt; [&apos;RequireRcsKeywords&apos;]);   all_critic_ok();</p><p>See the Perl::Critic documentation for complete details on its options and arguments.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTIC DETAILS</h2>
        <div class="sectioncontent">
<p>By default, Test::Perl::Critic displays basic information about each Policy violation in the diagnostic output of the test.  You can customize the format and content of this information by using the \*(C`-verbose\*(C' option.  This behaves exactly like the \*(C`-verbose\*(C' switch on the <em>perlcritic</em> program.  For example:</p><p>  use Test::Perl::Critic (-verbose =&gt; 6);</p><p>  #or...</p><p>  use Test::Perl::Critic (-verbose =&gt; &apos;%f: %m at %l&apos;);</p><p>If given a number, Test::Perl::Critic reports violations using one of the predefined formats described below. If given a string, it is interpreted to be an actual format specification. If the \*(C`-verbose\*(C' option is not specified, it defaults to 3.</p><p>    Verbosity     Format Specification     -----------   -------------------------------------------------------      1            "%f:%l:%c:%m&#92;n",      2            "%f: (%l:%c) %m&#92;n",      3            "%m at %f line %l&#92;n",      4            "%m at line %l, column %c.  %e.  (Severity: %s)&#92;n",      5            "%f: %m at line %l, column %c.  %e.  (Severity: %s)&#92;n",      6            "%m at line %l, near &apos;%r&apos;.  (Severity: %s)&#92;n",      7            "%f: %m at line %l near &apos;%r&apos;.  (Severity: %s)&#92;n",      8            "[%p] %m at line %l, column %c.  (Severity: %s)&#92;n",      9            "[%p] %m at line %l, near &apos;%r&apos;.  (Severity: %s)&#92;n",     10            "%m at line %l, column %c.&#92;n  %p (Severity: %s)&#92;n%d&#92;n",     11            "%m at line %l, near &apos;%r&apos;.&#92;n  %p (Severity: %s)&#92;n%d&#92;n"</p><p>Formats are a combination of literal and escape characters similar to the way \*(C`sprintf\*(C' works. See String::Format for a full explanation of the formatting capabilities. Valid escape characters are:</p><p>    Escape    Meaning     -------   ----------------------------------------------------------------     %c        Column number where the violation occurred     %d        Full diagnostic discussion of the violation (DESCRIPTION in POD)     %e        Explanation of violation or page numbers in PBP     %F        Just the name of the logical file where the violation occurred.     %f        Path to the logical file where the violation occurred.     %G        Just the name of the physical file where the violation occurred.     %g        Path to the physical file where the violation occurred.     %l        Logical line number where the violation occurred     %L        Physical line number where the violation occurred     %m        Brief description of the violation     %P        Full name of the Policy module that created the violation     %p        Name of the Policy without the Perl::Critic::Policy:: prefix     %r        The string of source code that caused the violation     %C        The class of the PPI::Element that caused the violation     %s        The severity level of the violation</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<p>Despite the convenience of using a test script to enforce your coding standards, there are some inherent risks when distributing those tests to others.  Since you don't know which version of Perl::Critic the end-user has and whether they have installed any additional Policy modules, you can't really be sure that your code will pass the Test::Perl::Critic tests on another machine.</p><p><strong>For these reasons, we strongly advise you to make your perlcritic tests</strong> optional, or exclude them from the distribution entirely.</p><p>The recommended usage in the \*(L"\s-1SYNOPSIS\s0\*(R" section illustrates one way to make your <em>perlcritic.t</em> test optional.  Another option is to put <em>perlcritic.t</em> and other author-only tests in a separate directory (<em>xt/</em> seems to be common), and then use a custom build action when you want to run them.  Also, you should <strong>not</strong> list Test::Perl::Critic as a requirement in your build script.  These tests are only relevant to the author and should not be a prerequisite for end-use.</p><p>See &lt;http://www.chrisdolan.net/talk/index.php/2005/11/14/private-regression-tests/&gt; for an interesting discussion about Test::Perl::Critic and other types of author-only regression tests.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPORTS</h2>
        <div class="sectioncontent">
<p>  critic_ok()   all_critic_ok()</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PERFORMANCE HACKS</h2>
        <div class="sectioncontent">
<p>If you want a small performance boost, you can tell \s-1PPI\s0 to cache results from previous parsing runs.  Most of the processing time is in Perl::Critic, not \s-1PPI\s0, so the speedup is not huge (only about 20%).  Nonetheless, if your distribution is large, it's worth the effort.</p><p>Add a block of code like the following to your test program, probably just before the call to \*(C`all_critic_ok()\*(C'.  Be sure to adjust the path to the temp directory appropriately for your system.</p><p>    use File::Spec;     my $cache_path = File::Spec-&gt;catdir(File::Spec-&gt;tmpdir,                                         "test-perl-critic-cache-$ENV{USER}");     if (!-d $cache_path) {        mkdir $cache_path, oct 700;     }     require PPI::Cache;     PPI::Cache-&gt;import(path =&gt; $cache_path);</p><p>We recommend that you do \s-1NOT\s0 use this technique for tests that will go out to end-users.  They're probably going to only run the tests once, so they will not see the benefit of the caching but will still have files stored in their temp directory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>If you find any bugs, please submit them to &lt;http://rt.cpan.org/NoAuth/Bugs.html?Dist=Perl-Critic&gt;.  Thanks.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Test::Perl::Critic&hellip;</h2>
        <div class="sectioncontent">
<p>Module::Starter::PBP</p><p>Perl::Critic</p><p>Test::More</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CREDITS</h2>
        <div class="sectioncontent">
<p>Andy Lester, whose Test::Pod module provided most of the code and documentation for Test::Perl::Critic.  Thanks, Andy.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jeffrey Ryan Thalhammer &lt;jeff@imaginative-software.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (c) 2005-2009 Imaginative Software Systems.  All rights reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.  The full text of this license can be found in the \s-1LICENSE\s0 file included with this module.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Test::POP3.3pm.html"><span aria-hidden="true">&larr;</span> Test::POP3.3pm: Automate email delivery tests</a></li>
   <li class="next"><a href="Test::Pod.3pm.html">Test::Pod.3pm: Check for pod errors in files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
