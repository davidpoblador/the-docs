<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SNMP::Extension::PassPersist: Generic pass/pass_persist extension framework for net-snmp</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Generic pass/pass_persist extension framework for net-snmp">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="SNMP::Extension::PassPersist (3pm) manual">
  <meta name="twitter:description" content="Generic pass/pass_persist extension framework for net-snmp">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsnmp-extension-passpersist-perl-SNMP::Extension::PassPersist-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/SNMP::Extension::PassPersist.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="SNMP::Extension::PassPersist (3pm) manual" />
  <meta property="og:description" content="Generic pass/pass_persist extension framework for net-snmp" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsnmp-extension-passpersist-perl-SNMP::Extension::PassPersist-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">SNMP::Extension::PassPersist<small> (3pm)</small></h1>
        <p class="lead">Generic pass/pass_persist extension framework for net-snmp</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/SNMP::Extension::PassPersist.3pm.html">
      <span itemprop="name">SNMP::Extension::PassPersist: Generic pass/pass_persist extension framework for net-snmp</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsnmp-extension-passpersist-perl/">
      <span itemprop="name">libsnmp-extension-passpersist-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/SNMP::Extension::PassPersist.3pm.html">
      <span itemprop="name">SNMP::Extension::PassPersist: Generic pass/pass_persist extension framework for net-snmp</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This is the documentation of \*(C`SNMP::Extension::PassPersist\*(C' version 0.07</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Typical setup for a \*(C`pass\*(C' program:</p>
<pre>
    use strict;
    use SNMP::Extension::PassPersist;

    # create the object
    my $extsnmp = SNMP::Extension::PassPersist-&gt;new;

    # add a few OID entries
    $extsnmp-&gt;add_oid_entry($oid, $type, $value);
    $extsnmp-&gt;add_oid_entry($oid, $type, $value);

    # run the program
    $extsnmp-&gt;run;
</pre>
<p>Typical setup for a \*(C`pass_persist\*(C' program:</p><p>    use strict;     use SNMP::Extension::PassPersist;</p><p>    my $extsnmp = SNMP::Extension::PassPersist-&gt;new(         backend_collect =&gt; &#92;&update_tree     );     $extsnmp-&gt;run;</p><p>    sub update_tree {         my ($self) = @_;</p><p>        # add a serie of OID entries         $self-&gt;add_oid_entry($oid, $type, $value);         ...</p><p>        # or directly add a whole OID tree         $self-&gt;add_oid_tree(&#92;%oid_tree);     }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module is a framework for writing Net-SNMP extensions using the \*(C`pass\*(C' or \*(C`pass_persist\*(C' mechanisms.</p><p>When in \*(C`pass_persist\*(C' mode, it provides a mechanism to spare ressources by quitting from the main loop after a given number of idle cycles.</p><p>This module can use \*(C`Sort::Key::OID\*(C' when it is available, for sorting OIDs faster than with the internal pure Perl function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>\fInew()\fP</h3>
<p>Creates a new object. Can be given any attributes as a hash or hashref. See \*(L"\s-1ATTRIBUTES\s0\*(R" for the list of available attributes.</p><p><strong>Examples:</strong></p><p>For a \*(C`pass\*(C' command, most attributes are useless:</p><p>    my $extsnmp = SNMP::Extension::PassPersist-&gt;new;</p><p>For a \*(C`pass_persist\*(C' command, you'll usually want to at least set the \*(C`backend_collect\*(C' callback:</p><p>    my $extsnmp = SNMP::Extension::PassPersist-&gt;new(         backend_collect =&gt; &#92;&update_tree,         idle_count      =&gt; 10,      # no more than 10 idle cycles         refresh         =&gt; 10,      # refresh every 10 sec     );</p>
<h3>\fIrun()\fP</h3>
<p>This method does the following things:</p><ul>
<li><p>process the command line arguments in order to decide in which mode the program has to be executed</p></li><li><p>call the backend init callback</p></li><li><p>call the backend collect callback a first time</p></li>
</ul><p>Then, when in \*(C`pass\*(C' mode, the corresponding \s-1SNMP\s0 command is executed, its result is printed on the output filehandle, and \*(C`run()\*(C' returns.</p><p>When in \*(C`pass_persist\*(C' mode, \*(C`run()\*(C' enters a loop, reading Net-SNMP queries on its input filehandle, processing them, and printing result on its output filehandle. The backend collect callback is called every \*(C`refresh\*(C' seconds. If no query is read from the input after \*(C`idle_count\*(C' cycles, \*(C`run()\*(C' returns.</p>
<h3>add_oid_entry(\s-1FUNC_OID\s0, \s-1FUNC_TYPE\s0, \s-1FUNC_VALUE\s0)</h3>
<p>Add an entry to the \s-1OID\s0 tree.</p>
<h3>add_oid_tree(\s-1HASH\s0)</h3>
<p>Merge an \s-1OID\s0 tree to the main \s-1OID\s0 tree, using the same structure as the one of the \s-1OID\s0 tree itself.</p>
<h3>\fIdump_oid_tree()\fP</h3>
<p>Print a complete listing of the \s-1OID\s0 tree on the output file handle.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ATTRIBUTES</h2>
        <div class="sectioncontent">
<p>This module's attributes are generated by \*(C`Class::Accessor\*(C', and can therefore be passed as arguments to \*(C`new()\*(C' or called as object methods.</p><h3>backend_collect</h3>
<p>Set the code reference for the <em>collect</em> callback. See also \*(L"\s-1CALLBACKS\s0\*(R".</p>
<h3>backend_fork</h3>
<p>When set to true, the backend callbacks will be executed in a separate process. Default value is false.</p>
<h3>backend_init</h3>
<p>Set the code reference for the <em>init</em> callback. See also \*(L"\s-1CALLBACKS\s0\*(R".</p>
<h3>backend_pipe</h3>
<p>Contains the pipe used to communicate with the backend child, when executed in a separate process.</p>
<h3>dispatch</h3>
<p>Gives access to the internal dispatch table, stored as a hash with the following structure:</p><p>    dispatch =&gt; {         SNMP_CMD  =&gt;  { nargs =&gt; NUMBER_ARGS,  code =&gt; CODEREF },         ...     }</p><p>where the \s-1SNMP\s0 command is always in lowercase, \*(C`nargs\*(C' gives the number of arguments expected by the command and \*(C`code\*(C' the callback reference.</p><p>You should not modify this table unless you really know what you're doing.</p>
<h3>heap</h3>
<p>Give access to the heap.</p>
<h3>idle_count</h3>
<p>Get/set the number of idle cycles before ending the run loop.</p>
<h3>input</h3>
<p>Get/set the input filehandle.</p>
<h3>oid_tree</h3>
<p>Gives access to the internal \s-1OID\s0 tree, stored as a hash with the following structure:</p><p>    oid_tree =&gt; {         FUNC_OID  =&gt;  [ FUNC_TYPE, FUNC_VALUE ],         ...     }</p><p>where \*(C`FUNC_OID\*(C' is the absolute \s-1OID\s0 of the \s-1SNMP\s0 function, \*(C`FUNC_TYPE\*(C' the function type ("integer", "counter", "gauge", etc), and \*(C`FUNC_VALUE\*(C' the function value.</p><p>You should not directly modify this hash but instead use the appropriate methods for adding \s-1OID\s0 entries.</p>
<h3>output</h3>
<p>Get/set the output filehandle.</p>
<h3>refresh</h3>
<p>Get/set the refresh delay before calling the backend collect callback to update the \s-1OID\s0 tree.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CALLBACKS</h2>
        <div class="sectioncontent">
<p>The callbacks are invoked with the corresponding object as first argument, as for a normal method. A heap is available for storing user-defined data.</p><p>In the specific case of a programm running in \*(C`pass_persist\*(C' mode with a forked backend, the callbacks are only executed in the child process (the forked backend).</p><p>The currently implemented callbacks are:</p><ul>
<li><p>init This callback is called once, before the first <em>collect</em> invocation and before the main loop. It can be accessed and modified through the \*(C`backend_init\*(C' attribute.</p></li><li><p>collect This callback is called every \*(C`refresh\*(C' seconds so the user can update the \s-1OID\s0 tree using the \*(C`add_oid_entry()\*(C' and \*(C`add_oid_tree()\*(C' methods.</p></li>
</ul><h3>Examples</h3>
<p>For simple needs, only the <em>collect</em> callback needs to be defined:</p><p>    my $extsnmp = SNMP::Extension::PassPersist-&gt;new(         backend_collect =&gt; &#92;&update_tree,     );</p><p>    sub update_tree {         my ($self) = @_;</p><p>        # fetch the number of running processes         my $nb_proc = @{ Proc::ProcessTable-&gt;new-&gt;table };</p><p>        $self-&gt;add_oid_entry(".1.3.6.1.4.1.32272.10", gauge", $nb_proc);     }</p><p>A more advanced example is when there is a need to connect to a database, in which case both the <em>init</em> and <em>collect</em> callback need to be defined:</p><p>    my $extsnmp = SNMP::Extension::PassPersist-&gt;new(         backend_init    =&gt; &#92;&connect_db,         backend_collect =&gt; &#92;&update_tree,     );</p><p>    sub connect_db {         my ($self) = @_;         my $heap = $self-&gt;heap;</p><p>        # connect to a database         my $dbh = DBI-&gt;connect($dsn, $user, $password);         $heap-&gt;{dbh} = $dbh;     }</p><p>    sub update_tree {         my ($self) = @_;         my $heap = $self-&gt;heap;</p><p>        # fetch the number of records from a given table         my $dbh = $heap-&gt;{dbh};         my $sth = $dbh-&gt;prepare_cached("SELECT count(*) FROM whatever");         $sth-&gt;execute;         my ($count) = $sth-&gt;fetchrow_array;</p><p>        $self-&gt;add_oid_entry(".1.3.6.1.4.1.32272.20", "gauge", $count);     }</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO SNMP::Extension::PassPersist&hellip;</h2>
        <div class="sectioncontent">
<p>SNMP::Persist is another pass_persist backend for writing Net-SNMP extensions, but relies on threads.</p><p>The documentation of Net-SNMP, especially the part on how to configure a \*(C`pass\*(C' or \*(C`pass_persist\*(C' extension:</p><ul>
<li><p>main site: http://www.net-snmp.org/ &lt;http://www.net-snmp.org/&gt;</p></li><li><p>configuring a pass or pass_persist extension: http://www.net-snmp.org/docs/man/snmpd.conf.html#lbBB &lt;http://www.net-snmp.org/docs/man/snmpd.conf.html#lbBB&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any bugs or feature requests to \*(C`bug-snmp-extension-passpersist at rt.cpan.org\*(C', or through the web interface at http://rt.cpan.org/Public/Dist/Display.html?Name=SNMP-Extension-PassPersist &lt;http://rt.cpan.org/Public/Dist/Display.html?Name=SNMP-Extension-PassPersist&gt;. I will be notified, and then you'll automatically be notified of progress on your bug as I make changes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>You can find documentation for this module with the perldoc command.</p><p>    perldoc SNMP::Extension::PassPersist</p><p>You can also look for information at:</p><ul>
<li><p>Search \s-1CPAN\s0 http://search.cpan.org/dist/SNMP-Extension-PassPersist &lt;http://search.cpan.org/dist/SNMP-Extension-PassPersist&gt;</p></li><li><p>Meta \s-1CPAN\s0 https://metacpan.org/release/SNMP-Extension-PassPersist &lt;https://metacpan.org/release/SNMP-Extension-PassPersist&gt;</p></li><li><p>\s-1RT:\s0 \s-1CPAN\s0's request tracker http://rt.cpan.org/Public/Dist/Display.html?Name=SNMP-Extension-PassPersist &lt;http://rt.cpan.org/Public/Dist/Display.html?Name=SNMP-Extension-PassPersist&gt;</p></li><li><p>AnnoCPAN: Annotated \s-1CPAN\s0 documentation http://annocpan.org/dist/SNMP-Extension-PassPersist &lt;http://annocpan.org/dist/SNMP-Extension-PassPersist&gt;</p></li><li><p>\s-1CPAN\s0 Ratings http://cpanratings.perl.org/d/SNMP-Extension-PassPersist &lt;http://cpanratings.perl.org/d/SNMP-Extension-PassPersist&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Se\*'bastien Aperghis-Tramoni, \*(C`&lt;sebastien at aperghis.net&gt;\*(C'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT & LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright 2008-2011 Se\*'bastien Aperghis-Tramoni, all rights reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="SGML::DTDParse::Util.3pm.html"><span aria-hidden="true">&larr;</span> SGML::DTDParse::Util.3pm: Dtdparse utility routines.</a></li>
   <li class="next"><a href="SNMP::MIB::Compiler.3pm.html">SNMP::MIB::Compiler.3pm: A mib compiler supporting smiv1 and smiv2 <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
