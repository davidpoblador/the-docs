<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>qbatomic.h: Basic atomic integer and pointer operations.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Basic atomic integer and pointer operations.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="qbatomic.h (3) manual">
  <meta name="twitter:description" content="Basic atomic integer and pointer operations.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libqb-dev-qbatomic.h-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/qbatomic.h.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="qbatomic.h (3) manual" />
  <meta property="og:description" content="Basic atomic integer and pointer operations." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libqb-dev-qbatomic.h-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">qbatomic.h<small> (3)</small></h1>
        <p class="lead">Basic atomic integer and pointer operations.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/qbatomic.h.3.html">
      <span itemprop="name">qbatomic.h: Basic atomic integer and pointer operations.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libqb-dev/">
      <span itemprop="name">libqb-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/qbatomic.h.3.html">
      <span itemprop="name">qbatomic.h: Basic atomic integer and pointer operations.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;stdint.h&gt;</p><p>#include &lt;qb/qbdefs.h&gt;</p><p>#include &lt;qb/qbconfig.h&gt;</p><h3>Defines</h3>
<p>#define <strong>qb_atomic_int_get</strong>(atomic)</p><p>#define <strong>qb_atomic_int_set</strong>(atomic, newval)</p><p>#define <strong>qb_atomic_pointer_get</strong>(atomic)</p><p>#define <strong>qb_atomic_pointer_set</strong>(atomic, newval)</p><p>#define <strong>qb_atomic_int_inc</strong>(atomic)   (<strong>qb_atomic_int_add</strong> ((atomic), 1))</p><p><em>Atomically increments the integer pointed to by atomic by 1. </em> #define <strong>qb_atomic_int_dec_and_test</strong>(atomic)   (<strong>qb_atomic_int_exchange_and_add</strong> ((atomic), -1) == 1)</p><p><em>Atomically decrements the integer pointed to by atomic by 1. </em></p>
<h3>Functions</h3>
<p>void <strong>qb_atomic_init</strong> (void)</p><p>int32_t <strong>qb_atomic_int_exchange_and_add</strong> (volatile int32_t <strong>QB_GNUC_MAY_ALIAS</strong> *atomic, int32_t val)</p><p><em>Atomically adds val to the integer pointed to by atomic. </em> void <strong>qb_atomic_int_add</strong> (volatile int32_t <strong>QB_GNUC_MAY_ALIAS</strong> *atomic, int32_t val)</p><p><em>Atomically adds val to the integer pointed to by atomic. </em> int32_t <strong>qb_atomic_int_compare_and_exchange</strong> (volatile int32_t <strong>QB_GNUC_MAY_ALIAS</strong> *atomic, int32_t oldval, int32_t newval)</p><p><em>Compares oldval with the integer pointed to by atomic and if they are equal, atomically exchanges *atomic with newval. </em> int32_t <strong>qb_atomic_pointer_compare_and_exchange</strong> (volatile void *<strong>QB_GNUC_MAY_ALIAS</strong> *atomic, void *oldval, void *newval)</p><p><em>Compares oldval with the pointer pointed to by atomic and if they are equal, atomically exchanges *atomic with newval. </em> int32_t <strong>qb_atomic_int_get</strong> (volatile int32_t <strong>QB_GNUC_MAY_ALIAS</strong> *atomic)</p><p><em>Reads the value of the integer pointed to by atomic. </em> void <strong>qb_atomic_int_set</strong> (volatile int32_t <strong>QB_GNUC_MAY_ALIAS</strong> *atomic, int32_t newval)</p><p><em>Sets the value of the integer pointed to by atomic. </em> void * <strong>qb_atomic_pointer_get</strong> (volatile void *<strong>QB_GNUC_MAY_ALIAS</strong> *atomic)</p><p><em>Reads the value of the pointer pointed to by atomic. </em> void <strong>qb_atomic_pointer_set</strong> (volatile void *<strong>QB_GNUC_MAY_ALIAS</strong> *atomic, void *newval)</p><p><em>Sets the value of the pointer pointed to by atomic. </em></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p>Basic atomic integer and pointer operations.</p><p>The following functions can be used to atomically access integers and pointers. They are implemented as inline assembler function on most platforms and use slower fall-backs otherwise. Using them can sometimes save you from using a performance-expensive pthread_mutex to protect the integer or pointer.</p><p>The most important usage is reference counting. Using <strong>qb_atomic_int_inc()</strong> and <strong>qb_atomic_int_dec_and_test()</strong> makes reference counting a very fast operation.</p><p>You must not directly read integers or pointers concurrently accessed by multiple threads, but use the atomic accessor functions instead. That is, always use <strong>qb_atomic_int_get()</strong> and <strong>qb_atomic_pointer_get()</strong> for read outs. They provide the neccessary synchonization mechanisms like memory barriers to access memory locations concurrently.</p><p>If you are using those functions for anything apart from simple reference counting, you should really be aware of the implications of doing that. There are literally thousands of ways to shoot yourself in the foot. So if in doubt, use a pthread_mutex. If you don't know, what memory barriers are, do not use anything but <strong>qb_atomic_int_inc()</strong> and <strong>qb_atomic_int_dec_and_test()</strong>.</p><p>It is not safe to set an integer or pointer just by assigning to it, when it is concurrently accessed by other threads with the following functions. Use <strong>qb_atomic_int_compare_and_exchange()</strong> or <strong>qb_atomic_pointer_compare_and_exchange()</strong> respectively.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Define Documentation</h2>
        <div class="sectioncontent">
<h3>#define \fBqb_atomic_int_dec_and_test\fP(atomic)   (\fBqb_atomic_int_exchange_and_add\fP ((atomic), -1) == 1)</h3>
<p>Atomically decrements the integer pointed to by atomic by 1. <strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><strong>Returns:</strong></p><p>QB_TRUE if the integer pointed to by atomic is 0 after decrementing it</p>
<h3>#define \fBqb_atomic_int_get\fP(atomic) \fBValue:\fP</h3>

<pre>
((void) sizeof (char* [sizeof (*(atomic)) == sizeof (int32_t) ? 1 : -1]),    (qb_atomic_int_get) ((volatile int32_t QB_GNUC_MAY_ALIAS *) (volatile void *) (atomic)))
</pre>

<h3>#define \fBqb_atomic_int_inc\fP(atomic)   (\fBqb_atomic_int_add\fP ((atomic), 1))</h3>
<p>Atomically increments the integer pointed to by atomic by 1. <strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer.</p>
<h3>#define \fBqb_atomic_int_set\fP(atomic, newval) \fBValue:\fP</h3>

<pre>
((void) sizeof (char* [sizeof (*(atomic)) == sizeof (int32_t) ? 1 : -1]),    (qb_atomic_int_set) ((volatile int32_t QB_GNUC_MAY_ALIAS *) (volatile void *) (atomic), (newval)))
</pre>

<h3>#define \fBqb_atomic_pointer_get\fP(atomic) \fBValue:\fP</h3>

<pre>
((void) sizeof (char* [sizeof (*(atomic)) == sizeof (void*) ? 1 : -1]),    (qb_atomic_pointer_get) ((volatile void* QB_GNUC_MAY_ALIAS *) (volatile void *) (atomic)))
</pre>

<h3>#define \fBqb_atomic_pointer_set\fP(atomic, newval) \fBValue:\fP</h3>

<pre>
((void) sizeof (char* [sizeof (*(atomic)) == sizeof (void*) ? 1 : -1]),    (qb_atomic_pointer_set) ((volatile void* QB_GNUC_MAY_ALIAS *) (volatile void *) (atomic), (newval)))
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Function Documentation</h2>
        <div class="sectioncontent">
<h3>void \fBqb_atomic_init\fP (void)</h3>

<h3>void \fBqb_atomic_int_add\fP (volatile int32_t \fBQB_GNUC_MAY_ALIAS\fP *atomic, int32_tval)</h3>
<p>Atomically adds val to the integer pointed to by atomic. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><em>val</em> the value to add to *atomic</p>
<h3>int32_t \fBqb_atomic_int_compare_and_exchange\fP (volatile int32_t \fBQB_GNUC_MAY_ALIAS\fP *atomic, int32_toldval, int32_tnewval)</h3>
<p>Compares oldval with the integer pointed to by atomic and if they are equal, atomically exchanges *atomic with newval. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><em>oldval</em> the assumed old value of *atomic</p><p><em>newval</em> the new value of *atomic</p><p><strong>Returns:</strong></p><p>QB_TRUE, if *atomic was equal oldval. QB_FALSE otherwise.</p>
<h3>int32_t \fBqb_atomic_int_exchange_and_add\fP (volatile int32_t \fBQB_GNUC_MAY_ALIAS\fP *atomic, int32_tval)</h3>
<p>Atomically adds val to the integer pointed to by atomic. It returns the value of *atomic just before the addition took place. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><em>val</em> the value to add to *atomic</p><p><strong>Returns:</strong></p><p>the value of *atomic before the addition.</p>
<h3>int32_t \fBqb_atomic_int_get\fP (volatile int32_t \fBQB_GNUC_MAY_ALIAS\fP *atomic)</h3>
<p>Reads the value of the integer pointed to by atomic. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><strong>Returns:</strong></p><p>the value of atomic</p>
<h3>void \fBqb_atomic_int_set\fP (volatile int32_t \fBQB_GNUC_MAY_ALIAS\fP *atomic, int32_tnewval)</h3>
<p>Sets the value of the integer pointed to by atomic. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to an integer</p><p><em>newval</em> the new value</p>
<h3>int32_t \fBqb_atomic_pointer_compare_and_exchange\fP (volatile void *\fBQB_GNUC_MAY_ALIAS\fP *atomic, void *oldval, void *newval)</h3>
<p>Compares oldval with the pointer pointed to by atomic and if they are equal, atomically exchanges *atomic with newval. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to a void*</p><p><em>oldval</em> the assumed old value of *atomic</p><p><em>newval</em> the new value of *atomic</p><p><strong>Returns:</strong></p><p>QB_TRUE if atomic was equal oldval, else QB_FALSE.</p>
<h3>void* \fBqb_atomic_pointer_get\fP (volatile void *\fBQB_GNUC_MAY_ALIAS\fP *atomic)</h3>
<p>Reads the value of the pointer pointed to by atomic. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to a void*.</p><p><strong>Returns:</strong></p><p>the value to add to atomic.</p>
<h3>void \fBqb_atomic_pointer_set\fP (volatile void *\fBQB_GNUC_MAY_ALIAS\fP *atomic, void *newval)</h3>
<p>Sets the value of the pointer pointed to by atomic. Also acts as a memory barrier.</p><p><strong>Parameters:</strong></p><p><em>atomic</em> a pointer to a void*</p><p><em>newval</em> the new value</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for libqb from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="qbarray.h.3.html"><span aria-hidden="true">&larr;</span> qbarray.h.3: This is a dynamic array (it can grow, but without moving memory).</a></li>
   <li class="next"><a href="qbhdb.h.3.html">qbhdb.h.3: The handle database is for reference counting objects. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
