<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MIDI::Opus: Functions and methods for midi opuses</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Functions and methods for midi opuses">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="MIDI::Opus (3pm) manual">
  <meta name="twitter:description" content="Functions and methods for midi opuses">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmidi-perl-MIDI::Opus-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/MIDI::Opus.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="MIDI::Opus (3pm) manual" />
  <meta property="og:description" content="Functions and methods for midi opuses" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmidi-perl-MIDI::Opus-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">MIDI::Opus<small> (3pm)</small></h1>
        <p class="lead">Functions and methods for midi opuses</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/MIDI::Opus.3pm.html">
      <span itemprop="name">MIDI::Opus: Functions and methods for midi opuses</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmidi-perl/">
      <span itemprop="name">libmidi-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/MIDI::Opus.3pm.html">
      <span itemprop="name">MIDI::Opus: Functions and methods for midi opuses</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
 use MIDI; # uses MIDI::Opus et al
 foreach $one (@ARGV) {
   my $opus = MIDI::Opus-&gt;new({ 'from_file' =&gt; $one, 'no_parse' =&gt; 1 });
   print "$one has ", scalar( $opus-&gt;tracks ) " tracks&#92;n";
 }
 exit;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>MIDI::Opus provides a constructor and methods for objects representing a \s-1MIDI\s0 opus (\s-1AKA\s0 \*(L"song\*(R").  It is part of the \s-1MIDI\s0 suite.</p><p>An opus object has three attributes: a format (0 for \s-1MIDI\s0 Format 0), a tick parameter (parameter \*(L"division\*(R" in MIDI::Filespec), and a list of tracks objects that are the real content of that opus.</p><p>Be aware that options specified for the encoding or decoding of an opus may not be documented in <em>this</em> module's documentation, as they may be (and, in fact, generally are) options just passed down to the decoder/encoder in MIDI::Event \*(-- so see MIDI::Event for an explanation of most of them, actually.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR AND METHODS</h2>
        <div class="sectioncontent">
<p>MIDI::Opus provides...</p>
<dl class='dl-vertical'>
  <dt>
    the constructor MIDI::Opus-&gt;new({ ...options... })
  </dt>
  <dd>
    <p>This returns a new opus object.  The options, which are optional, is an anonymous hash.  By default, you get a new format-0 opus with no tracks and a tick parameter of 96.  There are six recognized options: \*(C`format\*(C', to set the \s-1MIDI\s0 format number (generally either 0 or 1) of the new object; \*(C`ticks\*(C', to set its ticks parameter; \*(C`tracks\*(C', which sets the tracks of the new opus to the contents of the list-reference provided; \*(C`tracks_r\*(C', which is an exact synonym of \*(C`tracks\*(C'; \*(C`from_file\*(C', which reads the opus from the given filespec; and \*(C`from_handle\*(C', which reads the opus from the the given filehandle reference (e.g., *STDIN{IO}), after having called <em>binmode()</em> on that handle, if that's a problem. If you specify either \*(C`from_file\*(C' or \*(C`from_handle\*(C', you probably don't want to specify any of the other options \*(-- altho you may well want to specify options that'll get passed down to the decoder in MIDI::Events, such as 'include' =&gt; ['sysex_f0', 'sysex_f7'], just for example. Finally, the option \*(C`no_parse\*(C' can be used in conjuction with either \*(C`from_file\*(C' or \*(C`from_handle\*(C', and, if true, will block MTrk tracks' data from being parsed into \s-1MIDI\s0 events, and will leave them as track data (i.e., what you get from $track-&gt;data).  This is useful if you are just moving tracks around across files (or just counting them in files, as in the code in the Synopsis, above), without having to deal with any of the events in them.  (Actually, this option is implemented in code in MIDI::Track, but in a routine there that I've left undocumented, as you should access it only thru here.) This duplicates the contents of the given opus, and returns the duplicate.  If you are unclear on why you may need this function, read the documentation for the \*(C`copy\*(C' method in MIDI::Track. Returns the list of tracks in the opus, possibly after having set it to @tracks, if specified and not empty.  (If you happen to want to set the list of tracks to an empty list, for whatever reason, you have to use \*(L"$opus-&gt;tracks_r([])\*(R".) In other words: $opus-&gt;tracks(@tracks) is how to set the list of tracks (assuming @tracks is not empty), and @tracks = $opus-&gt;tracks is how to read the list of tracks. Returns a reference to the list of tracks in the opus, possibly after having set it to $tracks_r, if specified.  \*(L"$tracks_r\*(R" can actually be any listref, whether it comes from a scalar as in $some_tracks_r, or from something like \*(C`[@tracks]\*(C', or just plain old \*(C`&#92;@tracks\*(C' Originally $opus-&gt;tracks was the only way to deal with tracks, but I added $opus-&gt;tracks_r to make possible 1) setting the list of tracks to (), for whatever that's worth, 2) parallel structure between MIDI::Opus::tracks[_r] and MIDI::Tracks::events[_r] and 3) so you can directly manipulate the opus's tracks, without having to <em>copy</em> the list of tracks back and forth.  This way, you can say:           $tracks_r = $opus-&gt;tracks_r();           @some_stuff = splice(@$tracks_r, 4, 6); But if you don't know how to deal with listrefs like that, that's \s-1OK\s0, just use $opus-&gt;tracks. Returns the tick parameter from $opus, after having set it to $tick_parameter, if provided. Returns the \s-1MIDI\s0 format for $opus, after having set it to $format, if provided. Dumps the opus object as a bunch of text, for your perusal.  Options include: \*(C`flat\*(C', if true, will have each event in the opus as a tab-delimited line \*(-- or as delimited with whatever you specify with option \*(C`delimiter\*(C'; <em>otherwise</em>, dump the data as Perl code that, if run, would/should reproduce the opus.  For concision's sake, the track data isn't dumped, unless you specify the option \*(C`dump_tracks\*(C' as true. Writes $opus as a \s-1MIDI\s0 file named by the given filespec. The options hash is optional, and whatever you specify as options percolates down to the calls to MIDI::Event::encode \*(-- which see. Currently this just opens the file, calls $opus-&gt;write_to_handle on the resulting filehandle, and closes the file. Writes $opus as a \s-1MIDI\s0 file to the \s-1IO\s0 handle you pass a reference to (example: *STDOUT{IO}). The options hash is optional, and whatever you specify as options percolates down to the calls to MIDI::Event::encode \*(-- which see. Note that this is probably not what you'd want for sending music to \*(C`/dev/sequencer\*(C', since \s-1MIDI\s0 files are not MIDI-on-the-wire. This currently experimental method returns a new \s-1GD\s0 image object that's a graphic representation of the notes in the given opus.  Options include: \*(C`width\*(C' \*(-- the width of the image in pixels (defaults to 600); \*(C`bgcolor\*(C' \*(-- a six-digit hex \s-1RGB\s0 representation of the background color for the image (defaults to $MIDI::Opus::BG_color, currently '000000'); \*(C`channel_colors\*(C' \*(-- a reference to a list of colors (in six-digit hex \s-1RGB\s0) to use for representing notes on given channels. Defaults to @MIDI::Opus::Channel_colors. This list is a list of pairs of colors, such that: the first of a pair (color N*2) is the color for the first pixel in a note on channel N; and the second (color N*2 + 1) is the color for the remaining pixels of that note.  If you specify only enough colors for channels 0 to M, notes on a channels above M will use 'recycled' colors \*(-- they will be plotted with the color for channel \*(L"channel_number % M\*(R" (where \*(C`%\*(C' = the \s-1MOD\s0 operator). This means that if you specify           channel_colors =&gt; ['00ffff','0000ff'] then all the channels' notes will be plotted with an aqua pixel followed by blue ones; and if you specify           channel_colors =&gt; ['00ffff','0000ff', 'ff00ff','ff0000'] then all the <em>even</em> channels' notes will be plotted with an aqua pixel followed by blue ones, and all the <em>odd</em> channels' notes will be plotted with a purple pixel followed by red ones. As to what to do with the object you get back, you probably want something like:           $im = $chachacha-&gt;draw;           open(OUT, "&gt;$gif_out"); binmode(OUT);           print OUT $im-&gt;gif;           close(OUT); Using this method will cause a \*(C`die\*(C' if it can't successfully \*(C`use GD\*(C'. I emphasise that \*(C`draw\*(C' is expermental, and, in any case, is only meant to be a crude hack.  Notably, it does not address well some basic problems: neither volume nor patch-selection (nor any notable aspects of the patch selected) are represented; pitch-wheel changes are not represented; percussion (whether on percussive patches or on channel 10) is not specially represented, as it probably should be; notes overlapping are not represented at all well.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WHERE'S THE DESTRUCTOR?</h2>
        <div class="sectioncontent">
<p>Because \s-1MIDI\s0 objects (whether opuses or tracks) do not contain any circular data structures, you don't need to explicitly destroy them in order to deallocate their memory.  Consider this code snippet:</p><p> use MIDI;  foreach $one (@ARGV) {    my $opus = MIDI::Opus-&gt;new({ 'from_file' =&gt; $one, 'no_parse' =&gt; 1 });    print "$one has ", scalar( $opus-&gt;tracks ) " tracks&#92;n";  }</p><p>At the end of each iteration of the foreach loop, the variable $opus goes away, along with its contents, a reference to the opus object. Since no other references to it exist (i.e., you didn't do anything like push(@All_opuses,$opus) where @All_opuses is a global), the object is automagically destroyed and its memory marked for recovery.</p><p>If you wanted to explicitly free up the memory used by a given opus object (and its tracks, if those tracks aren't used anywhere else) without having to wait for it to pass out of scope, just replace it with a new empty object:</p><p> $opus = MIDI::Opus-&gt;new;</p><p>or replace it with anything at all \*(-- or even just undef it:</p><p> undef $opus;</p><p>Of course, in the latter case, you can't then use $opus as an opus object anymore, since it isn't one.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTE ON TICKS</h2>
        <div class="sectioncontent">
<p>If you want to use \*(L"negative\*(R" values for ticks (so says the spec: \*(L"If division is negative, it represents the division of a second represented by the delta-times in the file,[...]\*(R"), then it's up to you to figure out how to represent that whole ball of wax so that when it gets \*(C`pack()\*(C''d as an \*(L"n\*(R", it comes out right.  I think it'll involve something like:</p><p>  $opus-&gt;ticks(  (unpack('C', pack('c', -25)) &lt;&lt; 8) & 80  );</p><p>for bit resolution (80) at 25 f/s.</p><p>But I've never tested this.  Let me know if you get it working right, \s-1OK\s0?  If anyone <em>does</em> get it working right, and tells me how, I'll try to support it natively.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTE ON WARN-ING AND DIE-ING</h2>
        <div class="sectioncontent">
<p>In the case of trying to parse a malformed \s-1MIDI\s0 file (which is not a common thing, in my experience), this module (or MIDI::Track or MIDI::Event) may <em>warn()</em> or <em>die()</em> (Actually, <em>carp()</em> or <em>croak()</em>, but it's all the same in the end).  For this reason, you shouldn't use this suite in a case where the script, well, can't warn or die \*(-- such as, for example, in a \s-1CGI\s0 that scans for text events in a uploaded \s-1MIDI\s0 file that may or may not be well-formed.  If this <em>is</em> the kind of task you or someone you know may want to do, let me know and I'll consider some kind of 'no_die' parameter in future releases. (Or just trap the die in an eval { } around your call to anything you think you could die.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (c) 1998-2002 Sean M. Burke. All rights reserved.</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Sean M. Burke \*(C`sburke@cpan.org\*(C'</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="MIDI::Filespec.3pm.html"><span aria-hidden="true">&larr;</span> MIDI::Filespec.3pm: Midi file specification</a></li>
   <li class="next"><a href="MIDI::Score.3pm.html">MIDI::Score.3pm: Midi scores <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
