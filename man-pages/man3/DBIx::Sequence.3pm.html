<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DBIx::Sequence: A simple sql92 id generator</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A simple sql92 id generator">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="DBIx::Sequence (3pm) manual">
  <meta name="twitter:description" content="A simple sql92 id generator">
  <meta name="twitter:image" content="https://www.carta.tech/images/libdbix-sequence-perl-DBIx::Sequence-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/DBIx::Sequence.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DBIx::Sequence (3pm) manual" />
  <meta property="og:description" content="A simple sql92 id generator" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libdbix-sequence-perl-DBIx::Sequence-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">DBIx::Sequence<small> (3pm)</small></h1>
        <p class="lead">A simple sql92 id generator</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Sequence.3pm.html">
      <span itemprop="name">DBIx::Sequence: A simple sql92 id generator</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libdbix-sequence-perl/">
      <span itemprop="name">libdbix-sequence-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Sequence.3pm.html">
      <span itemprop="name">DBIx::Sequence: A simple sql92 id generator</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use DBIx::Sequence;

  my $sequence = new DBIx::Sequence({ dbh =&gt; $dbh });
  my $next_id = $sequence-&gt;Next(&apos;dataset&apos;);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module is intended to give easier portability to Perl database application by providing a database independant unique \s-1ID\s0 generator. This way, an application developer is not bound to use his database's \s-1SEQUENCE\s0 or auto_increment thus making his application portable on multiple database environnements.</p><p>This module implements a simple Spin Locker mechanism and is garanteed to return a unique value every time it is called, even with concurrent processes. It uses your database for its state storage with \s-1ANSI\s0 \s-1SQL92\s0 compliant \s-1SQL\s0. All \s-1SQL\s0 queries inside DBIx::Sequence are pre cached and very efficient especially under mod_perl.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTALLATION</h2>
        <div class="sectioncontent">
<p>        perl Makefile.PL         make         make test         make install</p><p>Note:</p><p>If you decide to run extended tests for the module, you will have to provide the make test with a \s-1DSN\s0 (connect string) to your database (dbi:Driver:db;host=hostname) and a valid username/password combination for a privileged user.</p><p>DBIx::Sequence uses 2 tables for its operation, namely the dbix_sequence_state and the dbix_sequence_release tables. Those tables will be created if you run extended tests, if not you will need to create them yourself.</p><p>        dbix_sequence_state:         | dataset  | varchar(50) |         | state_id | int(11)     |</p><p>        dbix_sequence_release:         | dataset     | varchar(50) |         | released_id | int(11)     |</p><p>Those table names are overloadable at your convenience, see the \s-1OVERLOADING\s0 section for details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BASIC USAGE</h2>
        <div class="sectioncontent">
<p>The basic usage of this module is to generate a unique \s-1ID\s0 to replace the use of your database's \s-1SEQUENCE\s0 of auto_increment field.</p><h3>\s-1INIT\s0</h3>
<p>First, you need to create the sequence object:</p><p>        use DBIx::Sequence;         my $sequence = new DBIx::Sequence({                                                 db_user =&gt; &apos;scott&apos;,                                                 db_pw =&gt; &apos;tiger&apos;,                                                 db_dsn =&gt; &apos;dbi:mysql:scottdb&apos;,                                                 allow_id_reuse =&gt; 1,                                                 });</p><p>DBIx::Sequence can be used to manage multiple sets of \s-1ID\s0's (perhaps you could have one dataset per table, or one and only one dataset). This permits you to handle multiple applications with the same sequence class.  The dataset is normally simply a token string that represents your \s-1ID\s0 set. If the dataset does not exists, DBIx::Sequence will create automagically for you. No special steps are involved in the creation of a dataset.</p><p>The arguments contains the database informations, db_user, db_pw and db_dsn and are stored in a hash reference.</p><p>At this point, the object has pre cached all of the \s-1SQL\s0 that will be used to generate the spin locker race. It is normally a good idea to have a shared sequence object (especially) under mod_perl to save the prepare overhead.  The 'allow_id_reuse' argument can be passed to the constructor to either allow the use of the <em>Release()</em> or deny it. (True value makes it allowed)</p>
<h3>\s-1GETTING\s0 \s-1THE\s0 \s-1NEXT\s0 \s-1ID\s0</h3>
<p>To get the next id, you simpy have to use the <em>Next()</em> method of your sequence while specifying the dataset you are getting the next id for.</p><p>        my $next_id = $sequence-&gt;Next($dataset);</p>
<h3>\s-1RELEASING\s0 \s-1ID\s0'S.</h3>
<p>Generated \s-1ID\s0's can be _explicitly_ released in your application.  When an \s-1ID\s0 is released, the sequence will be able to give this id back to you throught the <em>Next()</em> method.</p><p>This is how it is done:</p><p>        $sequence-&gt;Release($dataset, $id);</p><p>Note:</p><p>You must use release only when you are _CERTAIN_ that your \s-1ID\s0 is not used anymore and that you want it to be recycled. The Spin Locking mechanism will also take place on released id's to ensure that no two processes can get the same \s-1ID\s0.</p>
<h3>\s-1PERMANENTLY\s0 \s-1REMOVING\s0 A \s-1DATASET\s0</h3>
<p>To make DBIx::Sequence forget about an existing dataset, you need to use the <em>Delete_Dataset()</em> method.</p><p>        $sequence-&gt;Delete_Dataset($dataset);</p><p>This will clear all state and existence for this dataset and will also clear it's released id's. Note that if your application still uses this dataset, it will be automatically recreated blank.</p>
<h3>\s-1BOOTSTRAPPING\s0 A \s-1DATASET\s0 \s-1FROM\s0 \s-1EXISTING\s0 \s-1DATA\s0</h3>
<p>It is possible to sync the state of a DBIx::Sequence dataset by using the <em>Bootstrap()</em> method.</p><p>        $sequence-&gt;Bootstrap(&apos;my_dataset&apos;,&apos;my_bootstrap_table&apos;,&apos;my_primary_field&apos;);</p><p><em>Bootstrap()</em> takes 3 arguments.</p><ul>
<li><p>The dataset to bootstrap</p></li><li><p>The table from wich you will bootstrap</p></li><li><p>The field in the bootstrap table that will be used to bootstrap the dataset.</p></li>
</ul><p>Bootstrap will then sync up the DBIx::Sequence's state with the maximum id of the 'my_primary_field' in 'my_bootstrap_table'. The bootstrap field must be a numeric field as you can suspect. The \s-1SQL\s0 function \s-1<em>MAX\s0()</em> will be called on it during the bootstrap process.</p><p>Note: The bootstrap method _can_ be used at runtime since it will initiate a race for updating the value thus following the same algorithm. It is recommended though that you use <em>Bootstrap()</em> when no other concurrent processes are requesting id's.</p>
<h3>\s-1OVERLOADING\s0</h3>
<p>It is possible to create an overloaded class of DBIx::Sequence. This permits you to create a DBIx::Sequence that has different properties than the orignal one. The only thing you really have to overload to modify the behaviour of DBIx::Sequence are some constants:</p><ul>
<li><p>\s-1STATE_TABLE\s0 : Defines the table used by DBIx::Sequence to store dataset's states.</p></li><li><p>\s-1RELEASE_TABLE\s0 : Defines the table used by DBIx::Sequence to store released id's.</p></li><li><p>\s-1COLUMN_PREFIX\s0 : A string to be prepended to every column in the internal \s-1SQL\s0 statements.</p></li><li><p>\s-1DEFAULT_INIT_VALUE\s0 : Value used to initialize a dataset when it is first created.</p></li><li><p>\s-1DEFAULT_ALLOW_ID_REUSE\s0 : When set to true, will allow the use of <em>Release()</em> if not specified in the constructor. (allow_id_reuse)</p></li><li><p>\s-1DEBUG_LEVEL\s0 : When set to true, will enable debugging to \s-1STDERR\s0.</p></li>
</ul><p>So it is very easy to specify the behaviour of DBIx::Sequence that you wish to use by creating an overloaded class.</p><p>Also, a very important method to overload is the <em>getDbh()</em> method. This is the function that returns the database handle to the DBIx::Sequence. Your overloaded class should redefine the getDbh method.</p><p>Overloading getDbh will make your sequence class integrate more cleanly with your application.</p><p>i.e.</p><p>        package MySequence;</p><p>        use DBI;         use DBIx::Sequence;</p><p>        use vars qw(@ISA);         @ISA = qw(DBIx::Sequence);</p><p>        use constant STATE_TABLE =&gt; &apos;my_state_table&apos;;         use constant RELEASE_TABLE =&gt; &apos;my_release_table&apos;;         use constant COLUMN_PREFIX =&gt; &apos;&apos;;         use constant DEFAULT_INIT_VALUE =&gt; &apos;100&apos;;         use constant DEFAULT_ALLOW_ID_REUSE =&gt; 1;         use constant DEBUG_LEVEL =&gt; 0;</p><p>        sub getDbh         {                 my $self = shift;</p><p>                return MyApplication::MyDBModule::getDbh();         }</p><p>        1;</p><p>Then, your code can use this class for its sequencing. Notice that since we overloaded <em>getDbh()</em>, we don't need to pass a second parameter to <em>new()</em>.</p><p>        use MySequence;</p><p>        my $sequence = new MySequence();         my $next_id = $sequence-&gt;Next($dataset);</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SPECIAL NOTE ON DATABASE HANDLE OPTIONS</h2>
        <div class="sectioncontent">
<p>DBIx::Sequence requires that the dbh object you passe to it has the AutoCommit flag set to 1. The main reason for this is that if AutoCommit is off, DBIx::Sequence will have to do an implicit <em>commit()</em> call, wich in most cases is a bad idea, especially when the dbh passed to the sequence object already has transactions prelogged in it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CVS AND BLEEDING VERSIONS</h2>
        <div class="sectioncontent">
<p>For the latest development information, \s-1CVS\s0 access and Changelog, please visit:</p><p>http://labs.turbulent.ca</p><p>If you use this module in a project, please let me know!</p><p>Your comments and rants are more than welcomed!</p><p>Commercial support for this module is available, please contact me for info!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TODO</h2>
        <div class="sectioncontent">
<ul>
<li><p>Implement multiple locking mechanism (semaphore, spin, db locker)</p></li><li><p>Implement pluggable locking module support</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Benoit Beausejour, &lt;bbeausej@pobox.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>This code was made possible by the help of individuals:</p><p>Philippe \*(L"Gozer\*(R" M. Chiasson &lt;gozer@cpan.org&gt;</p><p>Thanks to Uri Guttman for documentation checks ;)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTRIBUTORS</h2>
        <div class="sectioncontent">
<p>Here are the people who submitted patches and changes to the module, they have my thanks for their contributions:</p><p>Trevor Shellhorn &lt;trevor.schellhorn-perl@marketingtips.com&gt;</p><p>Dan Kubb &lt;dkubb@cpan.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO DBIx::Sequence&hellip;</h2>
        <div class="sectioncontent">
<p><em>perl</em>\|(1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (c) 2000 Benoit Beausejour &lt;bbeausej@pobox.com&gt; All rights reserved. This program is free software, you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="DBIx::Safe.3pm.html"><span aria-hidden="true">&larr;</span> DBIx::Safe.3pm: Safer access to your database through a dbi database handle</a></li>
   <li class="next"><a href="DBIx::Simple.3pm.html">DBIx::Simple.3pm: Easy-to-use oo interface to dbi <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
