<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libgps: C service library for communicating with the gps daemon</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="C service library for communicating with the gps daemon">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libgps (3) manual">
  <meta name="twitter:description" content="C service library for communicating with the gps daemon">
  <meta name="twitter:image" content="https://www.carta.tech/images/libgps-dev-libgps-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libgps.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libgps (3) manual" />
  <meta property="og:description" content="C service library for communicating with the gps daemon" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libgps-dev-libgps-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libgps<small> (3)</small></h1>
        <p class="lead">C service library for communicating with the gps daemon</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libgps.3.html">
      <span itemprop="name">libgps: C service library for communicating with the gps daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libgps-dev/">
      <span itemprop="name">libgps-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libgps.3.html">
      <span itemprop="name">libgps: C service library for communicating with the gps daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
C:

#include &lt;gps.h&gt;

</pre>
<p><strong>int gps_open(char&nbsp;*</strong><em>server</em><strong>, char&nbsp;*&nbsp;</strong><em>port</em><strong>, struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>);</strong> <strong>int gps_send(struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>, char&nbsp;*</strong><em>fmt</em><strong>...);</strong> <strong>int gps_read(struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>);</strong> <strong>bool gps_waiting(const&nbsp;struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>, int&nbsp;</strong><em>timeout</em><strong>);</strong> <strong>char *gps_data(const&nbsp;struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>);</strong> <strong>int gps_unpack(char&nbsp;*</strong><em>buf</em><strong>, struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>);</strong> <strong>void gps_close(struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>);</strong> <strong>int gps_stream(struct&nbsp;gps_data_t&nbsp;*</strong><em>gpsdata</em><strong>, unsigned&nbsp;int</strong><em>flags</em><strong>, void&nbsp;*</strong><em>data</em><strong>);</strong> <strong>const char *gps_errstr(int&nbsp;</strong><em>err</em><strong>);</strong></p>
<pre>
Python:

import gps

session = gps.gps(host="localhost", port="2947")

session.stream(flags=gps.WATCH_JSON)

for report in session:
    process(report)

del session

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>libgps</strong> is a service library which supports communicating with an instance of the <strong>gpsd</strong>(8); link it with the linker option -lgps.</p><p><strong>Warning</strong></p><p>Take care to conditionalize your code on the major and minor API version symbols in gps.h; ideally, force a compilation failure if GPSD_API_MAJOR_VERSION is not a version you recognize. See the GPSD project website for more information on the protocol and API changes.</p><p>Calling <strong>gps_open()</strong> initializes a GPS-data structure to hold the data collected by the GPS, and sets up access to <strong>gpsd</strong>(1) via either the socket or shared-memory export. The shared-memory export is faster, but does not carry information about device activation and deactivation events and will not allow you to monitor device packet traffic.</p><p><strong>gps_open()</strong> returns 0 on success, -1 on errors and is re-entrant. errno is set depending on the error returned from the socket or shared-memory interface; see gps.h for values and explanations; also see <strong>gps_errstr()</strong>. The host address may be a DNS name, an IPv4 dotted quad, an IPV6 address, or the special value <strong>GPSD_SHARED_MEMORY</strong> referring to the shared-memory export; the library will do the right thing for any of these.</p><p><strong>gps_close()</strong> ends the session.</p><p><strong>gps_send()</strong> writes a command to the daemon. It does nothing when using the shared-memory export. The second argument must be a format string containing elements from the command set documented at <strong>gpsd</strong>(1). It may have % elements as for <a href="../man3/sprintf.3.html"><strong>sprintf</strong>(3)</a>, which will be filled in from any following arguments. This function returns a -1 if there was a Unix-level write error, otherwise 0. Please read the LIMITATIONS section for additional information and cautions. See <strong>gps_stream()</strong> as a possible alternative.</p><p><strong>gps_read()</strong> accepts a response, or sequence of responses, from the daemon and interprets. This function does either a nonblocking read for data from the daemon or a fetch from shared memory; it returns a count of bytes read for success, -1 with errno set on a Unix-level read error, -1 with errno not set if the socket to the daemon has closed or if the shared-memory segment was unavailable, and 0 if no data is available.</p><p><strong>gps_waiting()</strong> can be used to check whether there is new data from the daemon. The second argument is the maximum amount of time to wait (in microseconds) on input before returning. It returns true if there is input waiting, false on timeout (no data waiting) or error condition. When using the socket export, this function is a convenience wrapper around a <a href="../man2/select.2.html"><strong>select</strong>(2)</a> call, and zeros <em>errno</em> on entry; you can test <em>errno</em> after exit to get more information about error conditions.</p><p><strong>gps_unpack()</strong> parses JSON from the argument buffer into the target of the session structure pointer argument. Included in case your application wishes to manage socket I/O itself.</p><p><strong>gps_data()</strong> returns the contents of the client data buffer (it returns NULL when using the shared-memory export). Use with care; this may fail to be a NUL-terminated string if WATCH_RAW is enabled.</p><p><strong>gps_stream()</strong> asks gpsd to stream the reports it has at you, to be made available when you poll (not available when using the shared-memory export). The second argument is a flag mask that sets various policy bits; see the list below. Calling <strong>gps_stream()</strong> more than once with different flag masks is allowed.</p><p>WATCH_DISABLE</p><p>Disable the reporting modes specified by the other WATCH_ flags.</p><p>WATCH_ENABLE</p><p>Disable the reporting modes specified by the other WATCH_ flags. This is the default.</p><p>WATCH_JSON</p><p>Enable JSON reporting of data. If WATCH_ENABLE is set, and no other WATCH flags are set, this is the default.</p><p>WATCH_NMEA</p><p>Enable generated pseudo-NMEA reporting on binary devices.</p><p>WATCH_RARE</p><p>Enable reporting of binary packets in encoded hex.</p><p>WATCH_RAW</p><p>Enable literal passthrough of binary packets.</p><p>WATCH_SCALED</p><p>When reporting AIS or Subframe data, scale integer quantities to floats if they have a divisor or rendering formula associated with them.</p><p>WATCH_NEWSTYLE</p><p>Force issuing a JSON initialization and getting new-style responses. This is the default.</p><p>WATCH_OLDSTYLE</p><p>Force issuing a W or R command and getting old-style responses. Warning: this flag (and the capability) will be removed in a future release.</p><p>WATCH_DEVICE</p><p>Restrict watching to a specified device, patch given as second argument.</p><p><strong>gps_errstr()</strong> returns an ASCII string (in English) describing the error indicated by a nonzero return value from <strong>gps_open()</strong>.</p><p>Consult gps.h to learn more about the data members and associated timestamps. Note that information will accumulate in the session structure over time, and the &apos;valid&apos; field is not automatically zeroed by each <strong>gps_read()</strong>. It is up to the client to zero that field when appropriate and to keep an eye on the fix and sentence timestamps.</p><p>The Python implementation supports the same facilities as the socket-export calls in the C library; there is no shared-memory interface. <strong>gps_open()</strong> is replaced by the initialization of a gps session object; the other calls are methods of that object, and have the same names as the corresponding C functions. However, it is simpler just to use the session object as an iterator, as in the example given below. Resources within the session object will be properly released when it is garbage-collected.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CODE EXAMPLE</h2>
        <div class="sectioncontent">
<p>The following is an excerpted and simplified version of the libgps interface code from <a href="../man1/cgps.1.html"><strong>cgps</strong>(1)</a>.</p>
<pre>
    struct gps_data_t gps_data;

    ret = gps_open(hostName, hostPort, &gps_data);

    (void) gps_stream(&gps_data, WATCH_ENABLE | WATCH_JSON, NULL);

    /* Put this in a loop with a call to a high resolution sleep () in it. */
    if (gps_waiting (&gps_data, 500)) {
        errno = 0;
        if (gps_read (&gps_data) == -1) {
            ...
        } else {
            /* Display data from the GPS receiver. */
            if (gps_data.set & ...
        }
    }

    /* When you are done... */
    (void) gps_stream(&gps_data, WATCH_DISABLE, NULL);
    (void) gps_close (&gps_data);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p>On some systems (those which do not support implicit linking in libraries) you may need to add -lm to your link line when you link libgps. It is always safe to do this.</p><p>In the C API, incautious use of <strong>gps_send()</strong> may lead to subtle bugs. In order to not bloat struct gps_data_t with space used by responses that are not expected to be shipped in close sequence with each other, the storage for fields associated with certain responses are combined in a union.</p><p>The risky set of responses includes VERSION, DEVICELIST, RTCM2, RTCM3, SUBFRAME, AIS, GST, and ERROR; it may not be limited to that set. The logic of the daemon&apos;s watcher mode is careful to avoid dangerous sequences, but you should read and understand the layout of struct gps_data_t before using <strong>gps_send()</strong> to request any of these responses.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPATIBILITY</h2>
        <div class="sectioncontent">
<p>The <strong>gps_query()</strong> supported in major versions 1 and 2 of this library has been removed. With the new streaming-oriented wire protocol behind this library, it is extremely unwise to assume that the first transmission from the daemon after a command is shipped to it will be the response to command.</p><p>If you must send commands to the daemon explicitly, use <strong>gps_send()</strong> but beware that this ties your code to the GPSD wire protocol. It is not recommended.</p><p>In earlier versions of the API <strong>gps_read()</strong> was a blocking call and there was a POLL_NONBLOCK option to make it nonblocking. <strong>gps_waiting()</strong> was added to reduce the number of wrong ways to code a polling loop.</p><p>See the comment above the symbol GPSD_API_MAJOR_VERSION in gps.h for recent changes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO libgps&hellip;</h2>
        <div class="sectioncontent">
<p><strong>gpsd</strong>(8), <a href="../man1/gps.1.html"><strong>gps</strong>(1)</a>, <strong>libgpsd</strong>(3). <a href="../man3/libgpsmm.3.html"><strong>libgpsmm</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Eric S. Raymond &lt;esr@thyrsus.com&gt;, C sample code Charles Curley &lt;charlescurley@charlescurley.com&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libgphoto2_port.3.html"><span aria-hidden="true">&larr;</span> libgphoto2_port.3: Cross-platform port access library</a></li>
   <li class="next"><a href="libgpsmm.3.html">libgpsmm.3: C++ and qt class wrapper for the gps daemon <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
