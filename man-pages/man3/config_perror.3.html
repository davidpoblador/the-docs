<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>config_perror: Netsnmp_config_api functions</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Netsnmp_config_api functions">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="config_perror (3) manual">
  <meta name="twitter:description" content="Netsnmp_config_api functions">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsnmp-dev-config_perror-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/config_perror.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="config_perror (3) manual" />
  <meta property="og:description" content="Netsnmp_config_api functions" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsnmp-dev-config_perror-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">config_perror<small> (3)</small></h1>
        <p class="lead">Netsnmp_config_api functions</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/config_perror.3.html">
      <span itemprop="name">config_perror: Netsnmp_config_api functions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsnmp-dev/">
      <span itemprop="name">libsnmp-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/config_perror.3.html">
      <span itemprop="name">config_perror: Netsnmp_config_api functions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;net-snmp/config_api.h&gt;</strong></p><h3>Config Handlers</h3>
<p><strong>struct config_line *</strong></p><p><strong>  register_config_handler(const char *</strong><em>filePrefix</em><strong>,</strong></p><p><strong>                     const char *</strong><em>token</em><strong>,</strong></p><p><strong>                     void (*</strong><em>parser</em><strong>)(const char *, char *),</strong></p><p><strong>                     void (*</strong><em>releaser</em><strong>)(void),</strong></p><p><strong>                     const char *</strong><em>usageLine</em><strong>);</strong></p><p><strong>struct config_line *</strong></p><p><strong>  register_const_config_handler(const char *</strong><em>filePrefix</em><strong>,</strong></p><p><strong>                     const char *</strong><em>token</em><strong>,</strong></p><p><strong>                     void (*</strong><em>parser</em><strong>)(const char *, const char *),</strong></p><p><strong>                     void (*</strong><em>releaser</em><strong>)(void),</strong></p><p><strong>                     const char *</strong><em>usageLine</em><strong>);</strong></p><p><strong>struct config_line *</strong></p><p><strong>  register_prenetsnmp_mib_handler(const char *</strong><em>filePrefix</em><strong>,</strong></p><p><strong>                     const char *</strong><em>token</em><strong>,</strong></p><p><strong>                     void (*</strong><em>parser</em><strong>)(const char *, char *),</strong></p><p><strong>                     void (*</strong><em>releaser</em><strong>)(void),</strong></p><p><strong>                     const char *</strong><em>usageLine</em><strong>);</strong></p><p><strong>void unregister_config_handler(const char *</strong><em>filePrefix</em><strong>,</strong></p><p><strong>                     const char *</strong><em>token</em><strong>);</strong></p><p><strong>void register_mib_handlers(void);</strong></p><p><strong>void unregister_all_config_handlers(void);</strong></p>
<h3>Application Handlers</h3>
<p><strong>struct config_line *</strong></p><p><strong>  register_app_config_handler(const char *</strong><em>token</em><strong>,</strong></p><p><strong>                     void (*</strong><em>parser</em><strong>)(const char *, char *),</strong></p><p><strong>                     void (*</strong><em>releaser</em><strong>)(void),</strong></p><p><strong>                     const char *</strong><em>usageLine</em><strong>);</strong></p><p><strong>struct config_line *</strong></p><p><strong>  register_app_prenetsnmp_mib_handler(const char *</strong><em>token</em><strong>,</strong></p><p><strong>                     void (*</strong><em>parser</em><strong>)(const char *, char *),</strong></p><p><strong>                     void (*</strong><em>releaser</em><strong>)(void),</strong></p><p><strong>                     const char *</strong><em>usageLine</em><strong>);</strong></p><p><strong>void unregister_app_config_handler(const char *</strong><em>token</em><strong>);</strong></p>
<h3>Reading Configuration Files</h3>
<p><strong>void read_premib_configs(void);</strong></p><p><strong>void read_configs(void);</strong></p>
<h3>Help Strings and Errors</h3>
<p><strong>void read_config_print_usage(char *</strong><em>lead</em><strong>);</strong></p><p><strong>void config_pwarn(const char *</strong><em>string</em><strong>);</strong></p><p><strong>void config_perror(const char *</strong><em>string</em><strong>);</strong></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The functions are a fairly extensible system of parsing various configuration files at the run time of an application.  The configuration file flow is broken into the following phases:</p>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p>Registration of handlers.</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p>Reading of the configuration files for pre-MIB parsing requirements.</p>
  </dd>
  <dt>
    <p>3.</p>
  </dt>
  <dd>
    <p>Reading and parsing of the textual MIB files.</p>
  </dd>
  <dt>
    <p>4.</p>
  </dt>
  <dd>
    <p>Reading of the configuration files for configuration directives.</p>
  </dd>
  <dt>
    <p>5.</p>
  </dt>
  <dd>
    <p>Optionally re-reading the configuration files at a future date.</p>
  </dd>

</dl>
<p>The idea is that the calling application is able to register <em>handlers</em> for certain <em>tokens</em> specified in certain named <em>configuration files.</em> The <strong>read_configs()</strong> function can then be called to look for all relevant configuration files, match the first word on each line against the list of registered tokens and pass the remainder of the line to the appropriate registered handler.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REGISTERING A HANDLER</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>register_config_handler()</strong></p>
  </dt>
  <dd>
    <p>Registers a configuration handler routine, which should be called to process configuration directives starting with the specified token. For example:</p>
  </dd>

</dl>
<p>register_config_handler("snmp", "exampleToken", example_handler, NULL, "ARG1 [ARG2]");</p><ul>
<li><p>would register the <strong>example_handler()</strong> function so that it will get called every time the first word of a line in the <em>snmp.conf</em> configuration file(s) matches "exampleToken".</p><p>Calling the appropriate handlers to process the configuration file directives is the responsibility of <strong>read_configs()</strong> (see below).</p></li>
</ul>
<dl class='dl-vertical'>
  <dt>
    <p><strong>register_const_config_handler()</strong></p>
  </dt>
  <dd>
    <p>Similar to the <strong>register_config_handler()</strong> function, but the parser routine is explicitly constrained to not modify the string being parsed.</p>
  </dd>
  <dt>
    <p><strong>register_prenetsnmp_mib_handler()</strong></p>
  </dt>
  <dd>
    <p>Similar to the <strong>register_config_handler()</strong> function, but the registered handler routine will be called <em>before</em> the textual MIBs are read in. This is typically used for tokens that will affect the configuration of the MIB parser, and will normally only be used within the SNMP library itself.</p>
  </dd>
  <dt>
    <p><strong>register_mib_handlers()</strong></p>
  </dt>
  <dd>
    <p>Initialisation routine to register the internal SNMP library configuration handlers.</p>
  </dd>
  <dt>
    <p><strong>unregister_config_handler()</strong></p>
  </dt>
  <dd>
    <p>Removes the registered configuration handler for the specified <em>filePrefix</em> and <em>token</em>.</p>
  </dd>
  <dt>
    <p><strong>unregister_all_config_handlers()</strong></p>
  </dt>
  <dd>
    <p>Removes all registered configuration handlers.</p>
  </dd>

</dl>
<h3>Token Handlers</h3>
<p>Handler functions should have the following signature:</p><p><strong>void handler(const char *</strong><em>token</em><strong>, char *</strong><em>line</em><strong>);</strong></p><p>or</p><p><strong>void handler(const char *</strong><em>token</em><strong>, const char *</strong><em>line</em><strong>);</strong> br (if registered using <em>register_const_config_handler</em>)</p><p>The function will be called with two arguments, the first being the token that triggered the call to this function (i.e. the token used when registering the handler), and the second being the remainder of the configuration file line (i.e. everything following the white space following the matched token).</p>
<h3>Freeing Handlers</h3>
<p>If the token handler function dynamically allocates resources when processing a configuration entry, then these may need to be released before re-reading the configuration files. If the fourth parameter ( <em>releaser</em> ) passed to <strong>register_config_handler</strong> is non-NULL, then this specifies a function to be called before re-reading the configuration files.  This function should free any resources allocated by the token handler function and reset its notion of the configuration to its default.  The token handler function can then safely be called again. No arguments are passed to the resource freeing handler.</p><p>Note that this function is not called when the handler is unregistered individually (but <em>is</em> called as part of <strong>unregister_all_config_handlers()</strong> ).</p>
<h3>Application Handlers</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>register_app_config_handler()</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>register_app_prenetsnmp_mib_handler()</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>unregister_app_config_handler()</strong></p>
  </dt>
  <dd>
    <p>These functions are analagous to <strong>register_config_handler()</strong>, <strong>register_prenetsnmp_mib_handler()</strong> and  <strong>unregister_config_handler()</strong> but do not require the file type argument (which is filled in by the application).  It is intended that MIB modules written for the agent use these functions to allow the agent to have more control over which configuration files are read (typically the <em>snmpd.conf</em> files).</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">READING CONFIGURATION FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>read_premib_configs()</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>read_configs()</strong></p>
  </dt>
  <dd>
    <p>These routines process the configuration files found in the configuration search path (see below).  For each entry, the handler registered for that configuration token is called.</p>
  </dd>

</dl>
<p><strong>read_premib_configs()</strong> is run before the MIB files are read in, and processes those configuration tokens registered using <strong>register_prenetsnmp_mib_handler()</strong> (or <strong>register_app_prenetsnmp_mib_handler()</strong> ). All other entries are ignored.</p><p><strong>read_configs()</strong> is run after the MIB files have been read in, and processes those configuration tokens registered using <strong>register_config_handler()</strong> (or <strong>register_app_config_handler()</strong> ). If it encounters a configuration token for which no handler has been registered (either pre- or post-mib), then it will display a warning message, and continue processing with the next line of the configuration file.</p><h3>Configuration Search Path</h3>
<p>The configuration files to be read are found by searching a list of configuration directories for appropriately named files. In each such directory, the library will look for files named  snmp.conf,  snmp.local.conf, <em> app</em>.conf<em>,</em> <em> app</em>.local.conf<em>,</em></p><p>(where <em>app</em> is the appication-specific filePrefix used to register configuration handlers). It is not necessary for any or all of these files to be present in each directory.  Missing files will be silently skipped.</p><p>The idea behind the two different suffixes is that the first file can be shared (via rdist or an NFS mount) across a large number of machines and the second file can be used to configure local settings for one particular machine.</p><p>The default list of directories to search is  /etc/snmp, followed by  /usr/share/snmp, followed by  /usr/lib/i386-linux-gnu/snmp, followed by  $HOME/.snmp. This list can be changed by setting the environmental variable <em>SNMPCONFPATH</em> to be a (colon separated) list of directories to search.</p>
<h3>init_snmp()</h3>
<p>The normal mode of operation would be to register the application-specific configuration handlers, and then invoke <strong>init_snmp()</strong>. This would call the routines listed above to register the internal library configuration handlers, process any configuration tokens registered with <strong>register_prenetsnmp_mib_handler(),</strong> read in the textual MIB files using <strong>init_mib(),</strong> and finally parse the configuration file tokens registered with <strong>register_config_handler()</strong>.</p><p>If the <strong>init_snmp()</strong> function is used, none of these functions need to be explicitly called by the application.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HELP STRINGS AND ERRORS</h2>
        <div class="sectioncontent">
<p>The <em>usageLine</em> parameter passed to <strong>register_config_handler()</strong> and similar calls, is used to display help information when the <strong>read_config_print_usage()</strong> function is called.  This function is used by all of the applications when the <strong>-H</strong> flag is passed on the command line.  It prints a summary of all of the configuration file lines, and the associated files, that the configuration system understands.  The <em>usageLine</em> parameter should be a list of arguments expected after the token, and not a lengthy description (which should go into a manual page instead).  The <em>lead</em> prefix will be prepended to each line that the function prints to stderr, where it displays its output.</p><p>The <strong>init_snmp()</strong> function should be called before the <strong>read_config_print_usage()</strong> function is called, so that the library can register its configuration file directives as well for the <strong>read_config_print_usage()</strong> function to display.</p><h3>Error Handling Functions</h3>
<p>The two functions <strong>config_pwarn()</strong> and <strong>config_perror()</strong> both take an error string as an argument and print it to stderr along with the file and line number that caused the error.  A call to the second function will also force <strong>read_configs()</strong> to eventually return with an error code indicating to it's calling function that it should abort the operation of the application.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>SNMPCONFPATH</p>
  </dt>
  <dd>
    <p>A colon separated list of directories to search for configuration files in. Default /etc/snmp/usr/share/snmp/usr/lib/i386-linux-gnu/snmp$HOME/.snmp</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO config_perror&hellip;</h2>
        <div class="sectioncontent">
<p><strong>mib_api</strong>(3), <strong>snmp_api</strong>(3)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="configFileLoad.3.html"><span aria-hidden="true">&larr;</span> configFileLoad.3: Parse a configuration file</a></li>
   <li class="next"><a href="config_pwarn.3.html">config_pwarn.3: Netsnmp_config_api functions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
