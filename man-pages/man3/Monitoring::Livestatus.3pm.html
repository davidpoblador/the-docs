<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monitoring::Livestatus: Perl api for check_mk livestatus to access runtime data from nagios and icinga</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Perl api for check_mk livestatus to access runtime data from nagios and icinga">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Monitoring::Livestatus (3pm) manual">
  <meta name="twitter:description" content="Perl api for check_mk livestatus to access runtime data from nagios and icinga">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmonitoring-livestatus-perl-Monitoring::Livestatus-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Monitoring::Livestatus.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Monitoring::Livestatus (3pm) manual" />
  <meta property="og:description" content="Perl api for check_mk livestatus to access runtime data from nagios and icinga" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmonitoring-livestatus-perl-Monitoring::Livestatus-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Monitoring::Livestatus<small> (3pm)</small></h1>
        <p class="lead">Perl api for check_mk livestatus to access runtime data from nagios and icinga</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Monitoring::Livestatus.3pm.html">
      <span itemprop="name">Monitoring::Livestatus: Perl api for check_mk livestatus to access runtime data from nagios and icinga</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmonitoring-livestatus-perl/">
      <span itemprop="name">libmonitoring-livestatus-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Monitoring::Livestatus.3pm.html">
      <span itemprop="name">Monitoring::Livestatus: Perl api for check_mk livestatus to access runtime data from nagios and icinga</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    use Monitoring::Livestatus;
    my $ml = Monitoring::Livestatus-&gt;new(
      socket =&gt; &apos;/var/lib/livestatus/livestatus.sock&apos;
    );
    my $hosts = $ml-&gt;selectall_arrayref("GET hosts");
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module connects via socket/tcp to the check_mk livestatus addon for Nagios and Icinga. You first have to install and activate the mklivestatus addon in your monitoring installation.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR</h2>
        <div class="sectioncontent">
<h3>new ( [\s-1ARGS\s0] )</h3>
<p>Creates an \*(C`Monitoring::Livestatus\*(C' object. \*(C`new\*(C' takes at least the socketpath.  Arguments are in key-value pairs. See \s-1EXAMPLES\s0 for more complex variants.</p>
<dl class='dl-vertical'>
  <dt>
    socket
  </dt>
  <dd>
    <p>path to the \s-1UNIX\s0 socket of check_mk livestatus</p>
  </dd>
  <dt>
    server
  </dt>
  <dd>
    <p>use this server for a \s-1TCP\s0 connection</p>
  </dd>
  <dt>
    peer
  </dt>
  <dd>
    <p>alternative way to set socket or server, if value contains ':' server is used, else socket</p>
  </dd>
  <dt>
    name
  </dt>
  <dd>
    <p>human readable name for this connection, defaults to the the socket/server address</p>
  </dd>
  <dt>
    verbose
  </dt>
  <dd>
    <p>verbose mode</p>
  </dd>
  <dt>
    line_seperator
  </dt>
  <dd>
    <p>ascii code of the line seperator, defaults to 10, (newline)</p>
  </dd>
  <dt>
    column_seperator
  </dt>
  <dd>
    <p>ascii code of the column seperator, defaults to 0 (null byte)</p>
  </dd>
  <dt>
    list_seperator
  </dt>
  <dd>
    <p>ascii code of the list seperator, defaults to 44 (comma)</p>
  </dd>
  <dt>
    host_service_seperator
  </dt>
  <dd>
    <p>ascii code of the host/service seperator, defaults to 124 (pipe)</p>
  </dd>
  <dt>
    keepalive
  </dt>
  <dd>
    <p>enable keepalive. Default is off</p>
  </dd>
  <dt>
    errors_are_fatal
  </dt>
  <dd>
    <p>errors will die with an error message. Default: on</p>
  </dd>
  <dt>
    warnings
  </dt>
  <dd>
    <p>show warnings currently only querys without Columns: Header will result in a warning</p>
  </dd>
  <dt>
    timeout
  </dt>
  <dd>
    <p>set a general timeout. Used for connect and querys, no default</p>
  </dd>
  <dt>
    query_timeout
  </dt>
  <dd>
    <p>set a query timeout. Used for retrieving querys, Default 60sec</p>
  </dd>
  <dt>
    connect_timeout
  </dt>
  <dd>
    <p>set a connect timeout. Used for initial connections, default 5sec</p>
  </dd>
  <dt>
    use_threads
  </dt>
  <dd>
    <p>only used with multiple backend connections. Default is to don't threads where available. As threads in perl are causing problems with tied resultset and using more memory. Querys are usually faster without threads, except for very slow backends connections.</p>
  </dd>

</dl>
<p>If the constructor is only passed a single argument, it is assumed to be a the \*(C`peer\*(C' specification. Use either socker \s-1OR\s0 server.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>do</h3>
<p> do($statement)  do($statement, %opts)</p><p>Send a single statement without fetching the result. Always returns true.</p>
<h3>selectall_arrayref</h3>
<p> selectall_arrayref($statement)  selectall_arrayref($statement, %opts)  selectall_arrayref($statement, %opts, $limit )</p><p>Sends a query and returns an array reference of arrays</p><p>    my $arr_refs = $ml-&gt;selectall_arrayref("GET hosts");</p><p>to get an array of hash references do something like</p><p>    my $hash_refs = $ml-&gt;selectall_arrayref(       "GET hosts", { Slice =&gt; {} }     );</p><p>to get an array of hash references from the first 2 returned rows only</p><p>    my $hash_refs = $ml-&gt;selectall_arrayref(       "GET hosts", { Slice =&gt; {} }, 2     );</p><p>use limit to limit the result to this number of rows</p><p>column aliases can be defined with a rename hash</p><p>    my $hash_refs = $ml-&gt;selectall_arrayref(       "GET hosts", {         Slice =&gt; {},         rename =&gt; {           &apos;name&apos; =&gt; &apos;host_name&apos;         }       }     );</p>
<h3>selectall_hashref</h3>
<p> selectall_hashref($statement, $key_field)  selectall_hashref($statement, $key_field, %opts)</p><p>Sends a query and returns a hashref with the given key</p><p>    my $hashrefs = $ml-&gt;selectall_hashref("GET hosts", "name");</p>
<h3>selectcol_arrayref</h3>
<p> selectcol_arrayref($statement)  selectcol_arrayref($statement, %opt )</p><p>Sends a query an returns an arrayref for the first columns</p><p>    my $array_ref = $ml-&gt;selectcol_arrayref("GET hosts&#92;nColumns: name");</p><p>    $VAR1 = [               &apos;localhost&apos;,               &apos;gateway&apos;,             ];</p><p>returns an empty array if nothing was found</p><p>to get a different column use this</p><p>    my $array_ref = $ml-&gt;selectcol_arrayref(        "GET hosts&#92;nColumns: name contacts",        { Columns =&gt; [2] }     );</p><p> you can link 2 columns in a hash result set</p><p>    my %hash = @{       $ml-&gt;selectcol_arrayref(         "GET hosts&#92;nColumns: name contacts",         { Columns =&gt; [1,2] }       )     };</p><p>produces a hash with host the contact assosiation</p><p>    $VAR1 = {               &apos;localhost&apos; =&gt; &apos;user1&apos;,               &apos;gateway&apos;   =&gt; &apos;user2&apos;             };</p>
<h3>selectrow_array</h3>
<p> selectrow_array($statement)  selectrow_array($statement, %opts)</p><p>Sends a query and returns an array for the first row</p><p>    my @array = $ml-&gt;selectrow_array("GET hosts");</p><p>returns undef if nothing was found</p>
<h3>selectrow_arrayref</h3>
<p> selectrow_arrayref($statement)  selectrow_arrayref($statement, %opts)</p><p>Sends a query and returns an array reference for the first row</p><p>    my $arrayref = $ml-&gt;selectrow_arrayref("GET hosts");</p><p>returns undef if nothing was found</p>
<h3>selectrow_hashref</h3>
<p> selectrow_hashref($statement)  selectrow_hashref($statement, %opt)</p><p>Sends a query and returns a hash reference for the first row</p><p>    my $hashref = $ml-&gt;selectrow_hashref("GET hosts");</p><p>returns undef if nothing was found</p>
<h3>selectscalar_value</h3>
<p> selectscalar_value($statement)  selectscalar_value($statement, %opt)</p><p>Sends a query and returns a single scalar</p><p>    my $count = $ml-&gt;selectscalar_value("GET hosts&#92;nStats: state = 0");</p><p>returns undef if nothing was found</p>
<h3>errors_are_fatal</h3>
<p> errors_are_fatal()  errors_are_fatal($value)</p><p>Enable or disable fatal errors. When enabled the module will croak on any error.</p><p>returns the current setting if called without new value</p>
<h3>warnings</h3>
<p> warnings()  warnings($value)</p><p>Enable or disable warnings. When enabled the module will carp on warnings.</p><p>returns the current setting if called without new value</p>
<h3>verbose</h3>
<p> verbose()  verbose($values)</p><p>Enable or disable verbose output. When enabled the module will dump out debug output</p><p>returns the current setting if called without new value</p>
<h3>peer_addr</h3>
<p> $ml-&gt;peer_addr()</p><p>returns the current peer address</p><p>when using multiple backends, a list of all addresses is returned in list context</p>
<h3>peer_name</h3>
<p> $ml-&gt;peer_name()  $ml-&gt;peer_name($string)</p><p>if new value is set, name is set to this value</p><p>always returns the current peer name</p><p>when using multiple backends, a list of all names is returned in list context</p>
<h3>peer_key</h3>
<p> $ml-&gt;peer_key()</p><p>returns a uniq key for this peer</p><p>when using multiple backends, a list of all keys is returned in list context</p>
<h3>marked_bad</h3>
<p> $ml-&gt;marked_bad()</p><p>returns true if the current connection is marked down</p>
<h3>disable</h3>
<p> $ml-&gt;disable()</p><p>disables this connection, returns the last state.</p>
<h3>enable</h3>
<p> $ml-&gt;enable()</p><p>enables this connection, returns the last state.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">QUERY OPTIONS</h2>
        <div class="sectioncontent">
<p>In addition to the normal query syntax from the livestatus addon, it is possible to set column aliases in various ways.</p><h3>AddPeer</h3>
<p>adds the peers name, addr and key to the result set:</p><p> my $hosts = $ml-&gt;selectall_hashref(    "GET hosts&#92;nColumns: name alias state",    "name",    { AddPeer =&gt; 1 }  );</p>
<h3>Backend</h3>
<p>send the query only to some specific backends. Only useful when using multiple backends.</p><p> my $hosts = $ml-&gt;selectall_arrayref(    "GET hosts&#92;nColumns: name alias state",    { Backends =&gt; [ &apos;key1&apos;, &apos;key4&apos; ] }  );</p>
<h3>Columns</h3>
<p>    only return the given column indexes</p><p>    my $array_ref = $ml-&gt;selectcol_arrayref(        "GET hosts&#92;nColumns: name contacts",        { Columns =&gt; [2] }     );</p><p>  see L&lt;selectcol_arrayref&gt; for more examples</p>
<h3>Deepcopy</h3>
<p>    deep copy/clone the result set.</p><p>    Only effective when using multiple backends and threads.     This can be safely turned off if you dont change the     result set.     If you get an error like "Invalid value for shared scalar" error" this     should be turned on.</p><p>    my $array_ref = $ml-&gt;selectcol_arrayref(        "GET hosts&#92;nColumns: name contacts",        { Deepcopy =&gt; 1 }     );</p>
<h3>Limit</h3>
<p>    Just like the Limit: &lt;nr&gt; option from livestatus itself.     In addition you can add a start,length limit.</p><p>    my $array_ref = $ml-&gt;selectcol_arrayref(        "GET hosts&#92;nColumns: name contacts",        { Limit =&gt; "10,20" }     );</p><p>    This example will return 20 rows starting at row 10. You will     get row 10-30.</p><p>    Cannot be combined with a Limit inside the query     because a Limit will be added automatically.</p><p>    Adding a limit this way will greatly increase performance and     reduce memory usage.</p><p>    This option is multibackend safe contrary to the "Limit: " part of a statement.     Sending a statement like "GET...Limit: 10" with 3 backends will result in 30 rows.     Using this options, you will receive only the first 10 rows.</p>
<h3>Rename</h3>
<p>  see L&lt;COLUMN ALIAS&gt; for detailed explainaton</p>
<h3>Slice</h3>
<p>  see L&lt;selectall_arrayref&gt; for detailed explainaton</p>
<h3>Sum</h3>
<p>The Sum option only applies when using multiple backends. The values from all backends with be summed up to a total.</p><p> my $stats = $ml-&gt;selectrow_hashref(    "GET hosts&#92;nStats: state = 0&#92;nStats: state = 1",    { Sum =&gt; 1 }  );</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLUMN ALIAS</h2>
        <div class="sectioncontent">
<p>In addition to the normal query syntax from the livestatus addon, it is possible to set column aliases in various ways.</p><p>A valid Columns: Header could look like this:</p><p> my $hosts = $ml-&gt;selectall_arrayref(    "GET hosts&#92;nColumns: state as status"  );</p><p>Stats queries could be aliased too:</p><p> my $stats = $ml-&gt;selectall_arrayref(    "GET hosts&#92;nStats: state = 0 as up"  );</p><p>This syntax is available for: Stats, StatsAnd, StatsOr and StatsGroupBy</p><p>An alternative way to set column aliases is to define rename option key/value pairs:</p><p> my $hosts = $ml-&gt;selectall_arrayref(    "GET hosts&#92;nColumns: name", {      rename =&gt; { &apos;name&apos; =&gt; &apos;hostname&apos; }    }  );</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERROR HANDLING</h2>
        <div class="sectioncontent">
<p>Errorhandling can be done like this:</p><p>    use Monitoring::Livestatus;     my $ml = Monitoring::Livestatus-&gt;new(       socket =&gt; &apos;/var/lib/livestatus/livestatus.sock&apos;     );     $ml-&gt;<strong>errors_are_fatal</strong>(0);     my $hosts = $ml-&gt;selectall_arrayref("GET hosts");     if($Monitoring::Livestatus::ErrorCode) {         croak($Monitoring::Livestatus::ErrorMessage);     }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<h3>Multibackend Configuration</h3>
<p>    use Monitoring::Livestatus;     my $ml = Monitoring::Livestatus-&gt;new(       name       =&gt; &apos;multiple connector&apos;,       verbose   =&gt; 0,       keepalive =&gt; 1,       peer      =&gt; [             {                 name =&gt; &apos;DMZ Monitoring&apos;,                 peer =&gt; &apos;50.50.50.50:9999&apos;,             },             {                 name =&gt; &apos;Local Monitoring&apos;,                 peer =&gt; &apos;/tmp/livestatus.socket&apos;,             },             {                 name =&gt; &apos;Special Monitoring&apos;,                 peer =&gt; &apos;100.100.100.100:9999&apos;,             }       ],     );     my $hosts = $ml-&gt;selectall_arrayref("GET hosts");</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Monitoring::Livestatus&hellip;</h2>
        <div class="sectioncontent">
<p>For more information about the query syntax and the livestatus plugin installation see the Livestatus page: http://mathias-kettner.de/checkmk_livestatus.html</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Sven Nierlein, &lt;nierlein@cpan.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2009 by Sven Nierlein</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Mon::SNMP.3pm.html"><span aria-hidden="true">&larr;</span> Mon::SNMP.3pm: Decode snmp trap</a></li>
   <li class="next"><a href="Monitoring::Livestatus::INET.3pm.html">Monitoring::Livestatus::INET.3pm: Connector with tcp sockets <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
