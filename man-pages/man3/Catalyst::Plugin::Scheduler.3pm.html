<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catalyst::Plugin::Scheduler: Schedule events to run in a cron-like fashion</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Schedule events to run in a cron-like fashion">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Catalyst::Plugin::Scheduler (3pm) manual">
  <meta name="twitter:description" content="Schedule events to run in a cron-like fashion">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcatalyst-plugin-scheduler-perl-Catalyst::Plugin::Scheduler-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Catalyst::Plugin::Scheduler.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Catalyst::Plugin::Scheduler (3pm) manual" />
  <meta property="og:description" content="Schedule events to run in a cron-like fashion" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcatalyst-plugin-scheduler-perl-Catalyst::Plugin::Scheduler-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Catalyst::Plugin::Scheduler<small> (3pm)</small></h1>
        <p class="lead">Schedule events to run in a cron-like fashion</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Catalyst::Plugin::Scheduler.3pm.html">
      <span itemprop="name">Catalyst::Plugin::Scheduler: Schedule events to run in a cron-like fashion</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcatalyst-plugin-scheduler-perl/">
      <span itemprop="name">libcatalyst-plugin-scheduler-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Catalyst::Plugin::Scheduler.3pm.html">
      <span itemprop="name">Catalyst::Plugin::Scheduler: Schedule events to run in a cron-like fashion</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    use Catalyst qw/Scheduler/;

    # run remove_sessions in the Cron controller every hour
    _\|_PACKAGE_\|_-&gt;schedule(
        at    =&gt; &apos;0 * * * *&apos;,
        event =&gt; &apos;/cron/remove_sessions&apos;
    );

    # Run a subroutine at 4:05am every Sunday
    _\|_PACKAGE_\|_-&gt;schedule(
        at    =&gt; &apos;5 4 * * sun&apos;,
        event =&gt; &#92;&do_stuff,
    );

    # A long-running scheduled event that must be triggered
    # manually by an authorized user
    _\|_PACKAGE_\|_-&gt;schedule(
        trigger =&gt; &apos;rebuild_search_index&apos;,
        event   =&gt; &apos;/cron/rebuild_search_index&apos;,
    );
    $ wget -q http://www.myapp.com/?schedule_trigger=rebuild_search_index
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This plugin allows you to schedule events to run at recurring intervals. Events will run during the first request which meets or exceeds the specified time.  Depending on the level of traffic to the application, events may or may not run at exactly the correct time, but it should be enough to satisfy many basic scheduling needs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>Configuration is optional and is specified in MyApp-&gt;config-&gt;{scheduler}.</p><h3>logging</h3>
<p>Set to 1 to enable logging of events as they are executed.  This option is enabled by default when running under -Debug mode.  Errors are always logged regardless of the value of this option.</p>
<h3>time_zone</h3>
<p>The time zone of your system.  This will be autodetected where possible, or will default to \s-1UTC\s0 (\s-1GMT\s0).  You can override the detection by providing a valid DateTime time zone string, such as 'America/New_York'.</p>
<h3>state_file</h3>
<p>The current state of every event is stored in a file.  By default this is $APP_HOME/scheduler.state.  This file is created on the first request if it does not already exist.</p>
<h3>yaml_file</h3>
<p>The location of the optional \s-1YAML\s0 event configuration file.  By default this is $APP_HOME/scheduler.yml.</p>
<h3>hosts_allow</h3>
<p>This option specifies \s-1IP\s0 addresses for trusted users.  This option defaults to 127.0.0.1.  Multiple addresses can be specified by using an array reference.  This option is used for both events where auto_run is set to 0 and for manually-triggered events.</p><p>    _\|_PACKAGE_\|_-&gt;config-&gt;{scheduler}-&gt;{hosts_allow} = &apos;192.168.1.1&apos;;     _\|_PACKAGE_\|_-&gt;config-&gt;{scheduler}-&gt;{hosts_allow} = [         &apos;127.0.0.1&apos;,         &apos;192.168.1.1&apos;     ];</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCHEDULING</h2>
        <div class="sectioncontent">
<h3>\s-1AUTOMATED\s0 \s-1EVENTS\s0</h3>
<p>Events are scheduled by calling the class method \*(C`schedule\*(C'.</p><p>    MyApp-&gt;schedule(         at       =&gt; &apos;0 * * * *&apos;,         event    =&gt; &apos;/cron/remove_sessions&apos;,     );</p><p>    package MyApp::Controller::Cron;</p><p>    sub remove_sessions : Private {         my ( $self, $c ) = @_;</p><p>        $c-&gt;delete_expired_sessions;     }</p><p><em>at</em></p><p>The time to run an event is specified using <em>crontab</em>\|(5)-style syntax.</p><p>    5 0 * * *      # 5 minutes after midnight, every day     15 14 1 * *    # run at 2:15pm on the first of every month     0 22 * * 1-5   # run at 10 pm on weekdays     5 4 * * sun    # run at 4:05am every Sunday</p><p>From <em>crontab</em>\|(5):</p><p>    field          allowed values     -----          --------------     minute         0-59     hour           0-23     day of month   1-31     month          0-12 (or names, see below)     day of week    0-7 (0 or 7 is Sun, or use names)</p><p>Instead of the first five fields, one of seven special strings may appear:</p><p>    string         meaning     ------         -------     @yearly        Run once a year, "0 0 1 1 *".     @annually      (same as @yearly)     @monthly       Run once a month, "0 0 1 * *".     @weekly        Run once a week, "0 0 * * 0".     @daily         Run once a day, "0 0 * * *".     @midnight      (same as @daily)     @hourly        Run once an hour, "0 * * * *".</p><p><em>event</em></p><p>The event to run at the specified time can be either a Catalyst private action path or a coderef.  Both types of event methods will receive the $c object from the current request, but you must not rely on any request-specific information present in $c as it will be from a random user request at or near the event's specified run time.</p><p>Important: Methods used for events should be marked \*(C`Private\*(C' so that they can not be executed via the browser.</p><p><em>auto_run</em></p><p>The auto_run parameter specifies when the event is allowed to be executed. By default this option is set to 1, so the event will be executed during the first request that matches the specified time in \*(C`at\*(C'.</p><p>If set to 0, the event will only run when a request is made by a user from an authorized address.  The purpose of this option is to allow long-running tasks to execute only for certain users.</p><p>    MyApp-&gt;schedule(         at       =&gt; &apos;0 0 * * *&apos;,         event    =&gt; &apos;/cron/rebuild_search_index&apos;,         auto_run =&gt; 0,     );</p><p>    package MyApp::Controller::Cron;</p><p>    sub rebuild_search_index : Private {         my ( $self, $c ) = @_;</p><p>        # rebuild the search index, this may take a long time     }</p><p>Now, the search index will only be rebuilt when a request is made from a user whose \s-1IP\s0 address matches the list in the \*(C`hosts_allow\*(C' config option.  To run this event, you probably want to ping the app from a cron job.</p><p>    0 0 * * * wget -q http://www.myapp.com/</p>
<h3>\s-1MANUAL\s0 \s-1EVENTS\s0</h3>
<p>To create an event that does not run on a set schedule and must be manually triggered, you can specify the \*(C`trigger\*(C' option instead of \*(C`at\*(C'.</p><p>    _\|_PACKAGE_\|_-&gt;schedule(         trigger =&gt; &apos;send_email&apos;,         event   =&gt; &apos;/events/send_email&apos;,     );</p><p>The event may then be triggered by a standard web request from an authorized user.  The trigger to run is specified by using a special \s-1GET\s0 parameter, 'schedule_trigger'; the path requested does not matter.</p><p>    http://www.myapp.com/?schedule_trigger=send_email</p><p>By default, manual events may only be triggered by requests made from localhost (127.0.0.1).  To allow other addresses to run events, use the configuration option \*(L"hosts_allow\*(R".</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCHEDULING USING A YAML FILE</h2>
        <div class="sectioncontent">
<p>As an alternative to using the <em>schedule()</em> method, you may define scheduled events in an external \s-1YAML\s0 file.  By default, the plugin looks for the existence of a file called \*(C`scheduler.yml\*(C' in your application's home directory.  You can change the filename using the configuration option \*(L"yaml_file\*(R".</p><p>Modifications to this file will be re-read once per minute during the normal event checking process.</p><p>Here's an example \s-1YAML\s0 configuration file with 4 events.  Each event is denoted with a '-' character, followed by the same parameters used by the \*(C`schedule\*(C' method.  Note that coderef events are not supported by the \s-1YAML\s0 file.</p><p>    ---     - at: &apos;* * * * *&apos;       event: /cron/delete_sessions     - event: /cron/send_email       trigger: send_email     - at: &apos;@hourly&apos;       event: /cron/hourly     - at: 0 0 * * *       auto_run: 0       event: /cron/rebuild_search_index</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY</h2>
        <div class="sectioncontent">
<p>All events are run inside of an eval container.  This protects the user from receiving any error messages or page crashes if an event fails to run properly.  All event errors are logged, even if logging is disabled.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PLUGIN SUPPORT</h2>
        <div class="sectioncontent">
<p>Other plugins may register scheduled events if they need to perform periodic maintenance.  Plugin authors, <strong>be sure to inform your users</strong> if you do this! Events should be registered from a plugin's \*(C`setup\*(C' method.</p><p>    sub setup {         my $c = shift;         $c-&gt;maybe::next::method(@_);</p><p>        if ( $c-&gt;can(&apos;schedule&apos;) ) {             $c-&gt;schedule(                 at    =&gt; &apos;0 * * * *&apos;,                 event =&gt; &#92;&cleanup,             );         }     }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<p>The time at which an event will run is determined completely by the requests made to the application.  Apps with heavy traffic may have events run at very close to the correct time, whereas apps with low levels of traffic may see events running much later than scheduled.  If this is a problem, you can use a real cron entry that simply hits your application at the desired time.</p><p>    0 * * * * wget -q http://www.myapp.com/</p><p>Events which consume a lot of time will slow the request processing for the user who triggers the event.  For these types of events, you should use auto_run =&gt; 0 or manual event triggering.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PERFORMANCE</h2>
        <div class="sectioncontent">
<p>The plugin only checks once per minute if any events need to be run, so the overhead on each request is minimal.  On my test server, the difference between running with Scheduler and without was only around 0.02% (0.004 seconds).</p><p>Of course, when a scheduled event runs, performance will depend on what's being run in the event.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>schedule</h3>
<p>Schedule is a class method for adding scheduled events.  See the \*(L"\s-1SCHEDULING\s0\*(R"\*(L" in \*(R" section for more information.</p>
<h3>scheduler_state</h3>
<p>The current state of all scheduled events is available in an easy-to-use format by calling $c-&gt;scheduler_state.  You can use this data to build an admin view into the scheduling engine, for example.  This same data is also displayed on the Catalyst debug screen.</p><p>This method returns an array reference containing a hash reference for each event.</p><p>    [         {             &apos;last_run&apos;    =&gt; &apos;2005-12-29 16:29:33 EST&apos;,             &apos;auto_run&apos;    =&gt; 1,             &apos;last_output&apos; =&gt; 1,             &apos;at&apos;          =&gt; &apos;0 0 * * *&apos;,             &apos;next_run&apos;    =&gt; &apos;2005-12-30 00:00:00 EST&apos;,             &apos;event&apos;       =&gt; &apos;/cron/session_cleanup&apos;         },         {             &apos;auto_run&apos;    =&gt; 1,             &apos;at&apos;          =&gt; &apos;0 0 * * *&apos;,             &apos;next_run&apos;    =&gt; &apos;2005-12-30 00:00:00 EST&apos;,             &apos;event&apos;       =&gt; &apos;/cron/build_rss&apos;         },     ]</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTERNAL METHODS</h2>
        <div class="sectioncontent">
<p>The following methods are extended by this plugin.</p>
<dl class='dl-vertical'>
  <dt>
    dispatch
  </dt>
  <dd>
    <p>The main scheduling logic takes place during the dispatch phase.</p>
  </dd>
  <dt>
    dump_these
  </dt>
  <dd>
    <p>On the Catalyst debug screen, all scheduled events are displayed along with the next time they will be executed.</p>
  </dd>
  <dt>
    setup
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Catalyst::Plugin::Scheduler&hellip;</h2>
        <div class="sectioncontent">
<p><em>crontab</em>\|(5)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Andy Grundman, &lt;andy@hybridized.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>This program is free software, you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Catalyst::Plugin::Redirect.3pm.html"><span aria-hidden="true">&larr;</span> Catalyst::Plugin::Redirect.3pm: Redirect for catalyst used easily is offered.</a></li>
   <li class="next"><a href="Catalyst::Restarter.3pm.html">Catalyst::Restarter.3pm: Uses file::changenotify to check for changed files and restart the server <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
