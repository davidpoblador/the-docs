<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>XkbApplyCompatMapToKey: Apply the new compatibility mapping to an individual key to get its semantics updated</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Apply the new compatibility mapping to an individual key to get its semantics updated">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="XkbApplyCompatMapToKey (3) manual">
  <meta name="twitter:description" content="Apply the new compatibility mapping to an individual key to get its semantics updated">
  <meta name="twitter:image" content="https://www.carta.tech/images/libx11-doc-XkbApplyCompatMapToKey-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/XkbApplyCompatMapToKey.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="XkbApplyCompatMapToKey (3) manual" />
  <meta property="og:description" content="Apply the new compatibility mapping to an individual key to get its semantics updated" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libx11-doc-XkbApplyCompatMapToKey-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">XkbApplyCompatMapToKey<small> (3)</small></h1>
        <p class="lead">Apply the new compatibility mapping to an individual key to get its semantics updated</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/XkbApplyCompatMapToKey.3.html">
      <span itemprop="name">XkbApplyCompatMapToKey: Apply the new compatibility mapping to an individual key to get its semantics updated</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libx11-doc/">
      <span itemprop="name">libx11-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/XkbApplyCompatMapToKey.3.html">
      <span itemprop="name">XkbApplyCompatMapToKey: Apply the new compatibility mapping to an individual key to get its semantics updated</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>Bool XkbApplyCompatMapToKey</strong> <strong>(\^XkbDescPtr </strong><em>xkb</em><strong>\^,</strong> <strong>KeyCode </strong><em>key</em><strong>\^,</strong> <strong>XkbChangesPtr </strong><em>changes</em><strong>\^);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ARGUMENTS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>- xkb</em></p>
  </dt>
  <dd>
    <p>keyboard description to be updated</p>
  </dd>
  <dt>
    <p><em>- key</em></p>
  </dt>
  <dd>
    <p>key to be updated</p>
  </dd>
  <dt>
    <p><em>- changes</em></p>
  </dt>
  <dd>
    <p>notes changes to the Xkb keyboard description</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>XkbApplyCompatMapToKey</em> essentially performs the operation described in Core Keyboard Mapping to Xkb Keyboard Mapping Transformation to a specific key. This updates the behavior, actions, repeat status, and virtual modifier bindings of the key.</p><p><strong>Core Keyboard Mapping to Xkb Keyboard Mapping Transformation</strong></p><p>When a core protocol keyboard mapping request is received by the server, the server's core keyboard map is updated, and then the Xkb map maintained by the server is updated. Because a client may have explicitly configured some of the Xkb keyboard mapping in the server, this automatic regeneration of the Xkb keyboard mapping from the core protocol keyboard mapping should not modify any components of the Xkb keyboard mapping that were explicitly set by a client. The client must set explicit override controls to prevent this from happening (see Explicit Components-Avoiding Automatic Remapping by the Server). The core-to-Xkb mapping is done as follows:</p><p><strong>Explicit Components-Avoiding Automatic Remapping by the Server</strong></p><p>Whenever a client remaps the keyboard using core protocol requests, Xkb examines the map to determine likely default values for the components that cannot be specified using the core protocol.</p><p>This automatic remapping might replace definitions explicitly requested by an application, so the Xkb keyboard description defines an explicit components mask for each key. Any aspects of the automatic remapping listed in the explicit components mask for a key are not changed by the automatic keyboard mapping.</p><p>The explicit components masks are held in the <em>explicit</em> field of the server map, which is an array indexed by keycode. Each entry in this array is a mask that is a bitwise inclusive OR of the values shown in Table 1.</p><table class="table table-striped">
<tr>
<th>Table 1 Explicit Component Masks</th>
<th></th>
<th></th></tr>

<tr>
<td>Bit in Explicit Mask</td>
<td>Value</td>
<td>Protects Against</td></tr>

<tr>
<td>ExplicitKeyType1</td>
<td>(1&lt;&lt;0)</td>
<td>Automatic determination of the key type associated with Group1.  </td></tr>

<tr>
<td>ExplicitKeyType2</td>
<td>(1&lt;&lt;1)</td>
<td>Automatic determination of the key type associated with Group2.  </td></tr>

<tr>
<td>ExplicitKeyType3</td>
<td>(1&lt;&lt;2)</td>
<td>Automatic determination of the key type associated with Group3.  </td></tr>

<tr>
<td>ExplicitKeyType4</td>
<td>(1&lt;&lt;3)</td>
<td>Automatic determination of the key type associated with Group4.  </td></tr>

<tr>
<td>ExplicitInterpret</td>
<td>(1&lt;&lt;4)</td>
<td>Application of any of the fields of a symbol interpretation to the key in   question.  </td></tr>

<tr>
<td>ExplicitAutoRepeat</td>
<td>(1&lt;&lt;5)</td>
<td>Automatic determination of auto-repeat status for the key, as specified in a   symbol interpretation.  </td></tr>

<tr>
<td>ExplicitBehavior</td>
<td>(1&lt;&lt;6)</td>
<td>Automatic assignment of the XkbKB_Lock behavior to the key, if the   XkbSI_LockingKey flag is set in a symbol interpretation.  </td></tr>

<tr>
<td>ExplicitVModMap</td>
<td>(1&lt;&lt;7)</td>
<td>Automatic determination of the virtual modifier map for the key based on the   actions assigned to the key and the symbol interpretations that match the key.  </td></tr>
</table>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p>Map the symbols from the keys in the core keyboard map to groups and symbols on keys in the Xkb keyboard map. The core keyboard mapping is of fixed width, so each key in the core mapping has the same number of symbols associated with it. The Xkb mapping allows a different number of symbols to be associated with each key; those symbols may be divided into a different number of groups (1-4) for each key. For each key, this process therefore involves partitioning the fixed number of symbols from the core mapping into a set of variable-length groups with a variable number of symbols in each group. For example, if the core protocol map is of width five, the partition for one key might result in one group with two symbols and another with three symbols. A different key might result in two groups with two symbols plus a third group with one symbol. The core protocol map requires at least two symbols in each of the first two groups.</p>
  </dd>
  <dt>
    <p>1a.</p>
  </dt>
  <dd>
    <p>For each changed key, determine the number of groups represented in the new core keyboard map. This results in a tentative group count for each key in the Xkb map.</p>
  </dd>
  <dt>
    <p>1b.</p>
  </dt>
  <dd>
    <p>For each changed key, determine the number of symbols in each of the groups found in step 1a. There is one explicit override control associated with each of the four possible groups for each Xkb key, ExplicitKeyType1 through ExplicitKeyType4. If no explicit override control is set for a group, the number of symbols used for that group from the core map is two.  If the explicit override control is set for a group on the key, the number of symbols used for that Xkb group from the core map is the width of the Xkb group with one exception: because of the core protocol requirement for at least two symbols in each of groups one and two, the number of symbols used for groups one and two is the maximum of 2 or the width of the Xkb group.</p>
  </dd>
  <dt>
    <p>1c.</p>
  </dt>
  <dd>
    <p>For each changed key, assign the symbols in the core map to the appropriate group on the key. If the total number of symbols required by the Xkb map for a particular key needs more symbols than the core protocol map contains, the additional symbols are taken to be NoSymbol keysyms appended to the end of the core set. If the core map contains more symbols than are needed by the Xkb map, trailing symbols in the core map are discarded. In the absence of an explicit override for group one or two, symbols are assigned in order by group; the first symbols in the core map are assigned to group one, in order, followed by group two, and so on. For example, if the core map contained eight symbols per key, and a particular Xkb map contained 2 symbols for G1 and G2 and three for G3, the symbols would be assigned as (G is group, L is shift level):</p>
<pre>
              G1L1 G1L2 G2L1 G2L2 G3L1 G3L2 G3L3

</pre>
<p>If an explicit override control is set for group one or two, the symbols are taken from the core set in a somewhat different order. The first four symbols from the core set are assigned to G1L1, G1L2, G2L1, G2L2, respectively. If group one requires more symbols, they are taken next, and then any additional symbols needed by group two. Group three and four symbols are taken in complete sequence after group two. For example, a key with four groups and three symbols in each group would take symbols from the core set in the following order:</p>
<pre>
   G1L1 G1L2 G2L1 G2L2 G1L3 G2L3 G3L1 G3L2 G3L3 G4L1 G4L2 G4L3

</pre>
<p>As previously noted, the core protocol map requires at lease two symbols in groups one and two. Because of this, if an explicit override control for an Xkb key is set and group one and / or group two is of width one, it is not possible to generate the symbols taken from the core protocol set and assigned to position G1L2 and / or G2L2.</p>
  </dd>
  <dt>
    <p>1d.</p>
  </dt>
  <dd>
    <p>For each group on each changed key, assign a key type appropriate for the symbols in the group.</p>
  </dd>
  <dt>
    <p>1e.</p>
  </dt>
  <dd>
    <p>For each changed key, remove any empty or redundant groups.</p><p>At this point, the groups and their associated symbols have been assigned to the corresponding key definitions in the Xkb map.</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p>Apply symbol interpretations to modify key operation. This phase is completely skipped if the  ExplicitInterpret override control bit is set in the explicit controls mask for the Xkb key (see Explicit Components-Avoiding Automatic Remapping by the Server).</p>
  </dd>
  <dt>
    <p>2a.</p>
  </dt>
  <dd>
    <p>For each symbol on each changed key, attempt to match the symbol and modifiers from the Xkb map to a symbol interpretation describing how to generate the symbol.</p>
  </dd>
  <dt>
    <p>2b.</p>
  </dt>
  <dd>
    <p>When a match is found in step 2a, apply the symbol interpretation to change the semantics associated with the symbol in the Xkb key map. If no match is found, apply a default interpretation.</p>
  </dd>

</dl>
<p>The symbol interpretations used in step 2 are configurable and may be specified using XkbSymInterpretRec structures referenced by the sym_interpret field of an XkbCompatMapRec.</p><p><strong>Symbol Interpretations - the XkbSymInterpretRec Structure</strong></p><p>Symbol interpretations are used to guide the X server when it modifies the Xkb keymap in step 2. An initial set of symbol interpretations is loaded by the server when it starts. A client may add new ones using XkbSetCompatMap.</p><p>Symbol interpretations result in key semantics being set. When a symbol interpretation is applied, the following components of server key event processing may be modified for the particular key involved:</p>
<pre>
    Virtual modifier map
    Auto repeat
    Key behavior (may be set to XkbKB_Lock)
    Key action

</pre>
<p>The XkbSymInterpretRec structure specifies a symbol interpretation:</p>
<pre>
typedef struct {
    KeySym        sym;         /\(** keysym of interest or NULL */
    unsigned char flags;       /\(** XkbSI_AutoRepeat, XkbSI_LockingKey */
    unsigned char match;       /\(** specifies how mods is interpreted */
    unsigned char mods;        /\(** modifier bits, correspond to eight real modifiers */
    unsigned char virtual_mod; /\(** 1 modifier to add to key virtual mod map */
    XkbAnyAction  act;         /\(** action to bind to symbol position on key */
} XkbSymInterpretRec,*XkbSymInterpretPtr;

</pre>
<p>If sym is not NULL, it limits the symbol interpretation to keys on which that particular keysym is selected by the modifiers matching the criteria specified by <em>mods</em> and <em>match.</em> If <em>sym</em> is NULL, the interpretation may be applied to any symbol selected on a key when the modifiers match the criteria specified by <em>mods</em> and <em>match.</em></p><p><em>match</em> must be one of the values shown in Table 2 and specifies how the real modifiers specified in <em>mods</em> are to be interpreted.</p><table class="table table-striped">
<tr>
<th>Table 2 Symbol Interpretation Match Criteria</th>
<th></th>
<th></th></tr>

<tr>
<td>Match Criteria</td>
<td>Value</td>
<td>Effect</td></tr>

<tr>
<td>XkbSI_NoneOf</td>
<td>(0)</td>
<td>None of the bits that are on in mods can be set, but other bits can be.  </td></tr>

<tr>
<td>XkbSI_AnyOfOrNone</td>
<td>(1)</td>
<td>Zero or more of the bits that are on in mods can be set, as well as others.  </td></tr>

<tr>
<td>XkbSI_AnyOf</td>
<td>(2)</td>
<td>One or more of the bits that are on in mods can be set, as well as any others.  </td></tr>

<tr>
<td>XkbSI_AllOf</td>
<td>(3)</td>
<td>All of the bits that are on in mods must be set, but others may be set as well.  </td></tr>

<tr>
<td>XkbSI_Exactly</td>
<td>(4)</td>
<td>All of the bits that are on in mods must be set, and no other bits may be set.  </td></tr>
</table><p>In addition to the above bits, <em>match</em> may contain the XkbSI_LevelOneOnly bit, in which case the modifier match criteria specified by <em>mods</em> and <em>match</em> applies only if <em>sym</em> is in level one of its group; otherwise, <em>mods</em> and <em>match</em> are ignored and the symbol matches a condition where no modifiers are set.</p>
<pre>
#define XkbSI_LevelOneOnly  (0x80)  /\(** use mods + match only if sym is level 1 */

</pre>
<p>If no matching symbol interpretation is found, the server uses a default interpretation where:</p>
<pre>
    sym =           0
    flags =         XkbSI_AutoRepeat
    match =         XkbSI_AnyOfOrNone
    mods =          0
    virtual_mod =   XkbNoModifier
    act =           SA_NoAction

</pre>
<p>When a matching symbol interpretation is found in step 2a, the interpretation is applied to modify the Xkb map as follows.</p><p>The <em>act</em> field specifies a single action to be bound to the symbol position; any key event that selects the symbol causes the action to be taken. Valid actions are defined in Key Actions.</p><p>If the Xkb keyboard map for the key does not have its ExplicitVModMap control set, the XkbSI_LevelOneOnly bit and symbol position are examined. If the XkbSI_LevelOneOnly bit is not set in <em>match</em> or the symbol is in position G1L1, the <em>virtual_mod</em> field is examined. If <em>virtual_mod</em> is not XkbNoModifier, <em>virtual_mod</em> specifies a single virtual modifier to be added to the virtual modifier map for the key. <em>virtual_mod</em> is specified as an index in the range [0..15].</p><p>If the matching symbol is in position G1L1 of the key, two bits in the flags field potentially specify additional behavior modifications:</p>
<pre>
#define  XkbSI_AutoRepeat  (1&lt;&lt;0)  /\(** key repeats if sym is in position G1L1 */
#define  XkbSI_LockingKey  (1&lt;&lt;1)  /\(** set KB_Lock behavior if sym is in psn G1L1 */

</pre>
<p>If the Xkb keyboard map for the key does not have its ExplicitAutoRepeat control set, its auto repeat behavior is set based on the value of the XkbSI_AutoRepeat bit. If the XkbSI_AutoRepeat bit is set, the auto-repeat behavior of the key is turned on; otherwise, it is turned off.</p><p>If the Xkb keyboard map for the key does not have its ExplicitBehavior control set, its locking behavior is set based on the value of the XkbSI_LockingKey bit. If XkbSI_LockingKey is set, the key behavior is set to KB_Lock; otherwise, it is turned off.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO XkbApplyCompatMapToKey&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/XkbKeyAction.3.html"><strong>XkbKeyAction</strong>(3)</a>, <a href="../man3/XkbKeyActionEntry.3.html"><strong>XkbKeyActionEntry</strong>(3)</a>, <a href="../man3/XkbKeyActionsPtr.3.html"><strong>XkbKeyActionsPtr</strong>(3)</a>, <a href="../man3/XkbKeyHasActions.3.html"><strong>XkbKeyHasActions</strong>(3)</a>, <a href="../man3/XkbKeyNumActions.3.html"><strong>XkbKeyNumActions</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="XkbAllocServerMap.3.html"><span aria-hidden="true">&larr;</span> XkbAllocServerMap.3: Allocate and initialize an empty server map description record</a></li>
   <li class="next"><a href="XkbBell.3.html">XkbBell.3: Rings the bell on the default keyboard <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
