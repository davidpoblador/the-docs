<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmextractvalue: Extract a performance metric value from a pmresult structure</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Extract a performance metric value from a pmresult structure">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmextractvalue<small> (3)</small></h1>
        <p class="lead">Extract a performance metric value from a pmresult structure</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmextractvalue.3.html">
      <span itemprop="name">pmextractvalue: Extract a performance metric value from a pmresult structure</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmextractvalue.3.html">
      <span itemprop="name">pmextractvalue: Extract a performance metric value from a pmresult structure</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;pcp/pmapi.h&gt;</p><p>int pmExtractValue(int <em>valfmt</em>, const pmValue *<em>ival</em>, int&nbsp;<em>itype</em>, pmAtomValue&nbsp;*<em>oval</em>, int&nbsp;<em>otype</em>);</p><p>cc ... -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The structure is embedded within the structure that is used to return one or more performance metrics; see <strong>pmFetch</strong>(3).</p><p>All performance metric values may be encoded in a union, defined as follows;</p>
<pre>
typedef union {
    __int32_t    l;     /* 32-bit signed */
    __uint32_t   ul;    /* 32-bit unsigned */
    __int64_t    ll;    /* 64-bit signed */
    __uint64_t   ull;   /* 64-bit unsigned */
    float        f;     /* 32-bit floating point */
    double       d;     /* 64-bit floating point */
    char         *cp;   /* char ptr */
    pmValueBlock *vbp;  /* pmValueBlock ptr */
} pmAtomValue;
</pre>
<p>The routine <strong>pmExtractValue</strong> provides a convenient mechanism for extracting values from the part of a structure, optionally converting the data type, and making the result available to the application programmer.</p><p><em>itype</em> defines the data type of the input value held in <em>ival</em> according to the storage format defined by <em>valfmt</em> (see <strong>pmFetch</strong>(3)). <em>otype</em> defines the data type of the result to be placed in <em>oval</em>.</p><p>The value for <em>itype</em> is typically extracted from a structure, following a call to <strong>pmLookupDesc</strong>(3) for a particular performance metric.</p><p>The <em>otype</em> value should be one of the defined <strong>PM_TYPE_</strong>... values, that have a 1:1 correspondence with the fields in the union.</p><p>Normally the <em>valfmt</em> parameter would be plucked from the same structure that provides the <em>ival</em> parameter, and if <em>valfmt</em> specifies <strong>PM_VAL_INSITU</strong>, then the following types are not allowed, as these cannot be encoded in 32-bits; <strong>__int64_t</strong>, <strong>__uint64_t</strong>, <strong>double</strong>, <strong>char *</strong> and <strong>void *</strong> (the corresponding <em>itype</em> values are <strong>PM_TYPE_64</strong>, <strong>PM_TYPE_U64</strong>, <strong>PM_TYPE_DOUBLE</strong>, <strong>PM_TYPE_STRING</strong>, <strong>PM_TYPE_AGGREGATE</strong> and <strong>PM_TYPE_EVENT</strong> respectively). If <em>valfmt</em> specifies <strong>PM_VAL_PTR</strong>, then the value will be extracted from the associated structure, and the <strong>__int32_t</strong>, <strong>__uint32_t</strong> and <strong>float</strong> options ( .I itype being <strong>PM_TYPE_32</strong>, <strong>PM_TYPE_U32</strong> and <strong>PM_TYPE_FLOAT</strong> respectively) are not allowed, as <strong>PM_VAL_INSITU</strong> is the appropriate encoding for these.</p><p>The following table defines the various possibilities for the type conversion -- the input type ( .IR itype ) is shown vertically, and the output type ( .IR otype ) is shown horizontally. Y means the conversion is always acceptable, N means the conversion can never be performed (the function returns <strong>PM_ERR_CONV</strong>), P means the conversion may lose accuracy (but no error status is returned), T means the result may be subject to high-order truncation (in which case the function returns <strong>PM_ERR_TRUNC</strong>) and S means the conversion may be impossible due to the sign of the input value (in which case the function returns <strong>PM_ERR_SIGN</strong>). If an error occurs, the value represented by <em>oval</em> will be zero (or <strong>NULL</strong>).</p><p>Note that although some of the conversions involving the types <strong>PM_TYPE_STRING</strong> and <strong>PM_TYPE_AGGREGATE</strong> are indeed possible, but are marked N - the rationale is that <strong>pmExtractValue</strong> should not be attempting to duplicate functionality already available in the C library via <a href="../man3/sscanf.3.html"><strong>sscanf</strong>(3)</a> and <a href="../man3/sprintf.3.html"><strong>sprintf</strong>(3)</a>.</p><p>No conversion involving the type <strong>PM_TYPE_EVENT</strong> is supported.</p>
<pre>
      | 32  |  U32  | 64  |  U64  | FLOAT | DBLE | STRNG | AGGR | EVENT
======|=====|=======|=====|=======|=======|======|=======|======|=======
32    |  Y  |   S   |  Y  |   S   |   P   |  P   |   N   |  N   |   N
U32   |  T  |   Y   |  Y  |   Y   |   P   |  P   |   N   |  N   |   N
64    |  T  |  T,S  |  Y  |   S   |   P   |  P   |   N   |  N   |   N
U64   |  T  |   T   |  T  |   Y   |   P   |  P   |   N   |  N   |   N
FLOAT | P,T | P,T,S | P,T | P,T,S |   Y   |  Y   |   N   |  N   |   N
DBLE  | P,T | P,T,S | P,T | P,T,S |   P   |  Y   |   N   |  N   |   N
STRNG |  N  |   N   |  N  |   N   |   N   |  N   |   Y   |  N   |   N
AGGR  |  N  |   N   |  N  |   N   |   N   |  N   |   N   |  Y   |   N
EVENT |  N  |   N   |  N  |   N   |   N   |  N   |   N   |  N   |   N
</pre>
<p>In the cases where multiple conversion errors could occur, the first encountered error will be notified, and the order of checking is not defined.</p><p>If the output conversion is to one of the pointer types, i.e.  .I otype is <strong>PM_TYPE_STRING</strong> or <strong>PM_TYPE_AGGREGATE</strong>, then the value buffer will have been allocated by <strong>pmExtractValue</strong>(3) using <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, and it is the caller's responsibility to free the space when it is no longer required.</p><p>Although this function appears rather complex, it has been constructed to assist the development of performance tools that wish to convert values, whose type is only known via the field in a structure, into a canonical type for local processing. See the <strong>pmFetchGroup</strong> functions for a simpler alternative.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmextractvalue&hellip;</h2>
        <div class="sectioncontent">
<p><strong>PMAPI</strong>(3), <strong>pmAtomStr</strong>(3), <strong>pmConvScale</strong>(3), <strong>pmFetch</strong>(3), <strong>pmFetchGroup</strong>(3), <strong>pmLookupDesc</strong>(3), <strong>pmPrintValue</strong>(3), <strong>pmTypeStr</strong>(3), <strong>pmUnitsStr</strong>(3) and <strong>pmUnpackEventRecords</strong>(3).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p><strong>PM_ERR_CONV</strong></p><ul>
<li><p>Impossible conversion, marked by N in above table</p></li>
</ul><p><strong>PM_ERR_TRUNC</strong></p><ul>
<li><p>High-order truncation occurred</p></li>
</ul><p><strong>PM_ERR_SIGN</strong></p><ul>
<li><p>Conversion of negative value to unsigned type attempted</p></li>
</ul>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmeventflagsstr.3.html"><span aria-hidden="true">&larr;</span> pmeventflagsstr.3: Convert an event record flags value into a string</a></li>
   <li class="next"><a href="pmfault.3.html">pmfault.3: Fault injection infrastracture for qa <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
