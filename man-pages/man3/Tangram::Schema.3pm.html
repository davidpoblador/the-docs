<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tangram::Schema: Describe a system of persistent classes</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Describe a system of persistent classes">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Tangram::Schema (3pm) manual">
  <meta name="twitter:description" content="Describe a system of persistent classes">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtangram-perl-Tangram::Schema-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Tangram::Schema.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tangram::Schema (3pm) manual" />
  <meta property="og:description" content="Describe a system of persistent classes" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtangram-perl-Tangram::Schema-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Tangram::Schema<small> (3pm)</small></h1>
        <p class="lead">Describe a system of persistent classes</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tangram::Schema.3pm.html">
      <span itemprop="name">Tangram::Schema: Describe a system of persistent classes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtangram-perl/">
      <span itemprop="name">libtangram-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tangram::Schema.3pm.html">
      <span itemprop="name">Tangram::Schema: Describe a system of persistent classes</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
   use Tangram;

   $schema = Tangram::Schema-&gt;new( $hashref );

   Tangram::Relational-&gt;connect( $schema, ... );

   # write SQL to FILE
   $schema-&gt;deploy( &#92;*FILE );

   # write SQL to STDOUT
   $schema-&gt;deploy();
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>A Schema contains all the information about the persistent aspects of a system of classes. That information is used to perform the mapping between \s-1OO\s0 constructs and a relational database.</p><p>Schema objects are initialized from a nested data structure called a schema hash. The general structure of the schema hash is described here.</p><p>The resulting Schema object becomes the owner of the schema hash passed to <em>new()</em>. The hash may not be modified afterwards, and no assumptions can be made regarding its content.</p><p><strong>note</strong>: No corresponding Perl classes are generated from calling \*(C`Tangram::Schema-&gt;new\*(C'.  If you want that, and like the behaviour of the separately distributed \*(C`Class::Tangram\*(C' module, then you should pass the $hashref in the above example to the \*(C`Class::Tangram::Generator-&gt;new()\*(C' constructor.  See Class::Tangram::Generator for more information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CLASS METHODS</h2>
        <div class="sectioncontent">
<h3>new</h3>
<p>   $schema = Tangram::Schema-&gt;new( $hash );</p><p>Returns a new Schema object.</p><p>The newly created Schema object becomes the owner of the hash, which can no longer be modified nor reused by client code.</p><p>The schema hash describes the persistent aspects of a system of classes. It is a multilevel data structure.</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>The first level of the hash contains information that is relevant to the system as a whole.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>The second level contains information on a per-class basis.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>The third level contains information about the individual fields in a class. That information depends on the type of the field and is not documented here; see \*(L"field hash\*(R" for a list of predefined persistent types.</p>
  </dd>

</dl>

<h3>Global properties</h3>
<p>The first level of the schema hash describes aspects that are global to a system of persistent classes. It has the following aspect:</p><p>   {       classes =&gt;      [         Identity =&gt;          {             table =&gt; &apos;IdentityState&apos;,          abstract =&gt; 1          },</p><p>         NaturalPerson =&gt;          {             bases =&gt; [ qw( Identity ) ],          },</p><p>         LegalPerson =&gt;          {             bases =&gt; [ qw( Identity ) ],          },       ],</p><p>      make_object =&gt; sub { ... },       set_id =&gt; sub { ... }       get_id =&gt; sub { ... }       normalize =&gt; sub { ... },</p><p>      control =&gt; &apos;...&apos;</p><p>      sql =&gt; { ... },    }</p><p>\*(C`classes\*(C' is an array called the \*(L"class registry\*(R". It contains a description of each persistent class.</p><p>\*(C`make_object\*(C' contains a reference to a closure that returns a new object of a given class. This field is optional: by default, Tangram calls class method <em>new()</em>.</p><p>\*(C`set_id\*(C' and \*(C`get_id\*(C' are used together to associate an object \s-1ID\s0 with a persistent object. By default, Tangram converts a reference to an object to a unique integer value by evaluating the expression \*(C`0 + $obj\*(C'. The result is used as a key in a hash contained in the Storage object. The values in that hash are the object IDs.</p><p>If any of your classes use overloading, this approach will not work and you will need to supply your own get/set_id methods.</p><p>\*(C`control\*(C' is the name of a table that has a single row, containing the major and minor version numbers of the Tangram that created the storage, and the highest allocated object id. It defaults to 'Tangram'.</p><p>Optional field \*(C`normalize\*(C' contains a subroutine that's called to transform classnames and fieldnames into table and column names. The function is called with two arguments; the name to be transformed, and a 'type' argument (currently one of 'tablename' or 'fieldname'). The return value should be the transformed string.</p><p>Note that it is expected that the normalize sub will return identical strings with identical arguments, that \*(C`normalize(normalize($string, $flag), $flag) eq normalize($string, $flag)\*(C'</p><p>Optional field \*(C`sql\*(C' contains a hash that can be used to customize some of the \s-1SQL\s0 generated by Tangram.  The available options are:</p><ul>
<li><p>default_null \*(C`default_null\*(C' can be used to deal with those databases that don't support the explicit '\s-1NULL\s0' specifier in column definitions.  Defaults to '\s-1NULL\s0'.  Note that this does not get automatically appended to attributes that have a \s-1SQL\s0 type explicitly declared.</p></li><li><p>id Object ids encode the type of the object. Tangram assigns a class id to each persistent concrete class within a Schema. When an object is inserted, Tangram allocates a unique integer from a class-specific allocator, then appends the class id to it. Thus the object id for a NaturalPerson may look like 270005, where 0005 is the class id. Field \*(C`id\*(C' contains the \s-1SQL\s0 type that is used to map the rowid part of the object id. It defaults to '\s-1INTEGER\s0'.</p></li><li><p>oid_sequence If set, this is the name of a <em>sequence</em> to use as the default \s-1OID\s0 generator, should a particular class not define one. Sequences are an alternate way of generating unique identifiers for rows.  They are more scalable when you have high concurrency, but most people won't notice that. It is also possible to define an \s-1OID\s0 sequence on a per-class level; see below for details. Sequences are emulated on pretend databases like MySQL.</p></li><li><p>make_id This is a <em>closure</em> that is expected to return an unique \s-1ID\s0.  It is called like this:    $make_id-&gt;($class_id, $storage) Where $class_id is the Class identifier for_the newly created object, and $storage is the <strong>Tangram::Storage</strong> object.</p></li><li><p>cid Field \*(C`cid\*(C' contains the \s-1SQL\s0 type that is used to map the class id part of the object id. It defaults to '\s-1INTEGER\s0'.</p></li><li><p>cid_size Field \*(C`cid_size\*(C' contains the number of decimal positions that the class id occupies within the object id. It defaults to '4'.  <strong>This</strong> does not affect the database, only the in-memory representation of object IDs.</p></li><li><p>oid Historical spurious documentation bug.  Documentation described the function that the \*(C`id\*(C' option performs.</p></li><li><p>table_type Field \*(C`table_type\*(C' is a string that if set, will be appended to all \s-1CREATE\s0 \s-1TABLE\s0 commands with TYPE=x.  For instance, to use transactions with a MySQL database with InnoDB enabled, set \*(C`table_type\*(C' to \*(C`InnoDB\*(C', and (re)deploy your database.</p></li><li><p>dumper This field sets the default mechanism by which arbitrary structures are serialised to columns, in the absence of a portion of the Tangram schema covering their mapping. The default value is \*(C`Storable\*(C' (see Storable), seeing as Storable is something like the \*(L"native\*(R" serialisation mechanism for Perl. Currently, this setting only applies to the <strong>idbif</strong> mapping type (see Tangram::Type::Dump::Any). It would make more sense for the default to be \*(C`YAML\*(C', but unfortunately \s-1YAML\s0 doesn't support dumping the entire range of native Perl data types, which sucks immensely.</p></li>
</ul><p>The other fields are related to the \s-1SQL\s0 types that Tangram uses to store meta-information.</p>
<h3>class registry</h3>
<p>The class registry is an array containing one entry per persistent class.  The array contains a list of \*(C`key =&gt; value\*(C' pairs. The key is the class name, the value is a reference to a hash called the class hash. It contains information on how to map the class.</p><p>The class hash can have the following fields:</p><ul>
<li><p>abstract</p></li><li><p>bases</p></li><li><p>fields</p></li><li><p>table</p></li><li><p>table_type</p></li><li><p>id</p></li><li><p>oid_sequence</p></li><li><p>make_id</p></li>
</ul><p>Field \*(C`abstract\*(C' contains a boolean that should be true if the class is abstract. If this field is not present, the class is considered to be concrete.</p><p>Field \*(C`bases\*(C' contains a reference to an array of base classes.</p><p>Field \*(C`fields\*(C' contains a reference to the \*(L"field hash\*(R".</p><p>Field \*(C`table\*(C' sets the name of the table that Tangram should use to store the state of objects pertaining to this class. This field is optional: it defaults to the class name. If the class name is not an acceptable \s-1SQL\s0 table identifier, you will need to set this field.</p><p>Field \*(C`table_type\*(C' sets the type of the table, for instance, the storage back-end to the \s-1RDBMS\s0 or storage format; it specifies on a per-table basis what the \*(C`table_type\*(C' attribute of the schema defines.  You almost certainly don't want to set this on a per-table basis.</p><p>Field \*(C`id\*(C' contains an integer identifier for this class. That identifier must be unique within the same schema. If this field is not present, Tangram sets it to the last class id plus one.</p><p>Fields \*(C`oid_sequence\*(C' and \*(C`make_id\*(C' are per-class versions of their schema-wide versions documented above.  These should be inherited by their subclasses, but currently (as of 2.07_06) aren't.  To be safe, until this documentation is fixed, define them in all subclasses.</p>
<h3>field hash</h3>
<p>Each persistent type is identified by a 'typetag', e.g. \*(C`int\*(C', \*(C`string\*(C' or \*(C`array\*(C'.</p><p>All the persistent fields of a given type are grouped together inside the field hash, where the typetag is used as a key. The individual fields are specified in an array or a hash, whose layout is type-dependant. For example:</p><p>   fields =&gt;    {       string   =&gt; [ qw( firstName name ) ],       int      =&gt; [ qw( age ) ],       ref      =&gt; { partner =&gt; { null =&gt; 1 } },       array    =&gt; { children =&gt; &apos;NaturalPerson&apos; },    },</p><p>The typetag not only specifies the type of a field, but also the way in which it should be mapped to \s-1SQL\s0 constructs. Sometimes the same Perl type lends itself to more than one mapping, for example there are at least two plausible ways of mapping a Perl array (see Tangram::Type::Array::FromMany and Tangram::Type::Array::FromOne).</p><p>Tangram's persistent type system is extensible, allowing you to mount your own types and make them persistent. All you have to do is to register your type and provide mapping code. See Tangram::Type.</p><p>Tangram comes with built-in support for the following types:</p><p>* string, int, real: see Tangram::Type::Scalar</p><p>* reference : see Tangram::Type::Ref::FromMany</p><p>* array : see Tangram::Type::Array::FromMany, Tangram::Type::Array::FromOne</p><p>* Set::Object : see Tangram::Type::Set::FromMany, Tangram::Type::Set::FromOne</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTANCE METHODS</h2>
        <div class="sectioncontent">
<h3>deploy</h3>
<p>This method is deprecated. See Tangram::Relational.</p>
<h3>retreat</h3>
<p>This method is deprecated. See Tangram::Relational.</p>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Tangram::Remote.3pm.html"><span aria-hidden="true">&larr;</span> Tangram::Remote.3pm: Represent persistent objects in client space</a></li>
   <li class="next"><a href="Tangram::Springfield.3pm.html">Tangram::Springfield.3pm: Classes and schema used in the guided tour <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
