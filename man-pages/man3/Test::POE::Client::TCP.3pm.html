<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test::POE::Client::TCP: A poe component providing tcp client services for test cases</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A poe component providing tcp client services for test cases">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Test::POE::Client::TCP (3pm) manual">
  <meta name="twitter:description" content="A poe component providing tcp client services for test cases">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtest-poe-client-tcp-perl-Test::POE::Client::TCP-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Test::POE::Client::TCP.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Test::POE::Client::TCP (3pm) manual" />
  <meta property="og:description" content="A poe component providing tcp client services for test cases" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtest-poe-client-tcp-perl-Test::POE::Client::TCP-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Test::POE::Client::TCP<small> (3pm)</small></h1>
        <p class="lead">A poe component providing tcp client services for test cases</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Test::POE::Client::TCP.3pm.html">
      <span itemprop="name">Test::POE::Client::TCP: A poe component providing tcp client services for test cases</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtest-poe-client-tcp-perl/">
      <span itemprop="name">libtest-poe-client-tcp-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Test::POE::Client::TCP.3pm.html">
      <span itemprop="name">Test::POE::Client::TCP: A poe component providing tcp client services for test cases</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>version 1.12</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use strict;
  use Socket;
  use Test::More tests =&gt; 15;
  use POE qw(Wheel::SocketFactory Wheel::ReadWrite Filter::Line);
  use Test::POE::Client::TCP;

  my @data = (
    &apos;This is a test&apos;,
    &apos;This is another test&apos;,
    &apos;This is the last test&apos;,
  );

  POE::Session-&gt;create(
    package_states =&gt; [
        &apos;main&apos; =&gt; [qw(
                        _start
                        _accept
                        _failed
                        _sock_in
                        _sock_err
                        testc_registered
                        testc_connected
                        testc_disconnected
                        testc_input
                        testc_flushed
        )],
    ],
    heap =&gt; { data =&gt; &#92;@data, },
  );

  $poe_kernel-&gt;run();
  exit 0;

  sub _start {
    my ($kernel,$heap) = @_[KERNEL,HEAP];
    $heap-&gt;{listener} = POE::Wheel::SocketFactory-&gt;new(
        BindAddress    =&gt; &apos;127.0.0.1&apos;,
        SuccessEvent   =&gt; &apos;_accept&apos;,
        FailureEvent   =&gt; &apos;_failed&apos;,
        SocketDomain   =&gt; AF_INET,             # Sets the socket() domain
        SocketType     =&gt; SOCK_STREAM,         # Sets the socket() type
        SocketProtocol =&gt; &apos;tcp&apos;,               # Sets the socket() protocol
        Reuse          =&gt; &apos;on&apos;,                # Lets the port be reused
    );
    $heap-&gt;{testc} = Test::POE::Client::TCP-&gt;spawn();
    return;
  }

  sub _accept {
    my ($kernel,$heap,$socket) = @_[KERNEL,HEAP,ARG0];
    my $wheel = POE::Wheel::ReadWrite-&gt;new(
        Handle       =&gt; $socket,
        InputEvent   =&gt; &apos;_sock_in&apos;,
        ErrorEvent   =&gt; &apos;_sock_err&apos;,
    );
    $heap-&gt;{wheels}-&gt;{ $wheel-&gt;ID } = $wheel;
    return;
  }

  sub _failed {
    my ($kernel,$heap,$operation,$errnum,$errstr,$wheel_id) = @_[KERNEL,HEAP,ARG0..ARG3];
    die "Wheel $wheel_id generated $operation error $errnum: $errstr&#92;n";
    return;
  }

  sub _sock_in {
    my ($heap,$input,$wheel_id) = @_[HEAP,ARG0,ARG1];
    pass(&apos;Got input from client&apos;);
    $heap-&gt;{wheels}-&gt;{ $wheel_id }-&gt;put( $input ) if $heap-&gt;{wheels}-&gt;{ $wheel_id };
    return;
  }

  sub _sock_err {
    my ($heap,$wheel_id) = @_[HEAP,ARG3];
    pass(&apos;Client disconnected&apos;);
    delete $heap-&gt;{wheels}-&gt;{ $wheel_id };
    return;
  }

  sub testc_registered {
    my ($kernel,$sender,$object) = @_[KERNEL,SENDER,ARG0];
    pass($_[STATE]);
    my $port = ( sockaddr_in( $_[HEAP]-&gt;{listener}-&gt;getsockname() ) )[0];
    $kernel-&gt;post( $sender, &apos;connect&apos;, { address =&gt; &apos;127.0.0.1&apos;, port =&gt; $port } );
    return;
  }

  sub testc_connected {
    my ($kernel,$heap,$sender) = @_[KERNEL,HEAP,SENDER];
    pass($_[STATE]);
    $kernel-&gt;post( $sender, &apos;send_to_server&apos;, $heap-&gt;{data}-&gt;[0] );
    return;
  }

  sub testc_flushed {
    pass($_[STATE]);
    return;
  }

  sub testc_input {
    my ($heap,$input) = @_[HEAP,ARG0];
    pass(&apos;Got something back from the server&apos;);
    my $data = shift @{ $heap-&gt;{data} };
    ok( $input eq $data, "Data matched: &apos;$input&apos;" );
    unless ( scalar @{ $heap-&gt;{data} } ) {
      $heap-&gt;{testc}-&gt;terminate();
      return;
    }
    $poe_kernel-&gt;post( $_[SENDER], &apos;send_to_server&apos;, $heap-&gt;{data}-&gt;[0] );
    return;
  }

  sub testc_disconnected {
    my ($heap,$state) = @_[HEAP,STATE];
    pass($state);
    delete $heap-&gt;{wheels};
    delete $heap-&gt;{listener};
    $heap-&gt;{testc}-&gt;shutdown();
    return;
  }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Test::POE::Client::TCP is a \s-1POE\s0 component that provides a \s-1TCP\s0 client framework for inclusion in client component test cases, instead of having to roll your own.</p><p>Once registered with the component, a session will receive events related to connections made, disconnects, flushed output and input from the specified server.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR</h2>
        <div class="sectioncontent">
<p>Takes a number of optional arguments:   &apos;alias&apos;, set an alias on the component;   &apos;address&apos;, the remote address to connect to;   &apos;port&apos;, the remote port to connect to;   &apos;options&apos;, a hashref of POE::Session options;   &apos;filter&apos;, specify a POE::Filter to use for client connections, default is POE::Filter::Line;   &apos;inputfilter&apos;, specify a POE::Filter for client input;   &apos;outputfilter&apos;, specify a POE::Filter for output to clients;   &apos;localaddr&apos;, specify that connections be made from a particular local address;   &apos;localport&apos;, specify that connections be made from a particular port;   &apos;autoconnect&apos;, set to a true value to make the poco connect immediately;   &apos;prefix&apos;, specify an event prefix other than the default of &apos;testc&apos;;   &apos;timeout&apos;, specify number of seconds to wait for socket timeouts; The semantics for \*(C`filter\*(C', \*(C`inputfilter\*(C' and \*(C`outputfilter\*(C' are the same as for POE::Component::Server::TCP in that one may provide either a \*(C`SCALAR\*(C', \*(C`ARRAYREF\*(C' or an \*(C`OBJECT\*(C'. If the component is \*(C`spawn\*(C'ed within another session it will automatically \*(C`register\*(C' the parent session to receive \*(C`all\*(C' events. \*(C`address\*(C' and \*(C`port\*(C' are optional within \*(C`spawn\*(C', but if they aren't specified they must be provided to subsequent \*(C`connect\*(C's. If \*(C`autoconnect\*(C' is specified, \*(C`address\*(C' and \*(C`port\*(C' must also be defined.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>Initiates a connection to the given server. Takes a number of parameters:   &apos;address&apos;, the remote address to connect to;   &apos;port&apos;, the remote port to connect to;   &apos;localaddr&apos;, specify that connections be made from a particular local address, optional;   &apos;localport&apos;, specify that connections be made from a particular port, optional; \*(C`address\*(C' and \*(C`port\*(C' are optional if they have been already specified during \*(C`spawn\*(C'. Returns the POE::Session \s-1ID\s0 of the component. Terminates the component. It will terminate any pending connects or connections. Retrieves socket information about the current connection. In a list context it returns a list consisting of, in order, the server address, the server \s-1TCP\s0 port, our address and our \s-1TCP\s0 port. In a scalar context it returns a \s-1HASHREF\s0 with the following keys:   &apos;peeraddr&apos;, the server address;   &apos;peerport&apos;, the server TCP port;   &apos;sockaddr&apos;, our address;   &apos;sockport&apos;, our TCP port; Send some output to the connected server. The first parameter is a string of text to send. This parameter may also be an arrayref of items to send to the client. If the filter you have used requires an arrayref as input, nest that arrayref within another arrayref. Places the server connection into pending disconnect state. Set this, then send an applicable message to the server using \*(C`send_to_server()\*(C' and the server connection will be terminated. Immediately disconnects a server conenction. Returns the underlying POE::Wheel::ReadWrite object if we are currently connected to a server, \*(C`undef\*(C' otherwise. You can use this method to call methods on the wheel object to switch filters, etc. Exercise caution. Returns the currently configured alias.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INPUT EVENTS</h2>
        <div class="sectioncontent">
<p>These are events that the component will accept: Takes N arguments: a list of event names that your session wants to listen for, minus the 'testc_' prefix. Registering for 'all' will cause it to send all TESTC-related events to you; this is the easiest way to handle it. Takes N arguments: a list of event names which you don't want to receive. If you've previously done a 'register' for a particular event which you no longer care about, this event will tell the poco to stop sending them to you. (If you haven't, it just ignores you. No big deal). Initiates a connection to the given server. Takes a number of parameters:   &apos;address&apos;, the remote address to connect to;   &apos;port&apos;, the remote port to connect to;   &apos;localaddr&apos;, specify that connections be made from a particular local address, optional;   &apos;localport&apos;, specify that connections be made from a particular port, optional; \*(C`address\*(C' and \*(C`port\*(C' are optional if they have been already specified during \*(C`spawn\*(C'. Terminates the component. It will terminate any pending connects or connections. Send some output to the connected server. The first parameter is a string of text to send. This parameter may also be an arrayref of items to send to the client. If the filter you have used requires an arrayref as input, nest that arrayref within another arrayref. Places the server connection into pending disconnect state. Set this, then send an applicable message to the server using \*(C`send_to_server()\*(C' and the server connection will be terminated. Immediately disconnects a server conenction.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OUTPUT EVENTS</h2>
        <div class="sectioncontent">
<p>The component sends the following events to registered sessions. If you have changed the \*(C`prefix\*(C' option in \*(C`spawn\*(C' then substitute \*(C`testc\*(C' with the event prefix that you specified. This event is sent to a registering session. \s-1ARG0\s0 is the Test::POE::Client::TCP object. Generated if the component cannot make a socket connection. \s-1ARG0\s0 contains the name of the operation that failed. \s-1ARG1\s0 and \s-1ARG2\s0 hold numeric and string values for $!, respectively. Generated whenever a connection is established. \s-1ARG0\s0 is the server's \s-1IP\s0 address, \s-1ARG1\s0 is the server's \s-1TCP\s0 port. \s-1ARG3\s0 is our \s-1IP\s0 address and \s-1ARG4\s0 is our socket port. Generated whenever we disconnect from the server. Generated whenever the server sends us some traffic. \s-1ARG0\s0 is the data sent ( tokenised by whatever POE::Filter you specified ). Generated whenever anything we send to the server is actually flushed down the 'line'.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">KUDOS</h2>
        <div class="sectioncontent">
<p>Contains code borrowed from POE::Component::Server::TCP by Rocco Caputo, Ann Barcomb and Jos Boumans.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Test::POE::Client::TCP&hellip;</h2>
        <div class="sectioncontent">
<p>\s-1POE\s0</p><p>POE::Component::Server::TCP</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Chris Williams &lt;chris@bingosnet.co.uk&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>This software is copyright (c) 2013 by Chris Williams, Rocco Caputo, Ann Barcomb and Jos Boumans.</p><p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Test::NoWarnings.3pm.html"><span aria-hidden="true">&larr;</span> Test::NoWarnings.3pm: Make sure you didn't emit any warnings while testing</a></li>
   <li class="next"><a href="Test::POE::Server::TCP.3pm.html">Test::POE::Server::TCP.3pm: A poe component providing tcp server services for test cases <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
