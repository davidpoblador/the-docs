<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PMDA: Introduction to the performance metrics domain agent support library</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Introduction to the performance metrics domain agent support library">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="PMDA (3) manual">
  <meta name="twitter:description" content="Introduction to the performance metrics domain agent support library">
  <meta name="twitter:image" content="https://www.carta.tech/images/libpcp-pmda3-dev-PMDA-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/PMDA.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="PMDA (3) manual" />
  <meta property="og:description" content="Introduction to the performance metrics domain agent support library" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libpcp-pmda3-dev-PMDA-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">PMDA<small> (3)</small></h1>
        <p class="lead">Introduction to the performance metrics domain agent support library</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/PMDA.3.html">
      <span itemprop="name">PMDA: Introduction to the performance metrics domain agent support library</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libpcp-pmda3-dev/">
      <span itemprop="name">libpcp-pmda3-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/PMDA.3.html">
      <span itemprop="name">PMDA: Introduction to the performance metrics domain agent support library</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;pcp/pmapi.h&gt;</p><p>#include &lt;pcp/impl.h&gt;</p><p>#include &lt;pcp/pmda.h&gt;</p><p>cc ... -lpcp_pmda -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>To assist in the development of Performance Metric Domain Agents (<strong>PMDA</strong>s) for the Performance Co-Pilot (PCP), a procedural interface is provided that extends the Performance Metrics Application Programming Interface ( <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a>) library.  These procedures are designed to enable a programmer to quickly build a <strong>PMDA</strong> which can then be tested and refined.  However, this also implies that a <strong>PMDA</strong> has a particular structure which may not be suitable for all applications.</p><p>Once you are familiar with the PCP and <strong>PMDA</strong> frameworks, you can quickly implement a new <strong>PMDA</strong> with only a few data structures and functions.  This is covered in far greater detail in the <em>Performance Co-Pilot Programmer's Guide</em>.</p><p>A <strong>PMDA</strong> is responsible for a set of performance metrics, in the sense that it must respond to requests from <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a></strong> for information about performance metrics, instance domains, and instantiated values.  The <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> process generates requests on behalf of performance tools that make requests using <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a> routines.</p><p>This man page contains sections of the <strong>simple PMDA</strong> which is located at <em>$PCP_PMDAS_DIR/simple</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMUNICATING WITH PMCD</h2>
        <div class="sectioncontent">
<p>Two approaches may be used for connecting a <strong>PMDA</strong> to a <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> process.  A Dynamic Shared Object (DSO) can be attached by <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> using <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a> when the <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> process is started.  A procedural interface referenced through a shared data structure is used to handle requests from <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> to the <strong>PMDA</strong>.</p><p>The preferred approach is for a separate process (daemon) to communicate with <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> using the Performance Data Units (PDU) Inter-Process Communication (IPC) protocol.</p><p>All <strong>PMDA</strong>s are launched and controlled by the <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> process on the local host.  The requests from the clients are received by <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> and forwarded to the appropriate <strong>PMDA</strong>s. Responses, when required, are returned through <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> to the clients.  The requests (PDUs) that may be sent to a <strong>PMDA</strong> from <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> are <strong>PDU_FETCH</strong>, <strong>PDU_PROFILE</strong>, <strong>PDU_INSTANCE_REQ</strong>, <strong>PDU_DESC_REQ</strong>, <strong>PDU_TEXT_REQ</strong> and <strong>PDU_RESULT</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEFAULT CALLBACKS FOR HANDLING PDUs</h2>
        <div class="sectioncontent">
<p>To allow a consistent framework, <a href="../man3/pmdaMain.3.html"><strong>pmdaMain</strong>(3)</a> can be used by a daemon <strong>PMDA</strong> to handle the communication protocol using the same callbacks as a DSO <strong>PMDA</strong>. The structure <strong>pmdaInterface</strong> is used to convey the common procedural interface and state information that is used by <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> and a <strong>PMDA</strong>. This state information includes tables describing the supported metrics and instance domains.</p><p>As most of the procedural interface is identical for all <strong>PMDA</strong>s, they are provided as part of this support library (<a href="../man3/pmdaProfile.3.html"><strong>pmdaProfile</strong>(3)</a>, <a href="../man3/pmdaFetch.3.html"><strong>pmdaFetch</strong>(3)</a>, <a href="../man3/pmdaInstance.3.html"><strong>pmdaInstance</strong>(3)</a>, <a href="../man3/pmdaDesc.3.html"><strong>pmdaDesc</strong>(3)</a>, <a href="../man3/pmdaText.3.html"><strong>pmdaText</strong>(3)</a> and <a href="../man3/pmdaStore.3.html"><strong>pmdaStore</strong>(3)</a>). However, these routines require access to the <strong>pmdaInterface</strong> state information so it must be correctly initialized using <a href="../man3/pmdaConnect.3.html"><strong>pmdaConnect</strong>(3)</a>, <a href="../man3/pmdaDaemon.3.html"><strong>pmdaDaemon</strong>(3)</a>, <a href="../man3/pmdaOpenLog.3.html"><strong>pmdaOpenLog</strong>(3)</a>, <a href="../man3/pmdaDSO.3.html"><strong>pmdaDSO</strong>(3)</a>, <a href="../man3/pmdaGetOpt.3.html"><strong>pmdaGetOpt</strong>(3)</a> and <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTANCES AND INSTANCE DOMAINS</h2>
        <div class="sectioncontent">
<p>Three structures are declared in <em>/usr/include/pcp/pmda.h</em> which provide a framework for declaring the metrics and instances supported by the <strong>PMDA</strong>.</p><p>Every instance requires a unique integer identifier and a unique name, as defined by the structure <strong>pmdaInstid</strong>:</p>
<pre>
/*
 * Instance description: index and name
 */

typedef struct {
    int         i_inst;        /* internal instance identifier */
    char        *i_name;       /* external instance identifier */
} pmdaInstid;
</pre>
<p>An instance domain requires its own unique identification (<strong>pmInDom</strong>), the number of instances the domain represents, and a pointer to an array of instance descriptions.  This is defined in the structure <strong>pmdaIndom</strong>:</p>
<pre>
/*
 * Instance domain description: unique instance id,
 * number of instances in this domain, and the list of
 * instances (not null terminated).
 */

typedef struct {
    pmInDom     it_indom;       /* indom, filled in */
    int         it_numinst;     /* number of instances */
    pmdaInstid  *it_set;        /* instance identifiers */
} pmdaIndom;
</pre>
<p>The <strong>simple PMDA</strong> has one instance domain for <em>simple</em>.<em>color</em> with three instances (<em>red</em>, <em>green</em> and <em>blue</em>), and a second instance domain for <em>simple</em>.<em>now</em> with instances which can be specified at run-time. These instance domains are defined as:</p>
<pre>
static pmdaInstid _color[] = {
    { 0, "red" }, { 1, "green" }, { 2, "blue" }
};
static pmdaInstid *_timenow = NULL;

static pmdaIndom indomtab[] = {
#define COLOR_INDOM	0
    { COLOR_INDOM, 3, _color },
#define NOW_INDOM 1
    { NOW_INDOM, 0, NULL },
};
</pre>
<p>The preprocessor macros <strong>COLOR_INDOM</strong> and <strong>NOW_INDOM</strong> are used in the metric description table to identify the instance domains of individual metrics.  These correspond to the <em>serial</em> value in the instance domain <strong>pmInDom</strong> structure (the <em>domain</em> field is set by <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> at run-time).  The serial value must be unique for each instance domain within the <strong>PMDA</strong>.</p><p>The indom table shown above which is usually passed to <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> does not need to be created if one wants to write one's own Fetch and Instance functions. See <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> for more details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NAMESPACE</h2>
        <div class="sectioncontent">
<p>Every <strong>PMDA</strong> has its own unique <strong>namespace</strong> using the format defined in <a href="../man5/pmns.5.html"><strong>pmns</strong>(5)</a>. In summary, the namespace matches the names of the metrics to the unique identifier.  The <strong>simple PMDA</strong> defines five metrics: <em>simple</em>.<em>numfetch</em>, <em>simple</em>.<em>color</em>, <em>simple</em>.<em>time</em>.<em>user,</em> <em>simple</em>.<em>time</em>.<em>sys</em> and <em>simple</em>.<em>now</em>. The namespace for these metrics is defined in <em>$PCP_PMDAS_DIR/simple/pmns</em> and is installed as:</p>
<pre>
simple {
    numfetch    253:0:0
    color       253:0:1
    time
    now         253:2:4
}

simple.time {
    user        253:1:2
    sys         253:1:3
}
</pre>
<p>The domain number of <em>253</em> is obtained from <em>$PCP_VAR_DIR/pmns/stdpmid</em>. New <strong>PMDA</strong>s should specify a unique domain number in this file, and obtain the number during installation.  This allows the domain number to change by modifying only the file <em>$PCP_VAR_DIR/pmns/stdpmid</em>.</p><p>The <em>simple.time</em> and <em>simple.now</em> metrics are defined in separate clusters to the other metrics which allows a <strong>PMDA</strong> to support more than 1024 metrics, as well as grouping similar metrics together.  Therefore, the item numbers for a new cluster may be identical to the item numbers in other clusters.  The <strong>simple PMDA</strong> continues to increment the item numbers to permit direct mapping (see <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a>).</p><p>The namespace file should be installed and removed with the agent using <a href="../man1/pmnsadd.1.html"><strong>pmnsadd</strong>(1)</a> and <a href="../man1/pmnsdel.1.html"><strong>pmnsdel</strong>(1)</a>. See the later sections on INSTALLATION and REMOVAL.</p><p>A simple ASCII namespace can be constructed by creating a file similar to <em>$PCP_PMDAS_DIR/simple/root</em>:</p>
<pre>
/*
 * fake "root" for validating the local PMNS subtree
 */

#include "$PCP_VAR_DIR/pmns/stdpmid"

root { simple }

#include "pmns"

</pre>
<p>and can be referred to with the <strong>-n</strong> option in most PCP tools.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METRIC DESCRIPTIONS</h2>
        <div class="sectioncontent">
<p>Each metric requires a description (<strong>pmDesc</strong>), which contains its PMID, data type specification, instance domain, semantics and units (see <a href="../man3/pmLookupDesc.3.html"><strong>pmLookupDesc</strong>(3)</a>). A handle is also provided for application specific information in the <strong>pmdaMetric</strong> structure:</p>
<pre>
/*
 * Metric description: handle for extending description,
 * and the description.
 */

typedef struct {
    void*       m_user;         /* for users external use */
    pmDesc      m_desc;         /* metric description */
} pmdaMetric;
</pre>
<p>The <strong>simple PMDA</strong> defines the metrics as:</p>
<pre>
static pmdaMetric metrictab[] = {
/* numfetch */
    { (void *)0,
      { PMDA_PMID(0,0), PM_TYPE_U32, PM_INDOM_NULL, PM_SEM_INSTANT,
        { 0,0,0,0,0,0} }, },
/* color */
    { (void *)0,
      { PMDA_PMID(0,1), PM_TYPE_32, COLOR_INDOM, PM_SEM_INSTANT,
        { 0,0,0,0,0,0} }, },
/* time.user */
    { (void*)0,
      { PMDA_PMID(1,2), PM_TYPE_DOUBLE, PM_INDOM_NULL, PM_SEM_COUNTER,
      	{ 0, 1, 0, 0, PM_TIME_SEC, 0 } }, },
/* time.sys */
    { (void*)0,
      { PMDA_PMID(1,3), PM_TYPE_DOUBLE, PM_INDOM_NULL, PM_SEM_COUNTER,
      	{ 0, 1, 0, 0, PM_TIME_SEC, 0 } }, },
/* now */
    { NULL,
      { PMDA_PMID(2,4), PM_TYPE_U32, NOW_INDOM, PM_SEM_INSTANT,
        { 0,0,0,0,0,0 } }, },
};
</pre>
<p>The macro <strong>PMDA_PMID</strong> (defined in <em>/usr/include/pcp/pmda.h</em>) is used to specify each metric's <em>cluster</em> and <em>unit</em> number in the <strong>__pmID_int</strong> structure defined in <em>/usr/include/pcp/impl.h</em>. As with instance domains, the <em>domain</em> field is set by <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> at run-time, however, the default domain is assumed to be defined by the <strong>PMDA</strong> in the macro <strong>MYDOMAIN</strong>.</p><p>The metric table shown above which is usually passed to <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> does not need to be created if one wants to write one's own Fetch and Descriptor functions. See <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a> for more details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DSO PMDA</h2>
        <div class="sectioncontent">
<p>A <strong>PMDA</strong> that is run as a DSO is opened by <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> with <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a>. <strong>pmcd</strong> will call the <strong>PMDA</strong>'s initialization function that is specified in <em>$PCP_PMCDCONF_PATH.</em> This function is passed a pointer to a <strong>pmdaInterface</strong> structure which must be completed.  Any callbacks which are <em>not</em> the default <strong>PMDA</strong> support library callbacks must be specified in the <strong>pmdaInterface</strong> structure.</p><p>The <strong>simple PMDA</strong> uses its own store and fetch callback. <strong>simple_fetch</strong>() calls <a href="../man3/pmdaFetch.3.html"><strong>pmdaFetch</strong>(3)</a> which requires a callback to be set with <a href="../man3/pmdaSetFetchCallBack.3.html"><strong>pmdaSetFetchCallBack</strong>(3)</a> as can be seen in <em>$PCP_PMDAS_DIR/simple/simple.c</em>.</p><p>The flag <strong>_isDSO</strong> is used to determine if the <strong>PMDA</strong> is a daemon or a DSO so that the correct initialization routine, <a href="../man3/pmdaDaemon.3.html"><strong>pmdaDaemon</strong>(3)</a> or <a href="../man3/pmdaDSO.3.html"><strong>pmdaDSO</strong>(3)</a>, is called.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DAEMON PMDA</h2>
        <div class="sectioncontent">
<p>A <strong>PMDA</strong> that is run as a daemon is forked and executed by <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>. Therefore, unlike a DSO <strong>PMDA</strong>, the starting point for a daemon <strong>PMDA</strong> is <strong>main</strong>(). The agent should parse the command line arguments, create a log file and initialize some data structures that <strong>pmcd</strong> would initialize for a DSO agent.</p><p>The <strong>pmdaInterface</strong> structure must be completely defined by the daemon <strong>PMDA</strong>. The function <a href="../man3/pmdaDaemon.3.html"><strong>pmdaDaemon</strong>(3)</a> can be called at the start of <strong>main</strong>() to set most of these fields.  Command line parsing can be simplified by using <a href="../man3/pmdaGetOpt.3.html"><strong>pmdaGetOpt</strong>(3)</a>, which is similar to <strong>getopt</strong>(2), but extracts a common set of options into the <strong>pmdaInterface</strong> structure. <em>stderr</em> can be mapped to a log file using <a href="../man3/pmdaOpenLog.3.html"><strong>pmdaOpenLog</strong>(3)</a> to simplify debugging and error messages.  The connection to <strong>pmcd</strong> can be made with <a href="../man3/pmdaConnect.3.html"><strong>pmdaConnect</strong>(3)</a> and the loop which handles the incoming PDUs, <a href="../man3/pmdaMain.3.html"><strong>pmdaMain</strong>(3)</a>, should be the last function called.  This can be seen in <em>$PCP_PMDAS_DIR/simple/simple.c</em>.</p><p>The <strong>simple_init</strong>() routine is common to an agent that can be run as both a Daemon and DSO <strong>PMDA</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HELP TEXT</h2>
        <div class="sectioncontent">
<p>Each <strong>PMDA</strong> must be able to provide <strong>pmcd</strong> with the help text for each metric.  Most <strong>PMDA</strong>s use specially created files with indexes to support efficient retrieval of the help text. Tools are provided with PCP to create the help text files of appropriate format. See <a href="../man1/newhelp.1.html"><strong>newhelp</strong>(1)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTALLATION AND REMOVAL</h2>
        <div class="sectioncontent">
<p>A series of shell procedures are defined in <em>$PCP_SHARE_DIR/lib/pmdaproc.sh</em> which greatly simplify the installation and removal of a <strong>PMDA</strong>. The <em>Install</em> scripts for most <strong>PMDAs</strong> should only need to specify the name of the <strong>PMDA</strong> in <strong>iam</strong>, call <strong>_setup</strong> which check licenses and whether the <strong>PMDA</strong> has been previously installed, specify the communication protocols, and finally call <strong>_install</strong>. The <em>Remove</em> scripts are even simpler as the communication protocols are not required. Further information is contained in the <em>$PCP_SHARE_DIR/lib/pmdaproc.sh</em> file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>Any <strong>PMDA</strong> which uses this library can set <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a> debug control variable <strong>pmDebug</strong> (with -D on the command line) to <strong>DBG_TRACE_LIBPMDA</strong> to enable the display of debugging information which may be useful during development (see <a href="../man1/pmdbg.1.html"><strong>pmdbg</strong>(1)</a>).</p><p>The <em>status</em> field of the <strong>pmdaInterface</strong> structure should be zero after <strong>pmdaDaemon</strong>, <strong>pmdaDSO</strong>, <strong>pmdaGetOpt</strong>, <strong>pmdaConnect</strong> and <strong>pmdaInit</strong> are called.  A value less than zero indicates that initialization has failed.</p><p>Some error messages that are common to most functions in this library are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>PMDA interface version </strong><em>interface</em><strong> not supported</strong></p>
  </dt>
  <dd>
    <p>Most of the functions require that the <em>comm.version</em> field of the <strong>pmdaInterface</strong> structure be set to <strong>PMDA_INTERFACE_2</strong> or later. <strong>PMDA_INTERFACE_2</strong> or <strong>PMDA_INTERFACE_3</strong> implies that the <em>version.two</em> fields are correctly initialized, while <strong>PMDA_INTERFACE_4</strong> implies that the <em>version.four</em> fields are correctly initialized (see <a href="../man3/pmdaDaemon.3.html"><strong>pmdaDaemon</strong>(3)</a> and <a href="../man3/pmdaDSO.3.html"><strong>pmdaDSO</strong>(3)</a>).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEAT</h2>
        <div class="sectioncontent">
<p>Failing to complete any of the data structures or calling any of the library routines out of order may cause unexpected behavior in the <strong>PMDA</strong>.</p><p>Due to changes to the <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a> and <a href="../man3/PMDA.3.html"><strong>PMDA</strong>(3)</a> API in the PCP 2.0 release, as described in the product release notes, <strong>PMDA</strong>s built using PCP 2.0 must specify <strong>PMDA_INTERFACE_2</strong> or later and link with <em>libpcp_pmda.so.2</em> and <em>libpcp.so.2</em>. Pre-existing Daemon PMDAs specifying <strong>PMDA_PROTOCOL_1</strong> will continue to function using the backwards compatible <em>libpcp_pmda.so.1</em> and <em>libpcp.so.1</em> libraries and may be recompiled using the headers installed in <em>/usr/include/pcp1.x/</em> without any modification.  These backwards compatible headers and libraries are contained in the <em>pcp.sw.compat</em> subsystem.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>/usr/include/pcp/pmda.h</em></p>
  </dt>
  <dd>
    <p>Header file for the <strong>PMDA</strong> support library.</p>
  </dd>
  <dt>
    <p><em>/usr/lib/libpcp_pmda.so</em></p>
  </dt>
  <dd>
    <p>Dynamic library containing <strong>PMDA</strong> support library routines.</p>
  </dd>
  <dt>
    <p><em>$PCP_PMDAS_DIR/trivial</em></p>
  </dt>
  <dd>
    <p>The source of the <strong>trivial PMDA</strong>.</p>
  </dd>
  <dt>
    <p><em>$PCP_PMDAS_DIR/simple</em></p>
  </dt>
  <dd>
    <p>The source of the <strong>simple PMDA</strong>.</p>
  </dd>
  <dt>
    <p><em>$PCP_PMDAS_DIR/txmon</em></p>
  </dt>
  <dd>
    <p>The source of the <strong>txmon PMDA</strong>.</p>
  </dd>
  <dt>
    <p><em>$PCP_PMCDCONF_PATH</em></p>
  </dt>
  <dd>
    <p>Configuration file for <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><em>$PCP_VAR_DIR/pmns</em></p>
  </dt>
  <dd>
    <p>Location of namespace descriptions for every <strong>PMDA</strong>.</p>
  </dd>
  <dt>
    <p><em>$PCP_VAR_DIR/pmns/stdpmid</em></p>
  </dt>
  <dd>
    <p>The unique domain identifiers for each <strong>PMDA</strong>.</p>
  </dd>
  <dt>
    <p><em>$PCP_SHARE_DIR/lib/pmdaproc.sh</em></p>
  </dt>
  <dd>
    <p>Shell procedures for installing and removing a <strong>PMDA</strong>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a>. Values for these variables may be obtained programmatically using the <a href="../man3/pmGetConfig.3.html"><strong>pmGetConfig</strong>(3)</a> function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO PMDA&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/dbpmda.1.html"><strong>dbpmda</strong>(1)</a>, <a href="../man1/newhelp.1.html"><strong>newhelp</strong>(1)</a>, <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>, <a href="../man1/pmnsadd.1.html"><strong>pmnsadd</strong>(1)</a>, <a href="../man1/pmnsdel.1.html"><strong>pmnsdel</strong>(1)</a>, <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a>, <a href="../man3/pmdaConnect.3.html"><strong>pmdaConnect</strong>(3)</a>, <a href="../man3/pmdaDaemon.3.html"><strong>pmdaDaemon</strong>(3)</a>, <a href="../man3/pmdaDesc.3.html"><strong>pmdaDesc</strong>(3)</a>, <a href="../man3/pmdaDSO.3.html"><strong>pmdaDSO</strong>(3)</a>, <a href="../man3/pmdaFetch.3.html"><strong>pmdaFetch</strong>(3)</a>, <a href="../man3/pmdaGetOpt.3.html"><strong>pmdaGetOpt</strong>(3)</a>, <a href="../man3/pmdaInit.3.html"><strong>pmdaInit</strong>(3)</a>, <a href="../man3/pmdaInstance.3.html"><strong>pmdaInstance</strong>(3)</a>, <a href="../man3/pmdaMain.3.html"><strong>pmdaMain</strong>(3)</a>, <a href="../man3/pmdaOpenLog.3.html"><strong>pmdaOpenLog</strong>(3)</a>, <a href="../man3/pmdaProfile.3.html"><strong>pmdaProfile</strong>(3)</a>, <a href="../man3/pmdaStore.3.html"><strong>pmdaStore</strong>(3)</a>, <a href="../man3/pmdaText.3.html"><strong>pmdaText</strong>(3)</a>, <a href="../man3/pmLookupDesc.3.html"><strong>pmLookupDesc</strong>(3)</a> and <a href="../man5/pmns.5.html"><strong>pmns</strong>(5)</a>.</p><p>For a complete description of the <em>pcp_pmda</em> library and the PMDA development process, refer to the Insight book <em>Performance Co-Pilot Programmer's Guide</em>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="PMAPI.3.html"><span aria-hidden="true">&larr;</span> PMAPI.3: Introduction to the performance metrics application programming interface</a></li>
   <li class="next"><a href="PMWEBAPI.3.html">PMWEBAPI.3: Introduction to the performance metrics web application programming interface <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
