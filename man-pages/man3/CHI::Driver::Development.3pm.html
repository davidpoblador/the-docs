<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CHI::Driver::Development: Manual for developing new chi drivers</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Manual for developing new chi drivers">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CHI::Driver::Development (3pm) manual">
  <meta name="twitter:description" content="Manual for developing new chi drivers">
  <meta name="twitter:image" content="https://www.carta.tech/images/libchi-perl-CHI::Driver::Development-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/CHI::Driver::Development.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CHI::Driver::Development (3pm) manual" />
  <meta property="og:description" content="Manual for developing new chi drivers" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libchi-perl-CHI::Driver::Development-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CHI::Driver::Development<small> (3pm)</small></h1>
        <p class="lead">Manual for developing new chi drivers</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CHI::Driver::Development.3pm.html">
      <span itemprop="name">CHI::Driver::Development: Manual for developing new chi drivers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libchi-perl/">
      <span itemprop="name">libchi-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CHI::Driver::Development.3pm.html">
      <span itemprop="name">CHI::Driver::Development: Manual for developing new chi drivers</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>version 0.58</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    package CHI::Driver::MyDriver;
    use Moo;
    use strict;
    use warnings;

    extends &apos;CHI::Driver&apos;;

    has ...;

    sub fetch {
        my ( $self, $key ) = @_;

    }

    sub store {
        my ( $self, $key, $data[, $expires_in] ) = @_;

    }

    sub remove {
        my ( $self, $key ) = @_;

    }

    sub clear {
        my ($self) = @_;

    }

    sub get_keys {
        my ($self) = @_;

    }

    sub get_namespaces {
        my ($self) = @_;

    }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This document describes how to implement a new \s-1CHI\s0 driver.</p><p>The easiest way to start is to look at existing drivers, such as CHI::Driver::Memory and CHI::Driver::FastMmap.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NAMING</h2>
        <div class="sectioncontent">
<p>If you are going to publicly release your driver, call it 'CHI::Driver::<em>something</em>' so that users can create it with</p><p>    CHI-&gt;new(driver =&gt; &apos;I&lt;something&gt;&apos;);</p><p>If it's an internal driver, you can call it whatever you like and create it like</p><p>    CHI-&gt;new(driver =&gt; &apos;+My::Internal::CHI::Driver&apos;);</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MOO / MOOSE</h2>
        <div class="sectioncontent">
<p>\s-1CHI\s0 driver classes must be Moo or Moose based to be fully functional, since we use Moose roles to implement various features. For backward compatibility, non-Moo/Moose drivers will still work at a basic level, but you will see an error if using any feature requiring a role.</p><p>All drivers must directly or indirectly extend CHI::Driver.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NAMESPACE</h2>
        <div class="sectioncontent">
<p>All cache handles have an assigned namespace that you can access with \*(C`$self-&gt;namespace\*(C'. You should use the namespace to partition your data store. That is, two cache objects with different namespaces should be able to access the same key without any collision.</p><p>Examples:</p><ul>
<li><p>The Memory driver uses a separate sub-hash inside its main memory hash for each namespace.</p></li><li><p>The File driver uses a separate top-level directory for each namespace.</p></li><li><p>The FastMmap driver uses a separate Cache::FastMmap file for each namespace.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>Required methods</h3>
<p>The following methods have no default implementation, and \s-1MUST\s0 be defined by your subclass: Associate <em></em><strong>$data</strong><em></em> with <em></em><strong>$key</strong><em></em> in the namespace, overwriting any existing entry.  Called by \*(L"set\*(R". <em></em><strong>$data</strong><em></em> will contain any necessary metadata, including expiration options, so you can just store it as a single block. <em></em><strong>$expires_in</strong><em></em> is optionally the number of seconds from now when the entry will expire. This will only be passed if \*(L"expires_on_backend\*(R" in \s-1CHI\s0 is set. If your driver does not support expiration, or if you'd rather just let \s-1CHI\s0 manage expiration, you can ignore this. Returns the data associated with <em></em><strong>$key</strong><em></em> in the namespace. Called by \*(L"get\*(R". The main CHI::Driver superclass will take care of extracting out metadata like expiration options and determining if the value has expired. Remove the data associated with the <em></em><strong>$key</strong><em></em> in the namespace. Remove all data associated with the namespace. (Technically not required, but the default implementation, which iterates over all keys and calls \*(L"remove\*(R" for each, is very inefficient).</p>
<h3>Overridable methods</h3>
<p>The following methods have a default implementation, but \s-1MAY\s0 be overridden by your subclass: Define the \s-1BUILD\s0 method if you want to process any options specific to your driver.  This is a standard Moo/Moose feature. Override this if you want to efficiently process multiple fetches. Return a hash reference from keys to fetched data. If a key is not available, it may be left out of the hash or paired with undef. The default method will iterate over <em></em><strong>$keys</strong><em></em> and call fetch for each. This method is called by get_multi_arrayref and get_multi_hashref. Override this if you want to efficiently process multiple stores. <em></em><strong>$key_data</strong><em></em> is a hash of keys and data that should be stored. The default will iterate over <em></em><strong>$key_data</strong><em></em> and call store for each pair. This method is called by set_multi.</p>
<h3>Optional methods</h3>
<p>The following methods have no default implementation, and \s-1MAY\s0 be defined by your subclass, but are not required for basic cache operations. Return all keys in the namespace. It is acceptable to either include or omit expired keys. Return namespaces associated with the cache. It is acceptable to either include or omit namespaces with no valid keys.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DISCARD POLICIES</h2>
        <div class="sectioncontent">
<p>You can create new discard policies for size aware caches, to choose items to discard when the cache gets full. For example, the Memory driver implements an \s-1LRU\s0 policy.</p><p>To implement a discard policy <em>foo</em>, define a subroutine <em>discard_policy_foo</em>, which takes a driver object and returns a closure that returns one key each time it is called. The closure should maintain state so that each key is only returned once.</p><p>For example, here's the Memory driver's \s-1LRU\s0 implementation. It utilizes a hash containing the last used time for each key.</p><p>   sub discard_policy_lru {        my ($self) = @_;</p><p>       my $last_used_time = $self-&gt;{metadata_for_namespace}-&gt;{last_used_time};        my @keys_in_lru_order =          sort { $last_used_time-&gt;{$a} &lt;=&gt; $last_used_time-&gt;{$b} } $self-&gt;get_keys;        return sub {            shift(@keys_in_lru_order);        };    }</p><p>You can set the default discard policy for your driver by overriding default_discard_policy; otherwise the default is 'arbitrary'.</p><p>   sub default_discard_policy { &apos;lru&apos; }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TESTING</h2>
        <div class="sectioncontent">
<p>\s-1CHI\s0 has a standard set of unit tests that should be used to ensure your driver is fully implementing the \s-1CHI\s0 \s-1API\s0.</p><p>To use \s-1CHI\s0's tests (replacing <em>MyDriver</em> with the name of your driver):</p><ul>
<li><p>Install Test::Class and add it to the build dependencies for your distribution.</p></li><li><p>Add a module called <em>CHI::Driver::MyDriver::t::CHIDriverTests</em> to your distribution containing:     package CHI::Driver::MyDriver::t::CHIDriverTests;     use strict;     use warnings;     use CHI::Test;     use base qw(CHI::t::Driver);</p><p>    sub testing_driver_class { &apos;CHI::Driver::MyDriver&apos; }</p><p>    sub new_cache_options {         my $self = shift;</p><p>        return (             $self-&gt;SUPER::new_cache_options(),</p><p>            # Any necessary CHI-&gt;new parameters for your test driver         );     }</p><p>    1;</p></li><li><p>Add a test script called <em>t/CHI-driver-tests.t</em> to your distribution containing:     #!perl -w     use strict;     use warnings;     use CHI::Driver::MyDriver::t::CHIDriverTests;     CHI::Driver::MyDriver::t::CHIDriverTests-&gt;runtests;</p></li><li><p>You may need to override other methods in <em>CHI::Driver::MyDriver::t::CHIDriverTests</em>, e.g. to skip tests that do not apply to your driver. See CHI::t::Driver::Memory and CHI::t::Driver::File in this distribution for examples.</p></li>
</ul><h3>Test cleanup</h3>
<p>You are responsible for cleaning up your datastore after tests are done. The easiest way to do this is to place your datastore wholly inside a temporary directory, or use a guard to remove it at process end.</p><p>For example, the File, FastMmap, and \s-1DBI\s0 tests place all data inside a tempdir that is automatically cleaned up at process end.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO CHI::Driver::Development&hellip;</h2>
        <div class="sectioncontent">
<p>\s-1CHI\s0</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jonathan Swartz &lt;swartz@pobox.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>This software is copyright (c) 2012 by Jonathan Swartz.</p><p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CHI::Driver::CacheCache.3pm.html"><span aria-hidden="true">&larr;</span> CHI::Driver::CacheCache.3pm: Chi wrapper for cache::cache</a></li>
   <li class="next"><a href="CHI::Driver::FastMmap.3pm.html">CHI::Driver::FastMmap.3pm: Persistent interprocess cache via mmap'ed files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
