<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Term::TtyRec::Plus: Read a ttyrec</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Read a ttyrec">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Term::TtyRec::Plus (3pm) manual">
  <meta name="twitter:description" content="Read a ttyrec">
  <meta name="twitter:image" content="https://www.carta.tech/images/libterm-ttyrec-plus-perl-Term::TtyRec::Plus-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Term::TtyRec::Plus.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Term::TtyRec::Plus (3pm) manual" />
  <meta property="og:description" content="Read a ttyrec" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libterm-ttyrec-plus-perl-Term::TtyRec::Plus-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Term::TtyRec::Plus<small> (3pm)</small></h1>
        <p class="lead">Read a ttyrec</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Term::TtyRec::Plus.3pm.html">
      <span itemprop="name">Term::TtyRec::Plus: Read a ttyrec</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libterm-ttyrec-plus-perl/">
      <span itemprop="name">libterm-ttyrec-plus-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Term::TtyRec::Plus.3pm.html">
      <span itemprop="name">Term::TtyRec::Plus: Read a ttyrec</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>\*(C`Term::TtyRec::Plus\*(C' is a module that lets you read ttyrec files. The related module, Term::TtyRec is designed more for simple interactions. \*(C`Term::TtyRec::Plus\*(C' gives you more information and, using a callback, lets you munge the data block and timestamp. It will do all the subtle work of making sure timing is kept consistent, and of rebuilding each frame header.</p>
<pre>
    use Term::TtyRec::Plus;
    # complete (but simple) ttyrec playback script

    foreach my $file (@ARGV) {
      my $ttyrec = Term::TtyRec::Plus-&gt;new(infile =&gt; $file, time_threshold =&gt; 10);
      while (my $frame_ref = $ttyrec-&gt;next_frame()) {
        select undef, undef, undef, $frame_ref-&gt;{diff};
        print $frame_ref-&gt;{data};
      }
    }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR AND STARTUP</h2>
        <div class="sectioncontent">
<h3>\fInew()\fP</h3>
<p>Creates and returns a new \*(C`Term::TtyRec::Plus\*(C' object.</p><p>    my $ttyrec = Term::TtyRec::Plus-&gt;new();</p><p><em>Parameters</em></p><p>Here are the parameters that \*(C`Term::TtyRec::Plus-&gt;new()\*(C' recognizes.</p>
<dl class='dl-vertical'>
  <dt>
    infile
  </dt>
  <dd>
    <p>The input filename. A value of "-", which is the default, or \*(C`undef\*(C', means \*(C`STDIN\*(C'.</p>
  </dd>
  <dt>
    filehandle
  </dt>
  <dd>
    <p>The input filehandle. By default this is \*(C`undef\*(C'; if you have already opened the ttyrec then you can pass its filehandle to the constructor. If both filehandle and infile are defined, filehandle is used.</p>
  </dd>
  <dt>
    bzip2
  </dt>
  <dd>
    <p>Perform bzip2 decompression. By default this is \*(C`undef\*(C', which signals that bzip2 decompression should occur if and only if the filename is available and it ends in \*(L".bz2\*(R". Otherwise, you can force or forbid decompression by setting bzip2 to a true or false value, respectively. After the call to new, this field will be set to either 1 if decompression is enabled or 0 if it is not.</p>
  </dd>
  <dt>
    time_threshold
  </dt>
  <dd>
    <p>The maximum difference between two frames, in seconds. If \*(C`undef\*(C', which is the default, there is no enforced maximum. The second most common value would be 10, which some ttyrec utilities (such as timettyrec) use.</p>
  </dd>
  <dt>
    frame_filter
  </dt>
  <dd>
    <p>A callback, run for each frame before returning the frame to the user of \*(C`Term::TtyRec::Plus\*(C'. This callback receives three arguments: the frame text, the timestamp, and the timestamp of the previous frame. All three arguments are passed as scalar references. The previous frame's timestamp is \*(C`undef\*(C' for the first frame. The return value is not currently looked at. If you modify the timestamp, the module will make sure that change is noted and respected in further frame timestamps. Modifications to the previous frame's timestamp are currently ignored.     sub halve_frame_time_and_stumblify {         my ($data_ref, $time_ref, $prev_ref) = @_;         $$time_ref = $$prev_ref + ($$time_ref - $$prev_ref) / 2             if defined $$prev_ref;         $$data_ref =~ s/Eidolos/Stumbly/g;     }</p>
  </dd>

</dl>
<p><em>State</em></p><p>In addition to passing arguments, you can modify \*(C`Term::TtyRec::Plus\*(C''s initial state, if you want to. This could be useful if you are chaining multiple ttyrecs together; you could pass a different initial frame. Support for such chaining might be added in a future version.</p>
<dl class='dl-vertical'>
  <dt>
    frame
  </dt>
  <dd>
    <p>The initial frame number. Default 0.</p>
  </dd>
  <dt>
    prev_timestamp
  </dt>
  <dd>
    <p>The previous frame's timestamp. Default \*(C`undef\*(C'.</p>
  </dd>
  <dt>
    accum_diff
  </dt>
  <dd>
    <p>The accumulated difference of all frames seen so far; see the section on \*(C`diffed_timestamp\*(C' in \*(C`next_frame()\*(C''s return value. Default 0.</p>
  </dd>
  <dt>
    relative_time
  </dt>
  <dd>
    <p>The time passed since the first frame. Default 0.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>\fInext_frame()\fP</h3>
<p>\*(C`next_frame()\*(C' reads and processes the next frame in the ttyrec. It accepts no arguments. On \s-1EOF\s0, it will return \*(C`undef\*(C'. On malformed ttyrec input, it will die. If it cannot reconstruct the header of a frame (which might happen if the callback sets the timestamp to -1, for example), it will die. Otherwise, a hash reference is returned with the following fields set.</p>
<dl class='dl-vertical'>
  <dt>
    data
  </dt>
  <dd>
    <p>The frame data, filtered through the callback. The original data block is not made available.</p>
  </dd>
  <dt>
    orig_timestamp
  </dt>
  <dd>
    <p>The frame timestamp, straight out of the file.</p>
  </dd>
  <dt>
    diffed_timestamp
  </dt>
  <dd>
    <p>The frame timestamp, with the accumulated difference of all of the previous frames applied to it. This is so consistent results are given. For example, if your callback adds three seconds to frame 5's timestamp, then frame 6's diffed timestamp will take into account those three seconds, so frame 6 happens three seconds later as well. So the net effect is frame 5 is extended by three seconds, and no other frames' relatives times are affected.</p>
  </dd>
  <dt>
    timestamp
  </dt>
  <dd>
    <p>The diffed timestamp, filtered through the callback.</p>
  </dd>
  <dt>
    prev_timestamp
  </dt>
  <dd>
    <p>The previous frame's timestamp (after diffing and filtering; the originals are not made available).</p>
  </dd>
  <dt>
    diff
  </dt>
  <dd>
    <p>The difference between the current frame's timestamp and the previous frame's timestamp. Yes, it is equivalent to \*(C`timestamp - prev_timestamp\*(C', but it is provided for convenience. On the first frame it will be 0 (not \*(C`undef\*(C').</p>
  </dd>
  <dt>
    orig_header
  </dt>
  <dd>
    <p>The 12-byte frame header, straight from the file.</p>
  </dd>
  <dt>
    header
  </dt>
  <dd>
    <p>The 12-byte frame header, reconstructed from \*(C`data\*(C' and \*(C`timestamp\*(C' (so, after filtering, etc.).</p>
  </dd>
  <dt>
    frame
  </dt>
  <dd>
    <p>The frame number, using 1-based indexing.</p>
  </dd>
  <dt>
    relative_time
  </dt>
  <dd>
    <p>The time between the first frame's timestamp and the current frame's timestamp.</p>
  </dd>

</dl>

<h3>\fIgrep()\fP</h3>
<p>Returns the next frame that meets the specified criteria. \*(C`grep()\*(C' accepts arguments that are subroutines, regex, or strings; anything else is a fatal error. If you pass multiple arguments to \*(C`grep()\*(C', each one must be true. The subroutines receive the frame reference that is returned by \*(C`next_frame()\*(C'. You can modify the frame, but do so cautiously.</p><p>  my $next_jump_frame_ref = $t-&gt;grep("Where do you want to jump?", sub { $_[0]{data} !~ /Message History/});</p>
<h3>\fIrewind()\fP</h3>
<p>Rewinds the ttyrec to the first frame and resets state variables to their initial values. Note that if \*(C`filehandle\*(C' is not seekable (such as \s-1STDIN\s0 on some systems, or if bzip2 decompression is used), \*(C`rewind()\*(C' will die.</p>
<h3>\fIinfile()\fP</h3>
<p>Returns the infile passed to the constructor. If a filehandle was passed, this will be \*(C`undef\*(C'.</p>
<h3>\fIfilehandle()\fP</h3>
<p>Returns the filehandle passed to the constructor, or if \*(C`infile\*(C' was used, a handle to \*(C`infile\*(C'.</p>
<h3>\fIbzip2()\fP</h3>
<p>Returns 1 if bzip2 decompression has taken place, 0 if it has not.</p>
<h3>\fItime_threshold()\fP</h3>
<p>Returns the time threshold passed to the constructor. By default it is \*(C`undef\*(C'.</p>
<h3>\fIframe_filter()\fP</h3>
<p>Returns the frame filter callback passed to the constructor. By default it is \*(C`sub { @_ }\*(C'.</p>
<h3>\fIframe()\fP</h3>
<p>Returns the frame number of the most recently returned frame.</p>
<h3>\fIprev_timestamp()\fP</h3>
<p>Returns the timestamp of the most recently returned frame.</p>
<h3>\fIrelative_time()\fP</h3>
<p>Returns the time so far since the first frame.</p>
<h3>\fIaccum_diff()\fP</h3>
<p>Returns the total time difference between timestamps and filtered timestamps. \*(C`accum_diff\*(C' is added to each frame's timestamp before they are passed to the \*(C`frame_filter\*(C' callback.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Shawn M Moore, \*(C`sartak@gmail.com\*(C'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<ul>
<li><p>Ttyrecs are frame-based. If you are trying to modify a string that is broken across multiple frames, it will not work. Say you have a ttyrec that prints \*(L"foo\*(R" in frame one and \*(L"bar\*(R" in frame two, both with the same timestamp. In a ttyrec player, it might look like these are one frame (with data \*(L"foobar\*(R"), but it's not. There is no easy, complete way to add arbitrary substitutions; you would have to write (or reuse) a terminal emulator.</p></li><li><p>If you modify the data block, weird things could happen. This is especially true of escape-code-littered ttyrecs (such as those of NetHack). For best results, pretend the data block is an executable file; changes are \s-1OK\s0 as long as you do not change the length of the file. It really depends on the ttyrec though.</p></li><li><p>If you modify the timestamp of a frame so that it is not in sequence with other frames, the behavior is undefined (it is up to the client program). \*(C`Term::TtyRec::Plus\*(C' will not reorder the frames for you.</p></li><li><p>bzip2 support is transparent, mostly. Unfortunately IO::Uncompress::Bunzip2 is rather slow. I took a lengthy (~4 hours), bzipped ttyrec and ran a simple script on it, depending on the built-in bzip2 decompression. This took nearly four minutes. Using bunzip2 then the same script took about four seconds. So when you can, do explicit bzip2 decompression. Or better yet, help out the guys working on IO::Uncompress::Bunzip2. :)</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT & LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright 2006-2009 Shawn M Moore, all rights reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Term::Title.3pm.html"><span aria-hidden="true">&larr;</span> Term::Title.3pm: Portable api to set the terminal titlebar</a></li>
   <li class="next"><a href="Term::VT102.3pm.html">Term::VT102.3pm: A class to emulate a dec vt102 terminal <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
