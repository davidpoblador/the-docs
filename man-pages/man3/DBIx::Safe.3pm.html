<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DBIx::Safe: Safer access to your database through a dbi database handle</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Safer access to your database through a dbi database handle">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="DBIx::Safe (3pm) manual">
  <meta name="twitter:description" content="Safer access to your database through a dbi database handle">
  <meta name="twitter:image" content="https://www.carta.tech/images/libdbix-safe-perl-DBIx::Safe-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/DBIx::Safe.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DBIx::Safe (3pm) manual" />
  <meta property="og:description" content="Safer access to your database through a dbi database handle" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libdbix-safe-perl-DBIx::Safe-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">DBIx::Safe<small> (3pm)</small></h1>
        <p class="lead">Safer access to your database through a dbi database handle</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Safe.3pm.html">
      <span itemprop="name">DBIx::Safe: Safer access to your database through a dbi database handle</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libdbix-safe-perl/">
      <span itemprop="name">libdbix-safe-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::Safe.3pm.html">
      <span itemprop="name">DBIx::Safe: Safer access to your database through a dbi database handle</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This documents version 1.2.5 of the DBIx::Safe module</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use DBIx::Safe;

  $dbh = DBI-&gt;connect($dbn, $user, $pass, {AutoCommit =&gt; 0});

  my $safedbh = DBIx::Safe-&gt;new({ dbh =&gt; $dbh });

  $safedbh-&gt;allow_command(&apos;SELECT INSERT UPDATE&apos;);

  $safedbh-&gt;allow_regex(qr{LOCK TABLE &#92;w+ IN EXCLUSIVE MODE});

  $safedbh-&gt;deny_regex(qr{LOCK TABLE pg_});

  $safedbh-&gt;allow_attribute(&apos;PrintError RaiseError&apos;);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The purpose of this module is to give controlled, limited access to an application, rather than simply passing it a raw database handle through \s-1DBI\s0. DBIx::Safe acts as a wrapper to the database, by only allowing through the commands you tell it to. It filters all things related to the database handle - methods and attributes.</p><p>The typical usage is for your application to create a database handle via a normal \s-1DBI\s0 call to <em>new()</em>, then pass that to DBIx::Safe-&gt;<em>new()</em>, which will return you a DBIx::Safe object. After specifying exactly what is and what is not allowed, you can pass the object to the untrusted application. The object will act very similar to a \s-1DBI\s0 database handle, and in most cases can be used interchangeably.</p><p>By default, nothing is allowed to run at all. There are many things you can control. You can specify which \s-1SQL\s0 commands are allowed, by indicating the first word in the \s-1SQL\s0 statement (e.g. '\s-1SELECT\s0'). You can specify which database methods are allowed to run (e.g. 'ping'). You can specify a regular expression that allows matching \s-1SQL\s0 statements to run (e.g. 'qr{\s-1SET\s0 \s-1TIMEZONE\s0}'). You can specify a regular expression that is \s-1NOT\s0 allowed to run (e.g. qr(\s-1UPDATE\s0 xxx}). Finally, you can indicate which database attributes are allowed to be read and changed (e.g. 'PrintError'). For all of the above, there are matching methods to remove them as well.</p><h3>Deciding what statements to allow</h3>
<p>Anytime a statement is sent to the server via the DBIx::Safe database handle, it is first examined to see if it is allowed to run or not. There are three major checks that occur when a statement is sent. First, the initial word of the statement, known as the command, is extracted. Next, the entire statement is checked against the list of denied regular expressions. Next, the command is checked against the list of allowed commands. If there is no match, the statement is checked against the list of allowed regular expressions.</p><p>Each \s-1DBD\s0 may implement additional or slightly different checks. For example, if using Postgres, no semi-colons are allowed unless the command is one of \s-1SELECT\s0, \s-1INSERT\s0, \s-1UPDATE\s0, or \s-1DELETE\s0, to prevent multiple commands from running. (The four listed commands can be checked in another way for multiple commands, so they are allowed to have semicolons).</p>
<h3>Deciding what attributes to allow</h3>
<p>Database handle attributes are controlled by a single list of allowed keys. If the key is allowed, the underlying database handle value is returned or changed (or both). Note that the attribute \*(L"AutoCommit\*(R" is never allowed to be changed.</p>
<h3>Methods</h3>
<p><em></em><em>new()</em><em></em></p><p>Creates a new DBIx::Safe object. Requires a mandatory \*(L"dbh\*(R" argument containing an active database handle. Optional arguments are \*(L"allow_command\*(R", \*(L"allow_regex\*(R", \*(L"deny_regex\*(R", and \*(L"allow_attribute\*(R".</p><p><em></em><em>allow_command()</em><em></em></p><p>Specifies which commands are allowed to be used. Can be a whitespace-separated list of words in a string, or an arrayref of such strings. Returns the current list of allowed commands. Duplicate commands will throw an error.</p><p><em></em><em>unallow_command()</em><em></em></p><p>Same as allow_command, but will remove words from the list.</p><p><em></em><em>allow_regex()</em><em></em></p><p>Specifies regular expressions which are allowed to run. Argument must be a regular expression, or an arrayref of regular expressions. Returns the current list.</p><p><em></em><em>unallow_regex()</em><em></em></p><p>Same as allow_regex, but will remove regexes from the list.</p><p><em></em><em>deny_regex()</em><em></em></p><p>Specifies regular expressions which are \s-1NOT\s0 allowed to run. Arguments and return the same as <em>allow_regex()</em>.</p><p><em>undeny </em><em>regex()</em><em></em></p><p>Same as deny_regex, but will remove regexes from the list.</p><p><em></em><em>allow_attribute()</em><em></em></p><p>Specifies database handle attributes that are allowed to be changed. By default, nothing can be read. Argument is a whitespace-separated list of words in a string, or an arrayref of such strings. Returns the current list.</p><p><em></em><em>unallow_attribute()</em><em></em></p><p>Same as allow_attributes, but removes attributes from the list.</p>
<h3>Testing</h3>
<p>DBIx::Safe has a very comprehensive test suite, so please use it! The only thing you should need is a database connection, by setting the environment variables \s-1DBI_DSN\s0 and \s-1DBI_USER\s0 (and \s-1DBI_PASS\s0 if needed).</p><p>You can optionally run the module through Perl::Critic by setting the \s-1TEST_AUTHOR\s0 environment variable. You will need to have the modules Perl::Critic and Test::Perl::Critic installed.</p><p>Please report any test failures to the author or bucardo-general@bucardo.org.</p>
<h3>Supported Databases</h3>
<p>Due to the difficulty of ensuring safe access to the database, each type of database must be specifically written into DBIx::Safe. Current databases supported are: Postgres (DBD::Pg).</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WEBSITE</h2>
        <div class="sectioncontent">
<p>The latest version and other information about DBIx::Safe can be found at: http://bucardo.org/dbix_safe/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEVELOPMENT</h2>
        <div class="sectioncontent">
<p>The latest development version can be checked out by using git:</p><p>  git clone http://bucardo.org/dbixsafe.git/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Bugs should be reported to the author or bucardo-general@bucardo.org.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Greg Sabino Mullane &lt;greg@endpoint.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE AND COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2006-2007 Greg Sabino Mullane &lt;greg@endpoint.com&gt;.</p><p>This software is free to use: see the \s-1LICENSE\s0 file for details.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="DBIx::Recordset::FileSeq.3pm.html"><span aria-hidden="true">&larr;</span> DBIx::Recordset::FileSeq.3pm: Sequence generator in filesystem</a></li>
   <li class="next"><a href="DBIx::Sequence.3pm.html">DBIx::Sequence.3pm: A simple sql92 id generator <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
