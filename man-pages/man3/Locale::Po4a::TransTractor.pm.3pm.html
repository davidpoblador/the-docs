<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Locale::Po4a::TransTractor.pm: Generic trans(lator ex)tractor.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Generic trans(lator ex)tractor.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Locale::Po4a::TransTractor.pm (3pm) manual">
  <meta name="twitter:description" content="Generic trans(lator ex)tractor.">
  <meta name="twitter:image" content="https://www.carta.tech/images/po4a-Locale::Po4a::TransTractor.pm-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Locale::Po4a::TransTractor.pm.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Locale::Po4a::TransTractor.pm (3pm) manual" />
  <meta property="og:description" content="Generic trans(lator ex)tractor." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/po4a-Locale::Po4a::TransTractor.pm-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Locale::Po4a::TransTractor.pm<small> (3pm)</small></h1>
        <p class="lead">Generic trans(lator ex)tractor.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Locale::Po4a::TransTractor.pm.3pm.html">
      <span itemprop="name">Locale::Po4a::TransTractor.pm: Generic trans(lator ex)tractor.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/po4a/">
      <span itemprop="name">po4a</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Locale::Po4a::TransTractor.pm.3pm.html">
      <span itemprop="name">Locale::Po4a::TransTractor.pm: Generic trans(lator ex)tractor.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The po4a (\s-1PO\s0 for anything) project goal is to ease translations (and more interestingly, the maintenance of translations) using gettext tools on areas where they were not expected like documentation.</p><p>This class is the ancestor of every po4a parser used to parse a document, to search translatable strings, to extract them to a \s-1PO\s0 file and to replace them by their translation in the output document.</p><p>More formally, it takes the following arguments as input:</p><ul>
<li><p>a document to translate;</p></li><li><p>a \s-1PO\s0 file containing the translations to use.</p></li>
</ul><p>As output, it produces:</p><ul>
<li><p>another \s-1PO\s0 file, resulting of the extraction of translatable strings from the input document;</p></li><li><p>a translated document, with the same structure than the one in input, but with all translatable strings replaced with the translations found in the \s-1PO\s0 file provided in input.</p></li>
</ul><p>Here is a graphical representation of this:</p>
<pre>
   Input document --&#92;                             /---&gt; Output document
                     &#92;                           /       (translated)
                      +-&gt; parse() function -----+
                     /                           &#92;
   Input PO --------/                             &#92;---&gt; Output PO
                                                         (extracted)
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS YOUR PARSER SHOULD OVERRIDE</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <em>parse()</em>
  </dt>
  <dd>
    <p>This is where all the work takes place: the parsing of input documents, the generation of output, and the extraction of the translatable strings. This is pretty simple using the provided functions presented in the section <strong>\s-1INTERNAL\s0 \s-1FUNCTIONS\s0</strong> below. See also the <strong>\s-1SYNOPSIS\s0</strong>, which presents an example. This function is called by the <em>process()</em> function below, but if you choose to use the <em>new()</em> function, and to add content manually to your document, you will have to call this function yourself.</p>
  </dd>
  <dt>
    <em>docheader()</em>
  </dt>
  <dd>
    <p>This function returns the header we should add to the produced document, quoted properly to be a comment in the target language.  See the section <strong>Educating developers about translations</strong>, from <em>po4a</em>\|(7), for what it is good for.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>The following example parses a list of paragraphs beginning with \*(L"&lt;p&gt;\*(R". For the sake of simplicity, we assume that the document is well formatted, i.e. that '&lt;p&gt;' tags are the only tags present, and that this tag is at the very beginning of each paragraph.</p><p> sub parse {    my $self = shift;</p><p>   PARAGRAPH: while (1) {        my ($paragraph,$pararef)=("","");        my $first=1;        my ($line,$lref)=$self-&gt;shiftline();        while (defined($line)) {            if ($line =~ m/&lt;p&gt;/ && !$first--; ) {                # Not the first time we see &lt;p&gt;.                # Reput the current line in input,                #  and put the built paragraph to output                $self-&gt;unshiftline($line,$lref);</p><p>               # Now that the document is formed, translate it:                #   - Remove the leading tag                $paragraph =~ s/^&lt;p&gt;//s;</p><p>               #   - push to output the leading tag (untranslated) and the                #     rest of the paragraph (translated)                $self-&gt;pushline(  "&lt;p&gt;"                                . $document-&gt;translate($paragraph,$pararef)                                );</p><p>               next PARAGRAPH;            } else {                # Append to the paragraph                $paragraph .= $line;                $pararef = $lref unless(length($pararef));            }</p><p>           # Reinit the loop            ($line,$lref)=$self-&gt;shiftline();        }        # Did not get a defined line? End of input file.        return;    }  }</p><p>Once you've implemented the parse function, you can use your document class, using the public interface presented in the next section.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PUBLIC INTERFACE for scripts using your parser</h2>
        <div class="sectioncontent">
<h3>Constructor</h3>

<dl class='dl-vertical'>
  <dt>
    process(%)
  </dt>
  <dd>
    <p>This function can do all you need to do with a po4a document in one invocation. Its arguments must be packed as a hash. \s-1ACTIONS:\s0</p>
<dl class='dl-vertical'>
  <dt>
    a.
  </dt>
  <dd>
    <p>Reads all the \s-1PO\s0 files specified in po_in_name</p>
  </dd>
  <dt>
    b.
  </dt>
  <dd>
    <p>Reads all original documents specified in file_in_name</p>
  </dd>
  <dt>
    c.
  </dt>
  <dd>
    <p>Parses the document</p>
  </dd>
  <dt>
    d.
  </dt>
  <dd>
    <p>Reads and applies all the addenda specified</p>
  </dd>
  <dt>
    e.
  </dt>
  <dd>
    <p>Writes the translated document to file_out_name (if given)</p>
  </dd>
  <dt>
    f.
  </dt>
  <dd>
    <p>Writes the extracted \s-1PO\s0 file to po_out_name (if given)</p>
  </dd>

</dl>
<p>\s-1ARGUMENTS\s0, beside the ones accepted by <em>new()</em> (with expected type):</p>
<dl class='dl-vertical'>
  <dt>
    file_in_name (@)
  </dt>
  <dd>
    <p>List of filenames where we should read the input document.</p>
  </dd>
  <dt>
    file_in_charset ($)
  </dt>
  <dd>
    <p>Charset used in the input document (if it isn't specified, it will try to detect it from the input document).</p>
  </dd>
  <dt>
    file_out_name ($)
  </dt>
  <dd>
    <p>Filename where we should write the output document.</p>
  </dd>
  <dt>
    file_out_charset ($)
  </dt>
  <dd>
    <p>Charset used in the output document (if it isn't specified, it will use the \s-1PO\s0 file charset).</p>
  </dd>
  <dt>
    po_in_name (@)
  </dt>
  <dd>
    <p>List of filenames where we should read the input \s-1PO\s0 files from, containing the translation which will be used to translate the document.</p>
  </dd>
  <dt>
    po_out_name ($)
  </dt>
  <dd>
    <p>Filename where we should write the output \s-1PO\s0 file, containing the strings extracted from the input document.</p>
  </dd>
  <dt>
    addendum (@)
  </dt>
  <dd>
    <p>List of filenames where we should read the addenda from.</p>
  </dd>
  <dt>
    addendum_charset ($)
  </dt>
  <dd>
    <p>Charset for the addenda.</p>
  </dd>

</dl>

  </dd>
  <dt>
    new(%)
  </dt>
  <dd>
    <p>Create a new po4a document. Accepted options (but be in a hash):</p>
<dl class='dl-vertical'>
  <dt>
    verbose ($)
  </dt>
  <dd>
    <p>Sets the verbosity.</p>
  </dd>
  <dt>
    debug ($)
  </dt>
  <dd>
    <p>Sets the debugging.</p>
  </dd>

</dl>

  </dd>

</dl>

<h3>Manipulating document files</h3>

<dl class='dl-vertical'>
  <dt>
    read($)
  </dt>
  <dd>
    <p>Add another input document at the end of the existing one. The argument is the filename to read. Please note that it does not parse anything. You should use the <em>parse()</em> function when you're done with packing input files into the document.</p>
  </dd>
  <dt>
    write($)
  </dt>
  <dd>
    <p>Write the translated document to the given filename.</p>
  </dd>

</dl>

<h3>Manipulating \s-1PO\s0 files</h3>

<dl class='dl-vertical'>
  <dt>
    readpo($)
  </dt>
  <dd>
    <p>Add the content of a file (which name is passed as argument) to the existing input \s-1PO\s0. The old content is not discarded.</p>
  </dd>
  <dt>
    writepo($)
  </dt>
  <dd>
    <p>Write the extracted \s-1PO\s0 file to the given filename.</p>
  </dd>
  <dt>
    <em>stats()</em>
  </dt>
  <dd>
    <p>Returns some statistics about the translation done so far. Please note that it's not the same statistics than the one printed by msgfmt --statistic. Here, it's stats about recent usage of the \s-1PO\s0 file, while msgfmt reports the status of the file. It is a wrapper to the Locale::Po4a::Po::stats_get function applied to the input \s-1PO\s0 file. Example of use:     [normal use of the po4a document...]</p><p>    ($percent,$hit,$queries) = $document-&gt;stats();     print "We found translations for $percent&#92;%  ($hit from $queries) of strings.&#92;n";</p>
  </dd>

</dl>

<h3>Manipulating addenda</h3>

<dl class='dl-vertical'>
  <dt>
    addendum($)
  </dt>
  <dd>
    <p>Please refer to <em>po4a</em>\|(7) for more information on what addenda are, and how translators should write them. To apply an addendum to the translated document, simply pass its filename to this function and you are done ;) This function returns a non-null integer on error.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTERNAL FUNCTIONS used to write derivated parsers</h2>
        <div class="sectioncontent">
<h3>Getting input, providing output</h3>
<p>Four functions are provided to get input and return output. They are very similar to shift/unshift and push/pop. The first pair is about input, while the second is about output. Mnemonic: in input, you are interested in the first line, what shift gives, and in output you want to add your result at the end, like push does.</p>
<dl class='dl-vertical'>
  <dt>
    <em>shiftline()</em>
  </dt>
  <dd>
    <p>This function returns the next line of the doc_in to be parsed and its reference (packed as an array).</p>
  </dd>
  <dt>
    unshiftline($$)
  </dt>
  <dd>
    <p>Unshifts a line of the input document and its reference.</p>
  </dd>
  <dt>
    pushline($)
  </dt>
  <dd>
    <p>Push a new line to the doc_out.</p>
  </dd>
  <dt>
    <em>popline()</em>
  </dt>
  <dd>
    <p>Pop the last pushed line from the doc_out.</p>
  </dd>

</dl>

<h3>Marking strings as translatable</h3>
<p>One function is provided to handle the text which should be translated.</p>
<dl class='dl-vertical'>
  <dt>
    translate($$$)
  </dt>
  <dd>
    <p>Mandatory arguments:</p><ul>
<li><p>A string to translate</p></li><li><p>The reference of this string (i.e. position in inputfile)</p></li><li><p>The type of this string (i.e. the textual description of its structural role; used in <em>Locale::Po4a::Po::gettextization()</em>; see also <em>po4a</em>\|(7), section <strong>Gettextization: how does it work?</strong>)</p></li>
</ul><p>This function can also take some extra arguments. They must be organized as a hash. For example:   $self-&gt;translate("string","ref","type",                    &apos;wrap&apos; =&gt; 1);</p>
<dl class='dl-vertical'>
  <dt>
    <strong>wrap</strong>
  </dt>
  <dd>
    <p>boolean indicating whether we can consider that whitespaces in string are not important. If yes, the function canonizes the string before looking for a translation or extracting it, and wraps the translation.</p>
  </dd>
  <dt>
    <strong>wrapcol</strong>
  </dt>
  <dd>
    <p>the column at which we should wrap (default: 76).</p>
  </dd>
  <dt>
    <strong>comment</strong>
  </dt>
  <dd>
    <p>an extra comment to add to the entry.</p>
  </dd>

</dl>
<p>Actions:</p><ul>
<li><p>Pushes the string, reference and type to po_out.</p></li><li><p>Returns the translation of the string (as found in po_in) so that the parser can build the doc_out.</p></li><li><p>Handles the charsets to recode the strings before sending them to po_out and before returning the translations.</p></li>
</ul>
  </dd>

</dl>

<h3>Misc functions</h3>

<dl class='dl-vertical'>
  <dt>
    <em>verbose()</em>
  </dt>
  <dd>
    <p>Returns if the verbose option was passed during the creation of the TransTractor.</p>
  </dd>
  <dt>
    <em>debug()</em>
  </dt>
  <dd>
    <p>Returns if the debug option was passed during the creation of the TransTractor.</p>
  </dd>
  <dt>
    detected_charset($)
  </dt>
  <dd>
    <p>This tells TransTractor that a new charset (the first argument) has been detected from the input document. It can usually be read from the document header. Only the first charset will remain, coming either from the <em>process()</em> arguments or detected from the document.</p>
  </dd>
  <dt>
    <em>get_out_charset()</em>
  </dt>
  <dd>
    <p>This function will return the charset that should be used in the output document (usually useful to substitute the input document's detected charset where it has been found). It will use the output charset specified in the command line. If it wasn't specified, it will use the input \s-1PO\s0's charset, and if the input \s-1PO\s0 has the default \*(L"\s-1CHARSET\s0\*(R", it will return the input document's charset, so that no encoding is performed.</p>
  </dd>
  <dt>
    recode_skipped_text($)
  </dt>
  <dd>
    <p>This function returns the recoded text passed as argument, from the input document's charset to the output document's one. This isn't needed when translating a string (<em>translate()</em> recodes everything itself), but it is when you skip a string from the input document and you want the output document to be consistent with the global encoding.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUTURE DIRECTIONS</h2>
        <div class="sectioncontent">
<p>One shortcoming of the current TransTractor is that it can't handle translated document containing all languages, like debconf templates, or .desktop files.</p><p>To address this problem, the only interface changes needed are:</p><ul>
<li><p>take a hash as po_in_name (a list per language)</p></li><li><p>add an argument to translate to indicate the target language</p></li><li><p>make a pushline_all function, which would make pushline of its content for all language, using a map-like syntax:     $self-&gt;pushline_all({ "Description[".$langcode."]=".                           $self-&gt;translate($line,$ref,$langcode)                         });</p></li>
</ul><p>Will see if it's enough ;)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p> Denis Barbier &lt;barbier@linuxfr.org&gt;  Martin Quinson (mquinson#debian.org)  Jordi Vilalta &lt;jvprat@gmail.com&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Locale::Po4a::TransTractor.3pm.html"><span aria-hidden="true">&larr;</span> Locale::Po4a::TransTractor.3pm: Generic trans(lator ex)tractor.</a></li>
   <li class="next"><a href="Locale::Po4a::Wml.3pm.html">Locale::Po4a::Wml.3pm: Convert wml (web markup language) documents from/to po files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
