<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libcurl-multi: How to use the multi interface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="How to use the multi interface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libcurl-multi (3) manual">
  <meta name="twitter:description" content="How to use the multi interface">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcurl4-doc-libcurl-multi-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libcurl-multi.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libcurl-multi (3) manual" />
  <meta property="og:description" content="How to use the multi interface" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcurl4-doc-libcurl-multi-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libcurl-multi<small> (3)</small></h1>
        <p class="lead">How to use the multi interface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libcurl-multi.3.html">
      <span itemprop="name">libcurl-multi: How to use the multi interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcurl4-doc/">
      <span itemprop="name">libcurl4-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libcurl-multi.3.html">
      <span itemprop="name">libcurl-multi: How to use the multi interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This is an overview on how to use the libcurl multi interface in your C programs. There are specific man pages for each function mentioned in here. There's also the <a href="../man3/libcurl-tutorial.3.html"><strong>libcurl-tutorial</strong>(3)</a></em> man page for a complete tutorial to programming with libcurl and the <a href="../man3/libcurl-easy.3.html"><strong>libcurl-easy</strong>(3)</a></em> man page for an overview of the libcurl easy interface.</p><p>All functions in the multi interface are prefixed with curl_multi.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OBJECTIVES</h2>
        <div class="sectioncontent">
<p>The multi interface offers several abilities that the easy interface doesn't. They are mainly:</p><p>1. Enable a "pull" interface. The application that uses libcurl decides where and when to ask libcurl to get/send data.</p><p>2. Enable multiple simultaneous transfers in the same thread without making it complicated for the application.</p><p>3. Enable the application to wait for action on its own file descriptors and curl's file descriptors simultaneous easily.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ONE MULTI HANDLE MANY EASY HANDLES</h2>
        <div class="sectioncontent">
<p>To use the multi interface, you must first create a 'multi handle' with <a href="../man3/curl_multi_init.3.html"><strong>curl_multi_init</strong>(3)</a></em>. This handle is then used as input to all further curl_multi_* functions.</p><p>Each single transfer is built up with an easy handle. You must create them, and setup the appropriate options for each easy handle, as outlined in the <a href="../man3/libcurl.3.html"><strong>libcurl</strong>(3)</a></em> man page, using <a href="../man3/curl_easy_setopt.3.html"><strong>curl_easy_setopt</strong>(3)</a></em>.</p><p>When the easy handle is setup for a transfer, then instead of using <a href="../man3/curl_easy_perform.3.html"><strong>curl_easy_perform</strong>(3)</a></em> (as when using the easy interface for transfers), you should instead add the easy handle to the multi handle using <a href="../man3/curl_multi_add_handle.3.html"><strong>curl_multi_add_handle</strong>(3)</a></em>. The multi handle is sometimes referred to as a \'multi stack\' because of the fact that it may hold a large amount of easy handles.</p><p>Should you change your mind, the easy handle is again removed from the multi stack using <a href="../man3/curl_multi_remove_handle.3.html"><strong>curl_multi_remove_handle</strong>(3)</a></em>. Once removed from the multi handle, you can again use other easy interface functions like <a href="../man3/curl_easy_perform.3.html"><strong>curl_easy_perform</strong>(3)</a></em> on the handle or whatever you think is necessary.</p><p>Adding the easy handle to the multi handle does not start the transfer. Remember that one of the main ideas with this interface is to let your application drive. You drive the transfers by invoking <a href="../man3/curl_multi_perform.3.html"><strong>curl_multi_perform</strong>(3)</a></em>. libcurl will then transfer data if there is anything available to transfer. It'll use the callbacks and everything else you have setup in the individual easy handles. It'll transfer data on all current transfers in the multi stack that are ready to transfer anything. It may be all, it may be none.</p><p>Your application can acquire knowledge from libcurl when it would like to get invoked to transfer data, so that you don't have to busy-loop and call that <a href="../man3/curl_multi_perform.3.html"><strong>curl_multi_perform</strong>(3)</a></em> like crazy. <a href="../man3/curl_multi_fdset.3.html"><strong>curl_multi_fdset</strong>(3)</a></em> offers an interface using which you can extract fd_sets from libcurl to use in select() or poll() calls in order to get to know when the transfers in the multi stack might need attention. This also makes it very easy for your program to wait for input on your own private file descriptors at the same time or perhaps timeout every now and then, should you want that.</p><p><a href="../man3/curl_multi_perform.3.html"><strong>curl_multi_perform</strong>(3)</a></em> stores the number of still running transfers in one of its input arguments, and by reading that you can figure out when all the transfers in the multi handles are done. 'done' does not mean successful. One or more of the transfers may have failed. Tracking when this number changes, you know when one or more transfers are done.</p><p>To get information about completed transfers, to figure out success or not and similar, <a href="../man3/curl_multi_info_read.3.html"><strong>curl_multi_info_read</strong>(3)</a></em> should be called. It can return a message about a current or previous transfer. Repeated invokes of the function get more messages until the message queue is empty. The information you receive there includes an easy handle pointer which you may use to identify which easy handle the information regards.</p><p>When a single transfer is completed, the easy handle is still left added to the multi stack. You need to first remove the easy handle with <a href="../man3/curl_multi_remove_handle.3.html"><strong>curl_multi_remove_handle</strong>(3)</a></em> and then close it with <a href="../man3/curl_easy_cleanup.3.html"><strong>curl_easy_cleanup</strong>(3)</a></em>, or possibly set new options to it and add it again with <a href="../man3/curl_multi_add_handle.3.html"><strong>curl_multi_add_handle</strong>(3)</a></em> to start another transfer.</p><p>When all transfers in the multi stack are done, cleanup the multi handle with <a href="../man3/curl_multi_cleanup.3.html"><strong>curl_multi_cleanup</strong>(3)</a></em>. Be careful and please note that you <strong>MUST</strong> invoke separate <a href="../man3/curl_easy_cleanup.3.html"><strong>curl_easy_cleanup</strong>(3)</a></em> calls on every single easy handle to clean them up properly.</p><p>If you want to re-use an easy handle that was added to the multi handle for transfer, you must first remove it from the multi stack and then re-add it again (possibly after having altered some options at your own choice).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MULTI_SOCKET</h2>
        <div class="sectioncontent">
<p><a href="../man3/curl_multi_socket_action.3.html"><strong>curl_multi_socket_action</strong>(3)</a></em> function offers a way for applications to not only avoid being forced to use select(), but it also offers a much more high-performance API that will make a significant difference for applications using large numbers of simultaneous connections.</p><p><a href="../man3/curl_multi_socket_action.3.html"><strong>curl_multi_socket_action</strong>(3)</a></em> is then used instead of <a href="../man3/curl_multi_perform.3.html"><strong>curl_multi_perform</strong>(3)</a></em>.</p><p>When using this API, you add easy handles to the multi handle just as with the normal multi interface. Then you also set two callbacks with the CURLMOPT_SOCKETFUNCTION and CURLMOPT_TIMERFUNCTION options to <a href="../man3/curl_multi_setopt.3.html"><strong>curl_multi_setopt</strong>(3)</a></em>.</p><p>The API is then designed to inform your application about which sockets libcurl is currently using and for what activities (read and/or write) on those sockets your application is expected to wait for.</p><p>Your application must then make sure to receive all sockets informed about in the CURLMOPT_SOCKETFUNCTION callback and make sure it reacts on the given activity on them. When a socket has the given activity, you call <a href="../man3/curl_multi_socket_action.3.html"><strong>curl_multi_socket_action</strong>(3)</a></em> specifying which socket and action there are.</p><p>The CURLMOPT_TIMERFUNCTION callback is called to set a timeout. When that timeout expires, your application should call the <a href="../man3/curl_multi_socket_action.3.html"><strong>curl_multi_socket_action</strong>(3)</a></em> function saying it was due to a timeout.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BLOCKING</h2>
        <div class="sectioncontent">
<p>A few areas in the code are still using blocking code, even when used from the multi interface. While we certainly want and intend for these to get fixed in the future, you should be aware of the following current restrictions:</p>
<pre>
 - Name resolves unless the c-ares or threaded-resolver backends are used
 - NSS SSL connections
 - HTTP proxy CONNECT operations
 - SOCKS proxy handshakes
 - file:// transfers
 - TELNET transfers
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libcurl-errors.3.html"><span aria-hidden="true">&larr;</span> libcurl-errors.3: Error codes in libcurl</a></li>
   <li class="next"><a href="libcurl-share.3.html">libcurl-share.3: How to use the share interface <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
