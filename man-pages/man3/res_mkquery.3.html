<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>res_mkquery: Resolver routines</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Resolver routines">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="res_mkquery (3) manual">
  <meta name="twitter:description" content="Resolver routines">
  <meta name="twitter:image" content="https://www.carta.tech/images/manpages-dev-res_mkquery-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/res_mkquery.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="res_mkquery (3) manual" />
  <meta property="og:description" content="Resolver routines" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/manpages-dev-res_mkquery-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">res_mkquery<small> (3)</small></h1>
        <p class="lead">Resolver routines</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/res_mkquery.3.html">
      <span itemprop="name">res_mkquery: Resolver routines</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/manpages-dev/">
      <span itemprop="name">manpages-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/res_mkquery.3.html">
      <span itemprop="name">res_mkquery: Resolver routines</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include &lt;netinet/in.h&gt;</strong>
<strong>#include &lt;arpa/nameser.h&gt;</strong>
<strong>#include &lt;resolv.h&gt;</strong>
<strong>extern struct __res_state _res;</strong>

<strong>int res_init(void);</strong>

<strong>int res_query(const char *</strong><em>dname</em><strong>, int </strong><em>class</em><strong>, int </strong><em>type</em><strong>,</strong>
<strong>unsigned char *</strong><em>answer</em><strong>, int </strong><em>anslen</em><strong>);</strong>
</pre>
<p><strong>int res_search(const char *</strong><em>dname</em><strong>, int </strong><em>class</em><strong>, int </strong><em>type</em><strong>,</strong></p><p><strong>unsigned char *</strong><em>answer</em><strong>, int </strong><em>anslen</em><strong>);</strong></p><p><strong>int res_querydomain(const char *</strong><em>name</em><strong>, const char *</strong><em>domain</em><strong>,</strong></p><p><strong>int </strong><em>class</em><strong>, int </strong><em>type</em><strong>, unsigned char *</strong><em>answer</em><strong>,</strong> <strong>int </strong><em>anslen</em><strong>);</strong></p><p><strong>int res_mkquery(int </strong><em>op</em><strong>, const char *</strong><em>dname</em><strong>, int </strong><em>class</em><strong>,</strong></p><p><strong>int </strong><em>type</em><strong>, const unsigned char *</strong><em>data</em><strong>, int </strong><em>datalen</em><strong>,</strong> <strong>const unsigned char *</strong><em>newrr</em><strong>, unsigned char *</strong><em>buf</em><strong>, int </strong><em>buflen</em><strong>);</strong></p><p><strong>int res_send(const unsigned char *</strong><em>msg</em><strong>, int </strong><em>msglen</em><strong>,</strong></p><p><strong>unsigned char *</strong><em>answer</em><strong>, int </strong><em>anslen</em><strong>);</strong></p><p><strong>int dn_comp(const char *</strong><em>exp_dn</em><strong>, unsigned char *</strong><em>comp_dn</em><strong>,</strong></p><p><strong>int </strong><em>length</em><strong>, unsigned char **</strong><em>dnptrs</em><strong>, unsigned char **</strong><em>lastdnptr</em><strong>);</strong></p><p><strong>int dn_expand(const unsigned char *</strong><em>msg</em><strong>, const unsigned char *</strong><em>eomorig</em><strong>,</strong></p><p><strong>const unsigned char *</strong><em>comp_dn</em><strong>, char *</strong><em>exp_dn</em><strong>,</strong> <strong>int </strong><em>length</em><strong>);</strong></p><p>Link with <em>-lresolv</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>These functions make queries to and interpret the responses from Internet domain name servers.</p><p>The <strong>res_init</strong>() function reads the configuration files (see <a href="../man5/resolv.conf.5.html"><strong>resolv.conf</strong>(5)</a>) to get the default domain name, search order and name server address(es). If no server is given, the local host is tried. If no domain is given, that associated with the local host is used. It can be overridden with the environment variable <strong>LOCALDOMAIN</strong>. <strong>res_init</strong>() is normally executed by the first call to one of the other functions.</p><p>The <strong>res_query</strong>() function queries the name server for the fully qualified domain name <em>name</em> of specified <em>type</em> and <em>class</em>. The reply is left in the buffer <em>answer</em> of length <em>anslen</em> supplied by the caller.</p><p>The <strong>res_search</strong>() function makes a query and waits for the response like <strong>res_query</strong>(), but in addition implements the default and search rules controlled by <strong>RES_DEFNAMES</strong> and <strong>RES_DNSRCH</strong> (see description of <em>_res</em> options below).</p><p>The <strong>res_querydomain</strong>() function makes a query using <strong>res_query</strong>() on the concatenation of <em>name</em> and <em>domain</em>.</p><p>The following functions are lower-level routines used by <strong>res_query</strong>().</p><p>The <strong>res_mkquery</strong>() function constructs a query message in <em>buf</em> of length <em>buflen</em> for the domain name <em>dname</em>. The query type <em>op</em> is usually <strong>QUERY</strong>, but can be any of the types defined in <em>&lt;arpa/nameser.h&gt;</em>. <em>newrr</em> is currently unused.</p><p>The <strong>res_send</strong>() function sends a preformatted query given in <em>msg</em> of length <em>msglen</em> and returns the answer in <em>answer</em> which is of length <em>anslen</em>. It will call <strong>res_init</strong>(), if it has not already been called.</p><p>The <strong>dn_comp</strong>() function compresses the domain name <em>exp_dn</em> and stores it in the buffer <em>comp_dn</em> of length <em>length</em>. The compression uses an array of pointers <em>dnptrs</em> to previously compressed names in the current message. The first pointer points to the beginning of the message and the list ends with NULL. The limit of the array is specified by <em>lastdnptr</em>. If <em>dnptr</em> is NULL, domain names are not compressed. If <em>lastdnptr</em> is NULL, the list of labels is not updated.</p><p>The <strong>dn_expand</strong>() function expands the compressed domain name <em>comp_dn</em> to a full domain name, which is placed in the buffer <em>exp_dn</em> of size <em>length</em>. The compressed name is contained in a query or reply message, and <em>msg</em> points to the beginning of the message.</p><p>The resolver routines use global configuration and state information contained in the structure <em>_res</em>, which is defined in <em>&lt;resolv.h&gt;</em>. The only field that is normally manipulated by the user is <em>_res.options</em>. This field can contain the bitwise "OR" of the following options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>RES_INIT</strong></p>
  </dt>
  <dd>
    <p>True if <strong>res_init</strong>() has been called.</p>
  </dd>
  <dt>
    <p><strong>RES_DEBUG</strong></p>
  </dt>
  <dd>
    <p>Print debugging messages. This option is available only if glibc was built with debugging enabled, which is not the default.</p>
  </dd>
  <dt>
    <p><strong>RES_AAONLY</strong></p>
  </dt>
  <dd>
    <p>Accept authoritative answers only. <strong>res_send</strong>() continues until it finds an authoritative answer or returns an error.  [Not currently implemented].</p>
  </dd>
  <dt>
    <p><strong>RES_USEVC</strong></p>
  </dt>
  <dd>
    <p>Use TCP connections for queries rather than UDP datagrams.</p>
  </dd>
  <dt>
    <p><strong>RES_PRIMARY</strong></p>
  </dt>
  <dd>
    <p>Query primary domain name server only.</p>
  </dd>
  <dt>
    <p><strong>RES_IGNTC</strong></p>
  </dt>
  <dd>
    <p>Ignore truncation errors. Don't retry with TCP.  [Not currently implemented].</p>
  </dd>
  <dt>
    <p><strong>RES_RECURSE</strong></p>
  </dt>
  <dd>
    <p>Set the recursion desired bit in queries. Recursion is carried out by the domain name server, not by <strong>res_send</strong>(). [Enabled by default].</p>
  </dd>
  <dt>
    <p><strong>RES_DEFNAMES</strong></p>
  </dt>
  <dd>
    <p>If set, <strong>res_search</strong>() will append the default domain name to single component names&ndash;that is, those that do not contain a dot. [Enabled by default].</p>
  </dd>
  <dt>
    <p><strong>RES_STAYOPEN</strong></p>
  </dt>
  <dd>
    <p>Used with <strong>RES_USEVC</strong> to keep the TCP connection open between queries.</p>
  </dd>
  <dt>
    <p><strong>RES_DNSRCH</strong></p>
  </dt>
  <dd>
    <p>If set, <strong>res_search</strong>() will search for hostnames in the current domain and in parent domains. This option is used by <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a>. [Enabled by default].</p>
  </dd>

</dl>
<p>This list is not complete. You can find some other flags described in <a href="../man5/resolv.conf.5.html"><strong>resolv.conf</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>The <strong>res_init</strong>() function returns 0 on success, or -1 if an error occurs.</p><p>The <strong>res_query</strong>(), <strong>res_search</strong>(), <strong>res_querydomain</strong>(), <strong>res_mkquery</strong>() and <strong>res_send</strong>() functions return the length of the response, or -1 if an error occurs.</p><p>The <strong>dn_comp</strong>() and <strong>dn_expand</strong>() functions return the length of the compressed name, or -1 if an error occurs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<pre>
/etc/resolv.conf          resolver configuration file
/etc/host.conf            resolver configuration file
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>4.3BSD.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO res_mkquery&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a>, <a href="../man5/resolv.conf.5.html"><strong>resolv.conf</strong>(5)</a>, <a href="../man5/resolver.5.html"><strong>resolver</strong>(5)</a>, <a href="../man7/hostname.7.html"><strong>hostname</strong>(7)</a>, <a href="../man8/named.8.html"><strong>named</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of release 3.74 of the Linux <em>man-pages</em> project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at http://www.kernel.org/doc/man-pages/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="res_init.3.html"><span aria-hidden="true">&larr;</span> res_init.3: Resolver routines</a></li>
   <li class="next"><a href="res_query.3.html">res_query.3: Resolver routines <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
