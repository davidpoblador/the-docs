<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CGI::Application::Plugin::FormState: Store form state without hidden fields</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Store form state without hidden fields">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CGI::Application::Plugin::FormState (3pm) manual">
  <meta name="twitter:description" content="Store form state without hidden fields">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcgi-application-plugin-formstate-perl-CGI::Application::Plugin::FormState-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/CGI::Application::Plugin::FormState.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CGI::Application::Plugin::FormState (3pm) manual" />
  <meta property="og:description" content="Store form state without hidden fields" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcgi-application-plugin-formstate-perl-CGI::Application::Plugin::FormState-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CGI::Application::Plugin::FormState<small> (3pm)</small></h1>
        <p class="lead">Store form state without hidden fields</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::FormState.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::FormState: Store form state without hidden fields</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcgi-application-plugin-formstate-perl/">
      <span itemprop="name">libcgi-application-plugin-formstate-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::FormState.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::FormState: Store form state without hidden fields</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>Version 0.12</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>FormState is just a temporary stash that you can use for storing and retrieving private parameters in your multi-page form.</p>
<pre>
    use CGI::Application::Plugin::FormState;

    my $form = &lt;&lt;EOF;
       &lt;form action="app.cgi"&gt;
       &lt;input type="hidden" name="run_mode" value="form_process_runmode"&gt;
       &lt;input type="hidden" name="cap_form_state" value="&lt;tmpl_var cap_form_state&gt;"&gt;
       ...
       &lt;/form&gt;
    EOF

    sub form_display_runmode {
        my $self = shift;

        # Store some parameters
        $self-&gt;form_state-&gt;param(&apos;name&apos;       =&gt; &apos;Road Runner&apos;);
        $self-&gt;form_state-&gt;param(&apos;occupation&apos; =&gt; &apos;Having Fun&apos;);

        my $t = $self-&gt;load_tmpl(scalarref =&gt; &#92;$form);
        return $t-&gt;output;

    }

    sub form_process_runmode {
        my $self = shift;

        # Retrieve some parameters
        print $self-&gt;form_state-&gt;param(&apos;name&apos;);       # &apos;Road Runner&apos;
        print $self-&gt;form_state-&gt;param(&apos;occupation&apos;); # &apos;Having Fun&apos;
    }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>This is a more complete example, using CGI::Application::Plugin::ValidateRM.</p><p>    use CGI::Application::Plugin::Session;     use CGI::Application::Plugin::FormState;     use CGI::Application::Plugin::ValidateRM;</p><p>    my $form = &lt;&lt;EOF;        &lt;form action="app.cgi"&gt;        &lt;input type="hidden" name="run_mode" value="my_form_process"&gt;        &lt;input type="hidden" name="cap_form_state" value="&lt;tmpl_var cap_form_state&gt;"&gt;        ...        &lt;/form&gt;     EOF</p><p>    sub my_form_display {         my $self     = shift;         my $errs     = shift;         my $t        = $self-&gt;load_tmpl(scalarref =&gt; &#92;$form);</p><p>        # Stash some data into it         $self-&gt;form_state-&gt;param(&apos;name&apos;       =&gt; &apos;Wile E. Coyote&apos;);         $self-&gt;form_state-&gt;param(&apos;occupation&apos; =&gt; &apos;Mining Engineer&apos;);</p><p>        # Normal ValidateRM error handling         $t-&gt;param($errs) if $errs;         return $t-&gt;output;     }</p><p>    sub my_form_process {         my $self;</p><p>        # Normal ValidateRM validation         my ($results, $err_page) = $self-&gt;check_rm(&apos;my_form_display&apos;,&apos;_my_form_profile&apos;);         return $err_page if $err_page;</p><p>        # The data from the submitted form         my $params = $self-&gt;dfv_results;</p><p>        $params-&gt;{&apos;name&apos;}       = $self-&gt;form_state-&gt;param(&apos;name&apos;);       # &apos;Wile E. Coyote&apos;         $params-&gt;{&apos;occupation&apos;} = $self-&gt;form_state-&gt;param(&apos;occupation&apos;); # &apos;Mining Engineer&apos;</p><p>        # Now do something interesting with $params         # ...</p><p>        my $t = $self-&gt;load_tmpl(&apos;success.html&apos;);         return $t-&gt;output;     }</p><p>    # Standard ValiateRM profile     sub _my_form_profile {         return {             required =&gt; &apos;email&apos;,             msgs =&gt; {                     any_errors =&gt; &apos;some_errors&apos;,                     prefix =&gt; &apos;err_&apos;,             },         };     }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>\*(C`CGI::Application::Plugin::FormState\*(C' provides a temporary storage area within the user's session for storing form-related data.</p><p>The main use of this is for multi-page forms.  Instead of using hidden fields to store data related to the form, you store and retrieve values from the form state.</p><p>In the first instance of your app:</p><p>    $self-&gt;form_state-&gt;param(&apos;some_name&apos; =&gt; &apos;some_value&apos;);     $self-&gt;form_state-&gt;param(&apos;some_other_name&apos; =&gt; &apos;some_other_value&apos;);</p><p>And later, in a different instance of your app:</p><p>    $val1 = $self-&gt;form_state-&gt;param(&apos;some_name&apos;);     $val2 = $self-&gt;form_state-&gt;param(&apos;some_other_name&apos;);</p><p>To connect the first instance and the second, you put a single hidden field in your template:</p><p>    &lt;input type="hidden" name="cap_form_state" value="&lt;tmpl_var my_storage_name&gt;"&gt;</p><p>You don't have to worry about creating the template param \*(C`cap_form_state\*(C'; it is added automatically to your template parameters via the \*(C`load_tmpl\*(C' hook.</p><p>If you want to use a parameter other than \*(C`cap_form_state\*(C' you can do so via the \*(C`name\*(C' parameter to \*(C`form_state-\*(C'config&gt;.</p><p>If you're skeptical about whether all this abstraction is a good idea, see \*(L"\s-1MOTIVATION\s0\*(R", below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PRESERVING FORM STATE ACROSS REDIRECTS</h2>
        <div class="sectioncontent">
<p>You can include the form_state hash in a link:</p><p>    my $link = &apos;/app.cgi?rm=list&cap_form_state=&apos; . $self-&gt;form_state-&gt;id;</p><p>If you use CGI::Application::Plugin::Redirect, you can easily create redirect this way:</p><p>    $self-&gt;redirect(&apos;/app.cgi?rm=list&cap_form_state=&apos; . $self-&gt;form_state-&gt;id);</p><p>If you also use CGI::Application::Plugin::LinkIntegrity it is as simple as:</p><p>    $self-&gt;redirect($self-&gt;link(&apos;/app.cgi&apos;, &apos;rm&apos; =&gt; &apos;list&apos;, &apos;cap_form_state&apos; =&gt; $self-&gt;form_state-&gt;id));</p><p>Or, in the case of a link to the currently running app:</p><p>    $self-&gt;redirect($self-&gt;self_link(&apos;rm&apos; =&gt; &apos;list&apos;, &apos;cap_form_state&apos; =&gt; $self-&gt;form_state-&gt;id));</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IMPLEMENTATION</h2>
        <div class="sectioncontent">
<p>When you call \*(C`$self-&gt;form_state\*(C' for the first time, a top-level key is created in the user's session.  This key contains a random, hard-to-guess element.  It might look something like:</p><p>   form_state_cap_form_state_84eb13cfed01764d9c401219faa56d53</p><p>All data you place in the form state with \*(C`param\*(C' is stored in the user's session under this key.</p><p>You pass the name of this key on to the next instance of your application by means of a hidden field in your form:</p><p>    &lt;input type="hidden" name="cap_form_state" value="&lt;tmpl_var cap_form_state&gt;"&gt;</p><p>You manually put this hidden field in your template.  The template parameter \*(C`cap_form_state\*(C' is automatically added to your template parameters via the \*(C`load_tmpl\*(C' hook.  It contains the random, hard-to-guess portion (e.g. \*(C`84eb13cfed01764d9c401219faa56d53\*(C').  When the template is filled, the hidden field will look something like this:</p><p>    &lt;input type="hidden" name="cap_form_state" value="84eb13cfed01764d9c401219faa56d53"&gt;</p><p>Since all values are stored on the server in the user's session, the user can't tamper with any of them.</p><p>To keep old form_data from cluttering up the user's session, the system uses CGI::Session's \*(C`expire\*(C' feature to expire old form state keys after a reasonable amount of time has passed (2 days by default).</p><p>You can manually delete a form state storage by calling:</p><p>    $self-&gt;form_state-&gt;delete;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    config(%options)
  </dt>
  <dd>
    <p>Sets defaults for the plugin. <strong>Calling config is purely optional, since the defaults should be fine most purposes.</strong>     $self-&gt;form_state-&gt;config(&apos;name&apos; =&gt; &apos;storage_names&apos;, &apos;expires&apos; =&gt; &apos;3d&apos;) The following options are allowed:</p>
<dl class='dl-vertical'>
  <dt>
    name
  </dt>
  <dd>
    <p>Sets the name of the default form state storage.  This name is used for the key in the user's session, for the name of hidden form field, and the template parameter used to fill the hidden form field.  So if you set the \*(C`name\*(C' to \*(C`foo\*(C':     $self-&gt;form_state_config(&apos;name&apos; =&gt; &apos;foo&apos;); then the hidden field in your template should look like this:     &lt;input type="hidden" name="foo" value="&lt;tmpl_var foo&gt;"&gt; and the key in the user's session would look something like this:    form_state_foo_84eb13cfed01764d9c401219faa56d53</p>
  </dd>
  <dt>
    expires
  </dt>
  <dd>
    <p>Indicates when form state storage keys should expire and disappear from the user's session.  Uses the same format as CGI::Session's \*(C`expire\*(C'.  Defaults to 2 days (&apos;2d&apos;).  To cancel expiration and make the form state last as long as the user's session does, use:     $self-&gt;form_state_config(&apos;expires&apos; =&gt; 0);</p>
  </dd>

</dl>

  </dd>
  <dt>
    param
  </dt>
  <dd>
    <p>Read and set values in the form state storage.  It acts like the \*(C`param\*(C' method typically does in modules such as \s-1CGI\s0, CGI::Application, CGI::Session, \*(C`HTML::Template\*(C' etc.     # set a value     $self-&gt;form_state-&gt;param(&apos;some_name&apos; =&gt; &apos;some_value&apos;);</p><p>    # retrieve a value     my $val = $self-&gt;form_state-&gt;param(&apos;some_name&apos;);</p><p>    # set multiple values     $self-&gt;form_state-&gt;param(         &apos;some_name&apos;       =&gt; &apos;some_value&apos;,         &apos;some_other_name&apos; =&gt; &apos;some_other_value&apos;,     );</p><p>    # retrive the names of all the keys     my @keys = $self-&gt;form_state-&gt;param;</p>
  </dd>
  <dt>
    clear_params
  </dt>
  <dd>
    <p>Clear all of the values in the form state storage:    $self-&gt;form_state-&gt;param(&apos;name&apos; =&gt; &apos;Road Runner&apos;);    $self-&gt;form_state-&gt;clear_params;    print $self-&gt;form_state-&gt;param(&apos;name&apos;); # undef</p>
  </dd>
  <dt>
    delete
  </dt>
  <dd>
    <p>Deletes the form_state storage from the user's session.</p>
  </dd>
  <dt>
    id
  </dt>
  <dd>
    <p>Returns the current value of the storage param - the \*(L"hard to guess\*(R" portion of the session key.     my $id = $self-&gt;form_state-&gt;id;</p>
  </dd>
  <dt>
    name
  </dt>
  <dd>
    <p>Returns the current name being used for storage. Defaults to \*(C`cap_form_state\*(C'.     my $name = $self-&gt;form_state-&gt;name;</p>
  </dd>
  <dt>
    session_key
  </dt>
  <dd>
    <p>Returns the full key used for storage in the user's session.     my $key = $self-&gt;form_state-&gt;session_key;</p><p>    # Get the full form state hash     my $data = $self-&gt;session-&gt;param($key); The following can be used to debug the form_state data:     use Data::Dumper;     print STDERR Dumper $self-&gt;session-&gt;param($self-&gt;form_state-&gt;session_key);</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MOTIVATION</h2>
        <div class="sectioncontent">
<h3>Why not just use hidden fields?</h3>
<p>Hidden fields are not secure.  The end user could save a local copy of your form, change the hidden fields and tamper with your app's form state.</p>
<h3>Why not just use the user's session?</h3>
<p>With \*(C`CGI::Application::Plugin::FormState\*(C' the data is associated with a particular instance of a form, not with the user.  If the user gives up halfway through your multi-page form, you don't want their session to be cluttered up with the incomplete form state data.</p><p>If a user opens up your application in two browser windows (both sharing the same user session), each window should have it's own independent form state.</p><p>For instance, in an email application the user might have one window open for the inbox and another open for the outbox.  If you store the value of "current_mailbox" in the user's session, then one of these windows will go to the wrong mailbox.</p><p>Finally, the user's session probably sticks around longer than the form state should.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Michael Graham, \*(C`&lt;mag-perl@occamstoothbrush.com&gt;\*(C'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any bugs or feature requests to \*(C`bug-cgi-application-plugin-formstate@rt.cpan.org\*(C', or through the web interface at &lt;http://rt.cpan.org&gt;.  I will be notified, and then you'll automatically be notified of progress on your bug as I make changes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">
<p>Thanks to Richard Dice and Cees Hek for helping me sort out the issues with this approach.</p><p>The informative error message text used for when this module is loaded before your app actually @ISA \*(C`CGI::Application\*(C' object was stolen from Cees's CGI::Application::Plugin::TT module.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT & LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright 2005 Michael Graham, All Rights Reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CGI::Application::Plugin::FillInForm.3pm.html"><span aria-hidden="true">&larr;</span> CGI::Application::Plugin::FillInForm.3pm: Integrate with html::fillinform</a></li>
   <li class="next"><a href="CGI::Application::Plugin::Forward.3pm.html">CGI::Application::Plugin::Forward.3pm: Pass control from one run mode to another <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
