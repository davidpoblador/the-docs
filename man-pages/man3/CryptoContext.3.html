<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CryptoContext: The implementation for a srtp cryptographic context.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The implementation for a srtp cryptographic context.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CryptoContext (3) manual">
  <meta name="twitter:description" content="The implementation for a srtp cryptographic context.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libccrtp-doc-CryptoContext-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/CryptoContext.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CryptoContext (3) manual" />
  <meta property="og:description" content="The implementation for a srtp cryptographic context." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libccrtp-doc-CryptoContext-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CryptoContext<small> (3)</small></h1>
        <p class="lead">The implementation for a srtp cryptographic context.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/CryptoContext.3.html">
      <span itemprop="name">CryptoContext: The implementation for a srtp cryptographic context.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libccrtp-doc/">
      <span itemprop="name">libccrtp-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/CryptoContext.3.html">
      <span itemprop="name">CryptoContext: The implementation for a srtp cryptographic context.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;CryptoContext.h&gt;</p><h3>Public Member Functions</h3>
<p><strong>CryptoContext</strong> (uint32 ssrc)</p><p><em>Constructor for empty SRTP cryptographic context. </em> <strong>CryptoContext</strong> (uint32 ssrc, int32 roc, int64 keyDerivRate, const int32 ealg, const int32 aalg, uint8 *masterKey, int32 masterKeyLength, uint8 *masterSalt, int32 masterSaltLength, int32 ekeyl, int32 akeyl, int32 skeyl, int32 tagLength)</p><p><em>Constructor for an active SRTP cryptographic context. </em> <strong>~CryptoContext</strong> ()</p><p><em>Destructor. </em> void <strong>setRoc</strong> (uint32 r)</p><p><em>Set the Roll-Over-Counter. </em> uint32 <strong>getRoc</strong> () const </p><p><em>Get the Roll-Over-Counter. </em> void <strong>srtpEncrypt</strong> (<strong>RTPPacket</strong> *rtp, uint64 index, uint32 ssrc)</p><p><em>Perform SRTP encryption. </em> void <strong>srtpAuthenticate</strong> (<strong>RTPPacket</strong> *rtp, uint32 roc, uint8 *tag)</p><p><em>Compute the authentication tag. </em> void <strong>deriveSrtpKeys</strong> (uint64 index)</p><p><em>Perform key derivation according to SRTP specification. </em> uint64 <strong>guessIndex</strong> (uint16 newSeqNumber)</p><p><em>Compute (guess) the new SRTP index based on the sequence number of a received RTP packet. </em> bool <strong>checkReplay</strong> (uint16 newSeqNumber)</p><p><em>Check for packet replay. </em> void <strong>update</strong> (uint16 newSeqNumber)</p><p><em>Update the SRTP packet index. </em> int32 <strong>getTagLength</strong> () const </p><p><em>Get the length of the SRTP authentication tag in bytes. </em> int32 <strong>getMkiLength</strong> () const </p><p><em>Get the length of the MKI in bytes. </em> uint32 <strong>getSsrc</strong> () const </p><p><em>Get the SSRC of this SRTP Cryptograhic context. </em> <strong>CryptoContext</strong> * <strong>newCryptoContextForSSRC</strong> (uint32 ssrc, int roc, int64 keyDerivRate)</p><p><em>Derive a new Crypto Context for use with a new SSRC. </em></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p>The implementation for a SRTP cryptographic context.</p><p>This class holds data and provides functions that implement a cryptographic context for SRTP, Refer to RFC 3711, chapter 3.2 for some more detailed information about the SRTP cryptographic context.</p><p>Each SRTP cryptographic context maintains a RTP source identified by its SSRC. Thus you can independently protect each source inside a RTP session.</p><p>Key management mechanisms negotiate the parameters for the SRTP cryptographic context, such as master key, key length, authentication length and so on. The key management mechanisms are not part of SRTP. Refer to MIKEY (RFC 3880) or to Phil Zimmermann's ZRTP protocol (draft-zimmermann-avt-zrtp-01). After key management negotiated the data the application can setup the SRTP cryptographic context and enable SRTP processing.</p><p>Currently this implementation supports RTP only, not RTCP.</p><p><strong>Author:</strong></p><p>Israel Abad i_abad@terra.es</p><p>Erik Eliasson eliasson@it.kth.se</p><p>Johan Bilien jobi@via.ecp.fr</p><p>Joachim Orrblad joachim@orrblad.com</p><p>Werner Dittmann Werner.Dittmann@t-online.de</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Constructor & Destructor Documentation</h2>
        <div class="sectioncontent">
<h3>CryptoContext::CryptoContext (uint32ssrc)</h3>
<p>Constructor for empty SRTP cryptographic context. This constructor creates an empty SRTP cryptographic context were all algorithms are set to the null algorithm, that is no SRTP processing is performed.</p><p><strong>Parameters:</strong></p><p><em>ssrc</em> The RTP SSRC that this SRTP cryptographic context protects.</p>
<h3>CryptoContext::CryptoContext (uint32ssrc, int32roc, int64keyDerivRate, const int32ealg, const int32aalg, uint8 *masterKey, int32masterKeyLength, uint8 *masterSalt, int32masterSaltLength, int32ekeyl, int32akeyl, int32skeyl, int32tagLength)</h3>
<p>Constructor for an active SRTP cryptographic context. This constructor creates an active SRTP cryptographic context were algorithms are enabled, keys are computed and so on. This SRTP cryptographic context can protect a RTP SSRC stream.</p><p><strong>Parameters:</strong></p><p><em>ssrc</em> The RTP SSRC that this SRTP cryptographic context protects.</p><p><em>roc</em> The initial Roll-Over-Counter according to RFC 3711. These are the upper 32 bit of the overall 48 bit SRTP packet index. Refer to chapter 3.2.1 of the RFC.</p><p><em>keyDerivRate</em> The key derivation rate defines when to recompute the SRTP session keys. Refer to chapter 4.3.1 in the RFC.</p><p><em>ealg</em> The encryption algorithm to use. Possible values are  SrtpEncryptionNull, SrtpEncryptionAESCM, SrtpEncryptionAESF8 <em>. See chapter 4.1.1 for AESCM (Counter mode) and 4.1.2 for AES F8 mode.</em></p><p><em>aalg</em> The authentication algorithm to use. Possible values are  SrtpEncryptionNull, SrtpAuthenticationSha1Hmac<em>. The only active algorithm here is SHA1 HMAC, a SHA1 based hashed message authentication code as defined in RFC 2104.</em></p><p><em>masterKey</em> Pointer to the master key for this SRTP cryptographic context. Must point to masterKeyLength<em> bytes. Refer to chapter 3.2.1 of the RFC about the role of the master key.</em></p><p><em>masterKeyLength</em> The length in bytes of the master key in bytes. The length must match the selected encryption algorithm. Because SRTP uses AES based encryption only, then master key length may be 16 or 32 bytes (128 or 256 bit master key)</p><p><em>masterSalt</em> SRTP uses the master salt to computer the initialization vector that in turn is input to compute the session key, session authentication key and the session salt.</p><p><em>masterSaltLength</em> The length in bytes of the master salt data in bytes. SRTP uses AES as encryption algorithm. AES encrypts 16 byte blocks (independent of the key length). According to RFC3711 the standard value for the master salt length should be 112 bit (14 bytes).</p><p><em>ekeyl</em> The length in bytes of the session encryption key that SRTP shall compute and use. Usually the same length as for the master key length. But you may use a different length as well. Be carefull that the key management mechanisms supports different key lengths.</p><p><em>akeyl</em> The length in bytes of the session authentication key. SRTP computes this key and uses it as input to the authentication algorithm. The standard value is 160 bits (20 bytes).</p><p><em>skeyl</em> The length in bytes of the session salt. SRTP computes this salt key and uses it as input during encryption. The length usually is the same as the master salt length.</p><p><em>tagLength</em> The length is bytes of the authentication tag that SRTP appends to the RTP packet. Refer to chapter 4.2. in the RFC 3711.</p>
<h3>CryptoContext::~CryptoContext ()</h3>
<p>Destructor. Cleans the SRTP cryptographic context.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Member Function Documentation</h2>
        <div class="sectioncontent">
<h3>bool CryptoContext::checkReplay (uint16newSeqNumber)</h3>
<p>Check for packet replay. The method check if a received packet is either to old or was already received.</p><p>The method supports a 64 packet history relative the the given sequence number.</p><p><strong>Parameters:</strong></p><p><em>newSeqNumber</em> The sequence number of the received RTP packet in host order.</p><p><strong>Returns:</strong></p><p>true if no replay, false if packet is too old ar was already received.</p>
<h3>void CryptoContext::deriveSrtpKeys (uint64index)</h3>
<p>Perform key derivation according to SRTP specification. This method computes the session key, session authentication key and the session salt key. This method must be called at least once after the SRTP Cryptograhic context was set up.</p><p><strong>Parameters:</strong></p><p><em>index</em> The 48 bit SRTP packet index. See the guessIndex<em> method.</em></p>
<h3>int32 CryptoContext::getMkiLength () const\fC [inline]\fP</h3>
<p>Get the length of the MKI in bytes.</p><p><strong>Returns:</strong></p><p>the length of the MKI.</p>
<h3>uint32 CryptoContext::getRoc () const\fC [inline]\fP</h3>
<p>Get the Roll-Over-Counter. Ths method get the upper 32 bit of the 48 bit SRTP packet index (the roll-over-part)</p><p><strong>Returns:</strong></p><p>The roll-over-counter</p>
<h3>uint32 CryptoContext::getSsrc () const\fC [inline]\fP</h3>
<p>Get the SSRC of this SRTP Cryptograhic context.</p><p><strong>Returns:</strong></p><p>the SSRC.</p>
<h3>int32 CryptoContext::getTagLength () const\fC [inline]\fP</h3>
<p>Get the length of the SRTP authentication tag in bytes.</p><p><strong>Returns:</strong></p><p>the length of the authentication tag.</p>
<h3>uint64 CryptoContext::guessIndex (uint16newSeqNumber)</h3>
<p>Compute (guess) the new SRTP index based on the sequence number of a received RTP packet. The method uses the algorithm show in RFC3711, Appendix A, to compute the new index.</p><p><strong>Parameters:</strong></p><p><em>newSeqNumber</em> The sequence number of the received RTP packet in host order.</p><p><strong>Returns:</strong></p><p>The new SRTP packet index</p>
<h3>\fBCryptoContext\fP* CryptoContext::newCryptoContextForSSRC (uint32ssrc, introc, int64keyDerivRate)</h3>
<p>Derive a new Crypto Context for use with a new SSRC. This method returns a new Crypto Context initialized with the data of this crypto context. Replacing the SSRC, Roll-over-Counter, and the key derivation rate the application cab use this Crypto Context to encrypt / decrypt a new stream (Synchronization source) inside one RTP session.</p><p>Before the application can use this crypto context it must call the deriveSrtpKeys method.</p><p><strong>Parameters:</strong></p><p><em>ssrc</em> The SSRC for this context</p><p><em>roc</em> The Roll-Over-Counter for this context</p><p><em>keyDerivRate</em> The key derivation rate for this context</p><p><strong>Returns:</strong></p><p>a new <strong>CryptoContext</strong> with all relevant data set.</p>
<h3>void CryptoContext::setRoc (uint32r)\fC [inline]\fP</h3>
<p>Set the Roll-Over-Counter. Ths method sets the upper 32 bit of the 48 bit SRTP packet index (the roll-over-part)</p><p><strong>Parameters:</strong></p><p><em>r</em> The roll-over-counter</p>
<h3>void CryptoContext::srtpAuthenticate (\fBRTPPacket\fP *rtp, uint32roc, uint8 *tag)</h3>
<p>Compute the authentication tag. Compute the authentication tag according the the parameters in the SRTP Cryptograhic context.</p><p><strong>Parameters:</strong></p><p><em>rtp</em> The RTP packet that contains the data to authenticate.</p><p><em>roc</em> The 32 bit SRTP roll-over-counter.</p><p><em>tag</em> Points to a buffer that hold the computed tag. This buffer must be able to hold tagLength<em> bytes.</em></p>
<h3>void CryptoContext::srtpEncrypt (\fBRTPPacket\fP *rtp, uint64index, uint32ssrc)</h3>
<p>Perform SRTP encryption. This method encrypts <em>and</em> decrypts SRTP payload data. Plain data gets encrypted, encrypted data get decrypted.</p><p><strong>Parameters:</strong></p><p><em>rtp</em> The RTP packet that contains the data to encrypt.</p><p><em>index</em> The 48 bit SRTP packet index. See the guessIndex<em> method.</em></p><p><em>ssrc</em> The RTP SSRC data in <em>host</em> order.</p>
<h3>void CryptoContext::update (uint16newSeqNumber)</h3>
<p>Update the SRTP packet index. Call this method after all checks were successful. See chapter 3.3.1 in the RFC when to update the ROC and ROC processing.</p><p><strong>Parameters:</strong></p><p><em>newSeqNumber</em> The sequence number of the received RTP packet in host order.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for ccRTP from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Cpwd.3.html"><span aria-hidden="true">&larr;</span> Cpwd.3: Lcg password file thread-safe inferface</a></li>
   <li class="next"><a href="CryptoContext.h.3.html">CryptoContext.h.3: Cryptocontext.h - <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
