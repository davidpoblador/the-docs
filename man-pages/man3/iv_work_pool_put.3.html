<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iv_work_pool_put: Ivykis worker thread management</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Ivykis worker thread management">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="iv_work_pool_put (3) manual">
  <meta name="twitter:description" content="Ivykis worker thread management">
  <meta name="twitter:image" content="https://www.carta.tech/images/libivykis-dev-iv_work_pool_put-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/iv_work_pool_put.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="iv_work_pool_put (3) manual" />
  <meta property="og:description" content="Ivykis worker thread management" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libivykis-dev-iv_work_pool_put-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">iv_work_pool_put<small> (3)</small></h1>
        <p class="lead">Ivykis worker thread management</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/iv_work_pool_put.3.html">
      <span itemprop="name">iv_work_pool_put: Ivykis worker thread management</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libivykis-dev/">
      <span itemprop="name">libivykis-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/iv_work_pool_put.3.html">
      <span itemprop="name">iv_work_pool_put: Ivykis worker thread management</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;iv_work.h&gt;</strong></p>
<pre>
struct iv_work_pool {
        int             max_threads;
        void            *cookie;
        void            (*thread_start)(void *cookie);
        void            (*thread_stop)(void *cookie);
};

struct iv_work_item {
        void            *cookie;
        void            (*work)(void *cookie);
        void            (*completion)(void *cookie);
};
</pre>
<p><strong>void IV_WORK_POOL_INIT(struct iv_work_pool *</strong><em>this</em><strong>);</strong></p><p><strong>int iv_work_pool_create(struct iv_work_pool *</strong><em>this</em><strong>);</strong></p><p><strong>int iv_work_pool_put(struct iv_work_pool *</strong><em>this</em><strong>);</strong></p><p><strong>void IV_WORK_ITEM_INIT(struct iv_work_item *</strong><em>work</em><strong>);</strong></p><p><strong>int iv_work_pool_submit_work(struct iv_work_pool *</strong><em>this</em><strong>, struct iv_work_item *</strong><em>work</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Calling <strong>iv_work_pool_create</strong> on a <strong>struct iv_work_pool</strong> object previously initialised by <strong>IV_WORK_POOL_INIT</strong> creates a pool of worker threads that can be used to offload CPU intensive tasks to, so as to prevent negatively influencing event handling latency in the calling thread, and to enable the use of multiple host CPUs for CPU intensive tasks.</p><p><strong>iv_work</strong> dynamically adjusts the number of threads in the pool to the amount of work there is to do.  The <strong>-&gt;max_threads</strong> member of <strong>struct iv_work_pool</strong> specifies the maximum number of threads that will be created in this pool.</p><p>Calling <strong>iv_work_pool_submit_work</strong> on a <strong>struct iv_work_item</strong> object previously initialised by <strong>IV_WORK_ITEM_INIT</strong> submits a work item to a pool.  The <strong>-&gt;work</strong> member of <strong>struct iv_work_item</strong> specifies the function that will be called in one of the worker threads in the pool specified by <strong>-&gt;this,</strong> with <strong>-&gt;cookie</strong> as its sole argument.  When the work function has completed, <strong>iv_work</strong> will call the <strong>-&gt;completion</strong> callback to indicate this, also with <strong>-&gt;cookie</strong> as its sole argument, in the thread that <strong>iv_work_pool_create</strong> was called in for this pool object.</p><p>As a special case, calling <strong>iv_work_pool_submit_work</strong> with a <strong>NULL</strong> work pool pointer will cause the work item to be processed in the local thread, from an <a href="../man3/iv_task.3.html"><strong>iv_task</strong>(3)</a> callback.</p><p>If the <strong>-&gt;thread_start</strong> function pointer specified in <strong>struct iv_work_pool</strong> is not NULL, it will be called upon creation of a new worker thread, in the context of the created worker thread, with <strong>-&gt;cookie</strong> as its sole argument.  Calls to <strong>-&gt;thread_start</strong> are not explicitly serialised, which should be kept in mind when manipulating state shared between threads from within that callback function.</p><p>Similarly, if <strong>iv_work</strong> decides to terminate a worker thread, for example due to inactivity, <strong>-&gt;thread_stop</strong> will be called in the context of the terminating thread, with <strong>-&gt;cookie</strong> as its sole argument.  Calls to <strong>-&gt;thread_stop</strong> are also not explicitly serialised.</p><p><strong>iv_work_pool_submit_work</strong> can only be called from the thread that <strong>iv_work_pool_create</strong> for this pool object was called in.</p><p>There is no way to cancel submitted work items.</p><p>There is no guaranteed order, FIFO or otherwise, between different work items submitted to the same worker thread pool.</p><p>When the user has no more work items to submit to the pool, its reference to the pool can be dropped by calling <strong>iv_work_pool_put.</strong></p><p>If there are still pending or running work items assigned to this pool when <strong>iv_work_pool_put</strong> is called, those work items will not be canceled, but will be allowed to run to completion, and their <strong>-&gt;completion</strong> callbacks will be called as usual.  A similar thing holds for the <strong>-&gt;thread_start</strong> and <strong>-&gt;thread_stop</strong> callbacks -- they can also still be called after <strong>iv_work_pool_put</strong> returns.  Even so, the memory corresponding to the <strong>struct iv_work_pool</strong> can immediately be freed or reused by the user upon return of the <strong>iv_work_pool_put</strong> call.</p><p>Internally, <strong>iv_work</strong> uses <a href="../man3/iv_thread.3.html"><strong>iv_thread</strong>(3)</a> for its thread management.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO iv_work_pool_put&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/ivykis.3.html"><strong>ivykis</strong>(3)</a>, <a href="../man3/iv_thread.3.html"><strong>iv_thread</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="iv_work_pool_create.3.html"><span aria-hidden="true">&larr;</span> iv_work_pool_create.3: Ivykis worker thread management</a></li>
   <li class="next"><a href="iv_work_pool_submit_work.3.html">iv_work_pool_submit_work.3: Ivykis worker thread management <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
