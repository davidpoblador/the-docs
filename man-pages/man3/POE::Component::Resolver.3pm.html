<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>POE::Component::Resolver: A non-blocking getaddrinfo() resolver</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A non-blocking getaddrinfo() resolver">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="POE::Component::Resolver (3pm) manual">
  <meta name="twitter:description" content="A non-blocking getaddrinfo() resolver">
  <meta name="twitter:image" content="https://www.carta.tech/images/libpoe-component-resolver-perl-POE::Component::Resolver-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/POE::Component::Resolver.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="POE::Component::Resolver (3pm) manual" />
  <meta property="og:description" content="A non-blocking getaddrinfo() resolver" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libpoe-component-resolver-perl-POE::Component::Resolver-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">POE::Component::Resolver<small> (3pm)</small></h1>
        <p class="lead">A non-blocking getaddrinfo() resolver</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/POE::Component::Resolver.3pm.html">
      <span itemprop="name">POE::Component::Resolver: A non-blocking getaddrinfo() resolver</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libpoe-component-resolver-perl/">
      <span itemprop="name">libpoe-component-resolver-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/POE::Component::Resolver.3pm.html">
      <span itemprop="name">POE::Component::Resolver: A non-blocking getaddrinfo() resolver</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>version 0.920</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
        #!/usr/bin/perl

        use warnings;
        use strict;

        use POE;
        use POE::Component::Resolver qw(AF_INET AF_INET6);

        my $r = POE::Component::Resolver-&gt;new(
                max_resolvers =&gt; 8,
                idle_timeout  =&gt; 5,
                af_order      =&gt; [ AF_INET6, AF_INET ],
                # sidecar_program =&gt; $path_to_program,
        );

        my @hosts = qw( ipv6-test.com );
        my $tcp   = getprotobyname("tcp");

        POE::Session-&gt;create(
                inline_states =&gt; {
                        _start =&gt; sub {
                                foreach my $host (@hosts) {
                                        $r-&gt;resolve(
                                                host    =&gt; $host,
                                                service =&gt; "http",
                                                event   =&gt; "got_response",
                                                hints   =&gt; { protocol =&gt; $tcp },
                                        ) or die $!;
                                }
                        },

                        _stop =&gt; sub { print "client session stopped&#92;n" },

                        got_response =&gt; sub {
                                my ($error, $addresses, $request) = @_[ARG0..ARG2];
                                use YAML; print YAML::Dump(
                                        {
                                                error =&gt; $error,
                                                addr =&gt; $addresses,
                                                req =&gt; $request,
                                        }
                                );
                        },
                }
        );

        POE::Kernel-&gt;run();
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>POE::Component::Resolver performs <em>Socket::getaddrinfo()</em> calls in subprocesses where they're permitted to block as long as necessary.</p><p>By default it will run eight subprocesses and prefer address families in whatever order <em>getaddrinfo()</em> returns them.  These defaults can be overridden with constructor parameters.  <em>getaddrinfo()</em> delegates to the operating system's resolver, which may be reconfigured according to the usual conventions.</p><h3>\s-1PUBLIC\s0 \s-1METHODS\s0</h3>
<p><em>new</em></p><p>Create a new resolver.  Returns an object that must be held and used to make requests.  See the synopsis.</p><p>Accepts up to four optional named parameters.</p><p>\*(L"af_order\*(R" may contain an arrayref with the address families to permit, in the order in which they're preferred.  Without \*(L"af_order\*(R", the component will prefer IPv4 addresses over IPv6 for legacy compatibility.  This may change in the future as IPv6 gains more widespread acceptance.  See \*(L"\s-1ENVIRONMENT\s0 \s-1VARIABLES\s0\*(R" for a way to override the default without hacking modules.</p><p>        # Prefer IPv6 addresses, but also return IPv4 ones.         my $r1 = POE::Component::Resolver-&gt;new(                 af_order =&gt; [ AF_INET6, AF_INET ]         );</p><p>        # Only return IPv6 addresses,         # or nothing in cases where only IPv4 addresses exist.         my $r2 = POE::Component::Resolver-&gt;new(                 af_order =&gt; [ AF_INET6 ]         );</p><p>\*(L"idle_timeout\*(R" determines how long to keep idle resolver subprocesses before cleaning them up, in seconds.  It defaults to 15.0 seconds.</p><p>\*(L"max_resolvers\*(R" controls the component's parallelism by defining the maximum number of sidecar processes to manage.  It defaults to 8, but fewer or more processes can be configured depending on the resources you have available and the amount of parallelism you require.</p><p>        # One at a time, but without the pesky blocking.         my $r3 = POE::Component::Resolver-&gt;new( max_resolvers =&gt; 1 );</p><p>\*(L"sidecar_program\*(R" contains the disk location of a program that will perform blocking lookups on standard input and print the results on standard output.  The sidecar program is needed only in special environments where the bundling and execution of extra utilities is tricky.  \s-1PAR\s0 is one such environment.</p><p>The sidecar program needs to contain at least two statements:</p><p>        use POE::Component::Resolver::Sidecar;         POE::Component::Resover::Sidecar-&gt;main();</p><p><em>resolve</em></p><p><em>resolve()</em> begins a new request to resolve a domain.  The request will be enqueued in the component until a sidecar process can service it. <em>resolve()</em> returns a request \s-1ID\s0 that may be used to <em>cancel()</em> a request before it has completed (or undef if the request couldn't begin, such as during shutdown).  Resolve requires two parameters and accepts some additional optional ones.</p><p>\*(L"host\*(R" and \*(L"service\*(R" are required and contain the host (name or Internet address) and service (name or numeric port) that will be passed verbatim to <em>getaddrinfo()</em>.  See Socket for details.</p><p>\*(L"event\*(R" is optional; it contains the name of the event that will contain the resolver response.  If omitted, it will default to \*(L"resolver_response\*(R"; you may want to specify a shorter event name.</p><p>\*(L"hints\*(R" is optional.  If specified, it must contain a hashref of hints exactly as <em>getaddrinfo()</em> expects them.  See Socket for details.</p><p>\*(L"misc\*(R" is optional continuation data that will be passed back in the response.  It may contain any type of data the application requires.</p><p><em>cancel</em></p><p>Cancel a request, given the request's \s-1ID\s0.</p><p>        my $request_id = $resolver-&gt;resolve("poe.dyndns.org", "http");         $resolver-&gt;cancel($request_id);</p><p><em>shutdown</em></p><p>Shut down the resolver.  POE::Component::Resolver retains resources including child processes for up to \*(L"idle_timeout\*(R" seconds.  This may keep programs running up to \*(L"idle_timeout\*(R" seconds longer than they should.</p><p>POE::Component::Resolver will release its resources (including child processes) when its <em>shutdown()</em> method is called.</p><p><em>unpack_addr</em></p><p>In scalar context, unpack_addr($response_addr_hashref) returns the addr element of $response_addr_hashref in a numeric form appropriate for the address family of the address.</p><p>        sub handle_resolver_response {                 my ($error, $addresses, $request) = @_[ARG0..ARG2];</p><p>                foreach my $a (@$addresses) {                         my $numeric_addr = $resolver-&gt;unpack_addr($a);                         print "$request-&gt;{host} = $numeric_addr&#92;n";                 }         }</p><p>In list context, it returns the numeric port and address.</p><p>        sub handle_resolver_response {                 my ($error, $addresses, $request) = @_[ARG0..ARG2];</p><p>                foreach my $a (@$addresses) {                         my ($$numeric_addr, $port) = $resolver-&gt;unpack_addr($a);                         print "$request-&gt;{host} = $numeric_addr&#92;n";                 }         }</p><p><em>unpack_addr()</em> is a convenience wrapper around <em>getnameinfo()</em> from Socket.  You're certainly welcome to use the discrete function instead.</p><p><em>unpack_addr()</em> returns bleak emptiness on failure, regardless of context.  You can check for undef return.</p>
<h3>\s-1PUBLIC\s0 \s-1EVENTS\s0</h3>
<p><em>resolver_response</em></p><p>The resolver response event includes three parameters.</p><p>$_[\s-1ARG0\s0] and $_[\s-1ARG1\s0] contain the retrn values from Socket's <em>getaddrinfo()</em> call.  These are an error message (if the call failed), and an arrayref of address structures if the call succeeded.</p><p>The component provides its own error message, 'component shut down'. This response is given for every pending request at the time the user shuts down the component.</p><p>$_[\s-1ARG2\s0] contains a hashref of information provided to the <em>resolve()</em> method.  Specifically, the values of <em>resolve()</em>'s \*(L"host\*(R", \*(L"service\*(R" and \*(L"misc\*(R" parameters.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">
<h3>\s-1POCO_RESOLVER_IPV\s0</h3>
<p>The \s-1POCO_RESOLVER_IPV\s0 environment variable sets this component's default Internet Protocol Version search order.  If the variable exists, it should contain a string with the numbers 4 and/or 6. POE::Component::Resolver will treate these as Internet Protocol versions to consider, in the order they are preferred.</p><p>POE::Component::Resolver's <em>new()</em> method accepts an \*(L"af_order\*(R" parameter that overrides this environment variable.</p><p>Default to IPv4 addresses only:</p><p>        export POCO_RESOLVER_IPV=4</p><p>Default to IPv6 addresses only:</p><p>        export POCO_RESOLVER_IPV=6</p><p>Prefer IPv6, but accept IPv4 if needed:</p><p>        export POCO_RESOLVER_IPV=64</p><p>Prefer IPv4, but accept IPv6 if needed:</p><p>        export POCO_RESOLVER_IPV=46</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPATIBILITY ISSUES</h2>
        <div class="sectioncontent">
<h3>Microsoft Windows</h3>
<p>This module requires \*(L"Microsoft \s-1TCP/IP\s0 version 6\*(R" to be installed. Steps for Windows \s-1XP\s0 Pro (the steps for your particular version of Windows may be subtly or drastically different):</p><ul>
<li><p>Open your Control Panel</p></li><li><p>Open your Network Connections</p></li><li><p>Select your network connection from the available one(s)</p></li><li><p>In the Local Area Connection Status dialog, click the Properties button</p></li><li><p>If \*(L"Microsoft \s-1TCP/IP\s0 version 6\*(R" is listed as an item being used, you are done.</p></li><li><p>Otherwise click Install...</p></li><li><p>Choose to add a Protocol</p></li><li><p>And install \*(L"Microsoft \s-1TCP/IP\s0 version 6\*(R" from the list of network protocols.</p></li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>There is no timeout on requests.</p><p>There is no way to cancel a pending request.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TROUBLESHOOTING</h2>
        <div class="sectioncontent">
<h3>programs linger for several seconds before exiting</h3>
<p>Programs should <em>shutdown()</em> their POE::Component::Resolver objects when they are through needing asynchronous \s-1DNS\s0 resolution.  Programs should additionally destroy their resolvers if they intend to run awhile and want to reuse the memory they consume.</p><p>In some cases, it may be necessary to shutdown components that perform asynchronous \s-1DNS\s0 using POE::Component::Resolver... such as POE::Component::IRC, POE::Component::Client::Keepalive and POE::Component::Client::HTTP.</p><p>By default, the resolver subprocesses hang around for idle_timeout, which defaults to 15.0 seconds.  Destroying the Resolver object will clean up the process pool.  Assuming only that is keeping the event loop active, the program will then exit cleanly.</p><p>Alternatively, reduce idle_timeout to a more manageable number, such as 5.0 seconds.</p><p>Otherwise something else may also be keeping the event loop active.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>Except where otherwise noted, this distribution is Copyright 2011 by Rocco Caputo.  All rights reserved.  This distribution is free software; you may redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="POE::Component::PubSub.3pm.html"><span aria-hidden="true">&larr;</span> POE::Component::PubSub.3pm: A generic publish/subscribe poe::component that enables poe::sessions to publish events to which other poe::sessions may subscribe.</a></li>
   <li class="next"><a href="POE::Component::Resolver::Sidecar.3pm.html">POE::Component::Resolver::Sidecar.3pm: Delegate subprocess to call getaddrinfo() <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
