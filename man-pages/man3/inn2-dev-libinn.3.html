<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libinn: Internetnews library routines</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Internetnews library routines">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libinn (3) manual">
  <meta name="twitter:description" content="Internetnews library routines">
  <meta name="twitter:image" content="https://www.carta.tech/images/inn2-dev-libinn-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/inn2-dev-libinn.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libinn (3) manual" />
  <meta property="og:description" content="Internetnews library routines" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/inn2-dev-libinn-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libinn<small> (3)</small></h1>
        <p class="lead">Internetnews library routines</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libinn.3.html">
      <span itemprop="name">libinn: Internetnews library routines</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/inn2-dev/">
      <span itemprop="name">inn2-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libinn.3.html">
      <span itemprop="name">libinn: Internetnews library routines</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong></strong>
#include "inn/libinn.h"

<strong>char *</strong>
<strong>GenerateMessageID(domain)</strong>
<strong>    char    *domain;</strong>

<strong>void</strong>
<strong>HeaderCleanFrom(from)</strong>
<strong>    char	*from;</strong>

<strong>char *</strong>
<strong>HeaderFind(Article, Header, size)</strong>
<strong>    char	*Article;</strong>
<strong>    char	*Header;</strong>
<strong>    int	size;</strong>

<strong>FILE *</strong>
<strong>CAopen(FromServer, ToServer)</strong>
<strong>    FILE	*FromServer;</strong>
<strong>    FILE	*ToServer;</strong>

<strong>FILE *</strong>
<strong>CAlistopen(FromServer, ToServer, request)</strong>
<strong>    FILE	*FromServer;</strong>
<strong>    FILE	*ToServer;</strong>
<strong>    char	*request;</strong>

<strong>void</strong>
<strong>CAclose()</strong>

<strong>struct _DDHANDLE *</strong>
<strong>DDstart(FromServer, ToServer)</strong>
<strong>    FILE	*FromServer;</strong>
<strong>    FILE	*ToServer;</strong>

<strong>void</strong>
<strong>DDcheck(h, group)</strong>
<strong>    DDHANDLE	*h;</strong>
<strong>    char	*group;</strong>

<strong>char *</strong>
<strong>DDend(h)</strong>
<strong>    DDHANDLE	*h;</strong>

<strong>void</strong>
<strong>close_on_exec(fd, flag)</strong>
<strong>    int	fd;</strong>
<strong>    bool	flag;</strong>

<strong>int</strong>
<strong>nonblocking(fd, flag)</strong>
<strong>    int	fd;</strong>
<strong>    bool	flag;</strong>

<strong>bool</strong>
<strong>inn_lock_file(fd, type, flag)</strong>
<strong>    int	fd;</strong>
<strong>    LOCKTYPE	type;</strong>
<strong>    bool	block;</strong>

<strong>char *</strong>
<strong>GetFQDN(domain)</strong>
<strong>    char    *domain;</strong>

<strong>char *</strong>
<strong>GetModeratorAddress(FromServer, ToServer, group, moderatormailer)</strong>
<strong>    FILE	*FromServer;</strong>
<strong>    FILE	*ToServer;</strong>
<strong>    char	*group;</strong>
<strong>    char	*moderatormailer;</strong>

<strong>int</strong>
<strong>GetResourceUsage(usertime, systime)</strong>
<strong>    double	*usertime;</strong>
<strong>    double	*systime;</strong>

<strong>int</strong>
<strong>NNTPlocalopen(FromServerp, ToServerp, errbuff, len)</strong>
<strong>    FILE	**FromServerp;</strong>
<strong>    FILE	**ToServerp;</strong>
<strong>    char	*errbuff;</strong>
<strong>    size_t  len;</strong>

<strong>int</strong>
<strong>NNTPremoteopen(port, FromServerp, ToServerp, errbuff, len)</strong>
<strong>    int	port;</strong>
<strong>    FILE	**FromServerp;</strong>
<strong>    FILE	**ToServerp;</strong>
<strong>    char	*errbuff;</strong>
<strong>    size_t  len;</strong>

<strong>int</strong>
<strong>NNTPconnect(host, port, FromServerp, ToServerp, errbuff, len)</strong>
<strong>    char	*host;</strong>
<strong>    int	port;</strong>
<strong>    FILE	**FromServerp;</strong>
<strong>    FILE	**ToServerp;</strong>
<strong>    char	*errbuff;</strong>
<strong>    size_t  len;</strong>

<strong>int</strong>
<strong>NNTPsendarticle(text, ToServer, Terminate)</strong>
<strong>    char	*text;</strong>
<strong>    FILE	*ToServer;</strong>
<strong>    int	Terminate;</strong>

<strong>int</strong>
<strong>NNTPsendpassword(server, FromServer, ToServer)</strong>
<strong>    char	*server;</strong>
<strong>    FILE	*FromServer;</strong>
<strong>    FILE	*ToServer;</strong>

<strong>void</strong>
<strong>Radix32(value, p)</strong>
<strong>    unsigned long	value;</strong>
<strong>    char	*p;</strong>

<strong>char *</strong>
<strong>ReadInFile(name, Sbp)</strong>
<strong>    char	*name;</strong>
<strong>    struct stat	*Sbp;</strong>

<strong>char *</strong>
<strong>ReadInDescriptor(fd, Sbp)</strong>
<strong>    int	fd;</strong>
<strong>    struct stat	*Sbp;</strong>

<strong>HASH</strong>
<strong>HashMessageID(MessageID)</strong>
<strong>    const char *MessageID;</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Libinn</em> is a library of utility routines for manipulating Usenet articles and related data.</p><p><em>GenerateMessageID</em> uses the current time, process-ID, and fully-qualified domain name, which is passed as an argument and used if local host can not be resolved or it is different from ``domain'' set in <em>inn.conf</em>, to create a Message-ID header that is highly likely to be unique. The returned value points to static space that is reused on subsequent calls.</p><p><em>HeaderCleanFrom</em> removes the extraneous information from the value of a ``From'' or ``Reply-To'' header and leaves just the official mailing address. In particular, the following transformations are made to the <em>from</em> parameter:</p>
<pre>
address	--&gt;  address
address (stuff)	--&gt;  address
stuff &lt;address&gt;	--&gt;  address
</pre>
<p>The transformations are simple, based on RFC&nbsp;5536 which limits the format of the header.</p><p><em>HeaderFind</em> searches through <em>Article</em> looking for the specified <em>Header</em>. <em>Size</em> should be the length of the header name. It returns a pointer to the value of the header, skipping leading whitespace, or NULL if the header cannot be found. <em>Article</em> should be a standard C string containing the text of the article; the end of the headers is indicated by a blank line &ndash; two consecutive &#92;n characters.</p><p><em>CAopen</em> and <em>CAclose</em> provide news clients with access to the active file; the ``CA'' stands for <em>C</em>lient <em>A</em>ctive. <em>CAopen</em> opens the <em>active</em> file for reading. It returns a pointer to an open FILE, or NULL on error. If a local or NFS-mounted copy exists, <em>CAopen</em> will use that file. The <em>FromServer</em> and <em>ToServer</em> parameters should be FILE's connected to the NNTP server for input and output, respectively. See <em>NNTPremoteopen</em> or <em>NNTPlocalopen</em>, below. If either parameter is NULL, then <em>CAopen</em> will just return NULL if the file is not locally available. If they are not NULL, <em>CAopen</em> will use them to query the NNTP server using the ``list'' command to make a local temporary copy.</p><p>The <em>CAlistopen</em> sends a ``list'' command to the server and returns a temporary file containing the results. The <em>request</em> parameter, if not NULL, will be sent as an argument to the command. Unlike <em>CAopen</em>, this routine will never use a locally-available copy of the active file.</p><p><em>CAclose</em> closes the active file and removes any temporary file that might have been created by <em>CAopen</em> or <em>CAlistopen</em>.</p><p><em>CloseOnExec</em> can make a descriptor ``close-on-exec'' so that it is not shared with any child processes. If the flag is non-zero, the file is so marked; if zero, the ``close-on-exec'' mode is cleared.</p><p><em>DDstart</em>, <em>DDcheck</em>, and <em>DDend</em> are used to set the Distribution header; the ``DD'' stands for <em>D</em>efault <em>D</em>istribution. The <em>distrib.pats</em> file is consulted to determine the proper value for the Distribution header after all newsgroups have been checked. <em>DDstart</em> begins the parsing. It returns a pointer to an opaque handle that should be used on subsequent calls. The <em>FromServer</em> and <em>ToServer</em> parameters should be FILE's connected to the NNTP server for input and output, respectively. If either parameter is NULL, then an empty default will ultimately be returned if the file is not locally available.</p><p><em>DDcheck</em> should be called with the handle, <em>h</em>, returned by <em>DDstart</em> and a newgroups, <em>group</em>, to check. It can be called as often as necessary.</p><p><em>DDend</em> releases any state maintained in the handle and returns an allocated copy of the text that should be used for the Distribution header.</p><p><em>SetNonBlocking</em> enables (if <em>flag</em> is non-zero) or disables (if <em>flag</em> is zero) non-blocking I/O on the indicated descriptor. It returns -1 on failure or zero on success.</p><p><em>inn_lock_file</em> tries to lock the file descriptor <em>fd</em>. If <em>block</em> is true it will block until the lock can be made, otherwise it will return false if the file cannot be locked. <em>type</em> is one of: INN_LOCK_READ, INN_LOCK_WRITE, or INN_LOCK_UNLOCK. It returns false on failure or true on success.</p><p><em>GetFQDN</em> returns the fully-qualified domain name of the local host. <em>Domain</em> is used if local host can not be resolved. The returned value points to static space that is reused on subsequent calls, or NULL on error.</p><p><em>GetModeratorAddress</em> returns the mailing address of the moderator for specified <em>group</em> or NULL on error. <em>Moderatormailer</em> is used as its address, if there is no matched moderator. See <a href="../man5/moderators.5.html"><strong>moderators</strong>(5)</a> for details on how the address is determined. <em>GetModeratorAddress</em> does no checking to see if the specified group is actually moderated. The returned value points to static space that is reused on subsequent calls. The <em>FromServer</em> and <em>ToServer</em> parameters should be FILE's connected to the NNTP server for input and output, respectively.  If either of these parameters is NULL, then an attempt to get the list from a local copy is made.</p><p><em>GetResourceUsage</em> fills in the <em>usertime</em> and <em>systime</em> parameters with the total user and system time used by the current process and any children it may have spawned. If <em>&lt;HAVE_GETRUSAGE in include/config.h&gt;</em> is defined, it gets the values by doing a <a href="../man2/getrusage.2.html"><strong>getrusage</strong>(2)</a> system call; otherwise it calls <a href="../man2/times.2.html"><strong>times</strong>(2)</a>. It returns -1 on failure, or zero on success.</p><p><em>NNTPlocalopen</em> opens a connection to the private port of an InterNetNews server running on the local host, if <em>&lt;HAVE_UNIX_DOMAIN_SOCKETS in include/config.h&gt;</em> is defined. It returns -1 on failure, or zero on success. <em>FromServerp</em> and <em>ToServerp</em> will be filled in with FILE's which can be used to communicate with the server. <em>Errbuff</em> can either be NULL or a pointer to a buffer at least 512 bytes long. If not NULL, and the server refuses the connection, then it will be filled in with the text of the server's reply. <em>Len</em> should be the length of the buffer. This routine is not for general use. If <em>&lt;HAVE_UNIX_DOMAIN_SOCKETS in include/config.h&gt;</em> is not defined, this is a stub routine, for compatibility with systems that have Unix-domain stream sockets. It always returns -1.</p><p><em>NNTPremoteopen</em> does the same except that it uses ``innconf-&gt;server'' as the local server, and opens a connection to the <em>port</em>. Any client program can use this routine. It returns -1 on failure, or zero on success.</p><p><em>NNTPconnect</em> is the same as <em>NNTPremoteopen</em> except that the desired host is given as the <em>host</em> parameter.</p><p><em>NNTPsendarticle</em> writes <em>text</em> on <em>ToServer</em> using NNTP conventions for line termination. The text should consist of one or more lines ending with a newline. If <em>Terminate</em> is non-zero, then the routine will also write the NNTP data-termination marker on the stream. It returns -1 on failure, or zero on success.</p><p><em>NNTPsendpassword</em> sends authentication information to an NNTP server by finding the appropriate entry in the <em>passwd.nntp</em> file. <em>Server</em> contains the name of the host; ``innconf-&gt;server'' will be used if <em>server</em> is NULL. <em>FromServer</em> and <em>ToServer</em> should be FILE's that are connected to the server. No action is taken if the specified host is not listed in the password file.</p><p><em>Radix32</em> converts the number in <em>value</em> into a radix-32 string into the buffer pointed to by <em>p</em>. The number is split into five-bit pieces and each pieces is converted into a character using the alphabet <em>0..9a..v</em> to represent the numbers 0..32. Only the lowest 32 bits of <em>value</em> are used, so <em>p</em> need only point to a buffer of eight bytes (seven characters and the trailing &#92;0).</p><p><em>ReadInFile</em> reads the file named <em>name</em> into allocated memory, appending a terminating &#92;0 byte. It returns a pointer to the space, or NULL on error. If <em>Sbp</em> is not NULL, it is taken as the address of a place to store the results of a <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> call.</p><p><em>ReadInDescriptor</em> performs the same function as <em>ReadInFile</em> except that <em>fd</em> refers to an already-open file.</p><p><em>HashMessageID</em> returns hashed message-id using MD5.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">

<pre>
char	*p;
char	*Article;
char	buff[256], errbuff[256];
FILE	*F;
FILE	*ToServer;
FILE	*FromServer;
int	port = 119;

if ((p = HeaderFind(Article, "From", 4)) == NULL)
    Fatal("Can't find From line");
(void)strcpy(buff, p);
HeaderCleanFrom(buff);

if ((F = CAopen(FromServer, ToServer)) == NULL)
    Fatal("Can't open active file");

/* Don't pass the file on to our children. */
CloseOnExec(fileno(F), 1);

/* Make a local copy. */
p = ReadInDescriptor(fileno(F), (struct stat *)NULL);

/* Close the file. */
CAclose();

if (NNTPremoteopen(port, &FromServer, &ToServer, errbuff) &lt; 0)
    Fatal("Can't connect to server");

if ((p = GetModeratorAddress("comp.sources.unix")) == NULL)
    Fatal("Can't find moderator's address");
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p>Written by Rich $alz &lt;rsalz@uunet.uu.net&gt; for InterNetNews. This is revision &#92;$3, dated &#92;$4.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO libinn&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/active.5.html"><strong>active</strong>(5)</a>, dbz(3z), <a href="../man5/inn.conf.5.html"><strong>inn.conf</strong>(5)</a>, <a href="../man3/inndcomm.3.html"><strong>inndcomm</strong>(3)</a>, <a href="../man5/moderators.5.html"><strong>moderators</strong>(5)</a>, <a href="../man5/passwd.nntp.5.html"><strong>passwd.nntp</strong>(5)</a>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="inn-libinn.3.html"><span aria-hidden="true">&larr;</span> libinn.3: Internetnews library routines</a></li>
   <li class="next"><a href="libiperf.3.html">libiperf.3: Api for iperf3 network throughput tester <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
