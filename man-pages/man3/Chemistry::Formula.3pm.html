<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chemistry::Formula: Enumerate elements in a chemical formula</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Enumerate elements in a chemical formula">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Chemistry::Formula (3pm) manual">
  <meta name="twitter:description" content="Enumerate elements in a chemical formula">
  <meta name="twitter:image" content="https://www.carta.tech/images/libchemistry-formula-perl-Chemistry::Formula-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Chemistry::Formula.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Chemistry::Formula (3pm) manual" />
  <meta property="og:description" content="Enumerate elements in a chemical formula" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libchemistry-formula-perl-Chemistry::Formula-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Chemistry::Formula<small> (3pm)</small></h1>
        <p class="lead">Enumerate elements in a chemical formula</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Chemistry::Formula.3pm.html">
      <span itemprop="name">Chemistry::Formula: Enumerate elements in a chemical formula</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libchemistry-formula-perl/">
      <span itemprop="name">libchemistry-formula-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Chemistry::Formula.3pm.html">
      <span itemprop="name">Chemistry::Formula: Enumerate elements in a chemical formula</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
   use Chemistry::Formula qw(parse_formula);
   parse_formula(&apos;Pb (H (TiO3)2 )2 U [(H2O)3]2&apos;, &#92;%count);
</pre>
<p>That is obviously not a real compound, but it demonstrates the capabilities of the routine.  This returns</p><p>  %count = (             &apos;O&apos; =&gt; 18,             &apos;H&apos; =&gt; 14,             &apos;Ti&apos; =&gt; 4,             &apos;U&apos; =&gt; 1,             &apos;Pb&apos; =&gt; 1            );</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module provides a function which parses a string containing a chemical formula and returns the number of each element in the string. It can handle nested parentheses and square brackets and correctly computes stoichiometry given numbers outside the (possibly nested) parentheses.</p><p>No effort is made to evaluate the chemical plausibility of the formula.  The example above parses just fine using this module, even though it is clearly not a viable compound.  Charge balancing, bond valence, and so on is beyond the scope of this module.</p><p>Only one function is exported, \*(C`parse_formula\*(C'.  This takes a string and a hash reference as its arguments and returns 0 or 1.</p><p>    $ok = parse_formula(&apos;PbTiO3&apos;, &#92;%count);</p><p>If the formula was parsed without trouble, \*(C`parse_formula\*(C' returns 1. If there was any problem, it returns 0 and $count{error} is filled with a string describing the problem.  It throws an error afer the <strong>first</strong> error encountered without testing the rest of the string.</p><p>If the formula was parsed correctly, the %count hash contains element symbols as its keys and the number of each element as its values.</p><p>Here is an example of a program that reads a string from the command line and, for the formula unit described in the string, writes the weight and absorption in barns.</p><p>    use Data::Dumper;     use Xray::Absorption;     use Chemistry::Formula qw(parse_formula);</p><p>    parse_formula($ARGV[0], &#92;%count);</p><p>    print  Data::Dumper-&gt;Dump([&#92;%count], [qw(*count)]);     my ($weight, $barns) = (0,0);     foreach my $k (keys(%$count)) {       $weight +=         Xray::Absorption -&gt; get_atomic_weight($k) * $count{$k};       $barns  +=         Xray::Absorption -&gt; cross_section($k, 9000) * $count{$k};     };     printf "This weighs %.3f amu and absorbs %.3f barns at 9 keV.&#92;n",       $weight, $barns;</p><p>Pretty simple.</p><p>The parser is not brilliant.  Here are the ground rules:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>Element symbols must be first letter capitalized.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>Whitespace is unimportant \*(-- it will be removed from the string.  So will dollar signs, underscores, and curly braces (in an attempt to handle TeX).  Also a sequence like this: '/sub 3/' will be converted to '3' (in an attempt to handle \s-1INSPEC\s0).</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>Numbers can be integers or floating point numbers.  Things like 5, 0.5, 12.87, and .5 are all acceptible, as is exponential notation like 1e-2.  Note that exponential notation must use a leading number to avoid confusion with element symbols.  That is, 1e-2 is ok, but e-2 is not.</p>
  </dd>
  <dt>
    4.
  </dt>
  <dd>
    <p>Uncapitalized symbols or unrecognized symbols will flag an error.</p>
  </dd>
  <dt>
    5.
  </dt>
  <dd>
    <p>An error will be flagged if the number of open parens is different from the number of close parens.</p>
  </dd>
  <dt>
    6.
  </dt>
  <dd>
    <p>An error will be flagged if any unusual symbols are found in the string.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGMENTS</h2>
        <div class="sectioncontent">
<p>This was written at the suggestion of Matt Newville, who tested early versions.</p><p>The routine \*(C`matchingbrace\*(C' was swiped from the C::Scan module, which can be found on \s-1CPAN\s0.  C::Scan is maintained by Hugo van der Sanden.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Bruce Ravel &lt;bravel \s-1AT\s0 bnl \s-1DOT\s0 gov&gt;</p><p>http://cars9.uchicago.edu/~ravel/software/</p><p>\s-1SVN\s0 repository: http://cars9.uchicago.edu/svn/libperlxray/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Chemistry::Elements.3pm.html"><span aria-hidden="true">&larr;</span> Chemistry::Elements.3pm: Perl extension for working with chemical elements</a></li>
   <li class="next"><a href="CipUX.3pm.html">CipUX.3pm: Common cipux functions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
