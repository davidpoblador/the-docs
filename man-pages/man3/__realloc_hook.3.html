<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>__realloc_hook: Malloc debugging variables</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Malloc debugging variables">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="__realloc_hook (3) manual">
  <meta name="twitter:description" content="Malloc debugging variables">
  <meta name="twitter:image" content="https://www.carta.tech/images/manpages-dev-__realloc_hook-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/__realloc_hook.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="__realloc_hook (3) manual" />
  <meta property="og:description" content="Malloc debugging variables" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/manpages-dev-__realloc_hook-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">__realloc_hook<small> (3)</small></h1>
        <p class="lead">Malloc debugging variables</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/__realloc_hook.3.html">
      <span itemprop="name">__realloc_hook: Malloc debugging variables</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/manpages-dev/">
      <span itemprop="name">manpages-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/__realloc_hook.3.html">
      <span itemprop="name">__realloc_hook: Malloc debugging variables</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include &lt;malloc.h&gt;</strong>

<strong>void *(*__malloc_hook)(size_t </strong><em>size</em><strong>, const void *</strong><em>caller</em><strong>);</strong>

<strong>void *(*__realloc_hook)(void *</strong><em>ptr</em><strong>, size_t </strong><em>size</em><strong>, const void *</strong><em>caller</em><strong>);</strong>

<strong>void *(*__memalign_hook)(size_t </strong><em>alignment</em><strong>, size_t </strong><em>size</em><strong>,</strong>
<strong>                         const void *</strong><em>caller</em><strong>);</strong>

<strong>void (*__free_hook)(void *</strong><em>ptr</em><strong>, const void *</strong><em>caller</em><strong>);</strong>

<strong>void (*__malloc_initialize_hook)(void);</strong>

<strong>void (*__after_morecore_hook)(void);</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The GNU C library lets you modify the behavior of <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, <a href="../man3/realloc.3.html"><strong>realloc</strong>(3)</a>, and <a href="../man3/free.3.html"><strong>free</strong>(3)</a> by specifying appropriate hook functions. You can use these hooks to help you debug programs that use dynamic memory allocation, for example.</p><p>The variable <strong>__malloc_initialize_hook</strong> points at a function that is called once when the malloc implementation is initialized. This is a weak variable, so it can be overridden in the application with a definition like the following:</p>
<pre>
    void (*__malloc_initialize_hook)(void) = my_init_hook;

</pre>
<p>Now the function <em>my_init_hook</em>() can do the initialization of all hooks.</p><p>The four functions pointed to by <strong>__malloc_hook</strong>, <strong>__realloc_hook</strong>, <strong>__memalign_hook</strong>, <strong>__free_hook</strong> have a prototype like the functions <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, <a href="../man3/realloc.3.html"><strong>realloc</strong>(3)</a>, <a href="../man3/memalign.3.html"><strong>memalign</strong>(3)</a>, <a href="../man3/free.3.html"><strong>free</strong>(3)</a>, respectively, except that they have a final argument <em>caller</em> that gives the address of the caller of <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, etc.</p><p>The variable <strong>__after_morecore_hook</strong> points at a function that is called each time after <a href="../man2/sbrk.2.html"><strong>sbrk</strong>(2)</a> was asked for more memory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>These functions are GNU extensions.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>The use of these hook functions is not safe in multithreaded programs, and they are now deprecated. Programmers should instead preempt calls to the relevant functions by defining and exporting functions such as "malloc" and "free".</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Here is a short example of how to use these variables.</p>
<pre>
#include &lt;stdio.h&gt;
#include &lt;malloc.h&gt;

/* Prototypes for our hooks.  */
static void my_init_hook(void);
static void *my_malloc_hook(size_t, const void *);

/* Variables to save original hooks. */
static void *(*old_malloc_hook)(size_t, const void *);

/* Override initializing hook from the C library. */
void (*__malloc_initialize_hook) (void) = my_init_hook;

static void
my_init_hook(void)
{
    old_malloc_hook = __malloc_hook;
    __malloc_hook = my_malloc_hook;
}

static void *
my_malloc_hook(size_t size, const void *caller)
{
    void *result;

    /* Restore all old hooks */
    __malloc_hook = old_malloc_hook;

    /* Call recursively */
    result = malloc(size);

    /* Save underlying hooks */
    old_malloc_hook = __malloc_hook;

    /* printf() might call malloc(), so protect it too. */
    printf("malloc(%u) called from %p returns %p&#92;n",
            (unsigned int) size, caller, result);

    /* Restore our own hooks */
    __malloc_hook = my_malloc_hook;

    return result;
}
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO __realloc_hook&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/mallinfo.3.html"><strong>mallinfo</strong>(3)</a>, <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, <a href="../man3/mcheck.3.html"><strong>mcheck</strong>(3)</a>, <a href="../man3/mtrace.3.html"><strong>mtrace</strong>(3)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of release 3.74 of the Linux <em>man-pages</em> project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at http://www.kernel.org/doc/man-pages/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="__pmUnparseHostSpec.3.html"><span aria-hidden="true">&larr;</span> __pmUnparseHostSpec.3: Uniform host specification parser</a></li>
   <li class="next"><a href="__secondtst.f__.3.html">__secondtst.f__.3: Secondtst.f - <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
