<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TIFFcolor: Color conversion routines.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Color conversion routines.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="TIFFcolor (3tiff) manual">
  <meta name="twitter:description" content="Color conversion routines.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtiff5-dev-TIFFcolor-3tiff.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3tiff/TIFFcolor.3tiff.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="TIFFcolor (3tiff) manual" />
  <meta property="og:description" content="Color conversion routines." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtiff5-dev-TIFFcolor-3tiff.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">TIFFcolor<small> (3tiff)</small></h1>
        <p class="lead">Color conversion routines.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tiff/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tiff/TIFFcolor.3tiff.html">
      <span itemprop="name">TIFFcolor: Color conversion routines.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtiff5-dev/">
      <span itemprop="name">libtiff5-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tiff/TIFFcolor.3tiff.html">
      <span itemprop="name">TIFFcolor: Color conversion routines.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;tiffio.h&gt;</strong></p><p><strong>int TIFFYCbCrToRGBInit(TIFFYCbCrToRGB *</strong><em>ycbcr</em><strong>, float *</strong><em>luma</em><strong>, float *</strong><em>refBlackWhite"</em><strong>);"</strong></p><p><strong>void TIFFYCbCrtoRGB(TIFFYCbCrToRGB *</strong><em>ycbcr</em><strong>, uint32 </strong><em>Y</em><strong>, int32 </strong><em>Cb</em><strong>, int32 </strong><em>Cr</em><strong>, uint32 *</strong><em>R</em><strong>, uint32 *</strong><em>G</em><strong>, uint32 *</strong><em>B</em><strong> );</strong></p><p><strong>int TIFFCIELabToRGBInit(TIFFCIELabToRGB *</strong><em>cielab</em><strong>, const TIFFDisplay *</strong><em>display</em><strong>, float *</strong><em>refWhite</em><strong>);</strong></p><p><strong>void TIFFCIELabToXYZ(TIFFCIELabToRGB *</strong><em>cielab</em><strong>, uint32 </strong><em>L</em><strong>, int32 </strong><em>a</em><strong>, int32 </strong><em>b</em><strong>, float *</strong><em>X</em><strong>, float *</strong><em>Y</em><strong>, float *</strong><em>Z</em><strong>);</strong></p><p><strong>void TIFFXYZToRGB(TIFFCIELabToRGB *</strong><em>cielab</em><strong>, float </strong><em>X</em><strong>, float </strong><em>Y</em><strong>, float </strong><em>Z"</em><strong>,</strong><em>uint32</em><strong>*"</strong><em>R</em><strong>, uint32 *</strong><em>G</em><strong>, uint32 *</strong><em>B</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>TIFF supports several color spaces for images stored in that format. There is usually a problem of application to handle the data properly and convert between different colorspaces for displaying and printing purposes. To simplify this task libtiff implements several color conversion routines itself. In particular, these routines used in <strong>TIFFRGBAImage(3TIFF)</strong> interface.</p><p><strong>TIFFYCbCrToRGBInit()</strong> used to initialize <em>YCbCr</em> to <em>RGB</em> conversion state. Allocating and freeing of the <em>ycbcr</em> structure belongs to programmer. <em>TIFFYCbCrToRGB</em> defined in <strong>tiffio.h</strong> as</p>
<pre>
typedef struct {                /* YCbCr-&gt;RGB support */
        TIFFRGBValue* clamptab; /* range clamping table */
        int*	      Cr_r_tab;
        int*	      Cb_b_tab;
        int32*	      Cr_g_tab;
        int32*	      Cb_g_tab;
        int32*        Y_tab;
} TIFFYCbCrToRGB;
</pre>
<p><em>luma</em> is a float array of three values representing proportions of the red, green and blue in luminance, Y (see section 21 of the TIFF 6.0 specification, where the YCbCr images discussed). <em>TIFFTAG_YCBCRCOEFFICIENTS</em> holds that values in TIFF file. <em>refBlackWhite</em> is a float array of 6 values which specifies a pair of headroom and footroom image data values (codes) for each image component (see section 20 of the TIFF 6.0 specification where the colorinmetry fields discussed). <em>TIFFTAG_REFERENCEBLACKWHITE</em> is responsible for storing these values in TIFF file. Following code snippet should helps to understand the the technique:</p>
<pre>
float *luma, *refBlackWhite;
uint16 hs, vs;

/* Initialize structures */
ycbcr = (TIFFYCbCrToRGB*)
	_TIFFmalloc(TIFFroundup(sizeof(TIFFYCbCrToRGB), sizeof(long))
        	+ 4*256*sizeof(TIFFRGBValue)
        	+ 2*256*sizeof(int)
        	+ 3*256*sizeof(int32));
if (ycbcr == NULL) {
        TIFFError("YCbCr-&gt;RGB",
		"No space for YCbCr-&gt;RGB conversion state");
        <strong>exit</strong>(0);
}

TIFFGetFieldDefaulted(tif, TIFFTAG_YCBCRCOEFFICIENTS, &luma);
TIFFGetFieldDefaulted(tif, TIFFTAG_REFERENCEBLACKWHITE, &refBlackWhite);
if (TIFFYCbCrToRGBInit(ycbcr, luma, refBlackWhite) &lt; 0)
	<strong>exit</strong>(0);

/* Start conversion */
uint32 r, g, b;
uint32 Y;
int32 Cb, Cr;

for each pixel in image
	TIFFYCbCrtoRGB(img-&gt;ycbcr, Y, Cb, Cr, &r, &g, &b);

/* Free state structure */
_TIFFfree(ycbcr);
</pre>
<p><strong>TIFFCIELabToRGBInit()</strong> initializes the <em>CIE L*a*b* 1976</em> to <em>RGB</em> conversion state. <strong>TIFFCIELabToRGB</strong> defined as</p>
<pre>
#define CIELABTORGB_TABLE_RANGE 1500

typedef struct {		     /* CIE Lab 1976-&gt;RGB support */
	int	range;		     /* Size of conversion table */
	float	rstep, gstep, bstep;
	float	X0, Y0, Z0;	     /* Reference white point */
	TIFFDisplay display;
	float	Yr2r[CIELABTORGB_TABLE_RANGE + 1]; /* Conversion of Yr to r */
	float	Yg2g[CIELABTORGB_TABLE_RANGE + 1]; /* Conversion of Yg to g */
	float	Yb2b[CIELABTORGB_TABLE_RANGE + 1]; /* Conversion of Yb to b */
} TIFFCIELabToRGB;
</pre>
<p><em>display</em> is a display device description, declared as</p>
<pre>
typedef struct {
	float d_mat[3][3]; /* XYZ -&gt; luminance matrix */
	float d_YCR;       /* Light o/p for reference white */
	float d_YCG;
	float d_YCB;
	uint32 d_Vrwr;     /* Pixel values for ref. white */
	uint32 d_Vrwg;
	uint32 d_Vrwb;
	float d_Y0R;       /* Residual light for black pixel */
	float d_Y0G;
	float d_Y0B;
	float d_gammaR;    /* Gamma values for the three guns */
	float d_gammaG;
	float d_gammaB;
} TIFFDisplay;
</pre>
<p>For example, the one can use sRGB device, which has the following parameters:</p>
<pre>
TIFFDisplay display_sRGB = {
	{       /* XYZ -&gt; luminance matrix */
		{  3.2410F, -1.5374F, -0.4986F },
		{  -0.9692F, 1.8760F, 0.0416F },
		{  0.0556F, -0.2040F, 1.0570F }
	},
	100.0F, 100.0F, 100.0F, /* Light o/p for reference white */
	255, 255, 255,      /* Pixel values for ref. white */
	1.0F, 1.0F, 1.0F,   /* Residual light o/p for black pixel */
	2.4F, 2.4F, 2.4F,   /* Gamma values for the three guns */
};
</pre>
<p><em>refWhite</em> is a color temperature of the reference white. The <em>TIFFTAG_WHITEPOINT</em> contains the chromaticity of the white point of the image from where the reference white can be calculated using following formulae:</p><p>refWhite_Y = 100.0</p><p>refWhite_X = whitePoint_x / whitePoint_y * refWhite_Y</p><p>refWhite_Z = (1.0 - whitePoint_x - whitePoint_y) / whitePoint_y * refWhite_X</p><p>The conversion itself performed in two steps: at the first one we will convert <em>CIE L*a*b* 1976</em> to <em>CIE XYZ</em> using <strong>TIFFCIELabToXYZ()</strong> routine, and at the second step we will convert <em>CIE XYZ</em> to <em>RGB</em> using <strong>TIFFXYZToRGB().</strong> Look at the code sample below:</p>
<pre>
float   *whitePoint;
float   refWhite[3];

/* Initialize structures */
img-&gt;cielab = (TIFFCIELabToRGB *)
	_TIFFmalloc(sizeof(TIFFCIELabToRGB));
if (!cielab) {
	TIFFError("CIE L*a*b*-&gt;RGB",
		"No space for CIE L*a*b*-&gt;RGB conversion state.");
	<strong>exit</strong>(0);
}

TIFFGetFieldDefaulted(tif, TIFFTAG_WHITEPOINT, &whitePoint);
refWhite[1] = 100.0F;
refWhite[0] = whitePoint[0] / whitePoint[1] * refWhite[1];
refWhite[2] = (1.0F - whitePoint[0] - whitePoint[1])
	      / whitePoint[1] * refWhite[1];
if (TIFFCIELabToRGBInit(cielab, &display_sRGB, refWhite) &lt; 0) {
	TIFFError("CIE L*a*b*-&gt;RGB",
		"Failed to initialize CIE L*a*b*-&gt;RGB conversion state.");
	_TIFFfree(cielab);
	<strong>exit</strong>(0);
}

/* Now we can start to convert */
uint32 r, g, b;
uint32 L;
int32 a, b;
float X, Y, Z;

for each pixel in image
	TIFFCIELabToXYZ(cielab, L, a, b, &X, &Y, &Z);
	TIFFXYZToRGB(cielab, X, Y, Z, &r, &g, &b);

/* Don't forget to free the state structure */
_TIFFfree(cielab);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO TIFFcolor&hellip;</h2>
        <div class="sectioncontent">
<p><strong>TIFFRGBAImage</strong>(3TIFF) <strong>libtiff</strong>(3TIFF),</p><p>Libtiff library home page: <strong>http://www.remotesensing.org/libtiff/</strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="TIFFcodec.3tiff.html"><span aria-hidden="true">&larr;</span> TIFFcodec.3tiff: Codec-related utility routines</a></li>
   <li class="next"><a href="TIFFmemory.3tiff.html">TIFFmemory.3tiff: Memory management-related functions for use with tiff files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
