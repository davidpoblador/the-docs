<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cgsi_plugin.h: Header file for the gsi gsoap plugin.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Header file for the gsi gsoap plugin.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cgsi_plugin.h (3) manual">
  <meta name="twitter:description" content="Header file for the gsi gsoap plugin.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcgsi-gsoap-dev-cgsi_plugin.h-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/cgsi_plugin.h.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cgsi_plugin.h (3) manual" />
  <meta property="og:description" content="Header file for the gsi gsoap plugin." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcgsi-gsoap-dev-cgsi_plugin.h-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cgsi_plugin.h<small> (3)</small></h1>
        <p class="lead">Header file for the gsi gsoap plugin.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/cgsi_plugin.h.3.html">
      <span itemprop="name">cgsi_plugin.h: Header file for the gsi gsoap plugin.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcgsi-gsoap-dev/">
      <span itemprop="name">libcgsi-gsoap-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/cgsi_plugin.h.3.html">
      <span itemprop="name">cgsi_plugin.h: Header file for the gsi gsoap plugin.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;stdsoap2.h&gt;</p><h3>Macros</h3>
<p>#define <strong>CGSI_OPT_CLIENT</strong>   0x1</p><p>#define <strong>CGSI_OPT_SERVER</strong>   0x2</p><p>#define <strong>CGSI_OPT_DELEG_FLAG</strong>   0x4</p><p>#define <strong>CGSI_OPT_SSL_COMPATIBLE</strong>   0x8</p><p>#define <strong>CGSI_OPT_DISABLE_NAME_CHECK</strong>   0x10</p><p>#define <strong>CGSI_OPT_KEEP_ALIVE</strong>   0x20</p><p>#define <strong>CGSI_OPT_DISABLE_MAPPING</strong>   0x40</p><p>#define <strong>CGSI_OPT_DISABLE_VOMS_CHECK</strong>   0x80</p><p>#define <strong>CGSI_OPT_ALLOW_ONLY_SELF</strong>   0x100</p>
<h3>Functions</h3>
<p>int <strong>soap_cgsi_init</strong> (struct soap *soap, int cgsi_options)</p><p>int <strong>cgsi_plugin</strong> (struct soap *soap, struct soap_plugin *plugin, void *arg)</p><p>int <strong>client_cgsi_plugin</strong> (struct soap *soap, struct soap_plugin *plugin, void *arg)</p><p>int <strong>server_cgsi_plugin</strong> (struct soap *soap, struct soap_plugin *plugin, void *arg)</p><p>int <strong>is_context_established</strong> (struct soap *soap)</p><p>int <strong>get_client_dn</strong> (struct soap *soap, char *dn, size_t dnlen)</p><p>int <strong>get_client_username</strong> (struct soap *soap, char *username, size_t dnlen)</p><p>int <strong>get_delegated_credentials</strong> (struct soap *soap, void **buffer, size_t *length)</p><p>int <strong>export_delegated_credentials</strong> (struct soap *soap, char *filename)</p><p>int <strong>has_delegated_credentials</strong> (struct soap *soap)</p><p>int <strong>set_default_proxy_file</strong> (struct soap *soap, char *filename)</p><p>void <strong>clear_default_proxy_file</strong> (int unlink_file)</p><p>int <strong>retrieve_voms_creds</strong> (struct soap *soap)</p><p>int <strong>retrieve_userca_and_voms_creds</strong> (struct soap *soap)</p><p>char * <strong>get_client_ca</strong> (struct soap *soap)</p><p>char * <strong>get_client_voname</strong> (struct soap *soap)</p><p>char ** <strong>get_client_roles</strong> (struct soap *soap, int *nbfqans)</p><p>int <strong>cgsi_plugin_set_flags</strong> (struct soap *soap, int is_server, int flags)</p><p>int <strong>cgsi_plugin_clr_flags</strong> (struct soap *soap, int is_server, int flags)</p><p>int <strong>cgsi_plugin_get_flags</strong> (struct soap *soap, int is_server)</p><p>int <strong>cgsi_plugin_set_credentials</strong> (struct soap *soap, int is_server, const char *x509_cert, const char *x509_key)</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Detailed Description</h2>
        <div class="sectioncontent">
<p>Header file for the GSI gSOAP plugin.</p><p><strong>cgsi_plugin.h</strong> - Header file for the GSI gSOAP plugin</p><p><strong>Author:</strong></p><p>Ben Couturier CERN, IT/ADC</p><p>This is a GSI plugin for gSOAP. It uses the globus GSI libraries to implement GSI secure authentification and encryption on top of gSOAP. The globus GSI bundle is necessary for the plugin to compile and run.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Macro Definition Documentation</h2>
        <div class="sectioncontent">
<h3>#define CGSI_OPT_ALLOW_ONLY_SELF   0x100</h3>
<p>Allow client and server to only connect together when they have the same identity</p>
<h3>#define CGSI_OPT_CLIENT   0x1</h3>
<p>Options that can be specified when initializing the cgsi_plugin (in the arg parameter):The program acts as a client.</p>
<h3>#define CGSI_OPT_DELEG_FLAG   0x4</h3>
<p>Initiate delegation over the HTTPG protocol.</p>
<h3>#define CGSI_OPT_DISABLE_MAPPING   0x40</h3>
<p>Disable DN-&gt;userid mapping via gridmap-file.</p>
<h3>#define CGSI_OPT_DISABLE_NAME_CHECK   0x10</h3>
<p>Disable comparing the server's host name with its certificate's CN.</p>
<h3>#define CGSI_OPT_DISABLE_VOMS_CHECK   0x80</h3>
<p>Disable connect time VOMS parsing for better error handling via an explicit call to <strong>retrieve_voms_creds()</strong></p>
<h3>#define CGSI_OPT_KEEP_ALIVE   0x20</h3>
<p>Keep alive the HTTP connection.</p>
<h3>#define CGSI_OPT_SERVER   0x2</h3>
<p>The program acts as a server.</p>
<h3>#define CGSI_OPT_SSL_COMPATIBLE   0x8</h3>
<p>Using pure SSL protocol, for compatibility.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Function Documentation</h2>
        <div class="sectioncontent">
<h3>int cgsi_plugin (struct soap *soap, struct soap_plugin *plugin, void *arg)</h3>
<p>Generic contructor for the cgsi_plugin</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>plugin</em> Pointer to the plugin data structure</p><p><em>arg</em> The parameters for the plugin creation</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>int cgsi_plugin_clr_flags (struct soap *soap, intis_server, intflags)</h3>
<p>Adjust CGSI-plugin's behaviour by clearing one or more flags. If a flag is not present in args then it is unaffected by this operation. If a flag is currently cleared then attempting to clear it will have no effect.</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure from gSOAP</p><p><em>is_server</em> 0 if client, 1 if server</p><p><em>flags</em> Bitwise OR of the flags to be cleared.</p><p><strong>Returns:</strong></p><p>0 on success, -1 on error.</p>
<h3>int cgsi_plugin_get_flags (struct soap *soap, intis_server)</h3>
<p>Discover the current set of flags that are in effect.</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure from gSOAP</p><p><em>is_server</em> 0 if client, 1 if server</p><p><strong>Returns:</strong></p><p>the set of flags or -1 on error</p>
<h3>int cgsi_plugin_set_credentials (struct soap *soap, intis_server, const char *x509_cert, const char *x509_key)</h3>
<p>Set credentials without using environment variables</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>is_server</em> 0 if client, 1 if server</p><p><em>x509_cert</em> The certificate. If it is a proxy, you only need to specify this one</p><p><em>x509_key</em> The key. Will be ignored if x509_cert is NULL!</p><p><strong>Returns:</strong></p><p>0 on success, -1 on error.</p>
<h3>int cgsi_plugin_set_flags (struct soap *soap, intis_server, intflags)</h3>
<p>Adjust CGSI-plugin's behaviour by setting one or more flags. If a flag is not present in args then that flag is unaffected by this operation. If a flag is currently set then attempting to set it will have no effect.</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure from gSOAP</p><p><em>is_server</em> 0 if client, 1 if server</p><p><em>flags</em> Bitwise OR of the flags to be set.</p><p><strong>Returns:</strong></p><p>0 on success, -1 on error.</p>
<h3>void clear_default_proxy_file (intunlink_file)</h3>
<p>Clears the env variable used by GSI to specify the proxy filename</p><p><strong>Parameters:</strong></p><p><em>unlink_file</em> Set to 1 if you want to destroy the credential file as well</p>
<h3>int client_cgsi_plugin (struct soap *soap, struct soap_plugin *plugin, void *arg)</h3>
<p>Client contructor for the cgsi_plugin</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>plugin</em> Pointer to the plugin data structure</p><p><em>arg</em> The parameters for the plugin creation (CGSI_OPT_CLIENT assumed)</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>int export_delegated_credentials (struct soap *soap, char *filename)</h3>
<p>Export the delegated credentials (if available) to a file</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>filename</em> Name of the file where the credentials are to be written</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>char* get_client_ca (struct soap *soap)</h3>
<p>Returns the client CA</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><strong>Returns:</strong></p><p>The client CA is allocated in the soap structure (DON'T free), NULL otherwise</p>
<h3>int get_client_dn (struct soap *soap, char *dn, size_tdnlen)</h3>
<p>Gets the Distinguished name (DN) of the client</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>dn</em> Pointer to a buffer where the DN is to be written</p><p><em>dnlen</em> The length of the buffer</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>char** get_client_roles (struct soap *soap, int *nbfqans)</h3>
<p>Returns the client VO roles if they were provided in the certificate</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>nbfqans</em> The number of returned Fully Qualified Attribute Names</p><p><strong>Returns:</strong></p><p>The client roles are malloced in the soap structure (DON'T free), NULL otherwise</p>
<h3>int get_client_username (struct soap *soap, char *username, size_tdnlen)</h3>
<p>Gets the username (DN) of the client</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>username</em> Pointer to a buffer where the username is to be written</p><p><em>dnlen</em> The length of the buffer</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>char* get_client_voname (struct soap *soap)</h3>
<p>Returns the client VO name if it was provided in the certificate</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><strong>Returns:</strong></p><p>The client voname is malloced in the soap structure (DON'T free), NULL otherwise</p>
<h3>int get_delegated_credentials (struct soap *soap, void **buffer, size_t *length)</h3>
<p>Make the delegated credential available as a token in memory. The soap structure retains ownership of the memory. The user should not free the pointer returned by this function, nor use it after the soap object becomes invalid.</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure that is the target of the request</p><p><em>buffer</em> Pointer to a void pointer which will be set to reference the credential token.</p><p><em>length</em> Pointer to a length that will be set to the size of the credential token</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>int has_delegated_credentials (struct soap *soap)</h3>
<p>Checks whether the client delegated credentials to the server</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><strong>Returns:</strong></p><p>1 if there are some delegated credentials, 0 otherwise</p>
<h3>int is_context_established (struct soap *soap)</h3>
<p>Checks whether the security context has been established properly</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><strong>Returns:</strong></p><p>1 if context established, 0 otherwise</p>
<h3>int retrieve_userca_and_voms_creds (struct soap *soap)</h3>

<h3>int retrieve_voms_creds (struct soap *soap)</h3>
<p>Parses the optional VOMS extension of the peer certificate. It has to be called before <strong>get_client_voname()</strong> and <strong>get_client_roles()</strong>!</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise SOAP Fault structure contains the detailed description.</p>
<h3>int server_cgsi_plugin (struct soap *soap, struct soap_plugin *plugin, void *arg)</h3>
<p>Server contructor for the cgsi_plugin</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>plugin</em> Pointer to the plugin data structure</p><p><em>arg</em> The parameters for the plugin creation (CGSI_OPT_SERVER assumed)</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>int set_default_proxy_file (struct soap *soap, char *filename)</h3>
<p>Sets the env variable for GSI to use the proxy in the specified filename</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>filename</em> Name of the file where credentials are stored</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>
<h3>int soap_cgsi_init (struct soap *soap, intcgsi_options)</h3>
<p>Helper function to create the gsoap object and the cgsi_plugin at the same time. This function assumes that a client plugin is specified, to create a server plugin, use the CGSI_OPT_SERVER option.</p><p><strong>Parameters:</strong></p><p><em>soap</em> The soap structure for the request</p><p><em>cgsi_options</em> The parameters for the plugin creation (bitwise or of the different options).</p><p><strong>Returns:</strong></p><p>0 if successful, -1 otherwise</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for CGSI_gSOAP from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cgraph.3.html"><span aria-hidden="true">&larr;</span> cgraph.3: Abstract graph library</a></li>
   <li class="next"><a href="cgtcon.3.html">cgtcon.3: Cgtcon.f - <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
