<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Makefile::DOM: Simple dom parser for makefiles</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Simple dom parser for makefiles">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Makefile::DOM (3pm) manual">
  <meta name="twitter:description" content="Simple dom parser for makefiles">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmakefile-dom-perl-Makefile::DOM-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Makefile::DOM.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Makefile::DOM (3pm) manual" />
  <meta property="og:description" content="Simple dom parser for makefiles" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmakefile-dom-perl-Makefile::DOM-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Makefile::DOM<small> (3pm)</small></h1>
        <p class="lead">Simple dom parser for makefiles</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Makefile::DOM.3pm.html">
      <span itemprop="name">Makefile::DOM: Simple dom parser for makefiles</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmakefile-dom-perl/">
      <span itemprop="name">libmakefile-dom-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Makefile::DOM.3pm.html">
      <span itemprop="name">Makefile::DOM: Simple dom parser for makefiles</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>This document describes Makefile::DOM 0.006 released on 28 August 2011.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This library can serve as an advanced lexer for (\s-1GNU\s0) makefiles. It parses makefiles as \*(L"documents\*(R" and the parsing is lossless. The results are data structures similar to \s-1DOM\s0 trees. The \s-1DOM\s0 trees hold every single bit of the information in the original input files, including white spaces, blank lines and makefile comments. That means it's possible to reproduce the original makefiles from the \s-1DOM\s0 trees. In addition, each node of the \s-1DOM\s0 trees is modifiable and so is the whole tree, just like the \s-1PPI\s0 module used for Perl source parsing and the HTML::TreeBuilder module used for parsing \s-1HTML\s0 source.</p><p>If you're looking for a true \s-1GNU\s0 make parser that generates an \s-1AST\s0, please see Makefile::Parser::GmakeDB instead.</p><p>The interface of \*(C`Makefile::DOM\*(C' mimics the \s-1API\s0 design of \s-1PPI\s0. In fact, I've directly stolen the source code and \s-1POD\s0 documentation of PPI::Node, PPI::Element, and PPI::Dumper, with the full permission from the author of \s-1PPI\s0, Adam Kennedy.</p><p>\*(C`Makefile::DOM\*(C' tries to be independent of specific makefile's syntax. The same set of \s-1DOM\s0 node types is supposed to get shared by different makefile \s-1DOM\s0 generators. For example, MDOM::Document::Gmake parses \s-1GNU\s0 makefiles and returns an instance of MDOM::Document, i.e., the root of the \s-1DOM\s0 tree while the \s-1NMAKE\s0 makefile lexer in the future, \*(C`MDOM::Document::Nmake\*(C', also returns instances of the MDOM::Document class. Later, I'll also consider adding support for dmake and bsdmake.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Structure of the DOM</h2>
        <div class="sectioncontent">
<p>Makefile \s-1DOM\s0 (\s-1MDOM\s0) is a structured set of a series of data types. They provide a flexible document model conformed to the makefile syntax. Below is a complete list of the 19 \s-1MDOM\s0 classes in the current implementation where the indentation indicates the class inheritance relationships.</p>
<pre>
    MDOM::Element
        MDOM::Node
            MDOM::Unknown
            MDOM::Assignment
            MDOM::Command
            MDOM::Directive
            MDOM::Document
                MDOM::Document::Gmake
            MDOM::Rule
                MDOM::Rule::Simple
                MDOM::Rule::StaticPattern
        MDOM::Token
            MDOM::Token::Bare
            MDOM::Token::Comment
            MDOM::Token::Continuation
            MDOM::Token::Interpolation
            MDOM::Token::Modifier
            MDOM::Token::Separator
            MDOM::Token::Whitespace
</pre>
<p>It's not hard to see that all of the \s-1MDOM\s0 classes inherit from the MDOM::Element class. MDOM::Token and MDOM::Node are its direct children. The former represents a string token which is atomic from the perspective of the lexer while the latter represents a structured node, which usually has one or more children, and serves as the container for other DOM::Element objects.</p><p>Next we'll show a few examples to demonstrate how to map \s-1DOM\s0 trees to particular makefiles.</p>
<dl class='dl-vertical'>
  <dt>
    Case 1
  </dt>
  <dd>
    <p>Consider the following simple \*(L"hello, world\*(R" makefile:     all : ; echo "hello, world" We can use the MDOM::Dumper class provided by Makefile::DOM to dump out the internal structure of its corresponding \s-1MDOM\s0 tree:     MDOM::Document::Gmake       MDOM::Rule::Simple         MDOM::Token::Bare         &apos;all&apos;         MDOM::Token::Whitespace   &apos; &apos;         MDOM::Token::Separator    &apos;:&apos;         MDOM::Token::Whitespace   &apos; &apos;         MDOM::Command           MDOM::Token::Separator    &apos;;&apos;           MDOM::Token::Whitespace   &apos; &apos;           MDOM::Token::Bare         &apos;echo "hello, world"&apos;           MDOM::Token::Whitespace   &apos;&#92;n&apos; In this example, speparators \*(C`:\*(C' and \*(C`;\*(C' are all instances of the MDOM::Token::Separator class while spaces and new line characters are all represented as MDOM::Token::Whitespace. The other two leaf nodes, \*(C`all\*(C' and \*(C`echo "hello, world"\*(C' both belong to MDOM::Token::Bare. It's worth mentioning that, the space characters in the rule command \*(C`echo "hello, world"\*(C' were not represented as MDOM::Token::Whitespace. That's because in makefiles, the spaces in commands do not make any sense to \*(C`make\*(C' in syntax; those spaces are usually sent to shell programs verbatim. Therefore, the \s-1DOM\s0 parser does not try to recognize those spaces specifially so as to reduce memory use and the number of nodes. However, leading spaces and trailing new lines will still be recognized as MDOM::Token::Whitespace. On a higher level, it's a MDOM::Rule::Simple instance holding several \*(C`Token\*(C' and one MDOM::Command. On the highest level, it's the root node of the whole \s-1DOM\s0 tree, i.e., an instance of MDOM::Document::Gmake.</p>
  </dd>
  <dt>
    Case 2
  </dt>
  <dd>
    <p>Below is a relatively complex example:     a: foo.c  bar.h $(baz) # hello!         @echo ... It's corresponding \s-1DOM\s0 structure is   MDOM::Document::Gmake     MDOM::Rule::Simple       MDOM::Token::Bare         &apos;a&apos;       MDOM::Token::Separator    &apos;:&apos;       MDOM::Token::Whitespace   &apos; &apos;       MDOM::Token::Bare         &apos;foo.c&apos;       MDOM::Token::Whitespace   &apos;  &apos;       MDOM::Token::Bare         &apos;bar.h&apos;       MDOM::Token::Whitespace   &apos;&#92;t&apos;       MDOM::Token::Interpolation   &apos;$(baz)&apos;       MDOM::Token::Whitespace      &apos; &apos;       MDOM::Token::Comment         &apos;# hello!&apos;       MDOM::Token::Whitespace      &apos;&#92;n&apos;     MDOM::Command       MDOM::Token::Separator    &apos;&#92;t&apos;       MDOM::Token::Modifier     &apos;@&apos;       MDOM::Token::Bare         &apos;echo ...&apos;       MDOM::Token::Whitespace   &apos;&#92;n&apos; Compared to the previous example, here appears several new node types. The variable interpolation \*(C`$(baz)\*(C' on the first line of the original makefile corresponds to a MDOM::Token::Interpolation node in its \s-1MDOM\s0 tree. Similarly, the comment \*(C`# hello\*(C' corresponds to a MDOM::Token::Comment node. On the second line, the rule command indented by a tab character is still represented by a MDOM::Command object. Its first child node (or its first element) is also an MDOM::Token::Seperator instance corresponding to that tab. The command modifier \*(C`@\*(C' follows the \*(C`Separator\*(C' immediately, which is of type MDOM::Token::Modifier.</p>
  </dd>
  <dt>
    Case 3
  </dt>
  <dd>
    <p>Now let's study a sample makefile with various global structures:   a: b   foo = bar       # hello! Here on the top level, there are three language structures: one rule "\*(C`a: b\*(C'\*(L", one assignment statement \*(R"foo = bar", and one comment \*(C`# hello!\*(C'. Its \s-1MDOM\s0 tree is shown below:   MDOM::Document::Gmake     MDOM::Rule::Simple       MDOM::Token::Bare                  &apos;a&apos;       MDOM::Token::Separator            &apos;:&apos;       MDOM::Token::Whitespace           &apos; &apos;       MDOM::Token::Bare                   &apos;b&apos;       MDOM::Token::Whitespace           &apos;&#92;n&apos;     MDOM::Assignment       MDOM::Token::Bare                  &apos;foo&apos;       MDOM::Token::Whitespace           &apos; &apos;       MDOM::Token::Separator            &apos;=&apos;       MDOM::Token::Whitespace           &apos; &apos;       MDOM::Token::Bare                  &apos;bar&apos;       MDOM::Token::Whitespace           &apos;&#92;n&apos;     MDOM::Token::Whitespace            &apos;&#92;t&apos;     MDOM::Token::Comment               &apos;# hello!&apos;     MDOM::Token::Whitespace            &apos;&#92;n&apos; We can see that below the root node MDOM::Document::Gmake, there are MDOM::Rule::Simple, MDOM::Assignment, and MDOM::Comment three elements, as well as two MDOM::Token::Whitespace objects.</p>
  </dd>

</dl>
<p>It can be observed from the examples above that the \s-1MDOM\s0 representation for the makefile's lexical elements is rather loose. It only provides very limited structural representation instead of making a bad guess.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPERATIONS FOR MDOM TREES</h2>
        <div class="sectioncontent">
<p>Generating an \s-1MDOM\s0 tree from a \s-1GNU\s0 makefile only requires two lines of Perl code:</p><p>    use MDOM::Document::Gmake;     my $dom = MDOM::Document::Gmake-&gt;new(&apos;Makefile&apos;);</p><p>If the makefile source code being parsed is already stored in a Perl variable, say, $var, then we can construct an \s-1MDOM\s0 via the following code:</p><p>    my $dom = MDOM::Document::Gmake-&gt;new(&#92;$var);</p><p>Now $dom becomes the reference to the root of the \s-1MDOM\s0 tree and its type is now MDOM::Document::Gmake, which is also an instance of the MDOM::Node class.</p><p>Just as mentioned above, \*(C`MDOM::Node\*(C' is the container for other MDOM::Element instances. So we can retrieve some element node's value via its \*(C`child\*(C' method:</p><p>    $node = $dom-&gt;<strong>child</strong>(3);     # or $node = $dom-&gt;<strong>elements</strong>(0);</p><p>And we may also use the \*(C`elements\*(C' method to obtain the values of all the nodes:</p><p>    @elems = $dom-&gt;elements;</p><p>For every \s-1MDOM\s0 node, its corresponding makefile source can be generated by invoking its \*(C`content\*(C' method.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS AND TODO</h2>
        <div class="sectioncontent">
<p>The current implemenation of the MDOM::Document::Gmake lexer is based on a hand-written state machie. Although the efficiency of the engine is not bad, the code is rather complicated and messy, which hurts both extensibility and maintanabilty. So it's expected to rewrite the parser using some grammatical tools like the Perl 6 regex engine Pugs::Compiler::Rule or a yacc-style one like Parse::Yapp.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOURCE REPOSITORY</h2>
        <div class="sectioncontent">
<p>You can always get the latest source code of this module from its GitHub repository:</p><p>http://github.com/agentzh/makefile-dom-pm &lt;http://github.com/agentzh/makefile-dom-pm&gt;</p><p>If you want a commit bit, please let me know.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Zhang \*(L"agentzh\*(R" Yichun (\s-1XXX\s0) &lt;agentzh@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright 2006-2011 by Zhang \*(L"agentzh\*(R" Yichun (\s-1XXX\s0).</p><p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Makefile::DOM&hellip;</h2>
        <div class="sectioncontent">
<p>MDOM::Document, MDOM::Document::Gmake, \s-1PPI\s0, Makefile::Parser::GmakeDB, makesimple.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Mail::Verp.3pm.html"><span aria-hidden="true">&larr;</span> Mail::Verp.3pm: Encodes and decodes variable envelope return paths (verp) addresses.</a></li>
   <li class="next"><a href="Mason::Plugin::Cache.3pm.html">Mason::Plugin::Cache.3pm: Provide component cache object and filter <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
