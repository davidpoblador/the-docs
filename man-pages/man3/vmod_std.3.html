<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>vmod_std: Varnish standard module</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Varnish standard module">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="vmod_std (3) manual">
  <meta name="twitter:description" content="Varnish standard module">
  <meta name="twitter:image" content="https://www.carta.tech/images/varnish-vmod_std-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/vmod_std.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="vmod_std (3) manual" />
  <meta property="og:description" content="Varnish standard module" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/varnish-vmod_std-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">vmod_std<small> (3)</small></h1>
        <p class="lead">Varnish standard module</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/vmod_std.3.html">
      <span itemprop="name">vmod_std: Varnish standard module</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/varnish/">
      <span itemprop="name">varnish</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/vmod_std.3.html">
      <span itemprop="name">vmod_std: Varnish standard module</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>import std [from "path"] ;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Vmod_std contains basic functions which are part and parcel of Varnish, but which for reasons of architecture fit better in a VMOD.</p><p>One particular class of functions in vmod_std is the conversions functions which all have the form:</p>
<pre>
TYPE type(STRING, TYPE)
</pre>
<p>These functions attempt to convert STRING to the TYPE, and if that fails, they return the second argument, which must have the given TYPE.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTENTS</h2>
        <div class="sectioncontent">
<ul>
<li><p>VOID collect(HEADER)</p></li><li><p>DURATION duration(STRING, DURATION)</p></li><li><p>STRING fileread(PRIV_CALL, STRING)</p></li><li><p>BOOL healthy(BACKEND)</p></li><li><p>INT integer(STRING, INT)</p></li><li><p>IP ip(STRING, IP)</p></li><li><p>VOID log(STRING_LIST)</p></li><li><p>INT port(IP)</p></li><li><p>STRING querysort(STRING)</p></li><li><p>REAL random(REAL, REAL)</p></li><li><p>REAL real(STRING, REAL)</p></li><li><p>TIME real2time(REAL)</p></li><li><p>VOID rollback(HTTP)</p></li><li><p>VOID set_ip_tos(INT)</p></li><li><p>STRING strstr(STRING, STRING)</p></li><li><p>VOID syslog(INT, STRING_LIST)</p></li><li><p>INT time2integer(TIME)</p></li><li><p>REAL time2real(TIME)</p></li><li><p>VOID timestamp(STRING)</p></li><li><p>STRING tolower(STRING_LIST)</p></li><li><p>STRING toupper(STRING_LIST)</p></li>
</ul><h3>STRING toupper(STRING_LIST)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>STRING toupper(STRING_LIST)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the string <em>s</em> to upper case.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set beresp.http.x-scream = std.toupper("yes!");</p>
  </dd>

</dl>

<h3>STRING tolower(STRING_LIST)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>STRING tolower(STRING_LIST)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the string <em>s</em> to lower case.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set beresp.http.x-nice = std.tolower("VerY");</p>
  </dd>

</dl>

<h3>VOID set_ip_tos(INT)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID set_ip_tos(INT)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Sets the Type-of-Service flag for the current session. Please note that the TOS flag is not removed by the end of the request so probably want to set it on every request should you utilize it.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    
<pre>
if (req.url ~ ^/slow/) {
std.set_ip_tos(0x0);
}
</pre>

  </dd>

</dl>

<h3>REAL random(REAL, REAL)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>REAL random(REAL, REAL)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Returns a random REAL number between <em>a</em> and <em>b</em>.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set beresp.http.x-random-number = std.random(1, 100);</p>
  </dd>

</dl>

<h3>VOID log(STRING_LIST)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID log(STRING_LIST)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Logs <em>string</em> to the shared memory log, using VSL tag <em>SLT_VCL_Log</em>.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>std.log("Something fishy is going on with the vhost " + req.host);</p>
  </dd>

</dl>

<h3>VOID syslog(INT, STRING_LIST)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID syslog(INT, STRING_LIST)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Logs <em>string</em> to syslog marked with <em>priority</em>.  See your system&apos;s syslog.h file for the legal values of <em>priority</em>.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>std.syslog(8 + 1, "Something is wrong");</p>
  </dd>

</dl>

<h3>STRING fileread(PRIV_CALL, STRING)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>STRING fileread(PRIV_CALL, STRING)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Reads a file and returns a string with the content. Please note that it is not recommended to send variables to this function the caching in the function doesn&apos;t take this into account. Also, files are not re-read.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set beresp.http.x-served-by = std.fileread("/etc/hostname");</p>
  </dd>

</dl>

<h3>VOID collect(HEADER)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID collect(HEADER)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Collapses the header, joining the headers into one.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>std.collect(req.http.cookie); This will collapse several Cookie: headers into one, long cookie header.</p>
  </dd>

</dl>

<h3>DURATION duration(STRING, DURATION)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>DURATION duration(STRING, DURATION)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the string <em>s</em> to seconds. <em>s</em> must be quantified with ms (milliseconds), s (seconds), m (minutes), h (hours), d (days), w (weeks) or y (years) units. If <em>s</em> fails to parse, <em>fallback</em> will be returned.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set beresp.ttl = std.duration("1w", 3600s);</p>
  </dd>

</dl>

<h3>INT integer(STRING, INT)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>INT integer(STRING, INT)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the string <em>s</em> to an integer.  If <em>s</em> fails to parse, <em>fallback</em> will be returned.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>if (std.integer(beresp.http.x-foo, 0) &gt; 5) { ... }</p>
  </dd>

</dl>

<h3>IP ip(STRING, IP)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>IP ip(STRING, IP)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts string <em>s</em> to the first IP number returned by the system library function <a href="../man3/getaddrinfo.3.html"><strong>getaddrinfo</strong>(3)</a>.  If conversion fails, <em>fallback</em> will be returned.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>if (std.ip(req.http.X-forwarded-for, "0.0.0.0") ~ my_acl) { ... }</p>
  </dd>

</dl>

<h3>REAL real(STRING, REAL)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>REAL real(STRING, REAL)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the string <em>s</em> to a real.  If <em>s</em> fails to parse, <em>fallback</em> will be returned.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set req.http.x-real = std.real(req.http.x-foo, 0.0);</p>
  </dd>

</dl>

<h3>TIME real2time(REAL)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>TIME real2time(REAL)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the real <em>r</em> to a time.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set req.http.x-time = std.real2time(1140618699.00);</p>
  </dd>

</dl>

<h3>INT time2integer(TIME)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>INT time2integer(TIME)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the time <em>t</em> to a integer.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set req.http.x-int = std.time2integer(now);</p>
  </dd>

</dl>

<h3>REAL time2real(TIME)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>REAL time2real(TIME)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Converts the time <em>t</em> to a real.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set req.http.x-real = std.time2real(now);</p>
  </dd>

</dl>

<h3>BOOL healthy(BACKEND)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>BOOL healthy(BACKEND)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Returns true if the backend is healthy.</p>
  </dd>

</dl>

<h3>INT port(IP)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>INT port(IP)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Returns the port number of an IP address.</p>
  </dd>

</dl>

<h3>VOID rollback(HTTP)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID rollback(HTTP)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Restore <em>h</em> HTTP headers to their original state.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>std.rollback(bereq);</p>
  </dd>

</dl>

<h3>VOID timestamp(STRING)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>VOID timestamp(STRING)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Introduces a timestamp in the log with the current time. Uses the argument as the timespamp label. This is useful to time the execution of lengthy VCL procedures, and makes the timestamps inserted automatically by Varnish more accurate.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>std.timestamp("curl-request");</p>
  </dd>

</dl>

<h3>STRING querysort(STRING)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>STRING querysort(STRING)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Sorts the querystring for cache normalization purposes.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>set req.url = std.querysort(req.url);</p>
  </dd>

</dl>

<h3>STRING strstr(STRING, STRING)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>Prototype</strong></p>
  </dt>
  <dd>
    <p>STRING strstr(STRING, STRING)</p>
  </dd>
  <dt>
    <p><strong>Description</strong></p>
  </dt>
  <dd>
    <p>Returns the substring if the second string is a substring of the first string. Note that the comparison is case sensitive. You can use the tolower function on both strings if you want case insensitivity.</p><p>If there is no match a NULL pointer is returned which would evaluate to false in an if-test.</p>
  </dd>
  <dt>
    <p><strong>Example</strong></p>
  </dt>
  <dd>
    <p>if (std.strstr(req.url, req.http.x-restrict))</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO vmod_std&hellip;</h2>
        <div class="sectioncontent">
<ul>
<li><p><strong>vcl</strong>(7)</p></li><li><p><a href="../man1/varnishd.1.html"><strong>varnishd</strong>(1)</a></p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p>The Varnish standard module was released along with Varnish Cache 3.0. This manual page was written by Per Buer with help from Martin Blix Grydeland.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>This document is licensed under the same licence as Varnish itself. See LICENCE for details.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="vmod_directors.3.html"><span aria-hidden="true">&larr;</span> vmod_directors.3: Backend traffic directors</a></li>
   <li class="next"><a href="voigt.3.html">voigt.3: Voigt's function, convolution of gaussian and lorentzian <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
