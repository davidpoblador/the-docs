<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Courier::Filter: Purely perl-based mail filter framework for the courier mta</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Purely perl-based mail filter framework for the courier mta">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Courier::Filter (3pm) manual">
  <meta name="twitter:description" content="Purely perl-based mail filter framework for the courier mta">
  <meta name="twitter:image" content="https://www.carta.tech/images/courier-filter-perl-Courier::Filter-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Courier::Filter.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Courier::Filter (3pm) manual" />
  <meta property="og:description" content="Purely perl-based mail filter framework for the courier mta" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/courier-filter-perl-Courier::Filter-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Courier::Filter<small> (3pm)</small></h1>
        <p class="lead">Purely perl-based mail filter framework for the courier mta</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Courier::Filter.3pm.html">
      <span itemprop="name">Courier::Filter: Purely perl-based mail filter framework for the courier mta</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/courier-filter-perl/">
      <span itemprop="name">courier-filter-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Courier::Filter.3pm.html">
      <span itemprop="name">Courier::Filter: Purely perl-based mail filter framework for the courier mta</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>0.200</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    use Courier::Filter;
    use Courier::Filter::Logger::Moo;
    use Courier::Filter::Module::Foo;
    use Courier::Filter::Module::Bar;

    my $filter = Courier::Filter-&gt;new(
        mandatory   =&gt; 1,
        logger      =&gt; Courier::Filter::Logger::Moo-&gt;new( ... ),
        modules     =&gt; [
            Courier::Filter::Module::Foo-&gt;new( ... ),
            Courier::Filter::Module::Bar-&gt;new( ... )
        ],
        testing     =&gt; 0,
        debugging   =&gt; 0
    );

    my $exit_code = $filter-&gt;run() || 0;

    exit($exit_code);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>For an architectural and administrative overview of the </strong><strong>Courier::Filter</strong><strong></strong> framework, see Courier::Filter::Overview.</p><p>The <strong>Courier::Filter</strong> class is the heart of the Courier::Filter framework.  To drive a <strong>courierfilter</strong> filter process, create a <strong>Courier::Filter</strong> object, passing the filter modules and loggers you want to use to the constructor, and call the \*(C`run()\*(C' method.</p><p>Courier::Filter will then take care of creating the courierfilter socket in the right place in a safe manner, listening for connections from Courier, asking filter modules for consideration of messages, notifying Courier of whether messages should be accepted or rejected, logging message rejections, catching and logging errors, and finally removing the socket when being terminated by Courier.</p><h3>Constructor</h3>
<p>The following constructor is provided:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>new(%options)</strong>: returns <em>Courier::Filter</em>; throws <em>Courier::Error</em>, Perl exceptions
  </dt>
  <dd>
    <p>Creates a new \*(C`Courier::Filter\*(C' object.  Also creates the courierfilter socket in the right place in a safe manner. %options is a list of key/value pairs representing any of the following options:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>name</strong>
  </dt>
  <dd>
    <p>The name of the filter process.  Used to build the socket name.  Defaults to the base name of the process ($0).</p>
  </dd>
  <dt>
    <strong>mandatory</strong>
  </dt>
  <dd>
    <p>A boolean value controlling whether the filter process should act as a mandatory courierfilter.  If <strong>true</strong>, users will not be able to bypass the filter modules in this filter process from their individual <strong>localmailfilter</strong> filters.  Technically, this controls whether the courierfilter socket will be created in the \*(C`allfilters\*(C' (<strong>true</strong>) or the \*(C`filters\*(C' (<strong>false</strong>) directory in Courier's run-time state directory (see \*(L"runtime_dir\*(R" in Courier::Config). Defaults to <strong>true</strong>.</p>
  </dd>
  <dt>
    <strong>logger</strong>
  </dt>
  <dd>
    <p>A <strong>Courier::Filter::Logger</strong> object that will be used for logging message rejections and error messages.  You may override this for individual filter modules for which you do not want the global logger to be used.  If no logger is specified, logging is disabled.</p>
  </dd>
  <dt>
    <strong>modules</strong>
  </dt>
  <dd>
    <p><em>Required</em>.  A so-called <strong>filter module group</strong> structure.  A module group is a reference to an array that may contain filter module objects (i.e. instances of sub-classes of <strong>Courier::Filter::Module</strong>), as well as other module groups. Thus, a module group is essentially a tree structure with filter modules as its leaves.  When considering messages, Courier::Filter walks the tree in a recursive-descent, depth-first order, asking every filter module for consideration of the message's acceptability. For instance, given the following filter module group:     [$m1, $m2, [$m3, [$m4, $m5]], $m6] Courier::Filter queries the filter modules in ascending order from 1 to 6. The acceptability result returned by each module determines how Courier::Filter proceeds with considering the current message:</p><ul>
<li><p>If a module states an <strong>explicit reject</strong>, Courier::Filter aborts the consideration process and rejects the message.</p></li><li><p>If a module states an <strong>implicit accept</strong>, Courier::Filter just proceeds to the next module in turn.</p></li><li><p>If a module states an <strong>explicit accept</strong>, Courier::Filter skips the rest of the current module group and proceeds to the next item in the superordinate module group, assuming the whole group to be an implicit accept.</p></li>
</ul><p>For instance, take the nested filter module group from above:     [$m1, $m2, [$m3, [$m4, $m5]], $m6]     |          |     &apos;---g3---&apos;|     |     |          &apos;----group 2----&apos;     |     &apos;------------group 1-------------&apos; Let's assume Courier::Filter queries the filter module $m3.  If $m3 states an <strong>explicit reject</strong>, the consideration process is aborted and the current message is rejected.  If $m3 states an <strong>implicit accept</strong>, Courier::Filter proceeds to $m4.  If $m3 states an <strong>explicit accept</strong>, the rest of group 2 (including all of group 3) is skipped and the acceptability result of group 2 is assumed an implicit accept, so Courier::Filter proceeds to $m6. If no <strong>explicit reject</strong> has occured when Courier::Filter reaches the end of the main module group, or a module in the main group states an <strong>explicit</strong> accept, the message is accepted. Using nested groups of filter modules with normal or inverse polarity, it should be possible to implement sufficiently complex filtering policies to satisfy very most needs.</p>
  </dd>
  <dt>
    <strong>trusting</strong>
  </dt>
  <dd>
    <p>A boolean value controlling whether the <em>whole</em> filter process should <em>not</em> apply any filtering to trusted messages.  For details on how the trusted status is determined, see the description of the \*(C`trusted\*(C' property in Courier::Message.  In most \s-1MTA\s0 configurations, this option can be used to white-list so-called outbound messages.  Defaults to <strong>false</strong>.</p>
  </dd>
  <dt>
    <strong>testing</strong>
  </dt>
  <dd>
    <p>A boolean value controlling whether the <em>whole</em> filter process should run in \*(L"testing\*(R" mode.  In testing mode, planned message rejections will be logged as usual, but no messages will actually be rejected.  Defaults to <strong>false</strong>. \s-1NOTE:\s0  You may also enable testing mode on individual filter module objects, see \*(L"new\*(R" in Courier::Filter::Module.  Enabling testing mode globally is not the same as individually enabling testing mode on all filter modules, though. When global testing mode is enabled, Courier::Filter only ignores the <em>final</em> result, but still follows the rules of the normal consideration process, e.g. aborting as soon as a filter module states an <strong>explicit reject</strong>, etc.  When an individual filter module is in testing mode, its <em>individual</em> result is ignored, and the consideration process is continued with the next filter module.  So individually enabling testing mode on all filter modules allows you to thoroughly test the correctness and performance of all installed filter modules, or even to gather stochastically indepent statistics on the hit/miss rates of your filter modules.</p>
  </dd>
  <dt>
    <strong>debugging</strong>
  </dt>
  <dd>
    <p>A boolean value controlling whether extra debugging information should be logged by Courier::Filter.  Defaults to <strong>false</strong>.  You need to enable debugging mode for filter modules separately.</p>
  </dd>

</dl>

  </dd>

</dl>

<h3>Instance methods</h3>
<p>The following instance methods are provided:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>run</strong>: throws <em>Courier::Error</em>, Perl exceptions
  </dt>
  <dd>
    <p>Runs the Courier::Filter.  Listens for connections from Courier on the courierfilter socket, asks the configured filter modules for consideration of messages, notifies Courier of whether messages should be accepted or rejected, and logs message rejections.  When Courier requests termination of the courierfilter, removes the socket and returns.</p>
  </dd>
  <dt>
    <strong>name</strong>: returns <em>string</em>
  </dt>
  <dd>
    <p>Returns the name of the filter process, as set through the constructor's \*(C`name\*(C' option.</p>
  </dd>
  <dt>
    <strong>mandatory</strong>: returns <em>boolean</em>
  </dt>
  <dd>
    <p>Returns a boolean value indicating whether the filter process is a mandatory courierfilter, as set through the constructor's \*(C`mandatory\*(C' option.</p>
  </dd>
  <dt>
    <strong>logger</strong>: returns <em>Courier::Filter::Logger</em>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>logger($logger)</strong>: returns <em>Courier::Filter::Logger</em>
  </dt>
  <dd>
    <p>If $logger is specified, installs a new global logger.  Returns the (newly) configured global logger.</p>
  </dd>
  <dt>
    <strong>modules</strong>: returns <em>array-ref</em>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>modules(&#92;@modules)</strong>: returns <em>array-ref</em>
  </dt>
  <dd>
    <p>If \*(C`&#92;@modules\*(C' is specified, installs a new filter module group structure. Returns the (newly) configured filter modules group structure.</p>
  </dd>
  <dt>
    <strong>trusting</strong>: returns <em>boolean</em>
  </dt>
  <dd>
    <p>Returns a boolean value indicating the trusting mode, as set through the constructor's \*(C`trusting\*(C' option.</p>
  </dd>
  <dt>
    <strong>testing</strong>: returns <em>boolean</em>
  </dt>
  <dd>
    <p>Returns a boolean value indicating the global testing mode, as set through the constructor's \*(C`testing\*(C' option.</p>
  </dd>
  <dt>
    <strong>debugging</strong>: returns <em>boolean</em>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>debugging($debugging)</strong>: returns <em>boolean</em>
  </dt>
  <dd>
    <p>If $debugging is specified, sets the global debugging mode.  Returns a boolean value indicating the (newly) configured global debugging mode.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Courier::Filter&hellip;</h2>
        <div class="sectioncontent">
<p>courier-filter-perl, Courier::Filter::Overview, Courier::Filter::Module, Courier::Filter::Logger</p><p>For \s-1AVAILABILITY\s0, \s-1SUPPORT\s0, and \s-1LICENSE\s0 information, see Courier::Filter::Overview.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REFERENCES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    The <strong>courierfilter</strong> interface
  </dt>
  <dd>
    <p>http://www.courier-mta.org/courierfilter.html &lt;http://www.courier-mta.org/courierfilter.html&gt;</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Julian Mehnle &lt;julian@mehnle.net&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Courier::Error.3pm.html"><span aria-hidden="true">&larr;</span> Courier::Error.3pm: Exception class for perl modules related to the courier mta</a></li>
   <li class="next"><a href="Courier::Filter::Logger.3pm.html">Courier::Filter::Logger.3pm: Abstract base class for loggers used by the courier::filter framework <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
