<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libunwind-ptrace: Ptrace() support in libunwind</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Ptrace() support in libunwind">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libunwind-ptrace (3) manual">
  <meta name="twitter:description" content="Ptrace() support in libunwind">
  <meta name="twitter:image" content="https://www.carta.tech/images/libunwind-dev-libunwind-ptrace-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libunwind-ptrace.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libunwind-ptrace (3) manual" />
  <meta property="og:description" content="Ptrace() support in libunwind" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libunwind-dev-libunwind-ptrace-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libunwind-ptrace<small> (3)</small></h1>
        <p class="lead">Ptrace() support in libunwind</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libunwind-ptrace.3.html">
      <span itemprop="name">libunwind-ptrace: Ptrace() support in libunwind</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libunwind-dev/">
      <span itemprop="name">libunwind-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libunwind-ptrace.3.html">
      <span itemprop="name">libunwind-ptrace: Ptrace() support in libunwind</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;libunwind-ptrace.h&gt;</p><p>unw_accessors_t _UPT_accessors;</p><p>void *_UPT_create(pid_t);</p><p>void _UPT_destroy(void *);</p><p>int _UPT_find_proc_info(unw_addr_space_t, unw_word_t, unw_proc_info_t *, int, void *);</p><p>void _UPT_put_unwind_info(unw_addr_space_t, unw_proc_info_t *, void *);</p><p>int _UPT_get_dyn_info_list_addr(unw_addr_space_t, unw_word_t *, void *);</p><p>int _UPT_access_mem(unw_addr_space_t, unw_word_t, unw_word_t *, int, void *);</p><p>int _UPT_access_reg(unw_addr_space_t, unw_regnum_t, unw_word_t *, int, void *);</p><p>int _UPT_access_fpreg(unw_addr_space_t, unw_regnum_t, unw_fpreg_t *, int, void *);</p><p>int _UPT_get_proc_name(unw_addr_space_t, unw_word_t, char *, size_t, unw_word_t *, void *);</p><p>int _UPT_resume(unw_addr_space_t, unw_cursor_t *, void *);</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a> system-call makes it possible for a process to gain access to the machine-state and virtual memory of <em>another</em> process. With the right set of call-back routines, it is therefore possible to hook up libunwind to another process via <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a>. While it's not very difficult to do so directly, libunwind further facilitates this task by providing ready-to-use callbacks for this purpose. The routines and variables implementing this facility use a name-prefix of _UPT, which is stands for ``unwind-via-ptrace''.</p><p>An application that wants to use the _UPT-facility first needs to create a new libunwind address-space that represents the target process. This is done by calling unw_create_addr_space(). In many cases, the application will simply want to pass the address of _UPT_accessors as the first argument to this routine. Doing so will ensure that libunwind will be able to properly unwind the target process. However, in special circumstances, an application may prefer to use only portions of the _UPT-facility. For this reason, the individual callback routines (_UPT_find_proc_info(), _UPT_put_unwind_info(), etc.) are also available for direct use. Of course, the addresses of these routines could also be picked up from _UPT_accessors, but doing so would prevent static initialization. Also, when using _UPT_accessors, <em>all</em> the callback routines will be linked into the application, even if they are never actually called.</p><p>Next, the application can turn on ptrace-mode on the target process, either by forking a new process, invoking PTRACE_TRACEME, and then starting the target program (via <a href="../man2/execve.2.html"><strong>execve</strong>(2)</a>), or by directly attaching to an already running process (via PTRACE_ATTACH). Either way, once the process-ID (pid) of the target process is known, a _UPT-info-structure can be created by calling _UPT_create(), passing the pid of the target process as the only argument. The returned void-pointer then needs to be passed as the ``argument'' pointer (third argument) to unw_init_remote().</p><p>The _UPT_resume() routine can be used to resume execution of the target process. It simply invokes <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a> with a command value of PTRACE_CONT.</p><p>When the application is done using libunwind on the target process, _UPT_destroy() needs to be called, passing it the void-pointer that was returned by the corresponding call to _UPT_create(). This ensures that all memory and other resources are freed up.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AVAILABILITY</h2>
        <div class="sectioncontent">
<p>Since <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a> works within a single machine only, the _UPT-facility by definition is not available in libunwind-versions configured for cross-unwinding.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">THREAD SAFETY</h2>
        <div class="sectioncontent">
<p>The _UPT-facility assumes that a single _UPT-info structure is never shared between threads. Because of this, no explicit locking is used. As long as only one thread uses a _UPT-info structure at any given time, this facility is thread-safe.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>_UPT_create() may return a NULL pointer if it fails to create the _UPT-info-structure for any reason. For the current implementation, the only reason this call may fail is when the system is out of memory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>libunwind-ptrace.h</p>
  </dt>
  <dd>
    <p> Headerfile to include when using the interface defined by this library.</p>
  </dd>
  <dt>
    <p><strong>-l</strong>unwind-ptrace <strong>-l</strong>unwind-generic</p>
  </dt>
  <dd>
    <p> Linker-switches to add when building a program that uses the functions defined by this library.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO libunwind-ptrace&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man2/execve.2.html"><strong>execve</strong>(2)</a>, <a href="../man3/libunwind.3.html"><strong>libunwind</strong>(3)</a>, <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>David Mosberger-Tang</p><p>Email: <strong>dmosberger@gmail.com</strong></p><p>WWW: <strong>http://www.nongnu.org/libunwind/</strong>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libunwind-ia64.3.html"><span aria-hidden="true">&larr;</span> libunwind-ia64.3: Ia-64-specific support in libunwind</a></li>
   <li class="next"><a href="libunwind-setjmp.3.html">libunwind-setjmp.3: Libunwind-based non-local gotos <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
