<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ldap_sync - LDAP sync routines</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Ldap sync routines">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ldap_sync<small> (3)</small></h1>
        <p class="lead">Ldap sync routines</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ldap_sync.3.html">
      <span itemprop="name">ldap_sync</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/openldap/">
      <span itemprop="name">openldap</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ldap_sync.3.html">
      <span itemprop="name">ldap_sync</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">LIBRARY</h2>
        <div class="sectioncontent">

<p>OpenLDAP LDAP (libldap, -lldap)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>#include &lt;ldap.h&gt;</strong>

<strong>int ldap_sync_init(ldap_sync_t *</strong><em>ls</em><strong>, int </strong><em>mode</em><strong>);</strong>

<strong>int ldap_sync_init_refresh_only(ldap_sync_t *</strong><em>ls</em><strong>);</strong>

<strong>int ldap_sync_init_refresh_and_persist(ldap_sync_t *</strong><em>ls</em><strong>);</strong>

<strong>int ldap_sync_poll(ldap_sync_t *</strong><em>ls</em><strong>);</strong>

<strong>ldap_sync_t * ldap_sync_initialize(ldap_sync_t *</strong><em>ls</em><strong>);</strong>

<strong>void ldap_sync_destroy(ldap_sync_t *</strong><em>ls</em><strong>, int </strong><em>freeit</em><strong>);</strong>

<strong>typedef int (*</strong><em>ldap_sync_search_entry_f</em><strong>)(ldap_sync_t *</strong><em>ls</em><strong>,</strong>
<strong>LDAPMessage *</strong><em>msg</em><strong>, struct berval *</strong><em>entryUUID</em><strong>,</strong>
<strong>ldap_sync_refresh_t </strong><em>phase</em><strong>);</strong>

<strong>typedef int (*</strong><em>ldap_sync_search_reference_f</em><strong>)(ldap_sync_t *</strong><em>ls</em><strong>,</strong>
<strong>LDAPMessage *</strong><em>msg</em><strong>);</strong>

<strong>typedef int (*</strong><em>ldap_sync_intermediate_f</em><strong>)(ldap_sync_t *</strong><em>ls</em><strong>,</strong>
<strong>LDAPMessage *</strong><em>msg</em><strong>, BerVarray </strong><em>syncUUIDs</em><strong>,</strong>
<strong>ldap_sync_refresh_t </strong><em>phase</em><strong>);</strong>

<strong>typedef int (*</strong><em>ldap_sync_search_result_f</em><strong>)(ldap_sync_t *</strong><em>ls</em><strong>,</strong>
<strong>LDAPMessage *</strong><em>msg</em><strong>, int </strong><em>refreshDeletes</em><strong>);</strong></pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>These routines provide an interface to the LDAP Content Synchronization operation (RFC 4533). They require an <strong>ldap_sync_t</strong> structure to be set up with parameters required for various phases of the operation; this includes setting some handlers for special events. All handlers take a pointer to the <strong>ldap_sync_t</strong> structure as the first argument, and a pointer to the <strong>LDAPMessage</strong> structure as received from the server by the client library, plus, occasionally, other specific arguments.</p>
<p class='spacer'>

  <p>The members of the <strong>ldap_sync_t</strong> structure are:</p>
  <dl class='dl-vertical'>
    <dt><strong>char *</strong><em>ls_base</em></dt>
    <dd>
  <p>The search base; by default, the <strong>BASE</strong> option in <strong>ldap.conf</strong>(5).</p>
    </dd>
    <dt><strong>int </strong><em>ls_scope</em></dt>
    <dd>
  <p>The search scope (one of <strong>LDAP_SCOPE_BASE</strong>, <strong>LDAP_SCOPE_ONELEVEL</strong>, <strong>LDAP_SCOPE_SUBORDINATE</strong> or <strong>LDAP_SCOPE_SUBTREE</strong>; see <strong>ldap.h</strong> for details).</p>
    </dd>
    <dt><strong>char *</strong><em>ls_filter</em></dt>
    <dd>
  <p>The filter (RFC 4515); by default, <strong>(objectClass=*)</strong>.</p>
    </dd>
    <dt><strong>char **</strong><em>ls_attrs</em></dt>
    <dd>
  <p>The requested attributes; by default <strong>NULL</strong>, indicating all user attributes.</p>
    </dd>
    <dt><strong>int </strong><em>ls_timelimit</em></dt>
    <dd>
  <p>The requested time limit (in seconds); by default <strong>0</strong>, to indicate no limit.</p>
    </dd>
    <dt><strong>int </strong><em>ls_sizelimit</em></dt>
    <dd>
  <p>The requested size limit (in entries); by default <strong>0</strong>, to indicate no limit.</p>
    </dd>
    <dt><strong>int </strong><em>ls_timeout</em></dt>
    <dd>
  <p>The desired timeout during polling with <strong>ldap_sync_poll</strong>(3). A value of <strong>-1</strong> means that polling is blocking, so <strong>ldap_sync_poll</strong>(3) will not return until a message is received; a value of <strong>0</strong> means that polling returns immediately, no matter if any response is available or not; a positive value represents the timeout the <strong>ldap_sync_poll</strong>(3) function will wait for response before returning, unless a message is received; in that case, <strong>ldap_sync_poll</strong>(3) returns as soon as the message is available.</p>
    </dd>
    <dt><strong>ldap_sync_search_entry_f </strong><em>ls_search_entry</em></dt>
    <dd>
  <p>A function that is called whenever an entry is returned. The <strong>msg</strong> argument is the <strong>LDAPMessage</strong> that contains the searchResultEntry; it can be parsed using the regular client API routines, like <strong>ldap_get_dn</strong>(3), <strong>ldap_first_attribute</strong>(3), and so on. The <strong>entryUUID</strong> argument contains the entryUUID of the entry. The <strong>phase</strong> argument indicates the type of operation: one of <strong>LDAP_SYNC_CAPI_PRESENT</strong>, <strong>LDAP_SYNC_CAPI_ADD</strong>, <strong>LDAP_SYNC_CAPI_MODIFY</strong>, <strong>LDAP_SYNC_CAPI_DELETE</strong>; in case of <strong>LDAP_SYNC_CAPI_PRESENT</strong> or <strong>LDAP_SYNC_CAPI_DELETE</strong>, only the DN is contained in the <em>LDAPMessage</em>; in case of <strong>LDAP_SYNC_CAPI_MODIFY</strong>, the whole entry is contained in the <em>LDAPMessage</em>, and the application is responsible of determining the differences between the new view of the entry provided by the caller and the data already known.</p>
    </dd>
    <dt><strong>ldap_sync_search_reference_f </strong><em>ls_search_reference</em></dt>
    <dd>
  <p>A function that is called whenever a search reference is returned. The <strong>msg</strong> argument is the <strong>LDAPMessage</strong> that contains the searchResultReference; it can be parsed using the regular client API routines, like <strong>ldap_parse_reference</strong>(3).</p>
    </dd>
    <dt><strong>ldap_sync_intermediate_f </strong><em>ls_intermediate</em></dt>
    <dd>
  <p>A function that is called whenever something relevant occurs during the refresh phase of the search, which is marked by an <em>intermediateResponse</em> message type. The <strong>msg</strong> argument is the <strong>LDAPMessage</strong> that contains the intermediate response; it can be parsed using the regular client API routines, like <strong>ldap_parse_intermediate</strong>(3). The <strong>syncUUIDs</strong> argument contains an array of UUIDs of the entries that depends on the value of the <strong>phase</strong> argument. In case of <strong>LDAP_SYNC_CAPI_PRESENTS</strong>, the "present" phase is being entered; this means that the following sequence of results will consist in entries in "present" sync state. In case of <strong>LDAP_SYNC_CAPI_DELETES</strong>, the "deletes" phase is being entered; this means that the following sequence of results will consist in entries in "delete" sync state. In case of <strong>LDAP_SYNC_CAPI_PRESENTS_IDSET</strong>, the message contains a set of UUIDs of entries that are present; it replaces a "presents" phase. In case of <strong>LDAP_SYNC_CAPI_DELETES_IDSET</strong>, the message contains a set of UUIDs of entries that have been deleted; it replaces a "deletes" phase. In case of <strong>LDAP_SYNC_CAPI_DONE,</strong> a "presents" phase with "refreshDone" set to "TRUE" has been returned to indicate that the refresh phase of refreshAndPersist is over, and the client should start polling. Except for the <strong>LDAP_SYNC_CAPI_PRESENTS_IDSET</strong> and <strong>LDAP_SYNC_CAPI_DELETES_IDSET</strong> cases, <strong>syncUUIDs</strong> is NULL.</p>
    </dd>
    <dt><strong>ldap_sync_search_result_f </strong><em>ls_search_result</em></dt>
    <dd>
  <p>A function that is called whenever a searchResultDone is returned. In refreshAndPersist this can only occur when the server decides that the search must be interrupted. The <strong>msg</strong> argument is the <strong>LDAPMessage</strong> that contains the response; it can be parsed using the regular client API routines, like <strong>ldap_parse_result</strong>(3). The <strong>refreshDeletes</strong> argument is not relevant in this case; it should always be -1.</p>
    </dd>
    <dt><strong>void *</strong><em>ls_private</em></dt>
    <dd>
  <p>A pointer to private data.  The client may register here a pointer to data the handlers above may need.</p>
    </dd>
    <dt><strong>LDAP *</strong><em>ls_ld</em></dt>
    <dd>
  <p>A pointer to a LDAP structure that is used to connect to the server. It is the responsibility of the client to initialize the structure and to provide appropriate authentication and security in place.</p>
<p class='spacer'>

    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GENERAL USE</h2>
        <div class="sectioncontent">

<p>A <strong>ldap_sync_t</strong> structure is initialized by calling <strong>ldap_sync_initialize</strong>(3).</strong> This simply clears out the contents of an already existing <strong>ldap_sync_t</strong> structure, and sets appropriate values for some members. After that, the caller is responsible for setting up the connection (member <strong>ls_ld</strong>), eventually setting up transport security (TLS), for binding and any other initialization. The caller must also fill all the documented search-related fields of the <strong>ldap_sync_t</strong> structure.</p>
<p class='spacer'>

<p>At the end of a session, the structure can be cleaned up by calling <strong>ldap_sync_destroy</strong>(3), which takes care of freeing all data assuming it was allocated by <strong>ldap_mem*</strong>(3) routines. Otherwise, the caller should take care of destroying and zeroing out the documented search-related fields, and call <strong>ldap_sync_destroy</strong>(3) to free undocumented members set by the API.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REFRESH ONLY</h2>
        <div class="sectioncontent">

<p>The <strong>refreshOnly</strong> functionality is obtained by periodically calling <strong>ldap_sync_init</strong>(3) with mode set to <strong>LDAP_SYNC_REFRESH_ONLY</strong>, or, which is equivalent, by directly calling <strong>ldap_sync_init_refresh_only</strong>(3). The state of the search, and the consistency of the search parameters, is preserved across calls by passing the <strong>ldap_sync_t</strong> structure as left by the previous call.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REFRESH AND PERSIST</h2>
        <div class="sectioncontent">

<p>The <strong>refreshAndPersist</strong> functionality is obtained by calling <strong>ldap_sync_init</strong>(3) with mode set to <strong>LDAP_SYNC_REFRESH_AND_PERSIST</strong>, or, which is equivalent, by directly calling <strong>ldap_sync_init_refresh_and_persist</strong>(3) and, after a successful return, by repeatedly polling with <strong>ldap_sync_poll</strong>(3) according to the desired pattern.</p>
<p class='spacer'>

<p>A client may insert a call to <strong>ldap_sync_poll</strong>(3) into an external loop to check if any modification was returned; in this case, it might be appropriate to set <strong>ls_timeout</strong> to 0, or to set it to a finite, small value. Otherwise, if the client's main purpose consists in waiting for responses, a timeout of -1 is most suitable, so that the function only returns after some data has been received and handled.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<p>All routines return any LDAP error resulting from a lower-level error in the API calls they are based on, or LDAP_SUCCESS in case of success. <strong>ldap_sync_poll</strong>(3) may return <strong>LDAP_SYNC_REFRESH_REQUIRED</strong> if a full refresh is requested by the server. In this case, it is appropriate to call <strong>ldap_sync_init</strong>(3) again, passing the same <strong>ldap_sync_t</strong> structure as resulted from any previous call.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><strong>ldap</strong>(3), <strong>ldap_search_ext</strong>(3), <strong>ldap_result</strong>(3)<strong>;</strong> <strong>RFC 4533</strong> (http://www.rfc-editor.org),</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<p>Designed and implemented by Pierangelo Masarati, based on RFC 4533 and loosely inspired by syncrepl code in <strong>slapd</strong>(8).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">

<p>Initially developed by <strong>SysNet s.n.c.</strong> <strong>OpenLDAP</strong> is developed and maintained by The OpenLDAP Project (http://www.openldap.org/). <strong>OpenLDAP</strong> is derived from University of Michigan LDAP 3.3 Release.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lcong48_r.3.html"><span aria-hidden="true">&larr;</span> lcong48_r.3: generate uniformly distributed pseudo-random numbers reentrantly</a></li>
   <li class="next"><a href="ldexp.3.html">ldexp.3: multiply floating-point number by integral power of 2 <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
