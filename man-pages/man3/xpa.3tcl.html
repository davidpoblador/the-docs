<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>xpa: The \s-1xpa\s0 interface to the tcl/tk environment</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="The \s-1xpa\s0 interface to the tcl/tk environment">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="xpa (3tcl) manual">
  <meta name="twitter:description" content="The \s-1xpa\s0 interface to the tcl/tk environment">
  <meta name="twitter:image" content="https://www.carta.tech/images/tcl-xpa-xpa-3tcl.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3tcl/xpa.3tcl.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="xpa (3tcl) manual" />
  <meta property="og:description" content="The \s-1xpa\s0 interface to the tcl/tk environment" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/tcl-xpa-xpa-3tcl.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">xpa<small> (3tcl)</small></h1>
        <p class="lead">The \s-1xpa\s0 interface to the tcl/tk environment</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tcl/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tcl/xpa.3tcl.html">
      <span itemprop="name">xpa: The \s-1xpa\s0 interface to the tcl/tk environment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/tcl-xpa/">
      <span itemprop="name">tcl-xpa</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3tcl/xpa.3tcl.html">
      <span itemprop="name">xpa: The \s-1xpa\s0 interface to the tcl/tk environment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>Tcl/Tk programs can act as \s-1XPA\s0 clients and/or servers using the Tcl interface to \s-1XPA\s0 that is contained in the libtclxpa.so shared object.</p><p><strong>Server Routines</strong></p>
<pre>
  set xpa [xpanew class name help sproc sdata smode rproc rdata rmode]
  xpafree xpa
  set xpa [xpanew class name help iproc idata imode]
  set xpa [xpacmdnew class name]
  xpacmdadd xpa name help sproc sdata smode rproc rdata rmode
  xpacmddel xpa cmd
  set val [xparec xpa option]
    options: name, class, method, cmdfd, datafd, cmdchan, datachan
  xpasetbuf xpa buf len
  xpaerror xpa message
  xpamessage xpa message
</pre>
<p><strong>Client Routines</strong></p><p>  set xpa [xpaopen mode]   xpaclose xpa   set got [xpaget xpa template paramlist mode bufs lens names errs n]   set got [xpaget xpa template paramlist mode chans names errs n]   set got [xpaset xpa template paramlist mode buf len names errs n]   set got [xpasetfd xpa template paramlist mode chan names errs n]   set got [xpainfo xpa template paramlist mode names errs n]   # NB: 2.1 calling sequence change   # set got [xpaaccess template type] (2.0.5)   set got [xpaaccess xpa template paramlist mode names errs n]   set got [xpanslookup template type classes names methods]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>You can call <em>XPANew()</em>, <em>XPACmdNew()</em>, or <em>XPAInfoNew()</em> within a C routine to add C\-based \s-1XPA\s0 server callbacks to a TCL/Tk program that uses a Tcl/Tk event loop (either <em>vwait()</em> or the Tk event loop); Such a program does not need or want to use the \s-1XPA\s0 event loop. Therefore, in order to add \s-1XPA\s0 access points to the Tcl/Tk loop, the following routine should be called beforehand:</p><p>  int XPATclAddInput(XPA xpa);</p><p>Normally, the xpa argument is \s-1NULL\s0, meaning that all current \s-1XPA\s0 access points are registered with the event loop.  However, if a single \s-1XPA\s0 access point is to be added (i.e., after the event loop is started) then the handle of that \s-1XPA\s0 access point can be passed to this routine.</p><p>The significance of the \s-1XPA/TCL\s0 interface goes beyond the support for using \s-1XPA\s0 inside C code. The interface allows you to write \s-1XPA\s0 servers and to make calls to the \s-1XPA\s0 client interface within the Tcl environment using the Tcl language directly. The XPA/Tcl interface can be loaded using the following package command:</p><p>  package require tclxpa 2.0</p><p>Alternatively, you can load the shared object (called libtclxpa.so ) directly:</p><p>  load .../libtclxpa.so tclxpa</p><p>Once the tclxpa package is loaded, you can use Tcl versions of \s-1XPA\s0 routines to define \s-1XPA\s0 servers or make client \s-1XPA\s0 calls.  The interface for these routines is designed to match the Unix \s-1XPA\s0 interface as nearly as possible.  Please refer to \s-1XPA\s0 Servers and \s-1XPA\s0 Clients for general information about these routines.</p><p>The file test.tcl in the \s-1XPA\s0 source directory gives examples for using the XPA/Tcl interface.</p><p>The following notes describe the minor differences between the interfaces.</p><p><strong>XPANew</strong></p><p>  set xpa [xpanew class name help sproc sdata smode rproc rdata rmode]</p><p>rproc and sproc routines are routines.  The calling sequence of the rproc routine is identical to its C counterpart:</p><p>  proc rec_cb { xpa client_data paramlist buf len } { ... }</p><p>The sproc routine, however is slightly different from its C counterpart because of the difficulty of passing data back from the callback to C:</p><p>  proc sendcb { xpa client_data paramlist } { ... }</p><p>Note that the C\-based server's char **buf and int *len arguments are missing from the Tcl callback. This is because we did not know how to fill buf with data and pass it back to the C routines for communication with the client.  Instead, the Tcl server callback uses the following routine to set buf and len:</p><p>  xpasetbuf xpa buf len</p><p>where:</p><p>  arg           explanation   ------        -----------   xpa           the first argument of the server callback   buf           the data to be returned to the client   len           data length in bytes, (if absent, use length of the buf object)</p><p>When this routine is called, a copy of buf is saved for transmission to the client.</p><p>The fact that buf is duplicated means that \s-1TCL\s0 server writers might wish to perform the I/O directly within the callback, rather than have \s-1XPA\s0 do it automatically at the end of the routine.  To do this, set:</p><p>  fillbuf=false</p><p>in the xpanew smode and then perform I/O through the Tcl channel obtained from:</p><p>  set dchan [xparec $xpa datachan]</p><p>where:</p><p>  arg           explanation   ------        -----------   xpa           the first argument of the server callback   datachan      literal string "datachan" that returns the data channel   len           data length in bytes, (if absent, use length of the buf object)</p><p>\s-1NB:\s0 datachan and cmdchan are not available under Windows. It is necessary to use the \*(L"raw\*(R" equivalents: datafd and cmdfd.</p><p>The same considerations apply to the rproc for receive servers: a copy of the incoming data is generated to pass to the receive callback. This copy again can be avoided by using \*(L"fillbuf=false\*(R" in the rmode and then reading the incoming data from datachan.</p><p>The send and receive callback routines can use the xpaerror and xpamessage routines to send errors and messages back to the client.  If you also want tcl itself to field an error condition, use the standard return call:</p><p>  return ?\-code c? ?\-errorinfo i? ?\-errorcode ec? string</p><p>See the Tcl man page for more info.</p><p><strong>XPARec</strong></p><p>The Tcl xparec procedure supplies server routines with access to information that is available via macros in the C interface:</p><p>  set val [xparec xpa &lt;option&gt;]</p><p>where option is: name, class, method, cmdfd, datafd, cmdchan, datachan.  Note that two additional identifiers, cmdchan and datachan, have been added to to provide Tcl channels corresponding to datafd and cmdfd.  (These latter might still be retrieved in Tcl and passed back to a C routines.)  An additional option called \*(L"version\*(R" can be used to determine the \s-1XPA\s0 version used to build the Tcl interface. Note that the standard options require a valid \s-1XPA\s0 handle, but \*(L"version\*(R" does not (since it simply reports the value of the \s-1XPA_VERSION\s0 definition in the \s-1XPA\s0 source include file).</p><p>\s-1NB:\s0 datachan and cmdchan are not available under Windows. It is necessary to use the \*(L"raw\*(R" equivalents: datafd and cmdfd.</p><p>  macro         explanation   ------        -----------   class         class of this xpa   name          name of this xpa   method        method string (inet or local connect info)   cmdchan       Tcl channel of command socket   datachan      Tcl channel of data socket   cmdfd         fd of command socket   datafd        fd of data socket   sendian       endian\-ness of server ("little" or "big")   cendian       endian\-ness of client ("little" or "big"   version       XPA version used to build this code</p><p>Under Windows, the Tcl event handler cannot automatically sense when an \s-1XPA\s0 socket is ready for \s-1IO\s0 (i.e. <em>Tcl_CreateFileHandler()</em> is not available under Windows). The Windows Tcl event handler therefore must be awakened occasionally for check for \s-1XPA\s0 events. This is done using the standard <em>Tcl_SetMaxBlockTime()</em> call. The time parameter is defined in tclloop.c and is currently set to 1000 microseconds (1/1000 of a second).</p><p>The version option can be used to differentiate between source code versions. It was created to support legacy Tcl code that needs to maintain the 2.0.5 calling sequence for xpaaccess. You can use a version test such as:</p><p>  if [catch { xparec "" version } version] {     puts "pre\-2.1.0e"   } else {     puts [split $version .]   }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO xpa&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/xpa.7.html"><strong>xpa</strong>(7)</a> for a list of \s-1XPA\s0 help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="vfslib.3tcl.html"><span aria-hidden="true">&larr;</span> vfslib.3tcl: Procedures to interact with virtual filesystems</a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
