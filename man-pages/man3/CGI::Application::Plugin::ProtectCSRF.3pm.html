<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CGI::Application::Plugin::ProtectCSRF: Generate and verify anti-csrf tickets</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Generate and verify anti-csrf tickets">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CGI::Application::Plugin::ProtectCSRF (3pm) manual">
  <meta name="twitter:description" content="Generate and verify anti-csrf tickets">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcgi-application-plugin-protectcsrf-perl-CGI::Application::Plugin::ProtectCSRF-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/CGI::Application::Plugin::ProtectCSRF.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CGI::Application::Plugin::ProtectCSRF (3pm) manual" />
  <meta property="og:description" content="Generate and verify anti-csrf tickets" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcgi-application-plugin-protectcsrf-perl-CGI::Application::Plugin::ProtectCSRF-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CGI::Application::Plugin::ProtectCSRF<small> (3pm)</small></h1>
        <p class="lead">Generate and verify anti-csrf tickets</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::ProtectCSRF.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::ProtectCSRF: Generate and verify anti-csrf tickets</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcgi-application-plugin-protectcsrf-perl/">
      <span itemprop="name">libcgi-application-plugin-protectcsrf-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::ProtectCSRF.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::ProtectCSRF: Generate and verify anti-csrf tickets</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>1.01</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNPSIS</h2>
        <div class="sectioncontent">

<pre>
  use Your::App;
  use base qw(CGI::Application);
  use CGI::Application::Plugin::Session; # mandatory !!
  use CGI::Application::Plugin::ProtectCSRF;

  sub input_form : PublishCSRFID {
    my $self = shift;
    do_something();
  }

  sub finish : ProtectCSRF {
    my $self = shift;
    $self-&gt;clear_csrf_id;
    do_something();
  }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>CGI::Application::Plugin::ProtectCSRF provides tools to protect forms in CGI::Application web applications from \s-1CSRF\s0 attacks. Run mode handlers may be declared with the \*(C`PublishCSFRID\*(C' or \*(C`ProtectCSFR\*(C' attributes. The former should usually be applied to a run mode, whose \s-1HTML\s0 includes a \*(C`form\*(C' tag. In this case a ticket is generated and stored in the session during a prerun callback and a \*(C`hidden\*(C' control field, publishing the ticket, is added to the form during a postrun callback. Conversely the \*(C`ProtectCSRF\*(C' attribute should normally be applied to the corresponding run modes that process data from a submitted form. A prerun callback checks for the hidden field and checks that it matches the ticket saved in the session. If the check fails the page is redirected to a customizable error page. On success the form processing run mode should use the \*(C`clear_csrf_id\*(C' method, so that subsequent calls to forms from that session will generate fresh tickets.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACTION</h2>
        <div class="sectioncontent">
<h3>PublishCSRFID</h3>
<p>Run modes declared with the \*(C`PublishCSRFID\*(C' attribute, take the following actions:</p>
<dl class='dl-vertical'>
  <dt>
    - generate \s-1CSRF\s0 ticket and store it in the session;
  </dt>
  <dd>
    
  </dd>
  <dt>
    - generate the form as per the module code;
  </dt>
  <dd>
    
  </dd>
  <dt>
    - add a hidden element to the form publishing the \s-1CSRF\s0 ticket.
  </dt>
  <dd>
    
  </dd>

</dl>
<p>  # publish CSRF ticket   sub input_form : PublishCSRFID {     my $self = shift;     return &lt;&lt;HTML;   &lt;form action="foo" method="post"&gt;   &lt;input type="text" name="name"&gt;   &lt;input type="submit" value="submit!"&gt;   &lt;input type="hidden" name="rm" value="finish"&gt;   &lt;/form&gt;   HTML   }</p><p>  # display html source   &lt;form action="foo" method="post"&gt;   &lt;input type="hidden" name="_csrf_id" value="random string" /&gt; &lt;- insert hidden field   &lt;input type="text" name="name"&gt;   &lt;input type="submit" value="submit!"&gt;   &lt;input type="hidden" name="rm" value="finish"&gt;   &lt;/form&gt;</p>
<h3>ProtectCSRF</h3>
<p>Run modes declared with the \*(C`ProtectCSRF\*(C' attribute, take the following actions:</p>
<dl class='dl-vertical'>
  <dt>
    - verify that the submitted \s-1CSRF\s0 ticket matches the ticket saved in the session. If there is any sort of issue with the ticket the page is redirected to a customizable error page;
  </dt>
  <dd>
    
  </dd>
  <dt>
    - the form is processed as per the module code;
  </dt>
  <dd>
    
  </dd>

</dl>
<p>  sub finish : ProtectCSRF {     my $self = shift;</p><p>    # required! Unless forms and their processing are tightly     # coupled by clearing the ticket between invocations,     # the meaning of the ticket is lost.     $self-&gt;clear_csrf_id;</p><p>    # The processing that you want to perform (DB processing etc)     do_something();   }</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHOD</h2>
        <div class="sectioncontent">
<h3>csrf_id</h3>
<p>This method returns the \s-1CSRF\s0 ticket saved in the session.</p><p>Example:</p><p>  sub input_form : PublishCSRFID {     my $self = shift;</p><p>    my $csrf_id = $self-&gt;csrf_id;     do_something();   }</p>
<h3>protect_csrf_config</h3>
<p>This method initializes the ProtectCSRF state using any configuration options that were passed to it. The available options are:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>csrf_error_status</strong> - The \s-1HTTP\s0 status code that would be set on the \s-1CSRF\s0 error page if a \s-1CSRF\s0 attack is identified. It defaults to 200.
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>csrf_error_tmpl_param</strong> - A hashref of parameters to be placed in the above template. See HTML::Template.
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>csrf_post_only</strong> - If set non-POST requests to a run mode which is protected by this module would be rejected. By default this is 0.
  </dt>
  <dd>
    
  </dd>

</dl>
<p>Example:</p><p>  sub cgiapp_init {     my $self = shift;     $self-&gt;tmpl_path("/path/to/template");     $self-&gt;protect_csrf_config(                            csrf_error_status     =&gt; 403, # change forbidden                            csrf_error_tmpl       =&gt; "csrf_error.tmpl",                            csrf_error_tmpl_param =&gt; { TITLE =&gt; "CSRF ERROR", MESSAGE =&gt; "your access is csrf!"},                            csrf_id               =&gt; "ticket_id",                            csrf_post_only        =&gt; 1                          );   }</p><p>  # csrf_error.tmpl   &lt;html&gt;&lt;head&gt;&lt;title&gt;&lt;TMPL_VAR NAME=TITLE ESCAPE=HTML&gt;&lt;/title&gt;&lt;/head&gt;   &lt;body&gt;   &lt;h1&gt;CSRF Error&lt;/h1&gt;   &lt;span style="color: red"&gt;&lt;TMPL_VAR NAME=MESSAGE ESCAPE=HTML&gt;&lt;/span&gt;   &lt;/body&gt;   &lt;/html&gt;</p>
<h3>clear_csrf_id</h3>
<p>This method clears the \s-1CSFR\s0 ticket. This should be done during the processing of a form request.</p><p>Example :</p><p>  sub cgiapp_init {     my $self = shift;     $self-&gt;protect_csrf_config;   }</p><p>  sub input {     my $self = shift;     do_something(). # input form display..   }</p><p>  sub confirm : PublishCSRFID {     my $self = shift;     do_something(). # publish csrf_id and input check and confirm display..   }</p><p>  sub complete : ProtectCSRF {     my $self = shift;     $self-&gt;<strong>clear_csrf_id</strong>(1); # clear csrf_id for CSRF protect     do_something();          # DB insert etc..   }</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CALLBACK</h2>
        <div class="sectioncontent">
<h3>_publish_csrf_id</h3>
<p>prerun callback</p>
<h3>_csrf_forbidden</h3>
<p>prerun callback</p>
<h3>_add_csrf_id</h3>
<p>postrun callback</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAUTION</h2>
        <div class="sectioncontent">
<p>This module should not be seen as a panacea for all web security issues. The user should fully understand and act on all security threats his application may face, including whether this module is an adequate and useful tool.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO CGI::Application::Plugin::ProtectCSRF&hellip;</h2>
        <div class="sectioncontent">
<p>Attribute::Handlers, Carp, CGI::Application, CGI::Application::Plugin::Session, Digest::SHA, Exporter, HTML::TokeParser, HTML::Template</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Akira Horimoto &lt;kurt0027@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2006 - 2008 Akira Horimoto</p><p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CGI::Application::Plugin::MessageStack.3pm.html"><span aria-hidden="true">&larr;</span> CGI::Application::Plugin::MessageStack.3pm: A message stack for your cgi::application</a></li>
   <li class="next"><a href="CGI::Application::Plugin::RateLimit.3pm.html">CGI::Application::Plugin::RateLimit.3pm: Limits runmode call rate per user <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
