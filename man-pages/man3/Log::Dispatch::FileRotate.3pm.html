<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Log::Dispatch::FileRotate: Log to files that archive/rotate themselves</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Log to files that archive/rotate themselves">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Log::Dispatch::FileRotate (3pm) manual">
  <meta name="twitter:description" content="Log to files that archive/rotate themselves">
  <meta name="twitter:image" content="https://www.carta.tech/images/liblog-dispatch-filerotate-perl-Log::Dispatch::FileRotate-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Log::Dispatch::FileRotate.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Log::Dispatch::FileRotate (3pm) manual" />
  <meta property="og:description" content="Log to files that archive/rotate themselves" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liblog-dispatch-filerotate-perl-Log::Dispatch::FileRotate-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Log::Dispatch::FileRotate<small> (3pm)</small></h1>
        <p class="lead">Log to files that archive/rotate themselves</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Log::Dispatch::FileRotate.3pm.html">
      <span itemprop="name">Log::Dispatch::FileRotate: Log to files that archive/rotate themselves</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liblog-dispatch-filerotate-perl/">
      <span itemprop="name">liblog-dispatch-filerotate-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Log::Dispatch::FileRotate.3pm.html">
      <span itemprop="name">Log::Dispatch::FileRotate: Log to files that archive/rotate themselves</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  use Log::Dispatch::FileRotate;

  my $file = Log::Dispatch::FileRotate-&gt;new( name      =&gt; &apos;file1&apos;,
                                       min_level =&gt; &apos;info&apos;,
                                       filename  =&gt; &apos;Somefile.log&apos;,
                                       mode      =&gt; &apos;append&apos; ,
                                       size      =&gt; 10,
                                       max       =&gt; 6,
                                      );
  # or for a time based rotation

  my $file = Log::Dispatch::FileRotate-&gt;new( name      =&gt; &apos;file1&apos;,
                                       min_level =&gt; &apos;info&apos;,
                                       filename  =&gt; &apos;Somefile.log&apos;,
                                       mode      =&gt; &apos;append&apos; ,
                                       TZ        =&gt; &apos;AEDT&apos;,
                                       DatePattern =&gt; &apos;yyyy-dd-HH&apos;,
                                      );

  $file-&gt;log( level =&gt; &apos;info&apos;, message =&gt; "your comment&#92;n" );
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module provides a simple object for logging to files under the Log::Dispatch::* system, and automatically rotating them according to different constraints. This is basically a Log::Dispatch::File wrapper with additions. To that end the arguments</p><p>        name, min_level, filename and  mode</p><p>behave the same as Log::Dispatch::File. So see its man page (perldoc Log::Dispatch::File)</p><p>The arguments size and max specify the maximum size and maximum number of log files created. The size defaults to 10M and the max number of files defaults to 1. If DatePattern is not defined then we default to working in size mode. That is, use size values for deciding when to rotate.</p><p>Once DatePattern is defined FileRotate will move into time mode. Once this happens file rotation ignores size constraints and uses the defined date pattern constraints.</p><p>If you setup a config file using <em>Log::Log4perl::init_and_watch()</em> or the like, you can switch between modes just by commenting out the DatePattern line.</p><p>When using DatePattern make sure \s-1TZ\s0 is defined correctly and that the \s-1TZ\s0 you use is understood by Date::Manip. We use Date::Manip to generate our recurrences. Bad \s-1TZ\s0 equals bad recurrences equals surprises! Read the Date::Manip man page for more details on \s-1TZ\s0.</p><p>DatePattern will default to a daily rotate if your entered pattern is incorrect. You will also get a warning message.</p><p>If you have multiple writers that were started at different times you will find each writer will try to rotate the log file at a recurrence calculated from its start time. To sync all the writers just use a config file and update it after starting your last writer. This will cause Log::Dispatch::FileRotate-&gt;<em>new()</em> to be called by each of the writers close to the same time, and if your recurrences aren't too close together all should sync up just nicely.</p><p>I initially aasumed a long runinng process but it seems people are using this module as part of short running \s-1CGI\s0 programs. So, now we look at the last modified time stamp of the log file and compare it to a previous occurance of a DatePattern, on startup only. If the file stat shows the mtime to be earlier than the previous recurrance then I rotate the log file.</p><p>We handle multiple writers using <em>flock()</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DatePattern</h2>
        <div class="sectioncontent">
<p>As I said earlier we use Date::Manip for generating our recurrence events. This means we can understand Date::Manip's recurrence patterns and the normal log4j DatePatterns. We don't use DatePattern to define the extension of the log file though.</p><p>DatePattern can therefore take forms like:</p><p>      Date::Manip style             0:0:0:0:5:30:0       every 5 hours and 30 minutes             0:0:0:2*12:30:0      every 2 days at 12:30 (each day)             3*1:0:2:12:0:0       every 3 years on Jan 2 at noon</p><p>      DailyRollingFileAppender log4j style             yyyy-MM              every month             yyyy-ww              every week             yyyy-MM-dd           every day             yyyy-MM-dd-a         every day at noon             yyyy-MM-dd-HH        every hour             yyyy-MM-dd-HH-MM     every minute</p><p>To specify multiple recurrences in a single string separate them with a semicolon:</p>
<pre>
        yyyy-MM-dd; 0:0:0:2*12:30:0
</pre>
<p>This says we want to rotate every day \s-1AND\s0 every 2 days at 12:30. Put in as many as you like.</p><p>A complete description of Date::Manip recurrences is beyond us here except to quote (from the man page):</p><p>           A recur description is a string of the format            Y:M:W:D:H:MN:S .  Exactly one of the colons may            optionally be replaced by an asterisk, or an asterisk            may be prepended to the string.</p><p>           Any value "N" to the left of the asterisk refers to            the "Nth" one.  Any value to the right of the asterisk            refers to a value as it appears on a calendar/clock.            Values to the right can be listed a single values,            ranges (2 numbers separated by a dash "-"), or a comma            separated list of values or ranges.  In a few cases,            negative values are appropriate.</p><p>           This is best illustrated by example.</p><p>             0:0:2:1:0:0:0        every 2 weeks and 1 day              0:0:0:0:5:30:0       every 5 hours and 30 minutes              0:0:0:2*12:30:0      every 2 days at 12:30 (each day)              3*1:0:2:12:0:0       every 3 years on Jan 2 at noon              0:1*0:2:12,14:0:0    2nd of every month at 12:00 and 14:00              1:0:0*45:0:0:0       45th day of every year              0:1*4:2:0:0:0        4th tuesday (day 2) of every month              0:1*-1:2:0:0:0       last tuesday of every month              0:1:0*-2:0:0:0       2nd to last day of every month</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<ul>
<li><p>new(%p) This method takes a hash of parameters.  The following options are valid:</p>
<dl class='dl-vertical'>
  <dt>
    -- name ($)
  </dt>
  <dd>
    <p>The name of the object (not the filename!).  Required.</p>
  </dd>
  <dt>
    -- size ($)
  </dt>
  <dd>
    <p>The maxium (or close to) size the log file can grow too.</p>
  </dd>
  <dt>
    -- max ($)
  </dt>
  <dd>
    <p>The maxium number of log files to create.</p>
  </dd>
  <dt>
    -- \s-1TZ\s0 ($)
  </dt>
  <dd>
    <p>The TimeZone time based calculations should be done in. This should match Date::Manip's concept of timezones and of course your machines timezone.</p>
  </dd>
  <dt>
    -- DatePattern ($)
  </dt>
  <dd>
    <p>The DatePattern as defined above.</p>
  </dd>
  <dt>
    -- min_level ($)
  </dt>
  <dd>
    <p>The minimum logging level this object will accept.  See the Log::Dispatch documentation for more information.  Required.</p>
  </dd>
  <dt>
    -- max_level ($)
  </dt>
  <dd>
    <p>The maximum logging level this obejct will accept.  See the Log::Dispatch documentation for more information.  This is not required.  By default the maximum is the highest possible level (which means functionally that the object has no maximum).</p>
  </dd>
  <dt>
    -- filename ($)
  </dt>
  <dd>
    <p>The filename to be opened for writing. This is the base name. Rotated log files will be renamed filename.1 thru to filename.\*(C`max\*(C'. Where max is the paramater defined above.</p>
  </dd>
  <dt>
    -- mode ($)
  </dt>
  <dd>
    <p>The mode the file should be opened with.  Valid options are 'write', '&gt;', 'append', '&gt;&gt;', or the relevant constants from Fcntl.  The default is 'write'.</p>
  </dd>
  <dt>
    -- autoflush ($)
  </dt>
  <dd>
    <p>Whether or not the file should be autoflushed.  This defaults to true.</p>
  </dd>
  <dt>
    -- callbacks( &#92;& or [ &#92;&, &#92;&, ... ] )
  </dt>
  <dd>
    <p>This parameter may be a single subroutine reference or an array reference of subroutine references.  These callbacks will be called in the order they are given and passed a hash containing the following keys:  ( message =&gt; $log_message, level =&gt; $log_level ) The callbacks are expected to modify the message and then return a single scalar containing that modified message.  These callbacks will be called when either the \*(C`log\*(C' or \*(C`log_to\*(C' methods are called and will only be applied to a given message once.</p>
  </dd>
  <dt>
    -- \s-1DEBUG\s0 ($)
  </dt>
  <dd>
    <p>Turn on lots of warning messages to \s-1STDERR\s0 about what this module is doing if set to 1. Really only useful to me.</p>
  </dd>

</dl>
</li><li><p>log_message( message =&gt; $ ) Sends a message to the appropriate output.  Generally this shouldn't be called directly but should be called through the \*(C`log()\*(C' method (in Log::Dispatch::Output).</p></li><li><p>setDatePattern( $ or [ $, $, ... ] ) Set a new suite of recurrances for file rotation. You can pass in a single string or a reference to an array of strings. Multiple recurrences can also be define within a single string by seperating them with a semi-colon (;) See the discussion above regarding the setDatePattern paramater for more details.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TODO</h2>
        <div class="sectioncontent">
<p>compression, signal based rotates, proper test suite</p><p>Could possibly use Logfile::Rotate as well/instead.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Mark Pfeiffer, &lt;markpf at mlp-consulting dot com dot au&gt; inspired by Dave Rolsky's, &lt;autarch at urth dot org&gt;, code :-)</p><p>Kevin Goess &lt;cpan at goess dot org&gt; suggested multiple writers should be supported. He also conned me into doing the time based stuff. Thanks Kevin! :-)</p><p>Thanks also to Dan Waldheim for helping with some of the locking issues in a forked environment.</p><p>And thanks to Stephen Gordon for his more portable code on lockfile naming.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Copyright</h2>
        <div class="sectioncontent">
<p>Copyright 2005-2006, Mark Pfeiffer</p><p>This code may be copied only under the terms of the Artistic License, or \s-1GPL\s0 License which may be found in the Perl 5 source kit.</p><p>Use 'perldoc perlartistic' to see the Artistic License. Use 'perldoc perlgpl' to see the \s-1GNU\s0 General Public License.</p><p>Complete documentation for Perl, including \s-1FAQ\s0 lists, should be found on this system using `man perl' or `perldoc perl'.  If you have access to the Internet, point your browser at http://www.perl.org/, the Perl Home Page.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Log::Dispatch::Configurator::AppConfig.3pm.html"><span aria-hidden="true">&larr;</span> Log::Dispatch::Configurator::AppConfig.3pm: Configurator implementation with appconfig</a></li>
   <li class="next"><a href="Log::Dispatch::Perl.3pm.html">Log::Dispatch::Perl.3pm: Use core perl functions for logging <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
