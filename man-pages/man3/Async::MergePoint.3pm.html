<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Async::MergePoint: Resynchronise diverged control flow</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Resynchronise diverged control flow">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Async::MergePoint (3pm) manual">
  <meta name="twitter:description" content="Resynchronise diverged control flow">
  <meta name="twitter:image" content="https://www.carta.tech/images/libasync-mergepoint-perl-Async::MergePoint-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Async::MergePoint.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Async::MergePoint (3pm) manual" />
  <meta property="og:description" content="Resynchronise diverged control flow" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libasync-mergepoint-perl-Async::MergePoint-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Async::MergePoint<small> (3pm)</small></h1>
        <p class="lead">Resynchronise diverged control flow</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Async::MergePoint.3pm.html">
      <span itemprop="name">Async::MergePoint: Resynchronise diverged control flow</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libasync-mergepoint-perl/">
      <span itemprop="name">libasync-mergepoint-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Async::MergePoint.3pm.html">
      <span itemprop="name">Async::MergePoint: Resynchronise diverged control flow</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
 use Async::MergePoint;

 my $merge = Async::MergePoint-&gt;new(
    needs =&gt; [ "leaves", "water" ],
 );

 my $water;
 Kettle-&gt;boil(
    on_boiled =&gt; sub { $water = shift; $merge-&gt;done( "water" ); }
 );

 my $tea_leaves;
 Cupboard-&gt;get_tea_leaves(
    on_fetched =&gt; sub { $tea_leaves = shift; $merge-&gt;done( "leaves" ); }
 );

 $merge-&gt;close(
    on_finished =&gt; sub {
       # Make tea using $water and $tea_leaves
    }
 );
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Often in program logic, multiple different steps need to be taken that are independent of each other, but their total result is needed before the next step can be taken. In synchonous code, the usual approach is to do them sequentially.</p><p>An asynchronous or event-based program could do this, but if each step involves some \s-1IO\s0 idle time, better overall performance can often be gained by running the steps in parallel. A \*(C`Async::MergePoint\*(C' object can then be used to wait for all of the steps to complete, before passing the combined result of each step on to the next stage.</p><p>A merge point maintains a set of outstanding operations it is waiting on; these are arbitrary string values provided at the object's construction. Each time the \*(C`done()\*(C' method is called, the named item is marked as being complete. When all of the required items are so marked, the \*(C`on_finished\*(C' continuation is invoked.</p><p>For use cases where code may be split across several different lexical scopes, it may not be convenient or possible to share a lexical variable, to pass on the result of some asynchronous operation. In these cases, when an item is marked as complete a value can also be provided which contains the results of that step. The \*(C`on_finished\*(C' callback is passed a hash (in list form, rather than by reference) of the collected item values.</p><p>This module was originally part of the IO::Async distribution, but was removed under the inspiration of Pedro Melo's Async::Hooks distribution, because it doesn't itself contain anything IO-specific.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONSTRUCTOR</h2>
        <div class="sectioncontent">
<p>This function returns a new instance of a \*(C`Async::MergePoint\*(C' object. The %params hash takes the following keys:</p>
<dl class='dl-vertical'>
  <dt>
    needs =&gt; \s-1ARRAY\s0
  </dt>
  <dd>
    <p>Optional. An array containing unique item names to wait on. The order of this array is not significant.</p>
  </dd>
  <dt>
    on_finished =&gt; \s-1CODE\s0
  </dt>
  <dd>
    <p>Optional. \s-1CODE\s0 reference to the continuation for when the merge point becomes ready. If provided, will be passed to the \*(C`close\*(C' method.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>Allows an \*(C`on_finished\*(C' continuation to be set if one was not provided to the constructor.</p>
<dl class='dl-vertical'>
  <dt>
    on_finished =&gt; \s-1CODE\s0
  </dt>
  <dd>
    <p>\s-1CODE\s0 reference to the continuation for when the merge point becomes ready.</p>
  </dd>

</dl>
<p>The \*(C`on_finished\*(C' continuation will be called when every key in the \*(C`needs\*(C' list has been notified by the \*(C`done()\*(C' method. It will be called as</p><p> $on_finished-&gt;( %items )</p><p>where the %items hash will contain the item names that were waited on, and the values passed to the \*(C`done()\*(C' method for each one. Note that this is passed as a list, not as a \s-1HASH\s0 reference.</p><p>While this feature can be used to pass data from the component parts back up into the continuation, it may be more direct to use normal lexical variables instead. This method allows the continuation to be placed after the blocks of code that execute the component parts, so it reads downwards, and may make it more readable. When called on an open MergePoint (i.e. one that does not yet have an \*(C`on_finished\*(C' continuation), this method adds extra key names to the set of outstanding names. The order of this list is not significant.</p><p>This method throws an exception if the MergePoint is already closed. This method informs the merge point that the $item is now ready, and passes it a value to store, to be passed into the \*(C`on_finished\*(C' continuation. If this call gives the final remaining item being waited for, the \*(C`on_finished\*(C' continuation is called within it, and the method will not return until it has completed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<h3>Asynchronous Plugins</h3>
<p>Consider a program using \*(C`Module::Pluggable\*(C' to provide a plugin architecture to respond to events, where sometimes the response to an event may require asynchronous work. A \*(C`MergePoint\*(C' object can be used to coordinate the responses from the plugins to this event.</p><p> my $merge = Async::MergePoint-&gt;new();</p><p> foreach my $plugin ( $self-&gt;plugins ) {     $plugin-&gt;handle_event( "event", $merge, @args );  }</p><p> $merge-&gt;close( on_finished =&gt; sub {     my %results = @_;     print "All plugins have recognised $event&#92;n";  } );</p><p>Each plugin that wishes to handle the event can use its own package name, for example, as its unique key name for the MergePoint. A plugin handling the event synchonously could perform something such as:</p><p> sub handle_event  {     my ( $event, $merge, @args ) = @_;     ....     $merge-&gt;needs( _\|_PACKAGE_\|_ );     $merge-&gt;done( _\|_PACKAGE_\|_ =&gt; $result );  }</p><p>Whereas, to handle the event asynchronously the plugin can instead perform:</p><p> sub handle_event  {     my ( $event, $merge, @args ) = @_;     ....     $merge-&gt;needs( _\|_PACKAGE_\|_ );</p><p>    sometime_later( sub {        $merge-&gt;done( _\|_PACKAGE_\|_ =&gt; $result );     } );  }</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Paul Evans &lt;leonerd@leonerd.org.uk&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Astro::FITS::Header::NDF.3pm.html"><span aria-hidden="true">&larr;</span> Astro::FITS::Header::NDF.3pm: Manipulate fits headers from ndf files</a></li>
   <li class="next"><a href="AtomBus.3pm.html">AtomBus.3pm: An atompub server for messaging. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
