<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTTP::OAI::Harvester: Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="HTTP::OAI::Harvester (3pm) manual">
  <meta name="twitter:description" content="Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories">
  <meta name="twitter:image" content="https://www.carta.tech/images/libhttp-oai-perl-HTTP::OAI::Harvester-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/HTTP::OAI::Harvester.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="HTTP::OAI::Harvester (3pm) manual" />
  <meta property="og:description" content="Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libhttp-oai-perl-HTTP::OAI::Harvester-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">HTTP::OAI::Harvester<small> (3pm)</small></h1>
        <p class="lead">Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/HTTP::OAI::Harvester.3pm.html">
      <span itemprop="name">HTTP::OAI::Harvester: Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libhttp-oai-perl/">
      <span itemprop="name">libhttp-oai-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/HTTP::OAI::Harvester.3pm.html">
      <span itemprop="name">HTTP::OAI::Harvester: Agent for harvesting from open archives version 1.0, 1.1, 2.0 and static ('2.0s') compatible repositories</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>\*(C`HTTP::OAI::Harvester\*(C' is the harvesting front-end in the OAI-PERL library.</p><p>To harvest from an OAI-PMH compliant repository create an \*(C`HTTP::OAI::Harvester\*(C' object using the baseURL option and then call OAI-PMH methods to request data from the repository. To handle version 1.0/1.1 repositories automatically you <strong>must</strong> request \*(C`Identify()\*(C' first.</p><p>It is recommended that you request an Identify from the Repository and use the \*(C`repository()\*(C' method to update the Identify object used by the harvester.</p><p>When making \s-1OAI\s0 requests the underlying HTTP::OAI::UserAgent module will take care of automatic redirection (http code 302) and retry-after (http code 503). OAI-PMH flow control (i.e. resumption tokens) is handled transparently by \*(C`HTTP::OAI::Response\*(C'.</p><h3>Static Repository Support</h3>
<p>Static repositories are automatically and transparently supported within the existing \s-1API\s0. To harvest a static repository specify the repository \s-1XML\s0 file using the baseURL argument to HTTP::OAI::Harvester. An initial request is made that determines whether the base \s-1URL\s0 specifies a static repository or a normal \s-1OAI\s0 1.x/2.0 \s-1CGI\s0 repository. To prevent this initial request state the \s-1OAI\s0 version using an HTTP::OAI::Identify object e.g.</p>
<pre>
        $h = HTTP::OAI::Harvester-&gt;new(
                repository=&gt;HTTP::OAI::Identify-&gt;new(
                        baseURL =&gt; &apos;http://arXiv.org/oai2&apos;,
                        version =&gt; &apos;2.0&apos;,
        ));
</pre>
<p>If a static repository is found the response is cached, and further requests are served by that cache. Static repositories do not support sets, and will result in a noSetHierarchy error if you try to use sets. You can determine whether the repository is static by checking the version ($ha-&gt;repository-&gt;version), which will be \*(L"2.0s\*(R" for static repositories.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FURTHER READING</h2>
        <div class="sectioncontent">
<p>You should refer to the Open Archives Protocol version 2.0 and other \s-1OAI\s0 documentation, available from http://www.openarchives.org/.</p><p>Note OAI-PMH 1.0 and 1.1 are deprecated.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BEFORE USING EXAMPLES</h2>
        <div class="sectioncontent">
<p>In the examples I use arXiv.org's and cogprints \s-1OAI\s0 interfaces. To avoid causing annoyance to their server administrators please contact them before performing testing or large downloads (or use other, less loaded, servers for testing).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>        use HTTP::OAI;</p><p>        my $h = new HTTP::OAI::Harvester(baseURL=&gt;&apos;http://arXiv.org/oai2&apos;);         my $response = $h-&gt;repository($h-&gt;Identify)         if( $response-&gt;is_error ) {                 print "Error requesting Identify:&#92;n",                         $response-&gt;code . " " . $response-&gt;message, "&#92;n";                 exit;         }</p><p>        # Note: repositoryVersion will always be 2.0, $r-&gt;version returns         # the actual version the repository is running         print "Repository supports protocol version ", $response-&gt;version, "&#92;n";</p><p>        # Version 1.x repositories don&apos;t support metadataPrefix,         # but OAI-PERL will drop the prefix automatically         # if an Identify was requested first (as above)         $response = $h-&gt;ListIdentifiers(                 metadataPrefix=&gt;&apos;oai_dc&apos;,                 from=&gt;&apos;2001-02-03&apos;,                 until=&gt;&apos;2001-04-10&apos;         );</p><p>        if( $response-&gt;is_error ) {                 die("Error harvesting: " . $response-&gt;message . "&#92;n");         }</p><p>        print "responseDate =&gt; ", $response-&gt;responseDate, "&#92;n",                 "requestURL =&gt; ", $response-&gt;requestURL, "&#92;n";</p><p>        while( my $id = $response-&gt;next ) {                 print "identifier =&gt; ", $id-&gt;identifier;                 # Only available from OAI 2.0 repositories                 print " (", $id-&gt;datestamp, ")" if $id-&gt;datestamp;                 print " (", $id-&gt;status, ")" if $id-&gt;status;                 print "&#92;n";                 # Only available from OAI 2.0 repositories                 for( $id-&gt;setSpec ) {                         print "&#92;t", $_, "&#92;n";                 }         }</p><p>        # Using a handler         $response = $h-&gt;ListRecords(                 metadataPrefix=&gt;&apos;oai_dc&apos;,                 handlers=&gt;{metadata=&gt;&apos;HTTP::OAI::Metadata::OAI_DC&apos;},         );         while( my $rec = $response-&gt;next ) {                 print $rec-&gt;identifier, "&#92;t",                         $rec-&gt;datestamp, "&#92;n",                         $rec-&gt;metadata, "&#92;n";                 print join(&apos;,&apos;, @{$rec-&gt;metadata-&gt;dc-&gt;{&apos;title&apos;}}), "&#92;n";         }         if( $rec-&gt;is_error ) {                 die $response-&gt;message;         }</p><p>        # Offline parsing         $I = HTTP::OAI::Identify-&gt;new();         $I-&gt;parse_string($content);         $I-&gt;parse_file($fh);</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>This constructor method returns a new instance of \*(C`HTTP::OAI::Harvester\*(C'. Requires either an HTTP::OAI::Identify object, which in turn must contain a baseURL, or a baseURL from which to construct an Identify object. Any other parameters are passed to the HTTP::OAI::UserAgent module, and from there to the LWP::UserAgent module.         $h = HTTP::OAI::Harvester-&gt;new(                 baseURL =&gt;      &apos;http://arXiv.org/oai2&apos;,                 resume=&gt;0, # Suppress automatic resumption         )         $id = $h-&gt;repository();         $h-&gt;repository($h-&gt;Identify);</p><p>        $h = HTTP::OAI::Harvester-&gt;new(                 HTTP::OAI::Identify-&gt;new(                         baseURL =&gt; &apos;http://arXiv.org/oai2&apos;,         )); Returns and optionally sets the HTTP::OAI::Identify object used by the Harvester agent. If set to true (default) resumption tokens will automatically be handled by requesting the next partial list during \*(C`next()\*(C' calls.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OAI-PMH Verbs</h2>
        <div class="sectioncontent">
<p>The 6 OAI-PMH Verbs are the requests supported by an OAI-PMH interface.</p><h3>Error Messages</h3>
<p>Use \*(C`is_success()\*(C' or \*(C`is_error()\*(C' on the returned object to determine whether an error occurred (see HTTP::OAI::Response).</p><p>\*(C`code()\*(C' and \*(C`message()\*(C' return the error code (200 is success) and a human-readable message respectively. Errors returned by the repository can be retrieved using the \*(C`errors()\*(C' method:</p><p>        foreach my $error ($r-&gt;errors) {                 print $error-&gt;code, "&#92;t", $error-&gt;message, "&#92;n";         }</p><p>Note: \*(C`is_success()\*(C' is true for the \s-1OAI\s0 Error Code \*(C`noRecordsMatch\*(C' (i.e. empty set), although \*(C`errors()\*(C' will still contain the \s-1OAI\s0 error.</p>
<h3>Flow Control</h3>
<p>If the response contained a resumption token this can be retrieved using the $r-&gt;resumptionToken method.</p>
<h3>Methods</h3>
<p>These methods return an object subclassed from HTTP::Response (where the class corresponds to the verb requested, e.g. \*(C`GetRecord\*(C' requests return an \*(C`HTTP::OAI::GetRecord\*(C' object). Get a single record from the repository identified by identifier, in format metadataPrefix.         $gr = $h-&gt;GetRecord(                 identifier      =&gt;      &apos;oai:arXiv:hep-th/0001001&apos;, # Required                 metadataPrefix  =&gt;      &apos;oai_dc&apos; # Required         );         $rec = $gr-&gt;next;         die $rec-&gt;message if $rec-&gt;is_error;         printf("%s (%s)&#92;n", $rec-&gt;identifier, $rec-&gt;datestamp);         $dom = $rec-&gt;metadata-&gt;dom; Get information about the repository.         $id = $h-&gt;Identify();         print join &apos;,&apos;, $id-&gt;adminEmail; Retrieve the identifiers, datestamps, sets and deleted status for all records within the specified date range (from/until) and set spec (set). 1.x repositories will only return the identifier. Or, resume an existing harvest by specifying resumptionToken.         $lr = $h-&gt;ListIdentifiers(                 metadataPrefix  =&gt;      &apos;oai_dc&apos;, # Required                 from            =&gt;              &apos;2001-10-01&apos;,                 until           =&gt;              &apos;2001-10-31&apos;,                 set=&gt;&apos;physics:hep-th&apos;,         );         while($rec = $lr-&gt;next)         {                 { ... do something with $rec ... }         }         die $lr-&gt;message if $lr-&gt;is_error; List available metadata formats. Given an identifier the repository should only return those metadata formats for which that item can be disseminated.         $lmdf = $h-&gt;ListMetadataFormats(                 identifier =&gt; &apos;oai:arXiv.org:hep-th/0001001&apos;         );         for($lmdf-&gt;metadataFormat) {                 print $_-&gt;metadataPrefix, "&#92;n";         }         die $lmdf-&gt;message if $lmdf-&gt;is_error; Return full records within the specified date range (from/until), set and metadata format. Or, specify a resumption token to resume a previous partial harvest.         $lr = $h-&gt;ListRecords(                 metadataPrefix=&gt;&apos;oai_dc&apos;, # Required                 from    =&gt;      &apos;2001-10-01&apos;,                 until   =&gt;      &apos;2001-10-01&apos;,                 set             =&gt;      &apos;physics:hep-th&apos;,         );         while($rec = $lr-&gt;next)         {                 { ... do something with $rec ... }         }         die $lr-&gt;message if $lr-&gt;is_error; Return a list of sets provided by the repository. The scope of sets is undefined by OAI-PMH, so therefore may represent any subset of a collection. Optionally provide a resumption token to resume a previous partial request.         $ls = $h-&gt;ListSets();         while($set = $ls-&gt;next)         {                 print $set-&gt;setSpec, "&#92;n";         }         die $ls-&gt;message if $ls-&gt;is_error;</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>These modules have been written by Tim Brody &lt;tdb01r@ecs.soton.ac.uk&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="HTTP::OAI::GetRecord.3pm.html"><span aria-hidden="true">&larr;</span> HTTP::OAI::GetRecord.3pm: An oai getrecord response</a></li>
   <li class="next"><a href="HTTP::OAI::Header.3pm.html">HTTP::OAI::Header.3pm: Encapsulates an oai header structure <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
