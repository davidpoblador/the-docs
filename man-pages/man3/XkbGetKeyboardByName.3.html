<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>XkbGetKeyboardByName: Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="XkbGetKeyboardByName (3) manual">
  <meta name="twitter:description" content="Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one">
  <meta name="twitter:image" content="https://www.carta.tech/images/libx11-doc-XkbGetKeyboardByName-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/XkbGetKeyboardByName.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="XkbGetKeyboardByName (3) manual" />
  <meta property="og:description" content="Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libx11-doc-XkbGetKeyboardByName-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">XkbGetKeyboardByName<small> (3)</small></h1>
        <p class="lead">Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/XkbGetKeyboardByName.3.html">
      <span itemprop="name">XkbGetKeyboardByName: Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libx11-doc/">
      <span itemprop="name">libx11-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/XkbGetKeyboardByName.3.html">
      <span itemprop="name">XkbGetKeyboardByName: Build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>XkbDescPtr XkbGetKeyboardByName</strong> <strong>(\^Display *</strong><em>dpy</em><strong>\^,</strong> <strong>unsigned int </strong><em>device_spec</em><strong>\^,</strong> <strong>XkbComponentNamesPtr </strong><em>names</em><strong>\^,</strong> <strong>unsigned int </strong><em>want</em><strong>\^,</strong> <strong>unsigned int </strong><em>need</em><strong>\^,</strong> <strong>Bool </strong><em>load</em><strong>\^);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ARGUMENTS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>- dpy</em></p>
  </dt>
  <dd>
    <p>connection to X server</p>
  </dd>
  <dt>
    <p><em>- device_spec</em></p>
  </dt>
  <dd>
    <p>device ID, or XkbUseCoreKbd</p>
  </dd>
  <dt>
    <p><em>- names</em></p>
  </dt>
  <dd>
    <p>names of components to fetch</p>
  </dd>
  <dt>
    <p><em>- want</em></p>
  </dt>
  <dd>
    <p>desired structures in returned record</p>
  </dd>
  <dt>
    <p><em>- need</em></p>
  </dt>
  <dd>
    <p>mandatory structures in returned record</p>
  </dd>
  <dt>
    <p><em>- load</em></p>
  </dt>
  <dd>
    <p>True =&gt; load into <em>device_spec</em></p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>A client may request that the server fetch one or more components from its database and use those components to build a new server keyboard description. The new keyboard description may be built from scratch, or it may be built starting with the current keyboard description for a particular device. Once the keyboard description is built, all or part of it may be returned to the client. The parts returned to the client need not include all of the parts used to build the description. At the time it requests the server to build a new keyboard description, a client may also request that the server use the new description internally to replace the current keyboard description for a specific device, in which case the behavior of the device changes accordingly.</p><p>To build a new keyboard description from a set of named components, and to optionally have the server use the resulting description to replace an active one, use <em>XkbGetKeyboardByName.</em></p><p><em>names</em> contains a set of expressions describing the keyboard components the server should use to build the new keyboard description. <em>want</em> and <em>need</em> are bit fields describing the parts of the resulting keyboard description that should be present in the returned XkbDescRec.</p><p>The individual fields in <em>names</em> are <em>component expressions</em> composed of keyboard component names (no wildcarding as may be used in <em>XkbListComponents),</em> the special component name symbol `%', and the special operator characters `+' and `|'. A component expression is parsed left to right, as follows:</p><ul>
<li><p>The special component name "computed" may be used in keycodes component expressions and refers to a component consisting of a set of keycodes computed automatically by the server as needed.</p></li><li><p>The special component name "canonical" may be used in types component expressions and refers to a partial component defining the four standard key types: ALPHABETIC, ONE_LEVEL, TWO_LEVEL, and KEYPAD.</p></li><li><p>The special component name `%' refers to the keyboard description for the device specified in device_spec or the keymap names component. If a keymap names component is specified that does not begin with `+' or `|' and does not contain `%', then `%' refers to the description generated by the keymap names component. Otherwise, it refers to the keyboard description for device_spec.</p></li><li><p>The `+' operator specifies that the following component should override the currently assembled description; any definitions that are present in both components are taken from the second.</p></li><li><p>The `|' operator specifies that the next specified component should augment the currently assembled description; any definitions that are present in both components are taken from the first.</p></li><li><p>If the component expression begins with an operator, a leading `%' is implied.</p></li><li><p>If any unknown or illegal characters appear anywhere in the expression, the entire expression is invalid and is ignored.</p><p>For example, if <em>names-&gt;symbols</em> contained the expression "+de", it specifies that the default member of the "de" class of symbols should be applied to the current keyboard mapping, overriding any existing definitions (it could also be written "+de(default)").</p><p>Here is a slightly more involved example: the expression "acme(ascii)+de(basic)|iso9995-3" constructs a German (de) mapping for the ASCII keyboard supplied by the "acme" vendor. The new definition begins with the symbols for the ASCII keyboard for Acme <em>(acme(ascii)),</em> overrides them with definitions for the basic German keyboard <em>(de(basic)),</em> and then applies the definitions from the default iso9995-3 keyboard <em>(iso9995-3)</em> to any undefined keys or groups of keys (part three of the iso9995 standard defines a common set of bindings for the secondary group, but allows national layouts to override those definitions where necessary).</p><p><strong>NOTE</strong> The interpretation of the above expression components (acme, ascii, de, basic, iso9995-3) is not defined by Xkb; only the operations and their ordering are.</p><p>Note that the presence of a keymap <em>names</em> component that does not contain `%' (either explicit or implied by virtue of an expression starting with an operator) indicates a description that is independent of the keyboard description for the device specified in <em>device_spec.</em> The same is true of requests in which the keymap names component is empty and all five other names components contain expressions void of references to `%'. Requests of this form allow you to deal with keyboard definitions independent of any actual device.</p><p>The server parses all non-NULL fields in <em>names</em> and uses them to build a keyboard description. However, before parsing the expressions in <em>names,</em> the server ORs the bits in <em>want</em> and <em>need</em> together and examines the result in relationship to the expressions in <em>names.</em> Table 1 identifies the components that are required for each of the possible bits in <em>want</em> or <em>need.</em> If a required component has not been specified in the <em>names structure (the corresponding field is NULL), the server substitutes the</em> expression "%", resulting in the component values being taken from <em>device_spec.</em> In addition, if <em>load</em> is True, the server modifies <em>names</em> if necessary (again using a "%" entry) to ensure all of the following fields are non-NULL: <em>types, keycodes, symbols,</em> and <em>compat.</em></p><table class="table table-striped">
<tr>
<th>Table 1 Want and Need Mask Bits and Required Names Components</th>
<th></th>
<th></th></tr>

<tr>
<td>want or need mask bit</td>
<td>Required names Components</td>
<td>value</td></tr>

<tr>
<td>XkbGBN_TypesMask</td>
<td>Types</td>
<td>(1L&lt;&lt;0)</td></tr>

<tr>
<td>XkbGBN_CompatMapMask</td>
<td>Compat</td>
<td>(1L&lt;&lt;1)</td></tr>

<tr>
<td>XkbGBN_ClientSymbolsMask</td>
<td>Types + Symbols + Keycodes</td>
<td>(1L&lt;&lt;2)</td></tr>

<tr>
<td>XkbGBN_ServerSymbolsMask</td>
<td>Types + Symbols + Keycodes</td>
<td>(1L&lt;&lt;3)</td></tr>

<tr>
<td>XkbGBN_SymbolsMask</td>
<td>Symbols</td>
<td>(1L&lt;&lt;1)</td></tr>

<tr>
<td>XkbGBN_IndicatorMapMask</td>
<td>Compat</td>
<td>(1L&lt;&lt;4)</td></tr>

<tr>
<td>XkbGBN_KeyNamesMask</td>
<td>Keycodes</td>
<td>(1L&lt;&lt;5)</td></tr>

<tr>
<td>XkbGBN_GeometryMask</td>
<td>Geometry</td>
<td>(1L&lt;&lt;6)</td></tr>

<tr>
<td>XkbGBN_OtherNamesMask</td>
<td>Types + Symbols + Keycodes + Compat + Geometry</td>
<td>(1L&lt;&lt;7)</td></tr>

<tr>
<td>XkbGBN_AllComponentsMask</td>
<td></td>
<td>(0xff)</td></tr>
</table><p><em>need</em> specifies a set of keyboard components that the server must be able to resolve in order for <em>XkbGetKeyboardByName</em> to succeed; if any of the components specified in <em>need</em> cannot be successfully resolved, <em>XkbGetKeyboardByName</em> fails.</p><p><em>want</em> specifies a set of keyboard components that the server should attempt to resolve, but that are not mandatory. If the server is unable to resolve any of these components, <em>XkbGetKeyboardByName</em> still succeeds. Bits specified in <em>want</em> that are also specified in <em>need</em> have no effect in the context of <em>want.</em></p><p>If <em>load</em> is True, the server updates its keyboard description for <em>device_spec</em> to match the result of the keyboard description just built. If load is False, the server's description for device <em>device_spec</em> is not updated. In all cases, the parts specified by <em>want</em> and <em>need</em> from the just-built keyboard description are returned.</p><p>The <em>names</em> structure in an XkbDescRec keyboard description record contains one field for each of the five component types used to build a keyboard description. When a keyboard description is built from a set of database components, the corresponding fields in this <em>names</em> structure are set to match the expressions used to build the component.</p><p>Building a New Keyboard Description from the Server Database</p><p>The information returned to the client in the XkbDescRec is essentially the result of a series of calls to extract information from a fictitious device whose description matches the one just built. The calls corresponding to each of the mask bits are summarized in Table 2, together with the XkbDescRec components that are filled in.</p><table class="table table-striped">
<tr>
<th>Table 2 XkbDescRec Components Returned for Values of Want & Needs</th>
<th></th>
<th></th></tr>

<tr>
<td>Request (want+need)</td>
<td>Fills in Xkb components</td>
<td>Equivalent Function Call</td></tr>

<tr>
<td>XkbGBN_TypesMask</td>
<td>map.types</td>
<td>XkbGetUpdatedMap(dpy, XkbTypesMask, Xkb)</td></tr>

<tr>
<td>XkbGBN_ServerSymbolsMask</td>
<td>server</td>
<td>XkbGetUpdatedMap(dpy,</td></tr>

<tr>
<td>XkbAllClientInfoMask, Xkb)</td>
<td></td>
<td></td></tr>

<tr>
<td>XkbGBN_ClientSymbolsMask</td>
<td>map, including map.types</td>
<td></td></tr>

<tr>
<td>XkbGetUpdatedMap(dpy, XkbAllServerInfoMask, Xkb)</td>
<td></td>
<td></td></tr>

<tr>
<td>XkbGBN_IndicatorMaps</td>
<td>indicators</td>
<td>XkbGetIndicatorMap(dpy,</td></tr>

<tr>
<td>XkbAllIndicators, Xkb)</td>
<td></td>
<td></td></tr>

<tr>
<td>XkbGBN_CompatMapMask</td>
<td>compat</td>
<td>XkbGetCompatMap(dpy, XkbAllCompatMask, Xkb)</td></tr>

<tr>
<td>XkbGBN_GeometryMask</td>
<td>geom</td>
<td>XkbGetGeometry(dpy, Xkb)</td></tr>

<tr>
<td>XkbGBN_KeyNamesMask</td>
<td>names.keys</td>
<td>XkbGetNames(dpy, XkbKeyNamesMask |</td></tr>

<tr>
<td></td>
<td>names.key_aliases</td>
<td>XkbKeyAliasesMask, Xkb)</td></tr>

<tr>
<td>XkbGBN_OtherNamesMask</td>
<td>names.keycodes</td>
<td>XkbGetNames(dpy, XkbAllNamesMask &</td></tr>

<tr>
<td></td>
<td>names.geometry</td>
<td>~(XkbKeyNamesMask | XkbKeyAliasesMask),</td></tr>

<tr>
<td></td>
<td>names.symbols</td>
<td>Xkb)</td></tr>

<tr>
<td></td>
<td>names.types</td>
<td></td></tr>

<tr>
<td></td>
<td>map.types[*].lvl_names[*]</td>
<td></td></tr>

<tr>
<td></td>
<td>names.compat</td>
<td></td></tr>

<tr>
<td></td>
<td>names.vmods</td>
<td></td></tr>

<tr>
<td></td>
<td>names.indicators</td>
<td></td></tr>

<tr>
<td></td>
<td>names.groups</td>
<td></td></tr>

<tr>
<td></td>
<td>names.radio_groups</td>
<td></td></tr>

<tr>
<td></td>
<td>names.phys_symbols</td>
<td></td></tr>
</table><p>There is no way to determine which components specified in <em>want</em> (but not in <em>need)</em> were actually fetched, other than breaking the call into successive calls to <em>XkbGetKeyboardByName</em> and specifying individual components.</p><p><em>XkbGetKeyboardByName</em> always sets <em>min_key_code</em> and <em>max_key_code</em> in the returned XkbDescRec structure.</p><p><em>XkbGetKeyboardByName</em> is synchronous; it sends the request to the server to build a new keyboard description and waits for the reply. If successful, the return value is non-NULL. <em>XkbGetKeyboardByName</em> generates a BadMatch protocol error if errors are encountered when building the keyboard description.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STRUCTURES</h2>
        <div class="sectioncontent">
<p>The complete description of an Xkb keyboard is given by an XkbDescRec. The component structures in the XkbDescRec represent the major Xkb components outlined in Figure 1.1.</p>
<pre>
typedef struct {
   struct _XDisplay * display;      /\(** connection to X server */
   unsigned short     flags;        /\(** private to Xkb, do not modify */
   unsigned short     device_spec;  /\(** device of interest */
   KeyCode            min_key_code; /\(** minimum keycode for device */
   KeyCode            max_key_code; /\(** maximum keycode for device */
   XkbControlsPtr     ctrls;        /\(** controls */
   XkbServerMapPtr    server;       /\(** server keymap */
   XkbClientMapPtr    map;          /\(** client keymap */
   XkbIndicatorPtr    indicators;   /\(** indicator map */
   XkbNamesPtr        names;        /\(** names for all components */
   XkbCompatMapPtr    compat;       /\(** compatibility map */
   XkbGeometryPtr     geom;         /\(** physical geometry of keyboard */
} XkbDescRec, *XkbDescPtr;

</pre>
<p>The <em>display</em> field points to an X display structure. The <em>flags field is private to the library: modifying</em> <em>flags</em> may yield unpredictable results. The <em>device_spec</em> field specifies the device identifier of the keyboard input device, or XkbUseCoreKeyboard, which specifies the core keyboard device. The <em>min_key_code</em> and <em>max_key_code</em> fields specify the least and greatest keycode that can be returned by the keyboard.</p><p>Each structure component has a corresponding mask bit that is used in function calls to indicate that the structure should be manipulated in some manner, such as allocating it or freeing it. These masks and their relationships to the fields in the XkbDescRec are shown in Table 3.</p><table class="table table-striped">
<tr>
<th>Table 3 Mask Bits for XkbDescRec</th>
<th></th>
<th></th></tr>

<tr>
<td>Mask Bit</td>
<td>XkbDescRec Field</td>
<td>Value</td></tr>

<tr>
<td>XkbControlsMask</td>
<td>ctrls</td>
<td>(1L&lt;&lt;0)</td></tr>

<tr>
<td>XkbServerMapMask</td>
<td>server</td>
<td>(1L&lt;&lt;1)</td></tr>

<tr>
<td>XkbIClientMapMask</td>
<td>map</td>
<td>(1L&lt;&lt;2)</td></tr>

<tr>
<td>XkbIndicatorMapMask</td>
<td>indicators</td>
<td>(1L&lt;&lt;3)</td></tr>

<tr>
<td>XkbNamesMask</td>
<td>names</td>
<td>(1L&lt;&lt;4)</td></tr>

<tr>
<td>XkbCompatMapMask</td>
<td>compat</td>
<td>(1L&lt;&lt;5)</td></tr>

<tr>
<td>XkbGeometryMask</td>
<td>geom</td>
<td>(1L&lt;&lt;6)</td></tr>

<tr>
<td>XkbAllComponentsMask</td>
<td>All Fields</td>
<td>(0x7f)</td></tr>
</table>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>BadMatch</strong></p>
  </dt>
  <dd>
    <p>A compatible version of Xkb was not available in the server or an argument has correct type and range, but is otherwise invalid</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO XkbGetKeyboardByName&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/XkbListComponents.3.html"><strong>XkbListComponents</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="XkbGetKeyboard.3.html"><span aria-hidden="true">&larr;</span> XkbGetKeyboard.3: Retrieves one or more components of a keyboard device description</a></li>
   <li class="next"><a href="XkbGetMap.3.html">XkbGetMap.3: Allocate an xkbdescrec structure and populate it with the server's keyboard client map and server map <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
