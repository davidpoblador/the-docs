<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmfetch: Get performance metric values</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Get performance metric values">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmfetch (3) manual">
  <meta name="twitter:description" content="Get performance metric values">
  <meta name="twitter:image" content="https://www.carta.tech/images/pcp-pmfetch-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/pmfetch.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pmfetch (3) manual" />
  <meta property="og:description" content="Get performance metric values" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pcp-pmfetch-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmfetch<small> (3)</small></h1>
        <p class="lead">Get performance metric values</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmfetch.3.html">
      <span itemprop="name">pmfetch: Get performance metric values</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmfetch.3.html">
      <span itemprop="name">pmfetch: Get performance metric values</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;pcp/pmapi.h&gt;</p>
<pre>
int pmFetch(int <em>numpmid</em>, pmID *<em>pmidlist</em>, pmResult **<em>result</em>);
</pre>
<p>cc ... -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Given a list of Performance Metric Identifiers (PMID)s, e.g. as constructed by <a href="../man3/pmlookupname.3.html"><strong>pmLookupName</strong>(3)</a>, via <em>pmidlist</em> and <em>numpmid</em>, fetch the values for these performance metrics.</p><p>The call to <strong>pmFetch</strong> is executed in the context of a source of metrics, instance profile and collection time, previously established by calls to the appropriate context and profile functions, namely some of <a href="../man3/pmnewcontext.3.html"><strong>pmNewContext</strong>(3)</a>, <a href="../man3/pmdupcontext.3.html"><strong>pmDupContext</strong>(3)</a>, <a href="../man3/pmusecontext.3.html"><strong>pmUseContext</strong>(3)</a>, <a href="../man3/pmaddprofile.3.html"><strong>pmAddProfile</strong>(3)</a>, <a href="../man3/pmdelprofile.3.html"><strong>pmDelProfile</strong>(3)</a> and <a href="../man3/pmsetmode.3.html"><strong>pmSetMode</strong>(3)</a>.</p><p>The principal result from <strong>pmFetch</strong> is returned in the argument <em>result</em> as a tree, using the following component data structures;</p>
<pre>
typedef struct {
      unsigned int vtype : 8;        /* value type (same as pmDesc.type) */
      unsigned int vlen : 24;        /* bytes for vtype/vlen + vbuf */
      char         vbuf[1];          /* one or more values */
} pmValueBlock;

typedef struct {
      int      inst;                 /* instance identifier */
      union {
            pmValueBlock *pval;      /* pointer to value-block */
            int          lval;       /* integer value insitu */
      } value;
} pmValue;

typedef struct {
      pmID      pmid;                /* metric identifier */
      int       numval;              /* number of values or error code */
      int       valfmt;              /* value style, insitu or ptr */
      pmValue   vlist[1];            /* set of instances/values */
} pmValueSet;

/* Result returned by pmFetch() */
typedef struct {
      struct timeval timestamp;      /* time stamped by collector */
      int            numpmid;        /* number of PMIDs */
      pmValueSet     *vset[1];       /* set of value sets */
} pmResult;
</pre>
<p>To accommodate metrics with multiple value instances, the field indicates how many values are returned for each requested PMID. The field in the structure indicates if the values for this metric are stored <em>insitu</em> in the field, i.e. a 32-bit integer quantity (either int, unsigned int, long or unsigned long) or if the values are held in associated structures. The structure is always used for floating point values (float or double) and also accommodates arbitrary sized binary data such as `string-valued' metrics and metrics with aggregated or complex data types. The maximum length of a buffer is <strong>PM_VAL_VLEN_MAX</strong> bytes. If the format is used, the field indicates the data type of the value. This field has the same interpretation as the field in the <strong>pmDesc</strong> structure, see <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>.</p><p>Note that the insitu value may be a signed or unsigned 32 bit integer, signed or unsigned 32 bit long value (on 32 bit platforms), In the special cases described below, it may also be a 32 bit floating point value. If the application needs to know the type of an insitu value, which is almost always the case, it is necessary to fetch the descriptor for the metric and interpret the <strong>type</strong> field, as described in detail in <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>. When the is received from a PCP1.x <strong>pmcd</strong>, insitu values may also be 32 bit floating point values (of type <strong>PM_TYPE_FLOAT</strong>). In all cases, it is good practice to use <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a> to fetch the descriptor for the metric and interpret the <strong>type</strong> field therein. Note also that the <a href="../man3/pmapi.3.html"><strong>PMAPI</strong>(3)</a> will automatically translate from the PCP2.0 format to the PCP1.x format when a PCP1.x client requests 32 bit floating point values from a PCP2.0 <strong>pmcd</strong>, but the reverse translation does not occur (because the PCP2.0 <strong>pmcd</strong> cannot automatically distinguish between arbitrary 32 bit floating point values and 32 bit integers).</p><p>If one value (i.e. associated with a particular instance) for a requested metric is `unavailable' (at the requested time), then there is no associated structure in the <em>result</em>. If there are no available values for a metric, then will be zero and the associated instance will be empty ( .CW valfmt is undefined in these circumstances, however will be correctly set to the PMID of the metric with no values).</p><p>As an extension of this protocol, if the Performance Metrics Collection System (PMCS) is able to provide a reason why no values are available for a particular metric, this is encoded as a standard error code in the corresponding Since the error codes are all negative, values for a requested metric are `unavailable' if is less than, or equal to, zero. A performance metric's value may be `unavailable' for a number of reasons; the following list is illustrative but not exhaustive: of the software for the associated Performance Metric Domain</p><ul>
<li><p>Collection is not currently activated in the software for the associated Performance Metric Domain</p></li><li><p>The associated PMID is not known</p></li><li><p>The current system configuration does not include the associated hardware component and/or the associated software module, e.g. a disk is not installed, or off-line, or Oracle is not installed</p></li><li><p>The metric is one for which an instance profile is required, and none was provided (there are a small number of metrics in this category, typically ones with very large, and/or very dynamic instance domains, and/or expensive metric instantiation methods).</p></li><li><p>If the current context involves fetching metrics from an archive log, values may be unavailable in the region around a <em>&lt;mark&gt;</em> record (see <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a>) that indicate a temporal discontinuity in the time-series of metric values.</p></li>
</ul><p>In general, we may not be able to differentiate between the various cases, and if differentiation is not possible, will simply be zero.</p><p>The argument definition and the result specifications have been constructed to ensure that for each PMID in the requested <em>pmidlist</em> there is exactly one in the <em>result</em>, and further the PMIDs appear in exactly the same sequence in both <em>pmidlist</em> and <em>result</em>. This makes the number and order of entries in <em>result</em> completely deterministic, and greatly simplifies the application programming logic after the call to <strong>pmFetch</strong>.</p><p>The <em>result</em> structure returned by <strong>pmFetch</strong> is dynamically allocated using a combination of <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a> calls and specialized allocation strategies, and should be released when no longer required by calling <a href="../man3/pmfreeresult.3.html"><strong>pmFreeResult</strong>(3)</a> - under no circumstances should <a href="../man3/free.3.html"><strong>free</strong>(3)</a> be called directly to release this space.</p><p>As common error conditions are encoded in the <em>result</em> data structure, we'd expect only cataclysmic events to cause an error value to be returned. One example would be if the metrics source context was a remote host, and that host or the PMCS on that host became unreachable. Otherwise the value returned by the <strong>pmFetch</strong> function will be non-negative.</p><p>If the current context involves fetching metrics from a Performance Metrics Collector Daemon (PMCD), then the return value may be used to encode out-of-band changes in the state of the PMCD and the associated Performance Metrics Daemon Agents (PMDAs), as a bit-wise ``or'' of the following values:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>PMCD_RESTART_AGENT</strong>
  </dt>
  <dd>
    <p>An attempt has been made to restart at least one failed PMDA.</p>
  </dd>
  <dt>
    <strong>PMCD_ADD_AGENT</strong>
  </dt>
  <dd>
    <p>At least one PMDA has been started.</p>
  </dd>
  <dt>
    <strong>PMCD_DROP_AGENT</strong>
  </dt>
  <dd>
    <p>PMCD has noticed the termination of at least one PMDA.</p>
  </dd>

</dl>
<p>The default is to return zero to indicate no change in state, however the returned by <strong>pmFetch</strong> has the same interpretation independent of the return value being zero or greater than zero.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmfetch&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>, <a href="../man3/pmaddprofile.3.html"><strong>pmAddProfile</strong>(3)</a>, <a href="../man3/pmapi.3.html"><strong>PMAPI</strong>(3)</a>, <a href="../man3/pmdelprofile.3.html"><strong>pmDelProfile</strong>(3)</a>, <a href="../man3/pmdupcontext.3.html"><strong>pmDupContext</strong>(3)</a>, <a href="../man3/pmextractvalue.3.html"><strong>pmExtractValue</strong>(3)</a>, <a href="../man3/pmfetcharchive.3.html"><strong>pmFetchArchive</strong>(3)</a>, <a href="../man3/pmfreeresult.3.html"><strong>pmFreeResult</strong>(3)</a>, <a href="../man3/pmgetindom.3.html"><strong>pmGetInDom</strong>(3)</a>, <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, <a href="../man3/pmlookupname.3.html"><strong>pmLookupName</strong>(3)</a>, <a href="../man3/pmnewcontext.3.html"><strong>pmNewContext</strong>(3)</a>, <a href="../man3/pmsetmode.3.html"><strong>pmSetMode</strong>(3)</a>, <a href="../man3/pmusecontext.3.html"><strong>pmUseContext</strong>(3)</a> and <a href="../man3/pmwhichcontext.3.html"><strong>pmWhichContext</strong>(3)</a>.</p><p>Note that <strong>pmFetch</strong> is the most primitive method of fetching metric values from the PMCS. See the <a href="../man3/pmfetchgroup.3.html"><strong>pmFetchGroup</strong>(3)</a> API for a higher level method that insulates the user from the intricacies of looking up metric names and metadata, setting up instance profiles, traversal, conversions, and scaling.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>As mentioned above, <strong>pmFetch</strong> returns error codes <em>insitu</em> in the argument <em>result</em>. If no result is returned, e.g. due to IPC failure using the current PMAPI context, or end of file on an archive log, then <strong>pmFetch</strong> will return a negative error code which may be examined using <a href="../man3/pmerrstr.3.html"><strong>pmErrStr</strong>(3)</a>.</p>
<dl class='dl-vertical'>
  <dt>
    <strong>PM_ERR_EOL</strong>
  </dt>
  <dd>
    <p>When fetching records from an archive log, <strong>pmFetch</strong> returns this error code to indicate the end of the log has been passed (or the start of the log has been passed, if the direction of traversal is backwards in time). If the ``mode'' for the current PMAPI context (see <a href="../man3/pmsetmode.3.html"><strong>pmSetMode</strong>(3)</a>) is <strong>PM_MODE_INTERP</strong> then the time origin is advanced, even when this error code is returned. In this way applications that position the time outside the range defined by the records in the archive, and then commence to <strong>pmFetch</strong> will eventually see valid results once the time origin moves inside the temporal span of the archive.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Many of the performance metrics exported from PCP agents have the semantics of <em>counter</em> meaning they are expected to be monotonically increasing. Under some circumstances, one value of these metrics may be smaller than the previously fetched value. This can happen when a counter of finite precision overflows, or when the PCP agent has been reset or restarted, or when the PCP agent is exporting values from some underlying instrumentation that is subject to some asynchronous discontinuity.</p><p>The environment variable <strong>PCP_COUNTER_WRAP</strong> may be set to indicate that all such cases of a decreasing ``counter'' should be treated as a counter overflow, and hence the values are assumed to have wrapped once in the interval between consecutive samples. This ``wrapping'' behavior was the default in earlier PCP versions, but by default has been disabled in PCP version 1.3 and later.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmfault.3.html"><span aria-hidden="true">&larr;</span> pmfault.3: Fault injection infrastracture for qa</a></li>
   <li class="next"><a href="pmfetcharchive.3.html">pmfetcharchive.3: Get performance metrics directly from a set if archive logs <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
