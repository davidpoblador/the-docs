<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libpfm: A helper library to develop monitoring tools</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A helper library to develop monitoring tools">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libpfm (3) manual">
  <meta name="twitter:description" content="A helper library to develop monitoring tools">
  <meta name="twitter:image" content="https://www.carta.tech/images/libpfm4-dev-libpfm-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libpfm.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libpfm (3) manual" />
  <meta property="og:description" content="A helper library to develop monitoring tools" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libpfm4-dev-libpfm-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libpfm<small> (3)</small></h1>
        <p class="lead">A helper library to develop monitoring tools</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libpfm.3.html">
      <span itemprop="name">libpfm: A helper library to develop monitoring tools</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libpfm4-dev/">
      <span itemprop="name">libpfm4-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libpfm.3.html">
      <span itemprop="name">libpfm: A helper library to develop monitoring tools</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include &lt;perfmon/pfmlib.h&gt;</strong>

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This is a helper library used by applications to program specific performance monitoring events. Those events are typically provided by the hardware or the OS kernel. The most common hardware events are provided by the Performance Monitoring Unit (PMU) of modern processors. They can measure elapsed cycles or the number of cache misses. Software events usually count kernel events  such as the number of context switches, or pages faults.</p><p>The library groups events based on which source is providing them. The term PMU is generalized to any event source, not just hardware sources. The library supports hardware performance events from most common processors, each group under a specific PMU name, such as Intel Core, IBM Power 6.</p><p>Programming events is usually done through a kernel API, such as Oprofile, perfmon, perfctr, or perf_events on Linux. The library provides support for perf_events which is available in the Linux kernel as of v2.6.31. Perf_events supports selected PMU models and several software events.</p><p>At its core, the library provides a simple translation service, whereby a user specifies an event to measure as a string and the library returns the parameters needed to invoke the kernel API. It is important to realize that the library does <strong>not</strong> make the system call to program the event.</p><p><strong>Note:</strong> You must first call <strong>pfm_initialize()</strong> in order to use any of the other provided functions in the library.</p><p>A first part of the library provides an event listing and query interface. This can be used to discover the events available on a specific hardware platform.</p><p>The second part of the library provides a set of functions to obtain event encodings form event strings. Event encoding depends primarily on the underlying hardware but also on the kernel API. The library offers a generic API to address the first situation but it also provides entry points for specific kernel APIs such as perf_events. In that case, it is able to prepare the data structure which must be passed to the kernel to program a specific event.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EVENT DETECTION</h2>
        <div class="sectioncontent">
<p>When the library is initialized via <strong>pfm_initialize()</strong>, it first detects the underlying hardware and software configuration.  Based on this information it enables certain PMU support.  Multiple events tables may be activated.</p><p>It is possible to force activation of a specific PMU (group of events) using an environment variable.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EVENT STRINGS</h2>
        <div class="sectioncontent">
<p>Events are expressed as strings. Those string are structured and may contain several components depending on the type of event and the underlying hardware.</p><p>String parsing is always case insensitive.</p><p>The string structure is defined as follows:</p><p><strong>[pmu::][event_name][:unit_mask][:modifier|:modifier=val]</strong></p><p>The components are defined as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>pmu</strong></p>
  </dt>
  <dd>
    <p>Optional name of the PMU (group of events) to which the event belongs to. This is useful to disambiguate events in case events from difference sources have the same name. If not specified, the first match is used.</p>
  </dd>
  <dt>
    <p><strong>event_name</strong></p>
  </dt>
  <dd>
    <p>The name of the event. It must be the complete name, partial matches are not accepted. This component is required.</p>
  </dd>
  <dt>
    <p><strong>unit_mask</strong></p>
  </dt>
  <dd>
    <p>This designate an optional sub-events. Some events can be refined using sub-events. Event may have multiple unit masks and it may or may be possible to combine them. If more than one unit masks needs to be passed, then the [:unit_mask] pattern can be repeated.</p>
  </dd>
  <dt>
    <p><strong>modifier</strong></p>
  </dt>
  <dd>
    <p>A modifier is an optional filter which modifies how the event counts. Modifiers have a type and a value. The value is specified after the equal sign. No space is allowed. In case of boolean modifiers, it is possible to omit the value true (1). The presence of the modifier is interpreted as meaning true. Events may support multiple modifiers, in which case the [:modifier|:modifier=val] pattern can be repeated. The is no ordering constraint between modifier and unit masks. Modifiers may be specified before unit masks and vice-versa.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">
<p>It is possible to enable certain debug features of the library using environment variables. The following variables are defined:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>LIBPFM_VERBOSE</strong></p>
  </dt>
  <dd>
    <p>Enable verbose output. Value must be 0 or 1.</p>
  </dd>
  <dt>
    <p><strong>LIBPFM_DEBUG</strong></p>
  </dt>
  <dd>
    <p>Enable debug  output. Value must be 0 or 1</p>
  </dd>
  <dt>
    <p><strong>LIBPFM_DEBUG_STDOUT</strong></p>
  </dt>
  <dd>
    <p>Redirect verbose and debug output to the standard output file descriptor (stdout). By default, the output is directed to the standard error file descriptor (stderr).</p>
  </dd>
  <dt>
    <p><strong>LIBPFM_FORCE_PMU</strong></p>
  </dt>
  <dd>
    <p>Force a specific PMU model to be activated. In this mode, only that one model is activated. The value of the variable must be the PMU name as returned by the <strong>pfm_get_pmu_name()</strong> function. Note for some PMU models, it may be possible to specify additional options, such as specific processor models or stepping. Additional parameters necessarily appears after a comma. For instance, LIBPFM_FORCE_PMU=amd64,16,2,1.</p>
  </dd>
  <dt>
    <p><strong>LIBPFM_ENCODE_INACTIVE</strong></p>
  </dt>
  <dd>
    <p>Set this variable to 1 to enable encoding of events for non detected, but supported, PMUs models.</p>
  </dd>
  <dt>
    <p><strong>LIBPFM_DISABLED_PMUS</strong></p>
  </dt>
  <dd>
    <p>Provides a list of PMU models to disable. This is a comma separated list of PMU models. The PMU model is the string in <strong>name</strong> field of the <strong>pfm_pmu_info_t</strong> structure. For instance: LIBPFM_DISABLE_PMUS=core,snb, will disable both the Intel Core and SandyBridge core PMU support.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">

<pre>
Stephane Eranian &lt;eranian@gmail.com&gt;
Robert Richter &lt;robert.richter@amd.com&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO libpfm&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/libpfm_amd64_k7.3.html"><strong>libpfm_amd64_k7</strong>(3)</a>, <a href="../man3/libpfm_amd64_k8.3.html"><strong>libpfm_amd64_k8</strong>(3)</a>, <a href="../man3/libpfm_amd64_fam10h.3.html"><strong>libpfm_amd64_fam10h</strong>(3)</a>, <a href="../man3/libpfm_intel_core.3.html"><strong>libpfm_intel_core</strong>(3)</a>, <a href="../man3/libpfm_intel_atom.3.html"><strong>libpfm_intel_atom</strong>(3)</a>, <a href="../man3/libpfm_intel_p6.3.html"><strong>libpfm_intel_p6</strong>(3)</a>, <a href="../man3/libpfm_intel_nhm.3.html"><strong>libpfm_intel_nhm</strong>(3)</a>, <a href="../man3/libpfm_intel_nhm_unc.3.html"><strong>libpfm_intel_nhm_unc</strong>(3)</a>, <a href="../man3/pfm_get_perf_event_encoding.3.html"><strong>pfm_get_perf_event_encoding</strong>(3)</a>, <a href="../man3/pfm_initialize.3.html"><strong>pfm_initialize</strong>(3)</a></p><p>Some examples are shipped with the library</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libopenms.3.html"><span aria-hidden="true">&larr;</span> libopenms.3: Library for lc/ms data management and analysis</a></li>
   <li class="next"><a href="libpfm_amd64.3.html">libpfm_amd64.3: Support for amd64 processors <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
