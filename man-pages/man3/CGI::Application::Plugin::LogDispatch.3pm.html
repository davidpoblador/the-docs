<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CGI::Application::Plugin::LogDispatch: Add log::dispatch support to cgi::application</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Add log::dispatch support to cgi::application">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CGI::Application::Plugin::LogDispatch (3pm) manual">
  <meta name="twitter:description" content="Add log::dispatch support to cgi::application">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcgi-application-plugin-logdispatch-perl-CGI::Application::Plugin::LogDispatch-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/CGI::Application::Plugin::LogDispatch.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CGI::Application::Plugin::LogDispatch (3pm) manual" />
  <meta property="og:description" content="Add log::dispatch support to cgi::application" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcgi-application-plugin-logdispatch-perl-CGI::Application::Plugin::LogDispatch-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CGI::Application::Plugin::LogDispatch<small> (3pm)</small></h1>
        <p class="lead">Add log::dispatch support to cgi::application</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::LogDispatch.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::LogDispatch: Add log::dispatch support to cgi::application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcgi-application-plugin-logdispatch-perl/">
      <span itemprop="name">libcgi-application-plugin-logdispatch-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::LogDispatch.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::LogDispatch: Add log::dispatch support to cgi::application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
 package My::App;

 use CGI::Application::Plugin::LogDispatch;

 sub cgiapp_init {
   my $self = shift;

   # calling log_config is optional as
   # some simple defaults will be used
   $self-&gt;log_config(
     LOG_DISPATCH_MODULES =&gt; [
       {    module =&gt; &apos;Log::Dispatch::File&apos;,
              name =&gt; &apos;debug&apos;,
          filename =&gt; &apos;/tmp/debug.log&apos;,
         min_level =&gt; &apos;debug&apos;,
       },
     ]
   );
 }

 sub myrunmode {
   my $self = shift;

   $self-&gt;log-&gt;info(&apos;Information message&apos;);
   $self-&gt;log-&gt;debug(&apos;Debug message&apos;);
 }

 - or as a class based singleton -

 package My::App;

 use CGI::Application::Plugin::LogDispatch (
   LOG_DISPATCH_MODULES =&gt; [
     {    module =&gt; &apos;Log::Dispatch::File&apos;,
            name =&gt; &apos;debug&apos;,
        filename =&gt; &apos;/tmp/debug.log&apos;,
       min_level =&gt; &apos;debug&apos;,
     },
   ]
 );

 My::App-&gt;log-&gt;info(&apos;Information message&apos;);

 sub myrunmode {
   my $self = shift;

   $self-&gt;log-&gt;info(&apos;This also works&apos;);
 }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>CGI::Application::Plugin::LogDispatch adds logging support to your CGI::Application modules by providing a Log::Dispatch dispatcher object that is accessible from anywhere in the application.</p><p>If you have CGI::Application::Plugin::DevPopup installed, a \*(L"Log Entries\*(R" report is added to the popup window, containing all of the entries that were logged during the execution of the runmode.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>log</h3>
<p>This method will return the current Log::Dispatch dispatcher object.  The Log::Dispatch object is created on the first call to this method, and any subsequent calls will return the same object.  This effectively creates a singleton log dispatcher for the duration of the request. If \*(C`log_config\*(C' has not been called before the first call to \*(C`log\*(C', then it will choose some sane defaults to create the dispatcher object (the exact default values are defined below).</p><p>  # retrieve the log object   my $log = $self-&gt;log;   $log-&gt;warning("something&apos;s not right!");   $log-&gt;emergency("It&apos;s all gone pear shaped!");</p><p>  - or -</p><p>  # use the log object directly   $self-&gt;log-&gt;debug(Data::Dumper::Dumper(&#92;%hash));</p><p>  - or -</p><p>  # if you configured it as a singleton   My::App-&gt;log-&gt;debug(&apos;This works too&apos;);</p>
<h3>log_config</h3>
<p>This method can be used to customize the functionality of the CGI::Application::Plugin::LogDispatch module. Calling this method does not mean that a new Log::Dispatch object will be immediately created. The log object will not be created until the first call to $self-&gt;log.</p><p>The recommended place to call \*(C`log_config\*(C' is in the \*(C`cgiapp_init\*(C' stage of CGI::Application.  If this method is called after the log object has already been accessed, then it will die with an error message.</p><p>If this method is not called at all then a reasonable set of defaults will be used (the exact default values are defined below).</p><p>The following parameters are accepted:</p>
<dl class='dl-vertical'>
  <dt>
    \s-1LOG_DISPATCH_OPTIONS\s0
  </dt>
  <dd>
    <p>This allows you to customize how the Log::Dispatch object is created by providing a hash of options that will be passed to the Log::Dispatch constructor.  Please see the documentation for Log::Dispatch for the exact syntax of the parameters.  Surprisingly enough you will usually not need to use this option, instead look at the \s-1LOG_DISPATCH_MODULES\s0 option.  LOG_DISPATCH_OPTIONS =&gt; {       callbacks =&gt; sub { my %h = @_; return time().&apos;: &apos;.$h{message}; },  }</p>
  </dd>
  <dt>
    \s-1LOG_DISPATCH_MODULES\s0
  </dt>
  <dd>
    <p>This option allows you to specify the Log::Dispatch::* modules that you wish to use to log messages.  You can list multiple dispatch modules, each with their own set of options.  Format the options in an array of hashes, where each hash contains the options for the Log::Dispatch:: module you are configuring and also include a 'module' parameter containing the name of the dispatch module.  See below for an example.  You can also add an 'append_newline' option to automatically append a newline to each log entry for this dispatch module (this option is not needed if you already specified the \s-1APPEND_NEWLINE\s0 option listed below which will add a newline for all dispatch modules).  LOG_DISPATCH_MODULES =&gt; [    {         module =&gt; &apos;Log::Dispatch::File&apos;,                name =&gt; &apos;messages&apos;,            filename =&gt; &apos;/tmp/messages.log&apos;,           min_level =&gt; &apos;info&apos;,      append_newline =&gt; 1    },    {         module =&gt; &apos;Log::Dispatch::Email::MailSend&apos;,                name =&gt; &apos;email&apos;,                  to =&gt; [ qw(foo@bar.com bar@baz.org ) ],              subject =&gt; &apos;Oh No!!!!!!!!!!&apos;,           min_level =&gt; &apos;emerg&apos;    }  ]</p>
  </dd>
  <dt>
    \s-1APPEND_NEWLINE\s0
  </dt>
  <dd>
    <p>By default Log::Dispatch does not append a newline to the end of the log messages.  By setting this option to a true value, a newline character will automatically be added to the end of the log message.  APPEND_NEWLINE =&gt; 1</p>
  </dd>
  <dt>
    \s-1LOG_METHOD_EXECUTION\s0 (\s-1EXPERIMENTAL\s0)
  </dt>
  <dd>
    <p>This option will allow you to log the execution path of your program.  Set \s-1LOG_METHOD_EXECUTION\s0 to a list of all the modules you want to be logged.  This will automatically send a debug message at the start and end of each method/function that is called in the modules you listed. The parameters passed, and the return value will also be logged.  This can be useful by tracing the program flow in the logfile without having to resort to the debugger.  LOG_METHOD_EXECUTION =&gt; [qw(_\|_PACKAGE_\|_ CGI::Application CGI)], \s-1WARNING:\s0  This hasn't been heavily tested, although it seems to work fine for me.  Also, a closure is created around the log object, so some care may need to be taken when using this in a persistent environment like mod_perl.  This feature depends on the Sub::WrapPackages module.</p>
  </dd>

</dl>

<h3>\s-1DEFAULT\s0 \s-1OPTIONS\s0</h3>
<p>The following example shows what options are set by default (ie this is what you would get if you do not call log_config).  A single Log::Dispatch::Screen module that writes error messages to \s-1STDERR\s0 with a minimum log level of debug.</p><p> $self-&gt;log_config(    LOG_DISPATCH_MODULES =&gt; [      {        module =&gt; &apos;Log::Dispatch::Screen&apos;,                 name =&gt; &apos;screen&apos;,               stderr =&gt; 1,            min_level =&gt; &apos;debug&apos;,       append_newline =&gt; 1      }    ],  );</p><p>Here is a more customized example that uses two file appenders, and an email gateway. Here all debug messages are sent to /tmp/debug.log, and all messages above are sent to /tmp/messages.log.  Also, any emergency messages are emailed to foo@bar.com and bar@baz.org.</p><p> $self-&gt;log_config(    LOG_DISPATCH_MODULES =&gt; [      {    module =&gt; &apos;Log::Dispatch::File&apos;,             name =&gt; &apos;debug&apos;,         filename =&gt; &apos;/tmp/debug.log&apos;,        min_level =&gt; &apos;debug&apos;,        max_level =&gt; &apos;debug&apos;      },      {    module =&gt; &apos;Log::Dispatch::File&apos;,             name =&gt; &apos;messages&apos;,         filename =&gt; &apos;/tmp/messages.log&apos;,        min_level =&gt; &apos;info&apos;      },      {    module =&gt; &apos;Log::Dispatch::Email::MailSend&apos;,             name =&gt; &apos;email&apos;,               to =&gt; [ qw(foo@bar.com bar@baz.org ) ],           subject =&gt; &apos;Oh No!!!!!!!!!!&apos;,        min_level =&gt; &apos;emerg&apos;      }    ],    APPEND_NEWLINE =&gt; 1,  );</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>In a CGI::Application module:</p><p>  # configure the log modules once during the init stage   sub cgiapp_init {     my $self = shift;</p><p>    # Configure the session     $self-&gt;log_config(       LOG_DISPATCH_MODULES =&gt; [         {    module =&gt; &apos;Log::Dispatch::File&apos;,                name =&gt; &apos;messages&apos;,            filename =&gt; &apos;/tmp/messages.log&apos;,           min_level =&gt; &apos;error&apos;         },         {    module =&gt; &apos;Log::Dispatch::Email::MailSend&apos;,                name =&gt; &apos;email&apos;,                  to =&gt; [ qw(foo@bar.com bar@baz.org ) ],              subject =&gt; &apos;Oh No!!!!!!!!!!&apos;,           min_level =&gt; &apos;emerg&apos;         }       ],       APPEND_NEWLINE =&gt; 1,     );</p><p>  }</p><p>  sub cgiapp_prerun {     my $self = shift;</p><p>    $self-&gt;log-&gt;debug("Current runmode:  ".$self-&gt;get_current_runmode);   }</p><p>  sub my_runmode {     my $self = shift;     my $log  = $self-&gt;log;</p><p>    if ($ENV{&apos;REMOTE_USER&apos;}) {       $log-&gt;info("user ".$ENV{&apos;REMOTE_USER&apos;});     }</p><p>    # etc...   }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SINGLETON SUPPORT</h2>
        <div class="sectioncontent">
<p>This module can be used as a singleton object.  This means that when the object is created, it will remain accessible for the duration of the process.  This can be useful in persistent environments like mod_perl and PersistentPerl, since the object only has to be created one time, and will remain in memory across multiple requests.  It can also be useful if you want to setup a \s-1DIE\s0 handler, or \s-1WARN\s0 handler, since you will not have access to the $self object.</p><p>To use this module as a singleton you need to provide all configuration parameters as options to the use statement.  The use statement will accept all the same parameters that the log_config method accepts, so see the documentation above for more details.</p><p>When creating the singleton, the log object will be saved in the namespace of the module that created it.  The singleton will also be inherited by any subclasses of this module.</p><p>\s-1NOTE:\s0  Singleton support requires the Class::ISA module which is not installed automatically by this module.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SINGLETON EXAMPLE</h2>
        <div class="sectioncontent">
<p>  package My::App;</p><p>  use base qw(CGI::Application);   use CGI::Application::Plugin::LogDispatch(       LOG_DISPATCH_MODULES =&gt; [         {    module =&gt; &apos;Log::Dispatch::File&apos;,                name =&gt; &apos;messages&apos;,            filename =&gt; &apos;/tmp/messages.log&apos;,           min_level =&gt; &apos;error&apos;         },       ],       APPEND_NEWLINE =&gt; 1,     );</p><p>  }</p><p>  sub cgiapp_prerun {     my $self = shift;</p><p>    $self-&gt;log-&gt;debug("Current runmode:  ".$self-&gt;get_current_runmode);   }</p><p>  sub my_runmode {     my $self = shift;     my $log  = $self-&gt;log;</p><p>    if ($ENV{&apos;REMOTE_USER&apos;}) {       $log-&gt;info("user ".$ENV{&apos;REMOTE_USER&apos;});     }</p><p>    # etc...   }</p><p>  package My::App::Subclass;</p><p>  use base qw(My::App);</p><p>  # Setup a die handler that uses the logger   $SIG{_\|_DIE_\|_} = sub { My::App::Subclass-&gt;log-&gt;emerg(@_); CORE::die(@_); };</p><p>  sub my_other_runmode {     my $self = shift;</p><p>    $self-&gt;log-&gt;info("This will log to the logger configured in My::App");   }</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any bugs or feature requests to \*(C`bug-cgi-application-plugin-logdispatch@rt.cpan.org\*(C', or through the web interface at &lt;http://rt.cpan.org&gt;.  I will be notified, and then you'll automatically be notified of progress on your bug as I make changes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO CGI::Application::Plugin::LogDispatch&hellip;</h2>
        <div class="sectioncontent">
<p>CGI::Application, Log::Dispatch, Log::Dispatch::Screen, Sub::WrapPackages, <em>perl</em>\|(1)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Cees Hek &lt;ceeshek@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2004 Cees Hek &lt;ceeshek@gmail.com&gt;</p><p>This library is free software. You can modify and or distribute it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CGI::Application::Plugin::LinkIntegrity.3pm.html"><span aria-hidden="true">&larr;</span> CGI::Application::Plugin::LinkIntegrity.3pm: Make tamper-resisistent links in cgi::application</a></li>
   <li class="next"><a href="CGI::Application::Plugin::MessageStack.3pm.html">CGI::Application::Plugin::MessageStack.3pm: A message stack for your cgi::application <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
