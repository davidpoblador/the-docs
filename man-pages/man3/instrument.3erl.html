<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>instrument: Analysis and utility functions for instrumentation</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Analysis and utility functions for instrumentation">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="instrument (3erl) manual">
  <meta name="twitter:description" content="Analysis and utility functions for instrumentation">
  <meta name="twitter:image" content="https://www.carta.tech/images/erlang-manpages-instrument-3erl.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3erl/instrument.3erl.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="instrument (3erl) manual" />
  <meta property="og:description" content="Analysis and utility functions for instrumentation" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/erlang-manpages-instrument-3erl.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">instrument<small> (3erl)</small></h1>
        <p class="lead">Analysis and utility functions for instrumentation</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/instrument.3erl.html">
      <span itemprop="name">instrument: Analysis and utility functions for instrumentation</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/erlang-manpages/">
      <span itemprop="name">erlang-manpages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/instrument.3erl.html">
      <span itemprop="name">instrument: Analysis and utility functions for instrumentation</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The module <em>instrument</em> contains support for studying the resource usage in an Erlang runtime system. Currently, only the allocation of memory can be studied.</p><p><strong></strong> Note:</p><p>Note that this whole module is experimental, and the representations used as well as the functionality is likely to change in the future.</p><p>The <em>instrument</em> module interface was slightly changed in Erlang/OTP R9C.</p><p>To start an Erlang runtime system with instrumentation, use the <em>+Mi*</em> set of command-line arguments to the <em>erl</em> command (see the erts_alloc(3erl) and <a href="../man1/erl.1.html"><strong>erl</strong>(1)</a> man pages).</p><p>The basic object of study in the case of memory allocation is a memory allocation map. A memory allocation map contains a list of descriptors for each allocated memory block. Currently, a descriptor is a 4-tuple</p>
<pre>
        {TypeNo, Address, Size, PidDesc}
</pre>
<p>where <em>TypeNo</em> is the memory block type number, <em>Address</em> is its place in memory, and <em>Size</em> is its size, in bytes. <em>PidDesc</em> is either a tuple <em>{X,Y,Z}</em> identifying the process which was executing when the block was allocated, or <em>undefined</em> if no process was executing. The pid tuple <em>{X,Y,Z}</em> can be transformed into a real pid by usage of the <em>c:pid/3</em> function.</p><p>Various details about memory allocation:</p><p>Memory blocks are allocated both on the heap segment and on other memory segments. This can cause the instrumentation functionality to report very large holes. Currently the instrumentation functionality doesn't provide any support for distinguishing between holes between memory segments, and holes between allocated blocks inside memory segments. The current size of the process cannot be obtained from within Erlang, but can be seen with one of the system statistics tools, e.g., <em>ps</em> or <em>top</em>. The Solaris utility <em>pmap</em> can be useful. It reports currently mapped memory segments.</p><p>Overhead for instrumentation: When the emulator has been started with the <strong>"+Mim true"</strong> flag, each block is preceded by a 24 bytes large header on a 32-bit machine and a 48 bytes large header on a 64-bit machine. When the emulator has been started with the <strong>"+Mis true"</strong> flag, each block is preceded by an 8 bytes large header. These are the header sizes used by the Erlang 5.3/OTP R9C emulator. Other versions of the emulator may use other header sizes. The function <strong>block_header_size/1</strong> can be used for retrieving the header size used for a specific memory allocation map. The time overhead for managing the instrumentation data is small.</p><p>Sizes presented by the instrumentation functionality are (by the emulator) requested sizes, i.e. neither instrumentation headers nor headers used by allocators are included.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPORTS</h2>
        <div class="sectioncontent">
<p><strong></strong> allocator_descr(MemoryData, TypeNo) -&gt; AllocDescr | invalid_type | "unknown"</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>TypeNo = int()</p><p>AllocDescr = atom() | string()</p><p>Returns the allocator description of the allocator that manages memory blocks of type number <em>TypeNo</em> used in <em>MemoryData</em>. Valid <em>TypeNo</em>s are in the range returned by <strong>type_no_range/1</strong> on this specific memory allocation map. If <em>TypeNo</em> is an invalid integer, <em>invalid_type</em> is returned.</p><p><strong></strong> block_header_size(MemoryData) -&gt; int()</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Returns the memory block header size used by the emulator that generated the memory allocation map. The block header size may differ between different emulators.</p><p><strong></strong> class_descr(MemoryData, TypeNo) -&gt; ClassDescr | invalid_type | "unknown"</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>TypeNo = int()</p><p>ClassDescr = atom() | string()</p><p>Returns the class description of the class that the type number <em>TypeNo</em> used in <em>MemoryData</em> belongs to. Valid <em>TypeNo</em>s are in the range returned by <strong>type_no_range/1</strong> on this specific memory allocation map. If <em>TypeNo</em> is an invalid integer, <em>invalid_type</em> is returned.</p><p><strong></strong> descr(MemoryData) -&gt; DescrMemoryData</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>DescrMemoryData = {term(), DescrAllocList}</p><p>DescrAllocList = [DescrDesc]</p><p>DescrDesc = {TypeDescr, int(), int(), DescrPidDesc}</p><p>TypeDescr = atom() | string()</p><p>DescrPidDesc = pid() | undefined</p><p>Returns a memory allocation map where the type numbers (first element of <em>Desc</em>) have been replaced by type descriptions, and pid tuples (fourth element of <em>Desc</em>) have been replaced by real pids.</p><p><strong></strong> holes(MemoryData) -&gt; ok</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Prints out the size of each hole (i.e., the space between allocated blocks) on the terminal. <em>NOTE:</em> Really large holes are probably holes between memory segments. The memory allocation map has to be sorted (see <strong>sort/1</strong>).</p><p><strong></strong> mem_limits(MemoryData) -&gt; {Low, High}</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Low = High = int()</p><p>Returns a tuple <em>{Low, High}</em> indicating the lowest and highest address used. The memory allocation map has to be sorted (see <strong>sort/1</strong>).</p><p><strong></strong> memory_data() -&gt; MemoryData | false</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Returns <em>MemoryData</em> (a the memory allocation map) if the emulator has been started with the "<em>+Mim true</em>" command-line argument; otherwise, <em>false</em>. <em>NOTE:</em><em>memory_data/0</em> blocks execution of other processes while the data is collected. The time it takes to collect the data can be substantial.</p><p><strong></strong> memory_status(StatusType) -&gt; [StatusInfo] | false</p><p>Types:</p><p>StatusType = total | allocators | classes | types</p><p>StatusInfo = {About, [Info]}</p><p>About = atom()</p><p>Info = {InfoName, Current, MaxSinceLast, MaxEver}</p><p>InfoName = sizes|blocks</p><p>Current = int()</p><p>MaxSinceLast = int()</p><p>MaxEver = int()</p><p>Returns a list of <em>StatusInfo</em> if the emulator has been started with the "<em>+Mis true</em>" or "<em>+Mim true</em>" command-line argument; otherwise, <em>false</em>.</p><p>See the <strong>read_memory_status/1</strong> function for a description of the <em>StatusInfo</em> term.</p><p><strong></strong> read_memory_data(File) -&gt; MemoryData | {error, Reason}</p><p>Types:</p><p>File = string()</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Reads a memory allocation map from the file <em>File</em> and returns it. The file is assumed to have been created by <em>store_memory_data/1</em>. The error codes are the same as for <em>file:consult/1</em>.</p><p><strong></strong> read_memory_status(File) -&gt; MemoryStatus | {error, Reason}</p><p>Types:</p><p>File = string()</p><p>MemoryStatus = [{StatusType, [StatusInfo]}]</p><p>StatusType = total | allocators | classes | types</p><p>StatusInfo = {About, [Info]}</p><p>About = atom()</p><p>Info = {InfoName, Current, MaxSinceLast, MaxEver}</p><p>InfoName = sizes|blocks</p><p>Current = int()</p><p>MaxSinceLast = int()</p><p>MaxEver = int()</p><p>Reads memory allocation status from the file <em>File</em> and returns it. The file is assumed to have been created by <em>store_memory_status/1</em>. The error codes are the same as for <em>file:consult/1</em>.</p><p>When <em>StatusType</em> is <em>allocators</em>, <em>About</em> is the allocator that the information is about. When <em>StatusType</em> is <em>types</em>, <em>About</em> is the memory block type that the information is about. Memory block types are not described other than by their name and may vary between emulators. When <em>StatusType</em> is <em>classes</em>, <em>About</em> is the memory block type class that information is presented about. Memory block types are classified after their use. Currently the following classes exist:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p><em>process_data</em>: Erlang process specific data.</p>
  </dd>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p><em>binary_data</em>: Erlang binaries.</p>
  </dd>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p><em>atom_data</em>: Erlang atoms.</p>
  </dd>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p><em>code_data</em>: Erlang code.</p>
  </dd>
  <dt>
    <p><strong></strong></p>
  </dt>
  <dd>
    <p><em>system_data</em>: Other data used by the system</p>
  </dd>

</dl>
<p>When <em>InfoName</em> is <em>sizes</em>, <em>Current</em>, <em>MaxSinceLast</em>, and <em>MaxEver</em> are, respectively, current size, maximum size since last call to <em>store_memory_status/1</em> or <em>memory_status/1</em> with the specific <em>StatusType</em>, and maximum size since the emulator was started. When <em>InfoName</em> is <em>blocks</em>, <em>Current</em>, <em>MaxSinceLast</em>, and <em>MaxEver</em> are, respectively, current number of blocks, maximum number of blocks since last call to <em>store_memory_status/1</em> or <em>memory_status/1</em> with the specific <em>StatusType</em>, and maximum number of blocks since the emulator was started.</p><p><em>NOTE:</em>A memory block is accounted for at "the first level" allocator. E.g. <em>fix_alloc</em> allocates its memory pools via <em>ll_alloc</em>. When a <em>fix_alloc</em> block is allocated, neither the block nor the pool in which it resides are accounted for as memory allocated via <em>ll_alloc</em> even though it is.</p><p><strong></strong> sort(MemoryData) -&gt; MemoryData</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Sorts a memory allocation map so that the addresses are in ascending order.</p><p><strong></strong> store_memory_data(File) -&gt; true|false</p><p>Types:</p><p>File = string()</p><p>Stores the current memory allocation map on the file <em>File</em>. Returns <em>true</em> if the emulator has been started with the "<em>+Mim true</em>" command-line argument, and the map was successfully stored; otherwise, <em>false</em>. The contents of the file can later be read using <strong>read_memory_data/1</strong>. <em>NOTE:</em><em>store_memory_data/0</em> blocks execution of other processes while the data is collected. The time it takes to collect the data can be substantial.</p><p><strong></strong> store_memory_status(File) -&gt; true|false</p><p>Types:</p><p>File = string()</p><p>Stores the current memory status on the file <em>File</em>. Returns <em>true</em> if the emulator has been started with the "<em>+Mis true</em>", or "<em>+Mim true</em>" command-line arguments, and the data was successfully stored; otherwise, <em>false</em>. The contents of the file can later be read using <strong>read_memory_status/1</strong>.</p><p><strong></strong> sum_blocks(MemoryData) -&gt; int()</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Returns the total size of the memory blocks in the list.</p><p><strong></strong> type_descr(MemoryData, TypeNo) -&gt; TypeDescr | invalid_type</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>TypeNo = int()</p><p>TypeDescr = atom() | string()</p><p>Returns the type description of a type number used in <em>MemoryData</em>. Valid <em>TypeNo</em>s are in the range returned by <strong>type_no_range/1</strong> on this specific memory allocation map. If <em>TypeNo</em> is an invalid integer, <em>invalid_type</em> is returned.</p><p><strong></strong> type_no_range(MemoryData) -&gt; {Min, Max}</p><p>Types:</p><p>MemoryData = {term(), AllocList}</p><p>AllocList = [Desc]</p><p>Desc = {int(), int(), int(), PidDesc}</p><p>PidDesc = {int(), int(), int()} | undefined</p><p>Min = int()</p><p>Max = int()</p><p>Returns the memory block type number range used in <em>MemoryData</em>. When the memory allocation map was generated by an Erlang 5.3/OTP R9C or newer emulator, all integers <em>T</em> that satisfy <em>Min</em> &lt;= <em>T</em> &lt;= <em>Max</em> are valid type numbers. When the memory allocation map was generated by a pre Erlang 5.3/OTP R9C emulator, all integers in the range are <em>not</em> valid type numbers.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO instrument&hellip;</h2>
        <div class="sectioncontent">
<p><strong>erts_alloc(3erl)</strong>, <a href="../man1/erl.1.html"><strong>erl</strong>(1)</a></strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="init_stub.3erl.html"><span aria-hidden="true">&larr;</span> init_stub.3erl: Coordination of system startup</a></li>
   <li class="next"><a href="int.3erl.html">int.3erl: Interpreter interface <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
