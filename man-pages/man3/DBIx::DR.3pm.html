<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DBIx::DR: Easy dbi helper (perl inside sql and blessed results)</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Easy dbi helper (perl inside sql and blessed results)">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="DBIx::DR (3pm) manual">
  <meta name="twitter:description" content="Easy dbi helper (perl inside sql and blessed results)">
  <meta name="twitter:image" content="https://www.carta.tech/images/libdbix-dr-perl-DBIx::DR-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/DBIx::DR.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DBIx::DR (3pm) manual" />
  <meta property="og:description" content="Easy dbi helper (perl inside sql and blessed results)" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libdbix-dr-perl-DBIx::DR-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">DBIx::DR<small> (3pm)</small></h1>
        <p class="lead">Easy dbi helper (perl inside sql and blessed results)</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::DR.3pm.html">
      <span itemprop="name">DBIx::DR: Easy dbi helper (perl inside sql and blessed results)</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libdbix-dr-perl/">
      <span itemprop="name">libdbix-dr-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/DBIx::DR.3pm.html">
      <span itemprop="name">DBIx::DR: Easy dbi helper (perl inside sql and blessed results)</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
    my $dbh = DBIx::DR-&gt;connect($dsn, $login, $passed);

    $dbh-&gt;perform(
        &apos;UPDATE tbl SET a = 1 WHERE id = &lt;%= $id %&gt;&apos;,
        id =&gt; 123
    );

    my $rowset = $dbh-&gt;select(
        &apos;SELECT * FROM tbl WHERE id IN (&lt;% list @$ids %&gt;)&apos;,
        ids =&gt; [ 123, 456 ]
    );
    my $rowset = $dbh-&gt;select(-f =&gt; &apos;sqlfile.sql.ep&apos;, ids =&gt; [ 123, 456 ]);

    while(my $row = $rowset-&gt;next) {
        print "id: %d, value: %s&#92;n", $row-&gt;id, $row-&gt;value;
    }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The package <em>extends</em> \s-1DBI\s0 and allows You:</p><ul>
<li><p>to use perl inside Your \s-1SQL\s0 requests;</p></li><li><p>to bless resultsets into Your package;</p></li><li><p>to place Your \s-1SQL\s0's into dedicated directory;</p></li><li><p>to use usual \s-1DBI\s0 methods.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Additional 'connect' options.</h2>
        <div class="sectioncontent">
<h3>dr_iterator</h3>
<p>A string describes iterator class. Default value is '<strong>dbix-dr-iterator#new</strong>' (decamelized string).</p>
<h3>dr_item</h3>
<p>A string describes item (one row) class. Default value is '<strong>dbix-dr-iterator-item#new</strong>' (decamelized string).</p>
<h3>dr_sql_dir</h3>
<p>Directory path to seek sql files (If You use dedicated SQLs).</p>
<h3>dr_decode_errors</h3>
<p>Decode database errors into utf-8</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<p>All methods can receive the following arguments: It will load SQL-request from file. It will seek file in directory that was defined in dr_sql_dir param of connect. You needn't to use suffixes (<strong>.sql.ep</strong>) here, but You can.</p>
<dl class='dl-vertical'>
  <dt>
    -item =&gt; 'decamelized_obj_define'
  </dt>
  <dd>
    <p>It will bless (or construct) row into specified class. See below. Default value defined by dr_item argument of <strong>DBI::connect</strong>.</p>
  </dd>
  <dt>
    -noitem
  </dt>
  <dd>
    <p>Do not bless row into any class.</p>
  </dd>
  <dt>
    -iterator =&gt; 'decamelized_obj_define'
  </dt>
  <dd>
    <p>It will bless (or construct) rowset into specified class. Default value defined by dr_iterator argument of <strong>DBI::connect</strong>.</p>
  </dd>
  <dt>
    -noiterator
  </dt>
  <dd>
    <p>Do not bless rowset into any class.</p>
  </dd>
  <dt>
    -noitem_iter
  </dt>
  <dd>
    <p>Do not pass iterator as second argument to item constructor.</p>
  </dd>
  <dt>
    -dbi =&gt; \s-1HASHREF\s0
  </dt>
  <dd>
    <p>Additional \s-1DBI\s0 arguments.</p>
  </dd>
  <dt>
    -hash =&gt; \s-1FIELDNAME\s0
  </dt>
  <dd>
    <p>Selects into \s-1HASH\s0. Iterator will operate by names (not numbers).</p>
  </dd>
  <dt>
    -die =&gt; 0|1
  </dt>
  <dd>
    <p>If <strong>true</strong> the method will die with SQL-request.</p>
  </dd>
  <dt>
    -warn =&gt; 0|1
  </dt>
  <dd>
    <p>If <strong>true</strong> the method will warn with SQL-request.</p>
  </dd>

</dl>
<h3>Decamelized strings</h3>
<p>Are strings that represent class [ and method ].</p><p> foo_bar                =&gt; FooBar  foo_bar#subroutine     =&gt; FooBar-&gt;subroutine  foo_bar-baz            =&gt; FooBar::Baz</p>
<h3>perform</h3>
<p>Does SQL-request like '<strong>\s-1UPDATE\s0</strong>', '<strong>\s-1INSERT\s0</strong>', etc.</p><p>    $dbh-&gt;perform($sql, value =&gt; 1, other_value =&gt; &apos;abc&apos;);     $dbh-&gt;perform(-f =&gt; $sql_file_name, value =&gt; 1, other_value =&gt; &apos;abc&apos;);</p>
<h3>select</h3>
<p>Does SQL-request, pack results into iterator class. By default it uses DBIx::DR::Iterator class.</p><p>    my $res = $dbh-&gt;select(-f =&gt; $sql_file_name, value =&gt; 1);     while(my $row = $res-&gt;next) {         printf "RowId: %d, RowValue: %s&#92;n", $row-&gt;id, $row-&gt;value;     }</p><p>    my $row = $row-&gt;get(15);  # row 15</p><p>    my $res = $dbh-&gt;select(-f =&gt; $sql_file_name,             value =&gt; 1, -hash =&gt; &apos;name&apos;);     while(my $row = $res-&gt;next) {         printf "RowId: %d, RowName: %s&#92;n", $row-&gt;id, $row-&gt;name;     }</p><p>    my $row = $row-&gt;get(&apos;Vasya&apos;);  # row with name eq &apos;Vasya&apos;</p>
<h3>single</h3>
<p>Does SQL-request that returns one row. Pack results into item class. Does SQL-request, pack results (one row) into item class. By default it uses DBIx::DR::Iterator::Item class.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Template language</h2>
        <div class="sectioncontent">
<p>You can use perl inside Your \s-1SQL\s0 requests:</p><p>    % my $foo = 1;     % my $bar = 2;     &lt;% my $foo_bar = $foo + $bar %&gt;</p><p>    ..</p><p>    % use POSIX;     % my $gid = POSIX::getgid;</p><p>There are two functions available inside perl:</p><h3>quote</h3>
<p>Replaces argument to '<strong>?</strong>', add argument value into bindlist. You can also use shortcut '<strong>=</strong>' instead of the function.</p><p><strong>Example 1</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = &lt;% quote $id %&gt;</p><p><strong>Result</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = ?</p><p>and <strong>bindlist</strong> will contain <strong>id</strong> value.</p><p>If You use DBIx::DR::ByteStream in place of string the function will recall immediate function.</p><p><strong>Example 2</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = &lt;%= $id %&gt;</p>
<h3>immediate</h3>
<p>Replaces argument to its value. You can also use shortcut '<strong>==</strong>' instead of the function.</p><p><strong>Example 1</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = &lt;% immediate $id %&gt;</p><p><strong>Result</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = 123</p><p>Where 123 is <strong>id</strong> value.</p><p>Be carful! Using the operator You can produce code that will be amenable to SQL-injection.</p><p><strong>Example 2</strong></p><p>    SELECT         *     FROM         tbl     WHERE         id = &lt;%== $id %&gt;</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Helpers</h2>
        <div class="sectioncontent">
<p>There are a few default helpers.</p><h3>list</h3>
<p>Expands array into Your \s-1SQL\s0 request.</p><p><em>Example</em></p><p>    SELECT         *     FROM         tbl     WHERE         status IN (&lt;% list @$ids %&gt;)</p><p>Result</p><p>    SELECT         *     FROM         tbl     WHERE         status IN (?,?,? ...)</p><p>and <strong>bindlist</strong> will contain <strong>ids</strong> values.</p>
<h3>hlist</h3>
<p>Expands array of hash into Your \s-1SQL\s0 request. The first argument can be a list of required keys. Places each group into brackets.</p><p><em>Example</em></p><p>    INSERT INTO         tbl             (&apos;a&apos;, &apos;b&apos;)     VALUES         &lt;% hlist [&apos;a&apos;, &apos;b&apos;] =&gt; @$inserts</p><p>Result</p><p>    INSERT INTO         tbl             (&apos;a&apos;, &apos;b&apos;)     VALUES         (?, ?), (?, ?) ...</p><p>and <strong>bindlist</strong> will contain all <strong>inserts</strong> values.</p>
<h3>include</h3>
<p>Includes the other SQL-part.</p><p><em>Example</em></p><p>    % include &apos;other_sql&apos;, argument1 =&gt; 1, argument2 =&gt; 2;</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">User's helpers</h2>
        <div class="sectioncontent">
<p>You can add Your helpers using method set_helper.</p><h3>set_helper</h3>
<p>Sets (or replaces) helpers.</p><p>    $dbh-&gt;set_helper(foo =&gt; sub { ... }, bar =&gt; sub { ... });</p><p>Each helper receives template object as the first argument.</p><p>Examples:</p><p>    $dbh-&gt;set_helper(foo_AxB =&gt; sub {         my ($tpl, $a, $b) = @_;         $tpl-&gt;quote($a * $b);     });</p><p>You can use quote and immediate functions inside Your helpers.</p><p>If You want use the other helper inside Your helper You have to do that by Yourself. To call the other helper You can also use \*(C`$tpl-&gt;call_helper\*(C' function.</p><p><em>call_helper</em></p><p>    $dbh-&gt;set_helper(         foo =&gt; sub {             my ($tpl, $a, $b) = @_;             $tpl-&gt;quote(&apos;foo&apos; . $a . $b);         },         bar =&gt; sub {             my $tpl = shift;             $tpl-&gt;call_helper(foo =&gt; &apos;b&apos;, &apos;c&apos;);         }     );</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p> Copyright (C) 2011 Dmitry E. Oboukhov &lt;unera@debian.org&gt;  Copyright (C) 2011 Roman V. Nikolaev &lt;rshadow@rambler.ru&gt;</p><p> This program is free software, you can redistribute it and/or  modify it under the terms of the Artistic License.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VCS</h2>
        <div class="sectioncontent">
<p>The project is placed git repo on github: https://github.com/unera/dbix-dr/ &lt;https://github.com/unera/dbix-dr/&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="DBIx::DBStag::SQLTemplate.3pm.html"><span aria-hidden="true">&larr;</span> DBIx::DBStag::SQLTemplate.3pm: </a></li>
   <li class="next"><a href="DBIx::DR::ByteStream.3pm.html">DBIx::DR::ByteStream.3pm: Bytestream <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
