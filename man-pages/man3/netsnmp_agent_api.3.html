<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>netsnmp_agent_api: Embedding an agent into a external application</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Embedding an agent into a external application">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="netsnmp_agent_api (3) manual">
  <meta name="twitter:description" content="Embedding an agent into a external application">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsnmp-dev-netsnmp_agent_api-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/netsnmp_agent_api.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="netsnmp_agent_api (3) manual" />
  <meta property="og:description" content="Embedding an agent into a external application" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsnmp-dev-netsnmp_agent_api-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">netsnmp_agent_api<small> (3)</small></h1>
        <p class="lead">Embedding an agent into a external application</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/netsnmp_agent_api.3.html">
      <span itemprop="name">netsnmp_agent_api: Embedding an agent into a external application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsnmp-dev/">
      <span itemprop="name">libsnmp-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/netsnmp_agent_api.3.html">
      <span itemprop="name">netsnmp_agent_api: Embedding an agent into a external application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
#include &lt;net-snmp/net-snmp-config.h&gt;
#include &lt;net-snmp/net-snmp-includes.h&gt;
#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;

int
main (int argc, char *argv[])
{
  int agentx_subagent = 1;  /* Change this if you're a master agent.  */

  snmp_enable_stderrlog();

  /*  If we're an AgentX subagent...  */
  if (agentx_subagent) {
      /* ...make us an AgentX client.  */
      netsnmp_ds_set_boolean(NETSNMP_DS_APPLICATION_ID,
                             NETSNMP_DS_AGENT_ROLE, 1);
  }

  init_agent("yourappname");

  /*  Initialize your MIB code here.  */
  init_my_mib_code();

  /*  `yourappname' will be used to read yourappname.conf files.  */
  init_snmp("yourappname");

  /*  If we're going to be a SNMP master agent...  */
  if (!agentx_subagent)
      init_master_agent();  /*  Listen on default port (161).  */

  /*  Your main loop here...  */
  while (whatever) {
      /* if you use select(), see <strong>snmp_api</strong>(3) */
      /*     --- OR ---  */
      <strong>agent_check_and_process</strong>(0); /* 0 == don't block */
  }

  /*  At shutdown time:  */
  snmp_shutdown("yourappname");
}

Then:
$(CC) ... `net-snmp-config --agent-libs`

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Our goal is to create a easy to use interface to the Net-SNMP package such that you can take code that you have written that has been designed to be a Net-SNMP MIB module and embed it into an external application where you can either chose to be a SNMP master agent or an AgentX sub-agent using the same MIB module code.  Our suggestion is that you use our (or another) SNMP agent as the AgentX master agent and chose to become an AgentX subagent which then attaches to the master.</p><p>The Net-SNMP package provides a pair of libraries that enables easy embedding of an SNMP or AgentX agent into an external software package. AgentX is an extensible protocol designed to allow multiple SNMP sub-agents all run on one machine under a single SNMP master agent.  It is defined in RFC 2741.</p><p>You will need to perform a few tasks in order to accomplish this. First off, you will need to initialize both the SNMP library and the SNMP agent library. As indicated above, this is done slightly differently depending on whether or not you are going to perform as a master agent or an AgentX sub-agent.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>If you intend to operate as an AgentX sub-agent, you will have to configured the Net-SNMP package with agentx support (which is turned on by default, so just don't turn it off)</p><p>Additionally, you will need to link against the Net-SNMP libraries (use the output of "net-snmp-config --agent-libs" to get a library list) and call subagent_pre_init() as indicated above.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPILING</h2>
        <div class="sectioncontent">
<p>In order to make use of any of the above API, you will need to link against at least the four libraries listed above.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS</h2>
        <div class="sectioncontent">
<p>where to find out more information on them.  It is certainly not a complete list of what is available within all the Net-SNMP libraries.</p>
<dl class='dl-vertical'>
  <dt>
    snmp_enable_stderrlog()
  </dt>
  <dd>
    <p>Logs error output from the SNMP agent to the standard error stream.</p>
  </dd>
  <dt>
    netsnmp_ds_set_boolean()
  </dt>
  <dd>
    <p>Please see the <a href="../man3/default_store.3.html"><strong>default_store</strong>(3)</a></em> manual page for more information about this API.</p>
  </dd>
  <dt>
    init_agent(char *name)
  </dt>
  <dd>
    <p>Initializes the embedded agent.  This should be called before the <strong>init_snmp()</strong> call. <em>name</em> is used to dictate what .conf file to read when <strong>init_snmp()</strong> is called later.</p>
  </dd>
  <dt>
    init_snmp(char *name)
  </dt>
  <dd>
    <p>Initializes the SNMP library.  Note that one of the things this will do will be to read configuration files in an effort to configure your application. It will attempt to read the configuration files named by the <em>name</em> string that you passed in.  It can be used to configure access control, for instance.   Please see the <a href="../man3/netsnmp_config_api.3.html"><strong>netsnmp_config_api</strong>(3)</a></em>, <a href="../man5/snmp_config.5.html"><strong>snmp_config</strong>(5)</a></em>, and <strong>snmpd.conf</strong>(5)</em> manual pages for further details on this subject.</p>
  </dd>
  <dt>
    init_master_agent(void)
  </dt>
  <dd>
    <p>Initializes the master agent and causes it to listen for SNMP requests on its default UDP port of 161.</p>
  </dd>
  <dt>
    agent_check_and_process(int block)
  </dt>
  <dd>
    <p>This checks for packets arriving on the SNMP port and processes them if some are found.  If <em>block</em> is non-zero, the function call will block until a packet arrives or an alarm must be run (see <a href="../man3/snmp_alarm.3.html"><strong>snmp_alarm</strong>(3)</a></em>). The return value from this function is a positive integer if packets were processed, zero if an alarm occurred and -1 if an error occured.</p>
  </dd>
  <dt>
    snmp_shutdown(char *name);
  </dt>
  <dd>
    <p>This shuts down the agent, saving any needed persistent storage, etc.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO netsnmp_agent_api&hellip;</h2>
        <div class="sectioncontent">
<p>http://www.net-snmp.org/tutorial-5/toolkit/ <a href="../man2/select.2.html"><strong>select</strong>(2)</a>, <strong>snmp_api</strong>(3), <a href="../man3/default_store.3.html"><strong>default_store</strong>(3)</a>, <a href="../man3/snmp_alarm.3.html"><strong>snmp_alarm</strong>(3)</a>, <a href="../man3/netsnmp_config_api.3.html"><strong>netsnmp_config_api</strong>(3)</a>, <a href="../man5/snmp_config.5.html"><strong>snmp_config</strong>(5)</a>, <strong>snmpd.conf</strong>(5)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="netread.3.html"><span aria-hidden="true">&larr;</span> netread.3: Receive a message from a socket</a></li>
   <li class="next"><a href="netsnmp_config_api.3.html">netsnmp_config_api.3: Netsnmp_config_api functions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
