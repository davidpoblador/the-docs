<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CGI::Application::Plugin::MessageStack: A message stack for your cgi::application</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A message stack for your cgi::application">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="CGI::Application::Plugin::MessageStack (3pm) manual">
  <meta name="twitter:description" content="A message stack for your cgi::application">
  <meta name="twitter:image" content="https://www.carta.tech/images/libcgi-application-plugin-messagestack-perl-CGI::Application::Plugin::MessageStack-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/CGI::Application::Plugin::MessageStack.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CGI::Application::Plugin::MessageStack (3pm) manual" />
  <meta property="og:description" content="A message stack for your cgi::application" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libcgi-application-plugin-messagestack-perl-CGI::Application::Plugin::MessageStack-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">CGI::Application::Plugin::MessageStack<small> (3pm)</small></h1>
        <p class="lead">A message stack for your cgi::application</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::MessageStack.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::MessageStack: A message stack for your cgi::application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libcgi-application-plugin-messagestack-perl/">
      <span itemprop="name">libcgi-application-plugin-messagestack-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/CGI::Application::Plugin::MessageStack.3pm.html">
      <span itemprop="name">CGI::Application::Plugin::MessageStack: A message stack for your cgi::application</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>Version 0.34</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>This plugin gives you a few support methods that you can call within your cgiapp to pass along messages between requests for a given user.</p>
<pre>
 use CGI::Application::Plugin::Session;
 use CGI::Application::Plugin::MessageStack;

 sub mainpage {
   my $self = shift;
   my $template = $self-&gt;load_tmpl( &apos;mainpage.TMPL&apos;, &apos;die_on_bad_params&apos; =&gt; 0 );
   # ...
   $template-&gt;output;
 }

 sub process {
   my $self = shift;
   $self-&gt;push_message(
       -scope          =&gt; &apos;mainpage&apos;,
       -message        =&gt; &apos;Your listing has been updated&apos;,
       -classification =&gt; &apos;INFO&apos;,
     );
   $self-&gt;forward( &apos;mainpage&apos; );
 }

 sub cgiapp_init {
   # setup your session object as usual...
 }
</pre>
<p>Meanwhile, in your (HTML::Template) template code:</p><p> ...  &lt;style type="text/css"&gt;    .INFO {      font-weight: bold;    }    .ERROR {      color: red;    }  &lt;/style&gt;  ...  &lt;h1&gt;Howdy!&lt;/h1&gt;  &lt;!-- TMPL_LOOP NAME="CAP_Messages" --&gt;    &lt;div class="&lt;!-- TMPL_VAR NAME="classification" --&gt;"&gt;      &lt;!-- TMPL_VAR NAME="message" --&gt;    &lt;/div&gt;  &lt;!-- /TMPL_LOOP --&gt;  ...</p><p>It's a good idea to turn off 'die_on_bad_params' in HTML::Template - in case this plugin tries to put in the parameters and they're not available in your template.</p><p>Here's a quick \s-1TT\s0 example:</p><p> &lt;style type="text/css"&gt;    .INFO {      font-weight: bold;    }    .ERROR {      color: red;    }  &lt;/style&gt;  ...  &lt;h1&gt;Howdy!&lt;/h1&gt;  [% FOREACH CAP_Messages %]     &lt;div class="[% classification %]"&gt;[% message %]&lt;/div&gt;  [% END %]  ...</p><p>If you use \s-1TT\s0, I recommend using CAP-TT and a more recent version (0.09), which supports cgiapp's load_tmpl hook and then this plugin will automatically supply \s-1TT\s0 with the relevant messages.  Your runmode could be this simple:</p><p> sub start {      my $self = shift;      my $session = $self-&gt;session;      return $self-&gt;tt_process( &apos;output.tt&apos; );  }</p><p>I don't have the experience to weigh in on how you'd do this with other templates (HTDot, Petal), but basically, this plugin will put in a loop parameter called 'CAP_Messages'.  Within each element of that loop, you'll have two tags, 'classification' and 'message'.</p><p>\s-1NOTE:\s0 I have broken backwards compatibility with this release (0.30) and the loop parameter's default name is now 'CAP_Messages'.  If you used the old _\|_CAP_Messages or want to use another name, feel free to use the capms_config to override the \*(C`-loop_param_name\*(C'.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This plugin by default needs a session object to tuck away the message(s).  It's recommended that you use this in conjunction with CGI::Application::Plugin::Session.  You can opt to not have the messages persist and thereby, not use CAP-Session by using the \*(C`-dont_use_session\*(C' option in the \*(C`capms_config\*(C' method.</p><p>This plugin hooks into cgiapp's load_tmpl method and if you've pushed any messages in the stack, will automatically add the message parameters.</p><p>In the functions, there are scope & classification keys and when they're used for either display or your \s-1API\s0 purposes (clearing, pop'ing, etc), the classification is an exclusive specification.  Meaning, if you ask for messages with the '\s-1ERROR\s0' classification, it will only deal with messages that you've pushed in with the '\s-1ERROR\s0' classification.  Any messages that have no classification aren't included.</p><p>The scope key is not exclusive, meaning that if you ask for messages with a 'mainpage' scope, it will deal with messages that you've pushed with that scope <strong>as well as</strong> any messages that you've pushed in without a scope.</p><p>If you use both scope & classification, it blends both of those rules, first getting all matching messages with the same classification and then filtering out messages that are scoped and don't match the scope you're looking for.</p><p>This logic may change as I get feedback from more saavy developers.  What we may end up doing is have a plugin configuration where you can dictate the logic that's used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FUNCTIONS</h2>
        <div class="sectioncontent">
<h3>push_message</h3>
<p> $self-&gt;push_message(      -scope          =&gt; &apos;mainpage&apos;,      -message        =&gt; &apos;Your listing has been updated&apos;,      -classification =&gt; &apos;INFO&apos;,    );</p><p>You provide a hash to the <em>push_message()</em> method with three possible keys:</p><ul>
<li><p>message - a text message.  You can put \s-1HTML\s0 in there - just make sure you don't use the ESCAPE=HTML in your HTML::Template code</p></li><li><p>scope - which runmode(s) can this message appear?  If you want to specify just one, use a scalar assignment.  Otherwise, use an array reference with the list of runmodes.</p></li><li><p>classification - a simple scalar name representing the classification of your message (i.e. '\s-1ERROR\s0', '\s-1WARNING\s0' ... ).  This is very useful for \s-1CSS\s0 styles (see template example above).</p></li>
</ul><p>The scope & classification keys are optional.  If you don't provide a scope, it will assume a global presence.</p>
<h3>messages</h3>
<p> my @messages = $self-&gt;messages();  my @messages = $self-&gt;messages( -scope =&gt; &apos;mainpage&apos; );  my @messages = $self-&gt;messages( -scope =&gt; &apos;mainpage&apos;, -classification =&gt; &apos;ERROR&apos; );  my @messages = $self-&gt;messages( -classification =&gt; &apos;ERROR&apos; );</p><p>If you want to take a gander at the message stack data structure, you can use this method.</p><p>Optionally, you can use a hash parameters to get a slice of the messages, using the same keys as specified in the <em>push_message()</em> method.</p><p>It will return an array reference of the matching messages or 'undef', if there's either no messages in the stack or no messages that match your specification(s).</p>
<h3>pop_message</h3>
<p> my $message = $self-&gt;pop_message();  my $message = $self-&gt;pop_message( -scope =&gt; &apos;mainpage&apos; );  my $message = $self-&gt;pop_message( -scope =&gt; &apos;mainpage&apos;, -classification =&gt; &apos;WARNING&apos; );  my $message = $self-&gt;pop_message( -classification =&gt; &apos;ERROR&apos; );</p><p>Pops off the last message from the stack and returns it.  Note that this just returns the -message part.</p><p>You can pop off an exact message, given a hash parameters, using the same keys as specified in the <em>push_message()</em> method.</p><p>Otherwise, it will pop off the message, given the current runmode and the last message added.</p>
<h3>clear_messages</h3>
<p> $self-&gt;clear_messages();  $self-&gt;clear_messages( -scope =&gt; &apos;mainpage&apos; );  $self-&gt;clear_messages( -scope =&gt; &apos;mainpage&apos;, -classification =&gt; &apos;ERROR&apos; );  $self-&gt;clear_messages( -classification =&gt; &apos;ERROR&apos; );</p><p>Clears the message stack.</p><p>Optionally, you can clear particular slices of the message stack, given a hash parameters, using the same keys as specified in the <em>push_message()</em> method.</p><p>If you specify a scope, it will clear any messages that are either global or match that scope</p><p>If you specify a classification, it will clear any messages that have that classification (but not any messages that don't have any classification).</p><p>If you specify both, it will combine both that logic in an \s-1AND\s0 fashion.</p>
<h3>capms_config</h3>
<p> $self-&gt;capms_config(      -automatic_clearing            =&gt; 1,      -dont_use_session              =&gt; 1,      -loop_param_name               =&gt; &apos;MyOwnLoopName&apos;,      -message_param_name            =&gt; &apos;MyOwnMessageName&apos;,      -classification_param_name     =&gt; &apos;MyOwnClassificationName&apos;,    );</p><p>There is a configuration option that you, as the developer can specify:</p><ul>
<li><p>-automatic_clearing: By default, this is turned off.  If you override it with a true value, it will call <em>clear_messages()</em> automatically after the messages are automatically put into template.</p></li><li><p>-dont_use_session: This will override this Plugin's dependence on CGI::Application::Plugin::Session and instead, temporarily store the message data such that it will be available to templates within the same web request, but no further.  If you're running your cgiapp under a persistent state (mod_perl), we'll also make sure your messages are gone by the end of the request.</p></li><li><p>-loop_param_name: This will override the default _\|_CAP_Messages (or CAP_Messages for \s-1TT\s0 users) name for the loop of messages, which is only used for the \*(C`load_tmpl\*(C' callback.  Meaning, this configuration will only impact your template code.  So if you use the 'MyOwnLoopName' above, then your template code (for HTML::Template users) should look like:  &lt;!-- TMPL_LOOP NAME="MyOwnLoopName" --&gt;  ...  &lt;!-- /TMPL_LOOP --&gt;</p></li><li><p>-message_param_name: This will override the default '-message' in both the template code <strong>as well as</strong> the keys in each hashref of the arrayref that's returned by the <em>messages()</em> function.  So a call to <em>messages()</em> may return:  [ { &apos;MyOwnMessageName&apos; =&gt; &apos;this is just a test&apos; }, ... ] instead of:  [ { &apos;-message&apos; =&gt; &apos;this is just a test&apos; }, ... ] Likewise, your templates will need to use your parameter name:  &lt;!-- TMPL_LOOP NAME="MyOwnLoopName" --&gt;    Here&apos;s the message: &lt;!-- TMPL_VAR NAME="MyOwnMessageName" --&gt;  &lt;!-- /TMPL_LOOP --&gt;</p></li><li><p>-classification_param_name: Just like the \*(C`-message_param_name\*(C' parameter - this will override the default '-classification' key in both the template code <strong>as well as</strong> the keys in each hashref of the arrayref that's returned by the <em>messages()</em> function.  So a call to <em>messages()</em> may return:  [ { &apos;MyOwnClassificationName&apos; =&gt; &apos;ERROR&apos;, &apos;MyOwnMessageName&apos; =&gt; &apos;this is just a test&apos; }, ... ] instead of:  [ { &apos;-classification&apos; =&gt; &apos;ERROR&apos;, &apos;-message&apos; =&gt; &apos;this is just a test&apos; }, ... ] Likewise, your templates will need to use your parameter name:  &lt;!-- TMPL_LOOP NAME="MyOwnLoopName" --&gt;     &lt;div class="&lt;!-- TMPL_VAR NAME="MyOwnClassificationName" --&gt;"&gt;        Here&apos;s the message: &lt;!-- TMPL_VAR NAME="MyOwnMessageName" --&gt;     &lt;/div&gt;  &lt;!-- /TMPL_LOOP --&gt;</p></li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Jason Purdy, \*(C`&lt;Jason@Purdy.INFO&gt;\*(C'</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO CGI::Application::Plugin::MessageStack&hellip;</h2>
        <div class="sectioncontent">
<p>CGI::Application and CGI::Application::Plugin::Session</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report any bugs or feature requests to \*(C`bug-cgi-application-plugin-messagestack@rt.cpan.org\*(C', or through the web interface at http://rt.cpan.org/NoAuth/ReportBug.html?Queue=CGI-Application-Plugin-MessageStack &lt;http://rt.cpan.org/NoAuth/ReportBug.html?Queue=CGI-Application-Plugin-MessageStack&gt;. I will be notified, and then you'll automatically be notified of progress on your bug as I make changes.</p><p>I suspect that this code could use some expert guidance.  I hacked it together and I'd hate to think that it would be responsible for slowing templates down.  Please feel free to submit patches, guiding comments, etc.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">
<p>Thanks to the guys on the #cgiapp channel</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT & LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright 2005 Jason Purdy, all rights reserved.</p><p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="CGI::Application::Plugin::LogDispatch.3pm.html"><span aria-hidden="true">&larr;</span> CGI::Application::Plugin::LogDispatch.3pm: Add log::dispatch support to cgi::application</a></li>
   <li class="next"><a href="CGI::Application::Plugin::ProtectCSRF.3pm.html">CGI::Application::Plugin::ProtectCSRF.3pm: Generate and verify anti-csrf tickets <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
