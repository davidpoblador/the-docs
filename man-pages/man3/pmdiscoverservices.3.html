<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmdiscoverservices: Discover pcp services on the network</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Discover pcp services on the network">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmdiscoverservices<small> (3)</small></h1>
        <p class="lead">Discover pcp services on the network</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmdiscoverservices.3.html">
      <span itemprop="name">pmdiscoverservices: Discover pcp services on the network</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmdiscoverservices.3.html">
      <span itemprop="name">pmdiscoverservices: Discover pcp services on the network</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">

<p>#include &lt;pcp/pmapi.h&gt;</p>
<p class='spacer'>

<pre>int pmDiscoverServices(const char *<em>service</em>, const char *<em>mechanism</em>, char ***<em>urls</em>);</pre>

<p class='spacer'>

<p>#include &lt;pcp/impl.h&gt;</p>
<p class='spacer'>

<pre>int __pmDiscoverServicesWithOptions(const char *<em>service</em>, const char *<em>mechanism</em>, const char *<em>optionsString</em>, const volatile unsigned *<em>flags</em>, char ***<em>urls</em>);</pre>

<p class='spacer'>

<p>cc ... -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>Given a PCP service name, as identified by <em>service</em>, and using the type of discovery optionally specified in <em>mechanism</em>, <strong>pmDiscoverServices</strong> returns, via <em>urls</em>, a list of URLs representing the services discovered on the network.</p>
<p class='spacer'>

<p>The internal function <strong>__pmDiscoverServicesWithOptions</strong> performs the same function and adds arguments for global options and a mechanism for interrupting the discovery process.</p>
<p class='spacer'>

<p>The <a href="../man1/pmfind.1.html"><strong>pmfind</strong>(1)</a> utility provides command line access to both of these interfaces.</p>
<p class='spacer'>

<p>Calling</p>
<p class='spacer'>

<p>pmDiscoverServices(<em>service</em>, <em>mechanism</em>, <em>urls</em>)</p>
<p class='spacer'>

<p>is equivalent to calling</p>
<p class='spacer'>

<p>__pmDiscoverServicesWithOptions(<em>service</em>, <em>mechanism</em>, NULL, NULL, <em>urls</em>);</p>
<p class='spacer'>

<p><em>service</em> specifies the PCP service to be discovered. Currently supported services are <strong>PM_SERVER_SERVICE_SPEC,</strong> <strong>PM_PROXY_SERVICE_SPEC</strong> and <strong>PM_WEBD_SERVICE_SPEC,</strong> which search for <strong>pmcd</strong>(1), <a href="../man1/pmproxy.1.html"><strong>pmproxy</strong>(1)</a>, and <a href="../man1/pmwebd.1.html"><strong>pmwebd</strong>(1)</a>, servers respectively.</p>
<p class='spacer'>

<p><em>mechanism</em> specifies the style of discovery to be used.</p>
<p class='spacer'>

  <p>The currently supported mechanisms are:</p>
  <dl class='dl-vertical'>
    <dt><strong>avahi</strong></dt>
    <dd>
  <p>This searches for services which are broadcasting using mDNS via <strong>avahi-daemon</strong>(8). An optional suffix <strong>",timeout=N"</strong> may be added to specify the discovery timeout in floating-point multiples of one second.  The default timeout is 0.5 seconds, which may be overridden by the <strong>AVAHI_DISCOVERY_TIMEOUT</strong> environment variable, also specified in floating-point multiples of one second. If both are specified, then the value specified in the environment variable takes precedence.</p>
    </dd>
    <dt><strong>probe=&lt;net-address&gt;/&lt;mask-bits&gt;</strong></dt>
    <dd>
  <p>Actively probes the given subnet for the requested PCP service(s). &lt;net-address&gt; is an inet or ipv6 network address and &lt;mask-bits&gt; is the number of bits used to define the subnet. For example, 192.168.1.0/24 defines an 8 bit subnet consisting of the addresses 192.168.1.0 through 192.168.1.255. An optional suffix <strong>",maxThreads=N"</strong> may be added to limit the number of threads used while probing. The default is no fixed limit, which is to say that the process' rlimits for the number of threads and open file descriptors will be respected. An optional suffix <strong>",timeout=N"</strong> may be added to specify the timeout for each connection attempt in floating-point multiples of one second.  The default timeout is 20 milliseconds.</p>
    </dd>
  </dl>
<p class='spacer'>

<p><em>mechanism</em> may also be NULL, which means to use all available discovery mechanisms.</p>
<p class='spacer'>

  <p>For <strong>__pmDiscoverServicesWithOptions,</strong> <em>optionsString</em> specifies global options to be applied to the discovery process. Options are comma-separated and may be one or more of the following:</p>
  <dl class='dl-vertical'>
    <dt><strong>resolve</strong></dt>
    <dd>
  <p>This requests that DNS name resolution be attempted for the addresses of any discovered services.</p>
    </dd>
    <dt><strong>timeout=N</strong></dt>
    <dd>
  <p>This specifies a timeout period after which the discovery process will be interrupted. N is a floating point number representing the number of seconds before timing out.</p>
    </dd>
  </dl>
<p class='spacer'>

<p><em>optionsString</em> may also be NULL, which means that no global options are specified.</p>
<p class='spacer'>

  <p>For <strong>__pmDiscoverServicesWithOptions,</strong> <em>flags</em> specifies a pointer to an object of type <em>unsigned</em> which is a bit mask of options/status flags for the discovery process. The supported flags are:</p>
  <dl class='dl-vertical'>
    <dt><strong>PM_SERVICE_DISCOVERY_RESOLVE</strong></dt>
    <dd>
  <p>Specifying this flag is equivalent to specifying <em>resolve</em> in the <em>optionsString</em></p>
    </dd>
    <dt><strong>PM_SERVICE_DISCOVERY_INTERRUPTED</strong></dt>
    <dd>
  <p>This flag must be unset when calling <strong>__pmDiscoverServicesWithOptions</strong> but may be set asynchronously (by an interrupt handler, for example) in order to interrupt the service discovery process.</p>
    </dd>
  </dl>
<p class='spacer'>

<p><em>flags</em> may also be NULL, which indicates that no flags are set.</p>
<p class='spacer'>

<p><strong>pmDiscoverServices</strong> and <strong>__pmDiscoverServicesWithOptions</strong> will return the number of services discovered, else a value less than zero for an error. The value zero indicates that no services were discovered.</p>
<p class='spacer'>

<p>The resulting list of pointers, <em>urls</em>, <strong>and</strong> the values (the URLs) that the pointers reference will have been allocated by <strong>pmDiscoverServices</strong> or <strong>__pmDiscoverServicesWithOptions</strong> with a single call to <a href="../man3/malloc.3.html"><strong>malloc</strong>(3)</a>, and it is the responsibility of the <strong>pmDiscoverServices</strong> or <strong>__pmDiscoverServicesWithOptions</strong> caller to <strong>free</strong>(<strong>.IR</strong>urls<strong>)</strong> to release the space when it is no longer required.</p>
<p class='spacer'>

<p>When an error occurs, or no services are discovered, <em>urls</em> is undefined (no space will have been allocated, and so calling <a href="../man3/free.3.html"><strong>free</strong>(3)</a> is a singularly bad idea).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">

<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <strong>pcp.conf</strong>(5). Values for these variables may be obtained programmatically using the <strong>pmGetConfig</strong>(3) function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">

  <dl class='dl-horizontal'>
    <dt>f3-EINVALf1</dt>
    <dd>
  <p>An invalid argument has been specified.</p>
    </dd>
    <dt>f3-ENOMEMf1</dt>
    <dd>
  <p>Unable to allocate memory required to process the request.</p>
    </dd>
    <dt>f3-EOPNOTSUPPf1</dt>
    <dd>
  <p>The specified <em>mechanism</em> is not supported.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmdiscoverservices&hellip;</h2>
        <div class="sectioncontent">

<p><strong>PMAPI</strong>(3), <strong>pmcd</strong>(1), <a href="../man1/pmproxy.1.html"><strong>pmproxy</strong>(1)</a>, <a href="../man1/pmwebd.1.html"><strong>pmwebd</strong>(1)</a>, <a href="../man1/pmfind.1.html"><strong>pmfind</strong>(1)</a>, <strong>pmGetConfig</strong>(3), <strong>pcp.conf</strong>(5), <a href="../man5/pcp.env.5.html"><strong>pcp.env</strong>(5)</a> and <strong>avahi-daemon</strong>(8).</p>
        </div>
      </section>

<nav>
  <ul class="pager">
   <li class="previous"><a href="pmdestroycontext.3.html"><span aria-hidden="true">&larr;</span> pmdestroycontext.3: Destroy a pmapi context</a></li>
   <li class="next"><a href="pmdupcontext.3.html">pmdupcontext.3: Duplicate a pmapi context <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
