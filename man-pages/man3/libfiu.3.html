<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>libfiu: Fault injection in userspace</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Fault injection in userspace">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="libfiu (3) manual">
  <meta name="twitter:description" content="Fault injection in userspace">
  <meta name="twitter:image" content="https://www.carta.tech/images/libfiu-dev-libfiu-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/libfiu.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="libfiu (3) manual" />
  <meta property="og:description" content="Fault injection in userspace" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libfiu-dev-libfiu-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">libfiu<small> (3)</small></h1>
        <p class="lead">Fault injection in userspace</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libfiu.3.html">
      <span itemprop="name">libfiu: Fault injection in userspace</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libfiu-dev/">
      <span itemprop="name">libfiu-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/libfiu.3.html">
      <span itemprop="name">libfiu: Fault injection in userspace</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSYS</h2>
        <div class="sectioncontent">

<pre>
<strong>/* Core API */</strong>
<strong>#include &lt;fiu.h&gt;</strong>

<strong>int fiu_init(unsigned int </strong><em>flags</em><strong>);</strong>
<strong>int fiu_fail(const char *</strong><em>name</em><strong>);</strong>
<strong>void *fiu_failinfo(void);</strong>
<strong>[void] fiu_do_on(char *</strong><em>name</em><strong>, </strong><em>action</em><strong>); [macro]</strong>
<strong>[void] fiu_exit_on(char *</strong><em>name</em><strong>); [macro]</strong>
<strong>[void] fiu_return_on(char *</strong><em>name</em><strong>, </strong><em>retval</em><strong>); [macro]</strong>

<strong>/* Control API */</strong>
<strong>#include &lt;fiu-control.h&gt;</strong>

<strong>int fiu_enable(const char *</strong><em>name</em><strong>, int </strong><em>failnum</em><strong>,</strong>
<strong>		void *</strong><em>failinfo</em><strong>, unsigned int </strong><em>flags</em><strong>);</strong>
<strong>int fiu_enable_random(const char *</strong><em>name</em><strong>, int </strong><em>failnum</em><strong>,</strong>
<strong>		void *</strong><em>failinfo</em><strong>, unsigned int </strong><em>flags</em><strong>, float </strong><em>probability</em><strong>);</strong>
<strong>typedef int external_cb_t(const char *</strong><em>name</em><strong>, int *</strong><em>failnum</em><strong>,</strong>
<strong>		void **</strong><em>failinfo</em><strong>, unsigned int *</strong><em>flags</em><strong>);</strong>
<strong>int fiu_enable_external(const char *</strong><em>name</em><strong>, int </strong><em>failnum</em><strong>,</strong>
<strong>		void *</strong><em>failinfo</em><strong>, unsigned int </strong><em>flags</em><strong>,</strong>
<strong>		external_cb_t *</strong><em>external_cb</em><strong>);</strong>
<strong>int fiu_enable_stack(const char *</strong><em>name</em><strong>, int </strong><em>failnum</em><strong>,</strong>
<strong>		void *</strong><em>failinfo</em><strong>, unsigned int </strong><em>flags</em><strong>,</strong>
<strong>		void *</strong><em>func</em><strong>, int </strong><em>func_pos_in_stack</em><strong>);</strong>
<strong>int fiu_enable_stack_by_name(const char *</strong><em>name</em><strong>, int </strong><em>failnum</em><strong>,</strong>
<strong>		void *</strong><em>failinfo</em><strong>, unsigned int </strong><em>flags</em><strong>,</strong>
<strong>		const char *</strong><em>func_name</em><strong>, int </strong><em>func_pos_in_stack</em><strong>);</strong>
<strong>int fiu_disable(const char *</strong><em>name</em><strong>);</strong>
<strong>int fiu_rc_fifo(const char *</strong><em>basename</em><strong>);</strong>

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>libfiu is a library for fault injection. It provides functions to mark "points of failure" inside your code (the "core API"), and functions to enable/disable the failure of those points (the "control API").</p><p>The core API is used inside the code wanting to perform fault injection on. The control API is used inside the testing code, in order to control the injection of failures.</p><p>This page is an API reference and not a complete manual, and as such does not go into detail about how to use the library. The library's manual can be found in the distribution.</p><h3>CORE API</h3>
<p>To use the core API, you should <em>#include &lt;fiu.h&gt;</em> (or <em>&lt;fiu-local.h&gt;</em>, see below).</p><p>Because fault injection is usually a debugging/testing facility, unwanted at runtime, some special considerations were taken to minimize the impact of the core API. First of all, if <em>FIU_ENABLE</em> is not defined, then fiu.h will define empty stubs for all the core API, effectively disabling fault injection completely.</p><p>Also, the special header <em>fiu-local.h</em> is shipped with libfiu. It is meant to be included in your project to avoid having libfiu as a mandatory build-time dependency. You can add it to your project, and #include it instead of <em>fiu.h</em>. It will take care of including the real <em>fiu.h</em> only when <em>FIU_ENABLE</em> is defined. It is entirely optional, but recommended. See the library's manual for more details.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>fiu_init(</strong><em>flags</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Initializes the library. Ideally, you should only call this once, although it can cope with multiple calls. The flags parameter is currently unused and must be set to 0. Returns 0 on success, &lt; 0 on error.</p>
  </dd>
  <dt>
    <p><strong>fiu_fail(</strong><em>name</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Returns the failure status of the given point of failure. 0 means it should not fail. By default, all points of failure do not fail; they're enabled in runtime using the control API.</p>
  </dd>
  <dt>
    <p><strong>fiu_failinfo()</strong></p>
  </dt>
  <dd>
    <p>Returns the information associated with the last failure, or NULL if there isn't one. This function is thread-aware and will only return information about failures in the calling thread.</p>
  </dd>
  <dt>
    <p><strong>fiu_do_on(</strong><em>name</em><strong>, </strong><em>action</em><strong>) [macro]</strong></p>
  </dt>
  <dd>
    <p>This is a macro that uses <strong>fiu_fail()</strong> to perform the given action when the given point of failure fails. The action can be any valid C statement.</p>
  </dd>
  <dt>
    <p><strong>fiu_exit_on(</strong><em>name</em><strong>) [macro]</strong></p>
  </dt>
  <dd>
    <p>This is a macro that uses <strong>fiu_fail()</strong> to exit the process when the given point of failure fails. The process is exit using <a href="../man3/exit.3.html"><strong>exit</strong>(3)</a>, which is given the status EXIT_FAILURE.</p>
  </dd>
  <dt>
    <p><strong>fiu_return_on(</strong><em>name</em><strong>, </strong><em>retval</em><strong>) [macro]</strong></p>
  </dt>
  <dd>
    <p>This is a macro that uses <strong>fiu_fail()</strong> to make the current function return the given value (whose type obviously depends on the return type of the function).</p>
  </dd>

</dl>

<h3>CONTROL API</h3>
<p>To use the control API, you should <em>#include &lt;fiu-control.h&gt;</em>.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>fiu_enable(</strong><em>name</em><strong>, </strong><em>failnum</em><strong>, </strong><em>failinfo</em><strong>, </strong><em>flags</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables the given point of failure. <em>failnum</em> is what <strong>fiu_fail()</strong> will return, and must be != 0. <em>failinfo</em> is what <strong>fiu_failinfo()</strong> will return when called after the given point of failure has failed. <em>flags</em> can be either 0 or <em>FIU_ONETIME</em>, which indicates that this point of failure should only fail once.  Returns 0 if success, &lt; 0 otherwise. If the point of failure was already enabled, this overwrites the previous values.</p><p>Successive calls to <strong>fiu_fail()</strong> will return <em>failnum</em> until this point of failure is disabled. If <em>FIU_ONETIME</em> was passed in the flags, this point of failure is disabled immediately after failing once.</p><p>If the name ends with an asterisk, then it this will match all points of failure that begin with the given name (excluding the asterisk, of course).</p>
  </dd>
  <dt>
    <p><strong>fiu_enable_random(</strong><em>name</em><strong>, </strong><em>failnum</em><strong>, </strong><em>failinfo</em><strong>, </strong><em>flags</em><strong>, </strong><em>probability</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables the given point of failure, with the given probability (between 0 and 1). The rest of the parameters, as well as the return value, are the same as the ones in <strong>fiu_enable()</strong>.</p>
  </dd>
  <dt>
    <p><strong>fiu_enable_external(</strong><em>name</em><strong>, </strong><em>failnum</em><strong>, </strong><em>failinfo</em><strong>, </strong><em>flags</em><strong>, </strong><em>external_cb</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables the given point of failure, leaving the decision whether to fail or not to the given external function, which should return 0 if it is not to fail, or 1 otherwise. The rest of the parameters, as well as the return value, are the same as the ones in <strong>fiu_enable()</strong>.</p>
  </dd>
  <dt>
    <p><strong>int fiu_enable_stack(</strong><em>name</em><strong>, </strong><em>failnum</em><strong>, </strong><em>failinfo</em><strong>, </strong><em>flags</em><strong>, </strong><em>func</em><strong>, </strong><em>func_pos_in_stack</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables the given point of failure, but only if <em>func</em> is in the stack at <em>func_pos_in_stack</em>.</p><p><em>func</em> must be a function pointer, and <em>func_pos_in_stack</em> is the position where we expect the function to be, or -1 for "any" (values other than -1 are not yet supported). The rest of the parameters, as well as the return value, are the same as the ones in <strong>fiu_enable()</strong>.</p><p>This function relies on some GNU extensions, so it may be not available in all platforms.</p>
  </dd>
  <dt>
    <p><strong>int fiu_enable_stack_by_name(</strong><em>name</em><strong>, </strong><em>failnum</em><strong>, </strong><em>failinfo</em><strong>, </strong><em>flags</em><strong>, </strong><em>func_name</em><strong>, </strong><em>func_pos_in_stack</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables the given point of failure, but only if <em>func_name</em> is in the stack at <em>func_pos_in_stack</em>.</p><p><em>func</em> must be the name of a function (resolved at runtime using dlsym()); the rest of the parameters, as well as the return value, are the same as the ones in <strong>fiu_enable_stack</strong>.</p><p>This function relies on some GNU extensions, so it may be not available in all platforms.</p>
  </dd>
  <dt>
    <p><strong>fiu_disable(</strong><em>name</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Disables the given point of failure, undoing the actions of the <strong>fiu_enable*()</strong> functions.</p>
  </dd>
  <dt>
    <p><strong>fiu_rc_fifo(</strong><em>basename</em><strong>)</strong></p>
  </dt>
  <dd>
    <p>Enables remote control over named pipes with the given basename. See the remote control documentation that comes with the library for more detail.</p>
  </dd>

</dl>

<h3>THREAD SAFETY</h3>
<p>The library is thread-safe. The list of enabled failure points is shared among all threads.</p><p>Care should be taken in the user-provided functions given to <strong>fiu_enable_external()</strong>, as they can be run in parallel.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO libfiu&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/fiu-run.1.html"><strong>fiu-run</strong>(1)</a>, <a href="../man1/fiu-ctrl.1.html"><strong>fiu-ctrl</strong>(1)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>If you want to report bugs, or have any questions or comments, just let me know at albertito@blitiri.com.ar. For more information about libfiu, you can go to http://blitiri.com.ar/p/libfiu.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="libfirestring.3.html"><span aria-hidden="true">&larr;</span> libfirestring.3: Library for safe, fast string handling</a></li>
   <li class="next"><a href="libfreeipmi.3.html">libfreeipmi.3: Freeipmi library <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
