<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iv_wait: Ivykis wait4(2) wrapper</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Ivykis wait4(2) wrapper">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="iv_wait (3) manual">
  <meta name="twitter:description" content="Ivykis wait4(2) wrapper">
  <meta name="twitter:image" content="https://www.carta.tech/images/libivykis-dev-iv_wait-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/iv_wait.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="iv_wait (3) manual" />
  <meta property="og:description" content="Ivykis wait4(2) wrapper" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libivykis-dev-iv_wait-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">iv_wait<small> (3)</small></h1>
        <p class="lead">Ivykis wait4(2) wrapper</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/iv_wait.3.html">
      <span itemprop="name">iv_wait: Ivykis wait4(2) wrapper</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libivykis-dev/">
      <span itemprop="name">libivykis-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/iv_wait.3.html">
      <span itemprop="name">iv_wait: Ivykis wait4(2) wrapper</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;iv_wait.h&gt;</strong></p>
<pre>
struct iv_wait_interest {
        pid_t           pid;
        void            *cookie;
        void            (*handler)(void *cookie, int status,
                                   struct rusage *rusage);
};
</pre>
<p><strong>void IV_WAIT_INTEREST_INIT(struct iv_wait_interest *</strong><em>this</em><strong>);</strong></p><p><strong>int iv_wait_interest_register(struct iv_wait_interest *</strong><em>this</em><strong>);</strong></p><p><strong>int iv_wait_interest_register_spawn(struct iv_wait_interest *</strong><em>this</em><strong>, void (*</strong><em>fn</em><strong>)(void *), void *</strong><em>cookie</em><strong>);</strong></p><p><strong>void iv_wait_interest_unregister(struct iv_wait_interest *</strong><em>this</em><strong>);</strong></p><p><strong>int iv_wait_interest_kill(struct iv_wait_interest *</strong><em>this</em><strong>, int </strong><em>sig</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>iv_wait</strong> is an <a href="../man3/ivykis.3.html"><strong>ivykis</strong>(3)</a> wrapper around <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a>, integrating process state change notification with the ivykis event loop.</p><p>An ivykis application desiring process state change notifications registers a <strong>struct iv_wait_interest</strong> object by calling <strong>iv_wait_interest_register,</strong> after having initialised it with <strong>IV_WAIT_INTEREST_INIT</strong> and subsequently having filled in the <strong>-&gt;pid,</strong> <strong>-&gt;cookie</strong> and <strong>-&gt;handler</strong> members.</p><p>Alternatively, an ivykis application can use <strong>iv_wait_interest_register_spawn</strong> to atomically fork off a child process and register a <strong>struct iv_wait_interest</strong> for it.  In this context, 'atomically' means that the call to <strong>iv_wait_interest_register_spawn</strong> will be serialised with respect to invocations of <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a>, which closes the race where process state change notifications can occur and be delivered between forking off the child process and registering a <strong>struct iv_wait_interest</strong> for the child's pid.  The child process will run the function given by the <strong>iv_wait_interest_register_spawn</strong> argument <strong>fn,</strong> with argument <strong>cookie</strong> as its argument.</p><p>Once a process state change occurs (as indicated by delivery of a SIGCHLD signal to the current process), <strong>iv_wait</strong> calls <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a> to return information about the process state change, looks up the returned process ID in the set of registered <strong>struct iv_wait_interest</strong> objects, and if there is a registered interest with a matching <strong>-&gt;pid</strong> field, arranges for that object's callback function to be called in the thread that the object was registered in.</p><p>Process state change notifications will continue to be delivered to the object's callback function until <strong>iv_wait_interest_unregister</strong> is called on the object or until a WIFEXITED or WIFSIGNALED status for this pid is returned by <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a>.</p><p>Delivery of a WIFEXITED or WIFSIGNALED status does not automatically unregister the object, this always needs to be done explicitly.</p><p>Unregistering a <strong>struct iv_wait_interest</strong> object can only be done from the thread that that object was registered in, but within that thread, can safely be done from (and its underlying memory allocation can safely be freed from) its own callback function.</p><p>Registering multiple <strong>struct iv_wait_interest</strong> objects for the same process ID will produce undefined behavior.</p><p>To send a signal to a child process, use <strong>iv_wait_interest_kill.</strong> This function will internally serialise with invocations of <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a>,</strong> to avoid the race between sending a signal to a process and collecting a termination notification for that process (which makes its pid available for reuse).</p><p>Internally, <strong>iv_wait</strong> is implemented using <a href="../man3/iv_signal.3.html"><strong>iv_signal</strong>(3)</a> and <a href="../man3/iv_event.3.html"><strong>iv_event</strong>(3)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO iv_wait&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man3/ivykis.3.html"><strong>ivykis</strong>(3)</a>, <a href="../man3/iv_signal.3.html"><strong>iv_signal</strong>(3)</a>, <a href="../man3/iv_event.3.html"><strong>iv_event</strong>(3)</a>, <a href="../man2/wait4.2.html"><strong>wait4</strong>(2)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="iv_validate_now.3.html"><span aria-hidden="true">&larr;</span> iv_validate_now.3: Ivykis time handling</a></li>
   <li class="next"><a href="iv_wait_interest_register.3.html">iv_wait_interest_register.3: Ivykis wait4(2) wrapper <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
