<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmnewcontext: Establish a new pmapi context</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Establish a new pmapi context">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmnewcontext<small> (3)</small></h1>
        <p class="lead">Establish a new pmapi context</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmnewcontext.3.html">
      <span itemprop="name">pmnewcontext: Establish a new pmapi context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pmnewcontext.3.html">
      <span itemprop="name">pmnewcontext: Establish a new pmapi context</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">

<p>#include &lt;pcp/pmapi.h&gt;</p>
<p class='spacer'>

<p>int pmNewContext(int <em>type</em>, const char *<em>name</em>);</p>
<p class='spacer'>

<p>cc ... -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>An application using the Performance Metrics Application Programming Interface (PMAPI) may manipulate several concurrent contexts, each associated with a source of performance metrics, e.g.  .BR pmcd (1) on some host, or a set of archive logs of performance metrics as created by <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>, or a standalone connection on the local host that does not involve <strong>pmcd</strong>(1).</p>
<p class='spacer'>

<p><strong>pmNewContext</strong> may be used to establish a new context. The source of the metrics is identified by <em>name</em>, and may be either a host name ( .I type is <strong>PM_CONTEXT_HOST</strong>), or a comma-separated list of names referring to a set of archive logs ( .I type is <strong>PM_CONTEXT_ARCHIVE</strong>). Each element of the list may either be the base name common to all of the physical files of an archive log or the name of a directory containing archive logs.</p>
<p class='spacer'>

<p>For a <em>type</em> of <strong>PM_CONTEXT_HOST</strong>, in addition to identifying a host the <em>name</em> may also be used to encode additional optional information in the form of a <strong>pmcd</strong>(1) port number, a <a href="../man1/pmproxy.1.html"><strong>pmproxy</strong>(1)</a> hostname and a proxy port number. For example the <em>name</em> "app23:14321,4321@firewall.example.com:11111" specifies a connection on port <em>14321</em> (or port <em>4321</em> if <em>14321</em> is unavailable) to <strong>pmcd</strong>(1) on the host <em>app23</em> via port <em>11111</em> to <a href="../man1/pmproxy.1.html"><strong>pmproxy</strong>(1)</a> on the host <em>firewall.example.com</em>.</p>
<p class='spacer'>

<p>For a <em>type</em> of <strong>PM_CONTEXT_ARCHIVE</strong>, each element of the list of names in <em>name</em> may also be the name of any of the physical files of an archive, e.g. <em>myarchive</em><strong>.meta</strong> (the metadata file) or <em>myarchive</em><strong>.index</strong> (the temporal index) or <em>myarchive</em><strong>.0</strong> (the first data volume of the archive) or <em>myarchive</em><strong>.0.bz2</strong> or <em>myarchive</em><strong>.0.bz</strong> (the first data volume compressed with <strong>bzip2</strong>(1)) or <em>myarchive</em><strong>.0.gz</strong> or <em>myarchive</em><strong>.0.Z</strong> or <em>myarchive</em><strong>.0.z</strong> (the first data volume compressed with <strong>gzip</strong>(1)), <em>myarchive</em><strong>.1</strong> or <em>myarchive</em><strong>.3.bz2</strong> or <em>myarchive</em><strong>.42.gz</strong> etc.</p>
<p class='spacer'>

  <p>If more than one archive is specified for a <em>type</em> of <strong>PM_CONTEXT_ARCHIVE</strong>, there are some restrictions on the archives within the set:</p>
  <dl class='dl-horizontal'>
    <dt>&bull;</dt>
    <dd>
  <p>The archives must all have been generated on the same host.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The archives must not overlap in time.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The archives must all have been created using the same time zone.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The \f2PMID of each metric should be the same in all of the archives. Multiple \f2PMIDs are currently tolerated by using the first \f2PMID defined for each metric and ignoring subsequent \f2PMIDs.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The type of each metric must be the same in all of the archives.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The semantics of each metric must be the same in all of the archives.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The units of each metric must be the same in all of the archives.</p>
    </dd>
    <dt>&bull;</dt>
    <dd>
  <p>The instance domain of each metric must be the same in all of the archives.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>In the case where <em>type</em> is <strong>PM_CONTEXT_LOCAL</strong>, <em>name</em> is ignored, and the context uses a standalone connection to the PMDA methods used by <strong>pmcd</strong>(1). When this type of context is used, the range of accessible performance metrics is constrained to those from the operating system, and optionally the ``proc'', ``sample'' and ``ib'' PMDAs.</p>
<p class='spacer'>

<p>In the case where \f2type is \f3PM_CONTEXT_HOST, additional flags can be added to the \f2type to indicate if the connection to \<strong>f3pmcd</strong>(1) should be encrypted (\f3PM_CTXFLAG_SECURE), deferred (\f3PM_CTXFLAG_SHALLOW) and if the file descriptor used to communicate with \<strong>f3pmcd</strong>(1), should not be shared across contexts (\f3PM_CTXFLAG_EXCLUSIVE). The \f3PM_CTXFLAG_SHALLOW flag is now deprecated and ignored.</p>
<p class='spacer'>

<p>The initial instance profile is set up to select all instances in all instance domains. In the case of a set of archives, the initial collection time is also set to zero, so that an initial <strong>pmFetch</strong>(3) will result in the earliest set of metrics being returned from the set of archives.</p>
<p class='spacer'>

<p>Once established, the association between a context and a source of metrics is fixed for the life of the context, however routines are provided to independently manipulate both the instance profile (see <strong>pmAddProfile</strong>(3) and <strong>pmDelProfile</strong>(3)) and the collection time for archives (see <strong>pmSetMode</strong>(3)).</p>
<p class='spacer'>

<p><strong>pmNewContext</strong> returns a handle that may be used with subsequent calls to <strong>pmUseContext</strong>(3).</p>
<p class='spacer'>

<p>The new context remains the current PMAPI context for all subsequent calls across the PMAPI, until another call to <strong>pmNewContext</strong>(3) is made, or the context is explicitly changed with a call to <strong>pmDupContext</strong>(3) or <strong>pmUseContext</strong>(3), or destroyed using <strong>pmDestroyContext</strong>(3).</p>
<p class='spacer'>

<p>When attempting to connect to a remote <strong>pmcd</strong>(1) on a machine that is booting, <strong>pmNewContext</strong> could potentially block for a long time until the remote machine finishes its initialization. <strong>pmNewContext</strong> will abort and return an error if the connection has not been established after some specified interval has elapsed.  The default interval is 5 seconds.  This may be modified by setting <strong>PMCD_CONNECT_TIMEOUT</strong> in the environment to a real number of seconds for the desired timeout. This is most useful in cases where the remote host is at the end of a slow network, requiring longer latencies to establish the connection correctly.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>PMCD_CONNECT_TIMEOUT</strong></dt>
    <dd>
  <p>Timeout period (in seconds) for <strong>pmcd</strong>(1) connection attempts.</p>
    </dd>
    <dt><strong>PMCD_PORT</strong></dt>
    <dd>
  <p>TCP/IP port(s) for connecting to <strong>pmcd</strong>(1), historically was 4321 and more recently the officially registered port 44321; in the current release, <strong>pmcd</strong> listens on both these ports as a transitional arrangement.  If used, should be set to a comma-separated list of numerical port numbers.</p>
    </dd>
    <dt><strong>PMDA_PATH</strong></dt>
    <dd>
  <p>When searching for PMDAs to be loaded when <em>type</em> is <strong>PM_CONTEXT_LOCAL</strong>, the <strong>PMDA_PATH</strong> environment variable may be used to define a search path of directories to be used to locate the PMDA executables. The default search path is <strong>$PCP_SHARE_DIR/lib:/usr/pcp/lib</strong>.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">

<p>When using a <em>type</em> of <strong>PM_CONTEXT_LOCAL</strong>, the operating system PMDA may export data structures directly from the kernel, which means that the <strong>pmNewContext</strong> caller should be an executable program compiled for the same object code format as the booted kernel.</p>
<p class='spacer'>

<p>In addition, applications using a <strong>PM_CONTEXT_LOCAL</strong> context must be single-threaded because the various DSO PMDAs may not be thread-safe.  This restriction is enforced at the <strong>PMAPI</strong>(3), where routines may return the error code <strong>PM_ERR_THREAD</strong> if the library detects calls from more than one thread.</p>
<p class='spacer'>

<p>Applications that use <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a> should exercise caution because the static fields in <em>struct hostent</em> may not be preserved across some <strong>PMAPI</strong>(3) calls. In particular, <strong>pmNewContext</strong>(3) and <strong>pmReconnectContext</strong>(3) both may call <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a> internally.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p><strong>PM_ERR_PERMISSION</strong></p>
<p class='spacer'>

<p>No permission to perform requested operation</p>
<p class='spacer'>

<p><strong>PM_ERR_CONNLIMIT</strong></p>
<p class='spacer'>

<p>PMCD connection limit for this host exceeded</p>
<p class='spacer'>

<p><strong>PM_ERR_NOCONTEXT</strong></p>
<p class='spacer'>

<p>Requested context type was not <strong>PM_CONTEXT_LOCAL</strong>, <strong>PM_CONTEXT_HOST</strong> or <strong>PM_CONTEXT_ARCHIVE</strong>.</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGOVERLAP</strong></p>
<p class='spacer'>

<p>Archives overlap in time</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGHOST</strong></p>
<p class='spacer'>

<p>Archives differ by host</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGTIMEZONE</strong></p>
<p class='spacer'>

<p>Archives differ by time zone.</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGCHANGETYPE</strong></p>
<p class='spacer'>

<p>The type of a metric differs among archives</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGCHANGESEM</strong></p>
<p class='spacer'>

<p>The semantics of a metric differs among archives</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGCHANGEINDOM</strong></p>
<p class='spacer'>

<p>The instance domain of a metric differs among archives</p>
<p class='spacer'>

<p><strong>PM_ERR_LOGCHANGEUNITS</strong></p>
<p class='spacer'>

<p>The units of a metric differs among archives</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmnewcontext&hellip;</h2>
        <div class="sectioncontent">

<p><strong>pmcd</strong>(1), <a href="../man1/pmproxy.1.html"><strong>pmproxy</strong>(1)</a>, <strong>pmAddProfile</strong>(3), <strong>PMAPI</strong>(3), <strong>pmDelProfile</strong>(3), <strong>pmDestroyContext</strong>(3), <strong>pmDupContext</strong>(3), <strong>pmGetConfig</strong>(3), <strong>pmReconnectContext</strong>(3), <strong>pmSetMode</strong>(3), <strong>pmUseContext</strong>(3), <strong>pmWhichContext</strong>(3), <strong>pcp.conf</strong>(5) and <a href="../man5/pcp.env.5.html"><strong>pcp.env</strong>(5)</a>.</p>
        </div>
      </section>

<nav>
  <ul class="pager">
   <li class="previous"><a href="pmnameid.3.html"><span aria-hidden="true">&larr;</span> pmnameid.3: Translate a pmid to a performance metric name</a></li>
   <li class="next"><a href="pmnewzone.3.html">pmnewzone.3: Establish a reporting timezone <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
