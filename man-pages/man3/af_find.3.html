<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>af_find: Atfs retrieve interface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Atfs retrieve interface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="af_find (3) manual">
  <meta name="twitter:description" content="Atfs retrieve interface">
  <meta name="twitter:image" content="https://www.carta.tech/images/atfs-dev-af_find-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/af_find.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="af_find (3) manual" />
  <meta property="og:description" content="Atfs retrieve interface" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/atfs-dev-af_find-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">af_find<small> (3)</small></h1>
        <p class="lead">Atfs retrieve interface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/af_find.3.html">
      <span itemprop="name">af_find: Atfs retrieve interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/atfs-dev/">
      <span itemprop="name">atfs-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/af_find.3.html">
      <span itemprop="name">af_find: Atfs retrieve interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>#include &lt;atfs.h&gt;</p><p>int af_find (Af_attrs *attrbuf, Af_set *resultset)</p><p>int af_cachefind (Af_attrs *attrbuf, Af_set *resultset)</p><p>int af_initattrs (Af_attrs *attrbuf)</p><p>int af_getkey (char *syspath, char *name, char *type, int gen, int rev, Af_key *aso)</p><p>int af_dropkey (Af_key *key)</p><p>int af_dropset (Af_set *set)</p><p>int af_dropall (void)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>af_find</em> and <em>af_cachefind</em> retrieve ASOs by given attributes. af_find operates on source objects and af_cachefind only on derived objects. The keys of all found ASOs are returned in <em>resultset</em>. The keys returned in resultset are randomly ordered. af_find and af_cachefind expect resultset to be a pointer to an empty set structure. Both functions return the number of found ASOs.</p><p>The retrieve arguments are passed in an attribute buffer (<em>attrbuf</em>). Attrbuf should be initialized by <em>af_initattrs</em> before calling af_find (resp. af_cachefind). af_initattrs disables all fields in the attribute buffer. The application may then enable single fields by setting a desired attribute value. The initial settings of the single fields are listed below with the structure of the attribute buffer.</p><p>Setting one of the Af_user fields in the attribute buffer to AF_NOUSER causes only ASOs to be selected, where the corresponding user attribute is <em>not</em> set. This makes only sense for <em>af_locker</em>, when the selection of ASOs that are not locked is desired.</p><p>On the <em>af_mode</em> field, a bitwise comparison is performed. In this case, all ASOs will be selected that have <em>at least</em> all required mode bits (given in af_mode) set in their mode field. An exact match is not required.</p><p>The first two fields in the attribute buffer denote the search space. Generally, the search space for a retrieve operation is a directory. The directory name is given in the <em>af_syspath</em> field in the attribute buffer. If no system path is given, the current directory is searched. The fields <em>af_host</em> in the attribute buffer is ignored in the current implementation.</p><p>The structure of the attribute buffer is the following:</p>
<pre>
typedef struct {			initial value
	char	af_host[\s-1MAXHOSTNAMELEN\s+1];	/* hostname (ignored) */	""
	char	af_syspath[\s-1MAXPATHLEN+1\s+1];	/* system path */	""
	char	af_name[\s-1MAXNAMLEN+1\s+1];	/* filename */	"*"
	char	af_type[\s-1MAXTYPLEN\s+1];	/* filename extension (type) */	"*"
	int	af_gen;	/* generation number */	-1
	int	af_rev;	/* revision number */	-1
	int	af_state;	/* version state */	-1
	Af_user	af_owner;	/* owner */	{ "", "", "" }
	Af_user	af_author;	/* author */	{ "", "", "" }
	off_t	af_size;	/* size of file */	-1
	u_short	af_mode;	/* protection */	0
	Af_user	af_locker;	/* locker */	{ "", "", "" }
	time_t	af_mtime;	/* date of last modification */	-1
	time_t	af_atime;	/* date of last access */	-1
	time_t	af_ctime;	/* date of last status change*/	-1
	time_t	af_stime;	/* save date */	-1
	time_t	af_ltime;	/* date of last lock change */	-1
	char	*af_udattrs[AF_MAXUDAS];	/* user defined attributes */
} Af_attrs;
</pre>
<p>It is possible to pass a list of user defined attributes as retrieve arguments. The list of pointers <em>af_udattrs</em> in the attribute buffer can be filled with strings of the form name[=value]. The list must be terminated by a nil pointer.</p><p>The user defined attributes are interpreted in the following way:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>empty list</em> (first entry is a nil pointer)</p>
  </dt>
  <dd>
    <p>matches every ASO.</p>
  </dd>
  <dt>
    <p><em>""</em> (first entry is an empty string)</p>
  </dt>
  <dd>
    <p>matches every ASO that has <strong>no</strong> user defined attributes.</p>
  </dd>
  <dt>
    <p><em>name</em>[<em>=</em>]</p>
  </dt>
  <dd>
    <p>matches, if a user defined attribute with the given name is present.</p>
  </dd>
  <dt>
    <p><em>name=value</em></p>
  </dt>
  <dd>
    <p>matches all ASOs that have a corresponding user defined attribute, that has at least the given value.</p>
  </dd>

</dl>
<p><em>af_getkey</em> builds up an object key by a combination of attributes (pathname, name, type, generation number, revision number and variant name) uniquely identifying a source ASO. Upon successful completion, the found object key is returned in the buffer <em>key</em>. Instead of explicit version numbers, you can pass the pseudo-numbers AF_BUSYVERS, AF_FIRSTVERS or AF_LASTVERS to af_getkey. af_getkey works only on source objects. The call</p><p><strong>af_getkey&nbsp;("",&nbsp;"otto",&nbsp;"c",&nbsp;AF_BUSYVERS,&nbsp;AF_BUSYVERS,&nbsp;key)</strong></p><p>leads to the key of the file (busy version) named otto.c in the current directory.</p><p><strong>af_getkey ("", "otto", "c", AF_LASTVERS, AF_LASTVERS,&nbsp;key)</strong></p><p>delivers the last saved version (if present) of the history of otto.c.</p><p>After having retrieved a key or a set of keys, the data for the corresponding object version(s) remains cached in memory as long as the application does not explicitly give the key back. The function <em>af_dropkey</em> gives a key back and releases the object version. A retrieved set of keys has to be given back by use of <em>af_dropset</em>. <em>af_dropall</em> sets all reference counters for cached object versions to zero, that means, it gives all formerly retrieved keys and sets back.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>af_find returns the number of found ASOs. Upon error, -1 is returned and <em>af_errno</em> is set to the corresponding error number.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="af_files.3.html"><span aria-hidden="true">&larr;</span> af_files.3: Atfs file system operations</a></li>
   <li class="next"><a href="af_freeattr.3.html">af_freeattr.3: Atfs attribute handling <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
