<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tangram::Type::Extending: Teaching tangram about new types</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Teaching tangram about new types">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Tangram::Type::Extending (3pm) manual">
  <meta name="twitter:description" content="Teaching tangram about new types">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtangram-perl-Tangram::Type::Extending-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Tangram::Type::Extending.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tangram::Type::Extending (3pm) manual" />
  <meta property="og:description" content="Teaching tangram about new types" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtangram-perl-Tangram::Type::Extending-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Tangram::Type::Extending<small> (3pm)</small></h1>
        <p class="lead">Teaching tangram about new types</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tangram::Type::Extending.3pm.html">
      <span itemprop="name">Tangram::Type::Extending: Teaching tangram about new types</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtangram-perl/">
      <span itemprop="name">libtangram-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Tangram::Type::Extending.3pm.html">
      <span itemprop="name">Tangram::Type::Extending: Teaching tangram about new types</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Tangram::Type is the root of a hierarchy of classes that are responsible mapping individual field to \s-1SQL\s0 entities (columns in the simplest cases). There is one Type object per persistent field.</p><p>Adding support for new types amounts to adding subclasses to Tangram::Type.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WRITING NEW TYPES</h2>
        <div class="sectioncontent">
<p>Tangram is organized in several subsystems, described below.</p><p>Schema is the repository for information about all the persistent aspects of a system: classes, inheritance relationships, fields, etc. It also contains graph-traversal algorithms, which are not currently documented.</p><p>Storage deals with objects as a whole: insertion, updating, multiple load detection, cycle handling, transactions, connections. It also serves as an entry point in the system. Storage does not manipulate fields directly.</p><p>Cursor deals with polymorphic retrieval of objects. It builds \s-1SELECT\s0 statements on the basis of the information in the hash. Cursor does not manipulate fields directly either.</p><p>The Type hierarchy deals with individual fields, and not with entire objects. More about it in a moment.</p><p>The Expr hierarchy deals with entities on the remote side; this includes expressions proper, Filters and Remotes.</p><p>Types are responsible for performing the mapping between a field of a given Perl type and a relational entity. The simplest Types merely transfer between one Perl field and one column. Sometimes it makes sense to have several mappings (and hence several Types) for the same Perl type; for example, Perl arrays can be mapped either using a link table, or one or several columns that live on the element's table.</p><p>Users don't deal with Type objects directly: they indicate that a series of fields should be mapped in a certain way by putting the fields under a given 'typetag' in the field hash. The type registers itself with Tangram by adding a typetag in the %Tangram::Schema::TYPES hash. The value is the Type object. Up to now all Types have been singletons, but this is not a rule.</p><p>Anybody who's planning to write new Types should examine Scalar.pm first. It contains very simple mappings between one field and one column.</p><p>A Type must implement the methods described below. Keep the following facts in mind while reading further:</p><p>1. A Type is responsible for transferring all the *direct* fields for a given *class*. This excludes inherited fields. \s-1OTOH\s0, the same Type can be called more than once for the same object, because the same Type may be used in several classes that appear in a particular object's inheritance graph.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTANCE METHODS</h2>
        <div class="sectioncontent">
<h3>reschema</h3>

<pre>
   reschema($self, $members, $class)
</pre>
<p>This method is called when the schema hash is being converted into a Schema object. The Type finds all the fields it is responsible for mapping in the Perl structure refered by $members. The Type decides the exact format of this structure.</p>
<h3>get_export_cols</h3>
<p>        get_export_cols($self, $context)</p><p>Called when building \s-1INSERT\s0 and \s-1UPDATE\s0 statements; the Type returns a list of columns to be inserted in the statement.</p>
<h3>get_exporter</h3>
<p>        get_exporter($self, $context)</p><p>Called when building a function for reading the state of an object: the Type may return either a string or a closure.</p>
<h3>get_import_cols</h3>
<p>        get_import_cols($self, $context)</p><p>Called when building \s-1SELECT\s0 statements; the Type returns a list of columns to be inserted in the statement.</p>
<h3>get_importer</h3>
<p>        get_importer($self, $context)</p><p>Called when building a function for setting the state of an object: the Type may return either a string or a closure.</p>
<h3>remote_expr</h3>
<p>        remote_expr($self, $obj, $tid, $storage)</p><p>Called when building a Remote. The Type returns an Expr object.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HANDLING ASSOCIATIONS</h2>
        <div class="sectioncontent">
<p>Ref and Collections have in common that they don't load their controlled fields upfront. Their importer method ties the controlled fields to a package that will demand-load the final value of the field - if it's ever needed. The exact procedure for achieving this is not imposed by Tangram itself, in fact, a Type has the liberty of doing just anything it sees fit, if it can manage it with the arguments that it gets passed by the higher layer. Ref ties a field to the Lazy::Ref package, and Collections tie to Lazy::Coll.</p><p>Ref and those collections that contain references to other objects must deal cycles. This can be done quite easily but I don't have to go into those details right now.</p><p>Collections (of references of or values (the so-called 'flat' collections)) typically save their state when the demand-load is triggered. Later, when the collection is saved, the Collection compares the current field state (iow collection content) with the state at load time, and updates the database accordingly.</p><p>Types that need to remember field state at load time should store it under $storage-&gt;{scratch}{\s-1TYPE_CLASS\s0}, and typically under $storage-&gt;{scratch}{\s-1TYPE_CLASS\s0}{\s-1OBJECT_ID\s0}{\s-1FIELD\s0}. Coll defines two utility functions to help manage load-time state:</p><p>* set_load_state($self, $storage, $obj, $field, $state)</p><p>Remember $state of the $field of $obj, retrieved from $storage.</p><p>* get_load_state($self, $storage, $obj, $member)</p><p>Retrieve that state.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Tangram::Type::Dump::YAML.3pm.html"><span aria-hidden="true">&larr;</span> Tangram::Type::Dump::YAML.3pm: Serialise fields of an object via yaml to a column</a></li>
   <li class="next"><a href="Tangram::Type::Hash::Scalar.3pm.html">Tangram::Type::Hash::Scalar.3pm: Map perl hash of scalar keys and values <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
