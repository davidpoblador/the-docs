<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pfm_get_event_encoding: Get raw event encoding</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Get raw event encoding">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pfm_get_event_encoding<small> (3)</small></h1>
        <p class="lead">Get raw event encoding</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pfm_get_event_encoding.3.html">
      <span itemprop="name">pfm_get_event_encoding: Get raw event encoding</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/perfmon2/">
      <span itemprop="name">perfmon2</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pfm_get_event_encoding.3.html">
      <span itemprop="name">pfm_get_event_encoding: Get raw event encoding</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include <perfmon/pfmlib.h></strong>

<strong>int pfm_get_event_encoding(const char *</strong><em>str</em><strong>,int </strong><em>dfl_plm</em><strong>, char **</strong><em>fstr</em><strong>, int *</strong><em>idx</em><strong>, uint64_t *</strong><em>code</em><strong>, int *</strong><em>count</em><strong>);</strong>

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This function is used to retrieve the raw event encoding corresponding to the event string in <strong>str</strong>. The string may contain unit masks and modifiers. The default privilege level mask is passed in <strong>dfl_plm</strong>. It may be used depending on the event.</p><p>This function is <strong>deprecated</strong>. It is superseded by <strong>pfm_get_os_event_encoding()</strong> where the OS is set to <strong>PFM_OS_NONE</strong>. Encoding is retrieve through the <strong>pfm_pmu_encode_arg_t</strong> structure.</p><p>The following examples illustrates the transition:</p>
<pre>
   int i, count = 0;
   uint64_t *codes;

   ret = pfm_get_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, NULL, &codes, &count);
   if (ret != PFM_SUCCESS)
      err(1", cannot get encoding %s", pfm_strerror(ret));

   for(i=0; i &lt; count; i++)
      printf("count[%d]=0x%"PRIx64"&#92;n", i, codes[i]);
</pre>
<p>is equivalent to:</p>
<pre>
   pfm_pmu_encode_arg_t arg;
   int i;

   memset(&arg, 0, sizeof(arg));
   arg.size = sizeof(arg);

   ret = pfm_get_os_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, PFM_OS_NONE, &arg);
   if (ret != PFM_SUCCESS)
      err(1", cannot get encoding %s", pfm_strerror(ret));

   for(i=0; i &lt; arg.count; i++)
      printf("count[%d]=0x%"PRIx64"&#92;n", i, arg.codes[i]);

   free(arg.codes);

The encoding may take several 64-bit integers. The function can use the array passed in <strong>code</strong> if the number
of entries passed in <strong>count</strong> is big enough. However, if both <strong>*codes</strong> is <strong>NULL</strong> and <strong>count</strong>
is 0, the function allocates the memory necessary to store the encoding. It is up to the caller to
eventually free the memory. The number of 64-bit entries in <strong>codes</strong> is reflected in <strong>*count</strong> upon
return regardless of whether the <strong>codes</strong> was allocated or used as is. If the number of 64-bit integers is
greater than one, then the order in which each component is returned is PMU-model specific. Refer to the PMU
specific man page.

The raw encoding means the encoding as mandated by the underlying PMU model. It may not be directly suitable
to pass to a kernel API. You may want to use API-specific library calls to ensure the correct encoding is passed.

If <strong>fstr</strong> is not NULL, it will point to the fully qualified event string upon successful return. The string
contains the event name, any umask set, and the value of all the modifiers. It reflects what the encoding will
actually measure. The function allocates the memory to store the string. The caller must eventually free the
string.

Here is a example of how this function could be used:
#include &lt;inttypes.h&gt;
#include &lt;err.h&gt;
#include &lt;perfmon/pfmlib.h&gt;
int main(int argc, char **argv)
{
   uint64_t *codes 0;
   int count = 0;
   int ret;

   ret = pfm_initialize();
   if (ret != PFMLIB_SUCCESS)
      err(1", cannot initialize library %s", pfm_strerror(ret));

   ret = pfm_get_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, NULL, &codes, &count);
   if (ret != PFM_SUCCESS)
      err(1", cannot get encoding %s", pfm_strerror(ret));

   for(i=0; i &lt; count; i++)
      printf("count[%d]=0x%"PRIx64"&#92;n", i, codes[i]);

   free(codes);
   return 0;
}
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN</h2>
        <div class="sectioncontent">
<p>The function returns in <strong>*codes</strong> the encoding of the event and in <strong>*count</strong> the number of 64-bit integers to support that encoding. Upon success, <strong>PFM_SUCCESS</strong> is returned otherwise a specific error code is returned.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>PFM_ERR_TOOSMALL</strong></p>
  </dt>
  <dd>
    <p>The <strong>code</strong> argument is too small for the encoding.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_INVAL</strong></p>
  </dt>
  <dd>
    <p>The <strong>code</strong> or <strong>count</strong> argument is <strong>NULL</strong>.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_NOMEM</strong></p>
  </dt>
  <dd>
    <p>Not enough memory.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_NOTFOUND</strong></p>
  </dt>
  <dd>
    <p>Event not found.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_ATTR</strong></p>
  </dt>
  <dd>
    <p>Invalid event attribute (unit mask or modifier)</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_ATTR_VAL</strong></p>
  </dt>
  <dd>
    <p>Invalid modifier value.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_ATTR_SET</strong></p>
  </dt>
  <dd>
    <p>attribute already set, cannot be changed.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_ATTR_UMASK</strong></p>
  </dt>
  <dd>
    <p>Missing unit mask.</p>
  </dd>
  <dt>
    <p><strong>PFM_ERR_ATTR_FEATCOMB</strong></p>
  </dt>
  <dd>
    <p>Unit masks or features cannot be combined into a single event.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Stephane Eranian &lt;eranian@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pfm_get_event_encoding&hellip;</h2>
        <div class="sectioncontent">
<a href="../man3/pfm_get_os_event_encoding.3.html"><strong>pfm_get_os_event_encoding</strong>(3)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pfm_get_event_attr_info.3.html"><span aria-hidden="true">&larr;</span> pfm_get_event_attr_info.3: Get event attribute information</a></li>
   <li class="next"><a href="pfm_get_event_info.3.html">pfm_get_event_info.3: Get event information <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
