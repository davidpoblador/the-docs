<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>file_sorter: File sorter</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="File sorter">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="file_sorter (3erl) manual">
  <meta name="twitter:description" content="File sorter">
  <meta name="twitter:image" content="https://www.carta.tech/images/erlang-manpages-file_sorter-3erl.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3erl/file_sorter.3erl.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="file_sorter (3erl) manual" />
  <meta property="og:description" content="File sorter" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/erlang-manpages-file_sorter-3erl.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">file_sorter<small> (3erl)</small></h1>
        <p class="lead">File sorter</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/file_sorter.3erl.html">
      <span itemprop="name">file_sorter: File sorter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/erlang-manpages/">
      <span itemprop="name">erlang-manpages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3erl/file_sorter.3erl.html">
      <span itemprop="name">file_sorter: File sorter</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The functions of this module sort terms on files, merge already sorted files, and check files for sortedness. Chunks containing binary terms are read from a sequence of files, sorted internally in memory and written on temporary files, which are merged producing one sorted file as output. Merging is provided as an optimization; it is faster when the files are already sorted, but it always works to sort instead of merge.</p><p>On a file, a term is represented by a header and a binary. Two options define the format of terms on files:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{header, HeaderLength}</em>. HeaderLength determines the number of bytes preceding each binary and containing the length of the binary in bytes. Default is 4. The order of the header bytes is defined as follows: if <em>B</em> is a binary containing a header only, the size <em>Size</em> of the binary is calculated as <em>&lt;&lt;Size:HeaderLength/unit:8&gt;&gt; = B</em>.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{format, Format}</em>. The format determines the function that is applied to binaries in order to create the terms that will be sorted. The default value is <em>binary_term</em>, which is equivalent to <em>fun binary_to_term/1</em>. The value <em>binary</em> is equivalent to <em>fun(X) -&gt; X end</em>, which means that the binaries will be sorted as they are. This is the fastest format. If <em>Format</em> is <em>term</em>, <em>io:read/2</em> is called to read terms. In that case only the default value of the <em>header</em> option is allowed. The <em>format</em> option also determines what is written to the sorted output file: if <em>Format</em> is <em>term</em> then <em>io:format/3</em> is called to write each term, otherwise the binary prefixed by a header is written. Note that the binary written is the same binary that was read; the results of applying the <em>Format</em> function are thrown away as soon as the terms have been sorted. Reading and writing terms using the <em>io</em> module is very much slower than reading and writing binaries.</p>
  </dd>

</dl>
<p>Other options are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{order, Order}</em>. The default is to sort terms in ascending order, but that can be changed by the value <em>descending</em> or by giving an ordering function <em>Fun</em>. An ordering function is antisymmetric, transitive and total. <em>Fun(A, B)</em> should return <em>true</em> if <em>A</em> comes before <em>B</em> in the ordering, <em>false</em> otherwise. An example of a typical ordering function is less than or equal to, <em>=&lt;/2</em>. Using an ordering function will slow down the sort considerably. The <em>keysort</em>, <em>keymerge</em> and <em>keycheck</em> functions do not accept ordering functions.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{unique, boolean()}</em>. When sorting or merging files, only the first of a sequence of terms that compare equal (<em>==</em>) is output if this option is set to <em>true</em>. The default value is <em>false</em> which implies that all terms that compare equal are output. When checking files for sortedness, a check that no pair of consecutive terms compares equal is done if this option is set to <em>true</em>.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{tmpdir, TempDirectory}</em>. The directory where temporary files are put can be chosen explicitly. The default, implied by the value <em>""</em>, is to put temporary files on the same directory as the sorted output file. If output is a function (see below), the directory returned by <em>file:get_cwd()</em> is used instead. The names of temporary files are derived from the Erlang nodename (<em>node()</em>), the process identifier of the current Erlang emulator (<em>os:getpid()</em>), and a timestamp (<em>erlang:now()</em>); a typical name would be <em>fs_mynode@myhost_1763_1043_337000_266005.17</em>, where <em>17</em> is a sequence number. Existing files will be overwritten. Temporary files are deleted unless some uncaught EXIT signal occurs.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{compressed, boolean()}</em>. Temporary files and the output file may be compressed. The default value <em>false</em> implies that written files are not compressed. Regardless of the value of the <em>compressed</em> option, compressed files can always be read. Note that reading and writing compressed files is significantly slower than reading and writing uncompressed files.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{size, Size}</em>. By default approximately 512*1024 bytes read from files are sorted internally. This option should rarely be needed.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{no_files, NoFiles}</em>. By default 16 files are merged at a time. This option should rarely be needed.</p>
  </dd>

</dl>
<p>As an alternative to sorting files, a function of one argument can be given as input. When called with the argument <em>read</em> the function is assumed to return <em>end_of_input</em> or <em>{end_of_input, Value}}</em> when there is no more input (<em>Value</em> is explained below), or <em>{Objects, Fun}</em>, where <em>Objects</em> is a list of binaries or terms depending on the format and <em>Fun</em> is a new input function. Any other value is immediately returned as value of the current call to <em>sort</em> or <em>keysort</em>. Each input function will be called exactly once, and should an error occur, the last function is called with the argument <em>close</em>, the reply of which is ignored.</p><p>A function of one argument can be given as output. The results of sorting or merging the input is collected in a non-empty sequence of variable length lists of binaries or terms depending on the format. The output function is called with one list at a time, and is assumed to return a new output function. Any other return value is immediately returned as value of the current call to the sort or merge function. Each output function is called exactly once. When some output function has been applied to all of the results or an error occurs, the last function is called with the argument <em>close</em>, and the reply is returned as value of the current call to the sort or merge function. If a function is given as input and the last input function returns <em>{end_of_input, Value}</em>, the function given as output will be called with the argument <em>{value, Value}</em>. This makes it easy to initiate the sequence of output functions with a value calculated by the input functions.</p><p>As an example, consider sorting the terms on a disk log file. A function that reads chunks from the disk log and returns a list of binaries is used as input. The results are collected in a list of terms.</p>
<pre>
sort(Log) -&gt;
    {ok, _} = disk_log:open([{name,Log}, {mode,read_only}]),
    Input = input(Log, start),
    Output = output([]),
    Reply = file_sorter:sort(Input, Output, {format,term}),
    ok = disk_log:close(Log),
    Reply.

input(Log, Cont) -&gt;
    fun(close) -&gt;
            ok;
       (read) -&gt;
            case disk_log:chunk(Log, Cont) of
                {error, Reason} -&gt;
                    {error, Reason};
                {Cont2, Terms} -&gt;
                    {Terms, input(Log, Cont2)};
                {Cont2, Terms, _Badbytes} -&gt;
                    {Terms, input(Log, Cont2)};
                eof -&gt;
                    end_of_input
            end
    end.

output(L) -&gt;
    fun(close) -&gt;
            lists:append(lists:reverse(L));
       (Terms) -&gt;
            output([Terms | L])
    end.
</pre>
<p>Further examples of functions as input and output can be found at the end of the <em>file_sorter</em> module; the <em>term</em> format is implemented with functions.</p><p>The possible values of <em>Reason</em> returned when an error occurs are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>bad_object</em>, <em>{bad_object, FileName}</em>. Applying the format function failed for some binary, or the key(s) could not be extracted from some term.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{bad_term, FileName}</em>. <em>io:read/2</em> failed to read some term.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{file_error, FileName, file:posix()}</em>. See <em>file(3erl)</em> for an explanation of <em>file:posix()</em>.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>{premature_eof, FileName}</em>. End-of-file was encountered inside some binary term.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DATA TYPES</h2>
        <div class="sectioncontent">

<pre>
<strong>file_name()</strong> = <strong>file:name()</strong>

</pre>

<pre>
<strong>file_names()</strong> = [<strong>file:name()</strong>]

</pre>

<pre>
<strong>i_command()</strong> = read | close

</pre>

<pre>
<strong>i_reply()</strong> = end_of_input

          | {end_of_input, <strong>value()</strong>}

          | {[<strong>object()</strong>], <strong>infun()</strong>}

          | <strong>input_reply()</strong>

</pre>

<pre>
<strong>infun()</strong> = fun((<strong>i_command()</strong>) -&gt; <strong>i_reply()</strong>)

</pre>

<pre>
<strong>input()</strong> = <strong>file_names()</strong> | <strong>infun()</strong>

</pre>

<pre>
<strong>input_reply()</strong> = term()

</pre>

<pre>
<strong>o_command()</strong> = {value, <strong>value()</strong>} | [<strong>object()</strong>] | close

</pre>

<pre>
<strong>o_reply()</strong> = <strong>outfun()</strong> | <strong>output_reply()</strong>

</pre>

<pre>
<strong>object()</strong> = term() | binary()

</pre>

<pre>
<strong>outfun()</strong> = fun((<strong>o_command()</strong>) -&gt; <strong>o_reply()</strong>)

</pre>

<pre>
<strong>output()</strong> = <strong>file_name()</strong> | <strong>outfun()</strong>

</pre>

<pre>
<strong>output_reply()</strong> = term()

</pre>

<pre>
<strong>value()</strong> = term()

</pre>

<pre>
<strong>options()</strong> = [<strong>option()</strong>] | <strong>option()</strong>

</pre>

<pre>
<strong>option()</strong> = {compressed, boolean()}

         | {header, <strong>header_length()</strong>}

         | {format, <strong>format()</strong>}

         | {no_files, <strong>no_files()</strong>}

         | {order, <strong>order()</strong>}

         | {size, <strong>size()</strong>}

         | {tmpdir, <strong>tmp_directory()</strong>}

         | {unique, boolean()}

</pre>

<pre>
<strong>format()</strong> = binary_term | term | binary | <strong>format_fun()</strong>

</pre>

<pre>
<strong>format_fun()</strong> = fun((binary()) -&gt; term())

</pre>

<pre>
<strong>header_length()</strong> = integer() &gt;= 1

</pre>

<pre>
<strong>key_pos()</strong> = integer() &gt;= 1 | [integer() &gt;= 1]

</pre>

<pre>
<strong>no_files()</strong> = integer() &gt;= 1

</pre>

<pre>
<strong>order()</strong> = ascending | descending | <strong>order_fun()</strong>

</pre>

<pre>
<strong>order_fun()</strong> = fun((term(), term()) -&gt; boolean())

</pre>

<pre>
<strong>size()</strong> = integer() &gt;= 0

</pre>

<pre>
<strong>tmp_directory()</strong> = [] | <strong>file:name()</strong>

</pre>

<pre>
<strong>reason()</strong> = bad_object

         | {bad_object, <strong>file_name()</strong>}

         | {bad_term, <strong>file_name()</strong>}

         | {file_error,

            <strong>file_name()</strong>,

            <strong>file:posix()</strong> | badarg | system_limit}

         | {premature_eof, <strong>file_name()</strong>}

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPORTS</h2>
        <div class="sectioncontent">

<pre>
<strong></strong>
sort(FileName) -&gt; Reply

</pre>
<p>Types:</p><p>FileName = <strong>file_name()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>input_reply()</strong> | <strong>output_reply()</strong></p><p>Sorts terms on files. <em>sort(FileName)</em> is equivalent to <em>sort([FileName], FileName)</em>.</p>
<pre>
<strong></strong>
sort(Input, Output) -&gt; Reply

</pre>

<pre>
<strong></strong>
sort(Input, Output, Options) -&gt; Reply

</pre>
<p>Types:</p><p>Input = <strong>input()</strong></p><p>Output = <strong>output()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>input_reply()</strong> | <strong>output_reply()</strong></p><p>Sorts terms on files. <em>sort(Input, Output)</em> is equivalent to <em>sort(Input, Output, [])</em>.</p>
<pre>
<strong></strong>
keysort(KeyPos, FileName) -&gt; Reply

</pre>
<p>Types:</p><p>KeyPos = <strong>key_pos()</strong></p><p>FileName = <strong>file_name()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>input_reply()</strong> | <strong>output_reply()</strong></p><p>Sorts tuples on files. <em>keysort(N, FileName)</em> is equivalent to <em>keysort(N, [FileName], FileName)</em>.</p>
<pre>
<strong></strong>
keysort(KeyPos, Input, Output) -&gt; Reply

</pre>

<pre>
<strong></strong>
keysort(KeyPos, Input, Output, Options) -&gt; Reply

</pre>
<p>Types:</p><p>KeyPos = <strong>key_pos()</strong></p><p>Input = <strong>input()</strong></p><p>Output = <strong>output()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>input_reply()</strong> | <strong>output_reply()</strong></p><p>Sorts tuples on files. The sort is performed on the element(s) mentioned in <em>KeyPos</em>. If two tuples compare equal (<em>==</em>) on one element, next element according to <em>KeyPos</em> is compared. The sort is stable.</p><p><em>keysort(N, Input, Output)</em> is equivalent to <em>keysort(N, Input, Output, [])</em>.</p>
<pre>
<strong></strong>
merge(FileNames, Output) -&gt; Reply

</pre>

<pre>
<strong></strong>
merge(FileNames, Output, Options) -&gt; Reply

</pre>
<p>Types:</p><p>FileNames = <strong>file_names()</strong></p><p>Output = <strong>output()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>output_reply()</strong></p><p>Merges terms on files. Each input file is assumed to be sorted.</p><p><em>merge(FileNames, Output)</em> is equivalent to <em>merge(FileNames, Output, [])</em>.</p>
<pre>
<strong></strong>
keymerge(KeyPos, FileNames, Output) -&gt; Reply

</pre>

<pre>
<strong></strong>
keymerge(KeyPos, FileNames, Output, Options) -&gt; Reply

</pre>
<p>Types:</p><p>KeyPos = <strong>key_pos()</strong></p><p>FileNames = <strong>file_names()</strong></p><p>Output = <strong>output()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = ok | {error, <strong>reason()</strong>} | <strong>output_reply()</strong></p><p>Merges tuples on files. Each input file is assumed to be sorted on key(s).</p><p><em>keymerge(KeyPos, FileNames, Output)</em> is equivalent to <em>keymerge(KeyPos, FileNames, Output, [])</em>.</p>
<pre>
<strong></strong>
check(FileName) -&gt; Reply

</pre>

<pre>
<strong></strong>
check(FileNames, Options) -&gt; Reply

</pre>
<p>Types:</p><p>FileNames = <strong>file_names()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = {ok, [Result]} | {error, <strong>reason()</strong>}</p><p>Result = {FileName, TermPosition, term()}</p><p>FileName = <strong>file_name()</strong></p><p>TermPosition = integer() &gt;= 1</p><p>Checks files for sortedness. If a file is not sorted, the first out-of-order element is returned. The first term on a file has position 1.</p><p><em>check(FileName)</em> is equivalent to <em>check([FileName], [])</em>.</p>
<pre>
<strong></strong>
keycheck(KeyPos, FileName) -&gt; Reply

</pre>

<pre>
<strong></strong>
keycheck(KeyPos, FileNames, Options) -&gt; Reply

</pre>
<p>Types:</p><p>KeyPos = <strong>key_pos()</strong></p><p>FileNames = <strong>file_names()</strong></p><p>Options = <strong>options()</strong></p><p>Reply = {ok, [Result]} | {error, <strong>reason()</strong>}</p><p>Result = {FileName, TermPosition, term()}</p><p>FileName = <strong>file_name()</strong></p><p>TermPosition = integer() &gt;= 1</p><p>Checks files for sortedness. If a file is not sorted, the first out-of-order element is returned. The first term on a file has position 1.</p><p><em>keycheck(KeyPos, FileName)</em> is equivalent to <em>keycheck(KeyPos, [FileName], [])</em>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="file.3erl.html"><span aria-hidden="true">&larr;</span> file.3erl: File interface module</a></li>
   <li class="next"><a href="filelib.3erl.html">filelib.3erl: File utilities, such as wildcard matching of filenames <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
