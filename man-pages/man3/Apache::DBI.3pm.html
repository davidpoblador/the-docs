<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Apache::DBI: Initiate a persistent database connection</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Initiate a persistent database connection">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Apache::DBI (3pm) manual">
  <meta name="twitter:description" content="Initiate a persistent database connection">
  <meta name="twitter:image" content="https://www.carta.tech/images/libapache-dbi-perl-Apache::DBI-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Apache::DBI.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Apache::DBI (3pm) manual" />
  <meta property="og:description" content="Initiate a persistent database connection" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libapache-dbi-perl-Apache::DBI-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Apache::DBI<small> (3pm)</small></h1>
        <p class="lead">Initiate a persistent database connection</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache::DBI.3pm.html">
      <span itemprop="name">Apache::DBI: Initiate a persistent database connection</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libapache-dbi-perl/">
      <span itemprop="name">libapache-dbi-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache::DBI.3pm.html">
      <span itemprop="name">Apache::DBI: Initiate a persistent database connection</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
 # Configuration in httpd.conf or startup.pl:

 PerlModule Apache::DBI  # this comes before all other modules using DBI
</pre>
<p>Do \s-1NOT\s0 change anything in your scripts. The usage of this module is absolutely transparent !</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module initiates a persistent database connection.</p><p>The database access uses Perl's \s-1DBI\s0. For supported \s-1DBI\s0 drivers see:</p><p> http://dbi.perl.org/</p><p>When loading the \s-1DBI\s0 module (do not confuse this with the Apache::DBI module) it checks if the environment variable '\s-1MOD_PERL\s0' has been set and if the module Apache::DBI has been loaded. In this case every connect request will be forwarded to the Apache::DBI module. This checks if a database handle from a previous connect request is already stored and if this handle is still valid using the ping method. If these two conditions are fulfilled it just returns the database handle. The parameters defining the connection have to be exactly the same, including the connect attributes! If there is no appropriate database handle or if the ping method fails, a new connection is established and the handle is stored for later re-use. There is no need to remove the disconnect statements from your code. They won't do anything because the Apache::DBI module overloads the disconnect method.</p><p>The Apache::DBI module still has a limitation: it keeps database connections persistent on a per process basis. The problem is, if a user accesses a database several times, the http requests will be handled very likely by different processes. Every process needs to do its own connect. It would be nice if all servers could share the database handles, but currently this is not possible because of the distinct memory-space of each process. Also it is not possible to create a database handle upon startup of the httpd and then inherit this handle to every subsequent server. This will cause clashes when the handle is used by two processes at the same time.  Apache::DBI has built-in protection against this.  It will not make a connection persistent if it sees that it is being opened during the server startup.  This allows you to safely open a connection for grabbing data needed at startup and disconnect it normally before the end of startup.</p><p>With this limitation in mind, there are scenarios, where the usage of Apache::DBI is depreciated. Think about a heavy loaded Web-site where every user connects to the database with a unique userid. Every server would create many database handles each of which spawning a new backend process. In a short time this would kill the web server.</p><p>Another problem are timeouts: some databases disconnect the client after a certain period of inactivity. The module tries to validate the database handle using the \*(C`ping()\*(C' method of the DBI-module. This method returns true by default. Most \s-1DBI\s0 drivers have a working \*(C`ping()\*(C' method, but if the driver you're using doesn't have one and the database handle is no longer valid, you will get an error when accessing the database. As a work-around you can try to add your own \*(C`ping()\*(C' method using any database command which is cheap and safe, or you can deactivate the usage of the ping method (see \s-1CONFIGURATION\s0 below).</p><p>Here is a generalized ping method, which can be added to the driver module:</p><p>   package DBD::xxx::db; # ====== DATABASE ======    use strict;</p><p>   sub ping {      my ($dbh) = @_;      my $ret = 0;      eval {        local $SIG{_\|_DIE_\|_}  = sub { return (0); };        local $SIG{_\|_WARN_\|_} = sub { return (0); };        # adapt the select statement to your database:        $ret = $dbh-&gt;do(&apos;select 1&apos;);      };      return ($@) ? 0 : $ret;    }</p><p>Transactions: a standard \s-1DBI\s0 script will automatically perform a rollback whenever the script exits. In the case of persistent database connections, the database handle will not be destroyed and hence no automatic rollback will occur. At a first glance it even seems possible to handle a transaction over multiple requests. But this should be avoided, because different requests are handled by different processes and a process does not know the state of a specific transaction which has been started by another process. In general, it is good practice to perform an explicit commit or rollback at the end of every request. In order to avoid inconsistencies in the database in case AutoCommit is off and the script finishes without an explicit rollback, the Apache::DBI module uses a PerlCleanupHandler to issue a rollback at the end of every request. Note, that this CleanupHandler will only be used, if the initial data_source sets AutoCommit = 0 or AutoCommit is turned off, after the connect has been done (ie begin_work). However, because a connection may have set other parameters, the handle is reset to its initial connection state before it is returned for a second time.</p><p>This module plugs in a menu item for Apache::Status or Apache2::Status. The menu lists the current database connections. It should be considered incomplete because of the limitations explained above. It shows the current database connections for one specific process, the one which happens to serve the current request.  Other processes might have other database connections. The Apache::Status/Apache2::Status module has to be loaded before the Apache::DBI module !</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>The module should be loaded upon startup of the Apache daemon. Add the following line to your httpd.conf or startup.pl:</p><p> PerlModule Apache::DBI</p><p>It is important, to load this module before any other modules using \s-1DBI\s0 !</p><p>A common usage is to load the module in a startup file called via the PerlRequire directive. See eg/startup.pl and eg/startup2.pl for examples.</p><p>There are two configurations which are server-specific and which can be done upon server startup:</p><p> Apache::DBI-&gt;connect_on_init($data_source, $username, $auth, &#92;%attr)</p><p>This can be used as a simple way to have apache servers establish connections on process startup.</p><p> Apache::DBI-&gt;setPingTimeOut($data_source, $timeout)</p><p>This configures the usage of the ping method, to validate a connection. Setting the timeout to 0 will always validate the database connection using the ping method (default). Setting the timeout &lt; 0 will de-activate the validation of the database handle. This can be used for drivers, which do not implement the ping-method. Setting the timeout &gt; 0 will ping the database only if the last access was more than timeout seconds before.</p><p>For the menu item '\s-1DBI\s0 connections' you need to call Apache::Status/Apache2::Status \s-1BEFORE\s0 Apache::DBI ! For an example of the configuration order see startup.pl.</p><p>To enable debugging the variable $Apache::DBI::DEBUG must be set. This can either be done in startup.pl or in the user script. Setting the variable to 1, just reports about a new connect. Setting the variable to 2 enables full debug output.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PREREQUISITES</h2>
        <div class="sectioncontent">
<h3>\s-1MOD_PERL\s0 2.0</h3>
<p>Apache::DBI version 0.96 and later should work under mod_perl 2.0 \s-1RC5\s0 and later with httpd 2.0.49 and later.</p><p>Apache::DBI versions less than 1.00 are \s-1NO\s0 longer supported.  Additionally, mod_perl versions less then 2.0.0 are \s-1NO\s0 longer supported.</p>
<h3>\s-1MOD_PERL\s0 1.0 Note that this module needs mod_perl-1.08 or higher, apache_1.3.0 or higher and that mod_perl needs to be configured with the appropriate call-back hooks:</h3>
<p>  PERL_CHILD_INIT=1 PERL_STACKED_HANDLERS=1</p><p>Apache::DBI v0.94 was the last version before dual mod_perl 2.x support was begun. It is recommended that you use the latest version of Apache::DBI because Apache::DBI versions less than 1.00 are \s-1NO\s0 longer supported.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DO YOU NEED THIS MODULE?</h2>
        <div class="sectioncontent">
<p>Note that this module is intended for use in porting existing \s-1DBI\s0 code to mod_perl, or writing code that can run under both mod_perl and \s-1CGI\s0.  If you are using a database abstraction layer such as Class::DBI or DBIx::Class that already manages persistent connections for you, there is no need to use this module in addition.  (Another popular choice, Rose::DB::Object, can cooperate with Apache::DBI or use your own custom connection handling.)  If you are developing new code that is strictly for use in mod_perl, you may choose to use \*(C`DBI-&gt;connect_cached()\*(C' instead, but consider adding an automatic rollback after each request, as described above.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Apache::DBI&hellip;</h2>
        <div class="sectioncontent">
<p>Apache, mod_perl, \s-1DBI\s0</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<ul>
<li><p>Philip M. Gollucci &lt;pgollucci@p6m7g8.com&gt; is currently packaging new releases. Ask Bjoern Hansen &lt;ask@develooper.com&gt; packaged a large number of releases.</p></li><li><p>Edmund Mergl was the original author of Apache::DBI.  It is now supported and maintained by the modperl mailinglist, see the mod_perl documentation for instructions on how to subscribe.</p></li><li><p>mod_perl by Doug MacEachern.</p></li><li><p>\s-1DBI\s0 by Tim Bunce &lt;dbi-users-subscribe@perl.org&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>The Apache::DBI module is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Apache::AuthzNetLDAP.3pm.html"><span aria-hidden="true">&larr;</span> Apache::AuthzNetLDAP.3pm: Apache-perl module that enables you to authorize a user for website based on ldap attributes.</a></li>
   <li class="next"><a href="Apache::DBILogger.3pm.html">Apache::DBILogger.3pm: Tracks what's being transferred in a dbi database <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
