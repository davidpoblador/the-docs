<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Apache::AuthDBI: Authentication and authorization via perl's dbi</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Authentication and authorization via perl's dbi">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="Apache::AuthDBI (3pm) manual">
  <meta name="twitter:description" content="Authentication and authorization via perl's dbi">
  <meta name="twitter:image" content="https://www.carta.tech/images/libapache-dbi-perl-Apache::AuthDBI-3pm.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3pm/Apache::AuthDBI.3pm.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Apache::AuthDBI (3pm) manual" />
  <meta property="og:description" content="Authentication and authorization via perl's dbi" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libapache-dbi-perl-Apache::AuthDBI-3pm.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">Apache::AuthDBI<small> (3pm)</small></h1>
        <p class="lead">Authentication and authorization via perl's dbi</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache::AuthDBI.3pm.html">
      <span itemprop="name">Apache::AuthDBI: Authentication and authorization via perl's dbi</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libapache-dbi-perl/">
      <span itemprop="name">libapache-dbi-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3pm/Apache::AuthDBI.3pm.html">
      <span itemprop="name">Apache::AuthDBI: Authentication and authorization via perl's dbi</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
 # Configuration in httpd.conf or startup.pl:

 PerlModule Apache::AuthDBI

 # Authentication and Authorization in .htaccess:

 AuthName DBI
 AuthType Basic

 PerlAuthenHandler Apache::AuthDBI::authen
 PerlAuthzHandler  Apache::AuthDBI::authz

 PerlSetVar Auth_DBI_data_source   dbi:driver:dsn
 PerlSetVar Auth_DBI_username      db_username
 PerlSetVar Auth_DBI_password      db_password
 #DBI-&gt;connect($data_source, $username, $password)

 PerlSetVar Auth_DBI_pwd_table     users
 PerlSetVar Auth_DBI_uid_field     username
 PerlSetVar Auth_DBI_pwd_field     password
 # authentication: SELECT pwd_field FROM pwd_table WHERE uid_field=$user
 PerlSetVar Auth_DBI_grp_field     groupname
 # authorization: SELECT grp_field FROM pwd_table WHERE uid_field=$user

 require valid-user
 require user   user_1  user_2 ...
 require group group_1 group_2 ...
</pre>
<p>The AuthType is limited to Basic. You may use one or more valid require lines. For a single require line with the requirement 'valid-user' or with the requirements 'user user_1 user_2 ...' it is sufficient to use only the authentication handler.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This module allows authentication and authorization against a database using Perl's \s-1DBI\s0. For supported \s-1DBI\s0 drivers see:</p><p> http://dbi.perl.org/</p><p>Authentication:</p><p>For the given username the password is looked up in the cache. If the cache is not configured or if the user is not found in the cache, or if the given password does not match the cached password, it is requested from the database.</p><p>If the username does not exist and the authoritative directive is set to 'on', the request is rejected. If the authoritative directive is set to 'off', the control is passed on to next module in line.</p><p>If the password from the database for the given username is empty and the nopasswd directive is set to 'off', the request is rejected. If the nopasswd directive is set to 'on', any password is accepted.</p><p>Finally the passwords (multiple passwords per userid are allowed) are retrieved from the database. The result is put into the environment variable \s-1REMOTE_PASSWORDS\s0. Then it is compared to the password given. If the encrypted directive is set to 'on', the given password is encrypted using perl's <em>crypt()</em> function before comparison. If the encrypted directive is set to 'off' the plain-text passwords are compared.</p><p>If this comparison fails the request is rejected, otherwise the request is accepted and the password is put into the environment variable \s-1REMOTE_PASSWORD\s0.</p><p>The SQL-select used for retrieving the passwords is as follows:</p><p> SELECT pwd_field FROM pwd_table WHERE uid_field = user</p><p>If a pwd_whereclause exists, it is appended to the SQL-select.</p><p>This module supports in addition a simple kind of logging mechanism. Whenever the handler is called and a log_string is configured, the log_field will be updated with the log_string. As log_string - depending upon the database - macros like \s-1TODAY\s0 can be used.</p><p>The SQL-select used for the logging mechanism is as follows:</p><p> UPDATE pwd_table SET log_field = log_string WHERE uid_field = user</p><p>Authorization:</p><p>When the authorization handler is called, the authentication has already been done. This means, that the given username/password has been validated.</p><p>The handler analyzes and processes the requirements line by line. The request is accepted if the first requirement is fulfilled.</p><p>In case of 'valid-user' the request is accepted.</p><p>In case of one or more user-names, they are compared with the given user-name until the first match.</p><p>In case of one or more group-names, all groups of the given username are looked up in the cache. If the cache is not configured or if the user is not found in the cache, or if the requested group does not match the cached group, the groups are requested from the database. A comma separated list of all these groups is put into the environment variable \s-1REMOTE_GROUPS\s0. Then these groups are compared with the required groups until the first match.</p><p>If there is no match and the authoritative directive is set to 'on' the request is rejected.</p><p>In case the authorization succeeds, the environment variable \s-1REMOTE_GROUP\s0 is set to the group name, which can be used by user scripts without accessing the database again.</p><p>The SQL-select used for retrieving the groups is as follows (depending upon the existence of a grp_table):</p><p> SELECT grp_field FROM pwd_table WHERE uid_field = user  SELECT grp_field FROM grp_table WHERE uid_field = user</p><p>This way the group-information can either be held in the main users table, or in an extra table, if there is an m:n relationship between users and groups. From all selected groups a comma-separated list is build, which is compared with the required groups. If you don't like normalized group records you can put such a comma-separated list of groups (no spaces) into the grp_field instead of single groups.</p><p>If a grp_whereclause exists, it is appended to the SQL-select.</p><p>Cache:</p><p>The module maintains an optional cash for all passwords/groups. See the method setCacheTime(n) on how to enable the cache. Every server has it's own cache. Optionally the cache can be put into a shared memory segment, so that it can be shared among all servers. See the \s-1CONFIGURATION\s0 section on how to enable the usage of shared memory.</p><p>In order to prevent the cache from growing indefinitely a CleanupHandler can be initialized, which skips through the cache and deletes all outdated entries. This can be done once per request after sending the response, hence without slowing down response time to the client. The minimum time between two successive runs of the CleanupHandler is configurable (see the \s-1CONFIGURATION\s0 section). The default is 0, which runs the CleanupHandler after every request.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIST OF TOKENS</h2>
        <div class="sectioncontent">
<ul>
<li><p>Auth_DBI_data_source (Authentication and Authorization) The data_source value has the syntax 'dbi:driver:dsn'. This parameter is passed to the database driver for processing during connect. The data_source parameter (as well as the username and the password parameters) may be a tilde ('~') separated list of several data_sources. All of these triples will be used until a successful connect is made. This way several backup-servers can be configured. if you want to use the environment variable \s-1DBI_DSN\s0 instead of a data_source, do not specify this parameter at all.</p></li><li><p>Auth_DBI_username (Authentication and Authorization) The username argument is passed to the database driver for processing during connect. This parameter may be a tilde ('~') separated list. See the data_source parameter above for the usage of a list.</p></li><li><p>Auth_DBI_password (Authentication and Authorization) The password argument is passed to the database driver for processing during connect. This parameter may be a tilde ('~')  separated list. See the data_source parameter above for the usage of a list.</p></li><li><p>Auth_DBI_pwd_table (Authentication and Authorization) Contains at least the fields with the username and the (possibly encrypted) password. The username should be unique.</p></li><li><p>Auth_DBI_uid_field (Authentication and Authorization) Field name containing the username in the Auth_DBI_pwd_table.</p></li><li><p>Auth_DBI_pwd_field (Authentication only) Field name containing the password in the Auth_DBI_pwd_table.</p></li><li><p>Auth_DBI_pwd_whereclause (Authentication only) Use this option for specifying more constraints to the SQL-select.</p></li><li><p>Auth_DBI_grp_table (Authorization only) Contains at least the fields with the username and the groupname.</p></li><li><p>Auth_DBI_grp_field (Authorization only) Field-name containing the groupname in the Auth_DBI_grp_table.</p></li><li><p>Auth_DBI_grp_whereclause (Authorization only) Use this option for specifying more constraints to the SQL-select.</p></li><li><p>Auth_DBI_log_field (Authentication only) Field name containing the log string in the Auth_DBI_pwd_table.</p></li><li><p>Auth_DBI_log_string (Authentication only) String to update the Auth_DBI_log_field in the Auth_DBI_pwd_table. Depending upon the database this can be a macro like '\s-1TODAY\s0'.</p></li><li><p>Auth_DBI_authoritative  &lt; on / off&gt; (Authentication and Authorization) Default is 'on'. When set 'on', there is no fall-through to other authentication methods if the authentication check fails. When this directive is set to 'off', control is passed on to any other authentication modules. Be sure you know what you are doing when you decide to switch it off.</p></li><li><p>Auth_DBI_nopasswd  &lt; on / off &gt; (Authentication only) Default is 'off'. When set 'on' the password comparison is skipped if the password retrieved from the database is empty, i.e. allow any password. This is 'off' by default to ensure that an empty Auth_DBI_pwd_field does not allow people to log in with a random password. Be sure you know what you are doing when you decide to switch it on.</p></li><li><p>Auth_DBI_encrypted  &lt; on / off &gt; (Authentication only) Default is 'on'. When set to 'on', the password retrieved from the database is assumed to be crypted. Hence the incoming password will be crypted before comparison. When this directive is set to 'off', the comparison is done directly with the plain-text entered password.</p></li><li><p>Auth_DBI_encryption_method &lt; sha1hex/md5hex/crypt &gt; (Authentication only) Default is blank. When set to one or more encryption method, the password retrieved from the database is assumed to be crypted. Hence the incoming password will be crypted before comparison.  The method supports falling back so specifying 'sha1hex/md5hex' would allow for a site that is upgrading to sha1 to support both methods.  sha1 is the recommended method.</p></li><li><p>Auth_DBI_encryption_salt &lt; password / userid &gt; (Authentication only) When crypting the given password AuthDBI uses per default the password selected from the database as salt. Setting this parameter to 'userid', the module uses the userid as salt.</p></li><li><p>Auth_DBI_uidcasesensitive  &lt; on / off &gt; (Authentication and Authorization) Default is 'on'. When set 'off', the entered userid is converted to lower case. Also the userid in the password select-statement is converted to lower case.</p></li><li><p>Auth_DBI_pwdcasesensitive  &lt; on / off &gt; (Authentication only) Default is 'on'. When set 'off', the entered password is converted to lower case.</p></li><li><p>Auth_DBI_placeholder &lt; on / off &gt; (Authentication and Authorization) Default is 'off'.  When set 'on', the select statement is prepared using a placeholder for the username.  This may result in improved performance for databases supporting this method.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>The module should be loaded upon startup of the Apache daemon. Add the following line to your httpd.conf:</p><p> PerlModule Apache::AuthDBI</p><p>A common usage is to load the module in a startup file via the PerlRequire directive. See eg/startup.pl for an example.</p><p>There are three configurations which are server-specific and which can be done in a startup file:</p><p> Apache::AuthDBI-&gt;<strong>setCacheTime</strong>(0);</p><p>This configures the lifetime in seconds for the entries in the cache. Default is 0, which turns off the cache. When set to any value n &gt; 0, the passwords/groups of all users will be cached for at least n seconds. After finishing the request, a special handler skips through the cache and deletes all outdated entries (entries, which are older than the CacheTime).</p><p> Apache::AuthDBI-&gt;setCleanupTime(-1);</p><p>This configures the minimum time in seconds between two successive runs of the CleanupHandler, which deletes all outdated entries from the cache. The default is -1, which disables the CleanupHandler. Setting the interval to 0 runs the CleanupHandler after every request. For a heavily loaded server this should be set to a value, which reflects a compromise between scanning a large cache possibly containing many outdated entries and between running many times the CleanupHandler on a cache containing only few entries.</p><p> Apache::AuthDBI-&gt;<strong>setProjID</strong>(1);</p><p>This configures the project \s-1ID\s0 used to create a semaphore \s-1ID\s0 for shared memory. It can be set to any integer 1 to 255 or it will default to a value of 1.</p><p>\s-1NOTE:\s0 This must be set prior to calling initIPC.</p><p>If you are running multiple instances of Apache on the same server&#92; (for example, Apache1 and Apache2), you may not want (or be able) to use shared memory between them.  In this case, use a different project \s-1ID\s0 on each server.</p><p>If you are reading this because you suspect you have a permission issue or a collision with a semaphore, use 'ipcs -s' to list semaphores and look for the Semaphore \s-1ID\s0 from the apache error log.  If found, shutdown Apache (all of them) and use 'ipcrm sem &lt;semaphore key&gt;' to remove the colliding (and hopefully unused) semaphore.</p><p>You may also want to remove any orphaned shared memory segments by using 'ipcs -m' and removing the orphans with ipcrm shm &lt;shared memory id&gt;.</p><p> Apache::AuthDBI-&gt;initIPC(50000);</p><p>This enables the usage of shared memory for the cache. Instead of every server maintaining it's own cache, all servers have access to a common cache. This should minimize the database load considerably for sites running many servers. The number indicates the size of the shared memory segment in bytes. This size is fixed, there is no dynamic allocation of more segments. As a rule of thumb multiply the estimated maximum number of simultaneously cached users by 100 to get a rough estimate of the needed size. Values below 500 will be overwritten with the default 50000.</p><p>To enable debugging the variable $Apache::AuthDBI::DEBUG must be set. This can either be done in startup.pl or in the user script. Setting the variable to 1, just reports about a cache miss. Setting the variable to 2 enables full debug output.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PREREQUISITES</h2>
        <div class="sectioncontent">
<h3>\s-1MOD_PERL\s0 2.0</h3>
<p>Apache::DBI version 0.96 and should work under mod_perl 2.0 \s-1RC5\s0 and later with httpd 2.0.49 and later.</p><p>Apache::DBI versions less than 1.00 are \s-1NO\s0 longer supported.  Additionally, mod_perl versions less then 2.0.0 are \s-1NO\s0 longer supported.</p>
<h3>\s-1MOD_PERL\s0 1.0</h3>
<p>Note that this module needs mod_perl-1.08 or higher, apache_1.3.0 or higher and that mod_perl needs to be configured with the appropriate call-back hooks:</p><p>  PERL_AUTHEN=1 PERL_AUTHZ=1 PERL_CLEANUP=1 PERL_STACKED_HANDLERS=1</p><p>Apache::DBI v0.94 was the last version before dual mod_perl 2.x support was begun. It still recommened that you use the latest version of Apache::DBI because Apache::DBI versions less than 1.00 are \s-1NO\s0 longer supported.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY</h2>
        <div class="sectioncontent">
<p>In some cases it is more secure not to put the username and the password in the .htaccess file. The following example shows a solution to this problem:</p><p>httpd.conf:</p><p> &lt;Perl&gt;  my($uid,$pwd) = My::dbi_pwd_fetch();  $Location{&apos;/foo/bar&apos;}-&gt;{PerlSetVar} = [      [ Auth_DBI_username  =&gt; $uid ],      [ Auth_DBI_password  =&gt; $pwd ],  ];  &lt;/Perl&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO Apache::AuthDBI&hellip;</h2>
        <div class="sectioncontent">
<p>Apache, mod_perl, \s-1DBI\s0</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<ul>
<li><p>Apache::AuthDBI by Edmund Mergl; now maintained and supported by the modperl mailinglist, subscribe by sending mail to modperl-subscribe@perl.apache.org.</p></li><li><p>mod_perl by Doug MacEachern.</p></li><li><p>\s-1DBI\s0 by Tim Bunce &lt;dbi-users-subscribe@perl.org&gt;</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>The Apache::AuthDBI module is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="Apache::Admin::Config.3pm.html"><span aria-hidden="true">&larr;</span> Apache::Admin::Config.3pm: A module to read/write apache like configuration files</a></li>
   <li class="next"><a href="Apache::AuthzNetLDAP.3pm.html">Apache::AuthzNetLDAP.3pm: Apache-perl module that enables you to authorize a user for website based on ldap attributes. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
