<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sd_listen_fds: Check for file descriptors passed by the system manager</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Check for file descriptors passed by the system manager">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="sd_listen_fds (3) manual">
  <meta name="twitter:description" content="Check for file descriptors passed by the system manager">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsystemd-dev-sd_listen_fds-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/sd_listen_fds.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="sd_listen_fds (3) manual" />
  <meta property="og:description" content="Check for file descriptors passed by the system manager" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsystemd-dev-sd_listen_fds-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">sd_listen_fds<small> (3)</small></h1>
        <p class="lead">Check for file descriptors passed by the system manager</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/sd_listen_fds.3.html">
      <span itemprop="name">sd_listen_fds: Check for file descriptors passed by the system manager</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsystemd-dev/">
      <span itemprop="name">libsystemd-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/sd_listen_fds.3.html">
      <span itemprop="name">sd_listen_fds: Check for file descriptors passed by the system manager</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
#include &lt;systemd/sd-daemon.h&gt;
</pre>

<pre>
#define SD_LISTEN_FDS_START 3
</pre>
<p><strong>int sd_listen_fds(int&nbsp;</strong><em>unset_environment</em><strong>);</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>sd_listen_fds()</strong> shall be called by a daemon to check for file descriptors passed by the init system as part of the socket-based activation logic.</p><p>If the <em>unset_environment</em> parameter is non-zero, <strong>sd_listen_fds()</strong> will unset the <em>$LISTEN_FDS</em>/<em>$LISTEN_PID</em> environment variables before returning (regardless of whether the function call itself succeeded or not). Further calls to <strong>sd_listen_fds()</strong> will then fail, but the variables are no longer inherited by child processes.</p><p>If a daemon receives more than one file descriptor, they will be passed in the same order as configured in the systemd socket definition file. Nonetheless, it is recommended to verify the correct socket types before using them. To simplify this checking, the functions <a href="../man3/sd_is_fifo.3.html"><strong>sd_is_fifo</strong>(3)</a>, <a href="../man3/sd_is_socket.3.html"><strong>sd_is_socket</strong>(3)</a>, <a href="../man3/sd_is_socket_inet.3.html"><strong>sd_is_socket_inet</strong>(3)</a>, <a href="../man3/sd_is_socket_unix.3.html"><strong>sd_is_socket_unix</strong>(3)</a> are provided. In order to maximize flexibility, it is recommended to make these checks as loose as possible without allowing incorrect setups. i.e. often, the actual port number a socket is bound to matters little for the service to work, hence it should not be verified. On the other hand, whether a socket is a datagram or stream socket matters a lot for the most common program logics and should be checked.</p><p>This function call will set the FD_CLOEXEC flag for all passed file descriptors to avoid further inheritance to children of the calling process.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>On failure, this call returns a negative errno-style error code. If <em>$LISTEN_FDS</em>/<em>$LISTEN_PID</em> was not set or was not correctly set for this daemon and hence no file descriptors were received, 0 is returned. Otherwise, the number of file descriptors passed is returned. The application may find them starting with file descriptor SD_LISTEN_FDS_START, i.e. file descriptor 3.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>These APIs are implemented as a shared library, which can be compiled and linked to with the <strong>libsystemd</strong>&nbsp;<a href="../man1/pkg-config.1.html"><strong>pkg-config</strong>(1)</a> file.</p><p>Internally, this function checks whether the <em>$LISTEN_PID</em> environment variable equals the daemon PID. If not, it returns immediately. Otherwise, it parses the number passed in the <em>$LISTEN_FDS</em> environment variable, then sets the FD_CLOEXEC flag for the parsed number of file descriptors starting from SD_LISTEN_FDS_START. Finally, it returns the parsed number.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p><em>$LISTEN_PID</em>, <em>$LISTEN_FDS</em></p><p>Set by the init system for supervised processes that use socket-based activation. This environment variable specifies the data <strong>sd_listen_fds()</strong> parses. See above for details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO sd_listen_fds&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/systemd.1.html"><strong>systemd</strong>(1)</a>, <a href="../man3/sd-daemon.3.html"><strong>sd-daemon</strong>(3)</a>, <a href="../man3/sd_is_fifo.3.html"><strong>sd_is_fifo</strong>(3)</a>, <a href="../man3/sd_is_socket.3.html"><strong>sd_is_socket</strong>(3)</a>, <a href="../man3/sd_is_socket_inet.3.html"><strong>sd_is_socket_inet</strong>(3)</a>, <a href="../man3/sd_is_socket_unix.3.html"><strong>sd_is_socket_unix</strong>(3)</a>, <a href="../man7/daemon.7.html"><strong>daemon</strong>(7)</a>, <strong>systemd.service</strong>(5), <a href="../man5/systemd.socket.5.html"><strong>systemd.socket</strong>(5)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="sd_journal_wait.3.html"><span aria-hidden="true">&larr;</span> sd_journal_wait.3: Journal change notification interface</a></li>
   <li class="next"><a href="sd_login_monitor.3.html">sd_login_monitor.3: Monitor login sessions, seats, users and virtual machines/containers <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
