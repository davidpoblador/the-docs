<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mtbl_sorter: Sort a sequence of unordered key-value pairs</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Sort a sequence of unordered key-value pairs">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mtbl_sorter (3) manual">
  <meta name="twitter:description" content="Sort a sequence of unordered key-value pairs">
  <meta name="twitter:image" content="https://www.carta.tech/images/libmtbl-dev-mtbl_sorter-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/mtbl_sorter.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mtbl_sorter (3) manual" />
  <meta property="og:description" content="Sort a sequence of unordered key-value pairs" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libmtbl-dev-mtbl_sorter-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mtbl_sorter<small> (3)</small></h1>
        <p class="lead">Sort a sequence of unordered key-value pairs</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/mtbl_sorter.3.html">
      <span itemprop="name">mtbl_sorter: Sort a sequence of unordered key-value pairs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libmtbl-dev/">
      <span itemprop="name">libmtbl-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/mtbl_sorter.3.html">
      <span itemprop="name">mtbl_sorter: Sort a sequence of unordered key-value pairs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;mtbl.h&gt;</strong></p><p>Sorter objects:</p>
<pre>
<strong>struct mtbl_sorter *</strong>
mtbl_sorter_init(const struct mtbl_sorter_options *<strong></strong><em>sopt</em><strong>);</strong>
</pre>

<pre>
<strong>void</strong>
mtbl_sorter_destroy(struct mtbl_sorter **<strong></strong><em>s</em><strong>);</strong>
</pre>

<pre>
<strong>mtbl_res</strong>
mtbl_sorter_add(struct mtbl_sorter *<strong></strong><em>s</em><strong>,</strong>
        const uint8_t *<strong></strong><em>key</em><strong>, size_t </strong><strong></strong><em>len_key</em><strong>,</strong>
        const uint8_t *<strong></strong><em>val</em><strong>, size_t </strong><strong></strong><em>len_val</em><strong>);</strong>
</pre>

<pre>
<strong>mtbl_res</strong>
mtbl_sorter_write(struct mtbl_sorter *<strong></strong><em>s</em><strong>, struct mtbl_writer *</strong><strong></strong><em>w</em><strong>);</strong>
</pre>

<pre>
<strong>struct mtbl_iter *</strong>
mtbl_sorter_iter(struct mtbl_sorter *<strong></strong><em>s</em><strong>);</strong>
</pre>
<p>Sorter options:</p>
<pre>
<strong>struct mtbl_sorter_options *</strong>
mtbl_sorter_options_init(void);
</pre>

<pre>
<strong>void</strong>
mtbl_sorter_options_destroy(struct mtbl_sorter_options **<strong></strong><em>sopt</em><strong>);</strong>
</pre>

<pre>
<strong>void</strong>
mtbl_sorter_options_set_merge_func(
        struct mtbl_sorter_options *<strong></strong><em>sopt</em><strong>,</strong>
        mtbl_merge_func <strong></strong><em>fp</em><strong>,</strong>
        void *<strong></strong><em>clos</em><strong>);</strong>
</pre>

<pre>
<strong>void</strong>
mtbl_sorter_options_set_temp_dir(
        struct mtbl_sorter_options *<strong></strong><em>sopt</em><strong>,</strong>
        const char *<strong></strong><em>temp_dir</em><strong>);</strong>
</pre>

<pre>
<strong>void</strong>
mtbl_sorter_options_set_max_memory(
        struct mtbl_sorter_options *<strong></strong><em>sopt</em><strong>,</strong>
        size_t <strong></strong><em>max_memory</em><strong>);</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>mtbl_sorter</strong> interface accepts a sequence of key-value pairs with keys in arbitrary order and provides these entries in sorted order. The sorted entries may be consumed via the <strong>mtbl_iter</strong> interface using the <strong>mtbl_sorter_iter</strong>() function, or they may be dumped to an <strong>mtbl_writer</strong> object using the <strong>mtbl_sorter_write</strong>() function. The <strong>mtbl_sorter</strong> implementation buffers entries in memory up to a configurable limit before sorting them and writing them to disk in chunks. When the caller has finishing adding entries and requests the sorted output, entries from these sorted chunks are then read back and merged. (Thus, <a href="../man3/mtbl_sorter.3.html"><strong>mtbl_sorter</strong>(3)</a> is an "external sorting" implementation.)</p><p>Because the MTBL format does not allow duplicate keys, the caller must provide a function which will accept a key and two conflicting values for that key and return a replacement value. This function may be called multiple times for the same key if the same key is inserted more than twice. See <a href="../man3/mtbl_merger.3.html"><strong>mtbl_merger</strong>(3)</a> for further details about the merge function.</p><p><strong>mtbl_sorter</strong> objects are created with the <strong>mtbl_sorter_init</strong>() function, which requires a non-NULL <em>sopt</em> argument which has been configured with a merge function <em>fp</em>.</p><p><strong>mtbl_sorter_add</strong>() copies key-value pairs from the caller into the <strong>mtbl_sorter</strong> object. Keys are specified as a pointer to a buffer, <em>key</em>, and the length of that buffer, <em>len_key</em>. Values are specified as a pointer to a buffer, <em>val</em>, and the length of that buffer, <em>len_val</em>.</p><p>Once the caller has finished adding entries to the <strong>mtbl_sorter</strong> object, either <strong>mtbl_sorter_write</strong>() or <strong>mtbl_sorter_iter</strong>() should be called in order to consume the sorted output. It is a runtime error to call <strong>mtbl_sorter_add</strong>() on an <strong>mtbl_sorter</strong> object after iteration has begun, and once the sorted output has been consumed, it is also a runtime error to call any other function but <strong>mtbl_sorter_destroy</strong>() on the depleted <strong>mtbl_sorter</strong> object.</p><h3>Sorter options</h3>
<p><strong>temp_dir</strong></p><p>Specifies the temporary directory to use. Defaults to /var/tmp.</p><p><strong>max_memory</strong></p><p>Specifies the maximum amount of memory to use for in-memory sorting, in bytes. Defaults to 1 Gigabyte. This specifies a limit on the total number of bytes allocated for key-value entries and does not include any allocation overhead.</p><p><strong>merge_func</strong></p><p>See <a href="../man3/mtbl_merger.3.html"><strong>mtbl_merger</strong>(3)</a>. An <strong>mtbl_merger</strong> object is used internally for the external sort.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>If the merge function callback is unable to provide a merged value (that is, it fails to return a non-NULL value in its <em>merged_val</em> argument), the sort process will be aborted, and <strong>mtbl_sorter_write</strong>() or <strong>mtbl_iter_next</strong>() will return <strong>mtbl_res_failure</strong>.</p><p><strong>mtbl_sorter_write</strong>() returns <strong>mtbl_res_success</strong> if the sorted output was successfully written, and <strong>mtbl_res_failure</strong> otherwise.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mtbl_reader.3.html"><span aria-hidden="true">&larr;</span> mtbl_reader.3: Read an mtbl file</a></li>
   <li class="next"><a href="mtbl_source.3.html">mtbl_source.3: Obtain key-value entries from a data source <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
