<!DOCTYPE html>
<html lang="en">
<head>
  <link href='https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction|shadow-multiple' rel='stylesheet' type='text/css'>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lockf - apply, test or remove a POSIX lock on an open file</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="${metadescription}">
  
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">lockf<small> (3)</small></h1>
        <p class="lead">apply, test or remove a POSIX lock on an open file</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href=".."><span itemprop="title">Linux Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="../man3"><span itemprop="title">Library calls</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href=""><span itemprop="title">lockf</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">SYNOPSIS</h2>
        <div class="sectioncontent">

<p><strong>#include &lt;unistd.h&gt;</strong></p>
<p class='spacer'>

<p><strong>int lockf(int </strong><em>fd</em><strong>, int </strong><em>cmd</em><strong>, off_t </strong><em>len</em><strong>);</strong></p>
<p class='spacer'>

<p>Feature Test Macro Requirements for glibc (see <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a>):</p>
<p class='spacer'>

  <p><strong>lockf</strong>(): _XOPEN_SOURCE&nbsp;&gt;=&nbsp;500</p>
<pre>    || /* Glibc since 2.19: */ _DEFAULT_SOURCE
    || /* Glibc versions &lt;= 2.19: */ _BSD_SOURCE || _SVID_SOURCE</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>Apply, test or remove a POSIX lock on a section of an open file. The file is specified by <em>fd</em>, a file descriptor open for writing, the action by <em>cmd</em>, and the section consists of byte positions <em>pos</em>..<em>pos</em>+<em>len</em>-1 if <em>len</em> is positive, and <em>pos</em>-<em>len</em>..<em>pos</em>-1 if <em>len</em> is negative, where <em>pos</em> is the current file position, and if <em>len</em> is zero, the section extends from the current file position to infinity, encompassing the present and future end-of-file positions. In all cases, the section may extend past current end-of-file.</p>
<p class='spacer'>

<p>On Linux, <strong>lockf</strong>() is just an interface on top of <a href="../man2/fcntl.2.html"><strong>fcntl</strong>(2)</a> locking. Many other systems implement <strong>lockf</strong>() in this way, but note that POSIX.1 leaves the relationship between <strong>lockf</strong>() and <a href="../man2/fcntl.2.html"><strong>fcntl</strong>(2)</a> locks unspecified. A portable application should probably avoid mixing calls to these interfaces.</p>
<p class='spacer'>

  <p>Valid operations are given below:</p>
  <dl class='dl-vertical'>
    <dt><strong>F_LOCK</strong></dt>
    <dd>
  <p>Set an exclusive lock on the specified section of the file. If (part of) this section is already locked, the call blocks until the previous lock is released. If this section overlaps an earlier locked section, both are merged. File locks are released as soon as the process holding the locks closes some file descriptor for the file. A child process does not inherit these locks.</p>
    </dd>
    <dt><strong>F_TLOCK</strong></dt>
    <dd>
  <p>Same as <strong>F_LOCK</strong> but the call never blocks and returns an error instead if the file is already locked.</p>
    </dd>
    <dt><strong>F_ULOCK</strong></dt>
    <dd>
  <p>Unlock the indicated section of the file. This may cause a locked section to be split into two locked sections.</p>
    </dd>
    <dt><strong>F_TEST</strong></dt>
    <dd>
  <p>Test the lock: return 0 if the specified section is unlocked or locked by this process; return -1, set <em>errno</em> to <strong>EAGAIN</strong> (<strong>EACCES</strong> on some other systems), if another process holds a lock.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">RETURN VALUE</h2>
        <div class="sectioncontent">

<p>On success, zero is returned. On error, -1 is returned, and <em>errno</em> is set appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">ERRORS</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>EACCES</strong> or <strong>EAGAIN</strong></dt>
    <dd>
  <p>The file is locked and <strong>F_TLOCK</strong> or <strong>F_TEST</strong> was specified, or the operation is prohibited because the file has been memory-mapped by another process.</p>
    </dd>
    <dt><strong>EBADF</strong></dt>
    <dd>
  <p><em>fd</em> is not an open file descriptor; or <em>cmd</em> is <strong>F_LOCK</strong> or <strong>F_TLOCK</strong> and <em>fd</em> is not a writable file descriptor.</p>
    </dd>
    <dt><strong>EDEADLK</strong></dt>
    <dd>
  <p>The command was <strong>F_LOCK</strong> and this lock operation would cause a deadlock.</p>
    </dd>
    <dt><strong>EINVAL</strong></dt>
    <dd>
  <p>An invalid operation was specified in <em>cmd</em>.</p>
    </dd>
    <dt><strong>ENOLCK</strong></dt>
    <dd>
  <p>Too many segment locks open, lock table is full.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">ATTRIBUTES</h2>
        <div class="sectioncontent">

<p>For an explanation of the terms used in this section, see <a href="../man7/attributes.7.html"><strong>attributes</strong>(7)</a>.</p>
<table class="table table-striped">
<tr>
<th>Interface</th>
<th>Attribute</th>
<th>Value</th></tr>

<tr>
<td><strong>lockf</strong>()  </td>
<td>Thread safety</td>
<td>MT-Safe</td></tr>
</table>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">CONFORMING TO</h2>
        <div class="sectioncontent">

<p>POSIX.1-2001, POSIX.1-2008, SVr4.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple" id="$section">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man2/fcntl.2.html"><strong>fcntl</strong>(2)</a>, <a href="../man2/flock.2.html"><strong>flock</strong>(2)</a></p>
<p class='spacer'>

<p><em>locks.txt</em> and <em>mandatory-locking.txt</em> in the Linux kernel source directory <em>Documentation/filesystems</em> (on older kernels, these files are directly under the <em>Documentation</em> directory, and <em>mandatory-locking.txt</em> is called <em>mandatory.txt</em>)</p>
        </div>
      </section>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
