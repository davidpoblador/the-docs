<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dlclose: Programming interface to dynamic linking loader</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Programming interface to dynamic linking loader">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dlclose (3) manual">
  <meta name="twitter:description" content="Programming interface to dynamic linking loader">
  <meta name="twitter:image" content="https://www.carta.tech/images/manpages-dev-dlclose-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/dlclose.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dlclose (3) manual" />
  <meta property="og:description" content="Programming interface to dynamic linking loader" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/manpages-dev-dlclose-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dlclose<small> (3)</small></h1>
        <p class="lead">Programming interface to dynamic linking loader</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dlclose.3.html">
      <span itemprop="name">dlclose: Programming interface to dynamic linking loader</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/manpages-dev/">
      <span itemprop="name">manpages-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dlclose.3.html">
      <span itemprop="name">dlclose: Programming interface to dynamic linking loader</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;dlfcn.h&gt;</strong></p><p><strong>void *dlopen(const char *</strong><em>filename</em><strong>, int </strong><em>flag</em><strong>);</strong></p><p><strong>char *dlerror(void);</strong></p><p><strong>void *dlsym(void *</strong><em>handle</em><strong>, const char *</strong><em>symbol</em><strong>);</strong></p><p><strong>int dlclose(void *</strong><em>handle</em><strong>);</strong></p><p>Link with <em>-ldl</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The four functions <strong>dlopen</strong>(), <strong>dlsym</strong>(), <strong>dlclose</strong>(), <strong>dlerror</strong>() implement the interface to the dynamic linking loader.</p><h3>dlerror()</h3>
<p>The function <strong>dlerror</strong>() returns a human-readable string describing the most recent error that occurred from <strong>dlopen</strong>(), <strong>dlsym</strong>() or <strong>dlclose</strong>() since the last call to <strong>dlerror</strong>(). It returns NULL if no errors have occurred since initialization or since it was last called.</p>
<h3>dlopen()</h3>
<p>The function <strong>dlopen</strong>() loads the dynamic library file named by the null-terminated string <em>filename</em> and returns an opaque "handle" for the dynamic library. If <em>filename</em> is NULL, then the returned handle is for the main program. If <em>filename</em> contains a slash ("/"), then it is interpreted as a (relative or absolute) pathname. Otherwise, the dynamic linker searches for the library as follows (see <a href="../man8/ld.so.8.html"><strong>ld.so</strong>(8)</a> for further details):</p><ul>
<li><p>(ELF only) If the executable file for the calling program contains a DT_RPATH tag, and does not contain a DT_RUNPATH tag, then the directories listed in the DT_RPATH tag are searched.</p></li><li><p>If, at the time that the program was started, the environment variable <strong>LD_LIBRARY_PATH</strong> was defined to contain a colon-separated list of directories, then these are searched. (As a security measure this variable is ignored for set-user-ID and set-group-ID programs.)</p></li><li><p>(ELF only) If the executable file for the calling program contains a DT_RUNPATH tag, then the directories listed in that tag are searched.</p></li><li><p>The cache file <em>/etc/ld.so.cache</em> (maintained by <a href="../man8/ldconfig.8.html"><strong>ldconfig</strong>(8)</a>) is checked to see whether it contains an entry for <em>filename</em>.</p></li><li><p>The directories <em>/lib</em> and <em>/usr/lib</em> are searched (in that order).</p></li>
</ul><p>If the library has dependencies on other shared libraries, then these are also automatically loaded by the dynamic linker using the same rules. (This process may occur recursively, if those libraries in turn have dependencies, and so on.)</p><p>One of the following two values must be included in <em>flag</em>:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>RTLD_LAZY</strong></p>
  </dt>
  <dd>
    <p>Perform lazy binding. Only resolve symbols as the code that references them is executed. If the symbol is never referenced, then it is never resolved. (Lazy binding is performed only for function references; references to variables are always immediately bound when the library is loaded.)</p>
  </dd>
  <dt>
    <p><strong>RTLD_NOW</strong></p>
  </dt>
  <dd>
    <p>If this value is specified, or the environment variable <strong>LD_BIND_NOW</strong> is set to a nonempty string, all undefined symbols in the library are resolved before <strong>dlopen</strong>() returns. If this cannot be done, an error is returned.</p>
  </dd>

</dl>
<p>Zero or more of the following values may also be ORed in <em>flag</em>:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>RTLD_GLOBAL</strong></p>
  </dt>
  <dd>
    <p>The symbols defined by this library will be made available for symbol resolution of subsequently loaded libraries.</p>
  </dd>
  <dt>
    <p><strong>RTLD_LOCAL</strong></p>
  </dt>
  <dd>
    <p>This is the converse of <strong>RTLD_GLOBAL</strong>, and the default if neither flag is specified. Symbols defined in this library are not made available to resolve references in subsequently loaded libraries.</p>
  </dd>
  <dt>
    <p><strong>RTLD_NODELETE</strong> (since glibc 2.2)</p>
  </dt>
  <dd>
    <p>Do not unload the library during <strong>dlclose</strong>(). Consequently, the library's static variables are not reinitialized if the library is reloaded with <strong>dlopen</strong>() at a later time. This flag is not specified in POSIX.1-2001.</p>
  </dd>
  <dt>
    <p><strong>RTLD_NOLOAD</strong> (since glibc 2.2)</p>
  </dt>
  <dd>
    <p>Don't load the library. This can be used to test if the library is already resident (<strong>dlopen</strong>() returns NULL if it is not, or the library's handle if it is resident). This flag can also be used to promote the flags on a library that is already loaded. For example, a library that was previously loaded with <strong>RTLD_LOCAL</strong> can be reopened with <strong>RTLD_NOLOAD</strong>|<strong>RTLD_GLOBAL</strong>. This flag is not specified in POSIX.1-2001.</p>
  </dd>
  <dt>
    <p><strong>RTLD_DEEPBIND</strong> (since glibc 2.3.4)</p>
  </dt>
  <dd>
    <p>Place the lookup scope of the symbols in this library ahead of the global scope. This means that a self-contained library will use its own symbols in preference to global symbols with the same name contained in libraries that have already been loaded. This flag is not specified in POSIX.1-2001.</p>
  </dd>

</dl>
<p>If <em>filename</em> is NULL, then the returned handle is for the main program. When given to <strong>dlsym</strong>(), this handle causes a search for a symbol in the main program, followed by all shared libraries loaded at program startup, and then all shared libraries loaded by <strong>dlopen</strong>() with the flag <strong>RTLD_GLOBAL</strong>.</p><p>External references in the library are resolved using the libraries in that library's dependency list and any other libraries previously opened with the <strong>RTLD_GLOBAL</strong> flag. If the executable was linked with the flag "-rdynamic" (or, synonymously, "--export-dynamic"), then the global symbols in the executable will also be used to resolve references in a dynamically loaded library.</p><p>If the same library is loaded again with <strong>dlopen</strong>(), the same library handle is returned. The dl library maintains reference counts for library handles, so a dynamic library is not deallocated until <strong>dlclose</strong>() has been called on it as many times as <strong>dlopen</strong>() has succeeded on it. The <strong>_init</strong>() routine, if present, is called only once. But a subsequent call with <strong>RTLD_NOW</strong> may force symbol resolution for a library earlier loaded with <strong>RTLD_LAZY</strong>.</p><p>If <strong>dlopen</strong>() fails for any reason, it returns NULL.</p>
<h3>dlsym()</h3>
<p>The function <strong>dlsym</strong>() takes a "handle" of a dynamic library returned by <strong>dlopen</strong>() and the null-terminated symbol name, returning the address where that symbol is loaded into memory. If the symbol is not found, in the specified library or any of the libraries that were automatically loaded by <strong>dlopen</strong>() when that library was loaded, <strong>dlsym</strong>() returns NULL. (The search performed by <strong>dlsym</strong>() is breadth first through the dependency tree of these libraries.) Since the value of the symbol could actually be NULL (so that a NULL return from <strong>dlsym</strong>() need not indicate an error), the correct way to test for an error is to call <strong>dlerror</strong>() to clear any old error conditions, then call <strong>dlsym</strong>(), and then call <strong>dlerror</strong>() again, saving its return value into a variable, and check whether this saved value is not NULL.</p><p>There are two special pseudo-handles, <strong>RTLD_DEFAULT</strong> and <strong>RTLD_NEXT</strong>. The former will find the first occurrence of the desired symbol using the default library search order. The latter will find the next occurrence of a function in the search order after the current library. This allows one to provide a wrapper around a function in another shared library.</p>
<h3>dlclose()</h3>
<p>The function <strong>dlclose</strong>() decrements the reference count on the dynamic library handle <em>handle</em>. If the reference count drops to zero and no other loaded libraries use symbols in it, then the dynamic library is unloaded.</p><p>The function <strong>dlclose</strong>() returns 0 on success, and nonzero on error.</p>
<h3>The obsolete symbols _init() and _fini()</h3>
<p>The linker recognizes special symbols <strong>_init</strong> and <strong>_fini</strong>. If a dynamic library exports a routine named <strong>_init</strong>(), then that code is executed after the loading, before <strong>dlopen</strong>() returns. If the dynamic library exports a routine named <strong>_fini</strong>(), then that routine is called just before the library is unloaded. In case you need to avoid linking against the system startup files, this can be done by using the <strong>gcc</strong>(1) <em>-nostartfiles</em> command-line option.</p><p>Using these routines, or the gcc <strong>-nostartfiles</strong> or <strong>-nostdlib</strong> options, is not recommended. Their use may result in undesired behavior, since the constructor/destructor routines will not be executed (unless special measures are taken).</p><p>Instead, libraries should export routines using the <strong>__attribute__((constructor))</strong> and <strong>__attribute__((destructor))</strong> function attributes. See the gcc info pages for information on these. Constructor routines are executed before <strong>dlopen</strong>() returns, and destructor routines are executed before <strong>dlclose</strong>() returns.</p>
<h3>Glibc extensions: dladdr() and dlvsym()</h3>
<p>Glibc adds two functions not described by POSIX, with prototypes</p>
<pre>
<strong>#define _GNU_SOURCE</strong>         /* See <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a> */
<strong>#include &lt;dlfcn.h&gt;</strong>

<strong>int dladdr(void *</strong><em>addr</em><strong>, Dl_info *</strong><em>info</em><strong>);</strong>

<strong>void *dlvsym(void *</strong><em>handle</em><strong>, char *</strong><em>symbol</em><strong>, char *</strong><em>version</em><strong>);</strong>
</pre>
<p>The function <strong>dladdr</strong>() takes a function pointer and tries to resolve name and file where it is located. Information is stored in the <em>Dl_info</em> structure:</p>
<pre>
typedef struct {
    const char *dli_fname;  /* Pathname of shared object that
                               contains address */
    void       *dli_fbase;  /* Address at which shared object
                               is loaded */
    const char *dli_sname;  /* Name of symbol whose definition
                               overlaps <em>addr</em> */
    void       *dli_saddr;  /* Exact address of symbol named
                               in <em>dli_sname</em> */
} Dl_info;
</pre>
<p>If no symbol matching <em>addr</em> could be found, then <em>dli_sname</em> and <em>dli_saddr</em> are set to NULL.</p><p><strong>dladdr</strong>() returns 0 on error, and nonzero on success.</p><p>The function <strong>dlvsym</strong>(), provided by glibc since version 2.1, does the same as <strong>dlsym</strong>() but takes a version string as an additional argument.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>POSIX.1-2001 describes <strong>dlclose</strong>(), <strong>dlerror</strong>(), <strong>dlopen</strong>(), and <strong>dlsym</strong>().</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>The symbols <strong>RTLD_DEFAULT</strong> and <strong>RTLD_NEXT</strong> are defined by <em>&lt;dlfcn.h&gt;</em> only when <strong>_GNU_SOURCE</strong> was defined before including it.</p><p>Since glibc 2.2.3, <a href="../man3/atexit.3.html"><strong>atexit</strong>(3)</a> can be used to register an exit handler that is automatically called when a library is unloaded.</p><h3>History</h3>
<p>The dlopen interface standard comes from SunOS. That system also has <strong>dladdr</strong>(), but not <strong>dlvsym</strong>().</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Sometimes, the function pointers you pass to <strong>dladdr</strong>() may surprise you. On some architectures (notably i386 and x86_64), <em>dli_fname</em> and <em>dli_fbase</em> may end up pointing back at the object from which you called <strong>dladdr</strong>(), even if the function used as an argument should come from a dynamically linked library.</p><p>The problem is that the function pointer will still be resolved at compile time, but merely point to the <em>plt</em> (Procedure Linkage Table) section of the original object (which dispatches the call after asking the dynamic linker to resolve the symbol). To work around this, you can try to compile the code to be position-independent: then, the compiler cannot prepare the pointer at compile time anymore and today's <strong>gcc</strong>(1) will generate code that just loads the final symbol address from the <em>got</em> (Global Offset Table) at run time before passing it to <strong>dladdr</strong>().</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Load the math library, and print the cosine of 2.0:</p>
<pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;dlfcn.h&gt;

int
main(int argc, char **argv)
{
    void *handle;
    double (*cosine)(double);
    char *error;

    handle = dlopen("libm.so", RTLD_LAZY);
    if (!handle) {
        fprintf(stderr, "%s&#92;n", dlerror());
        exit(EXIT_FAILURE);
    }

    dlerror();    /* Clear any existing error */

    cosine = (double (*)(double)) dlsym(handle, "cos");

    /* According to the ISO C standard, casting between function
       pointers and 'void *', as done above, produces undefined results.
       POSIX.1-2003 and POSIX.1-2008 accepted this state of affairs and
       proposed the following workaround:

           *(void **) (&cosine) = dlsym(handle, "cos");

       This (clumsy) cast conforms with the ISO C standard and will
       avoid any compiler warnings.

       The 2013 Technical Corrigendum to POSIX.1-2008 (a.k.a.
       POSIX.1-2013) improved matters by requiring that conforming
       implementations support casting 'void *' to a function pointer.
       Nevertheless, some compilers (e.g., gcc with the '-pedantic'
       option) may complain about the cast used in this program. */

    error = dlerror();
    if (error != NULL) {
        fprintf(stderr, "%s&#92;n", error);
        exit(EXIT_FAILURE);
    }

    printf("%f&#92;n", (*cosine)(2.0));
    dlclose(handle);
    exit(EXIT_SUCCESS);
}
</pre>
<p>If this program were in a file named "foo.c", you would build the program with the following command:</p>
<pre>
    gcc -rdynamic -o foo foo.c -ldl
</pre>
<p>Libraries exporting <strong>_init</strong>() and <strong>_fini</strong>() will want to be compiled as follows, using <em>bar.c</em> as the example name:</p>
<pre>
    gcc -shared -nostartfiles -o bar bar.c
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dlclose&hellip;</h2>
        <div class="sectioncontent">
<p><strong>ld</strong>(1), <a href="../man1/ldd.1.html"><strong>ldd</strong>(1)</a>, <a href="../man1/pldd.1.html"><strong>pldd</strong>(1)</a>, <a href="../man3/dl_iterate_phdr.3.html"><strong>dl_iterate_phdr</strong>(3)</a>, <a href="../man7/rtld-audit.7.html"><strong>rtld-audit</strong>(7)</a>, <a href="../man8/ld.so.8.html"><strong>ld.so</strong>(8)</a>, <a href="../man8/ldconfig.8.html"><strong>ldconfig</strong>(8)</a></p><p>ld.so info pages, gcc info pages, ld info pages</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of release 3.74 of the Linux <em>man-pages</em> project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at http://www.kernel.org/doc/man-pages/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dlauum.f.3.html"><span aria-hidden="true">&larr;</span> dlauum.f.3: Dlauum.f -</a></li>
   <li class="next"><a href="dlerror.3.html">dlerror.3: Programming interface to dynamic linking loader <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
