<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>xpanew: Create a new \s-1xpa\s0 access point</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Create a new \s-1xpa\s0 access point">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="xpanew (3) manual">
  <meta name="twitter:description" content="Create a new \s-1xpa\s0 access point">
  <meta name="twitter:image" content="https://www.carta.tech/images/libxpa-dev-xpanew-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/xpanew.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="xpanew (3) manual" />
  <meta property="og:description" content="Create a new \s-1xpa\s0 access point" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libxpa-dev-xpanew-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">xpanew<small> (3)</small></h1>
        <p class="lead">Create a new \s-1xpa\s0 access point</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/xpanew.3.html">
      <span itemprop="name">xpanew: Create a new \s-1xpa\s0 access point</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libxpa-dev/">
      <span itemprop="name">libxpa-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/xpanew.3.html">
      <span itemprop="name">xpanew: Create a new \s-1xpa\s0 access point</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  #include &lt;xpa.h&gt;

  XPA XPANew(char *class, char *name, char *help,
             int (*send_callback)(),
             void *send_data, char *send_mode,
             int (*rec_callback)(),
             void *rec_data,  char *rec_mode);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Create a new \s-1XPA\s0 public access point with the class:name identifier template and enter this access point into the \s-1XPA\s0 name server, so that it can be accessed by external processes. <em>XPANew()</em> returns an \s-1XPA\s0 struct. Note that the length of the class and name designations must be less than or equal to 1024 characters each.</p><p>The \s-1XPA\s0 name server daemon, xpans, will be started automatically if it is not running already (assuming it can be found in the path).  The program's ip address and listening port are specified by the environment variable \s-1XPA_NSINET\s0, which takes the form :.  If no such environment variable exists, then xpans is started on the current machine listening on port 14285.  It also uses 14286 as a known port for its public access point (so that routines do not have to go to the name server to find the name server ip and port!) As of \s-1XPA\s0 2.1.1, version information is exchanged between the xpans process and the new access point. If the access point uses an \s-1XPA\s0 major/minor version newer than xpans, a warning is issued by both processes, since mixing of new servers and old xpa programs (xpaset, xpaget, xpans, etc.) is not likely to work. You can turn off the warning message by setting the \s-1XPA_VERSIONCHECK\s0 environment variable to \*(L"false\*(R".</p><p>The help string is meant to be returned by a request from xpaget:</p><p>  xpaget class:name \-help</p><p>A send_callback and/or a receive_callback can be specified; at least one of them must be specified.</p><p>A send_callback can be specified that will be executed in response to an external request from the xpaget program, the <em>XPAGet()</em> routine, or <em>XPAGetFd()</em> routine. This callback is used to send data to the requesting client.</p><p>The calling sequence for <em>send_callback()</em> is:</p><p>  int send_callback(void *send_data, void *call_data,     char *paramlist, char **buf, size_t *len)   {     XPA xpa = (XPA)call_data;     ...     return(stat);   }</p><p>The send_mode string is of the form: \*(L"key1=value1,key2=value2,...\*(R" The following keywords are recognized:</p><p>  key           value           default         explanation   ------        --------        --------        -----------   acl           true/false      true            enable access control   freebuf       true/false      true            free buf after callback completes</p><p>The call_data should be recast to the \s-1XPA\s0 struct as shown.  In addition, client-specific data can be passed to the callback in send_data.</p><p>The paramlist will be supplied by the client as qualifying parameters for the callback.  There are two ways in which the <em>send_callback()</em> routine can send data back to the client:</p><p>1. The <em>send_callback()</em> routine can fill in a buffer and pass back a pointer to this buffer. An integer len also is returned to specify the number of bytes of data in buf.  \s-1XPA\s0 will send this buffer to the client after the callback is complete.</p><p>2. The send_callback can send data directly to the client by writing to the fd pointed by the macro:</p><p>  xpa_datafd(xpa)</p><p>Note that this fd is of the kind returned by <em>socket()</em> or <em>open()</em>.</p><p>If a buf has been allocated by a standard malloc routine, filled, and returned to \s-1XPA\s0, then freebuf generally is set so that the buffer will be freed automatically when the callback is completed and data has been sent to the client.  If a static buf is returned, freebuf should be set to false to avoid a system error when freeing static storage. Note that default value for freebuf implies that the callback will allocate a buffer rather than use static storage.</p><p>On the other hand, if buf is dynamically allocated using a method other than a standard malloc/calloc/realloc routine (e.g. using Perl's memory allocation and garbage collection scheme), then it is necessary to tell \s-1XPA\s0 how to free the allocated buffer. To do this, use the <em>XPASetFree()</em> routine within your callback:</p><p>  void XPASetFree(XPA xpa, void (*myfree)(void *), void *myfree_ptr);</p><p>The first argument is the usual \s-1XPA\s0 handle. The second argument is the special routine to call to free your allocated memory. The third argument is an optional pointer.  If not \s-1NULL\s0, the specified free routine is called with that pointer as its sole argument. If \s-1NULL\s0, the free routine is called with the standard buf pointer as its sole argument. This is useful in cases where there is a mapping between the buffer pointer and the actual allocated memory location, and the special routine is expecting to be passed the former.</p><p>If, while the callback performs its processing, an error occurs that should be communicated to the client, then the routine XPAError should be called:</p><p>  XPAError(XPA xpa, char *s);</p><p>where s is an arbitrary error message.  The returned error message string will be of the form:</p><p>  XPA$ERROR   [error] (class:name ip:port)</p><p>If the callback wants to send a specific acknowledgment message back to the client, the routine XPAMessage can be called:</p><p>  XPAMessage(XPA xpa, char *s);</p><p>where s is an arbitrary error message.  The returned error message string will be of the form:</p><p>  XPA$MESSAGE [message] (class:name ip:port)</p><p>Otherwise, a standard acknowledgment is sent back to the client after the callback is completed.</p><p>The callback routine should return 0 if no error occurs, or \-1 to signal an error.</p><p>A receive_callback can be specified that will be executed in response to an external request from the xpaset program, or the XPASet (or <em>XPASetFd()</em>) routine. This callback is used to process data received from an external process.</p><p>The calling sequence for receive_callback is:</p><p>  int receive_callback(void *receive_data, void *call_data,     char *paramlist, char *buf, size_t len)   {     XPA xpa = (XPA)call_data;     ...     return(stat);   }</p><p>The mode string is of the form: \*(L"key1=value1,key2=value2,...\*(R" The following keywords are recognized:</p><p>  key           value           default         explanation   ------        --------        --------        -----------   acl           true/false      true            enable access control   buf           true/false      true            server expects data bytes from client   fillbuf       true/false      true            read data into buf before executing callback   freebuf       true/false      true            free buf after callback completes</p><p>The call_data should be recast to the \s-1XPA\s0 struct as shown.  In addition, client-specific data can be passed to the callback in receive_data.</p><p>The paramlist will be supplied by the client. In addition, if the receive_mode keywords buf and fillbuf are true, then on entry into the <em>receive_callback()</em> routine, buf will contain the data sent by the client. If buf is true but fillbuf is false, it becomes the callback's responsibility to retrieve the data from the client, using the data fd pointed to by the macro xpa_datafd(xpa).  If freebuf is true, then buf will be freed when the callback is complete.</p><p>If, while the callback is performing its processing, an error occurs that should be communicated to the client, then the routine XPAError can be called:</p><p>  XPAError(XPA xpa, char *s);</p><p>where s is an arbitrary error message.</p><p>The callback routine should return 0 if no error occurs, or \-1 to signal an error.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO xpanew&hellip;</h2>
        <div class="sectioncontent">
<p>See <a href="../man7/xpa.7.html"><strong>xpa</strong>(7)</a> for a list of \s-1XPA\s0 help pages</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="xpamainloop.3.html"><span aria-hidden="true">&larr;</span> xpamainloop.3: Optional main loop for \s-1xpa\s0</a></li>
   <li class="next"><a href="xpanslookup.3.html">xpanslookup.3: Lookup registered \s-1xpa\s0 access points <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
