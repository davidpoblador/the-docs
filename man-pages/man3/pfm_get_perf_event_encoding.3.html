<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pfm_get_perf_event_encoding: Encode event for perf_event api</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Encode event for perf_event api">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pfm_get_perf_event_encoding<small> (3)</small></h1>
        <p class="lead">Encode event for perf_event api</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pfm_get_perf_event_encoding.3.html">
      <span itemprop="name">pfm_get_perf_event_encoding: Encode event for perf_event api</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/perfmon2/">
      <span itemprop="name">perfmon2</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/pfm_get_perf_event_encoding.3.html">
      <span itemprop="name">pfm_get_perf_event_encoding: Encode event for perf_event api</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre><strong>#include &lt;perfmon/pfmlib_perf_event.h&gt;</strong>

<strong>int pfm_get_perf_event_encoding(const char *</strong><em>str</em><strong>, int </strong><em>dfl_plm</em><strong>, struct perf_event_attr *</strong><em>attr</em><strong>, char **</strong><em>fstr</em><strong>, int *</strong><em>idx</em><strong>);</strong>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>This function can be used in conjunction with the perf_events Linux kernel API which provides access to hardware performance counters, kernel software counters and tracepoints. The function takes an event string in <strong>str</strong> and a default privilege level mask in <strong>dfl_plm</strong> and fills out the relevant parts of the perf_events specific data structure in <strong>attr</strong>.</p>
<p class='spacer'>

<p>This function is <strong>deprecated</strong>. It is superseded by <strong>pfm_get_os_event_encoding()</strong> with the OS argument set to either <strong>PFM_OS_PERF_EVENT</strong> or <strong>PFM_OS_PERF_EVENT_EXT</strong>. Using this function provides extended support for perf_events. Certain perf_event configuration option are only available through this new interface.</p>
<p class='spacer'>

<p>The following examples illustrates the transition:</p>
<p class='spacer'>

<pre>   struct perf_event_attr attr;
   int i, count = 0;
   uint64_t *codes;

   memset(&attr, 0, sizeof(attr));

   ret = pfm_get_perf_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, &attrs, NULL, NULL);
   if (ret != PFM_SUCCESS)
      err(1", cannot get encoding %s", pfm_strerror(ret));
</pre>

<p class='spacer'>

<p>is equivalent to:</p>
<p class='spacer'>

    <dl class='dl-vertical'>
      <dt><strong>PFM_PLM3</strong></dt>
      <dd>
      <dt><strong>PFM_PLM2</strong></dt>
      <dd>
      <dt><strong>PFM_PLM1</strong></dt>
      <dd>
      <dt><strong>PFM_PLM0</strong></dt>
      <dd>
      <dt><strong>PFM_PLMH</strong></dt>
      <dd>
    <dl class='dl-vertical'>
      <dt><strong>type</strong></dt>
      <dd>
      <dt><strong>config</strong></dt>
      <dd>
      <dt><strong>exclude_user</strong></dt>
      <dd>
      <dt><strong>exclude_kernel</strong></dt>
      <dd>
      <dt><strong>exclude_hv</strong></dt>
      <dd>
<pre>   #include &lt;perfmon/pfmlib_perf_event.h&gt;
   struct perf_event_attr attr;
   pfm_perf_encode_arg_t arg;

   memset(&arg, 0, sizeof(arg));
   arg.size = sizeof(arg);
   arg.attr = &attr;

   ret = pfm_get_os_event_encoding("RETIRED_INSTRUCTIONS", PFM_PLM3, PFM_OS_PERF, &arg);
   if (ret != PFM_SUCCESS)
      err(1", cannot get encoding %s", pfm_strerror(ret));



The <strong>dfl_plm</strong> cannot be zero, though it may not necessarily be used by the event.
Depending on the event, combination of the following privilege levels may be used:
Measure at privilege level 3. This usually corresponds to user level. On X86, it corresponds
to privilege levels 3, 2, 1. Check the PMU specific man page to verify if this level
is supported by your PMU model.
</dd>
Measure at privilege level 2. Check the PMU specific man page to verify if this level
is supported by your PMU model.
</dd>
Measure at privilege level 1. Check the PMU specific man page to verify if this level
is supported by your PMU model.
</dd>
Measure at privilege level 0. This usually corresponds to kernel level. Check the PMU
specific man page to verify if this level is supported by your PMU model.
</dd>
Measure at hypervisor privilege level. This is used in conjunction with hardware virtualization.
Check the PMU specific man page to verify if this level is supported by your PMU model.
</dd>
</dl>


If <strong>fstr</strong> is not NULL, the function will make it point to the fully qualified event string,
i.e., a string with the event name, all unit masks set, and the value of all modifiers.
The library will allocate memory to store the event string but it is the responsibility of the
caller to eventually free that string using free().

If <strong>idx</strong> is not NULL, it returns the corresponding unique event identifier.

Only select fields are modified by the function, the others are untouched.
The following fields in <strong>attr</strong> are modified:
The type of the event
</dd>
The encoding of the event
</dd>
Whether or not user level execution should be excluded from monitoring. The definition
of user is PMU model specific.
</dd>
Whether or not kernel level execution should be excluded from monitoring. The definition
of kernel is PMU model specific.
</dd>
Whether or not hypervisor level execution should be excluded from monitoring. The definition
of hypervisor is PMU model specific.
</dd>
</dl>

By default, if no privilege level modifier is specified in the event string, the library clears
<strong>exclude_user</strong>, <strong>exclude_kernel</strong> and <strong>exclude_hv</strong>, resulting in the event being
measured at all levels subject to hardware support.

The function is able to work on only one event at a time. For convenience, it accepts
event strings with commas. In that case, it will translate the first event up to the
first comma. This is handy in case tools gets passed events as a comma-separated list.
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN</h2>
        <div class="sectioncontent">

<p>The function returns in <strong>attr</strong> the perf_event encoding which corresponds to the event string. If <strong>idx</strong> is not NULL, then it will contain the unique event identifier upon successful return. The value <strong>PFM_SUCCESS</strong> is returned if successful, otherwise a negative error code is returned.</p>
<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt><strong>PFM_ERR_TOOSMALL</strong></dt>
    <dd>
  <p>The <strong>code</strong> argument is too small for the encoding.</p>
    </dd>
    <dt><strong>PFM_ERR_INVAL</strong></dt>
    <dd>
  <p>The <strong>attr</strong> argument is <strong>NULL</strong>.</p>
    </dd>
    <dt><strong>PFM_ERR_NOMEM</strong></dt>
    <dd>
  <p>Not enough memory.</p>
    </dd>
    <dt><strong>PFM_ERR_NOTFOUND</strong></dt>
    <dd>
  <p>Event not found.</p>
    </dd>
    <dt><strong>PFM_ERR_ATTR</strong></dt>
    <dd>
  <p>Invalid event attribute (unit mask or modifier)</p>
    </dd>
    <dt><strong>PFM_ERR_ATTR_VAL</strong></dt>
    <dd>
  <p>Invalid modifier value.</p>
    </dd>
    <dt><strong>PFM_ERR_ATTR_SET</strong></dt>
    <dd>
  <p>attribute already set, cannot be changed.</p>
    </dd>
    <dt><strong>PFM_ERR_ATTR_UMASK</strong></dt>
    <dd>
  <p>Missing unit mask.</p>
    </dd>
    <dt><strong>PFM_ERR_ATTR_FEATCOMB</strong></dt>
    <dd>
  <p>Unit masks or features cannot be combined into a single event.</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<p>Stephane Eranian &lt;eranian@gmail.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pfm_get_perf_event_encoding&hellip;</h2>
        <div class="sectioncontent">

<a href="../man3/pfm_get_os_event_encoding.3.html"><strong>pfm_get_os_event_encoding</strong>(3)</a></p>
        </div>
      </section>

<nav>
  <ul class="pager">
   <li class="previous"><a href="pfm_get_os_event_encoding.3.html"><span aria-hidden="true">&larr;</span> pfm_get_os_event_encoding.3: Get event encoding for a specific operating system</a></li>
   <li class="next"><a href="pfm_get_pmu_info.3.html">pfm_get_pmu_info.3: Get pmu information <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
