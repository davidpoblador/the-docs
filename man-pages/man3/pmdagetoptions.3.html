<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmdagetoptions - get options from arguments, parsing generic PMDA options</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Get options from arguments, parsing generic pmda options">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmdagetoptions<small> (3)</small></h1>
        <p class="lead">Get options from arguments, parsing generic pmda options</p>
      </div>

    <ol class="breadcrumb">
	<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_section">
		<a itemprop="url" href="https://www.carta.tech/man-pages/"><span itemprop="title">Linux Man Pages</span></a>
	</li>
	<li id="breadcrumb_section" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb_page" itemprop="child">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man3/"><span itemprop="title">Library calls</span></a>
	</li>
	<li id="breadcrumb_page" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="active">
		<a itemprop="url" href="https://www.carta.tech/man-pages/man3/pmdagetoptions.3.html"><span itemprop="title">pmdagetoptions</span></a>
	</li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">C SYNOPSIS</h2>
        <div class="sectioncontent">

<p>#include &lt;pcp/pmapi.h&gt;</p>
<p class='spacer'>

<p>#include &lt;pcp/impl.h&gt;</p>
<p class='spacer'>

<p>#include &lt;pcp/pmda.h&gt;</p>
<p class='spacer'>

<p>int pmdaGetOptions(int <em>argc</em>, char *const *<em>argv</em>, pmdaOptions *<em>opts</em>, pmdaInterface&nbsp;*<em>dispatch</em>);</p>
<p class='spacer'>

<p>int pmdaGetOpt(int <em>argc</em>, char *const *<em>argv</em>, const&nbsp;char&nbsp;*<em>optstring</em>, pmdaInterface&nbsp;*<em>dispatch</em>, int&nbsp;*<em>err</em>);</p>
<p class='spacer'>

<p>cc ... -lpcp_pmda -lpcp</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>These functions are wrappers for <strong>pmgetopt_r</strong>(3). The behavior of each function is that certain options are assumed to have a predefined behavior which initializes several fields in the <strong>pmdaInterface</strong> structure. The <strong>pmdaGetOptions</strong> interface allows both short and long options to be given, whereas <strong>pmdaGetOpt</strong> allows for short form options only.</p>
<p class='spacer'>

  <p>The options that both <strong>pmdaGetOptions</strong> and <strong>pmdaGetOpt</strong> will trap are:</p>
  <dl class='dl-vertical'>
    <dt><strong>-D</strong><em>trace</em></dt>
    <dd>
  <p>Set the <strong>PMAPI</strong>(3) debug control variable (<strong>pmDebug</strong>) to <em>trace</em>. Used for controlling levels of trace output while debugging.</p>
    </dd>
    <dt><strong>-d</strong><em>domain</em></dt>
    <dd>
  <p>Set the <em>domain</em> number of this agent.</p>
    </dd>
    <dt><strong>-h</strong><em>helpfile</em></dt>
    <dd>
  <p>Obtain the help text (see <strong>pmdaText</strong>(3)) for the metrics from this file rather than from the path specified with <strong>pmdaDSO</strong>(3) or <strong>pmdaDaemon</strong>(3).</p>
    </dd>
    <dt><strong>-i</strong><em>port</em></dt>
    <dd>
  <p>Expect PMCD to connect on inet <em>port</em> (number or name).</p>
    </dd>
    <dt><strong>-6</strong><em>port</em></dt>
    <dd>
  <p>Expect PMCD to connect on ipv6 <em>port</em> (number or name).</p>
    </dd>
    <dt><strong>-l</strong><em>logfile</em></dt>
    <dd>
  <p>Redirect diagnostics and trace output to <em>logfile</em>.</p>
    </dd>
    <dt><strong>-p</strong></dt>
    <dd>
  <p>Expect PMCD to supply stdin/stdout pipe.</p>
    </dd>
    <dt><strong>-u</strong><em>socket</em></dt>
    <dd>
  <p>Expect PMCD to connect on unix domain <em>socket</em>.</p>
    </dd>
  </dl>
<p class='spacer'>

  <p>The <strong>pmdaGetOptions</strong> interface will also capture the following options, and store them within the <em>opts</em> parameter:</p>
  <dl class='dl-vertical'>
    <dt><strong>-U</strong><em>username</em></dt>
    <dd>
  <p>Set the user account name under which the PMDA should execute.</p>
    </dd>
  </dl>
<p class='spacer'>

<p>Only one of <strong>-i</strong>, <strong>-6</strong>, <strong>-p</strong> and <strong>-u</strong> may be specified.  If none of these three options is given, a pipe (<strong>-p</strong>) is assumed.  When these options are encountered by <strong>pmdaGetOpt</strong>, the option is processed and the next option is examined.  Therefore, <strong>pmdaGetOpt</strong> will only return when an option other than those listed above is found, or the end of the list is reached.  The returned value will be the argument or EOF, respectively.</p>
<p class='spacer'>

<p>A PMDA can control which of these options the program will accept with either the <em>opts</em> or <em>optstring</em> argument.  To accept all the options, the PMDA should call <strong>pmdaGetOptions</strong> with the short_options field of the <em>opts</em> structure set to the PMDA_OPTIONS macro, or <strong>pmdaGetOpt</strong> with the option string "D:d:h:i:l:pu:". Any PMDA specific options should be added to these strings in the style of <a href="../man3/getopt.3.html"><strong>getopt</strong>(3)</a>, and will be returned by both <strong>pmdaGetOptions</strong> and <strong>pmdaGetOpt</strong> if encountered.</p>
<p class='spacer'>

<p>When a command line option usage error is detected in the <strong>pmdaGetOptions</strong> interface, the error field of the <em>opts</em> structure will contain a non-zero error count.</p>
<p class='spacer'>

<p><strong>pmdaGetOpt</strong> takes a pointer to an int, <em>err</em>, which is used as an error count.  This variable should be initialized to zero before <strong>pmdaGetOpt</strong> is first called, and tested when <strong>pmdaGetOpt</strong> returns EOF.</p>
<p class='spacer'>

<p>Neither <strong>pmdaGetOptions</strong> nor <strong>pmdaGetOpt</strong> modify their <em>argc</em> or <em>argv</em> parameters.</p>
<p class='spacer'>

<p>The global variables used by the system <strong>getopt (3)</strong> interface may also be used by the caller of <strong>pmdaGetOpt</strong> within the argument parsing loop.</p>
<p class='spacer'>

<p>On the other hand, the <strong>pmdaGetOptions</strong> interface does not utilize global variables at all (neither reading nor modifying them). Instead, these variables can be access via the <em>opts</em> fields of the same name.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">

<p>Both <strong>pmdaGetOptions</strong> and <strong>pmdaGetOpt</strong> will display the same error messages as <strong>getopt</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEAT</h2>
        <div class="sectioncontent">

<p>The options <strong>-D</strong>, <strong>-d</strong>, <strong>-i</strong>, <strong>-l</strong>, <strong>-p</strong> and <strong>-u</strong> cannot be reused for other purposes by the PMDA, unless using the <em>override</em> method provided by the <strong>pmdaGetOptions</strong> interface, which operates in the same way as described for the <strong>pmGetOptions</strong>(3) interface used by PMAPI client tools.</p>
<p class='spacer'>

<p>The PMDA must be using <strong>PMDA_INTERFACE_2</strong> or later, as specified in the call to <strong>pmdaDSO</strong>(3) or <strong>pmdaDaemon</strong>(3).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><a href="../man1/pmdbg.1.html"><strong>pmdbg</strong>(1)</a>, <a href="../man3/getopt.3.html"><strong>getopt</strong>(3)</a>, <strong>pmgetopt_r</strong>(3), <strong>pmGetOptions</strong>(3), <strong>PMAPI</strong>(3), <strong>PMDA</strong>(3), <strong>pmdaDaemon</strong>(3), <strong>pmdaDSO</strong>(3) and <strong>pmdaText</strong>(3).</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmdafetch.3.html"><span aria-hidden="true">&larr;</span> pmdafetch.3: fill a pmResult structure with the requested metric values</a></li>
   <li class="next"><a href="pmdahelp.3.html">pmdahelp.3: help text support for a PMDA <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
