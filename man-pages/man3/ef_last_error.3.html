<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ef_last_error: Expand filenames containing ~user/$envvar and wildcard expressions</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Expand filenames containing ~user/$envvar and wildcard expressions">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ef_last_error (3) manual">
  <meta name="twitter:description" content="Expand filenames containing ~user/$envvar and wildcard expressions">
  <meta name="twitter:image" content="https://www.carta.tech/images/libtecla-dev-ef_last_error-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/ef_last_error.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ef_last_error (3) manual" />
  <meta property="og:description" content="Expand filenames containing ~user/$envvar and wildcard expressions" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libtecla-dev-ef_last_error-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ef_last_error<small> (3)</small></h1>
        <p class="lead">Expand filenames containing ~user/$envvar and wildcard expressions</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ef_last_error.3.html">
      <span itemprop="name">ef_last_error: Expand filenames containing ~user/$envvar and wildcard expressions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libtecla-dev/">
      <span itemprop="name">libtecla-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/ef_last_error.3.html">
      <span itemprop="name">ef_last_error: Expand filenames containing ~user/$envvar and wildcard expressions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
#include &lt;libtecla.h&gt;

ExpandFile *new_ExpandFile(void);

ExpandFile *del_ExpandFile(ExpandFile *ef);

FileExpansion *ef_expand_file(ExpandFile *ef,
                              const char *path,
                              int pathlen);

int ef_list_expansions(FileExpansion *result, FILE *fp,
                       int term_width);

const char *ef_last_error(ExpandFile *ef);
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>ef_expand_file()</strong> function is part of the tecla library (see the <a href="../man3/libtecla.3.html"><strong>libtecla</strong>(3)</a> man page). It expands a specified filename, converting <strong>~user/</strong> and <strong>~/</strong> expressions at the start of the filename to the corresponding home directories, replacing <strong>$envvar</strong> with the value of the corresponding environment variable, and then, if there are any wildcards, matching these against existing filenames. Backslashes in the input filename are interpreted as escaping any special meanings of the characters that follow them. Only backslahes that are themselves preceded by backslashes are preserved in the expanded filename.</p><p>In the presence of wildcards, the returned list of filenames only includes the names of existing files which match the wildcards. Otherwise, the original filename is returned after expansion of tilde and dollar expressions, and the result is not checked against existing files. This mimics the file-globbing behavior of the unix <strong>tcsh</strong> shell.</p><p>The supported wildcards and their meanings are:</p>
<pre>
  *        -  Match any sequence of zero or more characters.
  ?        -  Match any single character.
  [chars]  -  Match any single character that appears in
              'chars'.  If 'chars' contains an expression of
              the form a-b, then any character between a and
              b, including a and b, matches. The '-'
              character looses its special meaning as a
              range specifier when it appears at the start
              of the sequence of characters. The ']'
              character also looses its significance as the
              terminator of the range expression if it
              appears immediately after the opening '[', at
              which point it is treated one of the
              characters of the range. If you want both '-'
              and ']' to be part of the range, the '-'
              should come first and the ']' second.

  [^chars] -  The same as [chars] except that it matches any
              single character that doesn't appear in
              'chars'.
</pre>
<p>Note that wildcards never match the initial dot in filenames that start with '.'. The initial '.' must be explicitly specified in the filename. This again mimics the globbing behavior of most unix shells, and its rational is based in the fact that in unix, files with names that start with '.' are usually hidden configuration files, which are not listed by default by the ls command.</p><p>The following is a complete example of how to use the file expansion function.</p>
<pre>
  #include &lt;stdio.h&gt;
  #include &lt;libtecla.h&gt;

  int main(int argc, char *argv[])
  {
    ExpandFile *ef;      /* The expansion resource object */
    char *filename;      /* The filename being expanded */
    FileExpansion *expn; /* The results of the expansion */
    int i;

    ef = new_ExpandFile();
    if(!ef)
      return 1;

    for(arg = *(argv++); arg; arg = *(argv++)) {
      if((expn = ef_expand_file(ef, arg, -1)) == NULL) {
        fprintf(stderr, "Error expanding %s (%s).&#92;n", arg,
                         ef_last_error(ef));
      } else {
        printf("%s matches the following files:&#92;n", arg);
        for(i=0; i&lt;expn-&gt;nfile; i++)
          printf(" %s&#92;n", expn-&gt;files[i]);
      }
    }

    ef = del_ExpandFile(ef);
    return 0;
  }
</pre>
<p>Descriptions of the functions used above are as follows:</p>
<pre>
  ExpandFile *new_ExpandFile(void)
</pre>
<p>This function creates the resources used by the <strong>ef_expand_file()</strong> function. In particular, it maintains the memory that is used to record the array of matching filenames that is returned by <strong>ef_expand_file()</strong>. This array is expanded as needed, so there is no built in limit to the number of files that can be matched.</p>
<pre>
  ExpandFile *del_ExpandFile(ExpandFile *ef)
</pre>
<p>This function deletes the resources that were returned by a previous call to <strong>new_ExpandFile()</strong>. It always returns <strong>NULL</strong> (ie a deleted object). It does nothing if the <strong>ef</strong> argument is <strong>NULL</strong>.</p><p>A container of the following type is returned by <strong>ef_expand_file()</strong>.</p>
<pre>
  typedef struct {
    int exists;   /* True if the files in files[] exist */
    int nfile;    /* The number of files in files[] */
    char **files; /* An array of 'nfile' filenames. */
  } FileExpansion;
</pre>

<pre>
  FileExpansion *ef_expand_file(ExpandFile *ef,
                                const char *path,
                                int pathlen)
</pre>
<p>The <strong>ef_expand_file()</strong> function performs filename expansion, as documented at the start of this section. Its first argument is a resource object returned by <strong>new_ExpandFile()</strong>. A pointer to the start of the filename to be matched is passed via the <strong>path</strong> argument. This must be a normal <strong>NUL</strong> terminated string, but unless a length of -1 is passed in <strong>pathlen</strong>, only the first <strong>pathlen</strong> characters will be used in the filename expansion.  If the length is specified as -1, the whole of the string will be expanded.</p><p>The function returns a pointer to a container who's contents are the results of the expansion. If there were no wildcards in the filename, the <strong>nfile</strong> member will be 1, and the <strong>exists</strong> member should be queried if it is important to know if the expanded file currently exists or not. If there were wildcards, then the contained <strong>files[]</strong> array will contain the names of the <strong>nfile</strong> existing files that matched the wildcarded filename, and the <strong>exists</strong> member will have the value 1. Note that the returned container belongs to the specified <strong>ef</strong> object, and its contents will change on each call, so if you need to retain the results of more than one call to <strong>ef_expand_file()</strong>, you should either make a private copy of the returned results, or create multiple file-expansion resource objects via multiple calls to <strong>new_ExpandFile()</strong>.</p><p>On error, <strong>NULL</strong> is returned, and an explanation of the error can be determined by calling <strong>ef_last_error(ef)</strong>.</p>
<pre>
  const char *ef_last_error(ExpandFile *ef)
</pre>
<p>This function returns the message which describes the error that occurred on the last call to <strong>ef_expand_file()</strong>, for the given <strong>(ExpandFile *ef)</strong> resource object.</p>
<pre>
  int ef_list_expansions(FileExpansion *result, FILE *fp,
                         int terminal_width);
</pre>
<p>The <strong>ef_list_expansions()</strong> function provides a convenient way to list the filename expansions returned by <strong>ef_expand_file()</strong>. Like the unix <strong>ls</strong> command, it arranges the filenames into equal width columns, each column having the width of the largest file. The number of columns used is thus determined by the length of the longest filename, and the specified terminal width. Beware that filenames that are longer than the specified terminal width are printed without being truncated, so output longer than the specified terminal width can occur. The list is written to the stdio stream specified by the <strong>fp</strong> argument.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">THREAD SAFETY</h2>
        <div class="sectioncontent">
<p>In multi-threaded programs, you should use the <strong>libtecla_r.a</strong> version of the library. This uses POSIX reentrant functions where available (hence the <strong>_r</strong> suffix), and disables features that rely on non-reentrant system functions. Currently there are no features disabled in this module.</p><p>Using the <strong>libtecla_r.a</strong> version of the library, it is safe to use the facilities of this module in multiple threads, provided that each thread uses a separately allocated <strong>ExpandFile</strong> object. In other words, if two threads want to do file expansion, they should each call <strong>new_ExpandFile()</strong> to allocate their own file-expansion objects.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<pre>
libtecla.a    -    The tecla library
libtecla.h    -    The tecla header file.
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ef_last_error&hellip;</h2>
        <div class="sectioncontent">

<pre>
<a href="../man3/libtecla.3.html"><strong>libtecla</strong>(3)</a>, <a href="../man3/gl_get_line.3.html"><strong>gl_get_line</strong>(3)</a>, <a href="../man3/cpl_complete_word.3.html"><strong>cpl_complete_word</strong>(3)</a>,
<a href="../man3/pca_lookup_file.3.html"><strong>pca_lookup_file</strong>(3)</a>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Martin Shepherd  (mcs@astro.caltech.edu)</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ef_expand_file.3.html"><span aria-hidden="true">&larr;</span> ef_expand_file.3: Expand filenames containing ~user/$envvar and wildcard expressions</a></li>
   <li class="next"><a href="ef_list_expansions.3.html">ef_list_expansions.3: Expand filenames containing ~user/$envvar and wildcard expressions <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
