<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dev_lock: Manage device lockfiles</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Manage device lockfiles">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dev_lock (3) manual">
  <meta name="twitter:description" content="Manage device lockfiles">
  <meta name="twitter:image" content="https://www.carta.tech/images/liblockdev1-dev-dev_lock-3.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man3/dev_lock.3.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dev_lock (3) manual" />
  <meta property="og:description" content="Manage device lockfiles" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/liblockdev1-dev-dev_lock-3.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dev_lock<small> (3)</small></h1>
        <p class="lead">Manage device lockfiles</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/">
      <span itemprop="name">Library calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dev_lock.3.html">
      <span itemprop="name">dev_lock: Manage device lockfiles</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/liblockdev1-dev/">
      <span itemprop="name">liblockdev1-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man3/dev_lock.3.html">
      <span itemprop="name">dev_lock: Manage device lockfiles</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;lockdev.h&gt;</strong></p><p><strong>pid_t dev_testlock( const char * </strong><em>devname</em><strong>);</strong></p><p><strong>pid_t dev_lock( const char * </strong><em>devname</em><strong>);</strong></p><p><strong>pid_t dev_relock( const char * </strong><em>devname</em><strong>, pid_t </strong><em>pid</em><strong>);</strong></p><p><strong>pid_t dev_unlock( const char * </strong><em>devname</em><strong>, pid_t </strong><em>pid</em><strong>);</strong></p><p><strong>cc [ </strong><em>flag</em><strong> ... ] </strong><em>file</em><strong> ... -llockdev [ </strong><em>library</em><strong> ] </strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>lockdev</strong> functions act on device locks normally located in <strong>/var/lock .</strong> The lock is acquired creating a pair of files hardlinked between them and named after the device name (as mandated by FSSTND) and the device's major and minor numbers (as in SVr4 locks). This permits to circumvent a problem using only the FSSTND lock method when the same device exists under different names (for convenience or when a device must be accessable by more than one group of users).</p><p>The lock file names are typically in the form <strong>LCK..ttyS1</strong> and <strong>LCK.004.065 ,</strong> but is provided a way to easily modify them to use the library on different architectures. The content of those files is the pid of the process who owns the lock.</p><p>The <strong>dev_testlock()</strong> function simply checks if the device is in some way locked and if the owner of the lock is still active (otherwise it removes the lock). It recognise a valid lock even if only one of the two lock files exists (and is owned by an existing process), thus permitting a safe use of this library together with programs using only FSSTND or SVr4 lock style.</p><p>The <strong>dev_lock()</strong> function first checks if the device is already locked and then tries to acquire the lock building the two lock files. First it creates the file which name contains the major and minor numbers (in SVr4 style), then it creates the file with the device name in its name. This order reduces the clashes with other processes trying to lock the same device (even with a different name) and using this library. It has no problem with processes that uses only the FSSTND algorithm.</p><p>The <strong>dev_relock()</strong> function changes the owner of an existing lock; if the pid of the old owner is provided, then it checks if the lock was correctly assigned (otherwise there is the possibility of a process acquiring a lock which was owned by another unrelated process). If the device was not locked, locks it.</p><p>The <strong>dev_unlock()</strong> function removes the existing locks on the device. If the pid of the owner of the lock is provided, then it checks if the lock is assigned to that process, avoiding to remove locks assigned to other existing processes.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUES</h2>
        <div class="sectioncontent">
<p>All the functions in <strong>lockdev</strong> library return <strong>ZERO</strong> on successfull completion of the function (dev_testlock returns zero if there is no lock on the device), otherwise, if the device is currently locked by an existing process, they return the pid of the process owner of the lock. They return a negative number when some kind of error happens. Actually they all return only (-1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEBUGGING</h2>
        <div class="sectioncontent">
<p>The <strong>API</strong> has symbols used only for debugging purposis</p><p><strong>int liblockdev_debug</strong></p><p><strong>void liblockdev_incr_debug( void );</strong></p><p><strong>void liblockdev_reset_debug( void );</strong></p><p>which can be used when the liblockdev library is compiled with <strong>-DDEBUG</strong> flag as when using <strong>make install-dbg ,</strong> which compiles a debug shared library and installs it under /usr/local/lib/debug (or /usr/lib/debug).</p><p>The value of the global integer is set to 1 by the DEBUG define, and can be set to a different value passing a flag like <strong>-DDEBUG=3</strong> during compilation of the library, or setting the environment variable <strong>LIBLOCKDEV_DEBUG</strong> to the wanted value before executing your program.</p><p>During execution of your program, the flag's value can be changed from your program or from another terminal, respectively using the function <strong>liblockdev_incr_debug() ,</strong> or sending SIGUSR1 to the running process, to increment the value of the integer by one, or using the function <strong>liblockdev_reset_debug() ,</strong> or sending SIGUSR2 to the running process, to set to zero the value of the global integer.</p><p>Direct manipulation of the global integer is strongly deprecated, because the data structure of the symbol (actually an integer) could be changed later in some way, or even become a macro.</p><p>The library prints on stdout some informations like error conditions (level of 1), normal termination conditions (2) or function calling (3).</p><p>To use the debug shared library, simply define in your environment the variable LD_LIBRARY_PATH=/usr/lib/debug (or /usr/local/lib/debug if built using make install-dbg) and call gdb or directly your program without any need to recompile it. As you can check with ldd, your program will load the debug library instead of the normal one.</p><p>Beware that if your program is setuid or setgid, you must become root to let this work, because ld.so ignores the LD_LIBRARY_PATH variable for security reasons.</p><p>On <strong>Debian GNU/Linux</strong> systems exists a debug binary package named <strong>liblockdev1-dbg</strong> which installs a shared library built with all debugging options (and the -DDEBUG flag) into /usr/lib/debug .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>/var/lock/LCK..&lt;device&gt;</p><p>/var/lock/LCK.&lt;major&gt;.&lt;minor&gt;</p><p>/usr/lib/liblockdev.so.1</p><p>/usr/lib/debug/liblockdev.so.1</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HISTORY</h2>
        <div class="sectioncontent">
<p>(c) 1997 by Fabrizio Polacco &lt;fab@prosa.it&gt;.</p><p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; version 2 dated June, 1991.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dettutorial.3.html"><span aria-hidden="true">&larr;</span> dettutorial.3: Density estimation tree (det) tutorial</a></li>
   <li class="next"><a href="dev_relock.3.html">dev_relock.3: Manage device lockfiles <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
