<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>madvise: Give advice about use of memory</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Give advice about use of memory">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="madvise (2) manual">
  <meta name="twitter:description" content="Give advice about use of memory">
  <meta name="twitter:image" content="https://www.carta.tech/images/manpages-dev-madvise-2.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man2/madvise.2.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="madvise (2) manual" />
  <meta property="og:description" content="Give advice about use of memory" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/manpages-dev-madvise-2.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">madvise<small> (2)</small></h1>
        <p class="lead">Give advice about use of memory</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/">
      <span itemprop="name">System calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/madvise.2.html">
      <span itemprop="name">madvise: Give advice about use of memory</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/manpages-dev/">
      <span itemprop="name">manpages-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/madvise.2.html">
      <span itemprop="name">madvise: Give advice about use of memory</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>#include &lt;sys/mman.h&gt;</strong></p><p><strong>int madvise(void *</strong><em>addr</em><strong>, size_t </strong><em>length</em><strong>, int </strong><em>advice</em><strong>);</strong></p><p>Feature Test Macro Requirements for glibc (see <a href="../man7/feature_test_macros.7.html"><strong>feature_test_macros</strong>(7)</a>):</p><p><strong>madvise</strong>(): _BSD_SOURCE</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>madvise</strong>() system call advises the kernel about how to handle paging input/output in the address range beginning at address <em>addr</em> and with size <em>length</em> bytes. It allows an application to tell the kernel how it expects to use some mapped or shared memory areas, so that the kernel can choose appropriate read-ahead and caching techniques. This call does not influence the semantics of the application (except in the case of <strong>MADV_DONTNEED</strong>), but may influence its performance. The kernel is free to ignore the advice.</p><p>The advice is indicated in the <em>advice</em> argument which can be</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>MADV_NORMAL</strong></p>
  </dt>
  <dd>
    <p>No special treatment. This is the default.</p>
  </dd>
  <dt>
    <p><strong>MADV_RANDOM</strong></p>
  </dt>
  <dd>
    <p>Expect page references in random order. (Hence, read ahead may be less useful than normally.)</p>
  </dd>
  <dt>
    <p><strong>MADV_SEQUENTIAL</strong></p>
  </dt>
  <dd>
    <p>Expect page references in sequential order. (Hence, pages in the given range can be aggressively read ahead, and may be freed soon after they are accessed.)</p>
  </dd>
  <dt>
    <p><strong>MADV_WILLNEED</strong></p>
  </dt>
  <dd>
    <p>Expect access in the near future. (Hence, it might be a good idea to read some pages ahead.)</p>
  </dd>
  <dt>
    <p><strong>MADV_DONTNEED</strong></p>
  </dt>
  <dd>
    <p>Do not expect access in the near future. (For the time being, the application is finished with the given range, so the kernel can free resources associated with it.) Subsequent accesses of pages in this range will succeed, but will result either in reloading of the memory contents from the underlying mapped file (see <a href="../man2/mmap.2.html"><strong>mmap</strong>(2)</a>) or zero-fill-on-demand pages for mappings without an underlying file.</p>
  </dd>
  <dt>
    <p><strong>MADV_REMOVE</strong> (since Linux 2.6.16)</p>
  </dt>
  <dd>
    <p>Free up a given range of pages and its associated backing store. Currently, only shmfs/tmpfs supports this; other filesystems return with the error <strong>ENOSYS</strong>.</p>
  </dd>
  <dt>
    <p><strong>MADV_DONTFORK</strong> (since Linux 2.6.16)</p>
  </dt>
  <dd>
    <p>Do not make the pages in this range available to the child after a <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a>. This is useful to prevent copy-on-write semantics from changing the physical location of a page(s) if the parent writes to it after a <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a>. (Such page relocations cause problems for hardware that DMAs into the page(s).)</p>
  </dd>
  <dt>
    <p><strong>MADV_DOFORK</strong> (since Linux 2.6.16)</p>
  </dt>
  <dd>
    <p>Undo the effect of <strong>MADV_DONTFORK</strong>, restoring the default behavior, whereby a mapping is inherited across <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a>.</p>
  </dd>
  <dt>
    <p><strong>MADV_HWPOISON</strong> (since Linux 2.6.32)</p>
  </dt>
  <dd>
    <p>Poison a page and handle it like a hardware memory corruption. This operation is available only for privileged (<strong>CAP_SYS_ADMIN</strong>) processes. This operation may result in the calling process receiving a <strong>SIGBUS</strong> and the page being unmapped. This feature is intended for testing of memory error-handling code; it is available only if the kernel was configured with <strong>CONFIG_MEMORY_FAILURE</strong>.</p>
  </dd>
  <dt>
    <p><strong>MADV_SOFT_OFFLINE</strong> (since Linux 2.6.33)</p>
  </dt>
  <dd>
    <p>Soft offline the pages in the range specified by <em>addr</em> and <em>length</em>. The memory of each page in the specified range is preserved (i.e., when next accessed, the same content will be visible, but in a new physical page frame), and the original page is offlined (i.e., no longer used, and taken out of normal memory management). The effect of the <strong>MADV_SOFT_OFFLINE</strong> operation is invisible to (i.e., does not change the semantics of) the calling process. This feature is intended for testing of memory error-handling code; it is available only if the kernel was configured with <strong>CONFIG_MEMORY_FAILURE</strong>.</p>
  </dd>
  <dt>
    <p><strong>MADV_MERGEABLE</strong> (since Linux 2.6.32)</p>
  </dt>
  <dd>
    <p>Enable Kernel Samepage Merging (KSM) for the pages in the range specified by <em>addr</em> and <em>length</em>. The kernel regularly scans those areas of user memory that have been marked as mergeable, looking for pages with identical content. These are replaced by a single write-protected page (which is automatically copied if a process later wants to update the content of the page). KSM merges only private anonymous pages (see <a href="../man2/mmap.2.html"><strong>mmap</strong>(2)</a>). The KSM feature is intended for applications that generate many instances of the same data (e.g., virtualization systems such as KVM). It can consume a lot of processing power; use with care. See the Linux kernel source file <em>Documentation/vm/ksm.txt</em> for more details. The <strong>MADV_MERGEABLE</strong> and <strong>MADV_UNMERGEABLE</strong> operations are available only if the kernel was configured with <strong>CONFIG_KSM</strong>.</p>
  </dd>
  <dt>
    <p><strong>MADV_UNMERGEABLE</strong> (since Linux 2.6.32)</p>
  </dt>
  <dd>
    <p>Undo the effect of an earlier <strong>MADV_MERGEABLE</strong> operation on the specified address range; KSM unmerges whatever pages it had merged in the address range specified by <em>addr</em> and <em>length</em>.</p>
  </dd>
  <dt>
    <p><strong>MADV_HUGEPAGE</strong> (since Linux 2.6.38)</p>
  </dt>
  <dd>
    <p>Enables Transparent Huge Pages (THP) for pages in the range specified by <em>addr</em> and <em>length</em>. Currently, Transparent Huge Pages work only with private anonymous pages (see <a href="../man2/mmap.2.html"><strong>mmap</strong>(2)</a>). The kernel will regularly scan the areas marked as huge page candidates to replace them with huge pages. The kernel will also allocate huge pages directly when the region is naturally aligned to the huge page size (see <strong>posix_memalign</strong>(2)). This feature is primarily aimed at applications that use large mappings of data and access large regions of that memory at a time (e.g., virtualization systems such as QEMU). It can very easily waste memory (e.g., a 2MB mapping that only ever accesses 1 byte will result in 2MB of wired memory instead of one 4KB page). See the Linux kernel source file <em>Documentation/vm/transhuge.txt</em> for more details. The <strong>MADV_HUGEPAGE</strong> and <strong>MADV_NOHUGEPAGE</strong> operations are available only if the kernel was configured with <strong>CONFIG_TRANSPARENT_HUGEPAGE</strong>.</p>
  </dd>
  <dt>
    <p><strong>MADV_NOHUGEPAGE</strong> (since Linux 2.6.38)</p>
  </dt>
  <dd>
    <p>Ensures that memory in the address range specified by <em>addr</em> and <em>length</em> will not be collapsed into huge pages.</p>
  </dd>
  <dt>
    <p><strong>MADV_DONTDUMP</strong> (since Linux 3.4)</p>
  </dt>
  <dd>
    <p>Exclude from a core dump those pages in the range specified by <em>addr</em> and <em>length</em>. This is useful in applications that have large areas of memory that are known not to be useful in a core dump. The effect of <strong>MADV_DONTDUMP</strong> takes precedence over the bit mask that is set via the <em>/proc/PID/coredump_filter</em> file (see <a href="../man5/core.5.html"><strong>core</strong>(5)</a>).</p>
  </dd>
  <dt>
    <p><strong>MADV_DODUMP</strong> (since Linux 3.4)</p>
  </dt>
  <dd>
    <p>Undo the effect of an earlier <strong>MADV_DONTDUMP</strong>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>On success <strong>madvise</strong>() returns zero. On error, it returns -1 and <em>errno</em> is set appropriately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>EAGAIN</strong></p>
  </dt>
  <dd>
    <p>A kernel resource was temporarily unavailable.</p>
  </dd>
  <dt>
    <p><strong>EBADF</strong></p>
  </dt>
  <dd>
    <p>The map exists, but the area maps something that isn't a file.</p>
  </dd>
  <dt>
    <p><strong>EINVAL</strong></p>
  </dt>
  <dd>
    <p>This error can occur for the following reasons:</p><ul>
<li><p>The value <em>len</em> is negative.</p></li><li><p><em>addr</em> is not page-aligned.</p></li><li><p><em>advice</em> is not a valid value</p></li><li><p>The application is attempting to release locked or shared pages (with <strong>MADV_DONTNEED</strong>).</p></li><li><p><strong>MADV_MERGEABLE</strong> or <strong>MADV_UNMERGEABLE</strong> was specified in <em>advice</em>, but the kernel was not configured with <strong>CONFIG_KSM</strong>.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>EIO</strong></p>
  </dt>
  <dd>
    <p>(for <strong>MADV_WILLNEED</strong>) Paging in this area would exceed the process's maximum resident set size.</p>
  </dd>
  <dt>
    <p><strong>ENOMEM</strong></p>
  </dt>
  <dd>
    <p>(for <strong>MADV_WILLNEED</strong>) Not enough memory: paging in failed.</p>
  </dd>
  <dt>
    <p><strong>ENOMEM</strong></p>
  </dt>
  <dd>
    <p>Addresses in the specified range are not currently mapped, or are outside the address space of the process.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>POSIX.1b. POSIX.1-2001 describes <strong>posix_madvise</strong>(3) with constants <strong>POSIX_MADV_NORMAL</strong>, <strong>POSIX_MADV_RANDOM</strong>, and so on, with a behavior close to that described here. There is a similar <a href="../man2/posix_fadvise.2.html"><strong>posix_fadvise</strong>(2)</a> for file access.</p><p><strong>MADV_REMOVE</strong>, <strong>MADV_DONTFORK</strong>, <strong>MADV_DOFORK</strong>, <strong>MADV_HWPOISON</strong>, <strong>MADV_MERGEABLE</strong>, and <strong>MADV_UNMERGEABLE</strong> are Linux-specific.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<h3>Linux notes</h3>
<p>The current Linux implementation (2.4.0) views this system call more as a command than as advice and hence may return an error when it cannot do what it usually would do in response to this advice. (See the ERRORS description above.) This is nonstandard behavior.</p><p>The Linux implementation requires that the address <em>addr</em> be page-aligned, and allows <em>length</em> to be zero. If there are some parts of the specified address range that are not mapped, the Linux version of <strong>madvise</strong>() ignores them and applies the call to the rest (but returns <strong>ENOMEM</strong> from the system call, as it should).</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO madvise&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man2/getrlimit.2.html"><strong>getrlimit</strong>(2)</a>, <a href="../man2/mincore.2.html"><strong>mincore</strong>(2)</a>, <a href="../man2/mmap.2.html"><strong>mmap</strong>(2)</a>, <a href="../man2/mprotect.2.html"><strong>mprotect</strong>(2)</a>, <a href="../man2/msync.2.html"><strong>msync</strong>(2)</a>, <a href="../man2/munmap.2.html"><strong>munmap</strong>(2)</a>, <a href="../man2/prctl.2.html"><strong>prctl</strong>(2)</a>, <a href="../man5/core.5.html"><strong>core</strong>(5)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of release 3.74 of the Linux <em>man-pages</em> project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at http://www.kernel.org/doc/man-pages/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lstat64.2.html"><span aria-hidden="true">&larr;</span> lstat64.2: Get file status</a></li>
   <li class="next"><a href="madvise1.2.html">madvise1.2: Unimplemented system calls <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
