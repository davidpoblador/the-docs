<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>futex: Fast user-space locking</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Fast user-space locking">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="futex (2) manual">
  <meta name="twitter:description" content="Fast user-space locking">
  <meta name="twitter:image" content="https://www.carta.tech/images/manpages-dev-futex-2.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man2/futex.2.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="futex (2) manual" />
  <meta property="og:description" content="Fast user-space locking" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/manpages-dev-futex-2.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">futex<small> (2)</small></h1>
        <p class="lead">Fast user-space locking</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/">
      <span itemprop="name">System calls</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/futex.2.html">
      <span itemprop="name">futex: Fast user-space locking</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/manpages-dev/">
      <span itemprop="name">manpages-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man2/futex.2.html">
      <span itemprop="name">futex: Fast user-space locking</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<strong>#include &lt;linux/futex.h&gt;</strong>
<strong>#include &lt;sys/time.h&gt;</strong>

<strong>int futex(int *</strong><em>uaddr</em><strong>, int </strong><em>op</em><strong>, int </strong><em>val</em><strong>, const struct timespec *</strong><em>timeout</em><strong>,</strong>

<strong>          int *</strong><em>uaddr2</em><strong>, int </strong><em>val3</em><strong>);</strong>
</pre>
<p><em>Note</em>: There is no glibc wrapper for this system call; see NOTES.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>futex</strong>() system call provides a method for a program to wait for a value at a given address to change, and a method to wake up anyone waiting on a particular address (while the addresses for the same memory in separate processes may not be equal, the kernel maps them internally so the same memory mapped in different locations will correspond for <strong>futex</strong>() calls). This system call is typically used to implement the contended case of a lock in shared memory, as described in <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a>.</p><p>When a <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a> operation did not finish uncontended in user space, a call needs to be made to the kernel to arbitrate. Arbitration can either mean putting the calling process to sleep or, conversely, waking a waiting process.</p><p>Callers of this function are expected to adhere to the semantics as set out in <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a>. As these semantics involve writing nonportable assembly instructions, this in turn probably means that most users will in fact be library authors and not general application developers.</p><p>The <em>uaddr</em> argument needs to point to an aligned integer which stores the counter. The operation to execute is passed via the <em>op</em> argument, along with a value <em>val</em>.</p><p>Five operations are currently defined:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>FUTEX_WAIT</strong></p>
  </dt>
  <dd>
    <p>This operation atomically verifies that the futex address <em>uaddr</em> still contains the value <em>val</em>, and sleeps awaiting <strong>FUTEX_WAKE</strong> on this futex address. If the <em>timeout</em> argument is non-NULL, its contents specify the duration of the wait. (This interval will be rounded up to the system clock granularity, and kernel scheduling delays mean that the blocking interval may overrun by a small amount.) If <em>timeout</em> is NULL, the call blocks indefinitely. The arguments <em>uaddr2</em> and <em>val3</em> are ignored.</p><p>For <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a>, this call is executed if decrementing the count gave a negative value (indicating contention), and will sleep until another process releases the futex and executes the <strong>FUTEX_WAKE</strong> operation.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_WAKE</strong></p>
  </dt>
  <dd>
    <p>This operation wakes at most <em>val</em> processes waiting on this futex address (i.e., inside <strong>FUTEX_WAIT</strong>). The arguments <em>timeout</em>, <em>uaddr2</em> and <em>val3</em> are ignored.</p><p>For <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a>, this is executed if incrementing the count showed that there were waiters, once the futex value has been set to 1 (indicating that it is available).</p>
  </dd>
  <dt>
    <p><strong>FUTEX_FD</strong> (present up to and including Linux 2.6.25)</p>
  </dt>
  <dd>
    <p>To support asynchronous wakeups, this operation associates a file descriptor with a futex. If another process executes a <strong>FUTEX_WAKE</strong>, the process will receive the signal number that was passed in <em>val</em>. The calling process must close the returned file descriptor after use. The arguments <em>timeout</em>, <em>uaddr2</em> and <em>val3</em> are ignored.</p><p>To prevent race conditions, the caller should test if the futex has been upped after <strong>FUTEX_FD</strong> returns.</p><p>Because it was inherently racy, <strong>FUTEX_FD</strong> has been removed from Linux 2.6.26 onward.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_REQUEUE</strong> (since Linux 2.5.70)</p>
  </dt>
  <dd>
    <p>This operation was introduced in order to avoid a "thundering herd" effect when <strong>FUTEX_WAKE</strong> is used and all processes woken up need to acquire another futex. This call wakes up <em>val</em> processes, and requeues all other waiters on the futex at address <em>uaddr2</em>. The arguments <em>timeout</em> and <em>val3</em> are ignored.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_CMP_REQUEUE</strong> (since Linux 2.6.7)</p>
  </dt>
  <dd>
    <p>There was a race in the intended use of <strong>FUTEX_REQUEUE</strong>, so <strong>FUTEX_CMP_REQUEUE</strong> was introduced. This is similar to <strong>FUTEX_REQUEUE</strong>, but first checks whether the location <em>uaddr</em> still contains the value <em>val3</em>. If not, the operation fails with the error <strong>EAGAIN</strong>. The argument <em>timeout</em> is ignored.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p>In the event of an error, all operations return -1, and set <em>errno</em> to indicate the error. The return value on success depends on the operation, as described in the following list:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>FUTEX_WAIT</strong></p>
  </dt>
  <dd>
    <p>Returns 0 if the process was woken by a <strong>FUTEX_WAKE</strong> call. See ERRORS for the various possible error returns.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_WAKE</strong></p>
  </dt>
  <dd>
    <p>Returns the number of processes woken up.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_FD</strong></p>
  </dt>
  <dd>
    <p>Returns the new file descriptor associated with the futex.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_REQUEUE</strong></p>
  </dt>
  <dd>
    <p>Returns the number of processes woken up.</p>
  </dd>
  <dt>
    <p><strong>FUTEX_CMP_REQUEUE</strong></p>
  </dt>
  <dd>
    <p>Returns the number of processes woken up.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>EACCES</strong></p>
  </dt>
  <dd>
    <p>No read access to futex memory.</p>
  </dd>
  <dt>
    <p><strong>EAGAIN</strong></p>
  </dt>
  <dd>
    <p><strong>FUTEX_CMP_REQUEUE</strong> detected that the value pointed to by <em>uaddr</em> is not equal to the expected value <em>val3</em>. (This probably indicates a race; use the safe <strong>FUTEX_WAKE</strong> now.)</p>
  </dd>
  <dt>
    <p><strong>EFAULT</strong></p>
  </dt>
  <dd>
    <p>Error retrieving <em>timeout</em> information from user space.</p>
  </dd>
  <dt>
    <p><strong>EINTR</strong></p>
  </dt>
  <dd>
    <p>A <strong>FUTEX_WAIT</strong> operation was interrupted by a signal (see <a href="../man7/signal.7.html"><strong>signal</strong>(7)</a>) or a spurious wakeup.</p>
  </dd>
  <dt>
    <p><strong>EINVAL</strong></p>
  </dt>
  <dd>
    <p>Invalid argument.</p>
  </dd>
  <dt>
    <p><strong>ENFILE</strong></p>
  </dt>
  <dd>
    <p>The system limit on the total number of open files has been reached.</p>
  </dd>
  <dt>
    <p><strong>ENOSYS</strong></p>
  </dt>
  <dd>
    <p>Invalid operation specified in <em>op</em>.</p>
  </dd>
  <dt>
    <p><strong>ETIMEDOUT</strong></p>
  </dt>
  <dd>
    <p>Timeout during the <strong>FUTEX_WAIT</strong> operation.</p>
  </dd>
  <dt>
    <p><strong>EWOULDBLOCK</strong></p>
  </dt>
  <dd>
    <p><em>op</em> was <strong>FUTEX_WAIT</strong> and the value pointed to by <em>uaddr</em> was not equal to the expected value <em>val</em> at the time of the call.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">VERSIONS</h2>
        <div class="sectioncontent">
<p>Initial futex support was merged in Linux 2.5.7 but with different semantics from what was described above. A 4-argument system call with the semantics described in this page was introduced in Linux 2.5.40. In Linux 2.5.70, one argument was added. In Linux 2.6.7, a sixth argument was added&ndash;messy, especially on the s390 architecture.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFORMING TO</h2>
        <div class="sectioncontent">
<p>This system call is Linux-specific.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>To reiterate, bare futexes are not intended as an easy-to-use abstraction for end-users. (There is no wrapper function for this system call in glibc.) Implementors are expected to be assembly literate and to have read the sources of the futex user-space library referenced below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO futex&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man2/restart_syscall.2.html"><strong>restart_syscall</strong>(2)</a>, <a href="../man7/futex.7.html"><strong>futex</strong>(7)</a></p><p><em>Fuss, Futexes and Furwocks: Fast Userlevel Locking in Linux</em> (proceedings of the Ottawa Linux Symposium 2002), online at</p><p>Futex example library, futex-*.tar.bz2 at</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COLOPHON</h2>
        <div class="sectioncontent">
<p>This page is part of release 3.74 of the Linux <em>man-pages</em> project. A description of the project, information about reporting bugs, and the latest version of this page, can be found at http://www.kernel.org/doc/man-pages/.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ftruncate64.2.html"><span aria-hidden="true">&larr;</span> ftruncate64.2: Truncate a file to a specified length</a></li>
   <li class="next"><a href="futimesat.2.html">futimesat.2: Change timestamps of a file relative to a  directory file descriptor <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
