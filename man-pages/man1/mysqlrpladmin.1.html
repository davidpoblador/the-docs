<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mysqlrpladmin: Administration utility for mysql replication</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Administration utility for mysql replication">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mysqlrpladmin (1) manual">
  <meta name="twitter:description" content="Administration utility for mysql replication">
  <meta name="twitter:image" content="https://www.carta.tech/images/mysql-utilities-mysqlrpladmin-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/mysqlrpladmin.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mysqlrpladmin (1) manual" />
  <meta property="og:description" content="Administration utility for mysql replication" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mysql-utilities-mysqlrpladmin-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mysqlrpladmin<small> (1)</small></h1>
        <p class="lead">Administration utility for mysql replication</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mysqlrpladmin.1.html">
      <span itemprop="name">mysqlrpladmin: Administration utility for mysql replication</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mysql-utilities/">
      <span itemprop="name">mysql-utilities</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mysqlrpladmin.1.html">
      <span itemprop="name">mysqlrpladmin: Administration utility for mysql replication</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mysqlrpladmin [</strong><strong></strong><em>options</em><strong>]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This utility permits users to perform administrative actions on a replication topology consisting of a master and its slaves. The utility is designed to make it easy to recover from planned maintenance of the master or from an event that takes the master offline unexpectedly.</p><p>The act of taking the master offline intentionally and switching control to another slave is called switchover. In this case, there is no loss of transactions as the master is locked and all slaves are allowed to catch up to the master. Once the slaves have read all events from the master, the master is shutdown and control switched to a slave (in this case called a candidate slave).</p><p>Recovering from the loss of a downed master is more traumatic and since there is no way to know what transactions the master may have failed to send, the new master (called a candidate slave) must be the slave that is most up-to-date. How this is determined depends on the version of the server (see below). However, it can result in the loss of some transactions that were executed on the downed master but not sent. The utility accepts a list of slaves to be considered the candidate slave. If no slave is found to meet the requirements, the operation will search the list of known slaves.</p><p>The utility also provides a number of useful commands for managing a replication topology including the following.</p><p><strong>elect</strong> This command is available to only those servers supporting global transaction identifiers (GTIDs), perform best slave election and report best slave to use in the event a switchover or failover is required. Best slave election is simply the first slave to meet the prerequisites. GTIDs are supported in version 5.6.5 and higher. This command requires the options <strong>--master</strong> and either <strong>--slaves</strong> or <strong>--discover-slaves-login</strong>.</p><p><strong>failover</strong> This command is available to only those servers supporting GTIDs. Conduct failover to the best slave. The command will test each candidate slave listed for the prerequisites. Once a candidate slave is elected, it is made a slave of each of the other slaves thereby collecting any transactions executed on other slaves but not the candidate. In this way, the candidate becomes the most up-to-date slave. This command requires the <strong>--slaves</strong> option. The <strong>--discover-slaves-login</strong> option is not allowed because, for failover, the master is presumed to be offline or otherwise unreachable (so there is no way to discover the slaves). The <strong>--master</strong> option is ignored for this command.</p><p><strong>gtid</strong> This command is available to only those servers supporting GTIDs. It displays the contents of the GTID variables, @@GLOBAL.GTID_EXECUTED, @@GLOBAL.GTID_PURGED, and @@GLOBAL.GTID_OWNED. The command also displays universally unique identifiers (UUIDs) for all servers. This command requires one of the following combinations: <strong>--master</strong> and <strong>--slaves</strong>, or <strong>--master</strong> and <strong>--discover-slaves-login</strong>.</p><p><strong>health</strong> Display the replication health of the topology. By default, this includes the host name, port, role (MASTER or SLAVE) of the server, state of the server (UP = is connected, WARN = not connected but can ping, DOWN = not connected and cannot ping), the GTID_MODE, and health state. This command requires one of the following combinations:</p><p><strong>--master</strong> and <strong>--slaves</strong>;</p><p><strong>--master</strong> and <strong>--discover-slaves-login</strong>;</p><p>The master health state is based on the following; if GTID_MODE=ON, the server must have binary log enabled, and there must exist a user with the REPLICATE SLAVE privilege.</p><p>The slave health state is based on the following; the IO_THREAD and SQL_THREADS must be running, it must be connected to the master, there are no errors, the slave delay for non-gtid enabled scenarios is not more than the threshold provided by the <strong>--max-position</strong> and the slave is reading the correct master log file, and slave delay is not more than the <strong>--seconds-behind</strong> threshold option.</p><p><strong>reset</strong> Execute the STOP SLAVE and RESET SLAVE commands on all slaves. This command requires the <strong>--slaves</strong> option. The <strong>--discover-slaves-login</strong> option is not allowed because it might not provide the expected result, excluding slaves with the IO thread stopped. Optionally, the <strong>--master</strong> option can also be used and in this case the utility will perform an additional check to verify if the specified slaves are associated (i.e. replication configured) to the given master.</p><p><strong>start</strong> Execute the START SLAVE command on all slaves. This command requires the <strong>--slaves</strong> option. The <strong>--discover-slaves-login</strong> option is not allowed because it might not provide the expected result, excluding slaves with the IO thread stopped. Optionally, the <strong>--master</strong> option can also be used and in this case the utility will perform an additional check to verify if the specified slaves are associated (i.e. replication configured) to the given master.</p><p><strong>stop</strong> Execute the STOP SLAVE command on all slaves. This command requires the <strong>--slaves</strong> option. The <strong>--discover-slaves-login</strong> option is not allowed because it might not provide the expected result, excluding slaves with the IO thread stopped. Optionally, the <strong>--master</strong> option can also be used and in this case the utility will perform an additional check to verify if the specified slaves are associated (i.e. replication configured) to the given master.</p><p><strong>switchover</strong> Perform slave promotion to a specified candidate slave as designated by the <strong>--new-master</strong> option. This command is available for both gtid-enabled servers and non-gtid-enabled scenarios. This command requires one of the following combinations:</p><p><strong>--master</strong>, <strong>--new-master</strong> and <strong>--slaves</strong>;</p><p><strong>--master</strong>, <strong>--new-master</strong> and <strong>--discover-slaves-login</strong>;</p><p>Detection of a downed master is performed as follows. If the connection to the master is lost, wait <strong>--ping</strong> seconds and check again. If the master connection is lost and the master cannot be pinged or reconnected, the failover event occurs.</p><p>For all commands that require specifying multiple servers, the options require a comma-separated list of connection parameters in the following form (where the password, port, and socket are optional).:</p>
<pre>
&lt;*user*&gt;[:&lt;*passwd*&gt;]@&lt;*host*&gt;[:&lt;*port*&gt;][:&lt;*socket*&gt;] or
&lt;*login-path*&gt;[:&lt;*port*&gt;][:&lt;*socket*&gt;]
</pre>
<p>The utility permits users to discover slaves connected to the master. In order to use the discover slaves feature, all slaves must use the --report-host and --report-port startup variables to specify the correct hostname and ip port of the slave. If these are missing or report the incorrect information, the slaves health may not be reported correctly or the slave may not be listed at all. The discover slaves feature ignores any slaves it cannot connect to or with the IO thread stopped (i.e. not connected to the master).</p><p>The utility permits the user to demote a master to a slave during the switchover operation. The <strong>--demote-master</strong> option tells the utility to, once the new master is established, make the old master a slave of the new master. This permits rotation of the master role among a set of servers.</p><p>The utility permits the user to specify an external script to execute before and after the switchover and failover commands. The user can specify these with the <strong>--exec-before</strong> and <strong>--exec-after</strong> options. The return code of the script is used to determine success thus each script must report 0 (success) to be considered successful. If a script returns a value other than 0, the result code is presented in an error message.</p><p>The utility permits the user to log all actions taken during the commands. The <strong>--log</strong> option requires a valid path and file name of the file to use for logging operations. The log is active only when this option is specified. The option <strong>--log-age</strong> specifies the age in days that log entries are kept. The default is seven (7) days. Older entries are automatically deleted from the log file (but only if the <strong>--log</strong> option is specified).</p><p>The format of the log file includes the date and time of the event, the level of the event (informational - INFO, warning - WARN, error - ERROR, critical failure - CRITICAL), and the message reported by the utility.</p><p>The utility has a number of options each explained in more detail below. Some of the options are specific to certain commands. Warning messages are issued whenever an option is used that does not apply to the command requested. A brief overview of each command and its options is presented in the following paragraphs.</p><p>The start, stop, and reset commands require the <strong>--slaves</strong> option to list all of the slaves in the topology. Optionally, the <strong>--master</strong> option can be specified for the utility to check if the specified slaves are associated to the given master before executing the command, making sure that the command is only applied to slaves connected to the right replication master.</p><p>The options required for the elect, health and gtid commands include the <strong>--master</strong> option to specify the existing master, and either the <strong>--slaves</strong> option to list all of the slaves in the topology or the <strong>--discover-slaves-login</strong> option to provide the user name and password to discover any slaves in the topology that are registered and connected to the master.</p><p>The options required for switchover include the <strong>--master</strong> option to specify the existing master, the <strong>--new-master</strong> option to specify the candidate slave (the slave to become the new master), and either the <strong>--slaves</strong> option to list the considered slaves in the topology or the <strong>--discover-slaves-login</strong> option to provide the user name and password to discover any slaves in the topology that are registered and connected to the master.</p><p>The failover command requires only the <strong>--slaves</strong> option to explicitly list all of the slaves in the topology because it is expected that the master is down when this command is used.</p><p>Use the <strong>--verbose</strong> option to see additional information in the health report and additional messages during switchover or failover.</p>
<pre>
      OPTIONS
</pre>
<p><strong>mysqlrpladmin</strong> accepts the following command-line options:</p><p>--help</p><p>Display a help message and exit.</p><p>--candidates=&lt;candidate slave connections&gt;</p><p>Connection information for candidate slave servers for failover in the form: &lt;<em>user</em>&gt;[:&lt;<em>passwd</em>&gt;]@&lt;<em>host</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;] or &lt;<em>login-path</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;]. Valid only with failover command. List multiple slaves in comma-separated list.</p><p>--demote-master</p><p>Make master a slave after switchover.</p><p>--discover-slaves-login=&lt;slave_login&gt;</p><p>At startup, query master for all registered slaves and use the user name and password specified to connect. Supply the user and password in the form &lt;<em>user</em>&gt;[:&lt;<em>passwd</em>&gt;] or &lt;<em>login-path</em>&gt;. For example, --discover=joe:secret will use &apos;joe&apos; as the user and &apos;secret&apos; as the password for each discovered slave.</p><p>--exec-after=&lt;script&gt;</p><p>Name of script to execute after failover or switchover. Script name may include the path.</p><p>--exec-before=&lt;script&gt;</p><p>Name of script to execute before failover or switchover. Script name may include the path.</p><p>--force</p><p>Ignore prerequisite checks or any inconsistencies found (e.g. errant transactions on the slaves or SQL thread errors) forcing the execution of the specified command. This option need to be used carefully as it will not solve any detected issue, but will only ignore them displaying a warning message.</p><p>--format=&lt;format&gt;, -f &lt;format&gt;</p><p>Display the replication health output in either grid (default), tab, csv, or vertical format.</p><p>--log=&lt;log_file&gt;</p><p>Specify a log file to use for logging messages</p><p>--log-age=&lt;days&gt;</p><p>Specify maximum age of log entries in days. Entries older than this will be purged on startup. Default = 7 days.</p><p>--master=&lt;connection&gt;</p><p>Connection information for the master server in the format: &lt;<em>user</em>&gt;[:&lt;<em>passwd</em>&gt;]@&lt;<em>host</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;] or &lt;<em>login-path</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;].</p><p>--max-position=&lt;position&gt;</p><p>Used to detect slave delay. The maximum difference between the master&apos;s log position and the slave&apos;s reported read position of the master. A value greater than this means the slave is too far behind the master. Default = 0.</p><p>--new-master=&lt;connection&gt;</p><p>Connection information for the slave to be used to replace the master for switchover in the form: &lt;<em>user</em>&gt;[:&lt;<em>passwd</em>&gt;]@&lt;<em>host</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;] or &lt;<em>login-path</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;]. Valid only with switchover command.</p><p>--no-health</p><p>Turn off health report after switchover or failover.</p><p>--ping=&lt;number&gt;</p><p>Number of ping attempts for detecting downed server. Note: on some platforms this is the same as number of seconds to wait for <em>ping</em> to return. This value is also used to check down status of master. Failover will wait <em>ping</em> seconds to check master response. If no response, failover event occurs.</p><p>--quiet, -q</p><p>Turn off all messages for quiet execution.</p><p>--rpl-user=&lt;replication_user&gt;</p><p>The user and password for the replication user requirement, in the format: &lt;<em>user</em>&gt;[:&lt;<em>password</em>&gt;] or &lt;<em>login-path</em>&gt;. E.g. rpl:passwd Default = None.</p><p>--script-threshold=&lt;return_code&gt;</p><p>Value for external scripts to trigger aborting the operation if result is greater than or equal to the threshold.</p><p>Default = None (no threshold checking).</p><p>--seconds-behind=&lt;seconds&gt;</p><p>Used to detect slave delay. The maximum number of seconds behind the master permitted before slave is considered behind the master. Default = 0.</p><p>--slaves=&lt;slave connections&gt;</p><p>Connection information for slave servers in the form: &lt;<em>user</em>&gt;[:&lt;<em>passwd</em>&gt;]@&lt;<em>host</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;] or &lt;<em>login-path</em>&gt;[:&lt;<em>port</em>&gt;][:&lt;<em>socket</em>&gt;]. List multiple slaves in comma-separated list. The list will be evaluated literally whereby each server is considered a slave to the master listed regardless if they are a slave of the master.</p><p>--timeout=&lt;seconds&gt;</p><p>Maximum timeout in seconds to wait for each replication command to complete. For example, timeout for slave waiting to catch up to master. Default = 300 seconds.</p><p>--verbose, -v</p><p>Specify how much information to display. Use this option multiple times to increase the amount of information. For example, <strong>-v</strong> = verbose, <strong>-vv</strong> = more verbose, <strong>-vvv</strong> = debug.</p><p>--version</p><p>Display version information and exit.</p>
<pre>
      NOTES
</pre>
<p>The login user must have the appropriate permissions to execute <strong>SHOW SLAVE STATUS</strong>, <strong>SHOW MASTER STATUS</strong>, and <strong>SHOW VARIABLES</strong> on the appropriate servers as well as grant the REPLICATE SLAVE privilege. The utility checks permissions for the master, slaves, and candidates at startup.</p><p>Mixing IP and hostnames is not recommended. The replication-specific utilities will attempt to compare hostnames and IP addresses as aliases for checking slave connectivity to the master. However, if your installation does not support reverse name lookup, the comparison could fail. Without the ability to do a reverse name lookup, the replication utilities could report a false negative that the slave is (not) connected to the master.</p><p>For example, if you setup replication using MASTER_HOST=ubuntu.net on the slave and later connect to the slave with mysqlrplcheck and have the master specified as --master=192.168.0.6 using the valid IP address for ubuntu.net, you must have the ability to do a reverse name lookup to compare the IP (192.168.0.6) and the hostname (ubuntu.net) to determine if they are the same machine.</p><p>Similarly, if you use localhost to connect to the master, the health report may not show all of the slaves. It is best to use the actual hostname of the master when connecting or setting up replication.</p><p>If the user does not specify the <strong>--rpl-user </strong> and the user has specified the switchover or failover command, the utility will check to see if the slaves are using --master-info-repository=TABLE. If they are not, the utility will stop with an error.</p><p>All the commands require either the <strong>--slaves</strong> or <strong>--discover-slaves-login</strong> option but both cannot be used at the same time. In fact, some commands only allow the use of the <strong>--slaves</strong> option which is safer to specify the list slaves, because <strong>--discover-slaves-login</strong> might not provide an up to date list of available slaves.</p><p>The path to the MySQL client tools should be included in the PATH environment variable in order to use the authentication mechanism with login-paths. This will allow the utility to use the my_print_defaults tools which is required to read the login-path values from the login configuration file (.mylogin.cnf).</p>
<pre>
      EXAMPLES
</pre>
<p>To perform best slave election for a topology with GTID_MODE=ON (server version 5.6.5 or higher) where all slaves are specified with the <strong>--slaves</strong> option, run the following command.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3331 &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 elect
# Electing candidate slave from known slaves.
# Best slave found is located on localhost:3332.
# ...done.
</pre>
<p>To perform best slave election supplying a candidate list, use the following command.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3331 &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 &#92;
  --candidates=root@localhost:3333,root@localhost:3334 elect
# Electing candidate slave from candidate list then slaves list.
# Best slave found is located on localhost:3332.
# ...done.
</pre>
<p>To perform failover after a master has failed, use the following command.:</p>
<pre>
$ mysqlrpladmin  &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 &#92;
  --candidates=root@localhost:3333,root@localhost:3334 failover
# Performing failover.
# Candidate slave localhost:3333 will become the new master.
# Preparing candidate for failover.
# Creating replication user if it does not exist.
# Stopping slaves.
# Performing STOP on all slaves.
# Switching slaves to new master.
# Starting slaves.
# Performing START on all slaves.
# Checking slaves for errors.
# Failover complete.
# ...done.
</pre>
<p>To see the replication health of a topology with GTID_MODE=ON (server version 5.6.5 or higher) and discover all slaves attached to the master, run the following command. We use the result of the failover command above.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3333 &#92;
  --slaves=root@localhost:3332,root@localhost:3334 health
# Getting health for master: localhost:3333.
#
# Replication Topology Health:
+------------+-------+---------+--------+------------+---------+
| host       | port  | role    | state  | gtid_mode  | health  |
+------------+-------+---------+--------+------------+---------+
| localhost  | 3333  | MASTER  | UP     | ON         | OK      |
| localhost  | 3332  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3334  | SLAVE   | UP     | ON         | OK      |
+------------+-------+---------+--------+------------+---------+
# ...done.
</pre>
<p>To view a detailed replication health report but with all of the replication health checks revealed, use the <strong>--verbose</strong> option as shown below. In this example, we use vertical format to make viewing easier.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3331 &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 &#92;
  --verbose health
# Getting health for master: localhost:3331.
# Attempting to contact localhost ... Success
# Attempting to contact localhost ... Success
# Attempting to contact localhost ... Success
# Attempting to contact localhost ... Success
#
# Replication Topology Health:
*************************       1. row *************************
            host: localhost
            port: 3331
            role: MASTER
           state: UP
       gtid_mode: ON
          health: OK
         version: 5.6.5-m8-debug-log
 master_log_file: mysql-bin.000001
  master_log_pos: 571
       IO_Thread:
      SQL_Thread:
     Secs_Behind:
 Remaining_Delay:
    IO_Error_Num:
        IO_Error:
*************************       2. row *************************
            host: localhost
            port: 3332
            role: SLAVE
           state: UP
       gtid_mode: ON
          health: OK
         version: 5.6.5-m8-debug-log
 master_log_file: mysql-bin.000001
  master_log_pos: 571
       IO_Thread: Yes
      SQL_Thread: Yes
     Secs_Behind: 0
 Remaining_Delay: No
    IO_Error_Num: 0
        IO_Error:
*************************       3. row *************************
            host: localhost
            port: 3333
            role: SLAVE
           state: UP
       gtid_mode: ON
          health: OK
         version: 5.6.5-m8-debug-log
 master_log_file: mysql-bin.000001
  master_log_pos: 571
       IO_Thread: Yes
      SQL_Thread: Yes
     Secs_Behind: 0
 Remaining_Delay: No
    IO_Error_Num: 0
        IO_Error:
*************************       4. row *************************
            host: localhost
            port: 3334
            role: SLAVE
           state: UP
       gtid_mode: ON
          health: OK
         version: 5.6.5-m8-debug-log
 master_log_file: mysql-bin.000001
  master_log_pos: 571
       IO_Thread: Yes
      SQL_Thread: Yes
     Secs_Behind: 0
 Remaining_Delay: No
    IO_Error_Num: 0
        IO_Error:
4 rows.
# ...done.
</pre>
<p>To run the same failover command above, but specify a log file, use the following command.:</p>
<pre>
$ mysqlrpladmin  &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 &#92;
  --candidates=root@localhost:3333,root@localhost:3334 &#92;
  --log=test_log.txt failover
# Performing failover.
# Candidate slave localhost:3333 will become the new master.
# Preparing candidate for failover.
# Creating replication user if it does not exist.
# Stopping slaves.
# Performing STOP on all slaves.
# Switching slaves to new master.
# Starting slaves.
# Performing START on all slaves.
# Checking slaves for errors.
# Failover complete.
# ...done.
</pre>
<p>After this command, the log file will contain entries like the following:</p>
<pre>
2012-03-19 14:44:17 PM INFO Executing failover command...
2012-03-19 14:44:17 PM INFO Performing failover.
2012-03-19 14:44:17 PM INFO Candidate slave localhost:3333 will become the new master.
2012-03-19 14:44:17 PM INFO Preparing candidate for failover.
2012-03-19 14:44:19 PM INFO Creating replication user if it does not exist.
2012-03-19 14:44:19 PM INFO Stopping slaves.
2012-03-19 14:44:19 PM INFO Performing STOP on all slaves.
2012-03-19 14:44:19 PM INFO Switching slaves to new master.
2012-03-19 14:44:20 PM INFO Starting slaves.
2012-03-19 14:44:20 PM INFO Performing START on all slaves.
2012-03-19 14:44:20 PM INFO Checking slaves for errors.
2012-03-19 14:44:21 PM INFO Failover complete.
2012-03-19 14:44:21 PM INFO ...done.
</pre>
<p>To perform switchover and demote the current master to a slave, use the following command.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3331 &#92;
  --slaves=root@localhost:3332,root@localhost:3333,root@localhost:3334 &#92;
  --new-master=root@localhost:3332 --demote-master switchover
# Performing switchover from master at localhost:3331 to slave at localhost:3332.
# Checking candidate slave prerequisites.
# Waiting for slaves to catch up to old master.
# Stopping slaves.
# Performing STOP on all slaves.
# Demoting old master to be a slave to the new master.
# Switching slaves to new master.
# Starting all slaves.
# Performing START on all slaves.
# Checking slaves for errors.
# Switchover complete.
# ...done.
</pre>
<p>If the replication health report is generated on the topology following the above command, it will display the old master as a slave as shown below.:</p>
<pre>
# Replication Topology Health:
+------------+-------+---------+--------+------------+---------+
| host       | port  | role    | state  | gtid_mode  | health  |
+------------+-------+---------+--------+------------+---------+
| localhost  | 3332  | MASTER  | UP     | ON         | OK      |
| localhost  | 3331  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3333  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3334  | SLAVE   | UP     | ON         | OK      |
+------------+-------+---------+--------+------------+---------+
</pre>
<p>You can use the discover slaves feature, if and only if all slaves report their host and port to the master. A sample command to generate a replication health report with discovery is shown below. Note that the option <strong>--discover-slaves-login</strong> cannot be used in conjunction with the <strong>--slaves</strong> option.:</p>
<pre>
$ mysqlrpladmin --master=root@localhost:3332 --discover-slaves-login=root  health
# Discovering slaves for master at localhost:3332
# Discovering slave at localhost:3331
# Found slave: localhost:3331
# Discovering slave at localhost:3333
# Found slave: localhost:3333
# Discovering slave at localhost:3334
# Found slave: localhost:3334
# Checking privileges.
#
# Replication Topology Health:
+------------+-------+---------+--------+------------+---------+
| host       | port  | role    | state  | gtid_mode  | health  |
+------------+-------+---------+--------+------------+---------+
| localhost  | 3332  | MASTER  | UP     | ON         | OK      |
| localhost  | 3331  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3333  | SLAVE   | UP     | ON         | OK      |
| localhost  | 3334  | SLAVE   | UP     | ON         | OK      |
+------------+-------+---------+--------+------------+---------+
# ...done.
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mysqlrpladmin&hellip;</h2>
        <div class="sectioncontent">
<p>For more information, please refer to the MySQL Utilities section of the MySQL Workbench Reference Manual, which is available online at http://dev.mysql.com/doc/workbench/en/.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Oracle Corporation (http://dev.mysql.com/).</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mysql-client-5.5-mysqlreport.1.html"><span aria-hidden="true">&larr;</span> mysqlreport.1: Makes a friendly report of important mysql status values</a></li>
   <li class="next"><a href="mysqlrplcheck.1.html">mysqlrplcheck.1: Check replication prerequisitiess <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
