<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pen: Load balancer for "simple" tcp based protocols</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Load balancer for "simple" tcp based protocols">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pen (1) manual">
  <meta name="twitter:description" content="Load balancer for "simple" tcp based protocols">
  <meta name="twitter:image" content="https://www.carta.tech/images/pen-pen-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pen.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pen (1) manual" />
  <meta property="og:description" content="Load balancer for "simple" tcp based protocols" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pen-pen-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pen<small> (1)</small></h1>
        <p class="lead">Load balancer for "simple" tcp based protocols</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pen.1.html">
      <span itemprop="name">pen: Load balancer for "simple" tcp based protocols</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pen/">
      <span itemprop="name">pen</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pen.1.html">
      <span itemprop="name">pen: Load balancer for "simple" tcp based protocols</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>pen</strong> [-b sec] [-S N] [-c N] [-e host:port] [-t sec] [-x N] [-j dir] [-u user] [-F cfgfile] [-l logfile] [-p file ] [-w file] [-C port|/path/to/socket] [-T sec] [-HWXadfhnrs] [-o option] [-E certfile] [-K keyfile] [-G cacertfile] [-A cacertdir] [-Z] [-R] [-L protocol] [host:]port|/path/to/socket h1[:p1[:maxc1[:hard1[:weight1[:prio1]]]]] [h2[:p2[:maxc2[:hard2[:weight2[:prio2]]]]]] ...</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>pen 80 www1:8000:10 www2:80:10 www3</p><p>Here three servers cooperate in a web server farm. Host www1 runs its web server on port 8000 and accepts a maximum of 10 simultaneous connections. Host www2 runs on port 80 and accepts 10 connections. Finally, www3 runs its web server on port 80 and allows an unlimited number of simultaneous connections.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Pen</em> is a load balancer for tcp based protocols such as http or smtp. It allows several servers to appear as one to the outside and automatically detects servers that are down and distributes clients among the available servers. This gives high availability and scalable performance.</p><p>The load balancing algorithm keeps track of clients and will try to send them back to the server they visited the last time. The client table has a number of slots (default 2048, settable through command-line arguments). When the table is full, the least recently used one will be thrown out to make room for the new one.</p><p>This is superior to a simple round-robin algorithm, which sends a client that connects repeatedly to different servers. Doing so breaks applications that maintain state between connections in the server, including most modern web applications.</p><p>When pen detects that a server is unavailable, it scans for another starting with the server after the most recently used one. That way we get load balancing and "fair" failover for free.</p><p>Correctly configured, pen can ensure that a server farm is always available, even when individual servers are brought down for maintenance or reconfiguration. The final single point of failure, pen itself, can be eliminated by running pen on several servers, using vrrp to decide which is active.</p><p>Sending pen a USR1 signal will make it print some useful statistics on stderr, even if debugging is disabled. If pen is running in the background (i.e. without the -f option), syslog is used rather than stderr. If the -w option is used, the statistics is saved in HTML format in the given file.</p><p>Sending pen a HUP signal will make it close and reopen the logfile, if logging is enabled, and reload the configuration file.</p><p>Rotate the log like this (assuming pen.log is the name of the logfile):</p><p>mv pen.log pen.log.1 kill -HUP `cat &lt;pidfile&gt;`</p><p>where &lt;pidfile&gt; is the file containing pen's process id, as written by the -p option.</p><p>Sending pen a TERM signal will make it exit cleanly, closing the log file and all open sockets.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>-C <em>port|/path/to/socket</em></p>
  </dt>
  <dd>
    <p>Specifies a control port where the load balancer listens for commands. See penctl.1 for a list of the commands available. The protocol is unauthenticated and the administrator is expected to restrict access using an access control list (for connections over a network) or Unix file permissions (for a Unix domain socket). Pen will normally refuse to open the control port if running as root; see -u option. If you still insist that you want to run pen as root with a control port, use "-u root".</p>
  </dd>
  <dt>
    <p>-F <em>cfgfile</em></p>
  </dt>
  <dd>
    <p>Names a configuration file with commands in penctl format (see penctl.1). The file is read after processing all command line arguments, and also after receiving a HUP signal.</p>
  </dd>
  <dt>
    <p>-H</p>
  </dt>
  <dd>
    <p>Adds X-Forwarded-For header to http requests.</p>
  </dd>
  <dt>
    <p>-P</p>
  </dt>
  <dd>
    <p>Use poll() for event notification.</p>
  </dd>
  <dt>
    <p>-Q</p>
  </dt>
  <dd>
    <p>Use kqueue() for event notification (BSD).</p>
  </dd>
  <dt>
    <p>-W</p>
  </dt>
  <dd>
    <p>Use weight for server selection.</p>
  </dd>
  <dt>
    <p>-X</p>
  </dt>
  <dd>
    <p>Adds an exit command to the control interface.</p>
  </dd>
  <dt>
    <p>-a</p>
  </dt>
  <dd>
    <p>Used in conjunction with -dd to get communication dumps in ascii rather than hexadecimal format.</p>
  </dd>
  <dt>
    <p>-b <em>sec</em></p>
  </dt>
  <dd>
    <p>Servers that do not respond are blacklisted, i.e. excluded from the server selection algorithm, for the specified number of seconds (default 30).</p>
  </dd>
  <dt>
    <p>-T <em>sec</em></p>
  </dt>
  <dd>
    <p>Clients are tracked for the specified number of seconds so they can be sent to the same server as the last time (default 0 = never expire clients).</p>
  </dd>
  <dt>
    <p>-S <em>N</em></p>
  </dt>
  <dd>
    <p>Max number of servers (default 16).</p>
  </dd>
  <dt>
    <p>-c <em>N</em></p>
  </dt>
  <dd>
    <p>Max number of clients (default 2048).</p>
  </dd>
  <dt>
    <p>-d</p>
  </dt>
  <dd>
    <p>Debugging (repeat -d for more). The output goes to stderr if we are running in the foreground (see -f) and to syslog (facility user, priority debug) otherwise.</p>
  </dd>
  <dt>
    <p>-e <em>host:port</em></p>
  </dt>
  <dd>
    <p>host:port specifies the emergency server to contact if all regular servers become unavailable.</p>
  </dd>
  <dt>
    <p>-f</p>
  </dt>
  <dd>
    <p>Stay in foreground.</p>
  </dd>
  <dt>
    <p>-h</p>
  </dt>
  <dd>
    <p>Use a hash on the client IP address for the initial server selection. This makes it more predictable where clients will be connected.</p>
  </dd>
  <dt>
    <p>-j <em>dir</em></p>
  </dt>
  <dd>
    <p>Run in a chroot environment.</p>
  </dd>
  <dt>
    <p>-l <em>file</em></p>
  </dt>
  <dd>
    <p>Turn on logging.</p>
  </dd>
  <dt>
    <p>-n</p>
  </dt>
  <dd>
    <p>Nonblocking.</p>
  </dd>
  <dt>
    <p>-p <em>file</em></p>
  </dt>
  <dd>
    <p>Write the pid of the running daemon to <em>file</em>.</p>
  </dd>
  <dt>
    <p>-r</p>
  </dt>
  <dd>
    <p>Go straight into round-robin server selection without looking up which server a client used the last time.</p>
  </dd>
  <dt>
    <p>-s</p>
  </dt>
  <dd>
    <p>Stubborn server selection: if the initial choice is unavailable, the client connection is closed without trying another server.</p>
  </dd>
  <dt>
    <p>-t <em>sec</em></p>
  </dt>
  <dd>
    <p>Connect timeout in seconds (default 5).</p>
  </dd>
  <dt>
    <p>-u <em>user</em></p>
  </dt>
  <dd>
    <p>Run as a different user.</p>
  </dd>
  <dt>
    <p>-x <em>N</em></p>
  </dt>
  <dd>
    <p>Max number of simultaneous connections (default 256).</p>
  </dd>
  <dt>
    <p>-w <em>file</em></p>
  </dt>
  <dd>
    <p>File for status reports in HTML format.</p>
  </dd>
  <dt>
    <p>-o <em>option</em></p>
  </dt>
  <dd>
    <p>Use option in penctl format.</p>
  </dd>
  <dt>
    <p>-E <em>certfile</em></p>
  </dt>
  <dd>
    <p>Use the given certificate in PEM format.</p>
  </dd>
  <dt>
    <p>-K <em>keyfile</em></p>
  </dt>
  <dd>
    <p>Use the given key in PEM format (may be contained in cert).</p>
  </dd>
  <dt>
    <p>-G <em>cacertfile</em></p>
  </dt>
  <dd>
    <p>File containing the CA's certificate.</p>
  </dd>
  <dt>
    <p>-A <em>cacertdir</em></p>
  </dt>
  <dd>
    <p>Directory containing CA certificates in hashed format.</p>
  </dd>
  <dt>
    <p>-Z</p>
  </dt>
  <dd>
    <p>Use SSL compatibility mode.</p>
  </dd>
  <dt>
    <p>-R</p>
  </dt>
  <dd>
    <p>Require valid peer certificate.</p>
  </dd>
  <dt>
    <p>-L <em>protocol</em></p>
  </dt>
  <dd>
    <p>ssl23, ssl3 or tls1 (default).</p>
  </dd>
  <dt>
    <p>[host:]port OR /path/to/socket</p>
  </dt>
  <dd>
    <p>The local address and port pen listens to. By default pen listens to all local addresses. Pen can also use a Unix domain socket as the local listening address.</p>
  </dd>
  <dt>
    <p>h1:p1:soft:hard:weight:prio</p>
  </dt>
  <dd>
    <p>The address, port and maximum number of simultaneous connections for a remote server. By default, the port is the same as the local port, and the soft limit on the number of connections is unlimited. The hard limit is used for clients which have accessed the server before. The weight and prio are used for the weight- and priority-based server selection algorithms.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p>Pen runs in a single process, and opens two sockets for each connection. Depending on kernel configuration, pen can run out of file descriptors.</p><p>SSL support is available if pen was built with the --with-ssl option.</p><p>GeoIP support is available if pen was built with the --with-geoip option.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pen&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/penctl.1.html"><strong>penctl</strong>(1)</a>, <strong>dwatch</strong>(1), <a href="../man1/mergelogs.1.html"><strong>mergelogs</strong>(1)</a>, <strong>webresolve</strong>(1)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2001-2014 Ulric Eriksson, &lt;ulric@siag.nu&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">
<p>In part inspired by balance by Thomas Obermair.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pelican-themes.1.html"><span aria-hidden="true">&larr;</span> pelican-themes.1: Install themes for pelican</a></li>
   <li class="next"><a href="penctl.1.html">penctl.1: Control a running pen load balancer <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
