<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>londiste3: Tool for managing trigger-based replication for postgresql.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Tool for managing trigger-based replication for postgresql.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="londiste3 (1) manual">
  <meta name="twitter:description" content="Tool for managing trigger-based replication for postgresql.">
  <meta name="twitter:image" content="https://www.carta.tech/images/skytools3-londiste3-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/londiste3.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="londiste3 (1) manual" />
  <meta property="og:description" content="Tool for managing trigger-based replication for postgresql." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/skytools3-londiste3-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">londiste3<small> (1)</small></h1>
        <p class="lead">Tool for managing trigger-based replication for postgresql.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/londiste3.1.html">
      <span itemprop="name">londiste3: Tool for managing trigger-based replication for postgresql.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/skytools3/">
      <span itemprop="name">skytools3</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/londiste3.1.html">
      <span itemprop="name">londiste3: Tool for managing trigger-based replication for postgresql.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
londiste3 &lt;config.ini&gt; command [subcommand] [options]
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Londiste allows you to setup and administer the replication, and is run as a daemon to handle the replication itself. (Londiste is just a complex PgQ Consumer).</p><p>See EXAMPLES below to start your first trigger-based replication in a few steps.</p><p>The <em>command</em> is one of Node, Replication, Information or Internal commands listed below.</p><p>Londiste introduces the notion of <em>takeover</em>. It is the action when a local node takes over the work of another node. The other node can be a root node or a branch node and it can be dead or alive when the action is run.</p><p>Londiste also allows (among many other features): cascading replication, partial replication and custom handlers for replication.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GENERAL OPTIONS</h2>
        <div class="sectioncontent">
<p>-V, --version</p><p>Print version info and exit.</p><p>-h, --help</p><p>Show this help message and exit.</p><p>-q, --quiet</p><p>Log only errors and warnings.</p><p>-v, --verbose</p><p>Log verbosely.</p><p>-d, --daemon</p><p>Run in daemon mode (go background).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SPECIFIC OPTIONS</h2>
        <div class="sectioncontent">
<p>--ini</p><p>Display sample ini file.</p><p>--set="<em>param=val[,param=value]</em>"</p><p>Override config setting.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DAEMON OPTIONS</h2>
        <div class="sectioncontent">
<p>-r, --reload</p><p>Reload config (send SIGHUP).</p><p>-s, --stop</p><p>Stop program safely (send SIGINT).</p><p>-k, --kill</p><p>Kill program immediately (send SIGTERM).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPLICATION EXTRA ARGUMENTS</h2>
        <div class="sectioncontent">
<p>--rewind</p><p>Change queue position according to destination.</p><p>--reset</p><p>Reset queue position on destination side.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NODE INITIALIZATION COMMANDS</h2>
        <div class="sectioncontent">
<p>Initialization commands will set up "public connect string" for current node. It is a connect string that other nodes will use to connect to current node. The local Londiste itself uses <em>db</em> option from config file to connect to local node, which can have different user rights than scripts coming over public connect string.</p><p>Connect strings can be set in either command line or config file. Command line overrides config. Setting them up in config might be more comfortable. See londiste3 --ini for details.</p><h3>create-root &lt;node&gt; [&lt;public_connstr_for_node&gt;]</h3>
<p>Initializes a Master node.</p><p>The &lt;node&gt; is the name of the node, it should be unique.</p>
<h3>create-branch &lt;node&gt; [&lt;public_connstr_for_node&gt;] [--provider=&lt;connstr_to_provider&gt;]</h3>
<p>Initializes a Slave node which can be used as a reference for other nodes.</p><p>The &lt;node&gt; is the name of the node, it should be unique. The &lt;public_connstr_for_node&gt; argument is the connection string to the database on the current node and &lt;connstr_to_provider&gt; is the connection string to the provider database (it can be a root node or a branch node).</p>
<h3>create-leaf &lt;node&gt; [&lt;public_connstr_for_node&gt;] [--provider=&lt;connstr_to_provider&gt;]</h3>
<p>Initializes a slave node which can not be used as a reference for other nodes.</p><p>The &lt;node&gt; is the name of the node, it should be unique. The &lt;public_connstr_for_node&gt; argument is the connection string to the database on the current node and &lt;connstr_to_provider&gt; is the connection string to the provider database (it can be a root node or a branch node).</p><p>--merge=<em>qname</em></p><p>combined queue name</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NODE ADMINISTRATION COMMANDS</h2>
        <div class="sectioncontent">
<h3>pause</h3>
<p>Pause the consumer: the replication of the events is stopped and can be resumed later.</p>
<h3>resume</h3>
<p>When the consumer has been paused, let it replay again.</p>
<h3>change-provider &lt;tonode&gt;</h3>
<p>Make &lt;tonode&gt; become the new provider for the current node.</p><p>TODO: londiste.py need update (param change from --provider)</p>
<h3>takeover &lt;fromnode&gt; [--target=&lt;tonode&gt;] [--all] [--dead]</h3>
<p>This command allows to achieve failover and switchover for any of your providers (root or branch nodes).</p><p>--target=<em>tonode</em></p><p>Target node of the takeover.</p><p>--all</p><p>In addition to take over the work from the <em>fromnode</em>, make other nodes change their provider to the current node.</p><p>--dead</p><p>Don\(cqt wait to take the new role and flag the <em>fromnode</em> as dead.</p><p>--dead=<em>deadnode</em></p><p>Assume node is dead. TODO : why use this one ?</p><p>--dead-root</p><p>Old node was root.</p><p>--dead-branch</p><p>Old node was branch</p>
<h3>resurrect</h3>
<p>In case root was down and taken over with --dead-root, this command fixes queue contents on that old root to match the rest of cascade. Events that did not propagate to rest of the cascade before failure (lost events) are dumped into file in JSON format and deleted from queue. Then the node is registered into cascade and it\(cqs worker will be paused.</p><p>It requires that there is another active root in cascade and there is consumer named NODENAME.gravestone registered on same node, it uses that to get position where rest of the cascade moved on.</p><p>It does not touch actual tables, which means there must be external mechanism to survive unsynced tables. Options:</p><p>Ignore lost events. May need trigger/rule on tables to handle conflicts.</p><p>Replay the lost events on new root. May need trigger/rule on tables to handle conflicts.</p><p>Roll back table changes. May need old version of row stored in events. (Achieved with backup parameter to pgq.logutriga)</p>
<h3>drop-node &lt;node&gt;</h3>
<p>Remove the node from the Londiste replication.</p><p>Londiste triggers on the node are removed but Londiste or PgQ are not removed.</p>
<h3>tag-dead &lt;node&gt;</h3>
<p>Tag the node as dead, the command can be run from any node in the replication.</p>
<h3>tag-alive &lt;node&gt;</h3>
<p>Tag the node as alive, the command can be run from any node in the replication.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INFORMATION COMMANDS</h2>
        <div class="sectioncontent">
<h3>status</h3>
<p>Show status of the replication viewed by the current node.</p><p>The output is a tree of the members of the replication with their lags, last tick, status and the number of tables in state: ok/half/ignored (replicated, initial copy not finnished, table not replicated locally).</p>
<h3>members</h3>
<p>Show members of the replication viewed by the current node.</p><p>Output the nodes name, status and node location (connection string to the node).</p>
<h3>show-consumers [--node]</h3>
<p>TODO: command is not working</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPLICATION DAEMON COMMAND</h2>
        <div class="sectioncontent">
<h3>worker</h3>
<p>Replay events to subscriber: it is needed to make the replication active as it will start to replay the events.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPLICATION ADMINISTRATION COMMANDS</h2>
        <div class="sectioncontent">
<h3>add-table &lt;table&gt; [args]</h3>
<p>Add the table to the replication.</p><p>See ADD ARGUMENTS below for the list of possible arguments.</p>
<h3>remove-table &lt;table&gt;</h3>
<p>Remove the table from the replication.</p>
<h3>add-seq &lt;seq&gt; [args]</h3>
<p>Add the sequence to the replication.</p><p>See ADD ARGUMENTS below for the list of possible arguments.</p>
<h3>remove-seq &lt;seq&gt;</h3>
<p>Remove the sequence from the replication.</p>
<h3>tables</h3>
<p>Show all tables on provider.</p>
<h3>seqs</h3>
<p>Show all sequences on provider.</p>
<h3>missing</h3>
<p>List tables subscriber has not yet attached to.</p>
<h3>resync &lt;table&gt;</h3>
<p>Do full copy of the table, again.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ADD ARGUMENTS</h2>
        <div class="sectioncontent">
<p>--all</p><p>Include all possible tables.</p><p>--wait-sync</p><p>Wait until newly added tables are synced fully.</p><p>--dest-table=<em>table</em></p><p>Redirect changes to different table.</p><p>--force</p><p>Ignore table differences.</p><p>--expect-sync</p><p>No copy needed.</p><p>--skip-truncate</p><p>Keep old data.</p><p>--create</p><p>Create table/sequence if not exist, with minimal schema.</p><p>--create-full</p><p>Create table/sequence if not exist, with full schema.</p><p>--trigger-flags=<em>trigger_flags</em></p><p>Trigger creation flags, see below for details.</p><p>--trigger-arg=<em>trigger_arg</em></p><p>Custom trigger arg (can be specified multiply times).</p><p>--no-triggers</p><p>Dont put triggers on table (makes sense on leaf node).</p><p>--handler=<em>handler</em></p><p>Custom handler for table.</p><p>--handler-arg=<em>handler_arg</em></p><p>Argument to custom handler.</p><p>--copy-node=<em>NODE_NAME</em></p><p>Do initial copy from that node instead from provider. Useful if provider does not contain table data locally or is simply under load.</p><p>--merge-all</p><p>Merge tables from all source queues.</p><p>--no-merge</p><p>Don\(cqt merge tables from source queues.</p><p>--max-parallel-copy=<em>max_parallel_copy</em></p><p>Max number of parallel copy processes.</p><p>--skip-non-existing</p><p>Skip objects that do not exist.</p><p>Trigger creation flags (default: AIUDL):</p><p>I - ON INSERT</p><p>U - ON UPDATE</p><p>D - ON DELETE</p><p>Q - use pgq.sqltriga() as trigger function</p><p>L - use pgq.logutriga() as trigger function</p><p>B - BEFORE</p><p>A - AFTER</p><p>S - SKIP</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPLICATION EXTRA COMMANDS</h2>
        <div class="sectioncontent">
<h3>check</h3>
<p>Compare table structure on both sides.</p>
<h3>fkeys</h3>
<p>Print out fkey drop/create commands.</p>
<h3>compare [&lt;table&gt;]</h3>
<p>Compare table contents on both sides.</p><p>--count-only</p><p>Just count rows, do not compare data.</p>
<h3>repair [&lt;table&gt;] [--force]</h3>
<p>Repair data on subscriber.</p><p>--force</p><p>Ignore lag.</p>
<h3>execute [filepath]</h3>
<p>Execute SQL files on each node of the cascaded queue. The SQL file is executed locally in single transaction and inserted into queue in same transaction. Thus guaranteeing that is will be replayed in subscriber databases at correct position.</p><p>The filename is stored in londiste.applied_execute table, and checked before execution. If same filename already exists, the SQL execution is skipped.</p><p><strong>SQL meta-data attributes</strong></p><p>SQL file can contain attributes that limit where the SQL is executed:</p>
<pre>
--*--
--*-- Local-Table: mytable, othertable,
--*--              thirdtable
--*-- Local-Sequence: thisseq
--*--
</pre>
<p>The magic comments are searched only in file start, before any actual SQL statement is seen. Empty lines and lines with regular SQL comments are ignored.</p><p>Supported keys:</p><p>Local-Table</p><p>Table must be added to local node with add-table.</p><p>Local-Sequence</p><p>Sequence must be added to local node with add-seq.</p><p>Local-Destination</p><p>Table must be added to local node and actual destination table must exists. This is for cases where table is added to some nodes with handler that does not need actual table to exist.</p><p>Need-Table</p><p>Physical table must exist in database. It does not matter if it is replicated or not.</p><p>Need-Sequence</p><p>Sequence must exist in database.</p><p>Need-Function</p><p>Database function must exists. The function name is in form function_name(nargs). If the (nargs) portion is missed then nargs is taken as 0.</p><p>Need-View</p><p>A view must exist in database.</p><p>Need-Schema</p><p>Schema mist exist in database.</p><p>Londiste supports table renaming, where table is attached to queue with one name but events are applied to local table with different name. To make this work with EXECUTE, the Local-Toble and Local-Destination support tag replacement, where queue\(cqs table name that is mentioned in attribute is replaced with actual table name in local database:</p>
<pre>
--*-- Local-Table: mytable
ALTER TABLE @mytable@ ...;
</pre>

<h3>show-handlers [\fIhandler\fR]</h3>
<p>Show info about all or a specific handler.</p>
<h3>wait-sync</h3>
<p>Wait until all added tables are copied over.</p>
<h3>wait-provider</h3>
<p>Wait until local node passes latest queue position on provider.</p>
<h3>wait-root</h3>
<p>Wait until local node passes latest queue position on root.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTERNAL COMMAND</h2>
        <div class="sectioncontent">
<h3>copy</h3>
<p>Copy table logic.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p>0</p><p>Successful program execution.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>PostgreSQL environment variables can be used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Londiste is provided with HowTos to help you make your fisrt steps:</p><p>How to set up simple replication.</p><p>How to set up cascaded replication.</p><p>How to set up table partitioning (handlers).</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lomoco.1.html"><span aria-hidden="true">&larr;</span> lomoco.1: Logitech mouse control for usb mice</a></li>
   <li class="next"><a href="longrun.1.html">longrun.1: Transmeta(tm) crusoe(tm) longrun(tm) utility <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
