<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pg_resetxlog: Reset the write-ahead log and other control information of a postgresql database cluster</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Reset the write-ahead log and other control information of a postgresql database cluster">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pg_resetxlog (1) manual">
  <meta name="twitter:description" content="Reset the write-ahead log and other control information of a postgresql database cluster">
  <meta name="twitter:image" content="https://www.carta.tech/images/postgresql-9.4-pg_resetxlog-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pg_resetxlog.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pg_resetxlog (1) manual" />
  <meta property="og:description" content="Reset the write-ahead log and other control information of a postgresql database cluster" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/postgresql-9.4-pg_resetxlog-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pg_resetxlog<small> (1)</small></h1>
        <p class="lead">Reset the write-ahead log and other control information of a postgresql database cluster</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pg_resetxlog.1.html">
      <span itemprop="name">pg_resetxlog: Reset the write-ahead log and other control information of a postgresql database cluster</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/postgresql-9.4/">
      <span itemprop="name">postgresql-9.4</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pg_resetxlog.1.html">
      <span itemprop="name">pg_resetxlog: Reset the write-ahead log and other control information of a postgresql database cluster</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>pg_resetxlog</strong> [<strong>-f</strong>] [<strong>-n</strong>] [<strong>-o</strong>&nbsp;<em>oid</em>] [<strong>-x</strong>&nbsp;<em>xid</em>] [<strong>-e</strong>&nbsp;<em>xid_epoch</em>] [<strong>-m</strong>&nbsp;<em>mxid</em>,<em>mxid</em>] [<strong>-O</strong>&nbsp;<em>mxoff</em>] [<strong>-l</strong>&nbsp;<em>xlogfile</em>] <em>datadir</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>pg_resetxlog</strong> clears the write-ahead log (WAL) and optionally resets some other control information stored in the pg_control file. This function is sometimes needed if these files have become corrupted. It should be used only as a last resort, when the server will not start due to such corruption.</p><p>After running this command, it should be possible to start the server, but bear in mind that the database might contain inconsistent data due to partially-committed transactions. You should immediately dump your data, run <strong>initdb</strong>, and reload. After reload, check for inconsistencies and repair as needed.</p><p>This utility can only be run by the user who installed the server, because it requires read/write access to the data directory. For safety reasons, you must specify the data directory on the command line. <strong>pg_resetxlog</strong> does not use the environment variable <strong>PGDATA</strong>.</p><p>If <strong>pg_resetxlog</strong> complains that it cannot determine valid data for pg_control, you can force it to proceed anyway by specifying the <strong>-f</strong> (force) option. In this case plausible values will be substituted for the missing data. Most of the fields can be expected to match, but manual assistance might be needed for the next OID, next transaction ID and epoch, next multitransaction ID and offset, and WAL starting address fields. These fields can be set using the options discussed below. If you are not able to determine correct values for all these fields, <strong>-f</strong> can still be used, but the recovered database must be treated with even more suspicion than usual: an immediate dump and reload is imperative. <em>Do not</em> execute any data-modifying operations in the database before you dump, as any such action is likely to make the corruption worse.</p><p>The <strong>-o</strong>, <strong>-x</strong>, <strong>-e</strong>, <strong>-m</strong>, <strong>-O</strong>, and <strong>-l</strong> options allow the next OID, next transaction ID, next transaction ID&apos;s epoch, next and oldest multitransaction ID, next multitransaction offset, and WAL starting address values to be set manually. These are only needed when <strong>pg_resetxlog</strong> is unable to determine appropriate values by reading pg_control. Safe values can be determined as follows:</p><p>A safe value for the next transaction ID (<strong>-x</strong>) can be determined by looking for the numerically largest file name in the directory pg_clog under the data directory, adding one, and then multiplying by 1048576. Note that the file names are in hexadecimal. It is usually easiest to specify the option value in hexadecimal too. For example, if 0011 is the largest entry in pg_clog, -x 0x1200000 will work (five trailing zeroes provide the proper multiplier).</p><p>A safe value for the next multitransaction ID (first part of <strong>-m</strong>) can be determined by looking for the numerically largest file name in the directory pg_multixact/offsets under the data directory, adding one, and then multiplying by 65536. Conversely, a safe value for the oldest multitransaction ID (second part of <strong>-m</strong>) can be determined by looking for the numerically smallest file name in the same directory and multiplying by 65536. As above, the file names are in hexadecimal, so the easiest way to do this is to specify the option value in hexadecimal and append four zeroes.</p><p>A safe value for the next multitransaction offset (<strong>-O</strong>) can be determined by looking for the numerically largest file name in the directory pg_multixact/members under the data directory, adding one, and then multiplying by 52352. As above, the file names are in hexadecimal. There is no simple recipe such as the ones above of appending zeroes.</p><p>The WAL starting address (<strong>-l</strong>) should be larger than any WAL segment file name currently existing in the directory pg_xlog under the data directory. These names are also in hexadecimal and have three parts. The first part is the &ldquo;timeline ID&rdquo; and should usually be kept the same. For example, if 00000001000000320000004A is the largest entry in pg_xlog, use -l 00000001000000320000004B or higher.</p><p><strong>Note</strong></p><p><strong>pg_resetxlog</strong> itself looks at the files in pg_xlog and chooses a default <strong>-l</strong> setting beyond the last existing file name. Therefore, manual adjustment of <strong>-l</strong> should only be needed if you are aware of WAL segment files that are not currently present in pg_xlog, such as entries in an offline archive; or if the contents of pg_xlog have been lost entirely.</p><p>There is no comparably easy way to determine a next OID that&apos;s beyond the largest one in the database, but fortunately it is not critical to get the next-OID setting right.</p><p>The transaction ID epoch is not actually stored anywhere in the database except in the field that is set by <strong>pg_resetxlog</strong>, so any value will work so far as the database itself is concerned. You might need to adjust this value to ensure that replication systems such as Slony-I work correctly &ndash; if so, an appropriate value should be obtainable from the state of the downstream replicated database.</p><p>The <strong>-n</strong> (no operation) option instructs <strong>pg_resetxlog</strong> to print the values reconstructed from pg_control and values about to be changed, and then exit without modifying anything. This is mainly a debugging tool, but can be useful as a sanity check before allowing <strong>pg_resetxlog</strong> to proceed for real.</p><p>The <strong>-V</strong> and <strong>--version</strong> options print the pg_resetxlog version and exit. The options <strong>-?</strong> and <strong>--help</strong> show supported arguments, and exit.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>This command must not be used when the server is running. <strong>pg_resetxlog</strong> will refuse to start up if it finds a server lock file in the data directory. If the server crashed then a lock file might have been left behind; in that case you can remove the lock file to allow <strong>pg_resetxlog</strong> to run. But before you do so, make doubly certain that there is no server process still alive.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pg_recvlogical.1.html"><span aria-hidden="true">&larr;</span> pg_recvlogical.1: Control postgresql logical decoding streams</a></li>
   <li class="next"><a href="pg_restore.1.html">pg_restore.1: Restore a postgresql database from an archive file created by pg_dump <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
