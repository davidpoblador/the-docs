<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sockdown: Shutdown(2) a socket  netpipes 4.2</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Shutdown(2) a socket  netpipes 4.2">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="sockdown (1) manual">
  <meta name="twitter:description" content="Shutdown(2) a socket  netpipes 4.2">
  <meta name="twitter:image" content="https://www.carta.tech/images/netpipes-sockdown-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/sockdown.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="sockdown (1) manual" />
  <meta property="og:description" content="Shutdown(2) a socket  netpipes 4.2" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/netpipes-sockdown-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">sockdown<small> (1)</small></h1>
        <p class="lead">Shutdown(2) a socket  netpipes 4.2</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/sockdown.1.html">
      <span itemprop="name">sockdown: Shutdown(2) a socket  netpipes 4.2</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/netpipes/">
      <span itemprop="name">netpipes</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/sockdown.1.html">
      <span itemprop="name">sockdown: Shutdown(2) a socket  netpipes 4.2</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>sockdown</strong> [ <em>fd</em> [<em>how</em>] ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>sockdown</strong> performs the <a href="../man2/shutdown.2.html"><strong>shutdown</strong>(2)</a> system call on one of its file descriptors specified by <em>fd</em>.  The possible values for <em>how</em> are</p><table class="table table-striped">
<tr>
<th>writeonly</th></tr>

<tr>
<td>convert to write-only file descriptor</td></tr>

<tr>
<td>0</td></tr>

<tr>
<td>convert to write-only file descriptor</td></tr>

<tr>
<td>writeonly</td></tr>

<tr>
<td>symbolic for same as above</td></tr>

<tr>
<td>1</td></tr>

<tr>
<td>convert to read-only file descriptor</td></tr>

<tr>
<td>readonly</td></tr>

<tr>
<td>symbolic for same as above</td></tr>

<tr>
<td>2</td></tr>

<tr>
<td>complete shutdown.  no more reads or writes are allowed</td></tr>

<tr>
<td>totally</td></tr>

<tr>
<td>symbolic for same as above</td></tr>
</table><p>The default <em>fd</em> is 1 (stdout) and the default <em>how</em> is 1.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Imagine you have a machine that can perform a service (in this case conversion from ASCII to fancy postscript) :</p>
<pre>
server$ faucet 3000 --in --out enscript -2rGhp -
</pre>
<p>You may then connect to it with a hose.  However, the first example enters deadlock :</p>
<pre>
client$ hose server 3000 -in -out &#92;
	sh -c " cat blah.txt & cat &gt; blah.ps "
</pre>
<p>The enscript blocks waiting for input from the socket because not all of the client processes have exited.  While the cat blah.txt is finished, the cat &gt; blah.ps is not, and will not be finished until the remote enscript process finishes writing.  The enscript process will not finish writing until it is finished reading, but that client-&gt;server half of the socket is still open and will not be closed until all the client processes are done.  The result is deadlock.</p><p>So, we use sockdown to close half of the pipe</p>
<pre>
client$ hose server 3000 -in -out &#92;
	sh -c " ( cat blah.txt ; sockdown ) & cat &gt; blah.ps "
</pre>
<p>This way when the cat blah.txt is done, half of the socket is shut down and the remote enscript process runs out of input, causing it to flush its output and exit, so eventually the whole mess finishes cleanly.</p><p>Note: the & on the hose is necessary to prevent another deadlock.  If we simply used the ; to serialize the two cat processes it is possible that the enscript would fill up its write buffer before the first cat was done causing both processes to block and preventing the second cat from draining the pipe.</p><p>Of course, that idiomatic usage of hose is so useful that it is a special form:</p>
<pre>
client$ hose server 3000 -slave &lt; blah.txt &gt; blah.ps
</pre>
<p>Ian Stirling &lt;root@mauve.demon.co.uk&gt; informs me that <strong>sockdown</strong> can be used in Linux's /proc/<em>pid</em>/fd/ directories to tear down hung network connections.  I have since used this myself on a wedged MOMspider.  To try this, you have to know the PID of the program and the file descriptor of the wedged socket (can sometimes be found by running <strong>strace</strong> and see if the program is stuck in a <a href="../man2/read.2.html"><strong>read</strong>(2)</a> system call).  If the PID is 991 and the socket's descriptor is 5, you do this as root:</p>
<pre>
bash# sockdown 1 2 &gt; /proc/991/fd/5
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERRORS</h2>
        <div class="sectioncontent">
<p><strong>Socket operation on non-socket</strong></p><p><strong>Invalid argument (seen on Solaris)</strong> The <em>fd</em> you specified does not refer to a socket.  This happens when you run sockdown by itself (it is unlikely that any of the file descriptors attached to an interactive shell are actually sockets) or if you goof up your faucet/hose command and forgot to <a href="../man2/dup.2.html"><strong>dup</strong>(2)</a> one of your descriptors.</p><p><strong>Bad file number</strong> You gave it a bad file number for <em>fd</em>.  If you have enough skill to actually generate this error, you probably know what is wrong.</p><p>If you encounter any other errors, clue me in.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO sockdown&hellip;</h2>
        <div class="sectioncontent">
<p>netpipes (1) faucet (1), hose (1), getpeername (1), socket (2), shutdown (2),</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Any normal human would assume a program this simple has to be bug free, but I am an experienced programmer.</p><p>Just avoid doing anything funky like passing <strong>sockdown</strong> strings and it should serve you well.  You should not have to pass it any arguments unless you are doing something fairly funky.</p><p>Perhaps I should ditch the <strong>shutdown -a</strong> semantics on hose since a <strong>sockdown 1 2</strong> would do the job.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CREDITS</h2>
        <div class="sectioncontent">
<p>Ian Stirling &lt;root@mauve.demon.co.uk&gt;, for the idea of using this program in /proc on a Linux machine.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 1995-1998 Robert Forsman</p><p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Robert Forsman  thoth@purplefrog.com  Purple Frog Software  http://web.purplefrog.com/~thoth/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="sockdebug.1.html"><span aria-hidden="true">&larr;</span> sockdebug.1: Creates a unix domain socket prints all received data to stdout.</a></li>
   <li class="next"><a href="socket.1.html">socket.1: Create a tcp or a unix domain socket and connect to stdin/out <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
