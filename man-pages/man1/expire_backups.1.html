<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>expire_backups: Intelligently expire old backups</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Intelligently expire old backups">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="expire_backups (1) manual">
  <meta name="twitter:description" content="Intelligently expire old backups">
  <meta name="twitter:image" content="https://www.carta.tech/images/s3ql-expire_backups-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/expire_backups.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="expire_backups (1) manual" />
  <meta property="og:description" content="Intelligently expire old backups" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/s3ql-expire_backups-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">expire_backups<small> (1)</small></h1>
        <p class="lead">Intelligently expire old backups</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/expire_backups.1.html">
      <span itemprop="name">expire_backups: Intelligently expire old backups</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/s3ql/">
      <span itemprop="name">s3ql</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/expire_backups.1.html">
      <span itemprop="name">expire_backups: Intelligently expire old backups</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
expire_backups [options] &lt;age&gt; [&lt;age&gt; ...]
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <strong>expire_backups</strong> command intelligently remove old backups that are no longer needed.</p><p>To define what backups you want to keep for how long, you define a number of <em>age ranges</em>. <strong>expire_backups</strong> ensures that you will have at least one backup in each age range at all times. It will keep exactly as many backups as are required for that and delete any backups that become redundant.</p><p>Age ranges are specified by giving a list of range boundaries in terms of backup cycles. Every time you create a new backup, the existing backups age by one cycle.</p><p>Example: when <strong>expire_backups</strong> is called with the age range definition <strong>1 3 7 14 31</strong>, it will guarantee that you always have the following backups available:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>A backup that is 0 to 1 cycles old (i.e, the most recent backup)</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>A backup that is 1 to 3 cycles old</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>A backup that is 3 to 7 cycles old</p>
  </dd>
  <dt>
    4.
  </dt>
  <dd>
    <p>A backup that is 7 to 14 cycles old</p>
  </dd>
  <dt>
    5.
  </dt>
  <dd>
    <p>A backup that is 14 to 31 cycles old</p><p><strong>NOTE:</strong> If you do backups in fixed intervals, then one cycle will be equivalent to the backup interval. The advantage of specifying the age ranges in terms of backup cycles rather than days or weeks is that it allows you to gracefully handle irregular backup intervals. Imagine that for some reason you do not turn on your computer for one month. Now all your backups are at least a month old, and if you had specified the above backup strategy in terms of absolute ages, they would all be deleted! Specifying age ranges in terms of backup cycles avoids these sort of problems.</p><p><strong>expire_backups</strong> usage is simple. It requires backups to have names of the forms <strong>year-month-day_hour:minute:seconds</strong> (<strong>YYYY-MM-DD_HH:mm:ss</strong>) and works on all backups in the current directory. So for the above backup strategy, the correct invocation would be:</p>
<pre>
expire_backups.py 1 3 7 14 31
</pre>
<p>When storing your backups on an S3QL file system, you probably want to specify the <strong>--use-s3qlrm</strong> option as well. This tells <strong>expire_backups</strong> to use the <em>s3qlrm</em> command to delete directories.</p><p><strong>expire_backups</strong> uses a "state file" to keep track which backups are how many cycles old (since this cannot be inferred from the dates contained in the directory names). The standard name for this state file is <strong>.expire_backups.dat</strong>. If this file gets damaged or deleted, <strong>expire_backups</strong> no longer knows the ages of the backups and refuses to work. In this case you can use the <strong>--reconstruct-state</strong> option to try to reconstruct the state from the backup dates. However, the accuracy of this reconstruction depends strongly on how rigorous you have been with making backups (it is only completely correct if the time between subsequent backups has always been exactly the same), so it&apos;s generally a good idea not to tamper with the state file.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>The <strong>expire_backups</strong> command accepts the following options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--quiet</strong></p>
  </dt>
  <dd>
    <p>be really quiet</p>
  </dd>
  <dt>
    <p><strong>--debug-modules</strong><em></em><strong>&lt;modules&gt;</strong></p>
  </dt>
  <dd>
    <p>Activate debugging output from specified modules (use commas to separate multiple modules). Debug messages will be written to the target specified by the <strong>--log</strong> option.</p>
  </dd>
  <dt>
    <p><strong>--debug</strong></p>
  </dt>
  <dd>
    <p>Activate debugging output from all S3QL modules. Debug messages will be written to the target specified by the <strong>--log</strong> option.</p>
  </dd>
  <dt>
    <p><strong>--version</strong></p>
  </dt>
  <dd>
    <p>just print program version and exit</p>
  </dd>
  <dt>
    <p><strong>--state</strong><em></em><strong>&lt;file&gt;</strong></p>
  </dt>
  <dd>
    <p>File to save state information in (default: ".expire_backups.dat")</p>
  </dd>
  <dt>
    <p><strong>-n</strong></p>
  </dt>
  <dd>
    <p>Dry run. Just show which backups would be deleted.</p>
  </dd>
  <dt>
    <p><strong>--reconstruct-state</strong></p>
  </dt>
  <dd>
    <p>Try to reconstruct a missing state file from backup dates.</p>
  </dd>
  <dt>
    <p><strong>--use-s3qlrm</strong></p>
  </dt>
  <dd>
    <p>Use <strong>s3qlrm</strong> command to delete backups.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT CODES</h2>
        <div class="sectioncontent">
<p><strong>expire_backups</strong> may terminate with the following exit codes:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>0</strong></p>
  </dt>
  <dd>
    <p>Everything went well.</p>
  </dd>
  <dt>
    <p><strong>1</strong></p>
  </dt>
  <dd>
    <p>An unexpected error occured. This may indicate a bug in the program.</p>
  </dd>
  <dt>
    <p><strong>2</strong></p>
  </dt>
  <dd>
    <p>Invalid command line argument.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO expire_backups&hellip;</h2>
        <div class="sectioncontent">
<p><strong>expire_backups</strong> is shipped as part of S3QL, <em>https://bitbucket.org/nikratio/s3ql/</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>© 2008 Nikolaus Rath &lt;Nikolaus@rath.org&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="expireGititCache.1.html"><span aria-hidden="true">&larr;</span> expireGititCache.1: Requests cache expiration for gitit pages</a></li>
   <li class="next"><a href="expiry.1.html">expiry.1: Check and enforce password expiration policy <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
