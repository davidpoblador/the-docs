<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mu-index: Index e-mail messages stored in maildirs</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Index e-mail messages stored in maildirs">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mu-index (1) manual">
  <meta name="twitter:description" content="Index e-mail messages stored in maildirs">
  <meta name="twitter:image" content="https://www.carta.tech/images/maildir-utils-mu-index-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/mu-index.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mu-index (1) manual" />
  <meta property="og:description" content="Index e-mail messages stored in maildirs" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/maildir-utils-mu-index-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mu-index<small> (1)</small></h1>
        <p class="lead">Index e-mail messages stored in maildirs</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mu-index.1.html">
      <span itemprop="name">mu-index: Index e-mail messages stored in maildirs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/maildir-utils/">
      <span itemprop="name">maildir-utils</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mu-index.1.html">
      <span itemprop="name">mu-index: Index e-mail messages stored in maildirs</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mu index [options]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mu index</strong> is the <strong>mu</strong> command for scanning the contents of Maildir directories and storing the results in a Xapian database. The data can then be queried using <a href="../man1/mu-find.1.html"><strong>mu-find</strong>(1)</a></strong> .</p><p><strong>index</strong> understands Maildirs as defined by Daniel Bernstein for <a href="../man7/qmail.7.html"><strong>qmail</strong>(7)</a>. In addition, it understands recursive Maildirs (Maildirs within Maildirs), Maildir++. It can also deal with VFAT-based Maildirs which use '!' as the separators instead of ':' as used by <em>Tinymail</em>/<em>Modest</em> and some other e-mail programs.</p><p>E-mail messages which are not stored in something resembling a maildir leaf-directory (<em>cur</em> and <em>new</em>) are ignored, as are the cache directories for <em>notmuch</em> and <em>gnus</em>.</p><p>Symlinks are not followed.</p><p>If there is a file called <em>.noindex</em> in a directory, the contents of that directory and all of its subdirectories will be ignored. This can be useful to exclude certain directories from the indexing process, for example directories with spam-messages.</p><p>If there is a file called <em>.noupdate</em> in a directory, the contents of that directory and all of its subdirectories will be ignored, unless we do a full rebuild (with <strong>--rebuild</strong>). This can be useful to speed up things you have some maildirs that never change. Note that you can still search for these messages, this only affects updating the database.</p><p>The first run of <strong>mu index</strong> may take a few minutes if you have a lot of mail (tens of thousands of messages).  Fortunately, such a full scan needs to be done only once; after that it suffices to index the changes, which goes much faster. See the 'Note on performance' below for more information.</p><p>The optional 'phase two' of the indexing-process is the removal of messages from the database for which there is no longer a corresponding file in the Maildir. If you do not want this, you can use <strong>-n</strong>, <strong>--nocleanup</strong>.</p><p>When <strong>mu index</strong> catches one of the signals <strong>SIGINT</strong>, <strong>SIGHUP</strong> or <strong>SIGTERM</strong> (e.g., when you press Ctrl-C during the indexing process), it tries to shutdown gracefully; it tries to save and commit data, and close the database etc. If it receives another signal (e.g., when pressing Ctrl-C once more), <strong>mu index</strong> will terminate immediately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Note, some of the general options are described in the <strong>mu(1)</strong> man-page and not here, as they apply to multiple mu commands.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-m</strong>, <strong>--maildir</strong>=<em>&lt;maildir&gt;</em></p>
  </dt>
  <dd>
    <p>starts searching at <em>&lt;maildir&gt;</em>. By default, <strong>mu</strong> uses whatever the <strong>MAILDIR</strong> environment variable is set to; if it is not set, it tries <em>~/Maildir</em>. See the note on mixing sub-maildirs below.</p>
  </dd>
  <dt>
    <p><strong>--my-address</strong>=<em>&lt;my-email-address&gt;</em></p>
  </dt>
  <dd>
    <p>specifies that some e-mail address is 'my-address' (<strong>--my-address</strong> can be used multiple times). This is used by <strong>mu cfind</strong> -- any e-mail address found in the address fields of a message which also has <em>&lt;my-email-address&gt;</em> in one of its address fields is considered a <em>personal</em> e-mail address. This allows you, for example, to filter out (<strong>mu cfind --personal</strong>) addresses which were merely seen in mailing list messages.</p>
  </dd>
  <dt>
    <p><strong>--nocleanup</strong></p>
  </dt>
  <dd>
    <p>disables the database cleanup that <strong>mu</strong> does by default after indexing.</p>
  </dd>
  <dt>
    <p><strong>--rebuild</strong></p>
  </dt>
  <dd>
    <p>clear all messages from the database before indexing. <strong>--rebuild</strong> guarantees that after the indexing has finished, there are no 'old' messages in the database anymore, which is not true with <strong>--reindex</strong> when indexing only a part of messages (using <strong>--maildir</strong>). For this reason, it is necessary to run <strong>mu index --rebuild</strong> when there is an upgrade in the database format. <strong>mu index</strong> will issue a warning about this.</p>
  </dd>
  <dt>
    <p><strong>--autoupgrade</strong></p>
  </dt>
  <dd>
    <p>automatically use <strong>-y</strong>, <strong>--empty</strong> when <strong>mu</strong> notices that the database version is not up-to-date. This option is for use in cron scripts and the like, so they won't require any user interaction, even when mu introduces a new database version.</p>
  </dd>
  <dt>
    <p><strong>--xbatchsize</strong>=<em>&lt;batch size&gt;</em></p>
  </dt>
  <dd>
    <p>set the maximum number of messages to process in a single Xapian transaction. In practice, this option is only useful if you find that <strong>mu</strong> is running out of memory while indexing; in that case, you can set the batch size to (for example) 1000, which will reduce memory consumption, but also substantially reduce the indexing performance.</p>
  </dd>
  <dt>
    <p><strong>--max-msg-size</strong>=<em>&lt;max msg size&gt;</em></p>
  </dt>
  <dd>
    <p>set the maximum size (in bytes) for messages. The default maximum (currently at 50Mb) should be enough in most cases, but if you encounter warnings from <strong>mu</strong> about ignoring messsage because they are too big, you may want to increase this. Note that the reason for having a maximum size is that big message require big memory allocations, which may lead to problems.</p><p><strong>NOTE:</strong> It is not recommended to mix maildirs and sub-maildirs within the hierarchy in the same database; for example, it's better not to index both with <strong>--maildir</strong>=~/MyMaildir and <strong>--maildir</strong>=~/MyMaildir/foo, as this may lead to unexpected results when searching with the 'maildir:' search parameter (see below).</p>
  </dd>

</dl>
<h3>A note on performance (i)</h3>
<p>As a non-scientific benchmark, a simple test on the author's machine (a Thinkpad X61s laptop using Linux 2.6.35 and an ext3 file system) with no existing database, and a maildir with 27273 messages:</p>
<pre>
 $ sudo sh -c 'sync && echo 3 &gt; /proc/sys/vm/drop_caches'
 $ time mu index --quiet
 66,65s user 6,05s system 27% cpu 4:24,20 total
</pre>
<p>(about 103 messages per second)</p><p>A second run, which is the more typical use case when there is a database already, goes much faster:</p>
<pre>
 $ sudo sh -c 'sync && echo 3 &gt; /proc/sys/vm/drop_caches'
 $ time mu index --quiet
 0,48s user 0,76s system 10% cpu 11,796 total
</pre>
<p>(more than 56818 messages per second)</p><p>Note that each test flushes the caches first; a more common use case might be to run <strong>mu index</strong> when new mail has arrived; the cache may stay quite 'warm' in that case:</p>
<pre>
 $ time mu index --quiet
 0,33s user 0,40s system 80% cpu 0,905 total
</pre>
<p>which is more than 30000 messages per second.</p>
<h3>A note on performance (ii)</h3>
<p>As per June 2012, we did the same non-scientific benchmark, this time with an Intel) i5-2500 CPU @ 3.30GHz, an ext4 file system and a maildir with 22589 messages.</p>
<pre>
 $ sudo sh -c 'sync && echo 3 &gt; /proc/sys/vm/drop_caches'
 $ time mu index --quiet
 27,79s user 2,17s system 48% cpu 1:01,47 total
</pre>
<p>(about 813 messages per second)</p><p>A second run, which is the more typical use case when there is a database already, goes much faster:</p>
<pre>
 $ sudo sh -c 'sync && echo 3 &gt; /proc/sys/vm/drop_caches'
 $ time mu index --quiet
 0,13s user 0,30s system 19% cpu 2,162 total
</pre>
<p>(more than 173000 messages per second)</p><p>In general, <strong>mu</strong> has been getting faster with each release, even with relatively expensive new features such as text-normalization (for case-insensitve/accent-insensitive matching). The profiles are dominated by operations in the Xapian database now.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>By default, <strong>mu index</strong> stores its message database in <em>~/.mu/xapian</em>; the database has an embedded version number, and <strong>mu</strong> will automatically update it when it notices a different version. This allows for automatic updating of <strong>mu</strong>-versions, without the need to clear out any old databases.</p><p>However, note that versions of <strong>mu</strong> before 0.7 used a different scheme, which puts the database in <em>~/.mu/xapian-&lt;version&gt;</em>. These older databases can safely be deleted. Starting from version 0.7, this manual cleanup should no longer be needed.</p><p><strong>mu</strong> stores logs of its operations and queries in <em>&lt;muhome&gt;/mu.log</em> (by default, this is <em>~/.mu/mu.log</em>). Upon startup, <strong>mu</strong> checks the size of this log file. If it exceeds 1 MB, it will be moved to <em>~/.mu/mu.log.old</em>, overwriting any existing file of that name, and start with an empty log file. This scheme allows for continued use of <strong>mu</strong> without the need for any manual maintenance of log files.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p><strong>mu index</strong> uses <strong>MAILDIR</strong> to find the user's Maildir if it has not been specified explicitly with <strong>--maildir</strong>=<em>&lt;maildir&gt;</em>. If <strong>MAILDIR</strong> is not set, <strong>mu index</strong> will try <em>~/Maildir</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN VALUE</h2>
        <div class="sectioncontent">
<p><strong>mu index</strong> return 0 upon successful completion, and any other number greater than 0 signals an error.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Please report bugs if you find them: <strong>http://code.google.com/p/mu0/issues/list</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Dirk-Jan C. Binnema &lt;djcb@djcbsoftware.nl&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mu-index&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/maildir.5.html"><strong>maildir</strong>(5)</a></strong> <strong>mu(1)</strong> <a href="../man1/mu-find.1.html"><strong>mu-find</strong>(1)</a></strong> <a href="../man1/mu-cfind.1.html"><strong>mu-cfind</strong>(1)</a></strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mu-help.1.html"><span aria-hidden="true">&larr;</span> mu-help.1: Help information about mu commands.</a></li>
   <li class="next"><a href="mu-mkdir.1.html">mu-mkdir.1: Create a new maildir <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
