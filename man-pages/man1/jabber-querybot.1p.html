<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jabber-querybot: A modular perl jabber bot</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A modular perl jabber bot">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="jabber-querybot (1p) manual">
  <meta name="twitter:description" content="A modular perl jabber bot">
  <meta name="twitter:image" content="https://www.carta.tech/images/jabber-querybot-jabber-querybot-1p.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1p/jabber-querybot.1p.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="jabber-querybot (1p) manual" />
  <meta property="og:description" content="A modular perl jabber bot" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/jabber-querybot-jabber-querybot-1p.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">jabber-querybot<small> (1p)</small></h1>
        <p class="lead">A modular perl jabber bot</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/jabber-querybot.1p.html">
      <span itemprop="name">jabber-querybot: A modular perl jabber bot</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/jabber-querybot/">
      <span itemprop="name">jabber-querybot</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/jabber-querybot.1p.html">
      <span itemprop="name">jabber-querybot: A modular perl jabber bot</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>jabber-querybot connects a jabber account and wait for messages. If a message comes in, it forward it to your self programmend modul. The return string of your module, jabber-querybot send it back to the jabber sender.</p><p>It is designed to be re-usable and to make it easy to write small Jabber bots that do one thing and do it well. A simple concept with a lot of examples and experiences are implemented.</p><p>1. Create a jabber account on a jabber-server around</p><p>2. Create a bot application:</p>
<pre>
 cd examples
 cp Querymodule.pm /etc/jabber-querybot/Mybot.pm
 cd /etc/jabber-querybot
 ln -s Mybot.pm Querymodule.pm
</pre>
<p>Modify login parameters to your jabber-bot-account</p><p>vim Mybot.pm   our $hostname        = "swissjabber.ch";   our $user            = "";   our $password        = "";   our $ident           = "Testbot";   our $bot_admin       = "&#92;@swissjabber.ch";   our $port            = "5222";   our $timeout         = "5";   our $service_name    = "$user&#92;@$hostname";   our $bot_description = "Bot help title   Bot description";</p><p>For each jabber message, jabber-querybot will execute sub run_query, that you can write here your application.</p><p>You can control how your jabber response will be:</p><ul>
<li><p>error = error message stanza</p></li><li><p>presence = error as presence stanza</p></li><li><p>ignore = ignore message</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>jabber-querybot has a lot of variables which you can easy modify for what you need:</p><h3>querystatus</h3>
<p>$querystatus = [ 0 | 1 ]</p><ul>
<li><p>0 = Bot will not proceed any incoming jabber messages.</p></li><li><p>1 = Bot will proceed incoming messages.</p></li>
</ul>
<h3>penalty_status</h3>
<p>If the bot has too much workload, it goes to penalty status and wait some time until his status change back to normal.</p><p>$timer_reconnect_default = 21600</p><p>Every 21600 seconds (6 hours) the bot will shutdown automatically, wait 10 seconds and starting up again.</p><p>$timer_auto_query = 0</p><p>If you set in your module this variable to 60, the bot will every 60 seconds call the function <em>run_auto_query()</em> which you may use for several things.</p>
<h3>System load</h3>
<p>If your systems load is &gt;=6, this bot will shutdown the jabber connection and check every 10 seconds systems load. If load &lt;=2, bot will start over.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>/usr/share/doc/jabber-querybot/examples/Testbot.pm</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>/etc/jabber-querybot/Querymodule.pm</p><p>/usr/bin/jabber-querybot</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RESOURCES</h2>
        <div class="sectioncontent">
<p>http://github.com/micressor/jabber-querybot/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">METHODS</h2>
        <div class="sectioncontent">
<h3>\fIInMessage()\fP</h3>
<p>An incoming jabber message to the bot will hook this function.</p><ul>
<li><p>Read parameters of incoming stanza</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Decode utf8 string</p></li>
</ul>
<h3></h3>
<ul>
<li><p>increment timer overload and do not process message if bot is overloaded.</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Ignore message if it is from myself</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Be sure, that it is not a message from another transport</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Check any systemcommands for the bot</p></li>
</ul>
<h3></h3>
<ul>
<li><p>If the bot has sleeping status, change it to work</p></li>
</ul>
<h3></h3>
<ul>
<li><p>We process only normal text or chat type jabber messages</p></li>
</ul>
<h3></h3>
<ul>
<li><p>And now we give the real text string which was incoming to the bot via <em>run_query()</em>.</p></li><li><p>If <em>run_query()</em> say us 'ignore` we do a log entry and do not answer via jabber to the user.</p></li>
</ul>
<h3></h3>
<ul>
<li><p>If <em>run_query()</em> says 'error` we send a jabber error stanza wiht the status message from <em>run_query()</em> back to the user.</p></li>
</ul>
<h3></h3>
<ul>
<li><p>If there was no error, we update the statistic vars and send the answer from <em>run_query()</em> back to the jabber user.</p></li>
</ul>
<h3>\fIconnect_server()\fP</h3>
<p>This function connects to the jabber server with the given credentials from Querymodule.pm.</p>
<h3></h3>
<p>Set the call back functions. This functions will be executed if a message of the types &lt;message/&gt; &lt;iq/&gt; or &lt;presence/&gt; are incoming.</p>
<h3>\fIStop()\fP</h3>
<p>Shutdown jabber connection and exit main program</p>
<h3>\fIdisconnect_server()\fP</h3>
<p>Only disconnect from the jabber-server.</p>
<h3>\fIreconnect_server()\fP</h3>
<p>Reconnect and create a log entry.</p>
<h3>\fIInIQ()\fP</h3>
<p>We do not proceed any iq (information query), this is only for statisic.</p>
<h3>\fIInPresence()\fP</h3>
<ul>
<li><p>Increment timer overload</p></li><li><p>Do not process message if we are overloaded <em>penalty_handler()</em>.</p></li>
</ul>
<h3></h3>
<p>We have a problem in Net::Jabber. An incoming message with a ` in resource blocks the bot. We will hotfix that for the moment.</p>
<h3></h3>
<p>A subscription type `subscribe` is incoming. Send `subscribed` tho the user and say hello ;)</p>
<h3></h3>
<ul>
<li><p>Send presence to user</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Remove subscription if a user remove this bot from his roster</p></li>
</ul>
<h3>\fIsendPresence()\fP</h3>
<p>Send presence information to user</p>
<h3>\fIsystemcommands()\fP</h3>
<ul>
<li><p>If user type '!help` send a help instruction to the user</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Send statistic information to the user if he types '!status`</p></li>
</ul>
<h3></h3>
<ul>
<li><p>Is it a bot command?</p></li><li><p>Is the bot command from the bot admin? If not, send \*(L"not allowed\*(R"</p></li><li><p>'!shutdown` will shutdown your bot via jabber invoke.</p></li><li><p>'!query off` turn off queries</p></li><li><p>'!query on` turn on queries</p></li>
</ul>
<h3>\fIget_barejid()\fP</h3>
<p>Remove resource id from a jabber id.</p>
<h3>\fIcalcualte_stats()\fP</h3>
<p>Calculate message statistics</p>
<h3>\fIjabber_set_presence()\fP</h3>
<p>Set new presence if we have another presence status or we have set the force flag (for transport presence).</p>
<h3>\fIjabber_send_message()\fP</h3>
<p>This function send all jabber messages which are outgoing from the jabber-querybot.</p>
<h3>\fIset_wakeup_mode()\fP</h3>
<p>Set jabber presence via <em>jabber_set_presence()</em></p>
<h3>\fIpenalty_handler()\fP</h3>
<p>This function checks if the bot is overloaded with incoming mesages and reject if it is. Two times that's ok so 2:1 because while in main.</p>
<h3></h3>
<p>Bot admin got everytime an answer.</p>
<h3>\fIjabber_add_footer()\fP</h3>
<p>Add footer to the processed message.</p>
<h3>\fIcalcualte_elapsed_time()\fP</h3>
<p>Calculate elapsed worktime for a query</p>
<h3>\fIsendError()\fP</h3>
<p>sendError($message, $from, $to, 404, \*(L"text\*(R");</p>
<h3>\fIsystem_load_check()\fP</h3>
<ul>
<li><p>Calculate system load</p></li><li><p>If load is too high shutdown bot.</p></li><li><p>If load is ok, starting up bot</p></li>
</ul>
<h3>\fIconnect_bot()\fP</h3>
<p>Connect bot and initialize all timers.</p>
<h3>\fIcheck_before_start()\fP</h3>
<p>Check configuration variables in Querybotmodule.pm and give answer if anything does not match or is missing.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT AND LICENSE</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2009-2012 Marco Balmer &lt;marco@balmer.name&gt;</p><p>The Debian packaging is licensed under the \s-1GPL\s0, see `/usr/share/common-licenses/GPL-3'.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ipv4calc.1p.html"><span aria-hidden="true">&larr;</span> ipv4calc.1p: </a></li>
   <li class="next"><a href="jirc.1p.html">jirc.1p: Bridges an irc channel to a jabber conference room. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
