<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>irkerhook: Repository hook script issuing irker notifications</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Repository hook script issuing irker notifications">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="irkerhook (1) manual">
  <meta name="twitter:description" content="Repository hook script issuing irker notifications">
  <meta name="twitter:image" content="https://www.carta.tech/images/irker-irkerhook-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/irkerhook.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="irkerhook (1) manual" />
  <meta property="og:description" content="Repository hook script issuing irker notifications" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/irker-irkerhook-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">irkerhook<small> (1)</small></h1>
        <p class="lead">Repository hook script issuing irker notifications</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/irkerhook.1.html">
      <span itemprop="name">irkerhook: Repository hook script issuing irker notifications</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/irker/">
      <span itemprop="name">irker</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/irkerhook.1.html">
      <span itemprop="name">irkerhook: Repository hook script issuing irker notifications</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>irkerhook.py</strong> [-n] [-V] [[<em>--variable=value</em>...]] [[<em>commit-id</em>...]]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>irkerhook.py is a Python script intended to be called from the post-commit hook of a version-control repository. Its job is to collect information about the commit that fired the hook (and possibly preferences set by the repository owner) and ship that information to an instance of irkerd for forwarding to various announcement channels.</p><p>The proper invocation and behavior of irkerhook.py varies depending on which VCS (version-control system) is calling it. There are four different places from which it may extract information:</p><p>Calls to VCS utilities.</p><p>In VCSes like git that support user-settable configuration variables, variables with the prefix "irker.".</p><p>In other VCSes, a configuration file, "irker.conf", in the repository&apos;s internals directory.</p><p>Command-line arguments of the form --variable=value.</p><p>The following variables are general to all supported VCSes:</p><p>project</p><p>The name of the project. Should be a relatively short identifier; will usually appear at the very beginning of a notification.</p><p>repo</p><p>The name of the repository top-level directory. If not specified, defaults to a lowercased copy of the project name.</p><p>channels</p><p>An IRC channel URL, or comma-separated list of same, identifying channels to which notifications are to be sent. If not specified, the default is the freenode #commits channel.</p><p>server</p><p>The host on which the notification-relaying irker daemon is expected to reside. Defaults to "localhost".</p><p>email</p><p>If set, use email for communication rather than TCP or UDP. The value is used as the target mail address.</p><p>tcp</p><p>If "true", use TCP for communication; if "false", use UDP. Defaults to "false".</p><p>urlprefix</p><p>Changeset URL prefix for your repo. When the commit ID is appended to this, it should point at a CGI that will display the commit through cgit, gitweb or something similar. The defaults will probably work if you have a typical gitweb/cgit setup.</p><p>If the value of this variable is "None", generation of the URL field in commit notifications will be suppressed. Other magic values are "cgit", "gitweb", and "viewcvs", which expand to URL templates that will usually work with those systems.</p><p>The magic cookies "%(host)s" and %(repo)s" may occur in this URL. The former is expanded to the FQDN of the host on which irkerhook.py is running; the latter is expanded to the value of the "repo" variable.</p><p>tinyifier</p><p>URL template pointing to a service for compressing URLs so they will take up less space in the notification line. If the value of this variable is "None", no compression will be attempted.</p><p>color</p><p>If "mIRC", highlight notification fields with mIRC color codes. If "ANSI", highlight notification fields with ANSI color escape sequences. Defaults to "none" (no colors). ANSI codes are supported in Chatzilla, irssi, ircle, and BitchX; mIRC codes only are recognized in mIRC, XChat, KVirc, Konversation, or weechat.</p><p>Note: if you turn this on and notifications stop appearing on your channel, you need to turn off IRC&apos;s color filter on that channel. To do this you will need op privileges; issue the command "/mode &lt;channel&gt; -c" with &lt;channel&gt; replaced by your channel name. You may need to first issue the command "/msg chanserv set &lt;channel&gt; MLOCK +nt-slk".</p><p>maxchannels</p><p>Interpreted as an integer. If not zero, limits the number of channels the hook will interpret from the "channels" variable.</p><p>This variable cannot be set through VCS configuration variables or irker.conf; it can only be set with a command-line argument. Thus, on a forge site in which repository owners are not allowed to modify their post-commit scripts, a site administrator can set it to prevent shotgun spamming by malicious project owners. Setting it to a value less than 2, however, would probably be unwise.</p><p>cialike</p><p>If not empty and not "None" (the default), this emulates the old CIA behavior of dropping long lists of files in favor of a summary of the form (N files in M directories). The value must be numeric giving a threshold value for the length of the file list in characters.</p><h3>git</h3>
<p>Under git, the normal way to invoke this hook (from within the update hook) passes it a refname followed by a list of commits. Because <strong>git rev-list</strong> normally lists from most recent to oldest, you&apos;ll want to use --reverse to make notifications be omitted in chronological order. In a normal update script, the invocation should look like this</p>
<pre>
refname=$1
old=$2
new=$3
irkerhook.py --refname=${refname} $(git rev-list --reverse ${old}..${new})
</pre>
<p>except that you&apos;ll need an absolute path for irkerhook.py.</p><p>For testing purposes and backward compatibility, if you invoke irkerhook.py with no arguments (as in a post-commit hook) it will behave as though it had been called like this:</p>
<pre>
irkerhook.py --refname=refs/heads/master HEAD
</pre>
<p>However, this will not give the right result when you push to a non-default branch of a bare repo.</p><p>A typical way to install this hook is actually in the post-receive hook, because it gets all the necessary details and will not abort the push on failure. Use the following script:</p>
<pre>
#!/bin/sh

echo "sending IRC notification"
while read old new refname; do
    irkerhook --refname=${refname} $(git rev-list --reverse ${old}..${new})
done
</pre>
<p>Preferences may be set in the repo config file in an [irker] section. Here is an example of what that can look like:</p>
<pre>
[irker]
    project = gpsd
    color = ANSI
    channels = irc://chat.freenode.net/gpsd,irc://chat.freenode.net/commits
</pre>
<p>You should not set the "repository" variable (an equivalent will be computed). No attempt is made to interpret an irker.conf file.</p><p>The default value of the "project" variable is the basename of the repository directory. The default value of the "urlprefix" variable is "cgit".</p><p>There is one git-specific variable, "revformat", controlling the format of the commit identifier in a notification. It may have the following values:</p><p>raw</p><p>full hex ID of commit</p><p>short</p><p>first 7 chars of hex ID</p><p>describe</p><p>describe relative to last tag, falling back to short</p><p>The default is &apos;describe&apos;.</p>
<h3>Subversion</h3>
<p>Under Subversion, irkerhook.py accepts a --repository option with value (the absolute pathname of the Subversion repository) and a commit argument (the numeric revision level of the commit). The defaults are the current working directory and HEAD, respectively.</p><p>Note, however, that you <em>cannot</em> default the repository argument inside a Subversion post-commit hook; this is because of a limitation of Subversion, which is that getting the current directory is not reliable inside these hooks. Instead, the values must be the two arguments that Subversion passes to that hook as arguments. Thus, a typical invocation in the post-commit script will look like this:</p>
<pre>
REPO=$1
REV=$2
irkerhook.py --repository=$REPO $REV
</pre>
<p>Other --variable=value settings may also be given on the command line, and will override any settings in an irker.conf file.</p><p>The default for the project variable is the basename of the repository. The default value of the "urlprefix" variable is "viewcvs".</p><p>If an irker.conf file exists in the repository root directory (not the checkout directory but where internals such as the "format" file live) the hook will interpret variable settings from it. Here is an example of what such a file might look like:</p>
<pre>
# irkerhook variable settings for the irker project
project = irker
channels  = irc://chat.freenode/irker,irc://chat.freenode/commits
tcp = false
</pre>
<p>Don&apos;t set the "repository" or "commit" variables in this file; that would have unhappy results.</p><p>There are no Subversion-specific variables.</p>
<h3>Mercurial</h3>
<p>Under Mercurial, irkerhook.py can be invoked in two ways: either as a Python hook (preferred) or as a script.</p><p>To call it as a Python hook, add the collowing to the "commit" or "incoming" hook declaration in your Mercurial repository:</p>
<pre>
[hooks]
	incoming.irker = python:/path/to/irkerhook.py:hg_hook
</pre>
<p>When called as a script, the hook accepts a --repository option with value (the absolute pathname of the Mercurial repository) and can take a commit argument (the Mercurial hash ID of the commit or a reference to it). The default for the repository argument is the current directory. The default commit argument is &apos;-1&apos;, designating the current tip commit.</p><p>As for git, in both cases all variables may be set in the repo hgrc file in an [irker] section. Command-line variable=value arguments are accepted but not required for script invocation. No attempt is made to interpret an irker.conf file.</p><p>The default value of the "project" variable is the basename of the repository directory. The default value of the "urlprefix" variable is the value of the "web.baseurl" config value, if it exists.</p>
<h3>Filtering</h3>
<p>It is possible to filter commits before sending them to irkerd.</p><p>You have to specify the <strong>filtercmd</strong> option, which will be the command irkerhook.py will run. This command should accept one arguments, which is a JSON representation of commit and extractor metadata (including the channels variable). The command should emit to standard output a JSON representation of (possibly altered) metadata.</p><p>Below is an example filter:</p>
<pre>
#!/usr/bin/env python
# This is a trivial example of a metadata filter.
# All it does is change the name of the commit&apos;s author.
#
import sys, json
metadata = json.loads(sys.argv[1])

metadata[&apos;author&apos;] = "The Great and Powerful Oz"

print json.dumps(metadata)
# end
</pre>
<p>Standard error is available to the hook for progress and error messages.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>irkerhook.py takes the following options:</p><p>-n</p><p>Suppress transmission to a daemon. Instead, dump the generated JSON request to standard output. Useful for debugging.</p><p>-V</p><p>Write the program version to stdout and terminate.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO irkerhook&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/irkerd.8.html"><strong>irkerd</strong>(8)</a>,</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Eric S. Raymond &lt;esr@snark.thyrsus.com&gt;. See the project page at \m[blue]<strong>http://www.catb.org/~esr/irker</strong>\m[] for updates and other resources.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="irk.1.html"><span aria-hidden="true">&larr;</span> irk.1: Test program for irkerd</a></li>
   <li class="next"><a href="irkerhook-git.1.html">irkerhook-git.1: Repository hook script issuing irker notifications <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
