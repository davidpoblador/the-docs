<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dnshistory: Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dnshistory (1) manual">
  <meta name="twitter:description" content="Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.">
  <meta name="twitter:image" content="https://www.carta.tech/images/dnshistory-dnshistory-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/dnshistory.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dnshistory (1) manual" />
  <meta property="og:description" content="Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dnshistory-dnshistory-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dnshistory<small> (1)</small></h1>
        <p class="lead">Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dnshistory.1.html">
      <span itemprop="name">dnshistory: Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dnshistory/">
      <span itemprop="name">dnshistory</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dnshistory.1.html">
      <span itemprop="name">dnshistory: Processes various log file formats doing dns ip address lookups. store these pairs in a database for later retrieval.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dnshistory [</strong><em>OPTION</em><strong>]... [</strong><em>--file=FILE</em><strong>]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p><strong>dnshistory</strong> is Copyright &copy; 2004, 2005, 2006, 2007 Stephen McInerney</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong></strong><strong>dnshistory</strong><strong></strong> currently processes Apache CLF and Combined logs, Squid access logs, FTP xferlog files and iptables based logs.  The log format is auto-detected.</p><p><strong></strong><strong>dnshistory</strong><strong></strong> has five modes of operation: <strong></strong></p><ul>
<li><p>Do Lookups. The default mode. Given a web log file, <strong>dnshistory</strong> will perform DNS reverse lookups on each unique IP Address and store the results in a history database. <strong></strong></p></li><li><p>Do Translations. Given a raw web log file, <strong>dnshistory</strong> will make use of a previously created history database and send to <em>STDOUT</em> the same web log but with addresses replaced by the Fully Qualified Domain Name as previously looked up. <strong></strong></p></li><li><p>Do Recombining. Given two web log files, one raw and one previously translated (eg. by using dnstran): Create a history database from the values in these separate log files. <strong></strong></p></li><li><p>Do Dump. Dump a given history database to <em>STDOUT</em>. <strong></strong></p></li><li><p>Do Import. Import a previously dumped history database from a given file. <strong></strong></p></li><li><p>Show History. Given one or more IP Addresses on the command line, show the history of those addresses.</p></li>
</ul><p>The lookups make use of threads for maximum speed, and use the standard resolution libraries on a system. Thus hosts files, NIS, LDAP and other name resolution methods should work transparently.</p><p>It is <strong>strongly</strong> recommended that for massive lookups a DNS server is "nearby". Preferably not a forwarding server.</p><p><strong>dnshistory</strong> can read <em>.gz</em> files. <em>STDIN</em> is assumed to <strong>not</strong> be gz encoded.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    -L --dolookups
  </dt>
  <dd>
    <p>The default mode. Given a log file, either via <em>STDIN</em> or via '-f', do the lookups and store the results.</p>
  </dd>
  <dt>
    -T --dotranslate
  </dt>
  <dd>
    <p>Given a log file, either via <em>STDIN</em> or via '-f', lookup each IP Address from the history database; replace the IP Address with the FQDN and send the newly updated log line to <em>STDOUT</em>.</p>
  </dd>
  <dt>
    -R --dorecombine=FILE
  </dt>
  <dd>
    <p>Given a previously translated file (eg. via dnstran) via this option for the names, do the lookups for a file given via <em>STDIN</em> or '-f' and store the results. This file can be gz encoded.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>The date/time of each stored entry is taken as being the actual time for the lookup stored in the recombine log file. This is probably incorrect, but "Good Enough".</p>
  </dd>
  <dt>
    -D --dodump
  </dt>
  <dd>
    <p>Dump the history database to <em>STDOUT</em>.</p>
  </dd>
  <dt>
    -I --doimport=FILE
  </dt>
  <dd>
    <p>Given a previously dumped database, import that into a new database. Will fail and exit if the chosen database already exists.</p>
  </dd>
  <dt>
    -S --showhistory
  </dt>
  <dd>
    <p>Given one or more IP Addresses show their history. Address are the last item(s) on the command line. Addresses with no as yet discovered FQDN will display 'NONAME'. The Date/Time displayed is formatted as YYYY-MM-DD:hh:mm:ss, vs the 'seconds since epoch' for "--dodump"</p>
  </dd>
  <dt>
    --logtype=LOGTYPE
  </dt>
  <dd>
    <p>By default <strong>dnshistory</strong> will attempt to autodetect what type of logfile is being processed. By using this option, the autodetection is overridden. The choices are: auto, clf or www, squid, ftp or iptables.</p>
  </dd>
  <dt>
    -c --cache=SIZE
  </dt>
  <dd>
    <p>Set the size of the memory cache to use. Value is in Mb. Default is 20Mb.</p>
  </dd>
  <dt>
    -d --database=FILE
  </dt>
  <dd>
    <p>Change the default database file to use to store stateful data.</p>
  </dd>
  <dt>
    -f --file=FILE
  </dt>
  <dd>
    <p>Web Log File to process. This file can be gz encoded.</p><p>Will use <em>STDIN</em> if not set</p>
  </dd>
  <dt>
    -h --help
  </dt>
  <dd>
    <p>Help screen. Very brief.</p>
  </dd>
  <dt>
    -l --maxlookups=NUMBER
  </dt>
  <dd>
    <p>The maximum number of lookups to attempt. The default is 1. This has not shown to be at all useful in testing...</p>
  </dd>
  <dt>
    -m --maxthreads=NUMBER
  </dt>
  <dd>
    <p>How many name lookup threads to spawn off. The default is 100. Setting this too high can do evil things to bandwidth and the CPU usage of any queried DNS server(s).</p><p>If doing lots of DNS queries, setting this too high can have a very negative impact on the ability to successfully resolve anything.</p>
  </dd>
  <dt>
    -t --timeout=VALUE
  </dt>
  <dd>
    <p>The time in seconds before a stored DNS value is deemed "old". The default is 7 days.</p>
  </dd>
  <dt>
    -v --verbose
  </dt>
  <dd>
    <p>Verboseness of a run. More v's will increase the level of verbosity, up to a maximum of 5. All of the higher levels are only of value for debugging purposes.</p>
  </dd>
  <dt>
    -V --version
  </dt>
  <dd>
    <p>Display the version information and exit</p>
  </dd>
  <dt>
    -w --wait
  </dt>
  <dd>
    <p>Delay time between query retries within a single run</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RESULTS</h2>
        <div class="sectioncontent">
<p>At verbose level 1 (-v) some success/failure counters will be displayed. As well as any problematic log lines to STDERR.</p><p>At verbose level 2 (-vv) lines that may not match up (eg. Due to dnstran modifying referrers or URL's) will be sent to STDERR.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>A typical run, using a database in /tmp/ (/tmp/c.db), and a log file in the current directory (test.log). First, do the lookups:</p><p>dnshistory -d /tmp/c.db -f test.log</p><p>Then the translation run for input into, for example, a web log analyser:</p><p>dnshistory -T -d /tmp/c.db -f test.log | webalizer ....</p><p>Do three attempts on failed queries, with a 2 second delay between retries:</p><p>dnshistory -l 3 -w 2 -d /tmp/c.db -f test.log</p><p>Lookup and Display the history of three IP Addresses: 127.0.0.1,192.168.1.254,10.10.10.10</p><p>dnshistory -S -d /tmp/c.db 127.0.0.1 192.168.1.254 10.10.10.10</p><p>Import a previously dumped database via dnsdb.dump</p><p>dnshistory -I dnsdb.dump -d /tmp/d.db</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><em>/var/lib/dnshistory/dnshistory.db</em></p><p>The default history database file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p><strong></strong></p><ul>
<li><p>Ignores IP Addresses located in the URL and Referrer fields.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Stephen McInerney &lt;spm@stedee.id.au&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dnsget.1.html"><span aria-hidden="true">&larr;</span> dnsget.1: Dns lookup utility</a></li>
   <li class="next"><a href="dnssort.1.html">dnssort.1: Sort dns hostnames <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
