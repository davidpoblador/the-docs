<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>gitpkg: Export a debian source package from nominated git revisions</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Export a debian source package from nominated git revisions">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="gitpkg (1) manual">
  <meta name="twitter:description" content="Export a debian source package from nominated git revisions">
  <meta name="twitter:image" content="https://www.carta.tech/images/gitpkg-gitpkg-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/gitpkg.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="gitpkg (1) manual" />
  <meta property="og:description" content="Export a debian source package from nominated git revisions" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/gitpkg-gitpkg-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">gitpkg<small> (1)</small></h1>
        <p class="lead">Export a debian source package from nominated git revisions</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/gitpkg.1.html">
      <span itemprop="name">gitpkg: Export a debian source package from nominated git revisions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/gitpkg/">
      <span itemprop="name">gitpkg</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/gitpkg.1.html">
      <span itemprop="name">gitpkg: Export a debian source package from nominated git revisions</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>gitpkg</strong> <em>branch</em> [<em>origbranch</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>If <strong>gitpkg</strong> is run in a <a href="../man1/git.1.html"><strong>git</strong>(1)</a> repo with a single 'branch' specified, then it will do a <strong>git-archive</strong> export of that branch to the <strong>DEB_DIR</strong> directory.  If the package is Debian native it will simply create a source package from it.  If the package has a Debian version, then an orig tarball will be expected to already exist for it.  If an orig tarball does not already exist then what happens next depends on the value of the <strong>gitpkg.create-fake-orig</strong> configuration option (described below).</p><p>If <strong>gitpkg</strong> is invoked with two branches specified, then the first branch will be exported as the unpacked complete source, while the second branch will be exported for the orig.tar.gz.  This allows all local changes to the source to be recorded in the resulting diff.gz if a pristine upstream branch exists in the repository.  If an orig tarball already exists for the version at 'branch' then what happens next depends on the value of the <strong>gitpkg.force-overwrite-orig</strong> configuration option (described below).</p><p>The '<em>branch</em>' should always have a <em>debian</em>/ dir and may be any <em>tree-ish</em> object that is accepted by <a href="../man1/git-archive.1.html"><strong>git-archive</strong>(1)</a>. The '<em>origbranch</em>', if supplied, should usually not have a <em>debian</em>/ dir.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION OPTIONS</h2>
        <div class="sectioncontent">
<p>Almost all <strong>gitpkg</strong> configuration is handled using <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> now. The following configuration options are supported:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>gitpkg.deb-dir</strong></p>
  </dt>
  <dd>
    <p>May be set to override the default destination directory for exported packages. Default is '<em>../deb-packages</em>'.  Available to hook scripts as <strong>DEB_DIR</strong>. This may be overridden on the command line with the <strong>--deb-dir=</strong><em>path</em> option.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.build-rootcmd</strong></p>
  </dt>
  <dd>
    <p>May be set to override the default command used to get root for package build operations.  Default is '<em>fakeroot</em>'.  Available to hook scripts as <strong>BUILD_ROOTCMD</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.prebuild-target</strong></p>
  </dt>
  <dd>
    <p>May be set to a target or targets from <em>debian/rules</em> which will be called after the debian source tree is exported, but before the source package is built. Some packages may use this to generate autoconf files or the like, which should generally not be in the repo, but which should be in the distributed package. The target is invoked using the BUILD_ROOTCMD.  A common use for this hook would be to call the package's '<em>clean</em>' target.  This hook is unset by default since gitpkg 0.18.  Previous to that it defaulted to the clean target. Available to hook scripts as <strong>PREBUILD_TARGET</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.orig-compressor</strong></p>
  </dt>
  <dd>
    <p>May be set to override the default compression for an exported package.orig.tar. Default is '<em>gzip</em>'.  For format 3.0 packages, valid values also include <em>xz</em> and <em>bzip2</em>.  Available to hook scripts as <strong>ORIG_COMPRESSOR</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.orig-compress-level</strong></p>
  </dt>
  <dd>
    <p>An optional compression level to use with <strong>gitpkg.orig-compressor</strong>.  1 is usually the fastest and 9 is usually the smallest, with the precise details of everything between being up to the chosen compressor.  Default is unset (which will use whatever the compressor default is).  Available to hook scripts as <strong>ORIG_COMPRESS_LEVEL</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.deb-compressor</strong></p>
  </dt>
  <dd>
    <p>May be set to override the default compression used by <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a> for exported packages.  Default (if unset) is to use whatever <strong>dpkg-source</strong> wants to use.  For format 3.0 packages, valid values also include <em>xz</em> and <em>bzip2</em>.  Available to hook scripts as <strong>DEB_COMPRESSOR</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.deb-compress-level</strong></p>
  </dt>
  <dd>
    <p>An optional compression level to use with <strong>gitpkg.deb-compressor</strong>.  1 is usually the fastest and 9 is usually the smallest, with the precise details of everything between being up to the chosen compressor.  Default is unset (which will use whatever the <strong>dpkg-source</strong> default is, currently '9'). Available to hook scripts as <strong>DEB_COMPRESS_LEVEL</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.dpkg-source</strong></p>
  </dt>
  <dd>
    <p>May be set to pass arbitrary options verbatim to <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a> when building the source package.  Use with caution and at your own risk.  To pass multiple options to <strong>dpkg-source</strong> you must set this option multiple times (ie. using <strong>git&nbsp;config&nbsp;--add</strong> for each option) due to the otherwise amusing quoting requirements for options such as "--format=3.0&nbsp;(native)". Default is empty.  Available to hook scripts as the indexed array <strong>DPKG_SOURCE_OPTS</strong>. Do not use this to set the <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a> <strong>-Z</strong> or <strong>-z</strong> options, they should instead be set using the <strong>deb-compressor</strong> and <strong>deb-compress-level</strong> options respectively. This may be overridden on the command line with the <strong>--dpkg-source=</strong><em>arg</em> option, which likewise must be passed multiple times to set multiple options.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.create-fake-orig</strong></p>
  </dt>
  <dd>
    <p>Sometimes both upstream source and debian support really are intermingled into a single branch of the repo but you'd still like to make a 'non-native' package from it.  <strong>gitpkg</strong> can fake an orig tarball from such a tree out of everything but the contents of the debian/ directory.  Setting this option to 'true' makes that behaviour the default if a single treeish is passed to <strong>gitpkg</strong> and no corresponding orig tarball is found.  Setting this option to 'false' will make <strong>gitpkg</strong> fail, reporting an error, if a single treeish is passed and no orig tarball with the correct version already exists for it (and none was retrieved by a hook script prior to it being needed).  If this option is unset then the user will be prompted for the correct thing to do if this situation arises. Default is unset.  Available to hook scripts as <strong>CREATE_FAKE_ORIG</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.force-overwrite-orig</strong></p>
  </dt>
  <dd>
    <p>This option controls the behaviour of <strong>gitpkg</strong> if an 'origbranch' treeish is specified and the corresponding orig.tar for the 'branch' already exists. If this is set to 'true', then the orig.tar will be overwritten with the repo source (to reuse an existing orig.tar simply call <strong>gitpkg</strong> with only the single debian 'branch' treeish you wish to export).  If this is set to 'false', then it is a hard error to attempt to export the upstream source again when the orig.tar already exists, and <strong>gitpkg</strong> will terminate and scold you if you try. If unset you will be prompted about whether to overwrite it or not, and the build will continue using whichever of the two you selected.  Default is unset. Available to hook scripts as <strong>FORCE_OVERWRITE_ORIG</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.keep-unpacked-source</strong></p>
  </dt>
  <dd>
    <p>This option controls whether or not the unpacked source directory is kept after the package export and exit hook have successfully completed.  If this is set to 'true', the unpacked source will be retained.  If set to 'false' or unset then that directory will be removed as the final operation before <strong>gitpkg</strong> exits if all prior operations completed successfully.  Default is unset. Available to hook scripts as <strong>KEEP_UNPACKED_SOURCE</strong>. This may be overridden on the command line with the <strong>--keep-unpacked-source=</strong><em>bool</em> option (where 'no' or 'false' will not keep it, and any other value, including nothing, will).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCRIPT HOOKS</h2>
        <div class="sectioncontent">
<p>User defined scripts can be invoked from a number of points during the package build process.  They are sourced into <strong>gitpkg</strong> as bash shell snippets, in most cases in a subshell, so they can read state variables and perform external actions, but cannot alter the running configuration once a build is in progress. If a hook returns with a non-zero status, then <strong>gitpkg</strong> will be terminated. (Hooks that do terminate gitpkg should take some care not to leave too much of a mess, but also should leave enough clues intact for the user to diagnose and fix whatever the problem was.  Useful and informative error messages should be barked to stderr before exiting in this way.)</p><p>Hook scripts may be installed on the host system outside of the repo tree, or sourced from version controlled files in the repo itself.  Both methods have advantages and risks for different use cases.  Hook scripts are activated by the local admin, by setting each relevant <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> option with the path to the script to be executed.  Paths may be absolute or relative to the directory which that hook is called from.  If a hook is set, the script <strong>must</strong> exist when it is called.  Care should be taken to only enable them for use by trusted source trees when hooking into files in the repo itself. Usually you should enable them on a per-repo basis with <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> rather than at a <strong>--global</strong> or <strong>--system</strong> level.</p><h3>A brief admonition against getting hooked:</h3>
<p>You should avoid complicated in-package hook arrangements becoming essential for exporting your package source.  If you need them to create a particular package correctly, and need strict version binding with the source being released, and they aren't useful to any other package at all ...  then you're quite probably doing something, or several things, quite wrong.  Else you're in such deep shit working around some broken build system that you don't need me to tell you about it.  Either way, local admin has to enable your hooks before they can run, so if you want to be friendly to others (and yourself), then keep the 'normal' packaging work strictly inside the usual package building tools, and leave the gitpkg hooks free for other local admins to wrap whatever automation it is <em>they</em> need around things.  If a particular version of the package source needs some particular actions performed on it prior to the first source package build, then the <strong>PREBUILD_TARGET</strong> option from above is most probably what you want rather than one of these hooks. Other people can use that again later without needing to have gitpkg around. The aim is for this to Help You.  For some values of All Of You.  So do be careful to avoid letting it screw other people over if the hook isn't called, and/or let them know what they need to do instead if it isn't.  Ok then, there's the barb to watch out for, so back to the point again:</p>
<h3>Hook points</h3>
<p>The available hook points are listed below in roughly the order that they would usually be invoked:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>gitpkg.package-config-hook</strong></p>
  </dt>
  <dd>
    <p>This hook runs in the top level directory of the repo <strong>gitpkg</strong> was invoked in, prior to any operations taking place, with all <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> sourced options available to it.  No detailed information about the package itself is available in the hook environment yet, not even its name or version, only the tree-ish(es) that <strong>gitpkg</strong> was passed by the user, but the hook may run its own self-checks based on the current (possibly 'dirty') contents of the working tree that <strong>gitpkg</strong> was invoked in.</p><p>This hook is able to modify the <strong>gitpkg</strong> configuration variables for subsequent operations.  It can perform operations on the repo if needed, but since it needs to be committed to the repo before it will ever be called, that may not be so useful here in practice.  Basically, it can do anything it pleases, it's just a shell script, nothing else has really begun yet, and it has been sourced into the topmost shell level of <strong>gitpkg</strong>.</p><p>Its operation is different from the <strong>admin-config-hook</strong> in only one respect, the path to this hook <strong>must</strong> be relative to the TLD of the repo, and the revision of the file that will be sourced is checked out from the 'branch' tree-ish that <strong>gitpkg</strong> was requested to export.  The file must exist in that version at the path given.</p><p>Available to hook scripts as <strong>PACKAGE_CONFIG_HOOK</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.admin-config-hook</strong></p>
  </dt>
  <dd>
    <p>This hook is run after the <strong>package-config-hook</strong> returns, and differs from it in operation only by reading a static file from the current filesystem rather than extracting a version controlled one from the repo being exported.</p><p>This can be used by the local admin to override any package specific options, that may have been set by the <strong>package-config-hook</strong>, with site specific configuration.  This is a policy control, not a security one.  Security was all over when you let the <strong>package-config-hook</strong> run, this just lets you override it without having to fake up a new commit changing the package hook.</p><p>This is the last hook to run that is able to modify the <strong>gitpkg</strong> configuration and set environment options that will be visible to later hooks. Available to hook scripts as <strong>ADMIN_CONFIG_HOOK</strong>. This may be overridden on the command line with the <strong>--admin-config-hook=</strong><em>path</em> option.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.pre-export-hook</strong></p>
  </dt>
  <dd>
    <p>This hook runs in the top level directory of the repo, after the package name and version have been determined, and with the final package configuration including any tweaking by the previous hooks.  It cannot alter any configuration options, only act upon them or terminate <strong>gitpkg</strong>.</p><p>This can be used to do things like invoke pristine-tar or prefetch an existing orig tarball from some foreign source.  It may perform operations on the repo if any such are desired, or any other last minute check that needs to be done before we actually get about the task of exporting the source we want packaged.</p><p>Available to hook scripts as <strong>PRE_EXPORT_HOOK</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.deb-export-hook</strong></p>
  </dt>
  <dd>
    <p>This hook runs in the top level directory of the exported debian source, immediately after the source has been exported from the requested <em>tree-ish</em>, and immediately prior to the <strong>PREBUILD_TARGET</strong> being invoked (if provided). It cannot alter any configuration options, only act upon them or terminate <strong>gitpkg</strong>.  If this hook terminates <strong>gitpkg</strong>, the exported source directory will be left on the system for the user to inspect.  Subsequent invocations of <strong>gitpkg</strong> for the same release version will overwrite it though. Available to hook scripts as <strong>DEB_EXPORT_HOOK</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.orig-export-hook</strong></p>
  </dt>
  <dd>
    <p>This hook runs in the top level directory of the exported 'upstream' source, immediately after the source has been exported from the provided <em>tree-ish</em>, and prior to it being compressed into a tarball.  It cannot alter any configuration options, only act upon them or terminate <strong>gitpkg</strong>.  If this hook terminates <strong>gitpkg</strong>, the exported source directory will be left on the system for the user to inspect.  Subsequent invocations of <strong>gitpkg</strong> for the same release version will overwrite it though.</p><p>This hook is <strong>only</strong> invoked if the upstream 'origbranch' actually is exported from the repository.  If an existing orig.tar is found or has been created by some earlier hook (and it is not being overwritten, see <strong>force-overwrite-orig</strong> above), then the operations this hook would perform are presumed to have already happened for this tarball and it is skipped.</p><p>It is not safe to assume that this hook will be executed before or after <strong>deb-export-hook</strong>, and it may in fact be run in parallel with it at some point in the future.  They both will be entered after <strong>pre-export-hook</strong> returns, and <strong>exit-hook</strong> will not begin until (at least) after both have returned.  What else happens in the middle of all that we make no firm promises about at this stage.</p><p>Available to hook scripts as <strong>ORIG_EXPORT_HOOK</strong>.</p>
  </dd>
  <dt>
    <p><strong>gitpkg.exit-hook</strong></p>
  </dt>
  <dd>
    <p>This hook runs in the directory where the package <em>.dsc</em> was deposited by <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a>, after all internal <strong>gitpkg</strong> operations have successfully completed.  It's too late to alter any configuration options, or even to terminate <strong>gitpkg</strong> really.  You can pretty much do what you like from this one, anything that goes wrong from here on is your own doing.  Available to hook scripts as <strong>EXIT_HOOK</strong>. This may be overridden on the command line with the <strong>--exit-hook=</strong><em>path</em> option.</p>
  </dd>

</dl>

<h3>Hook Environment</h3>
<p>The following variables are made available for hook scripts, in addition to those already listed as shadowing a <strong>git-config</strong> option from above.  Not all of them are valid/useful at all hook points, see the hook documentation above for the exceptions applying to specific hooks.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>GITPKG_HOOK_API</strong></p>
  </dt>
  <dd>
    <p>Permits hook scripts to query what interfaces are available to them. Has only two numeric components separated by a '.' of which the number to the right of point will get incremented every time we add some new variable a hook might access, or add some new knob it might tweak where existing interfaces have not have changed.  If we do screw up and need to change some current interface, the number to the left will get bumped. The current API version is 0.2</p>
  </dd>

</dl>

<h3>Available in API version 0.1</h3>
<p>These variables have been available to hooks since gitpkg version 0.13</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>GITPKG_TREEISH</strong></p>
  </dt>
  <dd>
    <p>The user-passed debian 'branch' tree-ish that gitpkg was invoked to export.</p>
  </dd>
  <dt>
    <p><strong>GITPKG_ORIG_TREEISH</strong></p>
  </dt>
  <dd>
    <p>The 'origbranch' tree-ish that gitpkg was invoked with.  This will be empty if only a single 'branch' tree-ish was specified.</p>
  </dd>
  <dt>
    <p><strong>DEB_SOURCE</strong></p>
  </dt>
  <dd>
    <p>The name of the source package to create, without any versioning. As seen in the Source: field of <a href="../man1/dpkg-parsechangelog.1.html"><strong>dpkg-parsechangelog</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>DEB_VERSION</strong></p>
  </dt>
  <dd>
    <p>The version of the source package to create, without any epoch. As seen in the name of the .diff.gz and .dsc files.</p>
  </dd>
  <dt>
    <p><strong>UPSTREAM_VERSION</strong></p>
  </dt>
  <dd>
    <p>The version of the source package to create, without any debian version. As seen in the name of the orig tarball.  For native packages this will be the same as <strong>DEB_VERSION</strong>.</p>
  </dd>
  <dt>
    <p><strong>DEB_ORIG</strong></p>
  </dt>
  <dd>
    <p>The full versioned filename of the orig tarball to use or create. This variable is empty for native packages without a Debian version part.</p>
  </dd>
  <dt>
    <p><strong>DEB_DSC</strong></p>
  </dt>
  <dd>
    <p>The full filename of the package <em>.dsc</em> that will be or has been created.</p>
  </dd>
  <dt>
    <p><strong>DEB_PACKAGE</strong></p>
  </dt>
  <dd>
    <p>The directory name of the debianised source tree to pass to <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>REPO_DIR</strong></p>
  </dt>
  <dd>
    <p>An absolute path to the top level directory of the git repo we are exporting from. Usually, if you need to look out of the tree that you were dropped in, you're probably doing something (at the) wrong (time), but there are exceptions, and being able to query <strong>git-config</strong> options is one of them.  That's mostly what this one is for right now.  See the <strong>repo-config-helper</strong> documented below. Be careful if you do use it for much else.</p>
  </dd>

</dl>

<h3>Available in API version 0.2</h3>
<p>These variables have been available to hooks since gitpkg version 0.24</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>GITPKG_AOPTS</strong></p>
  </dt>
  <dd>
    <p>An associative array containing the command line options not parsed by <strong>gitpkg</strong> itself which can be used to override the behaviour of a hook.  The array is keyed on the names of the options with the '--' removed.  If an option was passed multiple times, only the last value passed will be stored in this array. For example:</p>
<pre>
 $ gitpkg --my-option=foo --option2 --opt=oops --opt='bar baz'

Will give:

 ${GITPKG_AOPTS[my-option]} = "foo"
 ${GITPKG_AOPTS[option2]}   = ""
 ${GITPKG_AOPTS[opt]}       = "bar baz"
</pre>

  </dd>
  <dt>
    <p><strong>GITPKG_IOPTS</strong></p>
  </dt>
  <dd>
    <p>An indexed array containing the command line options not parsed by <strong>gitpkg</strong> itself which can be used to override the behaviour of a hook. The array contains the literal option strings passed and so can be used to access options which are intended to be passed multiple times. For example:</p>
<pre>
 $ gitpkg --my-option=foo --option2 --opt=oops --opt='bar baz'

Will give:

 ${GITPKG_IOPTS[0]} = "--my-option=foo"
 ${GITPKG_IOPTS[1]} = "--option2"
 ${GITPKG_IOPTS[2]} = "--opt=oops"
 ${GITPKG_IOPTS[3]} = "--opt=bar baz"
</pre>
<p>The <strong>extract_values_for_option</strong> function in <strong>repo-config-helper</strong> (see below for details of it) can be used to further parse this array to obtain all the value(s) for a specific option.</p>
  </dd>

</dl>

<h3>Hook Library</h3>
<p>There are some canned hook scripts for various tasks available in <em>/usr/share/gitpkg/hooks</em> which currently include:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>cowpoke-exit-hook</strong></p>
  </dt>
  <dd>
    <p>A simple exit hook which sends the exported package off for building using <a href="../man1/cowpoke.1.html"><strong>cowpoke</strong>(1)</a>. To enable it:</p>
<pre>
 $ git config gitpkg.exit-hook /usr/share/gitpkg/hooks/cowpoke-exit-hook
</pre>
<p>Additional <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> configuration options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>gitpkg-cowpoke-exit-hook.ask-first</strong></p>
  </dt>
  <dd>
    <p>If 'true' prompt for confirmation before calling <strong>cowpoke</strong>. Default is to just go ahead and do it.</p>
  </dd>
  <dt>
    <p><strong>gitpkg-cowpoke-exit-hook.options</strong></p>
  </dt>
  <dd>
    <p>May include any other options to pass verbatim to <strong>cowpoke</strong>. To pass multiple options, set this multiple times, once for each option. This may be overridden on the command line with the <strong>--cowpoke=</strong><em>arg</em> option, which likewise must be passed multiple times to set multiple options.</p>
  </dd>

</dl>

  </dd>
  <dt>
    <p><strong>dpkg-buildpackage-exit-hook</strong></p>
  </dt>
  <dd>
    <p>A simple exit hook to build binary packages locally with <a href="../man1/dpkg-buildpackage.1.html"><strong>dpkg-buildpackage</strong>(1)</a>. To enable it:</p>
<pre>
 $ git config gitpkg.exit-hook /usr/share/gitpkg/hooks/dpkg-buildpackage-exit-hook
</pre>
<p>Additional <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a> configuration options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>gitpkg-dpkg-buildpackage-exit-hook.ask-first</strong></p>
  </dt>
  <dd>
    <p>If 'true' prompt for confirmation before calling <strong>dpkg-buildpackage</strong>. Default is to just do it.</p>
  </dd>
  <dt>
    <p><strong>gitpkg-dpkg-buildpackage-exit-hook.options</strong></p>
  </dt>
  <dd>
    <p>May include any other options to pass verbatim to <strong>dpkg-buildpackage</strong>. To pass multiple options, set this multiple times, once for each option. This may be overridden on the command line with the <strong>--dpkg-bp=</strong><em>arg</em> option, which likewise must be passed multiple times to set multiple options.</p>
  </dd>
  <dt>
    <p><strong>gitpkg-dpkg-buildpackage-exit-hook.build-log</strong></p>
  </dt>
  <dd>
    <p>If set 'false' don't save a log of the build process, the default is to record one.</p>
  </dd>

</dl>

  </dd>
  <dt>
    <p><strong>pristine-tar-pre-export-hook</strong></p>
  </dt>
  <dd>
    <p>A hook to extract an orig tarball using pristine-tar.  Which orig to extract is determined by the package version of the 'branch' tree-ish. To enable it:</p>
<pre>
 $ git config gitpkg.pre-export-hook /usr/share/gitpkg/hooks/pristine-tar-pre-export-hook
</pre>
<p>If a pristine-tar branch is not found in the repo, then gitpkg will be terminated.</p>
  </dd>
  <dt>
    <p><strong>quilt-patches-deb-export-hook</strong></p>
  </dt>
  <dd>
    <p>This hook reads a list of revision ranges suitable for <a href="../man1/git-format-patch.1.html"><strong>git-format-patch</strong>(1)</a> from the file <em>debian/source/git-patches</em>, one per line, and exports them to the <em>debian/patches</em> directory in a form suitable for (format 3.0) quilt packages.  It is not required for creating such packages, but permits you to separate out individual patches however you please from the default single patch that is otherwise created by <strong>dpkg-source</strong>.</p><p>To enable it:</p>
<pre>
 $ git config gitpkg.deb-export-hook /usr/share/gitpkg/hooks/quilt-patches-deb-export-hook
</pre>
<p>The contents of <em>debian/source/git-patches</em> may include comments (on any line beginning with a #), empty lines, and expressions of a range of commits. The revision ranges may include <strong>$DEB_VERSION</strong>, <strong>$UPSTREAM_VERSION</strong>, <strong>$DEB_REF</strong> or <strong>$UPSTREAM_REF</strong>.  The first pair will be substituted with the version of the package being exported, the second pair with those version strings after mangling by <strong>sanitise_git_ref</strong> to remap them to a legal git <em>refname</em>.  Using the sanitised versions is to be preferred in most cases.  For example:</p>
<pre>
 # Export all commits between these two treeishes,
 # based on the version of the package being exported.

 upstream/$UPSTREAM_REF..patches/$DEB_REF
</pre>

  </dd>
  <dt>
    <p><strong>debcherry-deb-export-hook</strong></p>
  </dt>
  <dd>
    <p>This hook invokes <a href="../man1/git-debcherry.1.html"><strong>git-debcherry</strong>(1)</a> to find and export patches to the upstream source in a form suitable for use with (format 3.0) quilt packages. It allows for a more natural (and automatic) workflow than the quilt-patches hook above by searching for patches made to the packaging branch that have not yet been applied upstream.</p><p>To enable it:</p>
<pre>
 $ git config gitpkg.deb-export-hook /usr/share/gitpkg/hooks/debcherry-deb-export-hook
</pre>
<p>In order to use this hook, a <strong>${DEB_ORIG}.commit</strong> file must be created which contains the treeish of the exported upstream source in the repository.  This will be created automatically (if this hook is enabled) when you export an upstream tarball by passing both <em>branch</em> and <em>origbranch</em> to <strong>gitpkg</strong>, or if you use the <strong>pristine-tar-pre-export-hook</strong>, which determines an appropriate commit corresponding to the tarball.  If your upstream tarball is created using some other mechanism you will need to ensure that file is created yourself.</p><p>If using this hook, you may wish to document that in your repository with something similar to the text in <em>/usr/share/doc/gitpkg/examples/README.debcherry-export</em> as a convenience to other users. Your package will still be exportable without this hook enabled, it just won't have the upstream patches individually separated out into a quilt series.</p>
  </dd>

</dl>

<h3>Hook Library Helpers</h3>
<p>These are even more trivial snippets, for operations which may be shared by several scripts.  Also found in <em>/usr/share/gitpkg/hooks</em>.  Usually these would be sourced by other scripts rather than being hooked to directly.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>repo-config-helper</strong></p>
  </dt>
  <dd>
    <p>Provides a simple wrapper around `<strong>git config</strong>`, which ensures it is called from the repo tree where any repo-specific config options may be stored.  Useful to scripts which aren't called from inside the repo tree, but which do have <strong>git-config</strong> options of their own to query.</p><p>Provides the <strong>sanitise_git_ref</strong> shell function which remaps character strings that are illegal to use in a git refname.</p><p>Provides the <strong>extract_values_for_option</strong> shell function which can be used to extract an array of the values for a particular option from <strong>GITPKG_IOPTS</strong>.</p><p>See the content of that file itself for more detailed documentation on the functions that it provides.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INTERACTIVIY</h2>
        <div class="sectioncontent">
<p>If you intend to call <strong>gitpkg</strong> from your own scripts, then you should note that there are two situations when it may prompt interactively by default. There is no One True Sane Default for these cases, so it's better to just ask the user and continue than to make them start the whole process again in the likely case where they have called <strong>gitpkg</strong> directly.  For details, see the <strong>gitpkg.force-overwrite-orig</strong> and <strong>gitpkg.create-fake-orig</strong> config options above.  You should set both explicitly to the behaviour that you desire from them if <strong>gitpkg</strong> should never become interactive.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WORKFLOW</h2>
        <div class="sectioncontent">
<p>Though <strong>gitpkg</strong> explicitly does not try to force any particular workflow procedure upon you in order to make full use of it, it probably is worth making quick mention of at least one simple way to manage Debian packages in git.</p><p>One common repo structure is to keep pristine upstream source on one branch, which is updated either directly from an upstream repo or by importing tar archives to it periodically, with the Debian patched source on another branch. In this situation the task of preparing a new upstream release from a tarball might look a bit like this:</p>
<pre>
   Check out the upstream branch
</pre>
<p> $ cd myrepo  $ git checkout upstream</p>
<pre>
   Remove all old upstream files from the repo
</pre>
<p> $ rm -rf $(all_files_except .git)</p>
<pre>
   Unpack the new tarball in their place
</pre>
<p> $ tar zxf $new_upstream.tar.gz</p>
<pre>
   Let git figure out what is renamed/new/gone by itself.
   Make sure you don't have things like vim .swp files lurking
   in the tree still at this point.
</pre>
<p> $ git add .  $ git commit -a  $ git tag v$upstream_version</p>
<pre>
   Prepare the Debian branch
</pre>
<p> $ git checkout debian  $ git merge upstream  $ $(update changelog and other debian patches etc.)  $ git commit -a  $ git tag v${upstream_version}-$debian_version</p>
<pre>
   Make a release
</pre>
<p> $ gitpkg v${upstream_version}-$debian_version v$upstream_version  $ cd ../deb-packages/mypackage && dpkg-buildpackage ...</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO gitpkg&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/git-debimport.1.html"><strong>git-debimport</strong>(1)</a>, <a href="../man1/git-debcherry.1.html"><strong>git-debcherry</strong>(1)</a>, <a href="../man1/git.1.html"><strong>git</strong>(1)</a>, <a href="../man1/git-archive.1.html"><strong>git-archive</strong>(1)</a>, <a href="../man1/git-config.1.html"><strong>git-config</strong>(1)</a>, <a href="../man1/git-format-patch.1.html"><strong>git-format-patch</strong>(1)</a>, <a href="../man5/gitattributes.5.html"><strong>gitattributes</strong>(5)</a>, <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a>, <a href="../man1/cowpoke.1.html"><strong>cowpoke</strong>(1)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>gitpkg</strong> was written by Ron &lt;ron@debian.org&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="gitmount.1.html"><span aria-hidden="true">&larr;</span> gitmount.1: Gnu interactive tools - auto-mount script</a></li>
   <li class="next"><a href="gitps.1.html">gitps.1: A process viewer/killer <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
