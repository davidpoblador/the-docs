<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>build-openstack-debian-image: Build a debian image to be used with openstack</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Build a debian image to be used with openstack">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="build-openstack-debian-image (1) manual">
  <meta name="twitter:description" content="Build a debian image to be used with openstack">
  <meta name="twitter:image" content="https://www.carta.tech/images/openstack-debian-images-build-openstack-debian-image-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/build-openstack-debian-image.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="build-openstack-debian-image (1) manual" />
  <meta property="og:description" content="Build a debian image to be used with openstack" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/openstack-debian-images-build-openstack-debian-image-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">build-openstack-debian-image<small> (1)</small></h1>
        <p class="lead">Build a debian image to be used with openstack</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/build-openstack-debian-image.1.html">
      <span itemprop="name">build-openstack-debian-image: Build a debian image to be used with openstack</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/openstack-debian-images/">
      <span itemprop="name">openstack-debian-images</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/build-openstack-debian-image.1.html">
      <span itemprop="name">build-openstack-debian-image: Build a debian image to be used with openstack</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>build-openstack-debian-image</strong> <strong>--release|-r &lt;jessie|wheezy&gt;</strong> [ OPTIONS ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <em>build-openstack-debian-image</em> shell script will build a Debian image which can be used in an OpenStack IaaS cloud. The resulting (Qcow2 and raw images) contains initramfs-growroot so that the root partition will be resized (during the initramfs phase, before mouting anything) to match the flavor selected when using "nova boot". Later on during the boot process, cloud-init will resize the root partition on the fly (resize is performed when the partition is already mounted read-write, since recent kernel allow that for ext3).</p><p>Cloud-init is setup to use an Ec2 metadata server, which is what OpenStack is compatible with. A "debian" (configurable with the use of the <strong>--login</strong> option) user will be used to receive the ssh key from the user data blob. This user is setup without a password (eg: adduser --disabled-password). Once logged as this "debian" user in your new virtual machine, you can "sudo" to root from that user, without needing a password. The root password is "password" by default, and ssh into the root user without using an ssh keypair is disabled by default (PermitRootLogin without-password is set in /etc/ssh/sshd_config).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PARAMETERS</h2>
        <div class="sectioncontent">
<p><strong>--release|-r</strong> <em>wheezy|jessie</em></p><ul>
<li><p>Sets the <em>release</em> name to be installed. Currently only 2 values a possible: <em>wheezy</em> and <em>jessie.</em></p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p><strong>--extra-packages|-e</strong> <em>PACKAGE,PACKAGE,...</em></p><ul>
<li><p>Select the <em>PACKAGE</em> you want to add to the image <em>default is: bash-completion,joe,most,screen,less,vim,bzip2</em> Note that this list of extra packages isn't used if you use the <strong>--minimal</strong> option.</p></li>
</ul><p><strong>--debootstrap-url|-u</strong> <em>&lt;debootstrap-debian-mirror&gt;</em></p><ul>
<li><p>Select the <em>URL</em> of the Debian mirror to use to perform the debootstrap. For example: <em>http://ftp.fr.debian.org/debian</em></p></li>
</ul><p><strong>--sources.list-mirror|-s</strong> <em>&lt;source-list-mirror&gt;</em></p><ul>
<li><p>URL to use when building the sources.list inside the chroot. If this option is ommited, then the global http.debian.net redirector is used. For example, you can use: <em>http://ftp.fr.debian.org/debian</em></p></li>
</ul><p><strong>--minimal</strong></p><ul>
<li><p>Without this option, the following packages will also be installed: bash-completion (and /etc/bash.bashrc will be setup to use bash-completion), joe (the text editor), most, GNU screen, less and vim. If you believe that more things should be added in the non-minimal image, suggestions are welcome.</p></li>
</ul><p><strong>--image-size|-is</strong> <em>&lt;image-size&gt;</em></p><ul>
<li><p>Select the image size (default to 2 GBytes if this option is ommited). Only useful if you need to use a custom script hook (see below).</p></li>
</ul><p><strong>--automatic-resize|-ar</strong></p><ul>
<li><p>Reduce the image to the minimum HDD size possible. The partition of the image will be first shrinked with resize2fs -M, then the space it takes will be used to do a 2nd resize2fs adding a bit of extra space for the operating system to write runtime data (see below). Since this option takes a lot of time, it is disabled by default.</p></li>
</ul><p><strong>--automatic-resize-space|-ars</strong> <em>&lt;suplementary-space&gt;</em></p><ul>
<li><p>Size of the suplementary space added to the partition after it is resized to the minimum. If this option is ommited, then 50G is used. If <strong>--automatic-resize</strong> isn't used, then it is useless to set this option, which will be ignored.</p></li>
</ul><p><strong>--login|-l</strong> <em>&lt;user-login&gt;</em></p><ul>
<li><p>Change the login name (default to debian) for the user created by Cloud-Init.</p></li>
</ul><p><strong>--password|-p</strong> <em>&lt;root-password&gt;</em></p><ul>
<li><p>Defines a default root password for your image. This option is dangerous, first because it will show the root password to the user of the computer building the image if using "ps", then also because it is best to not set a default root password at all if possible. However, this option is still there, because sometimes, you need to be able to debug your image, and login through the web console of horizon. In a production environment, do not use this option.</p></li>
</ul><p><strong>--hook-script|-hs</strong> <em>&lt;hook-script&gt;</em></p><ul>
<li><p>If you wish to further customize the generated cloud image, you can use a hook script. When called, build-openstack-debian-image will fill up some BODI_* environment variable for the hook script to use as per below:</p><p><strong>BODI_CHROOT_PATH</strong> path where the image is mounted</p><p><strong>BODI_RELEASE</strong> name of the Debian release that is being bootstraped</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<ul>
<li></li><li><p>Here is an example with the short parameter names:</p></li>
</ul><p><em>build-openstack-debian-image -u http://ftp.fr.debian.org/debian -s http://ftp.fr.debian.org/debian -is 5 -e libapache2-mod-php5 -hs ~/customize-my-image -ar -ars 100</em></p><ul>
<li><p>And the same but with long names for options:</p></li>
</ul><p><em>build-openstack-debian-image --debootstrap-url http://ftp.fr.debian.org/debian --sources.list-mirror http://ftp.fr.debian.org/debian --image-size 5 --extra-packages libapache2-mod-php5 --hook-script ~/customize-my-image --automatic-resize --automatic-resize-space 100</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>build-openstack-debian-image has been written by Thomas Goirand &lt;zigo@debian.org&gt;, with contributions from Mehdi Abaakouk &lt;sileht@sileht.net&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="build-lives-rfx-plugin-multi.1.html"><span aria-hidden="true">&larr;</span> build-lives-rfx-plugin-multi.1: Builds rendered effects for lives</a></li>
   <li class="next"><a href="build-progress.sh.1.html">build-progress.sh.1: Show kde-build progress in your konsole/xterm title bar <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
