<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>doveadm-director: Manage dovecot directors</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Manage dovecot directors">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="doveadm-director (1) manual">
  <meta name="twitter:description" content="Manage dovecot directors">
  <meta name="twitter:image" content="https://www.carta.tech/images/dovecot-core-doveadm-director-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/doveadm-director.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="doveadm-director (1) manual" />
  <meta property="og:description" content="Manage dovecot directors" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dovecot-core-doveadm-director-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">doveadm-director<small> (1)</small></h1>
        <p class="lead">Manage dovecot directors</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/doveadm-director.1.html">
      <span itemprop="name">doveadm-director: Manage dovecot directors</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dovecot-core/">
      <span itemprop="name">dovecot-core</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/doveadm-director.1.html">
      <span itemprop="name">doveadm-director: Manage dovecot directors</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director add</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em> [<em>vhost_count</em>]</p><p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director flush</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em>|<strong>all</strong></p><p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director map</strong> [<strong>-a</strong> <em>director_socket_path</em>] [<strong>-f</strong> <em>users_file</em>] [<em>host</em>]</p><p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director remove</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em></p><p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director dump</strong> [<strong>-a</strong> <em>director_socket_path</em>]</p><p><strong>doveadm</strong> [<strong>-Dv</strong>] <strong>director status</strong> [<strong>-a</strong> <em>director_socket_path</em>] [<em>user</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>doveadm director</strong> can be used to manage and query the status of the list of backend mail servers where Dovecot proxy can redirect connections to.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Global <a href="../man1/doveadm.1.html"><strong>doveadm</strong>(1)</a> <em>options</em>:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-D</strong></p>
  </dt>
  <dd>
    <p>Enables verbosity and debug messages.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Enables verbosity, including progress counter.</p>
  </dd>

</dl>
<p>Command specific <em>options</em>:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-a</strong><em>director_socket_path</em></p>
  </dt>
  <dd>
    <p>This option is used to specify an alternative socket. The option&apos;s argument is either an absolute path to a local UNIX domain socket, or a hostname and port (<em>hostname</em>:<em>port</em>), in order to connect a remote host via a TCP socket.</p><p>By default <a href="../man1/doveadm.1.html"><strong>doveadm</strong>(1)</a> will use the socket <em>/var/run/dovecot/director-admin</em>. The socket may be located in another directory, when the default <em>base_dir</em> setting was overridden in <em>/etc/dovecot/dovecot.conf</em>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ARGUMENTS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>host</em></p>
  </dt>
  <dd>
    <p>A mail server&apos;s hostname or IP address.</p>
  </dd>
  <dt>
    <p><em>user</em></p>
  </dt>
  <dd>
    <p>Is a <em>user</em>&apos;s login name. Depending on the configuration, a login name may be for example <strong>jane</strong> or <strong>john@example.com</strong>.</p>
  </dd>
  <dt>
    <p><em>vhost_count</em></p>
  </dt>
  <dd>
    <p>The number of &quot;virtual hosts&quot; to assign to this server. The higher the number is relative to other servers, the more connections it gets. The default is 100.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDS</h2>
        <div class="sectioncontent">
<h3>director add</h3>
<p><strong>doveadm director add</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em> [<em>vhost_count</em>]</p><p>The command&apos;s tasks are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>assign a new mail server to the director.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>increase/decrease the <em>vhost_count</em> of an already assigned server.</p>
  </dd>

</dl>

<h3>director flush</h3>
<p><strong>doveadm director flush</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em>|<strong>all</strong></p><p><strong>doveadm director flush</strong> drops all user associations either from the given <em>host</em> or <strong>all</strong> hosts. This command is intended mainly for testing purposes.</p>
<h3>director map</h3>
<p><strong>doveadm director map</strong> [<strong>-a</strong> <em>director_socket_path</em>] [<strong>-f</strong> <em>users_file</em>] [<em>host</em>]</p><p>The command <strong>doveadm director map</strong> is used to list current <em>user</em>&nbsp;\(-&gt;&nbsp;<em>host</em> mappings. Note that the director works using 32bit hashes which makes collisions quite likely, so this command can&apos;t reliably list exactly which users have recently logged in.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-f</strong><em>users_file</em></p>
  </dt>
  <dd>
    <p>Path to a file containing all user names (one per line). When given no <em>userdb</em> lookup will be performed. This may be a helpful alternative when for example the network connection to the LDAP or SQL server is slow.</p>
  </dd>
  <dt>
    <p><em>host</em></p>
  </dt>
  <dd>
    <p>Specify a server&apos;s IP address or hostname, to list only mappings of the given <em>host</em>.</p>
  </dd>

</dl>

<h3>director remove</h3>
<p><strong>doveadm director remove</strong> [<strong>-a</strong> <em>director_socket_path</em>] <em>host</em></p><p>Use this command in order to remove the given <em>host</em> from the director.</p>
<h3>director dump</h3>
<p><strong>doveadm director dump</strong> [<strong>-a</strong> <em>director_socket_path</em>]</p><p>Dump the current host configuration as doveadm commands. These commands can be easily run after a full director cluster restart to get back to the dumped state.</p>
<h3>director status</h3>
<p><strong>doveadm director status</strong> [<strong>-a</strong> <em>director_socket_path</em>] [<em>user</em>]</p><p>This command is used to show the current usage of all assigned mail servers.</p><p>When a user name is given, this command shows which server the <em>user</em> is currently assigned to, where the user will be assigned after the current saved assignment gets removed and where the user would be assigned to if the whole proxy cluster was restarted fresh.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>/etc/dovecot/dovecot.conf</em></p>
  </dt>
  <dd>
    <p>Dovecot&apos;s main configuration file.</p>
  </dd>
  <dt>
    <p><em>/etc/dovecot/conf.d/10-director.conf</em></p>
  </dt>
  <dd>
    <p>Director specific settings.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Add a director with vhost count 150 (or change existing one&apos;s vhost count to 150):</p>
<pre>
<strong>doveadm -v director add x1357.imap.ha.example.net 150</strong>
2001:db8:543:6861:143::1357: OK
</pre>
<p>Remove a director:</p>
<pre>
<strong>doveadm director remove x1357.imap.ha.example.net</strong>
</pre>
<p>Query the status of mail hosts in a director:</p>
<pre>
<strong>doveadm director status</strong>
mail server ip       vhosts  users
192.168.10.1            100    125
192.168.10.2            100    144
192.168.10.3            100    115
</pre>
<p>Query the status of a user&apos;s assignment:</p>
<pre>
<strong>doveadm director status user@example.com</strong>
Current: 192.168.10.1 (expires 2010-06-18 20:17:04)
Hashed: 192.168.10.2
Initial config: 192.168.10.3
</pre>
<p>This means that the user is currently assigned to mail server on IP 192.168.10.1. After all of user&apos;s connections have logged out, the assignment will be removed (currently it looks like at 20:17:04, but that may be increased). After the assignment has expired, the user will next time be redirected to 192.168.10.2 (assuming no changes to director settings). If the entire Dovecot proxy cluster was restarted, so that all of the director configuration would revert back to its initial values, the user would be redirected to 192.168.10.3.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs, including <em>doveconf -n</em> output, to the Dovecot Mailing List &lt;dovecot@dovecot.org&gt;. Information about reporting bugs is available at: http://dovecot.org/bugreport.html</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO doveadm-director&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/doveadm.1.html"><strong>doveadm</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="doveadm-deduplicate.1.html"><span aria-hidden="true">&larr;</span> doveadm-deduplicate.1: Expunge duplicate messages</a></li>
   <li class="next"><a href="doveadm-dump.1.html">doveadm-dump.1: Dump the content of dovecots binary mailbox index/log <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
