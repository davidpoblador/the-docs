<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>adt-virt-ssh: Autopkgtest virtualisation server using ssh</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Autopkgtest virtualisation server using ssh">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="adt-virt-ssh (1) manual">
  <meta name="twitter:description" content="Autopkgtest virtualisation server using ssh">
  <meta name="twitter:image" content="https://www.carta.tech/images/autopkgtest-adt-virt-ssh-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/adt-virt-ssh.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="adt-virt-ssh (1) manual" />
  <meta property="og:description" content="Autopkgtest virtualisation server using ssh" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/autopkgtest-adt-virt-ssh-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">adt-virt-ssh<small> (1)</small></h1>
        <p class="lead">Autopkgtest virtualisation server using ssh</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/adt-virt-ssh.1.html">
      <span itemprop="name">adt-virt-ssh: Autopkgtest virtualisation server using ssh</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/autopkgtest/">
      <span itemprop="name">autopkgtest</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/adt-virt-ssh.1.html">
      <span itemprop="name">adt-virt-ssh: Autopkgtest virtualisation server using ssh</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSYS</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-ssh</strong> [<em>options</em>] <em>[</em><em>-- setup script options</em> ...]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-ssh</strong> provides an autopkgtest virtualisation server using SSH.</p><p>Normally <strong>adt-virt-ssh</strong> will be invoked by <strong>adt-run</strong>.</p><p><strong>adt-virt-ssh</strong></p><p>can use an already existing ssh target, or call a setup script to create/set up a test bed and the ssh server.</p><p><strong>WARNING!</strong> adt-virt-ssh will modify the target system by installing packages and running arbitrary test code, so <strong>you are responsible for resetting the testbed youself</strong> especially without a setup script. So use this with care.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REQUIREMENTS</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-ssh</strong> doesn't assume anything regarding the target host other than that the given ssh connection (and networking) stay available all the time. You can provide credententials on the command line for already working SSH hosts or use a setup script to prepare the host for the connection (see <strong>SETUP SCRIPT</strong> below for more information), for example to create a forwarding rule to access an adb host over ssh or fire-up a cloud instance.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-h</strong>|<strong>--help</strong></p>
  </dt>
  <dd>
    <p>Show the help message and exit</p>
  </dd>
  <dt>
    <p><strong>-d</strong>|<strong>--debug</strong></p>
  </dt>
  <dd>
    <p>Enable debugging output</p>
  </dd>
  <dt>
    <p><strong>-H</strong><em> hostname</em><strong> | --hostname=</strong><em>hostname</em></p>
  </dt>
  <dd>
    <p>Connects and logs into the specified hostname or IP address</p>
  </dd>
  <dt>
    <p><strong>-l</strong><em> user</em><strong> | --login=</strong><em>user</em></p>
  </dt>
  <dd>
    <p>Specifies the user to log in as on the remote machine.</p>
  </dd>
  <dt>
    <p><strong>-i</strong><em> identity</em><strong> | --identity=</strong><em>identity</em></p>
  </dt>
  <dd>
    <p>Selects a file from which the identity (private key) for public key authentication is read. Should usually be <strong>~/.ssh/id_rsa</strong>, but you might consider using a different key for tests.</p>
  </dd>
  <dt>
    <p><strong>-P</strong><em> password</em><strong> | --password=</strong><em>password</em></p>
  </dt>
  <dd>
    <p>Specifies the sudo password on the remote host.</p><p>It can be the password in clear text or a file containing the password. This password will be used to setup SUDO_ASKPASS in the case sudo requires a password. The runner will check if the user has sudo access with and without a password. If the check fails, the capability "root-on-testbed" will not be available.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> port</em><strong> | --port=</strong><em>port</em></p>
  </dt>
  <dd>
    <p>ssh port to use to connect to the host</p>
  </dd>
  <dt>
    <p><strong>-o</strong><em> options</em><strong> | --options=</strong><em>options</em></p>
  </dt>
  <dd>
    <p>Passed verbatim to ssh; see man ssh_config</p>
  </dd>
  <dt>
    <p><strong>-s</strong><em> setup_script</em><strong> | --setup-script=</strong><em>setup_script</em></p>
  </dt>
  <dd>
    <p>Setup script to prepare testbed and ssh connection (See <strong>SETUP SCRIPT</strong> below for more information). File names will be searched in both the current directory and in <strong>/usr/share/autopkgtest/ssh-setup/</strong> so you do not need to give the full path for setup scripts shipped with autopkgtest.</p>
  </dd>
  <dt>
    <p><strong>--</strong><em> [setup script arguments] </em></p>
  </dt>
  <dd>
    <p>All the remaining arguments following <strong>--</strong> will be passed verbatim to the setup script to configure the host.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILES</h2>
        <div class="sectioncontent">
<p>If you use lots of options or hosts, you can put parts of, or the whole command line into a text file, with one line per option. E. g. you can create a file <em>testhost.cfg</em> with contents like</p>
<pre>
-Htest.example.com
-ltestuser
-Ps3kr1t
</pre>
<p>and then run</p>
<pre>
adt-run [...] --- adt-virt-ssh @testhost.cfg
</pre>
<p>The contents of the configuration file will be expanded in-place as if you would have given its contents on the command line. Please ensure that you <strong>don't place spaces</strong> between short options and their values, they would become a part of the argument value.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INPUT, OUTPUT AND EXIT STATUS</h2>
        <div class="sectioncontent">
<p>The behaviour of <strong>adt-virt-ssh</strong> is as described by the AutomatedTesting virtualisation regime specification.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p><strong>adt-run</strong> does not run <strong>apt-get update</strong> at the start of a package build, which can cause a build failure if you are using a development series template. You will need to run <strong>apt-get update</strong> in the template yourself (e. g. using <strong>--setup-commands</strong>).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SETUP SCRIPT</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-ssh</strong> accepts a setup script in argument to prepare the testbed and the ssh connection. A setup script is an executable that gets called with a command as first argument, and additional options for that command.</p><h3>command: open</h3>
<p>When called with "open", the script has to create a testbed (if necessary), configure ssh, copy ssh key into it, configure sudo, etc.</p><p>It then returns the following information on standard output with the form <strong>key=value</strong>, one line per pair. These mostly mirror the command line options when not using a script.</p><p>Required fields:</p><ul>
<li><p>login: User name</p></li><li><p>hostname: hostname or IP address</p></li>
</ul><p>Optional fields:</p><ul>
<li><p>identity: Path to the private key</p></li><li><p>password: sudo password for the user name to acquire root privileges. If not given, and passwordless sudo does not work, the testbed will not have root privileges.</p></li><li><p>port: SSH port on hostname, if different than 22</p></li><li><p>capabilities: extra testbed capabilities such as "isolation-machine" or "revert", see README.virtualisation-server.rst</p></li><li><p>options: passed verbatim to ssh, see man ssh_config</p></li><li><p>extraopts: passed verbatim to other commands; this allows extra state (such as temporary directory names, VM identifiers, etc.) to be passed to cleanup</p></li>
</ul>
<h3>command: cleanup</h3>
<p>Called when closing the testbed; should revert/remove things installed in open as much as possible if the testbed is not ephemeral. This gets called with all the options that open got called with, plus <strong>extraopts</strong>.</p>
<h3>command: revert</h3>
<p>If there is a way to reset the testbed to its pristine state (such as using VM snapshots or rebuilding ephemeral testbeds), the script should put "revert" (and if appropriate, "revert-full-system") into the capabilities and implement this command. This can optionally output some or all of the ssh config keys from open() to update the configuration, in case the hostname/IP changes.</p>
<h3>command: reboot</h3>
<p>If the testbed can be rebooted with keeping state, the script should put "reboot" into the capabilities and implement this command.</p>
<h3>Included scripts</h3>
<p>autopkgtest provides setup scripts for common types of testbeds in <strong>/usr/share/autopkgtest/ssh-setup/</strong>. Please see the comments in these scripts for how to use them. Also, please consider using <strong>/usr/share/autopkgtest/ssh-setup/SKELETON</strong> as a basis for writing your own.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Run the tests of the libpng source package on an existing "mytesthost":</p>
<pre>
adt-run libpng --- ssh -H mytesthost -l joe -P /tmp/joe_password
</pre>
<p>Run the tests of a click package on an Ubuntu phone with an ssh connection over ADB, using the setup script, with specifying an option to the setup script to pick a particular serial ID:</p>
<pre>
adt-run ./ubuntu-calculator-app ./com.ubuntu.calculator_1.3.283_all.click &#92;
  --- ssh -s /usr/share/autopkgtest/ssh-setup/adb -- -s 0123456789abcdef
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO adt-virt-ssh&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/adt-run.1.html"><strong>adt-run</strong>(1)</a>, <strong>/usr/share/doc/autopkgtest/</strong>, <strong>/usr/share/autopkgtest/ssh-setup/SKELETON</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS AND COPYRIGHT</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-ssh</strong> was written by Martin Pitt &lt;martin.pitt@ubuntu.com&gt; and Jean-Baptiste Lallement &lt;jean.baptiste.lallement@ubuntu.com&gt;.</p><p>This manpage is part of autopkgtest, a tool for testing Debian binary packages.  autopkgtest is Copyright (C) 2006-2014 Canonical Ltd and others.</p><p>See <strong>/usr/share/doc/autopkgtest/CREDITS</strong> for the list of contributors and full copying conditions.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="adt-virt-schroot.1.html"><span aria-hidden="true">&larr;</span> adt-virt-schroot.1: Autopkgtest virtualisation server using a schroot</a></li>
   <li class="next"><a href="advdef.1.html">advdef.1: Advancecomp deflate compression utility <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
