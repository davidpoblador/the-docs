<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tesh: Testing shell</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Testing shell">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="tesh (1) manual">
  <meta name="twitter:description" content="Testing shell">
  <meta name="twitter:image" content="https://www.carta.tech/images/libsimgrid-dev-tesh-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/tesh.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="tesh (1) manual" />
  <meta property="og:description" content="Testing shell" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libsimgrid-dev-tesh-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">tesh<small> (1)</small></h1>
        <p class="lead">Testing shell</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/tesh.1.html">
      <span itemprop="name">tesh: Testing shell</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libsimgrid-dev/">
      <span itemprop="name">libsimgrid-dev</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/tesh.1.html">
      <span itemprop="name">tesh: Testing shell</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>tesh</strong> [<em>OPTION</em>]... [<em>FILE</em>]...</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This is the TESH tool. It constitutes a testing shell, ie a sort of shell specialized to run tests. The list of actions to take is parsed from files files called testsuite.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<pre>
  --cd some/directory : ask tesh to switch the working directory before
                        launching the tests
  --setenv var=value  : set a specific environment variable
  --cfg arg           : add parameter --cfg=arg to each command line
  --enable-coverage   : ignore output lines starting with "profiling:"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TESH FILE SYNTAX</h2>
        <div class="sectioncontent">
<p>Here is the syntax of these files:</p><p>The kind of each line is given by the first char (the second char should be blank and is ignored):</p><p> `$' command to run in foreground  `&' command to run in background  `&lt;' input to pass to the command  `&gt;' output expected from the command  `!' metacommand, which can be one of:</p>
<pre>
     `timeout' &lt;integer&gt;|no
     `expect signal' &lt;signal name&gt;
     `expect return' &lt;integer&gt;
     `output' &lt;ignore|display&gt;
     `setenv &lt;key&gt;=&lt;val&gt;'
</pre>
<p> `p' a string to print  `P' a string to print at the CRITICAL level (ease logging grepping)</p><p>If the expected output do not match what the command spits, TESH will produce an error showing the diff (see OUTPUT below).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">IO ORDERS</h2>
        <div class="sectioncontent">
<p>The &lt; and &gt; lines add IO to the command defined in the current block (blocks are separated by blank lines). It is possible to place these lines either after the command or before. The difference between the two following chunks is mainly cosmetic in your testsuites, TESH don't care. (cf IO-orders.tesh)</p><p> $ cat  &lt; TOTO  &gt; TOTO</p><p> &gt; TOTO  $ cat  &lt; TOTO</p><p>Nevertheless, it is possible to have several commands in the same block, but none of them can have any output. It may seem a bit restrictive, as one could say that a command gets all the IO until the next command, but I'm afraid of errors such as the following:</p><p> $ cd toto  &gt; TOTO  $ mkfile file</p><p>TOTO will be passed to the cd command, where the user clearly want to pass it to the mkfile built-in command (see below).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STREAM REDIRECTION</h2>
        <div class="sectioncontent">
<p>Stream redirections ("&gt;", "&lt;" and "|" constructs in sh) are not implemented yet in tesh. This is a bit restrictive, but well, patch welcome...</p><p>The situation in which it is mainly problematic is to create a temporary file. The solution is to use the "mkfile" built-in command, as in the following example: $ mkfile myFile &gt; some content &gt; to the file</p><p>This will create a file called myFile (first argument of the mkfile command). Its content will be all the input provided to the command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RETURN CODE</h2>
        <div class="sectioncontent">
<p>TESH spits an appropriate error message when the child do not return 0 as return code (cf. catch-return.tesh), and returns code+40 itself.</p><p>It is also possible to specify that a given command must return another value. For this, use the "expect return" metacommand, which takes an integer as argument. The change only apply to the next command (cf. set-return.tesh).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNALS</h2>
        <div class="sectioncontent">
<p>TESH detects when the child is killed by a signal (like on segfaults), and spits an appropriate error message (cf. catch-signal.tesh).</p><p>It is also possible to specify that a given command must raise a given signal. For this, use the "expect signal" metacommand. It takes the signal name as argument. The change only apply to the next command (cf. set-signal.tesh).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TIMEOUTS</h2>
        <div class="sectioncontent">
<p>By default, all commands are given 5 seconds to execute (cf. catch-timeout.tesh). You can change this with the "timeout", which takes an integer as argument. The change only apply to the next command (cf. set-timeout.tesh). If you pass "no" as argument, the command cannot timeout.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OUTPUT</h2>
        <div class="sectioncontent">
<p>By default, the commands output is matched against the one expected, and an error is raised on discrepancy. Metacommands to change this:  "output ignore"  -&gt; output completely discarded  "output display" -&gt; output displayed (but not verified)  "output sort"    -&gt; sorts the display before verifying it (see below)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SORTING OUTPUT</h2>
        <div class="sectioncontent">
<p>Sorting the output seems to be a strange idea, but it is mandatory in SimGrid since the processes run out of order at any scheduling point (ie, every processes ready to run at simulated time t run in parallel). To ensure that the simulator outputs still match, we have to sort the output back before comparing it.</p><p>We expect the simulators to run with that log formatting argument:</p>
<pre>
   --log=root.fmt:[%10.6r]%e(%i:%P@%h)%e%m%n
</pre>
<p>Then, tesh sorts string on the 19 first chars only, and is stable when line beginnings are equal. This should ensure that:  (1) tesh is effective (no false positive, no false negative)  (2) scheduling points are separated from each other  (3) at each scheduling point, processes are separated from each other  (4) the order of what a given process says at a given scheduling</p>
<pre>
     point is preserved.
</pre>
<p>This is of course very SimGrid oriented, breaking the generality of tesh, but who cares, actually?</p><p>If you want to change the length of the prefix used for the sort, simply specify it after the output sort directive, like this:</p><p>! output sort 22</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>You can add some content to the tested processes environment with the setenv metacommand. It works as expected. For example:</p>
<pre>
  "setenv PATH=/bin"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>No known bugs.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="teseq.1.html"><span aria-hidden="true">&larr;</span> teseq.1: Format text with terminal escapes and control sequences for human consumption.</a></li>
   <li class="next"><a href="tesseract.1.html">tesseract.1: Command-line ocr engine <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
