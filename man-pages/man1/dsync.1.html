<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dsync: Dovecots mailbox synchronization utility</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Dovecots mailbox synchronization utility">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dsync (1) manual">
  <meta name="twitter:description" content="Dovecots mailbox synchronization utility">
  <meta name="twitter:image" content="https://www.carta.tech/images/dovecot-core-dsync-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/dsync.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dsync (1) manual" />
  <meta property="og:description" content="Dovecots mailbox synchronization utility" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dovecot-core-dsync-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dsync<small> (1)</small></h1>
        <p class="lead">Dovecots mailbox synchronization utility</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dsync.1.html">
      <span itemprop="name">dsync: Dovecots mailbox synchronization utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dovecot-core/">
      <span itemprop="name">dovecot-core</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dsync.1.html">
      <span itemprop="name">dsync: Dovecots mailbox synchronization utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dsync</strong> [<em>options</em>] <strong>mirror</strong><em>location2</em></p><p><strong>dsync</strong> [<em>options</em>] <strong>backup</strong><em>location2</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>dsync</strong> is Dovecot&apos;s mailbox synchronization utility. It can be used for several different use cases: Two-way synchronization of mailboxes in different servers (via <strong>ssh</strong>(1)), creating backups of mails to a remote server, and convert mailboxes from/to different mailbox formats.</p><p>The syncing is done as perfectly as possible: an IMAP or a POP3 client shouldn&apos;t be able to notice any differences between the two mailboxes. Two-way syncing means that it&apos;s safe to do any kind of modifications in both sides, and <strong>dsync</strong> will merge the changes without losing any changes done on either side. This is possible because <strong>dsync</strong> can access Dovecot&apos;s index logs that keep track of changes. It&apos;s of course possible to have conflicts during merging, these are resolved in a safe way. See the <strong>dsync</strong> design document for more information.</p><p><strong>dsync</strong> uses the same configuration files as the rest of Dovecot (via doveconf binary). The entire configuration can be changed by giving -c parameter to another configuration file, or using -o parameter to override specific settings. When executing a remote <strong>dsync</strong> program it works the same way: it uses its own local configuration.</p><p><strong>dsync</strong> can be run completely standalone. It doesn&apos;t require any Dovecot server processes to be running, except when using -u parameter to do a userdb lookup from auth process.</p><p><strong>dsync</strong> can currently sync only one user at a time. If you want to <strong>dsync</strong> all users, you&apos;ll need to get a list of all users and execute <strong>dsync</strong> separately for each one.</p><p>Any errors are written to stderr.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p><strong>dsync</strong> recognizes the following command line options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-c</strong><em></em><strong>config-file</strong></p>
  </dt>
  <dd>
    <p>read configuration from the given <em>config-file</em>. By default <em>/etc/dovecot/dovecot.conf</em> will be used. <strong>-C</strong><em>alt_char</em> Specifies an alternative mailbox name character. If source and destination mailbox formats are different, it&apos;s possible that on one side there exists a mailbox name that isn&apos;t valid for the other side. These invalid mailbox names are fixed by replacing such invalid characters with the given <em>alt_char</em>. The default is &apos;<strong>_</strong>&apos;.</p>
  </dd>
  <dt>
    <p><strong>-D</strong></p>
  </dt>
  <dd>
    <p>Activates debug messages and makes <strong>dsync</strong> more verbose.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>Makes <strong>dsync</strong> run in &quot;full sync&quot; mode rather than &quot;fast sync&quot; mode. In fast sync mode <strong>dsync</strong> might skip syncing a mailbox, if both locations had modified it equally many times (i.e. highest-modseqs were equal), but with different changes.</p>
  </dd>
  <dt>
    <p><strong>-m</strong><em>mailbox</em></p>
  </dt>
  <dd>
    <p>Specifies the <em>mailbox</em> that should be synchronized or from which mails should be converted. The default is to synchronize all respectively convert from all mailboxes.</p>
  </dd>
  <dt>
    <p><strong>-o</strong><em>setting</em><strong>=</strong><em>value</em></p>
  </dt>
  <dd>
    <p>Overrides the configuration <em>setting</em> from <em>/etc/dovecot/dovecot.conf</em> and from the userdb with the given <em>value</em>. In order to override multiple settings, the <strong>-o</strong> option may be specified multiple times.</p>
  </dd>
  <dt>
    <p><strong>-R</strong></p>
  </dt>
  <dd>
    <p>Reverse backup direction, so mails in <em>location2</em> are backed up to default mail location.</p>
  </dd>
  <dt>
    <p><strong>-u</strong><em>user</em></p>
  </dt>
  <dd>
    <p>Specifies that the userdb lookup for the given <em>user</em> should be done and used to set up the environment (uid, gid, home, etc.). By default the system user&apos;s current environment will be used.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Makes <strong>dsync</strong> more verbose.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ARGUMENTS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>location2</em></p>
  </dt>
  <dd>
    <p>The first mail location is based on configuration (<em>mail_location</em> or <em>userdb</em> settings). It&apos;s also possible to override it by giving <strong>-o</strong><em>mail_location=</em><strong>mail_location</strong> setting. This parameter defines the other mail location that is used.</p><p>If the location is on local filesystem, you can use a regular mail_location, such as maildir:/backup/user/Maildir</p><p>If the location is on a remote server, <strong>dsync</strong> can ssh to it by giving <em>host</em> or <em>user@host</em> as the parameter. If user is specified, it&apos;s given as <strong>-u</strong> parameter to <strong>dsync</strong>, not to ssh. The ssh username is always the default.</p><p>The final way to specify a location is to give a full command line or a path to a script that executes the <strong>dsync</strong>. For example:</p>
<pre>
ssh mailuser@host dsync -u user
</pre>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDS</h2>
        <div class="sectioncontent">
<p><strong>dsync</strong> provides the following commands:</p><h3>mirror</h3>
<p>Does a two-way synchronization between two mail locations. Changes in both locations are synchronized to the other one, without losing any changes made by either of them. Any potential UID conflicts are resolved by giving them new UIDs.</p>
<h3>backup</h3>
<p>Backup mails from default mail location to <em>location2</em> (or vice versa, if <strong>-R</strong> parameter is given). No changes are ever done to the source location. Any changes done in destination are discarded.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p><strong>dsync</strong> will exit with one of the following values:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>0</strong></p>
  </dt>
  <dd>
    <p>Synchronization was done perfectly.</p>
  </dd>
  <dt>
    <p><strong>2</strong></p>
  </dt>
  <dd>
    <p>Synchronization was done without errors, but some changes couldn&apos;t be done, so the mailboxes aren&apos;t perfectly synchronized. Running dsync again usually fixes this. Typically this occurs for message modification sequences with newly created mailboxes. It can also occur if one of the mailboxes change during the syncing.</p>
  </dd>
  <dt>
    <p><strong>1, &gt;2</strong></p>
  </dt>
  <dd>
    <p>Synchronization failed.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<h3>MIRRORING</h3>
<p>Mirror mailboxes to a remote server. Any errors are written to stderr.</p>
<pre>
<strong>dsync -u username mirror username@example.com</strong>
</pre>
<p>If you need more complex parameters to ssh, you can use e.g.:</p>
<pre>
<strong>dsync -u username mirror ssh -i id_dsa.dovecot mailuser@example.com dsync -u username</strong>
</pre>

<h3>CONVERTING</h3>
<p>Assuming that the <em>mail_location</em> setting in <em>/etc/dovecot/conf.d/10-mail.conf</em> is set to: <strong>mail_location = mdbox:~/mdbox</strong>, a logged in system user may convert her/his mails from its Maildir in her/his home directory to the mdbox mailbox format. The user has to execute the command:</p>
<pre>
<strong>dsync mirror maildir:~/Maildir</strong>
</pre>
<p>If you want to do this without any downtime, you can do the conversion one user at a time. Initially:</p><ul>
<li><p>Configuration uses <strong>mail_location = maildir:~/Maildir</strong></p></li><li><p>Set up the possibility of doing per-user mail location using <em>userdb</em> extra fields.</p></li>
</ul><p>Then for each user:</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>Run <em>dsync mirror</em> once to do the initial conversion.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>Run <em>dsync mirror</em> again, because the initial conversion could have taken a while and new changes could have occurred during it. This second time only applies changes, so it should be fast.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>Update mail extra field in userdb to <strong>mdbox:~/mdbox</strong>. If you&apos;re using auth cache, you need to flush it.</p>
  </dd>
  <dt>
    4.
  </dt>
  <dd>
    <p>Wait for a few seconds and then kill the user&apos;s all existing imap and pop3 sessions (that are still using maildir).</p>
  </dd>
  <dt>
    5.
  </dt>
  <dd>
    <p>Run <em>dsync mirror</em> once more to apply final changes that were possibly done. After this there should be no changes to Maildir, because the user&apos;s mail location has been changed and all existing processes using it have been killed.</p>
  </dd>

</dl>
<p>Once all users have been converted, you can set the default <em>mail_location</em> to mdbox and remove the per-user mail locations from <em>userdb</em>.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs, including <em>doveconf -n</em> output, to the Dovecot Mailing List &lt;dovecot@dovecot.org&gt;. Information about reporting bugs is available at: http://dovecot.org/bugreport.html</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dsync&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/doveadm.1.html"><strong>doveadm</strong>(1)</a>, <a href="../man1/doveadm-kick.1.html"><strong>doveadm-kick</strong>(1)</a>, <a href="../man1/doveconf.1.html"><strong>doveconf</strong>(1)</a>, <a href="../man1/dovecot.1.html"><strong>dovecot</strong>(1)</a></p><p>Additional resources:</p>
<dl class='dl-vertical'>
  <dt>
    dsync design
  </dt>
  <dd>
    <p>http://wiki2.dovecot.org/Design/Dsync</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dstat.1.html"><span aria-hidden="true">&larr;</span> dstat.1: Versatile tool for generating system resource statistics</a></li>
   <li class="next"><a href="dt.1.html">dt.1: Ditrack command line client tool <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
