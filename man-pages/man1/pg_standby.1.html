<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pg_standby: Supports the creation of a postgresql warm standby server</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Supports the creation of a postgresql warm standby server">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pg_standby (1) manual">
  <meta name="twitter:description" content="Supports the creation of a postgresql warm standby server">
  <meta name="twitter:image" content="https://www.carta.tech/images/postgresql-contrib-9.4-pg_standby-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pg_standby.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pg_standby (1) manual" />
  <meta property="og:description" content="Supports the creation of a postgresql warm standby server" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/postgresql-contrib-9.4-pg_standby-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pg_standby<small> (1)</small></h1>
        <p class="lead">Supports the creation of a postgresql warm standby server</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pg_standby.1.html">
      <span itemprop="name">pg_standby: Supports the creation of a postgresql warm standby server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/postgresql-contrib-9.4/">
      <span itemprop="name">postgresql-contrib-9.4</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pg_standby.1.html">
      <span itemprop="name">pg_standby: Supports the creation of a postgresql warm standby server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>pg_standby</strong> [<em>option</em>...] <em>archivelocation</em> <em>nextwalfile</em> <em>xlogfilepath</em> [<em>restartwalfile</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>pg_standby supports creation of a &ldquo;warm standby&rdquo; database server. It is designed to be a production-ready program, as well as a customizable template should you require specific modifications.</p><p>pg_standby is designed to be a waiting <em>restore_command</em>, which is needed to turn a standard archive recovery into a warm standby operation. Other configuration is required as well, all of which is described in the main server manual (see Section 25.2, &ldquo;Log-Shipping Standby Servers&rdquo;, in the documentation).</p><p>To configure a standby server to use pg_standby, put this into its recovery.conf configuration file:</p>
<pre>
restore_command = &apos;pg_standby <em>archiveDir</em> %f %p %r&apos;
</pre>
<p>where <em>archiveDir</em> is the directory from which WAL segment files should be restored.</p><p>If <em>restartwalfile</em> is specified, normally by using the %r macro, then all WAL files logically preceding this file will be removed from <em>archivelocation</em>. This minimizes the number of files that need to be retained, while preserving crash-restart capability. Use of this parameter is appropriate if the <em>archivelocation</em> is a transient staging area for this particular standby server, but <em>not</em> when the <em>archivelocation</em> is intended as a long-term WAL archive area.</p><p>pg_standby assumes that <em>archivelocation</em> is a directory readable by the server-owning user. If <em>restartwalfile</em> (or -k) is specified, the <em>archivelocation</em> directory must be writable too.</p><p>There are two ways to fail over to a &ldquo;warm standby&rdquo; database server when the master server fails:</p><p>Smart Failover</p><p>In smart failover, the server is brought up after applying all WAL files available in the archive. This results in zero data loss, even if the standby server has fallen behind, but if there is a lot of unapplied WAL it can be a long time before the standby server becomes ready. To trigger a smart failover, create a trigger file containing the word smart, or just create it and leave it empty.</p><p>Fast Failover</p><p>In fast failover, the server is brought up immediately. Any WAL files in the archive that have not yet been applied will be ignored, and all transactions in those files are lost. To trigger a fast failover, create a trigger file and write the word fast into it. pg_standby can also be configured to execute a fast failover automatically if no new WAL file appears within a defined interval.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>pg_standby accepts the following command-line arguments:</p><p><strong>-c</strong></p><p>Use cp or copy command to restore WAL files from archive. This is the only supported behavior so this option is useless.</p><p><strong>-d</strong></p><p>Print lots of debug logging output on stderr.</p><p><strong>-k</strong></p><p>Remove files from <em>archivelocation</em> so that no more than this many WAL files before the current one are kept in the archive. Zero (the default) means not to remove any files from <em>archivelocation</em>. This parameter will be silently ignored if <em>restartwalfile</em> is specified, since that specification method is more accurate in determining the correct archive cut-off point. Use of this parameter is <em>deprecated</em> as of PostgreSQL 8.3; it is safer and more efficient to specify a <em>restartwalfile</em> parameter. A too small setting could result in removal of files that are still needed for a restart of the standby server, while a too large setting wastes archive space.</p><p><strong>-r</strong> <em>maxretries</em></p><p>Set the maximum number of times to retry the copy command if it fails (default 3). After each failure, we wait for <em>sleeptime</em> * <em>num_retries</em> so that the wait time increases progressively. So by default, we will wait 5 secs, 10 secs, then 15 secs before reporting the failure back to the standby server. This will be interpreted as end of recovery and the standby will come up fully as a result.</p><p><strong>-s</strong> <em>sleeptime</em></p><p>Set the number of seconds (up to 60, default 5) to sleep between tests to see if the WAL file to be restored is available in the archive yet. The default setting is not necessarily recommended; consult Section 25.2, &ldquo;Log-Shipping Standby Servers&rdquo;, in the documentation for discussion.</p><p><strong>-t</strong> <em>triggerfile</em></p><p>Specify a trigger file whose presence should cause failover. It is recommended that you use a structured file name to avoid confusion as to which server is being triggered when multiple servers exist on the same system; for example /tmp/pgsql.trigger.5432.</p><p><strong>-V</strong></p><p><strong>--version</strong></p><p>Print the pg_standby version and exit.</p><p><strong>-w</strong> <em>maxwaittime</em></p><p>Set the maximum number of seconds to wait for the next WAL file, after which a fast failover will be performed. A setting of zero (the default) means wait forever. The default setting is not necessarily recommended; consult Section 25.2, &ldquo;Log-Shipping Standby Servers&rdquo;, in the documentation for discussion.</p><p><strong>-?</strong></p><p><strong>--help</strong></p><p>Show help about pg_standby command line arguments, and exit.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>pg_standby is designed to work with PostgreSQL 8.2 and later.</p><p>PostgreSQL 8.3 provides the %r macro, which is designed to let pg_standby know the last file it needs to keep. With PostgreSQL 8.2, the -k option must be used if archive cleanup is required. This option remains available in 8.3, but its use is deprecated.</p><p>PostgreSQL 8.4 provides the <em>recovery_end_command</em> option. Without this option a leftover trigger file can be hazardous.</p><p>pg_standby is written in C and has an easy-to-modify source code, with specifically designated sections to modify for your own needs</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>On Linux or Unix systems, you might use:</p>
<pre>
archive_command = &apos;cp %p .../archive/%f&apos;

restore_command = &apos;pg_standby -d -s 2 -t /tmp/pgsql.trigger.5442 .../archive %f %p %r 2&gt;&gt;standby.log&apos;

recovery_end_command = &apos;rm -f /tmp/pgsql.trigger.5442&apos;
</pre>
<p>where the archive directory is physically located on the standby server, so that the <em>archive_command</em> is accessing it across NFS, but the files are local to the standby (enabling use of ln). This will:</p><p>produce debugging output in standby.log</p><p>sleep for 2 seconds between checks for next WAL file availability</p><p>stop waiting only when a trigger file called /tmp/pgsql.trigger.5442 appears, and perform failover according to its content</p><p>remove the trigger file when recovery ends</p><p>remove no-longer-needed files from the archive directory</p><p>On Windows, you might use:</p>
<pre>
archive_command = &apos;copy %p ...&#92;&#92;archive&#92;&#92;%f&apos;

restore_command = &apos;pg_standby -d -s 5 -t C:&#92;pgsql.trigger.5442 ...&#92;archive %f %p %r 2&gt;&gt;standby.log&apos;

recovery_end_command = &apos;del C:&#92;pgsql.trigger.5442&apos;
</pre>
<p>Note that backslashes need to be doubled in the <em>archive_command</em>, but <em>not</em> in the <em>restore_command</em> or <em>recovery_end_command</em>. This will:</p><p>use the copy command to restore WAL files from archive</p><p>produce debugging output in standby.log</p><p>sleep for 5 seconds between checks for next WAL file availability</p><p>stop waiting only when a trigger file called C:&#92;pgsql.trigger.5442 appears, and perform failover according to its content</p><p>remove the trigger file when recovery ends</p><p>remove no-longer-needed files from the archive directory</p><p>The copy command on Windows sets the final file size before the file is completely copied, which would ordinarily confuse pg_standby. Therefore pg_standby waits sleeptime seconds once it sees the proper file size. GNUWin32&apos;s cp sets the file size only after the file copy is complete.</p><p>Since the Windows example uses copy at both ends, either or both servers might be accessing the archive directory across the network.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Simon Riggs &lt;simon@2ndquadrant.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pg_standby&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/pg_archivecleanup.1.html"><strong>pg_archivecleanup</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pg_restore.1.html"><span aria-hidden="true">&larr;</span> pg_restore.1: Restore a postgresql database from an archive file created by pg_dump</a></li>
   <li class="next"><a href="pg_test_fsync.1.html">pg_test_fsync.1: Determine fastest wal_sync_method for postgresql <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
