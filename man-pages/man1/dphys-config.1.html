<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dphys-config: Daily auto-install/update and/or remove config files</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Daily auto-install/update and/or remove config files">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dphys-config (1) manual">
  <meta name="twitter:description" content="Daily auto-install/update and/or remove config files">
  <meta name="twitter:image" content="https://www.carta.tech/images/dphys-config-dphys-config-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/dphys-config.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dphys-config (1) manual" />
  <meta property="og:description" content="Daily auto-install/update and/or remove config files" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dphys-config-dphys-config-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dphys-config<small> (1)</small></h1>
        <p class="lead">Daily auto-install/update and/or remove config files</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dphys-config.1.html">
      <span itemprop="name">dphys-config: Daily auto-install/update and/or remove config files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dphys-config/">
      <span itemprop="name">dphys-config</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dphys-config.1.html">
      <span itemprop="name">dphys-config: Daily auto-install/update and/or remove config files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dphys-config</strong> [<strong>-f</strong> <em>filter</em>] [<strong>-cqvD</strong>]</p><p><strong>dphys-config</strong> <strong>-h</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>dphys-config installs/updates and/or removes config files. It also triggers commands after an new/updated config file is available or before an existing config file will disappear. It can be run by hand, from cron and/or from init.d.</p><p>Get an list of config files from an configuration server. For each file in the list retrieve that file from the same server, and only install it if it is new or changed relative to what is already here. If a file is newly installed (or changed) then run an postinstall script, which may trigger actions which are wanted to process the new config (such as inserting data from an config file into an database). Also remove unwanted files. If doing so first run an preremove script to tidy up stuff.</p><p>This is part of the D-PHYS (ETH Zuerich, Departement of Physics) automatic system operation and maintenance setup.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-c</strong></p>
  </dt>
  <dd>
    <p>configname: Use this set of config files instead of hostname set. Useful for chroot or vhost installs, or for tests.</p>
  </dd>
  <dt>
    <p><strong>-f &nbsp;filter</strong></p>
  </dt>
  <dd>
    <p>filter: Only process lines which match the filter spec.</p>
  </dd>
  <dt>
    <p><strong>-q</strong></p>
  </dt>
  <dd>
    <p>quiet: Don't produce an running report of activities.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>verbose: Give large volume output, where sensible.</p>
  </dd>
  <dt>
    <p><strong>-D</strong></p>
  </dt>
  <dd>
    <p>Debug: Activate an debug option. See source for how to use this.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>help: Output help text, and then abort operation.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIG</h2>
        <div class="sectioncontent">
<p>The config files <em>/etc/dphys-config</em> (sitewide) and <em>~/.dphys-config</em> (personal) allow the admin and users to set up the working environment for <strong>dphys-config</strong>.</p><p>These config files are sh script fragments full of assignments, which are sourced, in above row, later config files assignments overriding earlier ones. Standard sh syntax rules apply. Assignments are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>CONF_TMP_DIR</strong></p>
  </dt>
  <dd>
    <p>Sets the base directory in which all temporary files are stored. It defaults to <em>/var/tmp</em> (for enough size and safe operation). Some users may like to use <em>/tmp</em> for higher speed (tmpfs) or automatic deletion at boot time. Standard sh syntax rules apply. Assignments are:</p>
  </dd>
  <dt>
    <p><strong>CONF_BASEURL</strong></p>
  </dt>
  <dd>
    <p>Sets the base URL to which all */<em>&lt;hostname&gt;</em>/<em>&lt;filename&gt;</em> combinations are added when <strong>wget</strong>-ing config files. This can be an <em>http:</em> or <em>ftp:</em> or whatever other type of URL which <strong>wget</strong> understands and can fetch an file from. Additionally it can be an <em>file:</em> (this may be from an NFS server) URL, in which case wget is bypassed and the files fetched directly using <strong>cp</strong>. It defaults to the error message generating and aborting invalid setting of <em>http://not-configured-server.example.net/not/configured/directory</em>, as there is no sensible default possible. You must set this to where ever your config files should be taken from.</p>
  </dd>
  <dt>
    <p><strong>CONF_CONFNAME</strong></p>
  </dt>
  <dd>
    <p>Selects the name for which set of configuration files shall be used for this host. Defaults to <em>`hostname`</em>.</p>
  </dd>
  <dt>
    <p><strong>CONF_LINEFILTER</strong></p>
  </dt>
  <dd>
    <p>Sets an regexp which selects which lines from the config file list are processed. Defaults to <em>.*</em> (all).</p>
  </dd>
  <dt>
    <p><strong>CONF_LOG_DONE</strong></p>
  </dt>
  <dd>
    <p>Log to syslog that dphys-config has run. Good to see if cron and/or init.d have done their job. Defaults to <em>yes</em>.</p>
  </dd>

</dl>
<p>The config file list <em>dphys-config.list</em>, which is found via above settings, and is downloaded to <em>/etc/dphys-config.list</em> or <em>~/.dphys-config.list</em>, then allows the admin to list what config files are to be fetched and installed/updated or removed, and what scripts to run for them. These can be each given for the entire site (= all hosts) and/or group and/or each host, or even merged from site+group+host subsections.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>/etc/dphys-config</strong></p>
  </dt>
  <dd>
    <p>site admin config</p>
  </dd>
  <dt>
    <p><strong>~/.dphys-config</strong></p>
  </dt>
  <dd>
    <p>users personal config</p>
  </dd>
  <dt>
    <p><strong>/etc/dphys-config.list</strong></p>
  </dt>
  <dd>
    <p>roots config file list gets stored here</p>
  </dd>
  <dt>
    <p><strong>~/.dphys-config.list</strong></p>
  </dt>
  <dd>
    <p>users config file list gets stored here</p>
  </dd>
  <dt>
    <p><strong>$CONF_BASEURL/`hostname`/dphys-config.list</strong></p>
  </dt>
  <dd>
    <p>site-global (all hosts) common (usually, or group-global or host specific) config file list</p>
  </dd>
  <dt>
    <p><strong>$CONF_BASEURL/`hostname`/dphys-config.list.*</strong></p>
  </dt>
  <dd>
    <p>facultative host-specific (usually) or group-specific include-able subsection(s) to be added to above config file list dphys-config.list. We often use *.group (one per group of users) and *.host (per host), sometimes also *.base (all host types) and *.workstation (only workstation hosts) subsections <strong>$CONF_BASEURL/`hostname`/&lt;file-name&gt;</strong> actual config files referred to in config file list, common section (usually the only section) <strong>$CONF_BASEURL/`hostname`/&lt;file-name&gt;.*</strong> facultative host-specific (usually) or group-specific include-able subsection(s) to be added to above config file &lt;file-name&gt;</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIG FILE LIST</h2>
        <div class="sectioncontent">
<p>The config file list to be used for checking what files need to be installed/updated or removed and its subsections included by #@include lines are merged to one list file, analog to <strong>cpp</strong> #include.</p><p>These are all fetched via <strong>wget</strong> (or <strong>cp</strong> for file:), adding their names to the user-defined base URL in <em>CONF_BASEURL</em>, and then merged. So <em>CONF_BASEURL</em> can be any URL that <strong>wget</strong> understands http: or ftp: or whatever else, or file:.</p><p>The format of the resulting concatenated file must consist of lines, one per config file, of following format:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>file-name</strong>:<strong>place-on-target</strong>:<strong>command-to-trigger</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>Where the 3 fields have following meanings:</p>
  </dt>
  <dd>
    
<dl class='dl-vertical'>
  <dt>
    <p><strong>file-name</strong></p>
  </dt>
  <dd>
    <p>Name of the config file to be installed/updated. Must be only the base part of the filename on the server, without URL and hostname before it, and without any .* subsection endings after it, as these are all auto-added whenever they are needed. If this is set to <em>-</em> the line specifies an config file to be removed</p>
  </dd>
  <dt>
    <p><strong>place-on-target</strong></p>
  </dt>
  <dd>
    <p>Full directory or full filename (directory+filename) of where the file is to be placed on the target system. If only an directory is given (any name that ends in /), then the above file-name (inclusive any directories in it) will be automatically added to it. For removing this must be the full filename (or an directory name (without an /) if an entire directory and its contents shall disapper). An directory name ending with / is not processed, to prevent incomplete edits (filename replaced by -, but not added to directory) from killing entire directories (such as say all of /etc/ :-))</p>
  </dd>
  <dt>
    <p><strong>command-to-trigger</strong></p>
  </dt>
  <dd>
    <p>Full command (directory+filename, with parameters) of an command to be run, after this config file has been newly installed or changed/updated, or before this config file is removed. This can also be multiple commands separated by ; separators. Useful for doing chown/chmod to files that need it. If the marker <em>{}</em> appears in the command, this will be substituted by the filename the config file is going to be installed as. This is analog to <strong>find</strong> -exec filename substitution</p>
  </dd>

</dl>

  </dd>

</dl>
<p>Lines which begin with an <strong>#</strong> are regarded as comments, and don't have any effect anything (Lines extended with one are chopped off at that point). The same applies for empty lines.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PREPROCESSOR</h2>
        <div class="sectioncontent">
<p>If the first line of the config file list, or any config file fetched on its behalf, has the special format <strong>#@dphys-config-preprocess</strong> [<strong>action...</strong>] then this line will be stripped, and the rest of the file will be preprocessed. Depending on the list of <strong>action</strong>s present and their order (repeats are allowed) the file will be procesed. Valid <strong>action</strong>s are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>backtick</strong></p>
  </dt>
  <dd>
    <p>Anything inside backticks (<strong>``</strong>) will be executed as a command, and its stdout will then be substituted for the `` expression. This is analog to <em>sh</em> backtick substitution</p>
  </dd>
  <dt>
    <p><strong>if</strong></p>
  </dt>
  <dd>
    <p>For any line beginning with <strong>#@if</strong> the stuff between the #@if and the first <strong>;</strong> character will be executed as command, and if it returns true, everything after the ; will be left, else the entire line will be removed. This is analog to <em>shell if ... ;</em> conditional execution</p>
  </dd>
  <dt>
    <p><strong>include</strong></p>
  </dt>
  <dd>
    <p>For any line beginning with <strong>#@include</strong> the rest of the line is regarded as an subsection name, which will be added to the base filename, and then the resulting subsection file fetched (also by wget or cp) and substituted for the line. This is analog to an <em>C preprocessor #include</em> oder an <em>shell .</em> include</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The following allows you to fetch all your config file lists from an HTTP VirtualHost called www.admin.example.net under its subdirectory dphys-config.</p><p>In file <em>/etc/dphys-config</em>, on every host, so it can find the config file server:</p>
<pre>
# system will use ${CONF_BASEURL}/`hostname`/&lt;file-name&gt;*
CONF_BASEURL=http://www.admin.example.net/dphys-config
</pre>
<p>We advise using an subdirectory here, because other <em>/http://www.admin.example.net/*</em> directories may already contain other admin stuff you put on the same VirtualHost. Such as software packages, site news, etc.</p><p>For dphys-config to be useful you then need to make config file lists for it. And provide the actual config files that can be installed, driven by the lists. This is the largest job, as it basically amounts to extracting all your relevant config work from your site. Also known as reengineering your site.</p><p>Assuming your VirtualHost on <em>www.admin.example.net</em> has as its DocumentRoot <em>/vhost/www.admin</em>, you would then begin with an pseudo-host Directory for site-global common stuff: <em>/vhost/www.admin/dphys-config/SITE/</em>.</p><p>If your hosts are organised in groups with group-global common configs (such as professors, students, staff), make an pseudo-host for each group, such as: <em>/vhost/www.admin/dphys-config/PROFS/</em> and <em>*/STUDENTS/</em> and <em>*/STAFF/</em>.</p><p>Then for host specific stuff, assuming systems called prof1.example.com to prof3.example.com, stud1 to stud20, staff1 to staff5, server1 and server2, make for each its own directory: <em>/vhost/www.admin/dphys-config/prof1/</em> (and so on).</p><p>Note that we suggest using CAPITALS for pseudo-hosts and lowercase for actual hosts. This avoids name space collisions. You can also use loops like <em>for</em> host in [a-z]* ; do ... ; done to work (say generating symlinks to an new config file in all hosts). Well at least you can do this so long no one goes and sets LANGUAGE= or similar junk, then bash (or libc?) will hapily screw up case sensitivity and produce random lossage (yes, it was painfull).</p><p>After this add to <em>/vhost/www.admin/dphys-config/SITE/</em>, the actual config files as far as they are not host specific, or at least have an common section to all hosts. Example this would be <strong>/etc/hosts</strong> for all, an common section for <strong>/etc/motd</strong>, common or all for <strong>sendmail.cf</strong>, common for <strong>inetd.conf</strong>, nothing for the ssh hostkeys.</p><p>Then add, to an group, say <em>/vhost/www.admin/dphys-config/STUDENTS/</em>, whatever is specific to that group. Example this may be an entire special <strong>motd</strong> for the many changing users, or just an <strong>motd.group</strong> to #@include into the common one.</p><p>Then for each host in its <em>/vhost/www.admin/dphys-config/prof1/</em> (or so) add all that is specific to it. Such as its ssh key files. And its own <strong>motd.host</strong>, it it needs one. Same its <strong>inetd.conf.host</strong> if it is going to offer special stuff. An configs for services only this host has such as <strong>httpd.conf</strong>.</p><p>Then for each host add symlinks to the SITE or group versions that it is to use for common stuff, like on <em>/vhost/www.admin/dphys-config/stud1/</em>:</p>
<pre>
 .../dphys-config/stud1/dphys-config.list -&gt; ../SITE/dphys-config.list
 .../dphys-config/stud1/hosts -&gt; ../SITE/hosts
 .../dphys-config/stud1/inetd.conf -&gt; ../SITE/inetd.conf
 .../dphys-config/stud1/motd -&gt; ../SITE/motd
 .../dphys-config/stud1/motd.group -&gt; GROUP/motd
 .../dphys-config/stud1/GROUP -&gt; ../STUDENTS
 .../dphys-config/stud1/sendmail.cf -&gt; ../SITE/sendmail.cf
</pre>
<p>In the <em>/vhost/www.admin/dphys-config/SITE/</em> directory place the site-global common <strong>dphys-config.list</strong> for all your hosts, containing stuff like this:</p>
<pre>
# SITE dphys-config.list - just example stuff, for our exemplaric site
# basics
hosts:/etc/                      # simply works, no command
motd:/etc/                       # this will be assembled group specific
inetd.conf:/etc/:/etc/init.d/inetd restart  # needs an command to reload
sendmail.cf:/etc/mail/:/etc/init.d/sendmail restart  # not in /etc
# ssh restart only after last file, and ensure file modes for each file
ssh_host_key:/etc/ssh/:chown root:root {}; chmod 600 {}
ssh_host_rsa_key:/etc/ssh/:chown root:root {}; chmod 600 {}
ssh_host_dsa_key:/etc/ssh/:chown root:root {}; chmod 600 {}; /etc/init.d/sshd restart
# load stuff into an existing database file
seed.debconf:/etc/:debconf-set-selections {}
# other stuff
daemon1-conf:/etc/daemon1/conf   # rename so names can differ on server
daemon2-conf:/etc/daemon2/conf
daemon1/conf:/etc/               # same as above, but with directories on server
daemon2/conf:/etc/
testing:/etc/                    # put something in there for an test
# delete some stuff
-:/etc/testing                   # change to above test to get rid of it again
-:/etc/                          # you will get a warning if you leave this
#-:/etc                          # you would reinstall your system after the resulting  rm -rf /etc  :-)
# and some errors
#only-an-name                    # you would get an error: no place on target
#only-an-name:                   # you would get an error: no place on target
#:only-an-place                  # you would get an error: no file to install
</pre>
<p>For special services add an <strong>dphys-config.list.host</strong> on each host that has special config files not present on others, such as on <em>/vhost/www.admin/dphys-config/server2/</em>:</p>
<pre>
# server2 dphys-config.list.host - only used on our web server
httpd.conf:/etc/apache/httpd.conf:/etc/init.d/apache restart
</pre>
<p>You can also use dphys-config to run arbitrary commands, whenever config files are installed/updated or removed, to modify existing config files, or more likely modify complex config databases which can not be provided as files, but where one can provide edit info as files.</p><p>dphys-config can even install scripts to use as above commands (or even just to run scripts while installing), such as into <em>/usr/local/sbin/</em>.</p><p>For this make an <em>../SITE/local/sbin/</em> directory, place the scripts in there (such as <em>../SITE/local/sbin/dphys-config-&lt;whatever&gt;</em>), and symlink <em>local</em> to <em>../SITE/local</em> on each host, and then add config lines for the scripts, with the command to trigger them, giving something like this:</p>
<pre>
local/sbin/dphys-config-&lt;whatever&gt;:/usr/:chmod 755 {}; {}  # chmod and run
</pre>
<p>It this script processes an config file your will want it to be run if either the script or the config file is updated, so add the script to the laters line as well:</p>
<pre>
dphys-config-&lt;whatever&gt;:/etc/:if [ -x /usr/local/sbin/dphys-config-&lt;whatever&gt; ] ; then /usr/local/sbin/dphys-config-&lt;whatever&gt; ; fi  # run also here
</pre>
<p>Finally, new hosts can then later simply be added, by making the new hosts directory and copying all files and symlinks from an existing host of the same group. Such as by doing:</p>
<pre>
mkdir student21
tar -cf - -C student1 . | tar xpf - -C student21
</pre>
<p>To then run dphys-config by hand (say for tests), type on the host:</p><p><strong>dphys-config</strong></p><p>But usually you will want to run dphys-config automatically, every night (or if a machine was/is switched off, at every boot), to keep your configs up to date.</p><p>For nightly updates the best thing is to use an cron job on every host. 03:00 to 03:59 is most likely idle time. Use an line like this one, with the <em>cron</em> option to avoid an load peak on the config file server, by random delaying the run by 0..3599 seconds, and with stdout and strerr thrown away to avoid getting an mail from every host, as error messages are also allways sent to syslog:</p><p>0 3 * * *	root	dphys-config cron &gt; /dev/null 2&gt;&1</p><p>To catch machines switched off over night, with no cron run on them, also run an init.d script. Use an script like this one, also with stdout and stderr thrown away to avoid cluttering your boot console output:</p>
<pre>
#!/bin/sh
# /etc/init.d/dphys-config - boot time automatic config updates, if no cron
case "$1" in
  start)
    dphys-config init &gt; /dev/null 2&gt;&1
    ;;
esac
exit 0
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY</h2>
        <div class="sectioncontent">
<p>If dphys-config is to be used to distribute <em>all</em> config files, this will also include files which are security relevant, such as ssh private keys (host key or (root) user authentification), SSL certificates, passwd and shadow, lilo.conf, software license keys, etc.</p><p>As all files are most likely fetched from an http: URL, measures must be taken to secure the config website from other people downloading them. We here use an restriction to only IP addresses registered as hosts in our NIS server, and additionally run identd on all allowed hosts, and require the wget process opening the HTTP connection to be running by user root, and so also require dphys-config to run as root.</p><p>To avoid sniffing it is recommended to give wget an https: URL.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GOTCHAS</h2>
        <div class="sectioncontent">
<p>Config files are read by wget from an webserver, so they lose their owners and modes. So the commands triggered on their lines must be used to chown/chmod them to proper values.</p><p>When used together with <em>dphys-admin</em>, dphys-config should run as first (earlier cron and init.d entries). This is needed to provide configs before new packages are installed, so dphys-admin can pretend that the packages were already once installed (and then non-purge removed), and so prevent questions on install, which is required for unattended installs. [Note that this pretending does not go as far as setting debconf up. Broken packages that ignore config files and only look at debconf will still ask questions.]</p><p>As result of this, when installing for the first time on an new system (such as installing Debian by the <em>dphys3</em> end2stage feature, which installs first dphys-config and then dphys-admin), any scripts installed by packages by dphys-admin, to be called on config file install/update will still be missing, and so not runnable. Either ignore the warnings, or better call the scripts by something like this:</p><p>file:place:if [ -x script ]; then script; fi</p><p>Note that in this case, trying to run dphys-config for a second time after dphys-admin has installed packages and scripts, will <strong>not</strong> automatically mend this, as the config files have not changed, and so dphys-config will not (re-)run their scripts. Therefore packages containing such scripts must also, as part of their postinst (or init.d which is called by postinst), check for existing config files and then run their scripts. This is the normal behaviour of quite a few packages anyway. Of course this requires the scripts to be idempotent, which is official Debian policy anyway.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>neil@franklin.ch, http://neil.franklin.ch/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dpbindic.1.html"><span aria-hidden="true">&larr;</span> dpbindic.1: Convert a binary-form dictionary into a text-form dictionary</a></li>
   <li class="next"><a href="dpigs.1.html">dpigs.1: Show which installed packages occupy the most space <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
