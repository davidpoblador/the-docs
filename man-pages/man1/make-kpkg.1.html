<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>make-kpkg: Build debian kernel packages from linux kernel sources</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Build debian kernel packages from linux kernel sources">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="make-kpkg (1) manual">
  <meta name="twitter:description" content="Build debian kernel packages from linux kernel sources">
  <meta name="twitter:image" content="https://www.carta.tech/images/kernel-package-make-kpkg-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/make-kpkg.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="make-kpkg (1) manual" />
  <meta property="og:description" content="Build debian kernel packages from linux kernel sources" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/kernel-package-make-kpkg-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">make-kpkg<small> (1)</small></h1>
        <p class="lead">Build debian kernel packages from linux kernel sources</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/make-kpkg.1.html">
      <span itemprop="name">make-kpkg: Build debian kernel packages from linux kernel sources</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/kernel-package/">
      <span itemprop="name">kernel-package</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/make-kpkg.1.html">
      <span itemprop="name">make-kpkg: Build debian kernel packages from linux kernel sources</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>make-kpkg</strong> [<em>options</em>] [<em>target</em> [<em>target</em> ...]]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This manual page explains the Debian <strong>make-kpkg</strong> utility, which is used to create the kernel related Debian packages. This utility needs to be run from a top level Linux kernel source directory, which has been previously configured (unless you are using the configure target). Normally, if kernel-package does not find a <em>.config</em> file in the current directory, it tries very hard to get an appropriate one (usually a config file already tailored for Debian kernels for that architecture), and then calls <strong>make oldconfig</strong> to let the user answer any new questions. However, this might still result in an inappropriate configuration, you are encouraged to confugre the kernel by the usual means before invoking <strong>make-kpkg.</strong></p><p>Typically, <strong>make-kpkg</strong> should be run under <strong>fakeroot,</strong></p><p>make-kpkg --rootcmd fakeroot kernel_image</p><p>but instead you run this command as root (this is not recommended), or under <strong>fakeroot</strong>, or tell <strong>make-kpkg</strong> how to become root (not recommended either, <strong>fakeroot</strong> is perhaps the safest option), like so:</p><p>make-kpkg --rootcmd sudo kernel_image</p><p>The Debian package file is created in the parent directory of the kernel source directory where this command is run.</p><p>Also, please note that some versions of gcc do not interact well with the kernel sources (gcc 2.95 has problems compiling the kernel without the flag <em>'-fno-strict-aliasing'</em>. This issue has been taken care of for recent kernels (2.2 and 2.4 series are fine) (I think you may have to edit the makefile for older kernels, or something).  You may control which version of gcc used in kernel compilation by setting the Makefile variables CC and HOSTCC in the top level kernel Makefile. You can do this simply by setting the environment variable <strong>MAKEFLAGS</strong>. To observe, try:</p>
<pre>
  % KBUILD_VERBOSE=1 MAKEFLAGS="CC=gcc-4.4" make-kpkg configure
</pre>
<p>The <strong>KBUILD_VERBOSE</strong> shows the details of the commands being run. (please see the top level kernel Makefile for variables that can be set).</p><p><strong>WARNING</strong>: Do NOT set the -j option in MAKEFLAGS directly, this shall cause the build to fail. Use CONCURRENCY_LEVEL as specified below. There is also a -j flag that can be used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>--help</strong></p>
  </dt>
  <dd>
    <p>Print out a usage message.</p>
  </dd>
  <dt>
    <p><strong>--revision</strong><em> number</em></p>
  </dt>
  <dd>
    <p>Changes the version number for the packages produced to the argument <em>number</em>. This has certain constraints: the version may contain only alphanumerics and the characters ~ + . (tilde, full stop and plus) and must contain a digit. (Look at the Policy manual for details). Optionally, you may prepend the revision with a digit followed by a colon (:). The default is <strong>10.00.Custom</strong> unless the environment variable <strong>DEBIAN_REVISION_MANDATORY</strong> is set, in which case an error is generated if the revision is not set on the command line or the configuration file. <strong>Hint</strong>: You may set it to $(version)-&lt;foo&gt; in the configuration file to get the upstream version number prepended to your custom string &lt;foo&gt;.</p>
  </dd>
  <dt>
    <p><strong>--append-to-version</strong><em> foo</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>--append_to_version</strong><em> foo</em></p>
  </dt>
  <dd>
    <p>This argument (<em>foo</em>) is appended to the value of the  EXTRAVERSION variable present in the kernel Makefile. Since EXTRAVERSION is a component of the kernel version, it is also added to the Debian package name, and, as such must obey the policy governing the package name. That means it may contain only <strong>lowercase</strong> alphanumerics and the characters ~ - + . (tilde, full stop, hyphen, and plus). Uppercase letters are not permitted under the Policy for a new package.  If the environment variable <strong>IGNORE_UPPERCASE_VERSION</strong> is set, make-kpkg shall lower case version numbers set in the Makefile or in the <em>localversion</em> file. This option overrides the environment variable <strong>APPEND_TO_VERSION</strong>.</p>
  </dd>
  <dt>
    <p><strong>--added-modules</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>--added_modules</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    <p>The argument should be a comma separated list of additional add-on modules (not in the main kernel tree) that you wish to build when you invoke the modules_blah targets. You may give full path names of the directory the modules reside in, or just the module name if it can be found in <strong>MODULE_LOC</strong>, which defaults to <em>/usr/src/modules</em>. The default is that all modules in <strong>MODULE_LOC</strong>, are compiled when the modules_blah targets are invoked.</p>
  </dd>
  <dt>
    <p><strong>--arch</strong>foo</p>
  </dt>
  <dd>
    <p>This is useful for setting the architecture when you are cross compiling. If you are not cross compiling, the architecture is determined automatically. The same effect can be achieved by setting the environment variable <strong>KPKG_ARCH.</strong> The value should be whatever <strong>DEB_HOST_ARCH_CPU</strong> contains when <em>dpkg-architecture</em> is run on the target machine, or it can be another architecture in a multi-arch set (like i386/amd64).</p>
  </dd>
  <dt>
    <p><strong>--cross-compile</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>--cross_compile</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    <p>This is useful for setting the target string when you are cross compiling. Use the dummy target "-" if you are building for other arches of a multiarch set, like i386/amd64. The same effect can be achieved by setting the environment variable. Please note that this does not in any way set the compiler the kernel build process shall use; if the default compiler that the build process comes up with is not the one desired, please explicitly specify the compiler that should be used. <strong>CROSS_COMPILE</strong></p>
  </dd>
  <dt>
    <p><strong>--subarch</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    <p>Some architectures (the Alpha, and the m68k) require a different kernel for each sub-architecture. This option provides a way of specifying it as an argument to <strong>make-kpkg</strong>. <strong>Please note</strong> that additional support for sub-architectures may be required in the kernel sources to actually make this do anything. The same effect can be achieved by setting the environment variable <strong>KPKG_SUBARCH</strong>.</p>
  </dd>
  <dt>
    <p><strong>--arch-in-name</strong></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>--arch_in_name</strong></p>
  </dt>
  <dd>
    <p>This option uses an extended name for the kernel image package by embedding the sub-architecture in the image name, so one could write a script to create multiple sub-architectures one after the other. You may also do this by setting the environment variable <strong>ARCH_IN_NAME</strong>. <strong>Please note</strong> that only the package <em>name</em> is affected, not modules locations etc.</p>
  </dd>
  <dt>
    <p><strong>--pgpsign</strong><em> name</em></p>
  </dt>
  <dd>
    <p>Set the string used to sign the <strong>changes</strong> file for any external modules in <em>/usr/src/modules/</em> using PGP. This option will override the builtin default and the site wide customizations stored in the file <em>/etc/kernel-pkg.conf</em> or <em>~/.kernel-pkg.conf</em>.</p>
  </dd>
  <dt>
    <p><strong>--config</strong><em> target</em></p>
  </dt>
  <dd>
    <p>Change the type of configure done from the default oldconfig. <em>target</em> must be one of oldconfig, config, menuconfig, gconfig, nconfig, xconfig, randconfig, defconfig, allmodconfig, allyesconfig, allnoconfig,  old, menu, g, or x.</p><p><strong>Note</strong> however that <strong>make-kpkg</strong> scans the config file at start up for some options, notably the fact that modules are enabled or not, so toggling the status during the delayed configuration results in an error. If needed, create the configuration file as close to the desired one before calling make-kpkg with this switch.</p>
  </dd>
  <dt>
    <p><strong>--targets</strong></p>
  </dt>
  <dd>
    <p>Prints out a list of known targets. See the Section <strong>Targets</strong> below.</p>
  </dd>
  <dt>
    <p><strong>--noexec</strong></p>
  </dt>
  <dd>
    <p>Pass a <strong>-n</strong> option to the <em>make</em> process so that commands are merely printed to the screen but not actually executed. This is very useful for debugging.</p>
  </dd>
  <dt>
    <p><strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>This calls <em>make</em> with the -V=1 option, which calls out the top level Make commands, also useful in seeing what is happening.</p>
  </dd>
  <dt>
    <p><strong>--initrd</strong></p>
  </dt>
  <dd>
    <p>If <strong>make-kpkg</strong> is generating a <em>kernel-image</em> package, arrange to convey to the hook scripts run from the post installation maintainer scripts that this image requires an <em>initrd</em>, and that the <em>initrd</em> generation hook scripts should not short circuit early. Without this option, the example <em>initramfs</em> hook scripts bundled in with <strong>kernel-package</strong> will take no action on installation. The same effect can be achieved by setting the environment variable <strong>INITRD</strong> to any non empty value.  Please note that unless there are hook scripts in <em>/etc/kernel</em> or added into the hook script parameter of <em>/etc/kernel-img.conf</em>, no initrd will be created (the bundled in example scripts are just examples -- user action is required before anything happens).</p>
  </dd>
  <dt>
    <p><strong>--jobs</strong><em> number</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>-j</strong><em> number</em></p>
  </dt>
  <dd>
    <p>Set the environment variable <strong>CONCURRENCY_LEVEL</strong> to <em>number</em>.</p>
  </dd>
  <dt>
    <p><strong>--overlay-dir</strong><em> /path/to/directory</em></p>
  </dt>
  <dd>
    <p>The specified directory should contain files that will be placed in the <em>./debian</em> directory of the kernel sources, in preparation to building the debian packages. The files will replace anything in <em>/usr/share/kernel-package</em> that would normally be placed there, and it is up to the user to make sure that the files in the overlay directory are compatible with <strong>make-kpkg</strong>. If you break <strong>make-kpkg</strong> with an overlay file, you get to keep the pieces. The same effect can be achieved by setting the environment variable <strong>KPKG_OVERLAY_DIR</strong>.</p><p>Please note that <em>overlay-dir/Control</em> and <em>overlay-dir/changelog</em> are special, and variable substitution is performed on these files. Use <em>/usr/share/kernel-package/Control</em> and <em>/usr/share/kernel-package/changelog</em> files as templates.</p><p>If a <em>overlay-dir/post-install</em> executable (or executable script) exists, it shall be run immediately after <em>./debian</em> is populated. The script shall be executed in the <em>./debian</em> directory. This can be used, for instance, to delete files the user does not want, or to take actions other than simple replacement.</p>
  </dd>
  <dt>
    <p><strong>--rootcmd foo</strong></p>
  </dt>
  <dd>
    <p>The command that provides a means of gaining super user access (for example, `sudo' or `fakeroot') as needed by dpkg-buildpackage's -r option. This option does not work for three of the targets, namely, <em>binary</em>, <em>binary-indep</em>, and <em>binary-arch</em>. For those targets the entire <em>make-kpkg</em> command must be run as (fake)root.</p>
  </dd>
  <dt>
    <p><strong>--stem</strong><em></em><strong>foo</strong></p>
  </dt>
  <dd>
    <p>Call the packages <em>foo</em>-* instead of kernel-*. This is useful in helping transition from calling the packages kernel-* to linux-* packages, in preparation for non-linux kernels in the distribution. The default is linux. The stem, since it is the initial part of a package name must consist only of lower case letters (`a-z'), digits (`0-9'), plus (`+') and minus (`-') signs, and periods (`.').  It must be at least two characters long and must start with an alphanumeric character.</p>
  </dd>
  <dt>
    <p><strong>--us</strong></p>
  </dt>
  <dd>
    <p>This option is passed to dpkg-buildpackage, and directs that package not to sign the source. This is only relevant for the buildpackage target.</p>
  </dd>
  <dt>
    <p><strong>--uc</strong></p>
  </dt>
  <dd>
    <p>This option is passed to dpkg-buildpackage, and directs that package not to sign the changelog. This is only relevant for the buildpackage target.</p>
  </dd>

</dl>
<p>The options maybe shortened to the smallest unique string, and may be entered with either a - or a -- prefix, and you may use a space or an = symbol between an option string and a value. You may also use the form option=value; for details these and other variant forms supported, please read <strong>Getopt::Long</strong>(3perl).</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>CONCURRENCY_LEVEL</strong></p>
  </dt>
  <dd>
    <p>If defined, this environment variable sets the concurrency level of make used to compile the kernel and the modules set using <em>-j</em> flags to the sub make in the <strong>build</strong> target of <strong>make-kpkg</strong>. Should be a (small) integer, if used. You can get the current number of CPUs using the command:</p><p>grep -c '^processor' /proc/cpuinfo</p><p><strong>WARNING</strong>: Do NOT set the -j option in MAKEFLAGS directly, this shall call the build to fail. It is possible to set -j as a make-kpkg argument.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TARGETS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>clean</strong></p>
  </dt>
  <dd>
    <p>Cleans the kernel source directory of all files created by target <strong>build,</strong> and runs a make distclean. (Please look at a Linux kernel Makefile for details).  Please note that although we take care of the list of current kernel configuration contained in the file <em>.config</em>, the file <em>include/linux/autoconf.h</em> is not preserved. This target should not be combined with other targets, since <strong>make-kpkg</strong> reads in all data <em>before</em> running any target, so the subsequent targets shall be run with the old data, which may not be what you want.</p>
  </dd>
  <dt>
    <p><strong>buildpackage</strong></p>
  </dt>
  <dd>
    <p>This target runs the targets <strong>clean</strong>, and <strong>binary</strong>, and produces the complete package using <strong>dpkg-buildpackage</strong>.</p>
  </dd>
  <dt>
    <p><strong>binary</strong></p>
  </dt>
  <dd>
    <p>This target produces all four Debian kernel packages by running the targets <strong>binary-indep</strong> and <strong>binary-arch</strong>. However, this requires <em>make-kpkg</em> to be run as root (or fakeroot), since <em>--rootcmd</em> will not work.</p>
  </dd>
  <dt>
    <p><strong>binary-indep</strong></p>
  </dt>
  <dd>
    <p>This target produces the arch independent packages by running the targets <strong>kernel_source</strong>, <strong>kernel_manual</strong> and <strong>kernel_doc</strong>. However, this also requires <em>make-kpkg</em> to be run as root (or fakeroot), since <em>--rootcmd</em> will not work.</p>
  </dd>
  <dt>
    <p><strong>binary-arch</strong></p>
  </dt>
  <dd>
    <p>This target produces the arch dependent packages by running the targets <strong>kernel_headers</strong> and <strong>kernel_image</strong>. However, this also requires <em>make-kpkg</em> to be run as root (or fakeroot), since <em>--rootcmd</em> will not work.</p>
  </dd>
  <dt>
    <p><strong>kernel_source</strong></p>
  </dt>
  <dd>
    <p>This target produces a debianised package of the Linux kernel sources. If the environment variable <strong>SOURCE_CLEAN_HOOK</strong> points to an executable, then that executable shall be run from the temporary (top) directory of the kernel sources just before packaging it, <em>./debian/tmp-source/usr/src/kernel-source-X.X.XX,</em> so people may take any action they see fit (remove arch trees, prune version control directories, <em>find . -type d -name CVS -prune -exec rm -rf {} &#92;;</em> etc.). This has no effect on anything other than the kernel sources that are being packaged -- if the script operates on the current directory and its children, the original source tree should remain intact. The environment variables <strong>HEADER_CLEAN_HOOK</strong> and <strong>DOC_CLEAN_HOOK</strong> are similar. They should point to executables, then that executable shall be run from the temporary (top) directory of the kernel headers and documentation just before packaging respectively, so people may take any action they see fit. This also has no effect on anything other than the sources that are being packaged.</p>
  </dd>
  <dt>
    <p><strong>kernel_debug</strong></p>
  </dt>
  <dd>
    <p>This target produces a Debian package containing the debugging symbols for the modules contained in the corresponding image package. The basic idea here is to keep the space in <em>/lib/modules/&lt;kver&gt;</em> under control, since this could be on a root partition with space restrictions. Please <strong>note</strong> that if module signatures are enable in the kernel configuration the corresponding image package will not have modules with the debugging link pointing to these debugging symbol files. In order to turn on debugging links for modules in the image package you need to turn off module signatures.</p>
  </dd>
  <dt>
    <p><strong>kernel_headers</strong></p>
  </dt>
  <dd>
    <p>This target produces a Debian package containing the header files included in the Linux kernel.</p>
  </dd>
  <dt>
    <p><strong>kernel_manual</strong></p>
  </dt>
  <dd>
    <p>This target produces a Debian package containing the section 9 manual pages included in the Linux kernel. Please note that this is not really an independent target; calling this shall also invoke the <em>kernel_doc</em> target, and creates a kernel-doc package at the same time.</p>
  </dd>
  <dt>
    <p><strong>kernel_doc</strong></p>
  </dt>
  <dd>
    <p>This target produces a Debian package containing the documentation included in the Linux kernel. This can be called independently of the <em>kernel_manual</em> target, but not the other way around.</p>
  </dd>
  <dt>
    <p><strong>kernel_image</strong></p>
  </dt>
  <dd>
    <p>This target produces a Debian package of the Linux kernel source image, and any modules configured in the kernel configuration file <em>.config</em>. If there is no <em>.config</em> file in the kernel source directory, a default configuration is provided similar to the one used to create the <strong>Debian</strong> boot-floppies. If the kernel configuration file has enabled support for modules, modules will be created and installed. If module signatures are not enabled, the resulting modules will have a link to the location of the debugging symbols file for the mdoule, usually installed by the debug package.</p><ul>
<li><p>If the file <em>./debian/post-install</em> exists, and is an executable, it is run just before the kernel image package is created.  Also, please note that if there are any scripts in <em>./debian/image.d/</em> directory, <strong>run-parts</strong> shall be called on that directory just before the kernel image package is built. The location of the root of the image package being built shall be passed in the environment variable <strong>IMAGE_TOP</strong>, and the kernel version is passed in through the environment variable <strong>version</strong> for all these scripts.</p></li><li><p>Please see the documentation about hooks in <a href="../man5/kernel-img.conf.5.html"><strong>kernel-img.conf</strong>(5)</a>. These hooks are variables that can be pointed by the local sysadmin to scripts that add or remove a line from the grub menu list at kernel image install and remove times. A sample script to add lines to a grub menu file is included in the directory <em>/usr/share/doc/kernel-package/.</em></p></li><li><p>Apart from hook variables that the local admin may set, there are a set of directories where packages, or the local admin, may drop in script files. The directories are <em>/etc/kernel/preinst.d/</em>, <em>/etc/kernel/postinst.d/</em>, <em>/etc/kernel/prerm.d/</em>, <em>/etc/kernel/postrm.d/</em>, <em>/etc/kernel/preinst.d/&lt;VERSION&gt;/</em>, <em>/etc/kernel/postinst.d/&lt;VERSION&gt;/</em>, <em>/etc/kernel/prerm.d/&lt;VERSION&gt;/</em>, and <em>/etc/kernel/postrm.d/&lt;VERSION&gt;/</em>. If they exists, the kernel-image package shall run a <strong>run-parts</strong> program over the directory (including the versioned one), giving the version being installed or removed as an argument, in the corresponding phase of installation or removal. Before calling these scripts, the env variable <strong>STEM</strong> shall be set to the value of the <em>--stem</em> argument (or the default value, linux), and the variable <strong>KERNEL_PACKAGE_VERSION</strong> shall be set to the version of the kernel-package that created the package. These scripts shall be called with two arguments, the first being the <em>version</em> of the kernel image, and the second argument being the <em>location</em> of the kernel image itself. Since debconf is in use before the script is called, this script should issue no diagnostic messages to stdout --  while the postinst does call <strong>db_stop</strong>, debconf does not restore stdout, so messages to stdout disappear.</p></li><li><p>On installation, it also offers to run the Linux loader, <em>LILO</em> (or alternates like <em>loadlin</em>, <em>SILO</em>, <em>QUIK</em>, <em>VMELILO</em>, <em>ZIPL</em>, <em>yaboot</em>, <em>PALO</em> or <em>GRUB</em>), creating a configuration file for supported boot loaders if needed. At that time it also offers to put the new kernel on a floppy, formatting the floppy if needed.  On deletion, the package checks the version of the kernel running, and refuses to delete a running kernel. <em>grub</em> rates a special mention here, since grub may not need to be rerun after installing a kernel image, though an automated change to the menu list would be nice on install and removal of kernel image packages.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>build</strong></p>
  </dt>
  <dd>
    <p>This target, used by target <strong>kernel_image</strong> above, compiles the Linux kernel image.</p>
  </dd>
  <dt>
    <p><strong>modules</strong></p>
  </dt>
  <dd>
    <p>This target allows you to build all add-on modules and packages that are very dependent on the precise kernel version they are compiled for at the same time you build your kernel image.  This target expects to find the modules or packages under /usr/src/modules, and, for all such directories, changes to MODULE_LOC/x (MODULE_LOC defaults to <em>/usr/src/modules</em>), and runs the <strong>kdist</strong> rule in the local <em>debian.rules</em> file. This target should create the <strong>Debian</strong> module package(s), and may also produce a compressed tar file, and a compressed diff file, with <em>md5sums</em> recorded in a changes file using <strong>dpkg-genchanges</strong>. The file is signed by the same identity that would be used to sign the kernel packages. This option is used by maintainers uploading the package to the Debian archives.</p>
  </dd>
  <dt>
    <p><strong>modules_config</strong></p>
  </dt>
  <dd>
    <p>This target allows you to configure all packages under <strong>MODULE_LOC</strong>, which defaults to <strong>/usr/src/modules</strong>. This is useful if you need to manually modify some aspects of the configuration, or if you want to manually compile the add on modules. This should not be called unless you already have a ./debian directory.</p>
  </dd>
  <dt>
    <p><strong>modules_image</strong></p>
  </dt>
  <dd>
    <p>This target allows you to build all packages under <strong>MODULE_LOC</strong>, which defaults to <strong>/usr/src/modules</strong>, but does not create the source or diff files, and does not create and sign a changes file. This is the only modules related option you need if you just want to compile the add on modules image files for installation on one or more machines. Generally called in conjunction with <strong>kernel_image</strong>, especially if also using the option <strong>append_to_version</strong> (prevents spurious warnings). This should not be called unless you already have a ./debian directory.</p>
  </dd>
  <dt>
    <p><strong>modules_clean</strong></p>
  </dt>
  <dd>
    <p>This target allows you to clean all packages under <strong>MODULE_LOC</strong>, which defaults to <strong>/usr/src/modules</strong>, and this should be all that is needed to undo the effect of any of the other modules_ targets. This should not be called unless you already have a ./debian directory.</p>
  </dd>
  <dt>
    <p><strong>configure</strong></p>
  </dt>
  <dd>
    <p>This target runs configure (actually, <strong>config_target</strong>, set by <strong>--config</strong> which defaults to <em>oldconfig</em>) early, so you may edit files generated by <strong>make config</strong> in the kernel source directory and not have them stomped by <strong>make-kpkg</strong> later.</p>
  </dd>
  <dt>
    <p><strong>debian</strong></p>
  </dt>
  <dd>
    <p>This target creates the <em>./debian</em> directory, and optionally patches the source. This target is called by the <strong>configure</strong> target. You may use this target to have the sources patched, and then manually run the configuration step to update the configuration file, with any new configuration options the patches may have introduced.</p>
  </dd>
  <dt>
    <p><strong>libc-kheaders</strong></p>
  </dt>
  <dd>
    <p>This is a special target for the libc-dev maintainer, who can use it to create the headers package that libc needs. Please note that it is dangerous to create a libc-kheaders package that is different from the headers libc was compiled with; it is <strong>known</strong> to subtly break systems. Please look at <em>/usr/share/kernel-package/README.headers</em> for details.  Creating and installing a self created libc-kheaders package may break your system unless you know what you are doing. You have been warned.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">
<p><strong>KPKG_DEBUG</strong>, if set, causes make-kpkg to spit out debugging messages about some shell functions executed internally. This is probably of not interest to anyone not debugging <strong>make-kpkg</strong>. The following variables (documented above) also affect <strong>make-kpkg</strong>: <strong>DEBIAN_REVISION_MANDATORY</strong>, <strong>APPEND_TO_VERSION</strong>, <strong>VERSION_H_OK</strong>, <strong>KPKG_ARCH</strong>, <strong>CROSS_COMPILE</strong>, <strong>KPKG_SUBARCH</strong>, <strong>KPKG_OVERLAY_DIR</strong>, <strong>ARCH_IN_NAME</strong>, <strong>INITRD</strong>, <strong>SOURCE_CLEAN_HOOK</strong>, <strong>MODULE_LOC</strong>, <strong>CONCURRENCY_LEVEL</strong> and <strong>IGNORE_UPPERCASE_VERSION</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>Apart from the runtime options, the <em>debian.rules</em> file run by <strong>make-kpkg</strong> also looks for a per user configuration file <em>~/.kernel-pkg.conf</em>. Failing that, it looks for site-wide defaults in the file <em>/etc/kernel-pkg.conf</em>. The default configuration allows there to be a site wide override for the full name and email address of the person responsible for maintaining the kernel packages on the site, but the <em>/etc/kernel-pkg.conf</em> (or <em>~/.kernel-pkg.conf</em>) file is actually a Makefile snippet, and any legal make directives may be included in there. <strong>Note</strong>: Caution is urged with this file, since you can totally change the way that the make is run by suitably editing this file. Please look at <em>/usr/share/doc/kernel-package/Problems.gz</em> for a list of known problems while compiling kernel images. Extensive tutorial like documentation is also available in <em>/usr/share/doc/kernel-package/README.gz</em> and it is recommended that one read that before using this utility.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO make-kpkg&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/dpkg-deb.1.html"><strong>dpkg-deb</strong>(1)</a>, <a href="../man1/dpkg-source.1.html"><strong>dpkg-source</strong>(1)</a>, <a href="../man1/make.1.html"><strong>make</strong>(1)</a>, <strong>Getopt::Long</strong>(3perl), <a href="../man5/kernel-img.conf.5.html"><strong>kernel-img.conf</strong>(5)</a>, <a href="../man5/kernel-pkg.conf.5.html"><strong>kernel-pkg.conf</strong>(5)</a>, <strong>The</strong>Programmers<strong>manual</strong>, <strong>The</strong>GNU<strong>Make</strong>manual<strong>,</strong> and the extensive documentation in the <em>/usr/share/doc/kernel-package</em> directory</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This manual page was written by Manoj Srivastava &lt;srivasta@debian.org&gt;, for the Debian GNU/Linux system.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="make-klone-project.1.html"><span aria-hidden="true">&larr;</span> make-klone-project.1: Manage a klone based custom debian package</a></li>
   <li class="next"><a href="make-memtest86-boot-floppy.1.html">make-memtest86-boot-floppy.1: Create a memtest86 boot-floppy using grub. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
