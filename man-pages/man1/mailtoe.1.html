<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mailtoe: A train-on-error simulator for use with dbacl.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A train-on-error simulator for use with dbacl.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mailtoe (1) manual">
  <meta name="twitter:description" content="A train-on-error simulator for use with dbacl.">
  <meta name="twitter:image" content="https://www.carta.tech/images/dbacl-mailtoe-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/mailtoe.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mailtoe (1) manual" />
  <meta property="og:description" content="A train-on-error simulator for use with dbacl." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dbacl-mailtoe-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mailtoe<small> (1)</small></h1>
        <p class="lead">A train-on-error simulator for use with dbacl.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mailtoe.1.html">
      <span itemprop="name">mailtoe: A train-on-error simulator for use with dbacl.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dbacl/">
      <span itemprop="name">dbacl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mailtoe.1.html">
      <span itemprop="name">mailtoe: A train-on-error simulator for use with dbacl.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mailtoe</strong> <em>command</em> [ <em>command_arguments</em> ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mailtoe</strong> automates the task of testing email filtering and classification programs such as <a href="../man1/dbacl.1.html"><strong>dbacl</strong>(1)</a>. Given a set of categorized documents, mailtoe initiates test runs to estimate the classification errors and thereby permit fine tuning of the parameters of the classifier.</p><p>Train-on-error (TOE) is a learning method which is sometimes advocated for email classifiers. Given an incoming email stream, the method consists in reusing a fixed set of category databases until the first misclassification occurs. At that point, the offending email is used to relearn the relevant category, until the next misclassification. In this way, categories are only updated when errors occur. This directly models the way that some email classifiers are used in practice.</p><p>TOE's error rates depend directly on the order in which emails are seen. A small change in ordering, as might happen due to networking delays, can have a large impact on the number of misclassifications. Consequently, <strong>mailtoe</strong> does not give meaningful results, unless the sample emails are chosen carefully. However, as this method is commonly used by spam filters, it is still worth computing to foster comparisons. Other methods  (see <a href="../man1/mailcross.1.html"><strong>mailcross</strong>(1)</a>,<a href="../man1/mailfoot.1.html"><strong>mailfoot</strong>(1)</a>) attempt to capture the behaviour of classification errors in other ways.</p><p>To improve and stabilize the error rate calculation, <strong>mailtoe</strong> performs the TOE simulations several times on slightly reordered email streams, and averages the results. The reorderings occur by multiplexing the emails from each category mailbox in random order. Thus if there are three categories, the first email classified is chosen randomly from the front of the sample email streams of each type. The second email is also chosen randomly among the three types, from the front of the  streams after the first email was removed. Simulation stops when all sample streams are exhausted.</p><p><strong>mailtoe</strong> uses the environment variable MAILTOE_FILTER when executing, which permits the simulation of arbitrary filters, provided these satisfy the compatibility conditions stated in the ENVIRONMENT section below.</p><p>For convenience, <strong>mailtoe</strong> implements a <strong>testsuite</strong> framework with predefined wrappers for several open source classifiers. This permits the direct comparison of <a href="../man1/dbacl.1.html"><strong>dbacl</strong>(1)</a> with competing classifiers on the same set of email samples. See the USAGE section below.</p><p>During preparation, <strong>mailtoe</strong> builds a subdirectory named mailtoe.d in the current working directory. All needed calculations are performed inside this subdirectory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p><strong>mailtoe</strong> returns 0 on success, 1 if a problem occurred.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>prepare</strong> <em>size</em>
  </dt>
  <dd>
    <p>Prepares a subdirectory named mailtoe.d in the current working directory, and populates it with empty subdirectories for exactly <em>size</em> subsets.</p>
  </dd>
  <dt>
    <strong>add</strong> <em>category</em> [ <em>FILE</em> ]...
  </dt>
  <dd>
    <p>Takes a set of emails from either <em>FILE</em> if specified, or STDIN, and associates them with <em>category</em>. The ordering of emails within <em>FILE</em> is preserved, and subsequent <em>FILE</em>s are appended to the first in each category. This command can be repeated several times, but should be executed at least once.</p>
  </dd>
  <dt>
    <strong>clean</strong>
  </dt>
  <dd>
    <p>Deletes the directory mailtoe.d and all its contents.</p>
  </dd>
  <dt>
    <strong>run</strong>
  </dt>
  <dd>
    <p>Multiplexes randomly from the email streams added earlier, and relearns categories only when a misclassification occurs. The simulation is repeated <em>size</em> times.</p>
  </dd>
  <dt>
    <strong>summarize</strong>
  </dt>
  <dd>
    <p>Prints average error rates for the simulations.</p>
  </dd>
  <dt>
    <strong>plot</strong> [ <em>ps</em> | <em>logscale</em> ]...
  </dt>
  <dd>
    <p>Plots the number of errors over simulation time. The "ps" option, if present, writes the plot to a postscript file in the directory mailtoe/plots, instead of being shown on-screen. The "logscale" option, if present, causes the plot to be on the log scale for both ordinates.</p>
  </dd>
  <dt>
    <strong>review</strong> <em>truecat</em> <em>predcat</em>
  </dt>
  <dd>
    <p>Scans the last run statistics and extracts all the messages which belong to category <em>truecat</em> but have been classified into category <em>predcat</em>. The extracted messages are copied to the directory <em>mailtoe.d/review</em> for perusal.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <strong>testsuite list</strong>
  </dt>
  <dd>
    <p>Shows a list of available filters/wrapper scripts which can be selected.</p>
  </dd>
  <dt>
    <strong>testsuite select</strong> [ <em>FILTER</em> ]...
  </dt>
  <dd>
    <p>Prepares the filter(s) named <em>FILTER</em> to be used for simulation. The filter name is the name of a wrapper script located in the directory <em>/usr/share/dbacl/testsuite</em>. Each filter has a rigid interface documented below, and the act of selecting it copies it to the <em>mailtoe.d/filters</em> directory. Only filters located there are used in the simulations.</p>
  </dd>
  <dt>
    <strong>testsuite deselect</strong> [ <em>FILTER</em> ]...
  </dt>
  <dd>
    <p>Removes the named filter(s) from the directory <em>mailtoe.d/filters</em> so that they are not used in the simulation.</p>
  </dd>
  <dt>
    <strong>testsuite run</strong> [ <em>plots</em> ]
  </dt>
  <dd>
    <p>Invokes every selected filter on the datasets added previously, and calculates misclassification rates. If the "plots" option is present, each filter simulation is plotted as a postscript file in the directory <em>mailtoe.d/plots</em>.</p>
  </dd>
  <dt>
    <strong>testsuite status</strong>
  </dt>
  <dd>
    <p>Describes the scheduled simulations.</p>
  </dd>
  <dt>
    <strong>testsuite summarize</strong>
  </dt>
  <dd>
    <p>Shows the cross validation results for all filters. Only makes sense after the <em>run</em> command.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USAGE</h2>
        <div class="sectioncontent">
<p>The normal usage pattern is the following: first, you should separate your email collection into several categories (manually or otherwise). Each category should be associated with one or more folders, but each folder should not contain more than one category. Next, you should decide how many runs to use, say 10. The more runs you use, the better the predicted error rates. However, more runs take more time. Now you can type % mailtoe prepare 10</p><p>Next, for every category, you must add every folder associated with this category. Suppose you have three categories named <em>spam</em>, <em>work</em>, and <em>play</em>, which are associated with the mbox files <em>spam.mbox</em>, <em>work.mbox</em>, and <em>play.mbox</em> respectively. You would type</p><p>% mailtoe add spam spam.mbox</p><p>% mailtoe add work work.mbox</p><p>% mailtoe add play play.mbox</p><p>You should aim for a similar number of emails in each category, as the random multiplexing will be unbalanced otherwise. The ordering of the email messages in each <em>*.mbox</em> file is important, and is preserved during each simulation. If you repeatedly add to the same category, the later mailboxes will be appended to the first, preserving the implied ordering.</p><p>You can now perform as many TOE simulations as desired. The multiplexed emails are classified and learned one at a time, by executing the command given in the environment variable MAILTOE_FILTER. If not set, a default value is used.</p><p>% mailtoe run</p><p>% mailtoe summarize</p><p>The testsuite commands are designed to simplify the above steps and allow comparison of a wide range of email classifiers, including but not limited to <strong>dbacl</strong>. Classifiers are supported through wrapper scripts, which are located in the <em>/usr/share/dbacl/testsuite</em> directory.</p><p>The first stage when using the testsuite is deciding which classifiers to compare. You can view a list of available wrappers by typing:</p><p>% mailtoe testsuite list</p><p>Note that the wrapper scripts are NOT the actual email classifiers, which must be installed separately by your system administrator or otherwise. Once this is done, you can select one or more wrappers for the simulation by typing, for example:</p><p>% mailtoe testsuite select dbaclA ifile</p><p>If some of the selected classifiers cannot be found on the system, they are not selected. Note also that some wrappers can have hard-coded category names, e.g. if the classifier only supports binary classification. Heed the warning messages.</p><p>It remains only to run the simulation. Beware, this can take a long time (several hours depending on the classifier).</p><p>% mailtoe testsuite run</p><p>% mailtoe testsuite summarize</p><p>Once you are all done, you can delete the working files, log files etc. by typing</p><p>% mailtoe clean</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCRIPT INTERFACE</h2>
        <div class="sectioncontent">
<p><strong>mailtoe testsuite</strong> takes care of learning and classifying your prepared email corpora for each selected classifier. Since classifiers have widely varying interfaces, this is only possible by wrapping those interfaces individually into a standard form which can be used by <strong>mailtoe testsuite</strong>.</p><p>Each wrapper script is a command line tool which accepts a single command followed by zero or more optional arguments, in the standard form:</p><p>wrapper command [argument]...</p><p>Each wrapper script also makes use of STDIN and STDOUT in a well defined way. If no behaviour is described, then no output or input should be used. The possible commands are described below:</p>
<dl class='dl-vertical'>
  <dt>
    filter
  </dt>
  <dd>
    <p>In this case, a single email is expected on STDIN, and a list of category filenames is expected in $2, $3, etc. The script writes the category name corresponding to the input email on STDOUT. No trailing newline is required or expected.</p>
  </dd>
  <dt>
    learn
  </dt>
  <dd>
    <p>In this case, a standard mbox stream is expected on STDIN, while a suitable category file name is expected in $2. No output is written to STDOUT.</p>
  </dd>
  <dt>
    clean
  </dt>
  <dd>
    <p>In this case, a directory is expected in $2, which is examined for old database information. If any old databases are found, they are purged or reset. No output is written to STDOUT.</p>
  </dd>
  <dt>
    describe
  </dt>
  <dd>
    <p>IN this case, a single line of text is written to STDOUT, describing the filter's functionality. The line should be kept short to prevent line wrapping on a terminal.</p>
  </dd>
  <dt>
    bootstrap
  </dt>
  <dd>
    <p>In this case, a directory is expected in $2. The wrapper script first checks for the existence of its associated classifier, and other prerequisites. If the check is successful, then the wrapper is cloned into the supplied directory. A courtesy notification should be given on STDOUT to express success or failure. It is also permissible to give longer descriptions caveats.</p>
  </dd>
  <dt>
    toe
  </dt>
  <dd>
    <p>In this case, a list of categories is expected in $3, $4, etc. Every possible category must be listed. Preceding this list, the true category is given in $2.</p>
  </dd>
  <dt>
    foot
  </dt>
  <dd>
    <p>Used by <a href="../man1/mailfoot.1.html"><strong>mailfoot</strong>(1)</a>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Right after loading, <strong>mailtoe</strong> reads the hidden file .mailtoerc in the $HOME directory, if it exists, so this would be a good place to define custom values for environment variables.</p>
<dl class='dl-vertical'>
  <dt>
    MAILTOE_FILTER
  </dt>
  <dd>
    <p>This variable contains a shell command to be executed repeatedly during the running stage. The command should accept an email message on STDIN and output a resulting category name. On the command line, it should also accept first the true category name, then a list of all possible category file names.  If the output category does not match the true category, then the relevant categories are assumed to have been silently updated/relearned. If MAILTOE_FILTER is undefined, <strong>mailtoe</strong> uses a default value.</p>
  </dd>
  <dt>
    TEMPDIR
  </dt>
  <dd>
    <p>This directory is exported for the benefit of wrapper scripts. Scripts which need to create temporary files should place them a the location given in TEMPDIR.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>The subdirectory mailtoe.d can grow quite large. It contains a full copy of the training corpora, as well as learning files for <em>size</em> times all the added categories, and various log files.</p><p>While TOE simulations for <a href="../man1/dbacl.1.html"><strong>dbacl</strong>(1)</a> can be used to compare with other classifiers, TOE should not be used for real world classifications. This is because, unlike many other filters, <a href="../man1/dbacl.1.html"><strong>dbacl</strong>(1)</a> learns evidence weights in a nonlinear way, and does not preserve relative weights between tokens, even if those tokens aren't seen in new emails.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WARNING</h2>
        <div class="sectioncontent">
<p>Because the ordering of emails within the added mailboxes matters, the estimated error rates are not well defined or even meaningful in an objective sense. However, if the sample emails represent an actual snapshot of a user's incoming email, then the error rates are somewhat meaningful. The simulations can then be interpreted as alternate realities where a given classifier would have intercepted the incoming mail.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SOURCE</h2>
        <div class="sectioncontent">
<p>The source code for the latest version of this program is available at the following locations:</p><p>http://www.lbreyer.com/gpl.html</p><p>http://dbacl.sourceforge.net</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Laird A. Breyer &lt;laird@lbreyer.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mailtoe&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/bayesol.1.html"><strong>bayesol</strong>(1)</a> <a href="../man1/dbacl.1.html"><strong>dbacl</strong>(1)</a>, <a href="../man1/mailinspect.1.html"><strong>mailinspect</strong>(1)</a>, <a href="../man1/mailcross.1.html"><strong>mailcross</strong>(1)</a>, <a href="../man1/mailfoot.1.html"><strong>mailfoot</strong>(1)</a>, <a href="../man7/regex.7.html"><strong>regex</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mailtextbody.1.html"><span aria-hidden="true">&larr;</span> mailtextbody.1: Returns the body of an email message</a></li>
   <li class="next"><a href="mailtool.1.html">mailtool.1: Process mailboxes <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
