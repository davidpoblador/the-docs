<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>perf_3.16-probe: Define new dynamic tracepoints</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Define new dynamic tracepoints">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="perf_3.16-probe (1) manual">
  <meta name="twitter:description" content="Define new dynamic tracepoints">
  <meta name="twitter:image" content="https://www.carta.tech/images/linux-tools-3.16-perf_3.16-probe-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/perf_3.16-probe.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="perf_3.16-probe (1) manual" />
  <meta property="og:description" content="Define new dynamic tracepoints" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/linux-tools-3.16-perf_3.16-probe-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">perf_3.16-probe<small> (1)</small></h1>
        <p class="lead">Define new dynamic tracepoints</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/perf_3.16-probe.1.html">
      <span itemprop="name">perf_3.16-probe: Define new dynamic tracepoints</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/linux-tools-3.16/">
      <span itemprop="name">linux-tools-3.16</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/perf_3.16-probe.1.html">
      <span itemprop="name">perf_3.16-probe: Define new dynamic tracepoints</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
<em>perf probe</em> [options] --add=<em>PROBE</em> [...]
or
<em>perf probe</em> [options] PROBE
or
<em>perf probe</em> [options] --del=<em>[GROUP:]EVENT</em> [...]
or
<em>perf probe</em> --list
or
<em>perf probe</em> [options] --line=<em>LINE</em>
or
<em>perf probe</em> [options] --vars=<em>PROBEPOINT</em>
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This command defines dynamic tracepoint events, by symbol and registers without debuginfo, or by C expressions (C line numbers, C function names, and C local variables) with debuginfo.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>-k, --vmlinux=PATH</p><p>Specify vmlinux path which has debuginfo (Dwarf binary).</p><p>-m, --module=MODNAME|PATH</p><p>Specify module name in which perf-probe searches probe points or lines. If a path of module file is passed, perf-probe treat it as an offline module (this means you can add a probe on a module which has not been loaded yet).</p><p>-s, --source=PATH</p><p>Specify path to kernel source.</p><p>-v, --verbose</p><p>Be more verbose (show parsed arguments, etc).</p><p>-a, --add=</p><p>Define a probe event (see PROBE SYNTAX for detail).</p><p>-d, --del=</p><p>Delete probe events. This accepts glob wildcards(<em>*</em>, <em>?</em>) and character classes(e.g. [a-z], [!A-Z]).</p><p>-l, --list</p><p>List up current probe events.</p><p>-L, --line=</p><p>Show source code lines which can be probed. This needs an argument which specifies a range of the source code. (see LINE SYNTAX for detail)</p><p>-V, --vars=</p><p>Show available local variables at given probe point. The argument syntax is same as PROBE SYNTAX, but NO ARGs.</p><p>--externs</p><p>(Only for --vars) Show external defined variables in addition to local variables.</p><p>-F, --funcs</p><p>Show available functions in given module or kernel. With -x/--exec, can also list functions in a user space executable / shared library.</p><p>--filter=FILTER</p><p>(Only for --vars and --funcs) Set filter. FILTER is a combination of glob pattern, see FILTER PATTERN for detail. Default FILTER is "!<em>k???tab_* & !</em>crc_*" for --vars, and "!_*" for --funcs. If several filters are specified, only the last filter is used.</p><p>-f, --force</p><p>Forcibly add events with existing name.</p><p>-n, --dry-run</p><p>Dry run. With this option, --add and --del doesn\(cqt execute actual adding and removal operations.</p><p>--max-probes</p><p>Set the maximum number of probe points for an event. Default is 128.</p><p>-x, --exec=PATH</p><p>Specify path to the executable or shared library file for user space tracing. Can also be used with --funcs option.</p><p>In absence of -m/-x options, perf probe checks if the first argument after the options is an absolute path name. If its an absolute path, perf probe uses it as a target module/target user space binary to probe.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROBE SYNTAX</h2>
        <div class="sectioncontent">
<p>Probe points are defined by following syntax.</p>
<pre>
1) Define event based on function name
 [EVENT=]FUNC[@SRC][:RLN|+OFFS|%return|;PTN] [ARG ...]
</pre>

<pre>
2) Define event based on source file with line number
 [EVENT=]SRC:ALN [ARG ...]
</pre>

<pre>
3) Define event based on source file with lazy pattern
 [EVENT=]SRC;PTN [ARG ...]
</pre>
<p><em>EVENT</em> specifies the name of new event, if omitted, it will be set the name of the probed function. Currently, event group name is set as <em>probe</em>. <em>FUNC</em> specifies a probed function name, and it may have one of the following options; <em>+OFFS</em> is the offset from function entry address in bytes, <em>:RLN</em> is the relative-line number from function entry line, and <em>%return</em> means that it probes function return. And <em>;PTN</em> means lazy matching pattern (see LAZY MATCHING). Note that <em>;PTN</em> must be the end of the probe point definition. In addition, <em>@SRC</em> specifies a source file which has that function. It is also possible to specify a probe point by the source line number or lazy matching by using <em>SRC:ALN</em> or <em>SRC;PTN</em> syntax, where <em>SRC</em> is the source file path, <em>:ALN</em> is the line number and <em>;PTN</em> is the lazy matching pattern. <em>ARG</em> specifies the arguments of this probe point, (see PROBE ARGUMENT).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROBE ARGUMENT</h2>
        <div class="sectioncontent">
<p>Each probe argument follows below syntax.</p>
<pre>
[NAME=]LOCALVAR|$retval|%REG|@SYMBOL[:TYPE]
</pre>
<p><em>NAME</em> specifies the name of this argument (optional). You can use the name of local variable, local data structure member (e.g. var\(-&gt;field, var.field2), local array with fixed index (e.g. array[1], var\(-&gt;array[0], var\(-&gt;pointer[2]), or kprobe-tracer argument format (e.g. $retval, %ax, etc). Note that the name of this argument will be set as the last member name if you specify a local data structure member (e.g. field2 for <em>var\(-&gt;field1.field2</em>.) <em>TYPE</em> casts the type of this argument (optional). If omitted, perf probe automatically set the type based on debuginfo. You can specify <em>string</em> type only for the local variable or structure member which is an array of or a pointer to <em>char</em> or <em>unsigned char</em> type.</p><p>On x86 systems %REG is always the short form of the register: for example %AX. %RAX or %EAX is not valid.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LINE SYNTAX</h2>
        <div class="sectioncontent">
<p>Line range is described by following syntax.</p>
<pre>
"FUNC[@SRC][:RLN[+NUM|-RLN2]]|SRC[:ALN[+NUM|-ALN2]]"
</pre>
<p>FUNC specifies the function name of showing lines. <em>RLN</em> is the start line number from function entry line, and <em>RLN2</em> is the end line number. As same as probe syntax, <em>SRC</em> means the source file path, <em>ALN</em> is start line number, and <em>ALN2</em> is end line number in the file. It is also possible to specify how many lines to show by using <em>NUM</em>. Moreover, <em>FUNC@SRC</em> combination is good for searching a specific function when several functions share same name. So, "source.c:100-120" shows lines between 100th to l20th in source.c file. And "func:10+20" shows 20 lines from 10th line of func function.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LAZY MATCHING</h2>
        <div class="sectioncontent">

<pre>
The lazy line matching is similar to glob matching but ignoring spaces in both of pattern and target. So this accepts wildcards(&apos;*&apos;, &apos;?&apos;) and character classes(e.g. [a-z], [!A-Z]).
</pre>
<p>e.g. <em>a=*</em> can matches <em>a=b</em>, <em>a = b</em>, <em>a == b</em> and so on.</p><p>This provides some sort of flexibility and robustness to probe point definitions against minor code changes. For example, actual 10th line of schedule() can be moved easily by modifying schedule(), but the same line matching <em>rq=cpu_rq*</em> may still exist in the function.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILTER PATTERN</h2>
        <div class="sectioncontent">

<pre>
The filter pattern is a glob matching pattern(s) to filter variables.
In addition, you can use "!" for specifying filter-out rule. You also can give several rules combined with "&" or "|", and fold those rules as one rule by using "(" ")".
</pre>
<p>e.g. With --filter "foo* | bar*", perf probe -V shows variables which start with "foo" or "bar". With --filter "!foo* & *bar", perf probe -V shows variables which don\(cqt start with "foo" and end with "bar", like "fizzbar". But "foobar" is filtered out.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Display which lines in schedule() can be probed:</p>
<pre>
./perf probe --line schedule
</pre>
<p>Add a probe on schedule() function 12th line with recording cpu local variable:</p>
<pre>
./perf probe schedule:12 cpu
or
./perf probe --add=&apos;schedule:12 cpu&apos;
</pre>

<pre>
this will add one or more probes which has the name start with "schedule".
</pre>

<pre>
Add probes on lines in schedule() function which calls update_rq_clock().
</pre>

<pre>
./perf probe &apos;schedule;update_rq_clock*&apos;
or
./perf probe --add=&apos;schedule;update_rq_clock*&apos;
</pre>
<p>Delete all probes on schedule().</p>
<pre>
./perf probe --del=&apos;schedule*&apos;
</pre>
<p>Add probes at zfree() function on /bin/zsh</p>
<pre>
./perf probe -x /bin/zsh zfree or ./perf probe /bin/zsh zfree
</pre>
<p>Add probes at malloc() function on libc</p>
<pre>
./perf probe -x /lib/libc.so.6 malloc or ./perf probe /lib/libc.so.6 malloc
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO perf_3.16-probe&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/perf_3.16-trace.1.html"><strong>perf_3.16-trace</strong>(1)</a>, <a href="../man1/perf_3.16-record.1.html"><strong>perf_3.16-record</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="perf_3.16-mem.1.html"><span aria-hidden="true">&larr;</span> perf_3.16-mem.1: Profile memory accesses</a></li>
   <li class="next"><a href="perf_3.16-record.1.html">perf_3.16-record.1: Run a command and record its profile into perf.data <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
