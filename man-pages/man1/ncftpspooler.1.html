<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ncftpspooler: Global batch ftp job processor daemon</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Global batch ftp job processor daemon">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="ncftpspooler (1) manual">
  <meta name="twitter:description" content="Global batch ftp job processor daemon">
  <meta name="twitter:image" content="https://www.carta.tech/images/ncftp-ncftpspooler-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/ncftpspooler.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ncftpspooler (1) manual" />
  <meta property="og:description" content="Global batch ftp job processor daemon" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ncftp-ncftpspooler-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">ncftpspooler<small> (1)</small></h1>
        <p class="lead">Global batch ftp job processor daemon</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/ncftpspooler.1.html">
      <span itemprop="name">ncftpspooler: Global batch ftp job processor daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ncftp/">
      <span itemprop="name">ncftp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/ncftpspooler.1.html">
      <span itemprop="name">ncftpspooler: Global batch ftp job processor daemon</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>ncftpspooler</strong> -d [<em>options</em>]</p><p><strong>ncftpspooler</strong> -l [<em>options</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3></h3>
<p>Command line flags:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Begin background processing of FTP jobs in the designated FTP job queue directory.</p>
  </dd>
  <dt>
    <p><strong>-q</strong><em> XX</em></p>
  </dt>
  <dd>
    <p>Use this option to specify a directory to use as the FTP job queue instead of the default directory, /var/spool/ncftp.</p>
  </dd>
  <dt>
    <p><strong>-o</strong><em> XX</em></p>
  </dt>
  <dd>
    <p>Use this option to specify a filename to use as the log file. By default, (and rather inappropriately) the program simply uses a file called <em>log</em> in the job queue directory. If you don't want a log, use this option to specify /dev/null.</p>
  </dd>
  <dt>
    <p><strong>-l</strong></p>
  </dt>
  <dd>
    <p>Lists the contents of the job queue directory.</p>
  </dd>
  <dt>
    <p><strong>-s</strong><em> XX</em></p>
  </dt>
  <dd>
    <p>When the job queue is empty, the program sleeps 120 seconds and then checks again to see if a new job has been submitted. Use this option to change the number of seconds used for this delay.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <em>ncftpspooler</em> program evolved from the <em>ncftpbatch</em> program. The <em>ncftpbatch</em> program was originally designed as a ``personal FTP spooler'' which would process a single background job a particular user and exit when it finished; the <em>ncftpspooler</em> program is a ``global FTP spooler'' which stays running and processes background jobs as they are submitted.</p><p>The job queue directory is monitored for specially-named and formatted text files. Each file serves as a single FTP job. The name of the job file contains the type of FTP job (<em>get</em> or <em>put</em>), a timestamp indicating the earliest the job should be processed, and optionally some additional information to make it easier to create unique job files (i.e. a sequence number). The contents of the job files have information such as the remote server machine to FTP to, username, password, remote pathname, etc.</p><p>Your job queue directory must be readable and writable by the user that you plan to run <em>ncftpspooler</em> as, so that jobs can be removed or renamed within the queue.</p><p>More importantly, the user that is running the program will need adequate privileges to access the local files that are involved in the FTPing. I.e., if your spooler is going to be processing jobs which upload files to remote servers, then the user will need read permission on the local files that will be uploaded (and directory access permission the parent directories). Likewise, if your spooler is going to be processing jobs which download files, then the user would need to be able to write to the local directories.</p><p>Once you have created your spool directory with appropriate permissions and ownerships, you can run <em>ncftpspooler&nbsp;-d</em> to launch the spooler daemon. You can run additional spoolers if you want to process more than FTP job from the same job queue directory simultaneously. You can then monitor the log file (i.e., using <em>tail&nbsp;-f</em> ) to track the progress of the spooler. Most of the time it won't be doing anything, unless job files have appeared in the job queue directory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">JOB FILE NAMES</h2>
        <div class="sectioncontent">
<p>When the <em>ncftpspooler</em> program monitors the job queue directory, it ignores any files that do not follow the naming convention for job files. The job files must be prefixed in the format of <em>X-YYYYMMDD-hhmmss</em> where <em>X</em> denotes a job type, <em>YYYY</em> is the four-digit year, <em>MM</em> is the two-digit month number, <em>DD</em> is the two-digit day of the month, <em>hh</em> is the two-digit hour of the day (00-23), <em>mm</em> is the two-digit minute, and <em>ss</em> is the two-digit second. The date and time represent the earliest time you want the job to be run.</p><p>The job type can be <em>g</em> for a get (download from remote host), or <em>p</em> for  aput (upload to remote host).</p><p>As an example, if you wanted to schedule an upload to occur at 11:45 PM on December 7, 2001, a job file could be named</p><p>p-20011207-234500</p><p>In practice, the job files include additional information such as a sequence number or process ID. This makes it easier to create unique job file names. Here is the same example, with a process ID and a sequence number:</p><p>p-20011207-234500-1234-2</p><p>When submitting job files to the queue directory, be sure to use a dash character after the <em>hhmmss</em> field if you choose to append any additional data to the job file name.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">JOB FILE CONTENTS</h2>
        <div class="sectioncontent">
<p>Job files are ordinary text files, so that they can be created by hand. Each line of the file is a key-pair in the format <em>variable</em>=<em>value</em>, or is a comment line beginning with an octothorpe character (<em>#</em>), or is a blank line. Here is an example job file:</p><p># This is a NcFTP spool file entry.</p><p>job-name=g-20011016-100656-008299-1</p><p>op=get</p><p>hostname=ftp.freebsd.org</p><p>xtype=I</p><p>passive=1</p><p>remote-dir=pub/FreeBSD</p><p>local-dir=/tmp</p><p>remote-file=README.TXT</p><p>local-file=readme.txt</p><p>Job files are flexible since they follow an easy-to-use format and do not have many requirements, but there are a few mandatory parameters that must appear for the spooler to be able to process the job.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>op</em></p>
  </dt>
  <dd>
    <p>The operation (job type) to perform. Valid values are <em>get</em> and <em>put</em>.</p>
  </dd>
  <dt>
    <p><em>hostname</em></p>
  </dt>
  <dd>
    <p>The remote host to FTP to. This may be an IP address or a DNS name (i.e. ftp.example.com).</p>
  </dd>

</dl>
<p>For a regular <em>get</em> job, these parameters are required:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>remote-file</em></p>
  </dt>
  <dd>
    <p>The pathname of the file to download from the remote server.</p>
  </dd>
  <dt>
    <p><em>local-file</em></p>
  </dt>
  <dd>
    <p>The pathname to use on the local server for the downloaded file.</p>
  </dd>

</dl>
<p>For a regular <em>put</em> job, these parameters are required:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>local-file</em></p>
  </dt>
  <dd>
    <p>The pathname of the file to upload to the remote server.</p>
  </dd>
  <dt>
    <p><em>remote-file</em></p>
  </dt>
  <dd>
    <p>The pathname to use on the remote server for the uploaded file.</p>
  </dd>

</dl>
<p>For a recursive <em>get</em> job, these parameters are required:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>remote-file</em></p>
  </dt>
  <dd>
    <p>The pathname of the file or directory to download from the remote server.</p>
  </dd>
  <dt>
    <p><em>local-dir</em></p>
  </dt>
  <dd>
    <p>The directory pathname to use on the local server to contain the downloaded items.</p>
  </dd>

</dl>
<p>For a recursive <em>put</em> job, these parameters are required:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>local-file</em></p>
  </dt>
  <dd>
    <p>The pathname of the file or directory to upload to the remote server.</p>
  </dd>
  <dt>
    <p><em>remote-dir</em></p>
  </dt>
  <dd>
    <p>The directory pathname to use on the remote server to contain the uploaded items.</p>
  </dd>

</dl>
<p>The rest of the parameters are optional. The spooler will attempt to use reasonable defaults for these parameters if necessary.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>user</em></p>
  </dt>
  <dd>
    <p>The username to use to login to the remote server. Defaults to ``anonymous'' for guest access.</p>
  </dd>
  <dt>
    <p><em>pass</em></p>
  </dt>
  <dd>
    <p>The password to use in conjunction with the username to login to the remote server.</p>
  </dd>
  <dt>
    <p><em>acct</em></p>
  </dt>
  <dd>
    <p>The account to use in conjunction with the username to login to the remote server. The need to specify this parameter is extremely rare.</p>
  </dd>
  <dt>
    <p><em>port</em></p>
  </dt>
  <dd>
    <p>The port number to use in conjunction with the remote hostname to connect to the remote server. Defaults to the standard FTP port number, 21.</p>
  </dd>
  <dt>
    <p><em>host-ip</em></p>
  </dt>
  <dd>
    <p>The IP address to use in conjunction with the remote hostname to connect to the remote server. This parameter can be used in place of the <em>hostname</em> parameter, but one or the other must be used. This parameter is commonly included along with the <em>hostname</em> parameter as supplemental information.</p>
  </dd>
  <dt>
    <p><em>xtype</em></p>
  </dt>
  <dd>
    <p>The transfer type to use. Defaults to binary transfer type (TYPE&nbsp;I). Valid values are <em>I</em> for binary, <em>A</em> for ASCII text.</p>
  </dd>
  <dt>
    <p><em>passive</em></p>
  </dt>
  <dd>
    <p>Whether to use FTP passive data connections (PASV) or FTP active data connections (PORT). Valid values are <em>0</em> for active, <em>1</em> for passive, or <em>2</em> to try passive, then fallback to active. The default is <em>2</em>.</p>
  </dd>
  <dt>
    <p><em>recursive</em></p>
  </dt>
  <dd>
    <p>This can be used to transfer entire directory trees. By default, only a single file is transferred. Valid values are <em>yes</em> or <em>no</em>.</p>
  </dd>
  <dt>
    <p><em>delete</em></p>
  </dt>
  <dd>
    <p>This can be used to delete the source file on the source machine after successfully transferring the file to the destination machine. By default, source files are not deleted. Valid values are <em>yes</em> or <em>no</em>.</p>
  </dd>
  <dt>
    <p><em>job-name</em></p>
  </dt>
  <dd>
    <p>This isn't used by the program, but can be used by an entity which is automatically generating job files. As an example, when using the <em>-bbb</em> flag with <em>ncftpput</em>, it creates a job file on stdout with a <em>job-name</em> parameter so you can easily copy the file to the job queue directory with the suggested job name as the job file name.</p>
  </dd>
  <dt>
    <p><em>pre-ftp-command</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><em>post-ftp-command</em></p>
  </dt>
  <dd>
    <p>These parameters correspond to the <em>-W</em>, and <em>-Y</em> options of <em>ncftpget</em> and <em>ncftpput</em>. It is important to note that these refer to RFC959 File Transfer Protocol commands and <strong>not</strong> shell commands, nor commands used from within /usr/bin/ftp or ncftp.</p>
  </dd>
  <dt>
    <p><em>pre-shell-command</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><em>post-shell-command</em></p>
  </dt>
  <dd>
    <p>These parameters provide hooks so you can run a custom program when an item is processed by the spooler. Valid values are pathnames to scripts or executable programs. Note that the value must not contain any command-line arguments -- if you want to do that, create a shell script and have it run your program with the command-line arguments it requires.</p>
  </dd>

</dl>
<p>Generally speaking, <em>post-shell-command</em> is much more useful than <em>pre-shell-command</em> since if you need to use these options you're more likely to want to do something after the FTP transfer has completed rather than before. For example, you might want to run a shell script which pages an administrator to notify her that her 37 gigabyte file download has completed.</p><p>When your custom program is run, it receives on standard input the contents of the job file (i.e. several lines of <em>variable</em>=<em>value</em> key-pairs), as well as additional data the spooler may provide, such as a <em>result</em> key-pair with a textual description of the job's completion status.</p><p><em>post-shell-command</em> update a log file named /var/log/ncftp_spooler.</p><p>#!/usr/bin/perl -w</p><p>my ($line);</p><p>my (%params) = ();</p><p>while (defined($line = &lt;STDIN&gt;)) {</p><p>	$params{$1}&nbsp;=&nbsp;$2</p><p>		if&nbsp;($line&nbsp;=~&nbsp;/^([^=&#92;#&#92;s]+)=(.*)/);</p><p>}</p><p>if ((defined($params{"result"})) &&</p>
<pre>
  ($params{"result"} =~ /^Succeeded/))
</pre>
<p>{</p><p>	open(LOG, "&gt;&gt; /var/log/ncftp_spooler.log")</p><p>		or <strong>exit</strong>(1);</p><p>	print LOG "DOWNLOAD" if ($params{"op"} eq "get");</p><p>	print LOG "UPLOAD" if ($params{"op"} eq "put");</p><p>	print LOG " ", $params{"local-file"}, "&#92;n";</p><p>	close(LOG);</p><p>}</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>The log file should be examined to determine if any <em>ncftpspooler</em> processes are actively working on jobs. The log contains copious amounts of useful information, including the entire FTP control connection conversation between the FTP client and server.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The <em>recursive</em> option may not be reliable since <em>ncftpspooler</em> depends on functionality which may or may not be present in the remote server software. Additionally, even if the functionality is available, <em>ncftpspooler</em> may need to use heuristics which cannot be considered 100% accurate. Therefore it is best to create individual jobs for each file in the directory tree, rather than a single recursive directory job.</p><p>For resumption of downloads to work, the remote server must support the FTP <em>SIZE</em> and <em>MDTM</em> primitives. Most modern FTP server software can do this, but there are still a number of bare-bones <em>ftpd</em> implementations which do not. In these cases, <em>ncftpspooler</em> will re-download the file in entirety each time until the download succeeds.</p><p>The program needs to be improved to detect jobs that have no chance of ever completing successfully. There are still a number of cases where jobs can get spooled but get retried over and over again until a vigilant sysadmin manually removes the jobs.</p><p>The spool files may contain usernames and passwords stored in cleartext. These files should not be readable by any user except the user running the program!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Mike Gleason, NcFTP Software (http://www.ncftp.com).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO ncftpspooler&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/ncftpbatch.1.html"><strong>ncftpbatch</strong>(1)</a>,</em> <strong>ncftp</strong>(1), <a href="../man1/ncftpput.1.html"><strong>ncftpput</strong>(1)</a>, <a href="../man1/ncftpget.1.html"><strong>ncftpget</strong>(1)</a>, <strong>uucp</strong>(1).</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="ncftpput.1.html"><span aria-hidden="true">&larr;</span> ncftpput.1: Internet file transfer program for scripts</a></li>
   <li class="next"><a href="ncg.1.html">ncg.1: Extract constants from tinyos files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
