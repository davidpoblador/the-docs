<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jmake: A generic makefile builder</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A generic makefile builder">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="jmake (1) manual">
  <meta name="twitter:description" content="A generic makefile builder">
  <meta name="twitter:image" content="https://www.carta.tech/images/dist-jmake-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/jmake.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="jmake (1) manual" />
  <meta property="og:description" content="A generic makefile builder" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dist-jmake-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">jmake<small> (1)</small></h1>
        <p class="lead">A generic makefile builder</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/jmake.1.html">
      <span itemprop="name">jmake: A generic makefile builder</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dist/">
      <span itemprop="name">dist</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/jmake.1.html">
      <span itemprop="name">jmake: A generic makefile builder</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>jmake</strong> [ <em>cpp options</em> ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Jmake</em> builds a makefile out of a rather high level description held in a <em>Jmakefile</em> file. The generated file is a <em>Makefile.SH</em> rather than a simple makefile, which means it is ready to be used in conjonction with <em>metaconfig.</em> In particular, parameters such as "where to install executables" will be automatically determined by <em>Configure</em> and only the needed parameters will be taken into account.</p><p>To use <em>jmake</em> you have to write a <em>Jmakefile</em> first, which describes the way things are to be built. Your <em>Jmakefile</em> will be included inside a generic template through the C pre-processor. This means you may use the usual C /**/ comments, but not the shell # comments. The C comments will not appear in the generated <em>Makefile.SH</em> but lines starting with ;# will finally appear as shell comments. If you have to write the string /* in the generated <em>Makefile.SH</em> then you have to escape it (otherwise <em>jmake</em> will think of it as the start of a C comment). Simply put a # in front of the *, as in /#*.</p><p>You have a set of macros at your disposal, and all these macros are listed in the Index file, along with the piece of code they will expand to. Usually, a <em>Jmakefile</em> is fairly small and thus easier to maintain than a huge <em>Makefile.</em> Some internal powerful commands allow you to write portable makefiles easily, without having to spend many efforts, because someone else already did the job for you :-).</p><p>When you want to generate your makefile, you usually do not run <em>jmake</em> but use the <em>jmkmf</em> script which is a wrapper and will invoke <em>jmake</em> with the correct options.</p><p>All the knowledge of <em>jmake</em> is held in two files: the template <em>Jmake.tmpl</em> and the macro definition file <em>Jmake.rules.</em> The first file includes the second, along with the <em>Jmakefile.</em> It is sometimes necessary to know how things works to be able to correctly use all the features provided. For instance, you may have to write your own rules for a specific project. Although you cannot overwrite the predefined rules, you can extent the <em>Jmake.rules</em> file or simply add your macros in your <em>Jmakefile.</em> You may also use <em>#include</em> statements when you want to share these macros and do not want to duplicate the code.</p><p>The syntax in Jmake.rules is not elegant at all, but:</p>
<dl class='dl-vertical'>
  <dt>
    -
  </dt>
  <dd>
    <p>It is easy to parse (like sendmail.cf or troff files).</p>
  </dd>
  <dt>
    -
  </dt>
  <dd>
    <p>The rules are not supposed to change very often.</p>
  </dd>
  <dt>
    -
  </dt>
  <dd>
    <p>It is simple enough to be mastered in five minutes. :-)</p><p>Here is a small description:</p>
  </dd>
  <dt>
    1)
  </dt>
  <dd>
    <p>To deal with various <em>cpp</em> implementations:</p><ul>
<li><p>Final @!nbsp;means: end of line, next line starts at the left margin.</p></li><li><p>Final @@nbsp;means: end of line, next line is to be indented by one tab.</p></li>
</ul><p>There should always be one of @!nbsp;or @@nbsp;at the end of each line. The only exception is for macros that are to be used as part of a rule body (e.g. <em>RemoveTargetProgram</em>). In that case, the first line (which holds the <em>#define</em>) should end with a single backslash.</p>
  </dd>
  <dt>
    2)
  </dt>
  <dd>
    <p>Symbol definitions:</p><ul>
<li><p>&gt;SYMBOL: defines the symbol.</p></li><li><p>?SYMBOL:&lt;text&gt;: keeps &lt;text&gt; iff SYMBOL is defined.</p></li><li><p>%SYMBOL:&lt;text&gt;: keeps &lt;text&gt; iff SYMBOL is not defined.</p></li>
</ul><p>The ?SYM can be nested (logical AND), as in:</p><p>?SYMBOL:%TOKEN:text</p><p>which will keep text if SYMBOL is defined and TOKEN undefined. To implement a logical OR, see below.</p>
  </dd>
  <dt>
    3)
  </dt>
  <dd>
    <p>Makefile target tests:</p><ul>
<li><p>?<em>target</em>?:&lt;text&gt;: keeps &lt;test&gt; iff <em>target</em> is defined.</p></li><li><p>%<em>target</em>%:&lt;text&gt;: keeps &lt;test&gt; iff <em>target</em> is not defined.</p><p>A makefile <em>target</em> is defined as a standalone target, for instance the <strong>depend.local</strong> target, which would be defined as:</p>
<pre>
depend.local:

</pre>
<p>Also note that it is only valid for targets defined <em>so far</em> in the generated makefile.  It is not a predicate that can be used to test for targets that will eventually be defined later on in the generation.</p></li>
</ul>
  </dd>
  <dt>
    4)
  </dt>
  <dd>
    <p>Commands:</p><p>Commands can be passed to <em>jmake</em>. They start with a leading '|'. Available commands are:</p><ul>
<li><p>|suffix &lt;sx&gt;: adds &lt;sx&gt; to the .SUFFIXES: list in the makefile.</p></li><li><p>|rule:&lt;text&gt;: adds &lt;text&gt; to the building rule section.</p></li><li><p>|rule: &lt;text&gt;: same as before, with a leading tab.</p></li><li><p>|skip: skips text until a line starting with '-skip' is found.</p></li><li><p>|subst: begins section where lines will be subject to variable substitution, until '-subst' is found.  This means that when the Makefile.SH is run, all instances of $var within the <em>subst</em> section will be substituted by the shell.</p></li><li><p>|shell: emits section until matching '-shell' as-is in the generated Makefile.SH.  This can be useful to prepare <em>|case</em> sections.  It is not allowed to nest <em>shell</em> sections.</p></li><li><p>|case: this command must be followed by a shell variable name (without its leading '$' sign) and a case-style pattern, for instance the string "var in f*".  It will generate the corresponding "case" test in the Makefile.SH on the "$var" value and only if this test is true will the section until the matching '-case' be generated in the Makefile when Makefile.SH is run.  It is possible to nest <em>case</em> sections freely.</p></li><li><p>|expand &lt;pattern&gt;: expand lines until '-expand' with &lt;pattern&gt;. A complete example is shown below.</p></li><li><p>|once &lt;symbol&gt;: text up to '-once' appears only the first time.</p></li>
</ul><p>The '|' commands cannot be nested, unless otherwise noted. In particular, due to the simple implementation of <em>|skip</em>, it is impossible to put <em>|skip</em> inside a skipped part. However, a <em>|once</em> section may have <em>|skip</em> sections. It is allowed to nest <em>|case</em> sections at will.</p><p>Here is a way to implement a logical OR:</p>
<pre>
/* Implements SYMBOL or not TOKEN */
?SYMBOL:text		/* Keeps text if SYMBOL */
%SYMBOL:|skip
	%TOKEN:text		/* Keeps text if not TOKEN */
-skip
</pre>
<p>Actually, this is ugly, because the text has to appear twice. Fortunately, I did not use that construct. :-)</p><p>Indeed, as you have surely already guessed, the best way to implement a logical OR is to use De Morgan's Law:</p>
<pre>
not (p or q) &lt;=&gt; not p and not q

/* Implements SYMBOL or not TOKEN (attempt #2) */
%SYMBOL:?TOKEN:|skip
text					/* If SYMBOL or not TOKEN */
-skip

</pre>
<p>Who said they didn't care about logic? ;-)</p><p>Expansion is done with the <em>expand</em> command.  It has been provided to avoid some cumbersome writings in makefiles when you have to repeat some silly lines that only differ in file names, for instance.  Let's look at an example first:</p>
<pre>
|expand a!foo bar! b!yes no!
!a::
	echo !a, !b
-expand
</pre>
<p>Then two rules will be printed, and the values of (a,b) for the first will be (foo, yes), for the second (bar, no).  Substitution is controled by the '!' character.  If the word to be substituted is part of another one, detach with the ^^ construct as in:  !b^^c.  It is possible to use Makefile macros in the &lt;pattern&gt;, and they will be expanded by jmake.  If this is not what you want, escape the first '$' sign (this is a Makefile escape, i.e. you must double the '$', not precede it with a backslash). A // stands for the null substitution value.</p><p>The ^^^ construct behaves like ^^, i.e. it is stripped out, but it also removes any following white space after the ^^^.  If you prepend something to a macro argument, and that macro argument was written with spaces before it, then this will let you concatenate something right before that argument's final value.</p><p>Here is another example which shows how the macro Expand can be used. It is defined in <em>Jmake.rules</em> as:</p>
<pre>
#define Expand(rule, pattern) @!&#92;
|expand pattern @!&#92;
rule @!&#92;
-expand

</pre>
<p>So we can write in the <em>Jmakefile</em>:</p>
<pre>
|skip
A = foo bar
-skip

#define Rule @!&#92;
$(DIR)/!a^^.o: !a^^.o @@&#92;
	$(CC) -c !a^^.c @@&#92;
	$(MV) !a^^.o $(DIR)

Expand(Rule, a!$(A)!)

</pre>
<p>which will generate in <em>Makefile.SH</em>:</p>
<pre>
$(DIR)/foo.o: foo.o
	$(CC) -c foo.c
	$(MV) foo.o $(DIR)

$(DIR)/bar.o: bar.o
	$(CC) -c bar.c
	$(MV) bar.o $$(DIR)

</pre>
<p>The 'A' declaration has been surrounded by <em>skip</em>, so that it does not appear in the generated Makefile.SH, but it will be taken into account by <em>jmake</em> for the substitution in the pattern.</p><p>The number of expansions is determined by the number of possible values for the <strong>first</strong> parameter. If other parameters have less substitution values, they will get void ones.</p><p>It is possible to add a regular expression at the end of '-expand'. This regular expression will be removed from the final set of expansion at the end of each line. It is also possible to do substitutions in the expanded item, by using the syntax (if 'f' is the expanded variable) !f:<em>&lt;p&gt;</em>=<em>&lt;q&gt;</em> where <em>&lt;p&gt;</em> and <em>&lt;q&gt;</em> are two regular expressions (without spaces). The pattern <em>&lt;p&gt;</em> will be replaced by the pattern <em>&lt;q&gt;</em> (only the first occurrence will be replaced).</p><p>Finally, you may refer in the expanded section to variables whose value is computed via another expansion, which makes it easy to define generic <em>Jmakefiles</em>.</p><p>Example:</p>
<pre>
SRC = foo.c bar.c
OBJ = &#92;
|expand f!$(SRC)!
	!f:&#92;.c=&#92;.o &#92;
-expand &#92;&#92;
INC = &#92;
|expand f!$(OBJ)!
	!f:&#92;.o=&#92;.h &#92;
-expand &#92;&#92;
</pre>
<p>which will generate in <em>Makefile.SH</em>:</p>
<pre>
SRC = foo.c bar.c
OBJ = &#92;
	foo.o &#92;
	bar.o
INC = &#92;
	foo.h &#92;
	bar.h
</pre>
<p>Do not forget to protect special characters in your regular expressions such as backslash, point, etc...</p><p>The <em>once</em> command is tagged with a name. The first time the name appears, the once construct is ignored and the text up to '-once' will be copied in the generated Makefile.SH.  However, future occurences of the same name will be ignored (<em>once</em> will behave like <em>skip</em>).</p><p>Example:</p>
<pre>
|once this_is_a_name
&lt;text&gt;
-once

</pre>
<p>The <em>shell</em> command can be used to generate a shell fragment in the Makefile.SH.  For instance, the following section in the Jmakefile:</p>
<pre>
|shell
case "$d_usegtk1" in
define) glib=1; gtk=1;;
esac
-shell

</pre>
<p>will cause the generation of the enclosed fragment in the Makefile.SH to compute the values of the <em>glib</em> and <em>gtk</em> variables based on the configuration variable <em>d_usegtk1</em> set by running Configure.</p><p>In turn, this can be used in subsequent <em>case</em> sections to activate parts of the Makefile only when building for GTK1 using glib-1.x:</p>
<pre>
|case glib in 1
display:
	echo "Building for glib-1.x"
-case

</pre>
<p>This section will generate something like this in the Makefile.SH:</p>
<pre>
!NO!SUBS!
case "$glib" in
1)
	$spitshell &gt;&gt;Makefile &lt;&lt;'!NO!SUBS!'
display:
	echo "Building for glib-1.x"
!NO!SUBS!
	;;
esac
$spitshell &gt;&gt;Makefile &lt;&lt;'!NO!SUBS!'

</pre>
<p>And when running Makefile.SH, the "display" rule above will only appear when building for glib-1.x.  The form of the final <em>Makefile</em> can therefore depend on the configuration options chosen when <em>Configure</em> was run.</p>
  </dd>
  <dt>
    5)
  </dt>
  <dd>
    <p>Initializations:</p><ul>
<li><p>+&lt;line&gt;: Puts the whole line in the initialization section.</p></li><li><p>++SYMBOL &lt;value&gt;: Adds &lt;value&gt; to the SYMBOL macro.</p></li>
</ul>
  </dd>
  <dt>
    6)
  </dt>
  <dd>
    <p>User-defined variables:</p><p>The user may define CFLAGS, LDFLAGS or DPFLAGS as additional flags to be used in C compilation, linking phase or depend target. It is thus possible to add some extra flags such as -I or libraries for Makefiles in specific sub-directories.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Raphael Manfredi &lt;Raphael_Manfredi@pobox.com&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>Jmakefile</p>
  </dt>
  <dd>
    <p>High level description of Makefile.SH</p>
  </dd>
  <dt>
    <p>Jmake.rules</p>
  </dt>
  <dd>
    <p>File holding the macro definitions</p>
  </dd>
  <dt>
    <p>Jmake.tmpl</p>
  </dt>
  <dd>
    <p>Template used to mould Makefile.SH</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>On systems whose <em>cpp</em> reduces multiple tabs and spaces to a single space, <em>jmake</em> attempts to put back any necessary tabs (which <em>make</em> expects in front of rules) but does not properly formats the body of the rule itself.</p><p>There is a bootstraping problem when creating the first Makefile.SH, because you cannot run it through a shell until there is a decent Configure script, but you can't run <em>metaconfig</em> before there is a Makefile.SH or some needed symbols will not be defined.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO jmake&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/jmkmf.1.html"><strong>jmkmf</strong>(1)</a>, <a href="../man1/metaconfig.1.html"><strong>metaconfig</strong>(1)</a>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="jmacs.1.html"><span aria-hidden="true">&larr;</span> jmacs.1: None</a></li>
   <li class="next"><a href="jmapviewer.1.html">jmapviewer.1: Jmapviewer is a java component which allows one to easily integrate an osm map view into your java application, including demo program jmapviewer. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
