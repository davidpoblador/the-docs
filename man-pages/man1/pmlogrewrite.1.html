<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmlogrewrite: Rewrite performance co-pilot archives</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Rewrite performance co-pilot archives">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmlogrewrite (1) manual">
  <meta name="twitter:description" content="Rewrite performance co-pilot archives">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmlogrewrite<small> (1)</small></h1>
        <p class="lead">Rewrite performance co-pilot archives</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmlogrewrite.1.html">
      <span itemprop="name">pmlogrewrite: Rewrite performance co-pilot archives</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmlogrewrite.1.html">
      <span itemprop="name">pmlogrewrite: Rewrite performance co-pilot archives</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>$PCP_BINADM_DIR/pmlogrewrite</strong> [<strong>-Cdiqsvw </strong>] [<strong>-c</strong> <em>config</em>] <em>inlog</em> [<em>outlog</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>pmlogrewrite</strong> reads a set of Performance Co-Pilot (PCP) archive logs identified by <em>inlog</em> and creates a PCP archive log in <em>outlog</em>. Under normal usage, the <strong>-c</strong> option will be used to nominate a configuration file or files that contains specifications (see the <strong>REWRITING RULES SYNTAX</strong> section below) that describe how the data and metadata from <em>inlog</em> should be transformed to produce <em>outlog</em>.</p><p>The typical uses for <strong>pmlogrewrite</strong> would be to accommodate the evolution of Performance Metric Domain Agents (PMDAs) where the names, metadata and semantics of metrics and their associated instance domains may change over time, e.g. promoting the type of a metric from a 32-bit to a 64-bit integer, or renaming a group of metrics. Refer to the <strong>EXAMPLES</strong> section for some additional use cases.</p><p><strong>pmlogrewrite</strong> is most useful where PMDA changes, or errors in the production environment, result in archives that cannot be combined with <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a>. By pre-processing the archives with <strong>pmlogrewrite</strong> the resulting archives may be able to be merged with <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a>.</p><p>The input <em>inlog</em> must be a set of PCP archive logs created by <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>, or possibly one of the tools that read and create PCP archives, e.g. <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a> and <a href="../man1/pmlogreduce.1.html"><strong>pmlogreduce</strong>(1)</a>. <em>inlog</em> is a comma-separated list of names, each of which may be the base name of an archive or the name of a directory containing one or more archives.</p><p>If no <strong>-c</strong> option is specified, then the default behavior simply creates <em>outlog</em> as a copy of <em>inlog</em>. This is a little more complicated than <strong>cat</strong>(1), as each PCP archive is made up of several physical files.</p><p>While <strong>pmlogrewrite</strong> may be used to repair some data consistency issues in PCP archives, there is also a class of repair tasks that cannot be handled by <strong>pmlogrewrite</strong> and <a href="../man1/pmloglabel.1.html"><strong>pmloglabel</strong>(1)</a> may be a useful tool in these cases.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMAND LINE OPTIONS</h2>
        <div class="sectioncontent">
<p>The command line options for <strong>pmlogrewrite</strong> are as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-C</strong></p>
  </dt>
  <dd>
    <p>Parse the rewriting rules and quit. <em>outlog</em> is not created. When <strong>-C</strong> is specified, this also sets <strong>-v</strong> and <strong>-w</strong> so that all warnings and verbose messages are displayed as <em>config</em> is parsed.</p>
  </dd>
  <dt>
    <p><strong>-c</strong><em> config</em></p>
  </dt>
  <dd>
    <p>If <em>config</em> is a file or symbolic link, read and parse rewriting rules from there. If <em>config</em> is a directory, then all of the files or symbolic links in that directory (excluding those beginning with a period ``.'') will be used to provide the rewriting rules. Multiple <strong>-c</strong> options are allowed.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Desperate mode.  Normally if a fatal error occurs, all trace of the partially written PCP archive <em>outlog</em> is removed.  With the <strong>-d</strong> option, the partially created <em>outlog</em> archive log is not removed.</p>
  </dd>
  <dt>
    <p><strong>-i</strong></p>
  </dt>
  <dd>
    <p>Rather than creating <em>outlog</em>, <em>inlog</em> is rewritten in place when the <strong>-i</strong> option is used. A new archive is created using temporary file names and then renamed to <em>inlog</em> in such a way that if any errors (not warnings) are encountered, <em>inlog</em> remains unaltered.</p>
  </dd>
  <dt>
    <p><strong>-q</strong></p>
  </dt>
  <dd>
    <p>Quick mode, where if there are no rewriting actions to be performed (none of the global data, instance domains or metrics from <em>inlog</em> will be changed), then <strong>pmlogrewrite</strong> will exit (with status 0, so success) immediately after parsing the configuration file(s) and <em>outlog</em> is not created.</p>
  </dd>
  <dt>
    <p><strong>-s</strong></p>
  </dt>
  <dd>
    <p>When the ``units'' of a metric are changed, if the dimension in terms of space, time and count is unaltered, then the scaling factor is being changed, e.g. BYTE to KBYTE, or MSEC\u\s-3-1\s0\d to USEC\u\s-3-1\s0\d, or the composite MBYTE.SEC\u\s-3-1\s0\d to KBYTE.USEC\u\s-3-1\s0\d. The motivation may be (a) that the original metadata was wrong but the values in <em>inlog</em> are correct, or (b) the metadata is changing so the values need to change as well.  The default <strong>pmlogrewrite</strong> behaviour matches case (a).  If case (b) applies, then use the <strong>-s</strong> option and the values of all the metrics with a scale factor change in each result will be rescaled. For finer control over value rescaling refer to the &#92;f(BI&#92;$1&#92;fP&#92;$2 option for the clause of the metric rewriting rule described below.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Increase verbosity of diagnostic output.</p>
  </dd>
  <dt>
    <p><strong>-w</strong></p>
  </dt>
  <dd>
    <p>Emit warnings.  Normally <strong>pmlogrewrite</strong> remains silent for any warning that is not fatal and it is expected that for a particular archive, some (or indeed, all) of the rewriting specifications may not apply.  For example, changes to a PMDA may be captured in a set of rewriting rules, but a single archive may not contain all of the modified metrics nor all of the modified instance domains and/or instances.  Because these cases are expected, they do not prevent <strong>pmlogrewrite</strong> executing, and rules that do not apply to <em>inlog</em> are silently ignored by default. Similarly, some rewriting rules may involve no change because the metadata in <em>inlog</em> already matches the intent of the rewriting rule to correct data from a previous version of a PMDA. The <strong>-w</strong> flag forces warnings to be emitted for all of these cases.</p>
  </dd>

</dl>
<p>The argument <em>outlog</em> is required in all cases, except when <strong>-i</strong> is specified.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REWRITING RULES SYNTAX</h2>
        <div class="sectioncontent">
<p>A configuration file contains zero or more rewriting rules as defined below.</p><p>Keywords and special punctuation characters are shown below in font and are case-insensitive, so and are all equivalent in rewriting rules.</p><p>The character ``#'' introduces a comment and the remainder of the line is ignored.  Otherwise the input is relatively free format with optional white space (spaces, tabs or newlines) between lexical items in the rules.</p><p>A <strong>global</strong> rewriting rule has the form:</p><p><em>globalspec</em> ...</p><p>where <em>globalspec</em> is zero or more of the following clauses:</p><p><em>hostname</em></p><p>Modifies the label records in the <em>outlog</em> PCP archive, so that the metrics will appear to have been collected from the host <em>hostname</em>.</p><p><em>delta</em></p><p>Both metric values and the instance domain metadata in a PCP archive carry timestamps. This clause forces all the timestamps to be adjusted by <em>delta</em>, where <em>delta</em> is an optional sign ``+'' (the default) or ``-'', an optional number of hours followed by a colon ``:'', an optional number of minutes followed by a colon ``:'', a number of seconds, an optional fraction of seconds following a period ``.''.  The simplest example would be ``30'' to increase the timestamps by 30 seconds.  A more complex example would be ``-23:59:59.999'' to move the timestamps backwards by one millisecond less than one day.</p><p><strong>"</strong><em>timezone</em><strong>"</strong></p><p>Modifies the label records in the <em>outlog</em> PCP archive, so that the metrics will appear to have been collected from a host with a local timezone of <em>timezone</em>. <em>timezone</em> must be enclosed in quotes, and should conform to the valid timezone syntax rules for the local platform.</p><p>An <strong>indom</strong> rewriting rule modifies an instance domain and has the form:</p><p><em>domain</em><strong>.</strong><em>serial</em> <em>indomspec</em> ...</p><p>where <em>domain</em> and <em>serial</em> identify one or more existing instance domains from <em>inlog</em> - typically <em>domain</em> would be an integer in the range 1 to 510 and <em>serial</em> would be an integer in the range 0 to 4194304.</p><p>As a special case <em>serial</em> could be an asterisk ``*'' which means the rule applies to every instance domain with a domain number of <em>domain</em>.</p><p>If a designated instance domain is not in <em>inlog</em> the rule has no effect.</p><p>The <em>indomspec</em> is zero or more of the following clauses:</p><p>"<em>oldname</em>" "<em>newname</em>"</p><p>The instance identified by the external instance name <em>oldname</em> is renamed to <em>newname</em>. Both <em>oldname</em> and <em>newname</em> must be enclosed in quotes.</p><p>As a special case, the new name may be the keyword (with no quotes), and then the instance <em>oldname</em> will be expunged from <em>outlog</em> which removes it from the instance domain metadata and removes all values of this instance for all the associated metrics.</p><p>If the instance names contain any embedded spaces then special care needs to be taken in respect of the PCP instance naming rule that treats the leading non-space part of the instance name as the unique portion of the name for the purposes of matching and ensuring uniqueness within an instance domain, refer to <a href="../man3/pmdainstance.3.html"><strong>pmdaInstance</strong>(3)</a> for a discussion of this issue.</p><p>As an illustration, consider the hypothetical instance domain for a metric which contains 2 instances with the following names:</p>
<pre>
red
eek urk
</pre>
<p>Then some possible clauses might be:</p>
<dl class='dl-vertical'>
  <dt>
    <p>"eek" -&gt; "yellow like a flower"</p>
  </dt>
  <dd>
    <p>Acceptable, <em>oldname</em> "eek" matches the "eek urk" instance.</p>
  </dd>
  <dt>
    <p>"red" -&gt; "eek"</p>
  </dt>
  <dd>
    <p>Error, <em>newname</em> "eek" matches the existing "eek urk" instance.</p>
  </dd>
  <dt>
    <p>"eek urk" -&gt; "red of another hue"</p>
  </dt>
  <dd>
    <p>Error, <em>newname</em> "red of another hue" matches the existing "red" instance.</p>
  </dd>

</dl>
<p><em>newdomain</em><strong>.</strong><em>newserial</em></p><p>Modifies the metadata for the instance domain and every metric associated with the instance domain. As a special case, <em>newserial</em> could be an asterisk ``*'' which means use <em>serial</em> from the <strong>indom</strong> rewriting rule, although this is most useful when <em>serial</em> is also an asterisk. So for example:</p><p>indom 29.* { indom -&gt; 109.* }</p><p>will move all instance domains from domain 29 to domain 109.</p><p><em>newdomain</em><strong>.</strong><em>newserial</em></p><p>A special case of the previous clause where the instance domain is a duplicate copy of the <em>domain</em><strong>.</strong><em>serial</em> instance domain from the <em>indom</em> rewriting rule, and then any mapping rules are applied to the copied <em>newdomain</em><strong>.</strong><em>newserial</em> instance domain.  This is useful when a PMDA is split and the same instance domain needs to be replicated for domain <em>domain</em> and domain <em>newdomain</em>. So for example if the metrics <em>foo.one</em> and <em>foo.two</em> are both defined over instance domain 12.34, and <em>foo.two</em> is moved to another PMDA using domain 27, then the following rewriting rules could be used:</p><p>indom 12.34 { indom -&gt; duplicate 27.34 }</p><p>metric foo.two { indom -&gt; 27.34 pmid -&gt; 27.*.*  }</p><p><em>oldid</em> <em>newid</em></p><p>The instance identified by the internal instance identifier <em>oldid</em> is renumbered to <em>newid</em>. Both <em>oldid</em> and <em>newid</em> are integers in the range 0 to 2\u\s-331\s0\d-1.</p><p>As a special case, <em>newid</em> may be the keyword and then the instance <em>oldid</em> will be expunged from <em>outlog</em> which removes it from the instance domain metadata and removes all values of this instance for all the associated metrics.</p><p>A <strong>metric</strong> rewriting rule has the form:</p><p><em>metricid</em> <em>metricspec</em> ...</p><p>where <em>metricid</em> identifies one or more existing metrics from <em>inlog</em> using either a metric name, or the internal encoding for a metric's PMID as <em>domain</em><strong>.</strong><em>cluster</em><strong>.</strong><em>item</em>. In the latter case, typically <em>domain</em> would be an integer in the range 1 to 510, <em>cluster</em> would be an integer in the range 0 to 4095, and <em>item</em> would be an integer in the range 0 to 1023.</p><p>As special cases <em>item</em> could be an asterisk ``*'' which means the rule applies to every metric with a domain number of <em>domain</em> and a cluster number of <em>cluster</em>, or <em>cluster</em> could be an asterisk which means the rule applies to every metric with a domain number of <em>domain</em> and an item number of <em>item</em>, or both <em>cluster</em> and <em>item</em> could be asterisks, and rule applies to every metric with a domain number of <em>domain</em>.</p><p>If a designated metric is not in <em>inlog</em> the rule has no effect.</p><p>The <em>metricspec</em> is zero or more of the following clauses:</p><p>The metric is completely removed from <em>outlog</em>, both the metadata and all values in results are expunged.</p><p><em>newdomain</em><strong>.</strong><em>newserial</em> [ <em>pick</em> ]</p><p>Modifies the metadata to change the instance domain for this metric. The new instance domain must exist in <em>outlog</em>.</p><p>The optional <em>pick</em> clause may be used to select one input value, or compute an aggregate value from the instances in an input result, or assign an internal instance identifier to a single output value. If no <em>pick</em> clause is specified, the default behaviour is to copy all input values from each input result to an output result, however if the input instance domain is singular (indom <strong>PM_INDOM_NULL</strong>) then the one output value must be assigned an internal instance identifier, which is 0 by default, unless over-ridden by a or clause as defined below.</p><p>The choices for <em>pick</em> are as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>OUTPUT FIRST</strong></p>
  </dt>
  <dd>
    <p>choose the value of the first instance from each input result</p>
  </dd>
  <dt>
    <p><strong>OUTPUT LAST</strong></p>
  </dt>
  <dd>
    <p>choose the value of the last instance from each input result</p>
  </dd>
  <dt>
    <p><strong>OUTPUT INST</strong> <em>instid</em></p>
  </dt>
  <dd>
    <p>choose the value of the instance with internal instance identifier <em>instid</em> from each result; the sequence of rewriting rules ensures the processing happens before instance identifier renumbering from any associated <strong>indom</strong> rule, so <em>instid</em> should be one of the internal instance identifiers that appears in <em>inlog</em></p>
  </dd>
  <dt>
    <p><strong>OUTPUT INAME</strong> "<em>name</em>"</p>
  </dt>
  <dd>
    <p>choose the value of the instance with <em>name</em> for its external instance name from each result; the sequence of rewriting rules ensures the processing happens before instance renaming from any associated <strong>indom</strong> rule, so <em>name</em> should be one of the external instance names that appears in <em>inlog</em></p>
  </dd>
  <dt>
    <p><strong>OUTPUT MIN</strong></p>
  </dt>
  <dd>
    <p>choose the smallest value in each result (metric type must be numeric and output instance will be 0 for a non-singular instance domain)</p>
  </dd>
  <dt>
    <p><strong>OUTPUT MAX</strong></p>
  </dt>
  <dd>
    <p>choose the largest value in each result (metric type must be numeric and output instance will be 0 for a non-singular instance domain)</p>
  </dd>
  <dt>
    <p><strong>OUTPUT SUM</strong></p>
  </dt>
  <dd>
    <p>choose the sum of all values in each result (metric type must be numeric and output instance will be 0 for a non-singular instance domain)</p>
  </dd>
  <dt>
    <p><strong>OUTPUT AVG</strong></p>
  </dt>
  <dd>
    <p>choose the average of all values in each result (metric type must be numeric and output instance will be 0 for a non-singular instance domain)</p>
  </dd>

</dl>
<p>If the input instance domain is singular (indom <strong>PM_INDOM_NULL</strong>) then independent of any <em>pick</em> specifications, there is at most one value in each input result and so and are all equivalent and the output instance identifier will be 0.</p><p>In general it is an error to specify a rewriting action for the same metadata or result values more than once, e.g. more than one clause for the same instance domain.  The one exception is the possible interaction between the clauses in the <strong>indom</strong> and <strong>metric</strong> rules. For example the metric <em>sample.bin</em> is defined over the instance domain 29.2 in <em>inlog</em> and the following is acceptable (albeit redundant):</p>
<pre>
indom 29.* { indom -&gt; 109.* }
metric sample.bin { indom -&gt; 109.2 }
</pre>
<p>However the following is an error, because the instance domain for <em>sample.bin</em> has two conflicting definitions:</p>
<pre>
indom 29.* { indom -&gt; 109.* }
metric sample.bin { indom -&gt; 123.2 }
</pre>
<p><em>pick</em> ]</p><p>The metric (which must have been previously defined over an instance domain) is being modified to be a singular metric.  This involves a metadata change and collapsing all results for this metric so that multiple values become one value.</p><p>The optional <em>pick</em> part of the clause defines how the one value for each result should be calculated and follows the same rules as described for the non-NULL case above.</p><p>In the absence of <em>pick</em>, the default is</p><p><em>newname</em></p><p>Renames the metric in the PCP archive's metadata that supports the Performance Metrics Name Space (PMNS). <em>newname</em> should not match any existing name in the archive's PMNS and must follow the syntactic rules for valid metric names as outlined in <a href="../man5/pmns.5.html"><strong>pmns</strong>(5)</a>.</p><p><em>newdomain</em><strong>.</strong><em>newcluster</em><strong>.</strong><em>newitem</em></p><p>Modifies the metadata and results to renumber the metric's PMID. As special cases, <em>newcluster</em> could be an asterisk ``*'' which means use <em>cluster</em> from the <strong>metric</strong> rewriting rule and/or <em>item</em> could be an asterisk which means use <em>item</em> from the <strong>metric</strong> rewriting rule. This is most useful when <em>cluster</em> and/or <em>item</em> is also an asterisk. So for example:</p><p>metric 30.*.* { pmid -&gt; 123.*.* }</p><p>will move all metrics from domain 30 to domain 123.</p><p><em>newsem</em></p><p>Change the semantics of the metric. <em>newsem</em> should be the XXX part of the name of one of the <strong>PM_SEM_XXX</strong> macros defined in &lt;pcp/pmapi.h&gt; or <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, e.g. for <strong>PM_TYPE_COUNTER</strong>.</p><p>No data value rewriting is performed as a result of the clause, so the usefulness is limited to cases where a version of the associated PMDA was exporting incorrect semantics for the metric. <a href="../man1/pmlogreduce.1.html"><strong>pmlogreduce</strong>(1)</a> may provide an alternative in cases where re-computation of result values is desired.</p><p><em>newtype</em></p><p>Change the type of the metric which alters the metadata and may change the encoding of values in results. <em>newtype</em> should be the XXX part of the name of one of the <strong>PM_TYPE_XXX</strong> macros defined in &lt;pcp/pmapi.h&gt; or <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, e.g. for <strong>PM_TYPE_FLOAT</strong>.</p><p>Type conversion is only supported for cases where the old and new metric type is numeric, so <strong>PM_TYPE_STRING</strong>, <strong>PM_TYPE_AGGREGATE</strong> and <strong>PM_TYPE_EVENT</strong> are not allowed. Even for the numeric cases, some conversions may produce run-time errors, e.g. integer overflow, or attempting to rewrite a negative value into an unsigned type.</p><p><em>newunits</em> [ ]</p><p><em>newunits</em> is six values separated by commas.  The first 3 values describe the dimension of the metric along the dimensions of space, time and count; these are integer values, usually 0, 1 or -1.  The remaining 3 values describe the scale of the metric's values in the dimensions of space, time and count. Space scale values should be 0 (if the space dimension is 0), else the XXX part of the name of one of the <strong>PM_SPACE_XXX</strong> macros, e.g. for <strong>PM_TYPE_KBYTE</strong>. Time scale values should be 0 (if the time dimension is 0), else the XXX part of the name of one of the <strong>PM_TIME_XXX</strong> macros, e.g. for <strong>PM_TIME_SEC</strong>. Count scale values should be 0 (if the time dimension is 0), else for <strong>PM_COUNT_ONE</strong>.</p><p>The <strong>PM_SPACE_XXX</strong>, <strong>PM_TIME_XXX</strong> and <strong>PM_COUNT_XXX</strong> macros are defined in &lt;pcp/pmapi.h&gt; or <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>.</p><p>When the scale is changed (but the dimension is unaltered) the optional keyword may be used to chose value rescaling as per the <strong>-s</strong> command line option, but applied to just this metric.</p><p>When changing the domain number for a metric or instance domain, the new domain number will usually match an existing PMDA's domain number.  If this is not the case, then the new domain number should not be randomly chosen; consult <strong>$PCP_VAR_DIR/pmns/stdpmid</strong> for domain numbers that are already assigned to PMDAs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>To promote the values of the per-disk IOPS metrics to 64-bit to allow aggregation over a long time period for capacity planning, or because the PMDA has changed to export 64-bit counters and we want to convert old archives so they can be processed alongside new archives.</p>
<pre>
metric disk.dev.read { type -&gt; U64 }
metric disk.dev.write { type -&gt; U64 }
metric disk.dev.total { type -&gt; U64 }
</pre>
<p>The instances associated with the load average metric <strong>kernel.all.load</strong> could be renamed and renumbered by the rules below.</p>
<pre>
# for the Linux PMDA, the kernel.all.load metric is defined
# over instance domain 60.2
indom 60.2 {
    inst 1 -&gt; 60 iname "1 minute" -&gt; "60 second"
    inst 5 -&gt; 300 iname "5 minute" -&gt; "300 second"
    inst 15 -&gt; 900 iname "15 minute" -&gt; "900 second"
}
</pre>
<p>If we decide to split the ``proc'' metrics out of the Linux PMDA, this will involve changing the domain number for the PMID of these metrics and the associated instance domains.  The rules below would rewrite an old archive to match the changes after the PMDA split.</p>
<pre>
# all Linux proc metrics are in 7 clusters
metric 60.8.* { pmid -&gt; 123.*.* }
metric 60.9.* { pmid -&gt; 123.*.* }
metric 60.13.* { pmid -&gt; 123.*.* }
metric 60.24.* { pmid -&gt; 123.*.* }
metric 60.31.* { pmid -&gt; 123.*.* }
metric 60.32.* { pmid -&gt; 123.*.* }
metric 60.51.* { pmid -&gt; 123.*.* }
# only one instance domain for Linux proc metrics
indom 60.9 { indom -&gt; 123.0 }
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>For each of the <em>inlog</em> and <em>outlog</em> archive logs, several physical files are used.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>archive</em><strong>.meta</strong></p>
  </dt>
  <dd>
    <p>metadata (metric descriptions, instance domains, etc.) for the archive log</p>
  </dd>
  <dt>
    <p><em>archive</em><strong>.0</strong></p>
  </dt>
  <dd>
    <p>initial volume of metrics values (subsequent volumes have suffixes <strong>1</strong>, <strong>2</strong>, ...).</p>
  </dd>
  <dt>
    <p><em>archive</em><strong>.index</strong></p>
  </dt>
  <dd>
    <p>temporal index to support rapid random access to the other files in the archive log.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmlogrewrite&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/pcpintro.1.html"><strong>PCPIntro</strong>(1)</a>, <a href="../man3/pmdainstance.3.html"><strong>pmdaInstance</strong>(3)</a>, <a href="../man1/pmdumplog.1.html"><strong>pmdumplog</strong>(1)</a>, <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>, <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a>, <a href="../man1/pmloglabel.1.html"><strong>pmloglabel</strong>(1)</a>, <a href="../man1/pmlogreduce.1.html"><strong>pmlogreduce</strong>(1)</a>, <a href="../man3/pmlookupdesc.3.html"><strong>pmLookupDesc</strong>(3)</a>, <a href="../man5/pmns.5.html"><strong>pmns</strong>(5)</a>, <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a> and <a href="../man5/pcp.env.5.html"><strong>pcp.env</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>All error conditions detected by <strong>pmlogrewrite</strong> are reported on <em>stderr</em> with textual (if sometimes terse) explanation.</p><p>Should the input archive log be corrupted (this can happen if the <strong>pmlogger</strong> instance writing the log suddenly dies), then <strong>pmlogrewrite</strong> will detect and report the position of the corruption in the file, and any subsequent information from that archive log will not be processed.</p><p>If any error is detected, <strong>pmlogrewrite</strong> will exit with a non-zero status.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmlogreduce.1.html"><span aria-hidden="true">&larr;</span> pmlogreduce.1: Temporal reduction of performance co-pilot archives</a></li>
   <li class="next"><a href="pmlogsummary.1.html">pmlogsummary.1: Calculate averages of metrics stored in a set of pcp archives <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
