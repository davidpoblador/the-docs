<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>emgrip: Converts a .deb to emdebian grip on-the-fly</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Converts a .deb to emdebian grip on-the-fly">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="emgrip (1) manual">
  <meta name="twitter:description" content="Converts a .deb to emdebian grip on-the-fly">
  <meta name="twitter:image" content="https://www.carta.tech/images/emdebian-grip-emgrip-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/emgrip.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="emgrip (1) manual" />
  <meta property="og:description" content="Converts a .deb to emdebian grip on-the-fly" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/emdebian-grip-emgrip-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">emgrip<small> (1)</small></h1>
        <p class="lead">Converts a .deb to emdebian grip on-the-fly</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/emgrip.1.html">
      <span itemprop="name">emgrip: Converts a .deb to emdebian grip on-the-fly</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/emdebian-grip/">
      <span itemprop="name">emdebian-grip</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/emgrip.1.html">
      <span itemprop="name">emgrip: Converts a .deb to emdebian grip on-the-fly</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">Synopsis</h2>
        <div class="sectioncontent">

<pre>
 DEB_BUILD_OPTIONS=&apos;usegrip&apos; emgrip [-v|--verbose] [-q|--quiet]
    [--vendor VENDOR] [-o|--outdir DIRECTORY] FILENAME
</pre>
<p>where \s-1FILENAME\s0 is a .dsc, a .changes or a .deb</p><p> emgrip -?|-h|--help|--version</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Description</h2>
        <div class="sectioncontent">
<p>Converts a .deb package to Emdebian Grip by unpacking, pruning particular classes of files (determined by \s-1DEB_BUILD_OPTIONS\s0 or the dpkg vendor support) and repacking with a shortened description and the em1 version suffix.</p><p>For the Debian buildd, the unstable-grip vendor omits generation of Emdebian TDebs and changes the suite name to use the -grip suffix.</p><p>When creating a public Emdebian Grip repository, it is strongly recommended to specify .changes or .dsc files to allow the generation of Emdebian TDebs from the source package as well as including the source package itself in the repository.</p><p>In .dsc mode, \*(C`emgrip\*(C' only processes the source package, as of version 3.0.0</p><p>If a file exists with the same name in the output directory, it will be overwritten.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Copyright and Licence</h2>
        <div class="sectioncontent">
<p> Copyright (C) 1997-2000  Roman Hodek &lt;roman@hodek.net&gt;  Copyright (C) 2000-2002  Colin Watson &lt;cjwatson@debian.org&gt;  Copyright (C) 2002-2004  David Schleef &lt;ds@schleef.org&gt;  Copyright (C) 2004  Nikita Youshchenko &lt;yoush@cs.msu.su&gt;  Copyright (C) 2004  Raphael Bossek &lt;bossekr@debian.org&gt;  Copyright (C) 2007-2011  Neil Williams &lt;codehelp@debian.org&gt;  Copyright (C) 2005 Joey Hess &lt;joeyh@debian.org&gt;</p><p> This package is free software; you can redistribute it and/or modify  it under the terms of the GNU General Public License as published by  the Free Software Foundation; either version 3 of the License, or  (at your option) any later version.</p><p> This program is distributed in the hope that it will be useful,  but WITHOUT ANY WARRANTY; without even the implied warranty of  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License for more details.</p><p> You should have received a copy of the GNU General Public License  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Emdebian Grip</h2>
        <div class="sectioncontent">
<p>The idea here is based on dpkg-cross:</p><p> 1. receive .deb or .changes as a command-line option  2. parse DEB_BUILD_OPTIONS  3. unpack the .deb as dpkg-cross does  4. remove files as per DEB_BUILD_OPTIONS  5. repack the .deb with an Emdebian version suffix.  6. build new .deb and revise .changes so that the      original source can be retained.  7. Include the gripped packages into a local mirror      to reduce the size of Packages.gz and the size of      the mirror itself.</p><p>As few dependencies as possible - this script should become a new package and have a new set of lintian checks to allow perl etc.</p><p> NO FUNCTIONAL CHANGES IN THE FINAL .DEB !</p><p>Conversion of Debian translations to Emdebian TDebs (where supported by the build options) needs to be done inside the source package so a .changes file is needed for this step. If the .changes file references a Debian TDeb, emgrip will run 'em_installtdeb --no-sign' inside the source package.</p><p>Individual packages containing translation files will have the translation files removed and Debian TDebs are skipped.</p><p>Future versions may also understand Dpkg Classes but until those are implemented, this uses brute force.</p><p>Set the build options by placing a file in <em>/etc/dpkg/origins/</em> containing the build options in a field called \*(C`Grip-Build-Option\*(C' and call \*(C`emgrip\*(C' with the \*(C`--vendor\*(C' option or \*(C`DEB_VENDOR\*(C' environment variable.</p><p>dpkg-vendor fields used by emgrip with default values:</p><p> Vendor: emdebian-grip  Vendor-Name: Emdebian Grip  Grip-Build-Option: usegrip  Short-Desc-Suffix: gripped</p><p>The \*(C`Short-Desc-Suffix\*(C' is wrapped in parentheses and appended to the short description [default is 'gripped'].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DEB_BUILD_OPTIONS</h2>
        <div class="sectioncontent">
<p>If none of these options are set, emgrip does nothing.</p><p> nodocs</p><p>Remove all content in /usr/share/doc/*/ except the copyright file and compress the copyright file itself. Remove manpages and info pages (translated or not). Also remove doc-base files that describe the documentation that no longer exists.</p><p> nohelp</p><p>Remove even help files from all packages, including -doc packages. Includes removing /usr/share/gtk-doc/html and /usr/share/gnome/help/&#92;$package Despite removing the help files, dependencies on help file utilities like scrollkeeper will remain, at least for Lenny.</p><p> noessential</p><p>Remove the 'Essential: yes' tag from DEBIAN/control - this is a brute force removal, no additional dependencies are to be generated (no patches) so care is needed here.</p><p> nolintian</p><p>Remove all files from /usr/share/lintian/overrides and /usr/share/linda/overrides - saves up to 1Mb.</p><p> usegrip</p><p>Combination flag that sets all \s-1DEB_BUILD_OPTIONS\s0 for Emdebian Grip - noessential, nohelp, nodocs, nolintian</p><p> debiangrip</p><p>Debian-only flag which omits processing of TDebs, even for .changes files then changes the distribution to match the Emdebian suites in Debian. Other processing remains the same as the usegrip option.</p><p> nosymbols</p><p>Currently being tested - the idea is to drop DEBIAN/symbols files but this could have unpredictable effects on packages built on a system lacking these symbols. The space saved by dropping these files might not be worth the cost, so 'usegrip' does not yet activate 'nosymbols'. This might be suitable for Crush, maybe not Grip.</p><p> noperl</p><p>Remove any file that is found to be a perl script text executable by 'file' - used by Crush.</p><p> usecrush</p><p>Combination flag that adds nosymbols and noperl to usegrip.</p><p> noscripts</p><p>Drop all maintainer scripts from all packages irrespective of the type of script. Includes removing debconf templates and config scripts. md5sums files and triggers are also removed. Scripts are moved to a <em>scripts/</em> subdirectory of the output directory used by \*(C`emgrip\*(C'.</p><p> usebaked</p><p>Combination flag that adds noscripts and nosymbols to usegrip. Add \*(C`noperl\*(C' to use Baked for Crush.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Field removal</h2>
        <div class="sectioncontent">
<p>Functional control fields are retained but the question arises:</p><p> Who defines functional?</p><p>Well, for the current purposes of Emdebian Grip, functional includes only the following control fields:</p><p> Package  Source  Version  Architecture  Maintainer  Installed-Size  Depends  Pre-Depends  Multi-Arch  Conflicts  Replaces  Section  Priority  Description  Task  XS-Python-Version</p><p>Recommends is explicitly rejected, as is Suggests - the expectation is that Emdebian Grip will disable Install-Recommends in apt anyway, so that Gripped packages can be mixed with Debian or locally-built packages.</p><p>Note also that 'Essential' is not preserved.</p><p>Homepage, VCS* and all X- control fields are dropped.</p><p>The net result is a (potentially) much cleaner dpkg database.</p><p>The description is trimmed to four lines (or three if the fourth line is empty).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Automation</h2>
        <div class="sectioncontent">
<p>Relatively simple, but a few checks are needed in case your list of possible packages includes packages already processed by dpkg-cross.</p><p> #!/bin/sh  set -e</p><p> DIR=/tmp/myrepo/  for deb in &#96;ls /var/cache/apt/archives/*.deb&#96;; do     cross=&#96;echo $deb | grep "&#92;-.*-cross" || true&#96;     if [ ! -z "$cross" ]; then         echo "skipping dpkg-cross package: $deb"         continue     fi     DEB_BUILD_OPTIONS="nodocs nohelp usegrip" ./emgrip -o $DIR $deb  done</p><p>With \*(C`dpkg-vendor\*(C' support, \s-1DEB_BUILD_OPTIONS\s0 can be replaced by setting the vendor.</p><p>A similar script should be able to cope with obtaining .changes files to retain the source packages.</p><p>Despite using dcut internally, emgrip isn't set up to obtain the .changes files directly from http://incoming.debian.org, a wrapper script would be needed.</p><p>An additional wrapper is likely to be needed to allow an Emdebian Grip repository to \*(L"catch-up\*(R" with the existing Debian mirrors, e.g. if the first upload to the Grip repository is a binary-only upload without a referenced .orig.tar.gz.</p><p>emgrip does ensure that the .tar.gz is copied into the output directory and reprepro can locate the relevant files if the --ignore=missingfile option is passed. Sadly, this functionality is not preserved in the reprepro processincoming mode.</p><p>To ease the process of gripping an existing mirror, the emdebian-grip-server package depends on 'reprepro' to create a filtered Debian mirror that can be kept up to date, generates meta-data for Emdebian Grip, builds gripped packages in an 'incoming/' directory and includes the packages into the final Emdebian Grip repository.</p><p>Once a package has been \*(L"gripped\*(R", the binary packages could be removed from the filtered mirror - the source packages (particularly the .orig.tar.gz) are probably best retained in the filtered mirror.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="emesene.1.html"><span aria-hidden="true">&larr;</span> emesene.1: An instant messaging client</a></li>
   <li class="next"><a href="emgrip-build.1.html">emgrip-build.1: Build wrapper script for emdebian grip <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
