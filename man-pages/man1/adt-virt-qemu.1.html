<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>adt-virt-qemu: Autopkgtest virtualisation server using qemu</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Autopkgtest virtualisation server using qemu">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="adt-virt-qemu (1) manual">
  <meta name="twitter:description" content="Autopkgtest virtualisation server using qemu">
  <meta name="twitter:image" content="https://www.carta.tech/images/autopkgtest-adt-virt-qemu-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/adt-virt-qemu.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="adt-virt-qemu (1) manual" />
  <meta property="og:description" content="Autopkgtest virtualisation server using qemu" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/autopkgtest-adt-virt-qemu-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">adt-virt-qemu<small> (1)</small></h1>
        <p class="lead">Autopkgtest virtualisation server using qemu</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/adt-virt-qemu.1.html">
      <span itemprop="name">adt-virt-qemu: Autopkgtest virtualisation server using qemu</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/autopkgtest/">
      <span itemprop="name">autopkgtest</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/adt-virt-qemu.1.html">
      <span itemprop="name">adt-virt-qemu: Autopkgtest virtualisation server using qemu</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSYS</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-qemu</strong> [<em>options</em>] <em>image </em>[<em>ro-image</em> ...]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-qemu</strong> provides an autopkgtest virtualisation server using QEMU.</p><p>Normally <strong>adt-virt-qemu</strong> will be invoked by <strong>adt-run</strong>.</p><p>You always need to specify at least one QEMU VM image. If your VM needs more disks, you can specify arbitrarily many additional images which will be added in order.</p><p><strong>adt-virt-qemu</strong> does <strong>not modify</strong> the given images, but will instead create a temporary overlay for the primary image, and add all other images as read-only.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REQUIREMENTS</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-qemu</strong> assumes that you have already prepared a suitable Debian based QEMU image (see <strong>BUILDING IMAGES</strong> below for how to create them). but you can use any VM which satisfies one of:</p><ul>
<li><p>They open a root shell on ttyS1, or</p></li><li><p>They have a serial console on ttyS0 where you can log in (getty or similar) with specified user and password. This will then be used to start a root shell on ttyS1, to reduce this to the first case and to not assume that ttyS0 stays operational throughout the whole test.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-u</strong><em> user</em><strong> | --user=</strong><em>user</em></p>
  </dt>
  <dd>
    <p>User name for running tests that don't require root privileges.</p><p>If the VM is not already prepared to start a root shell on ttyS1 this will be also used for logging in on ttyS0. If this is not root, it must be able to run sudo without a password to become root for that purpose.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> password</em><strong> | --password=</strong><em>password</em></p>
  </dt>
  <dd>
    <p>Password for above user for logging into the VM on ttyS0. This is necessary if the VM is not already prepared to start a root shell on ttyS1.</p>
  </dd>
  <dt>
    <p><strong>-q</strong><em> command</em><strong> | --qemu-command=</strong><em>command</em></p>
  </dt>
  <dd>
    <p>QEMU command to run. This defaults to the <strong>qemu-system-*</strong> that matches your system architecture.</p>
  </dd>
  <dt>
    <p><strong>-o</strong><em> dir</em><strong> | --overlay-dir=</strong><em>dir</em></p>
  </dt>
  <dd>
    <p>Directory where the temporary image overlay for the primary image is created. By default this will happen in a work directory in <em>/tmp</em> (or <em>$TMPDIR</em>), but you can use this to e. g. ensure that the overlay is placed on a tmpfs if your <em>/tmp</em> directory is not on tmpfs. This will greatly increase the speed.</p>
  </dd>
  <dt>
    <p><strong>-c</strong><em> num</em><strong> | --cpus=</strong><em>num"</em></p>
  </dt>
  <dd>
    <p>Number of (virtual) CPUs in the VM. Default is 1.</p>
  </dd>
  <dt>
    <p><strong>--ram-size=</strong><em>MiB</em></p>
  </dt>
  <dd>
    <p>VM RAM size in MiB. Default is 1024, i. e. 1 GiB.</p>
  </dd>
  <dt>
    <p><strong>-d</strong> | <strong>--debug</strong></p>
  </dt>
  <dd>
    <p>Enable debugging output.</p>
  </dd>
  <dt>
    <p><strong>--qemu-options=</strong><em>arguments</em></p>
  </dt>
  <dd>
    <p>Pass through arguments to QEMU command; e. g. --qemu-options='-readconfig qemu.cfg'</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILES</h2>
        <div class="sectioncontent">
<p>If you use lots of options or images, you can put parts of, or the whole command line into a text file, with one line per option. E. g. you can create a file <em>sid-desktop.cfg</em> with contents like</p>
<pre>
-utestuser
-ps3kr1t
--ram-size=4096
/home/bob/autopkgtest/sid-desktop.img
</pre>
<p>and then run</p>
<pre>
adt-run [...] --- adt-virt-qemu @sid-desktop.cfg
</pre>
<p>The contents of the configuration file will be expanded in-place as if you would have given its contents on the command line. Please ensure that you <strong>don't place spaces</strong> between short options and their values, they would become a part of the argument value.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INPUT, OUTPUT AND EXIT STATUS</h2>
        <div class="sectioncontent">
<p>The behaviour of <strong>adt-virt-qemu</strong> is as described by the AutomatedTesting virtualisation regime specification.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p><strong>adt-run</strong> does not run <strong>apt-get update</strong> at the start of a package build, which can cause a build failure if you are using a development series template. You will need to run <strong>apt-get update</strong> in the template yourself (e. g. using <strong>--setup-commands</strong>).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUILDING IMAGES</h2>
        <div class="sectioncontent">
<h3>Debian</h3>
<p>For Debian you can use <a href="../man8/vmdebootstrap.8.html"><strong>vmdebootstrap</strong>(8)</a></strong> to build a suitable image. E. g. for unstable:</p>
<pre>
vmdebootstrap --verbose --serial-console --distribution=sid &#92;

   --customize=/usr/share/autopkgtest/adt-setup-vm &#92;

   --user=adt/adt --size=10000000000 --image=adt-sid.raw

qemu-img convert -O qcow2 adt-sid.raw  adt-sid.img

rm adt-sid.raw
</pre>
<p><strong>vmdebootstrap</strong> can only create a raw format image; it is recommended to convert it to qcow2 as that is much smaller (in the order of 700 MB for qcow2 vs. the 10 GB as specified above) and also supports additional features such as snapshots or compression. You can run that command with setting the environment variable <strong>ADT_APT_PROXY</strong> to a proxy which will be used by apt in the VM. If you have apt-cacher-ng installed on the host, this will be used automatically; otherwise you can run e. g.</p>
<pre>
ADT_APT_PROXY=http://10.0.2.2:8080 vmdebootstrap [...]
</pre>

<h3>Ubuntu</h3>
<p>For Ubuntu, autopkgtest provides <a href="../man1/adt-buildvm-ubuntu-cloud.1.html"><strong>adt-buildvm-ubuntu-cloud</strong>(1)</a> to build a VM based on the Ubuntu cloud images. To create an image for the current development series and the i386 architecture:</p>
<pre>
adt-buildvm-ubuntu-cloud -v -a i386
</pre>
<p>This will produce e. g. <strong>adt-trusty-i386-cloud.img</strong>.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Run the tests of the libpng source package, using an Ubuntu cloud image:</p>
<pre>
adt-run libpng --- adt-virt-qemu adt-trusty-i386-cloud.img
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO adt-virt-qemu&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/adt-run.1.html"><strong>adt-run</strong>(1)</a>, <a href="../man1/adt-virt-schroot.1.html"><strong>adt-virt-schroot</strong>(1)</a>, <a href="../man1/adt-virt-lxc.1.html"><strong>adt-virt-lxc</strong>(1)</a>, <a href="../man1/adt-buildvm-ubuntu-cloud.1.html"><strong>adt-buildvm-ubuntu-cloud</strong>(1)</a>, <a href="../man8/vmdebootstrap.8.html"><strong>vmdebootstrap</strong>(8)</a>, <strong>/usr/share/doc/autopkgtest/</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS AND COPYRIGHT</h2>
        <div class="sectioncontent">
<p><strong>adt-virt-qemu</strong> was written by Martin Pitt &lt;martin.pitt@ubuntu.com&gt;</p><p>This manpage is part of autopkgtest, a tool for testing Debian binary packages.  autopkgtest is Copyright (C) 2006-2014 Canonical Ltd and others.</p><p>See <strong>/usr/share/doc/autopkgtest/CREDITS</strong> for the list of contributors and full copying conditions.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="adt-virt-null.1.html"><span aria-hidden="true">&larr;</span> adt-virt-null.1: Autopkgtest null virtualisation server</a></li>
   <li class="next"><a href="adt-virt-schroot.1.html">adt-virt-schroot.1: Autopkgtest virtualisation server using a schroot <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
