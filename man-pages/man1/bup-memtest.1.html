<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>bup-memtest: Test bup memory usage statistics</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Test bup memory usage statistics">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="bup-memtest (1) manual">
  <meta name="twitter:description" content="Test bup memory usage statistics">
  <meta name="twitter:image" content="https://www.carta.tech/images/bup-doc-bup-memtest-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/bup-memtest.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="bup-memtest (1) manual" />
  <meta property="og:description" content="Test bup memory usage statistics" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/bup-doc-bup-memtest-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">bup-memtest<small> (1)</small></h1>
        <p class="lead">Test bup memory usage statistics</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/bup-memtest.1.html">
      <span itemprop="name">bup-memtest: Test bup memory usage statistics</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/bup-doc/">
      <span itemprop="name">bup-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/bup-memtest.1.html">
      <span itemprop="name">bup-memtest: Test bup memory usage statistics</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>bup memtest [options...]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>bup&nbsp;memtest opens the list of pack indexes in your bup repository, then searches the list for a series of nonexistent objects, printing memory usage statistics after each cycle.</p><p>Because of the way Unix systems work, the output will usually show a large (and unchanging) value in the VmSize column, because mapping the index files in the first place takes a certain amount of virtual address space. However, this virtual memory usage is entirely virtual; it doesn\[aq]t take any of your RAM. Over time, bup uses <em>parts</em> of the indexes, which need to be loaded from disk, and this is what causes an increase in the VmRSS column.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-n, --number=</strong><em>number</em></p>
  </dt>
  <dd>
    <p>set the number of objects to search for during each cycle (ie. before printing a line of output)</p>
  </dd>
  <dt>
    <p><strong>-c, --cycles=</strong><em>cycles</em></p>
  </dt>
  <dd>
    <p>set the number of cycles (ie. the number of lines of output after the first). The first line of output is always 0 (ie. the baseline before searching for any objects).</p>
  </dd>
  <dt>
    <p><strong>--ignore-midx</strong></p>
  </dt>
  <dd>
    <p>ignore any .midx files created by bup&nbsp;midx. This allows you to compare memory performance with and without using midx.</p>
  </dd>
  <dt>
    <p><strong>--existing</strong></p>
  </dt>
  <dd>
    <p>search for existing objects instead of searching for random nonexistent ones. This can greatly affect memory usage and performance. Note that most of the time, bup&nbsp;save spends most of its time searching for nonexistent objects, since existing ones are probably in unmodified files that we won\[aq]t be trying to back up anyway. So the default behaviour reflects real bup performance more accurately. But you might want this option anyway just to make sure you haven\[aq]t made searching for existing objects much worse than before.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<ul>
<li>
<pre>
$&nbsp;bup&nbsp;memtest&nbsp;-n300&nbsp;-c5
PackIdxList:&nbsp;using&nbsp;1&nbsp;index.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmRSS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmStk &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;20824&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;4528&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1980&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;300&nbsp;&nbsp;&nbsp;&nbsp;20828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;5828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1984&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;600&nbsp;&nbsp;&nbsp;&nbsp;20828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;6844&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1984&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;900&nbsp;&nbsp;&nbsp;&nbsp;20828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;7836&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1984&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1200&nbsp;&nbsp;&nbsp;&nbsp;20828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;8736&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1984&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1500&nbsp;&nbsp;&nbsp;&nbsp;20828&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;9452&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;1984&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB 
$&nbsp;bup&nbsp;memtest&nbsp;-n300&nbsp;-c5&nbsp;--ignore-midx
PackIdxList:&nbsp;using&nbsp;361&nbsp;indexes.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmRSS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VmStk &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;27444&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;6552&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2516&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;300&nbsp;&nbsp;&nbsp;&nbsp;27448&nbsp;kB&nbsp;&nbsp;&nbsp;15832&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2520&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;600&nbsp;&nbsp;&nbsp;&nbsp;27448&nbsp;kB&nbsp;&nbsp;&nbsp;17220&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2520&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;900&nbsp;&nbsp;&nbsp;&nbsp;27448&nbsp;kB&nbsp;&nbsp;&nbsp;18012&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2520&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1200&nbsp;&nbsp;&nbsp;&nbsp;27448&nbsp;kB&nbsp;&nbsp;&nbsp;18388&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2520&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1500&nbsp;&nbsp;&nbsp;&nbsp;27448&nbsp;kB&nbsp;&nbsp;&nbsp;18556&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;2520&nbsp;kB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;84&nbsp;kB 
</pre>
</li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DISCUSSION</h2>
        <div class="sectioncontent">
<p>When optimizing bup indexing, the first goal is to keep the VmRSS reasonably low. However, it might eventually be necessary to swap in all the indexes, simply because you\[aq]re searching for a lot of objects, and this will cause your RSS to grow as large as VmSize eventually.</p><p>The key word here is <em>eventually</em>. As long as VmRSS grows reasonably slowly, the amount of disk activity caused by accessing pack indexes is reasonably small. If it grows quickly, bup will probably spend most of its time swapping index data from disk instead of actually running your backup, so backups will run very slowly.</p><p>The purpose of bup&nbsp;memtest is to give you an idea of how fast your memory usage is growing, and to help in optimizing bup for better memory use. If you have memory problems you might be asked to send the output of bup&nbsp;memtest to help diagnose the problems.</p><p>Tip: try using bup&nbsp;midx&nbsp;-a or bup&nbsp;midx&nbsp;-f to see if it helps reduce your memory usage.</p><p>Trivia: index memory usage in bup (or git) is only really a problem when adding a large number of previously unseen objects. This is because for each object, we need to absolutely confirm that it isn\[aq]t already in the database, which requires us to search through <em>all</em> the existing pack indexes to ensure that none of them contain the object in question. In the more obvious case of searching for objects that <em>do</em> exist, the objects being searched for are typically related in some way, which means they probably all exist in a small number of packfiles, so memory usage will be constrained to just those packfile indexes.</p><p>Since git users typically don\[aq]t add a lot of files in a single run, git doesn\[aq]t really need a program like bup&nbsp;midx. bup, on the other hand, spends most of its time backing up files it hasn\[aq]t seen before, so its memory usage patterns are different.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO bup-memtest&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/bup-midx.1.html"><strong>bup-midx</strong>(1)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUP</h2>
        <div class="sectioncontent">
<p>Part of the <a href="../man1/bup.1.html"><strong>bup</strong>(1)</a> suite.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Avery Pennarun &lt;apenwarr@gmail.com&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="bup-margin.1.html"><span aria-hidden="true">&larr;</span> bup-margin.1: Figure out your deduplication safety margin</a></li>
   <li class="next"><a href="bup-meta.1.html">bup-meta.1: Create or extract a metadata archive <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
