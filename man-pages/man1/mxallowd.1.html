<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mxallowd: Dynamically whitelist your mail exchanger</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Dynamically whitelist your mail exchanger">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mxallowd (1) manual">
  <meta name="twitter:description" content="Dynamically whitelist your mail exchanger">
  <meta name="twitter:image" content="https://www.carta.tech/images/mxallowd-mxallowd-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/mxallowd.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mxallowd (1) manual" />
  <meta property="og:description" content="Dynamically whitelist your mail exchanger" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mxallowd-mxallowd-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mxallowd<small> (1)</small></h1>
        <p class="lead">Dynamically whitelist your mail exchanger</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mxallowd.1.html">
      <span itemprop="name">mxallowd: Dynamically whitelist your mail exchanger</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mxallowd/">
      <span itemprop="name">mxallowd</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/mxallowd.1.html">
      <span itemprop="name">mxallowd: Dynamically whitelist your mail exchanger</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mxallowd</strong> [\|-d\|] [\|-c <em>configfile</em>\|] [\|-t <em>whitelist-time</em>\|] [\|-p <em>pflog-interface</em>\|] [\|-l <em>pcap-filter</em>\|] [\|-F\|] [\|-s\|] [\|-q\|] [\|-p\|] \|-f <em>fake-mailserver</em>\| \|-r <em>real-mailserver</em>\| \|-n <em>queue-num</em>\|</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>mxallowd</strong> is a daemon which uses libnetfilter_queue (on Linux) or pf and pflog (on BSD) to allow (or deny) connections to a mailserver (or similar application) if the remote host hasn't connected to a fake daemon before.</p><p>This is an improved version of the so-called nolisting (see http://www.nolisting.org/). The assumption is that spammers are not using RFC 2821-compatible SMTP-clients and are sending fire-and-forget spam (directly to the first or second MX-entry without retrying on error). This direct access is blocked with mxallowd, you'll only get a connection if you retry.</p><p>NOTE: It is highly recommended to install nscd (nameserver caching daemon) or a similar software in order to speed-up DNS lookups. Since version 1.3, DNS lookups are done in a thread (so they don't block the main process), however, on very-high-traffic-sites, mxallowd may show significantly better overall performance in combination with nscd.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-b, --no-rdns-whitelist</strong></p>
  </dt>
  <dd>
    <p>Disable whitelisting all IP-addresses that have the same RDNS as the connecting one (necessary for google mail)</p>
  </dd>
  <dt>
    <p><strong>-c, --config</strong></p>
  </dt>
  <dd>
    <p>Specifies an alternative configuration file (instead of /etc/mxallowd.conf)</p>
  </dd>
  <dt>
    <p><strong>-t, --whitelist-time</strong></p>
  </dt>
  <dd>
    <p>Specify the amount of time (in seconds) until an IP-address will be removed from the whitelist</p>
  </dd>
  <dt>
    <p><strong>-s, --stdout</strong></p>
  </dt>
  <dd>
    <p>Log to stdout, not to syslog</p>
  </dd>
  <dt>
    <p><strong>-q, --quiet</strong></p>
  </dt>
  <dd>
    <p>Don't log anything but errors.</p>
  </dd>
  <dt>
    <p><strong>-f, --fake-mailserver</strong></p>
  </dt>
  <dd>
    <p>Specify which IP-address the fake mailserver has (connecting to it will whitelist you for the real mailserver)</p>
  </dd>
  <dt>
    <p><strong>-r, --real-mailserver</strong></p>
  </dt>
  <dd>
    <p>Specify which IP-address the real mailserver has</p>
  </dd>
  <dt>
    <p><strong>-F, --foreground</strong></p>
  </dt>
  <dd>
    <p>Do not fork into background, stay on console</p>
  </dd>
  <dt>
    <p><strong>-n, --queue-num (only available when compiled for netfilter_queue)</strong></p>
  </dt>
  <dd>
    <p>Specify the queue number which will be used for the netfilter_queue-link. This has to be the same which is specified in the iptables-rule and it has to be specified, there is no default.</p>
  </dd>
  <dt>
    <p><strong>-p, --pflog-interface (only available when compiled for pf)</strong></p>
  </dt>
  <dd>
    <p>Specify the <strong>pflog</strong>(4) interface which you configured in pf(4). The default is pflog0. Also see the pcap-filter-option if you use an interface which does not only get smtp-traffic.</p>
  </dd>
  <dt>
    <p><strong>-l, --pcap-filter (only available when compiled for pf)</strong></p>
  </dt>
  <dd>
    <p>Specify the filter for pcap. The default is "port 25". See <a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a> for more information on the filters.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>/etc/mxallowd.conf</strong></p>
  </dt>
  <dd>
    <p>System-wide configuration file. Use the long options without the beginning two dashes. For example:</p>
<pre>
	stdout
	fake-mailserver 192.168.1.3
	fake-mailserver 192.168.1.4
	real-mailserver 192.168.1.5
	queue-num 23
</pre>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES FOR NETFILTER</h2>
        <div class="sectioncontent">
<p>The machine has two IP-addresses. The mailserver only listens on 192.168.1.4, the nameserver returns the mx-records mx1.domain.com (192.168.1.3) with priority 5 and mx2.domain.com (192.168.1.4) with priority 10.</p><p># modprobe nfnetlink_queue # iptables -A INPUT -p tcp --dport 25 -m state --state NEW -j NFQUEUE --queue-num 23 # mxallowd -s -F -f 192.168.1.3 -r 192.168.1.4 -n 23</p><p>Then open a separate terminal and connect via telnet on your real mailserver. You'll see the connection attempt being dropped. Now connect to the fake mailserver and watch mxallowd's output. Afterwards, connect to the real mailserver to verify your mailserver is still working.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES FOR PF</h2>
        <div class="sectioncontent">
<p>The machine has two IP-addresses. The mailserver only listens on 192.168.1.4, the nameserver returns the mx-records mx1.domain.com (192.168.1.3) with priority 5 and mx2.domain.com (192.168.1.4) with priority 10.</p><p>Create a pf.conf like this:</p><p>	table &lt;mx-white&gt; persist</p><p>	real_mailserver="192.168.1.4" 	fake_mailserver="192.168.1.3"</p><p>	real_mailserver6="2001:dead:beef::1" 	fake_mailserver6="2001:dead:beef::2"</p><p>	pass in quick log on fxp0 proto tcp from &lt;mx-white&gt; to $real_mailserver port smtp 	pass in quick log on fxp0 inet6 proto tcp from &lt;mx-white&gt; to $real_mailserver6 port smtp 	block in log on fxp0 proto tcp to { $fake_mailserver $real_mailserver } port smtp 	block in log on fxp0 inet6 proto tcp to { $fake_mailserver6 $real_mailserver6 } port smtp</p><p>Afterwards, load it and start mxallowd using the following commands:</p><p># pfctl -f /etc/pf.conf # mxallowd -s -F -f 192.168.1.3 -r 192.168.1.4</p><p>Then open a separate terminal and connect via telnet on your real mailserver. You'll see the connection attempt being dropped. Now connect to the fake mailserver and watch mxallowd's output. Afterwards, connect to the real mailserver to verify your mailserver is still working.</p><p>The ruleset for pf is actually longer because pf does more than netfilter on linux -- netfilter passes the packets and lets mxallowd decide whether to drop/accept whilst pf blocks/passes before even "passing" to mxallowd.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mxallowd&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/iptables.8.html"><strong>iptables</strong>(8)</a>, <strong>pf</strong>(4), <strong>pflog</strong>(4), <a href="../man8/tcpdump.8.html"><strong>tcpdump</strong>(8)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Michael Stapelberg &lt;michael+mxallowd at stapelberg dot de&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mx-create-image-cache.1.html"><span aria-hidden="true">&larr;</span> mx-create-image-cache.1: Mx-create-image-cache  program to make a cache of a directory</a></li>
   <li class="next"><a href="mxmldoc.1.html">mxmldoc.1: Mini-xml documentation generator <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
