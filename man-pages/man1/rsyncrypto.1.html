<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>rsyncrypto: Rsync friendly encryption</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Rsync friendly encryption">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="rsyncrypto (1) manual">
  <meta name="twitter:description" content="Rsync friendly encryption">
  <meta name="twitter:image" content="https://www.carta.tech/images/rsyncrypto-rsyncrypto-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/rsyncrypto.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="rsyncrypto (1) manual" />
  <meta property="og:description" content="Rsync friendly encryption" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/rsyncrypto-rsyncrypto-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">rsyncrypto<small> (1)</small></h1>
        <p class="lead">Rsync friendly encryption</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rsyncrypto.1.html">
      <span itemprop="name">rsyncrypto: Rsync friendly encryption</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/rsyncrypto/">
      <span itemprop="name">rsyncrypto</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rsyncrypto.1.html">
      <span itemprop="name">rsyncrypto: Rsync friendly encryption</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>rsyncrypto</strong> [<em>options</em>]<em> srcfile dstfile keyfile key</em></p><p><strong>rsyncrypto</strong> [<em>options</em>]<em> </em><strong>-r</strong><em> srcdir dstdir keysdir key</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This manual page documents the <strong>rsyncrypto</strong> command.</p><p><strong>rsyncrypto</strong> is a utility that encrypts a file (or a directory structure) in a way that ensures that local changes to the plain text file will result in local changes to the cipher text file. This, in turn, ensures that doing <strong>rsync</strong> to synchronize the encrypted files to another machine will have only a small impact on <strong>rsync</strong>'s efficiency.</p><p><strong>rsyncrypto</strong> will encrypt files using a symmetric block cipher (AES). Each file is encrypted using a unique key. The file key is stored in two locations. One is the "<em>key</em>" file, and the second is inside the encrypted file itself. The second copy is encrypted using a RSA public key, which can be shared for all encrypted files.</p><p>Decrypting the file can take place in one of two forms:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>Warm Decryption</strong></p>
  </dt>
  <dd>
    <p><em>keyfile</em> is used to decrypt <em>srcfile</em> into <em>dstfile</em>.</p>
  </dd>
  <dt>
    <p><strong>Cold Decryption</strong></p>
  </dt>
  <dd>
    <p>If <em>keyfile</em> is lost and <em>key</em> is the <strong>private</strong> key for the RSA encryption, extract and create <em>keyfile</em> from the encrypted <em>srcfile</em>, and create both <em>keyfile</em> and <em>dstfile</em>.</p>
  </dd>

</dl>
<p>If both <em>keyfile</em> and the private key are not available, decryption cannot take place. Typically, this means that you would either want to transfer the encrypted files in whatever way (secure or insecure, but probably <strong>rsync</strong> :), and keep the plain text file, as well as the key file, secure. As long as you saved the RSA private key, you can reconstruct them both.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PARAMETERS</h2>
        <div class="sectioncontent">
<p>The parameters meaning depend on the existence of the <em>-r</em> and <em>-d</em> flags.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>srcfile</em> or <em>srcdir</em></p>
  </dt>
  <dd>
    <p>This is the source for the operation. This will be the plain text file for encryption, and the cipher text file for decryption. If the <em>-r</em> option is given, <em>srcdir</em> is the directory from which files are to be encrypted/decrypted. Otherwise, <em>srcfile</em> is the file to be encrypted/decrypted. In any case, <em>src</em> must exist prior to running <strong>rsyncrypto</strong>.</p>
  </dd>
  <dt>
    <p><em>dstfile</em> or <em>dstdir</em></p>
  </dt>
  <dd>
    <p>Similar to <em>src</em>, this is the destination of the operation. It will be the plain text to be created if <em>-d</em> was given, or the encrypted file otherwise.</p>
  </dd>
  <dt>
    <p><em>keyfile</em> or <em>keydir</em></p>
  </dt>
  <dd>
    <p>The file holding the symmetric key for the encryption, or a directory in which symmetric key files reside. If the later, the key files will have the same name as the plain text files.</p>
  </dd>
  <dt>
    <p><em>key</em></p>
  </dt>
  <dd>
    <p>This file can either be a X509 certificate holding a public key, or a PEM format private key. The private key is never needed unless a cold decryption is required. See the <strong>req</strong>(1) or <strong>x509</strong>(1) manual pages for more info.</p>
  </dd>

</dl>
<p>If <em>dst</em> does not exist, it will be created. The directory in which it is to be created must exist prior to running <strong>rsyncrypto</strong>.</p><p>If encrypting, and a symmetric key for the file is found, the same parameters will be used for the encryption unless the <em>--fr</em> or <em>--fk</em> options are used. If that's the case, the key file is going to be replaced with the correct parameters.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>These programs follow the usual GNU command line syntax, with long options starting with two dashes (`-').</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-h</strong>, <strong>--help</strong></p>
  </dt>
  <dd>
    <p>Show summary of options.</p>
  </dd>
  <dt>
    <p><strong>-V</strong>, <strong>--version</strong></p>
  </dt>
  <dd>
    <p>Print out the current version number.</p>
  </dd>
  <dt>
    <p><strong>-d</strong>, <strong>--decrypt</strong></p>
  </dt>
  <dd>
    <p>Decrypt <em>src</em> into <em>dst</em>. The default behavior is to encrypt <em>src</em> into <em>dst</em>, and create <em>keyfile</em> if it does not exist.</p>
  </dd>
  <dt>
    <p><strong>-r</strong>, <strong>--recurse</strong></p>
  </dt>
  <dd>
    <p>Recursively encrypt/decrypt an entire directory structure. All files under <em>srcdir</em> will be encrypted to files of the same name and path (almost, see <em>--trim</em>) under <em>dstdir</em>. If not already there, a key file will be created for each file under <em>keydir</em>.</p>
  </dd>
  <dt>
    <p><strong>--filelist</strong></p>
  </dt>
  <dd>
    <p>The first argument is a pointer to a file (or "-" for stdin) that has a list of files to process. Any name ending with a "/" is taken to be a directory in recursive mode, and any other name is a file name. The second argument is a directory where the files are encrypted to. --filelist and -r are mutually exclusive.</p>
  </dd>
  <dt>
    <p><strong>-c</strong>, <strong>--changed</strong></p>
  </dt>
  <dd>
    <p>Check the src and destination modified time (see --modify-window) prior to performing the operation. If the modified time is the same, assume that the files are also the same, and skip the operation. Notice that unlike <strong>rsync</strong>, file sizes are not compared. This is because the file size is expected to change during the encryption (and thus decryption) operation.</p>
  </dd>
  <dt>
    <p><strong>--risky-writes</strong></p>
  </dt>
  <dd>
    <p>Usually, when rsyncrypto writes a file, it uses a temporary name and moves the file to its final name when successfully done. This serves two purposes.  During encryption, this prevents the false sense of security that may arise in case of an rsyncrypto interruption by preventing a partial file from being present (and in case of an update, by keeping the old backup). This also ensures that restarting rsyncrypto will enable it to correctly detect whether the operation needs to be repeated. During decryption, this prevents overwriting a file until we are certain we can decrypt its source.</p><p>The main problem with this approach is that, if the file being written is large, the file system needs to have enough space for two copies of it for the duration of the operation. Also, if hard links are maintained, the default rsyncrypto behavior will break the link.</p><p>Specify <strong>--risky-writes</strong> to make rsyncrypto directly overwrite the existing file using the final name.</p>
  </dd>
  <dt>
    <p><strong>--modify-window=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Only applicable when <strong>-c</strong> is in effect. When comparing file modification times, treat as equal modification times that are <em>num</em> seconds apart. Default value is zero.</p><p>This option is most useful when the encrypted file is stored on a FAT file system. FAT can only store modification time with a 2 seconds accuracy. This may result in the modification time changing between original and encrypted file. In such a case, <strong>--modify-window=1</strong> should be used.</p>
  </dd>
  <dt>
    <p><strong>--export-changes=</strong><em>logfile</em></p>
  </dt>
  <dd>
    <p>Whenever encrypting or deleting a file, write the file's name to <em>logfile</em>. This allows passing <em>logfile</em> to <a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a> using the <strong>--include-from</strong> rsync option.</p><p>This option is mostly useful if <strong>rsyncrypto</strong> is used to repeatedly encrypt a huge directory tree, and then using rsync to synchronize it remotely. The use of this option allows focusing <strong>rsync</strong> on only those files that are known to have changed, rather than have it send the entire file list to the remote machine, making the rsync operation faster. It should be noted that rsync version 3 starts the actual file transfer while it is still transferring the file list, making the performance gain from this option less noticeable.</p><p>When using this option in conjunction with rsync, keep in mind that <em>logfile</em> is zeroed out before being written into. This means that unless there is at least one completely successful rsync operation for each rsyncrypto invocation, it is possible to have files that have been changed on disk by a previous invocation of rsyncrypto, but were over written by a later invocation and do not show up in the latest version of <em>logfile</em>. In other words, if rsyncrypto is run more than once between two completely successful invocations of rsync, it is possible for <em>logfile</em> not to be complete. <strong>Use this option at your own risk!</strong></p><p>It is highly recommended that you upgrade to rsync version 3 or higher rather than rely on this option.</p>
  </dd>
  <dt>
    <p><strong>-n</strong>, <strong>--name-encrypt=</strong><em>translation_file</em></p>
  </dt>
  <dd>
    <p>Encrypt the file name. If this option is specified, this means that file names are encrypted as well. This is done by changing the name of the encrypted file to a random string of characters, and storing the translation in the file given as parameter. If working in recursive mode, this file is automatically also included in the encryption, and is given the fixed name "filemap". This is done so that decryption of the file names is possible when the symmetric keys are lost.</p>
  </dd>
  <dt>
    <p><strong>--ne-nesting=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>When the --name-encrypt option is used, by default all mangled file names are stored in a single directory. When encrypting large directory trees, this can result in rather big directories. Using "--ne-nesting" will split the files to sub directories, according to random bits that are part of the encrypted file name. "n" is the number of directories to nest.</p>
  </dd>
  <dt>
    <p><strong>--trim=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Determine how many directory levels to trim from the beginning of the <em>srcdir</em> path when creating directories under <em>dstdir</em>. The default value is 1. See <strong>THE TRIM OPTION</strong> for more details.</p>
  </dd>
  <dt>
    <p><strong>--delete</strong></p>
  </dt>
  <dd>
    <p>When in recursive mode, delete files and directories under <em>dstdir</em> that do not exist under <em>srcdir</em>.</p>
  </dd>
  <dt>
    <p><strong>--delete-keys</strong></p>
  </dt>
  <dd>
    <p>When deleting files, also delete their symmetric key and file name mapping (if applicable). When only <strong>--delete</strong> is used, the symmetric key and file mapping are kept, so that if the file is recreated, it will be rsyncable with the original file. This option implies <strong>--delete</strong>.</p>
  </dd>
  <dt>
    <p><strong>-b</strong><em>num</em><strong> --keybits=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Specify the block cipher's key size. For AES, these can be 128, 192 or 256. Note that unless the <em>--fr</em> or <em>--fk\P options are also specified, this</em> will only affect files for which no <em>keyfile</em> exists.</p>
  </dd>
  <dt>
    <p><strong>--noatime=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>(Only on some platforms, most notably Linux). The platform usually keeps track of when files were last being accessed. Since <strong>rsyncrypto</strong> is typically used for backup, it opens the files it encrypts with the O_NOATIME option, which is a Linux specific extension that tells the system not to update the file's access time. When opening a file where the opening process is not owned by the file owner, an attempt to open the file with O_NOATIME will cause the open to fail with "permission denied".</p><p><em>num</em> can be one of these options: <strong>0</strong> means do not use O_NOATIME at all. <strong>1</strong> (the default) means attempt to only use O_NOATIME if <strong>rsyncrypto</strong> thinks it will not cause a permission denied error. <strong>2</strong> means to use O_NOATIME always.</p>
  </dd>
  <dt>
    <p><strong>--no-archive-mode</strong></p>
  </dt>
  <dd>
    <p>Do not try to preserve timestamps. This option is incompatible with <strong>-c</strong>.</p>
  </dd>
  <dt>
    <p><strong>--gzip=</strong><em>path</em></p>
  </dt>
  <dd>
    <p>By default, <strong>rsyncrypto</strong> will compress the plain text prior to encrypting it. In order not to become rsync unfriendly due to the compression, <strong>rsyncrypto</strong> will search the path for an instance of <a href="../man1/gzip.1.html"><strong>gzip</strong>(1)</a> that supports the <em>--rsyncable</em> option. If the system's default gzip does not support this option (all Debian and derivatives, as well as some others, support it), use this option to tell <strong>rsyncrypto</strong> to use a different instance of gzip. The tests directory of rsyncrypto's source has a file called "gzip", that does NULL compression by redirecting the input and output to <a href="../man1/cat.1.html"><strong>cat</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong></strong><strong>--roll-win=</strong><em>num</em><strong>, </strong><strong>--roll-min=</strong><em>num</em><strong>, </strong><strong>--roll-sensitivity=</strong><em>num</em></p>
  </dt>
  <dd>
    <p>Affects the rolling block algorithm. See <strong>NOTES</strong>.</p>
  </dd>
  <dt>
    <p><strong>--fk</strong>, <strong>--fr</strong></p>
  </dt>
  <dd>
    <p>If command line, or a version with different defaults, dictate different values for the <em>--roll-*</em> options or the <em>-b</em> option, these will only affect files for which <em>keyfile</em> does not yet exist. specifying the <em>--fk</em> or <em>--fr</em> will recreate <em>keyfile</em> if it has values different than those in the previous key file.</p>
  </dd>
  <dt>
    <p><strong>-v</strong>, <strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>Increase verbosity level. Specify several times to be more verbose.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p><strong>encrypting stdin</strong></p><p>If <em>srcfile</em> is given as `-', the plain text data will be read fro stdin. This does not yet work for decompression (see <strong>BUGS</strong>).</p><p><strong>--roll-win</strong>=num, <strong>--roll-min</strong>=num, <strong>--roll-sensitivity</strong>=num</p><p>These values affect some of the inner workings of <strong>rsyncrypto</strong>'s decision making.  In particular, these affect how <strong>rsyncrypto</strong> decides when to revert to the IV.</p><p>These options should not be played with unless you understand what you are doing. They are not dangerous, in that they will never cause data loss. Any value should still allow decryption of the file. They do have an affect on <strong>rsync</strong>'s efficiency.</p><p>These options are only there to allow quick response in case a security problem pops up with their default values. If that happens, an advisory may come out giving new values to fill in as a workaround. Until that happens, most users are advised to leave these options alone.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">THE TRIM OPTION</h2>
        <div class="sectioncontent">
<p>When running <strong>rsyncrypto</strong> in recursive mode, the directory structure under <em>srcdir</em> is re-created under <em>dstdir</em>, with one directory stripped from the path. In other words, if we have a directory structure which has:</p><p>a/b/c/file</p><p>running <strong>rsyncrypto</strong> with <em>srcdir</em> of "a/b", and <em>dstdir</em> of "f" will create "f/b/c/file".</p><p>The <em>--trim</em> options lets the user say how many parts to trim from <em>srcdir</em> when creating directories under <em>dstdir</em> and <em>keydir</em>. If, in the above example, we said <em>--trim</em>=0 then "f/a/b/c/file" would have been created. Likewise, if we said <em>--trim</em>=2 then "f/c/file" would have been created.</p><p>It is an error to give a trim value which is higher than the number of directory parts actually in <em>srcdir</em>. In the above example, <em>--trim</em>=3 would result in an error.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY</h2>
        <div class="sectioncontent">
<p>The roll values affect, to a not totally known degree, how much information is "leaked" between plain text and cipher text. The default values are supposed to leak less than 20 bits of aggregated information about the plain text file for every 8KB, in the worst case. These values, we hope, will be considered secure enough for most usages. However, if your country's fate is at stake, use a non-rsync optimized encryption, such as the one provided by <strong>openssl</strong>(1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES AND TUTORIAL</h2>
        <div class="sectioncontent">
<p>Before starting to use rsyncrypto you will need a public key in X509 certificate format. The quickest way to generate one of these is using the <strong>openssl</strong>(1) package. To generate a new 1536 bit RSA key as "backup.key", and store the corresponding unencrypted public key in "backup.crt", use the following command:</p><p>openssl req -nodes -newkey rsa:1536 -x509 -keyout backup.key -out backup.crt</p><p>It does not matter what you answer for the certificate details, or when you set it to expire. Rsyncrypto ignores everything in the certificate but the actual key.</p><p>To encrypt file "data" into "data.enc", storing the file's specific key at "data.key", run:</p><p>rsyncrypto data data.enc data.key backup.crt</p><p>Anywhere in these examples that "backup.crt" is used, "backup.key" can be used as well. The above could also have "backup.key" as the last argument. If these examples list "backup.key" specifically, then it means that "backup.crt" <strong>cannot</strong> be used instead.</p><p>"data.enc" will be created. If "data.key" exists from a previous run, then the newly created "data.enc" will have the same symmetric key and other attributes, thus maintaining the rsync friendliness of the encryption. It is therefor important to provide any previous key file for the data if one is available.</p><p>The command line to decrypt the file depends on whether you have the key file used when the file was encrypted. If you do, then decryption can take place using only the public key, with the following command:</p><p>rsyncrypto -d data.enc data.dec data.key backup.crt</p><p>If the key file was lost, the private key must be used to recover it from the encrypted file using the following command:</p><p>rsyncrypto -d data.enc data.dec data.key backup.key</p><p>"data.key" will be created by the above command, as well as "data.dec".</p><p>Use of rsyncrypto to encrypt whole directories is similar, with directory names replacing file names in the above example. To encrypt the content of a directory called "data" to a directory called "enc", storing the symmetric keys in a directory called "keys", run the following command:</p><p>rsyncrypto -r data enc keys backup.crt</p><p>As before the directories "enc" and "keys" will be created if they do not already exist. The directory structure under "plain" will be duplicated under "enc" and under "keys". That is, if there is a file called "foo" under "data", an encrypted files called "foo" will be created under "enc", and a key file named "foo" will be created under "keys". In other words, the first part of the path to "data/foo" (the part that says "data") is eliminated from the path, and this determines the name of the files under "enc" and "keys".</p><p>If a different trimming is required, the --trim option can be used. To have rsyncrypto create "enc/data/foo" instead of the above, use the following command:</p><p>rsyncrypto -r --trim=0 data enc keys backup.crt</p><p>Instead of taking all files from a single directory, it is possible to supply rsyncrypto with a list of files and directories which to encrypt. This is done using the --filelist option, like so:</p><p>rsyncrypto --filelist --trim=0 list enc keys backup.crt</p><p>"enc" and "keys" retain the same meaning as before. "list" is a text file with a list, one per line, of files to encrypt. The --trim=0 option says that if list contains a line saying "/home/foo/bar" which states the name of a file, then an encrypted file called "enc/home/foo/bar" will be created. Without it, the file will be called "enc/foo/bar". Likewise, with --trim=2, the file would be created as "enc/bar".</p><p>It is often a problem that the file names are not encrypted. If that is the case, we can ask rsyncrypto to encrypt the file names, as well as the actual files. Rsyncrypto does not actually encrypt the file names. Instead, it replaces the actual file name with a random series of characters. The mapping between the actual file name and the garbled name is stored in a mapping file.</p><p>rsyncrypto --name-encrypt=map --trim=0 -r plain enc keys backup.crt</p><p>This will encrypt the "plain" directory structure into enc, exactly as before. Unlike before, all files will be directly under the "enc" directory, and will be named as a meaningless garble. A file called "map" will be created under the current directory that contains a map between the gabled and the real name of the file. In addition, two files, called "enc/filemap" and "keys/filemap", will also be created. These are the encrypted and key file corresponding to the "map" file mentioned above. During decryption, if "map" does not exist, it will be created by decrypting "enc/filemap".</p><p><strong>Important note:</strong> When performing file name encryption, it is vitally important to give the correct --trim values, both during encryption and during decryption. Failing to do so will cause rsyncrypto to search for non-existing file names, and to fail to locate the files to decrypt.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>It is not yet possible to decrypt using password protected private key.</p><p>Decrypting from stdin is not yet supported.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO rsyncrypto&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>, <a href="../man1/gzip.1.html"><strong>gzip</strong>(1)</a>, <strong>openssl</strong>(1), <strong>x509</strong>(1), <strong>req</strong>(1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>rsyncrypto was written by Shachar Shemesh for Lingnu Open Source Consulting ltd. http://www.lingnu.com</p><p>This manual page was written by Shachar Shemesh &lt;shachar@debian.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROJECT HOMEPAGE</h2>
        <div class="sectioncontent">
<p>http://rsyncrypto.lingnu.com</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="rsync.1.html"><span aria-hidden="true">&larr;</span> rsync.1: A fast, versatile, remote (and local) file-copying tool</a></li>
   <li class="next"><a href="rsyncrypto_recover.1.html">rsyncrypto_recover.1: Recover all usable data from corrupted rsyncrypto filemaps <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
