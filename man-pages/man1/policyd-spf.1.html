<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>policyd-spf: Pure-python postfix policy daemon for spf checking</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Pure-python postfix policy daemon for spf checking">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="policyd-spf (1) manual">
  <meta name="twitter:description" content="Pure-python postfix policy daemon for spf checking">
  <meta name="twitter:image" content="https://www.carta.tech/images/postfix-policyd-spf-python-policyd-spf-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/policyd-spf.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="policyd-spf (1) manual" />
  <meta property="og:description" content="Pure-python postfix policy daemon for spf checking" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/postfix-policyd-spf-python-policyd-spf-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">policyd-spf<small> (1)</small></h1>
        <p class="lead">Pure-python postfix policy daemon for spf checking</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/policyd-spf.1.html">
      <span itemprop="name">policyd-spf: Pure-python postfix policy daemon for spf checking</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/postfix-policyd-spf-python/">
      <span itemprop="name">postfix-policyd-spf-python</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/policyd-spf.1.html">
      <span itemprop="name">policyd-spf: Pure-python postfix policy daemon for spf checking</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">VERSION</h2>
        <div class="sectioncontent">
<p>1.3</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USAGE</h2>
        <div class="sectioncontent">
<p>NOTE: Depending on the packaging and distribution, the exact path to the executable may vary.</p><p>$ policyd-spf (Start using installed config file)</p><p>$ policyd-spf -h (Display usage message)</p><p>$ policyd-spf /etc/postfix-policyd-spf-python/policyd-spf.conf</p>
<pre>
  (Config file name to use)
</pre>
<p>Configuration options are described in the sample configuration file installed in /usr/share/doc/postfix-policyd-spf-python (policyd-spf.conf.commented) and in <a href="../man5/policyd-spf.conf.5.html"><strong>policyd-spf.conf</strong>(5)</a>.  The provided setup.py installs an uncommented configuration file in /etc/postfix-policyd-spf-python/.</p><p>Additionally, whitelisting certain IP addresses or IP addresses used by listed domains from SPF checks is supported.  Skipping SPF checks for local submission or trusted relays is also provided.  The sample configuration file and <a href="../man5/policyd-spf.conf.5.html"><strong>policyd-spf.conf</strong>(5)</a> shows the format to use.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OTHER DOCUMENTATION</h2>
        <div class="sectioncontent">
<p>This documentation assumes you have read Postfix's README_FILES/ SMTPD_POLICY_README and are generally familiar with Sender Policy Framework (SPF).  See RFC 7208 for details.</p><p>See man 5 policyd-spf.conf for configuration file information.</p><p>man 5 policyd-spf.peruser provides documentation on setting up and using different configuration options on a per user (mail reciepient) basis.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>python-policyd-spf is a Postfix SMTPd policy daemon for SPF checking. It is implemented in pure Python and uses the pyspf module.  The SPF web site is http://www.openspf.org/.  The Postfix configuration must be changed to check SPF.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Logging is sent to syslogd.</p><p>Each time a Postfix SMTP server process is started it connects to the policy service socket and Postfix runs one instance of this Python script.  By default, a Postfix SMTP server process terminates after 100 seconds of idle time, or after serving 100 clients.  Thus, the cost of starting this Python script is smoothed over time</p><p>The default policy_time_limit is 1000 seconds.  This may be too short for some SMTP transactions to complete.  As recommended in SMTPD_POLICY_README, this should be extended to 3600 seconds.  To do so, set "policy_time_limit = 3600" in /etc/postfix/main.cf.</p><p>Messages that get a Fail SPF result will be rejected.  Messages that get a Permerror are, by default, treated as if they had no SPF record.  Messages that get a Temperror result are, by default, treated as if they had no SPF record, but can (and probably should) be deferred if otherwise permitted. Messages that get other SPF results (Pass, None, Neutral, Softfail) will have the SPF Received header prepended.  Note: Spamasassisn 3.2 and follow will use this header for spam scoring so there is no need to configure a separate SPF check in these Spamassassin versions.  See Spamassassin documentation for details.</p><p>Default Mail From rejection/deferal criteria are, by design, conservative. Default HELO check actions are to reject mail with other than Pass/None. HELO records are much simpler than Mail From records and rejecting based on HELO checking does not present a false positive risk.  These settings are a matter of local policy and should be adjusted to meet the requirements of site administrators.  See <a href="../man5/policyd-spf.conf.5.html"><strong>policyd-spf.conf</strong>(5)</a> for configuration file details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LOGGING</h2>
        <div class="sectioncontent">
<p>Policyd-spf will log messages to syslog about it's activities.  The "debugLevel" value in "policyd-spf.conf" can be increased to get additional information to be logged.  When set to a value of "0", only test results (SPF hits/misses) are logged.  Results will be returned to Postfix and logged as a warning by Postfix also.  For logging by this policy server, look for "policyd-spf" in your mail log files.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TESTING THE POLICY DAEMON</h2>
        <div class="sectioncontent">
<p>Testing the policy daemon</p><p>To test the policy daemon by hand, execute:</p>
<pre>
    policyd-spf
</pre>
<p>Each query is a bunch of attributes.  Order does not matter, and the daemon uses only a few of all the attributes shown below:</p>
<pre>
    request=smtpd_access_policy
    protocol_state=RCPT
    protocol_name=SMTP
    helo_name=some.domain.tld
    queue_id=8045F2AB23
    instance=12345.6789
    sender=foo@bar.tld
    recipient=bar@foo.tld
    client_address=1.2.3.4
    client_name=another.domain.tld
    [empty line]
</pre>
<p>The policy daemon will answer in the same style, with an attribute list followed by a empty line:</p>
<pre>
    action=dunno
    [empty line]
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">POSTFIX INTEGRATION</h2>
        <div class="sectioncontent">
<p> 1. Add the following to /etc/postfix/master.cf:</p>
<pre>
        policyd-spf  unix  -       n       n       -       0       spawn
            user=policyd-spf argv=/usr/bin/policyd-spf
</pre>

<pre>
    NOTE: Check the path to both the installed Python interpreter and
          policyd-spf.  These vary from system to system.  To use non-default
          settings, you must also add the config file (see above and
          <a href="../man5/policyd-spf.conf.5.html"><strong>policyd-spf.conf</strong>(5)</a> for details).
</pre>
<p> 2. Configure the Postfix policy service in /etc/postfix/main.cf:</p>
<pre>
        smtpd_recipient_restrictions =
            ...
            reject_unauth_destination
            check_policy_service unix:private/policyd-spf
            ...
        policyd-spf_time_limit = 3600
</pre>

<pre>
    NOTE:  Specify check_policy_service AFTER reject_unauth_destination or
           else your system can become an open relay.
</pre>
<p> 3. Reload Postfix.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO policyd-spf&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/policyd-spf.conf.5.html"><strong>policyd-spf.conf</strong>(5)</a>, <a href="../man5/policyd-spf.peruser.5.html"><strong>policyd-spf.peruser</strong>(5)</a>, python-spf, &lt;http://www.openspf.org&gt;, RFC 7208</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>This version of <strong>python-policyd-spf</strong> was written by Copyright © 2007-2012 Scott Kitterman &lt;scott@kitterman.com&gt;.  It is derived from Tumgreyspf, written by Sean Reifschneider, tummy.com, ltd &lt;jafo@tummy.com&gt;. Portions of the documentation were written by Meng Weng Wong &lt;mengwong@pobox.com&gt;.</p><p>This man-page was created by Scott Kitterman &lt;scott@kitterman.com&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="poldi-ctrl.1.html"><span aria-hidden="true">&larr;</span> poldi-ctrl.1: Pam_poldi utility</a></li>
   <li class="next"><a href="policyeditor.1.html">policyeditor.1: View and modify security policy settings for javaws and the browser plugin <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
