<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmlogger_check: Administration of performance co-pilot archive log files</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Administration of performance co-pilot archive log files">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmlogger_check (1) manual">
  <meta name="twitter:description" content="Administration of performance co-pilot archive log files">
  <meta name="twitter:image" content="https://www.carta.tech/images/pcp-pmlogger_check-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pmlogger_check.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pmlogger_check (1) manual" />
  <meta property="og:description" content="Administration of performance co-pilot archive log files" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pcp-pmlogger_check-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmlogger_check<small> (1)</small></h1>
        <p class="lead">Administration of performance co-pilot archive log files</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmlogger_check.1.html">
      <span itemprop="name">pmlogger_check: Administration of performance co-pilot archive log files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmlogger_check.1.html">
      <span itemprop="name">pmlogger_check: Administration of performance co-pilot archive log files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>$PCP_BINADM_DIR/pmlogger_check</strong> [<strong>-CNsTV</strong>] [<strong>-c</strong> <em>control</em>]</p><p><strong>$PCP_BINADM_DIR/pmlogger_daily</strong> [<strong>-NorV</strong>] [<strong>-c</strong> <em>control</em>] [<strong>-k</strong> <em>discard</em>] [<strong>-m</strong> <em>addresses</em>] [<strong>-s</strong> <em>size</em>] [<strong>-t</strong> <em>want</em>] [<strong>-x</strong> <em>compress</em>] [<strong>-X</strong> <em>program</em>] [<strong>-Y</strong> <em>regex</em>]</p><p><strong>$PCP_BINADM_DIR/pmlogger_merge</strong> [<strong>-fNV</strong>] [<em>input-basename</em> ... <em>output-name</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This series of shell scripts and associated control files may be used to create a customized regime of administration and management for Performance Co-Pilot (see <strong>PCPintro</strong>(1)) archive log files.</p><p>The <strong>-V</strong> option that is common to all the scipts will enable verbose tracing and reporting. By default the scripts generate no output unless some error or warning condition is encountered.</p><p>The common <strong>-N</strong> option enables a ``show me'' mode, where the actions are echoed, but not executed, in the style of ``make -n''. Using <strong>-N</strong> in conjunction with <strong>-V</strong> maximizes the diagnostic capabilities for debugging.</p><p><strong>pmlogger_daily</strong> is intended to be run once per day, preferably in the early morning, as soon after midnight as practicable.  Its task is to aggregate and rotate one or more sets of PCP archives. After some period, old PCP archives are discarded.  This period is 14 days by default, but may be changed using the <strong>-k</strong> option. Two special values are recognized for the period ( .IR discard ), namely <strong>0</strong> to keep no archives beyond the current one, and <strong>forever</strong> to prevent any archives being discarded.</p><p>Archive data files can optionally be compressed after some period to conserve disk space.  This is particularly useful for large numbers of <strong>pmlogger</strong> processes under the control of <strong>pmlogger_check</strong>. By default no compression is done. The <strong>-x</strong> option enables compression and specifies the number of days after which to compress archive data files, and the <strong>-X</strong> option specifies the program to use for compression - by default this is <strong>xz</strong>(1). Use of the <strong>-Y</strong> option allows a regular expression to be specified causing files in the set of files matched for compression to be omitted - this allows only the data file to be compressed, and also prevents the program from attempting to compress it more than once.  The default <em>regex</em> is ".(meta|index|Z|gz|bz2|zip|xz|lzma|lzo|lz4)$" - such files are filtered using the <strong>-v</strong> option to <a href="../man1/egrep.1.html"><strong>egrep</strong>(1)</a>.</p><p>To accommodate the evolution of PMDAs and changes in production logging environments, <strong>pmlogger_daily</strong> is integrated with <a href="../man1/pmlogrewrite.1.html"><strong>pmlogrewrite</strong>(1)</a> to allow optional and automatic rewriting of archives before merging. If there are global rewriting rules to be applied across all archives mentioned in the control file, then create the directory <strong>$PCP_SYSCONF_DIR/pmlogrewrite</strong> and place any <a href="../man1/pmlogrewrite.1.html"><strong>pmlogrewrite</strong>(1)</a> rewriting rules in this directory. For rewriting rules that are specific to only one family of archives, use the directory name from the control file (the <em>fourth</em> field) and create a file, or a directory, or a symbolic link named <strong>pmlogrewrite</strong> within this directory and place the required rewriting rule(s) in the <strong>pmlogrewrite</strong> file or in files within the <strong>pmlogrewrite</strong> subdirectory. <strong>pmlogger_daily</strong> will choose rewriting rules from the archive directory if they exist, else rewriting rules from <strong>$PCP_SYSCONF_DIR/pmlogrewrite</strong> if that directory exists, else no rewriting is attempted.</p><p>The <strong>-r</strong> command line option acts as an over-ride and prevents all archive rewriting with <a href="../man1/pmlogrewrite.1.html"><strong>pmlogrewrite</strong>(1)</a> independent of the presence of any rewriting rule files or directories.</p><p>By default all possible archives will be merged.  The <strong>-o</strong> option reinstates the old behaviour in which only yesterday's archives will be considered as merge candidates.</p><p>In the special case where only a single input archive needs to be merged, <a href="../man1/pmlogmv.1.html"><strong>pmlogmv</strong>(1)</a> is used to rename the archive, rather than copy the input archive using <strong>pmlogger_merge</strong>.</p><p>The <strong>-M</strong> option may be used to disable archive merging (or renaming) and rewriting ( .B -M implies <strong>-r</strong>). This is most useful in cases where the archives are being incrementally copied to a remote repository, e.g. using <a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>. Merging, renaming and rewriting all risk an increase in the synchronization load, especially immediately after <strong>pmlogger_daily</strong> has run, so <strong>-M</strong> may be useful in these cases.</p><p>To assist with debugging or diagnosing intermittent failures the <strong>-t</strong> option may be used.  This will turn on very verbose tracing ( .BR -VV ) and capture the trace output in a file named <strong>$PCP_LOG_DIR/pmlogger/daily.</strong><em>datestamp</em><strong>.trace,</strong> where <em>datestamp</em> is the time <strong>pmlogger_daily</strong> was run in the format YYYYMMDD.HH.MM. In addition, the <em>want</em> argument will ensure that trace files created with <strong>-t</strong> will be kept for <em>want</em> days and then discarded.</p><p>In addition, if the PCP ``notices'' file ( .BR $PCP_LOG_DIR/NOTICES ) is larger than 20480 bytes, <strong>pmlogger_daily</strong> will rename the file with a ``.old'' suffix, and start a new ``notices'' file. The rotate threshold may be changed from 20480 to <em>size</em> bytes using the <strong>-s</strong> option.</p><p>Use of the <strong>-m</strong> option causes <strong>pmlogger_daily</strong> to construct a summary of the ``notices'' file entries which were generated in the last 24 hours, and e-mail that summary to the set of space-separated <em>addresses</em>. This daily summary is stored in the file <strong>$PCP_LOG_DIR/NOTICES.daily</strong>, which will be empty when no new ``notices'' entries were made in the previous 24 hour period.</p><p>The script <strong>$PCP_BINADM_DIR/pmlogger_daily</strong> could be copied and modified to implement a site-specific procedure for end-of-week and/or end-of-month management for a set of PCP archives.</p><p><strong>pmlogger_check</strong> may be run at any time, and is intended to check that the desired set of <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a> processes are running, and if not to re-launch any failed loggers. Use of the <strong>-s</strong> option provides the reverse functionality, allowing the set of <strong>pmlogger</strong> processes to be cleanly shutdown. Use of the <strong>-C</strong> option queries the system service runlevel information for <strong>pmlogger</strong>, and uses that to determine whether to start or stop processes.</p><p>The <strong>-T</strong> option provides a terser form of output for <strong>pmlogger_check</strong> that is most suitable for a <em>pmlogger</em> ``farm'' where many instances of <em>pmlogger</em> are expected to be running.</p><p><strong>pmlogger_merge</strong> is a wrapper script for <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a> that merges all of the archive logs matching the <em>input-basename</em> arguments, and creates a new archive using <em>output-name</em> as the base name for the physical files that constitute an archive log. The <em>input-basename</em> arguments may contain meta characters in the style of <strong>sh</strong>(1). If specified, the <strong>-f</strong> option causes all of the input files to be removed once the output archive has been created.</p><p><strong>pmlogger_merge</strong> is used by <strong>pmlogger_daily</strong>.</p><p>Both <strong>pmlogger_daily</strong> and <strong>pmlogger_check</strong> are controlled by a PCP logger control file that specifies the <strong>pmlogger</strong> instances to be managed.  The default control file is <strong>$PCP_PMLOGGERCONTROL_PATH</strong>, but an alternate may be specified using the <strong>-c</strong> option.</p><p>The control file should be customized according to the following rules that define for the current version (1.1) of the control file format.</p>
<dl class='dl-vertical'>
  <dt>
    1.
  </dt>
  <dd>
    <p>Lines beginning with a ``#'' are comments.</p>
  </dd>
  <dt>
    2.
  </dt>
  <dd>
    <p>Lines beginning with a ``$'' are assumed to be assignments to environment variables in the style of <strong>sh</strong>(1), and all text following the ``$'' will be <strong>eval</strong>'ed by the script reading the control file, and the corresponding variable exported into the environment. This is particularly useful to set and export variables into the environment of the administrative scripts, e.g.</p>
<pre>
$ PMCD_CONNECT_TIMEOUT=20
</pre>
<p><strong>Warning</strong>: The <strong>$PCP_PMLOGGERCONTROL_PATH</strong> file must not be writable by any user other than root.</p>
  </dd>
  <dt>
    3.
  </dt>
  <dd>
    <p>There <strong>must</strong> be a version line of the form:</p>
<pre>
$ version=1.1
</pre>

  </dd>
  <dt>
    4.
  </dt>
  <dd>
    <p>There should be one line in the control file for each <strong>pmlogger</strong> instance of the form:</p>
<pre>
<em>host</em> <strong>y</strong>|<strong>n</strong> <strong>y</strong>|<strong>n</strong> <em>directory</em> <em>args</em>
</pre>

  </dd>
  <dt>
    5.
  </dt>
  <dd>
    <p>Fields within a line of the control file are separated by one or more spaces or tabs.</p>
  </dd>
  <dt>
    6.
  </dt>
  <dd>
    <p>The <em>first</em> field is the name of the host that is the source of the performance metrics for this <strong>pmlogger</strong> instance.</p>
  </dd>
  <dt>
    7.
  </dt>
  <dd>
    <p>The <em>second</em> field indicates if this is a <em>primary</em> <strong>pmlogger</strong> instance ( .BR y ) or not ( .BR n ). Since the primary logger must run on the local host, and there may be at most one primary logger for a particular host, this field can be <strong>y</strong> for at most one <strong>pmlogger</strong> instance, in which case the host name must be the name of the local host.</p>
  </dd>
  <dt>
    8.
  </dt>
  <dd>
    <p>The <em>third</em> field indicates if this <strong>pmlogger</strong> instance needs to be started under the control of <a href="../man1/pmsocks.1.html"><strong>pmsocks</strong>(1)</a> to connect to a <strong>pmcd</strong> through a firewall ( .B y or <strong>n</strong>).</p>
  </dd>
  <dt>
    9.
  </dt>
  <dd>
    <p>The <em>fourth</em> field is a directory name.  All files associated with this <strong>pmlogger</strong> instance will be created in this directory, and this will be the current directory for the execution of any programs required in the maintenance of those archives. A useful convention is that primary logger archives for the local host with hostname <em>myhost</em> are maintained in the directory <strong>$PCP_LOG_DIR/pmlogger/</strong><em>myhost</em> (this is where the default <strong>pmlogger</strong> start-up script in <strong>$PCP_RC_DIR/pcp</strong> will create the archives), while archives for the remote host <em>mumble</em> are maintained in <strong>$PCP_LOG_DIR/pmlogger/</strong><em>mumble</em>.</p>
  </dd>
  <dt>
    10.
  </dt>
  <dd>
    <p>All other fields are interpreted as arguments to be passed to <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a> and/or <a href="../man1/pmnewlog.1.html"><strong>pmnewlog</strong>(1)</a>. Most typically this would be the <strong>-c</strong> option.</p>
  </dd>

</dl>
<p>The following sample control lines specify a primary logger on the local host ( .IR bozo ), and a non-primary logger to collect and log performance metrics from the host <em>boing</em>.</p>
<pre>
$version=1.1
bozo   y  n  $PCP_LOG_DIR/pmlogger/bozo   -c config.default
boing  n  n  $PCP_LOG_DIR/pmlogger/boing  -c ./pmlogger.config
</pre>
<p>Typical <a href="../man5/crontab.5.html"><strong>crontab</strong>(5)</a> entries for periodic execution of <strong>pmlogger_daily</strong> and <strong>pmlogger_check</strong> are given in <strong>$PCP_SYSCONF_DIR/pmlogger/crontab</strong> (unless installed by default in <em>/etc/cron.d</em> already) and shown below.</p>
<pre>
# daily processing of archive logs
14      0       *       *       *       $PCP_BINADM_DIR/pmlogger_daily
# every 30 minutes, check pmlogger instances are running
25,55   *       *       *       *       $PCP_BINADM_DIR/pmlogger_check
</pre>
<p>The output from the <strong>cron</strong>(1) execution of the scripts may be extended using the <strong>-V</strong> option.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>$PCP_PMLOGGERCONTROL_PATH</strong></p>
  </dt>
  <dd>
    <p>the PCP logger control file</p><p><strong>Warning</strong>: this file must not be writable by any user other than root.</p>
  </dd>
  <dt>
    <p><strong>$PCP_SYSCONF_DIR/pmlogger/crontab</strong></p>
  </dt>
  <dd>
    <p>sample crontab for automated script execution by $PCP_USER (or root). Exists only if the platform does not support the /etc/cron.d mechanism.</p>
  </dd>
  <dt>
    <p><strong>$PCP_SYSCONF_DIR/pmlogger/config.default</strong></p>
  </dt>
  <dd>
    <p>default <strong>pmlogger</strong> configuration file location for the local primary logger, typically generated automatically by <a href="../man1/pmlogconf.1.html"><strong>pmlogconf</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>$PCP_LOG_DIR/pmlogger/</strong><em>hostname</em></p>
  </dt>
  <dd>
    <p>default location for archives of performance information collected from the host <em>hostname</em></p>
  </dd>
  <dt>
    <p><strong>$PCP_LOG_DIR/pmlogger/</strong><em>hostname</em><strong>/lock</strong></p>
  </dt>
  <dd>
    <p>transient lock file to guarantee mutual exclusion during <strong>pmlogger</strong> administration for the host <em>hostname</em> - if present, can be safely removed if neither <strong>pmlogger_daily</strong> nor <strong>pmlogger_check</strong> are running</p>
  </dd>
  <dt>
    <p><strong>$PCP_LOG_DIR/pmlogger/</strong><em>hostname</em><strong>/Latest</strong></p>
  </dt>
  <dd>
    <p>PCP archive folio created by <a href="../man1/mkaf.1.html"><strong>mkaf</strong>(1)</a> for the most recently launched archive containing performance metrics from the host <em>hostname</em></p>
  </dd>
  <dt>
    <p><strong>$PCP_LOG_DIR/NOTICES</strong></p>
  </dt>
  <dd>
    <p>PCP ``notices'' file used by <a href="../man1/pmie.1.html"><strong>pmie</strong>(1)</a> and friends</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <strong>/etc/pcp.conf</strong> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmlogger_check&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/egrep.1.html"><strong>egrep</strong>(1)</a>, <a href="../man1/PCPIntro.1.html"><strong>PCPIntro</strong>(1)</a>, <a href="../man1/pmlc.1.html"><strong>pmlc</strong>(1)</a>, <a href="../man1/pmlogconf.1.html"><strong>pmlogconf</strong>(1)</a>, <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>, <a href="../man1/pmlogextract.1.html"><strong>pmlogextract</strong>(1)</a>, <a href="../man1/pmlogmv.1.html"><strong>pmlogmv</strong>(1)</a>, <a href="../man1/pmlogrewrite.1.html"><strong>pmlogrewrite</strong>(1)</a>, <a href="../man1/pmnewlog.1.html"><strong>pmnewlog</strong>(1)</a>, <a href="../man1/pmsocks.1.html"><strong>pmsocks</strong>(1)</a>, <strong>xz</strong>(1) and <a href="../man8/cron.8.html"><strong>cron</strong>(8)</a>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmlogger.1.html"><span aria-hidden="true">&larr;</span> pmlogger.1: Create archive log for performance metrics</a></li>
   <li class="next"><a href="pmlogger_daily.1.html">pmlogger_daily.1: Administration of performance co-pilot archive log files <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
