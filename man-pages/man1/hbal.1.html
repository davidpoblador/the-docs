<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>hbal: Cluster balancer for ganeti</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Cluster balancer for ganeti">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="hbal (1) manual">
  <meta name="twitter:description" content="Cluster balancer for ganeti">
  <meta name="twitter:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hbal-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/hbal.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="hbal (1) manual" />
  <meta property="og:description" content="Cluster balancer for ganeti" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hbal-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">hbal<small> (1)</small></h1>
        <p class="lead">Cluster balancer for ganeti</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hbal.1.html">
      <span itemprop="name">hbal: Cluster balancer for ganeti</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ganeti-htools-2.12/">
      <span itemprop="name">ganeti-htools-2.12</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hbal.1.html">
      <span itemprop="name">hbal: Cluster balancer for ganeti</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>hbal</strong> {backend options...} [algorithm options...] [reporting options...]</p><p><strong>hbal</strong> --version</p><p>Backend options:</p><p>{ <strong>-m</strong> <em>cluster</em> | <strong>-L[</strong> <em>path</em> <strong>]</strong> [-X] | <strong>-t</strong> <em>data-file</em> | <strong>-I</strong> <em>path</em> }</p><p>Algorithm options:</p><p><strong>[ --max-cpu </strong><em>cpu-ratio</em> ] <strong>[ --min-disk</strong> <em>disk-ratio</em> ] <strong>[ -l </strong><em>limit</em> ] <strong>[ -e</strong> <em>score</em> ] <strong>[ -g </strong><em>delta</em> ] <strong>[</strong> --min-gain-limit <em>threshold</em> ] <strong>[ -O </strong><em>name...</em> ] <strong>[ --no-disk-moves ]</strong> <strong>[ --no-instance-moves ]</strong> <strong>[ -U </strong><em>util-file</em> ] <strong>[ --ignore-dynu ]</strong> <strong>[</strong> --mond <em>yes|no</em> ] <strong>[ --evac-mode ]</strong> <strong>[</strong> --restricted-migration ] <strong>[ --select-instances </strong><em>inst...</em> ] <strong>[ --exclude-instances </strong><em>inst...</em> ]</p><p>Reporting options:</p><p><strong>[ -C[ </strong><em>file</em> ] ] <strong>[ -p[ </strong><em>fields</em> ] ] <strong>[ --print-instances ]</strong> <strong>[ -S </strong><em>file</em> ] <strong>[</strong> -v... | -q ]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>hbal is a cluster balancer that looks at the current state of the cluster (nodes with their total and free disk, memory, etc.)  and instance placement and computes a series of steps designed to bring the cluster into a better state.</p><p>The algorithm used is designed to be stable (i.e. it will give you the same results when restarting it from the middle of the solution) and reasonably fast. It is not, however, designed to be a perfect algorithm: it is possible to make it go into a corner from which it can find no improvement, because it looks only one "step" ahead.</p><p>The program accesses the cluster state via Rapi or Luxi. It also requests data over the network from all MonDs with the --mond option. Currently it uses only data produced by CPUload collector.</p><p>By default, the program will show the solution incrementally as it is computed, in a somewhat cryptic format; for getting the actual Ganeti command list, use the <strong>-C</strong> option.</p><h3>ALGORITHM</h3>
<p>The program works in independent steps; at each step, we compute the best instance move that lowers the cluster score.</p><p>The possible move type for an instance are combinations of failover/migrate and replace-disks such that we change one of the instance nodes, and the other one remains (but possibly with changed role, e.g. from primary it becomes secondary). The list is:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>failover (f)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>replace secondary (r)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>replace primary, a composite move (f, r, f)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>failover and replace secondary, also composite (f, r)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>replace secondary and failover, also composite (r, f)</p>
  </dd>

</dl>
<p>We don\[aq]t do the only remaining possibility of replacing both nodes (r,f,r,f or the equivalent f,r,f,r) since these move needs an exhaustive search over both candidate primary and secondary nodes, and is O(n*n) in the number of nodes. Furthermore, it doesn\[aq]t seems to give better scores but will result in more disk replacements.</p>
<h3>PLACEMENT RESTRICTIONS</h3>
<p>At each step, we prevent an instance move if it would cause:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>a node to go into N+1 failure state</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>an instance to move onto an offline node (offline nodes are either read from the cluster or declared with <em>-O</em>; drained nodes are considered offline)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>an exclusion-tag based conflict (exclusion tags are read from the cluster and/or defined via the <em>--exclusion-tags</em> option)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>a max vcpu/pcpu ratio to be exceeded (configured via <em>--max-cpu</em>)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>min disk free percentage to go below the configured limit (configured via <em>--min-disk</em>)</p>
  </dd>

</dl>

<h3>CLUSTER SCORING</h3>
<p>As said before, the algorithm tries to minimise the cluster score at each step. Currently this score is computed as a weighted sum of the following components:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the percent of free memory</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the percent of reserved memory</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the percent of free disk</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>count of nodes failing N+1 check</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>count of instances living (either as primary or secondary) on offline nodes; in the sense of hbal (and the other htools) drained nodes are considered offline</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>count of instances living (as primary) on offline nodes; this differs from the above metric by helping failover of such instances in 2-node clusters</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the ratio of virtual-to-physical cpus (for primary instances of the node)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the fraction of the available spindles (in dedicated mode, spindles represent physical spindles; otherwise this oversubscribable measure for IO load, and the oversubscription factor is taken into account when computing the number of available spindles)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the dynamic load on the nodes, for cpus, memory, disk and network</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>standard deviation of the CPU load provided by MonD</p>
  </dd>

</dl>
<p>The free memory and free disk values help ensure that all nodes are somewhat balanced in their resource usage. The reserved memory helps to ensure that nodes are somewhat balanced in holding secondary instances, and that no node keeps too much memory reserved for N+1. And finally, the N+1 percentage helps guide the algorithm towards eliminating N+1 failures, if possible.</p><p>Except for the N+1 failures and offline instances counts, we use the standard deviation since when used with values within a fixed range (we use percents expressed as values between zero and one) it gives consistent results across all metrics (there are some small issues related to different means, but it works generally well). The \[aq]count\[aq] type values will have higher score and thus will matter more for balancing; thus these are better for hard constraints (like evacuating nodes and fixing N+1 failures). For example, the offline instances count (i.e. the number of instances living on offline nodes) will cause the algorithm to actively move instances away from offline nodes. This, coupled with the restriction on placement given by offline nodes, will cause evacuation of such nodes.</p><p>The dynamic load values need to be read from an external file (Ganeti doesn\[aq]t supply them), and are computed for each node as: sum of primary instance cpu load, sum of primary instance memory load, sum of primary and secondary instance disk load (as DRBD generates write load on secondary nodes too in normal case and in degraded scenarios also read load), and sum of primary instance network load. An example of how to generate these values for input to hbal would be to track xm&nbsp;list for instances over a day and by computing the delta of the cpu values, and feed that via the <em>-U</em> option for all instances (and keep the other metrics as one). For the algorithm to work, all that is needed is that the values are consistent for a metric across all instances (e.g. all instances use cpu% to report cpu usage, and not something related to number of CPU seconds used if the CPUs are different), and that they are normalised to between zero and one. Note that it\[aq]s recommended to not have zero as the load value for any instance metric since then secondary instances are not well balanced.</p><p>The CPUload from MonD\[aq]s data collector will be used only if all MonDs are running, otherwise it won\[aq]t affect the cluster score. Since we can\[aq]t find the CPU load of each instance, we can assume that the CPU load of an instance is proportional to the number of its vcpus. With this heuristic, instances from nodes with high CPU load will tend to move to nodes with less CPU load.</p><p>On a perfectly balanced cluster (all nodes the same size, all instances the same size and spread across the nodes equally), the values for all metrics would be zero. This doesn\[aq]t happen too often in practice :)</p>
<h3>OFFLINE INSTANCES</h3>
<p>Since current Ganeti versions do not report the memory used by offline (down) instances, ignoring the run status of instances will cause wrong calculations. For this reason, the algorithm subtracts the memory size of down instances from the free node memory of their primary node, in effect simulating the startup of such instances.</p>
<h3>EXCLUSION TAGS</h3>
<p>The exclusion tags mechanism is designed to prevent instances which run the same workload (e.g. two DNS servers) to land on the same node, which would make the respective node a SPOF for the given service.</p><p>It works by tagging instances with certain tags and then building exclusion maps based on these. Which tags are actually used is configured either via the command line (option <em>--exclusion-tags</em>) or via adding them to the cluster tags:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--exclusion-tags=a,b</strong></p>
  </dt>
  <dd>
    <p>This will make all instance tags of the form <em>a:*</em>, <em>b:*</em> be considered for the exclusion map</p>
  </dd>
  <dt>
    <p><strong>cluster tags </strong><em>htools:iextags:a</em>, <em>htools:iextags:b</em></p>
  </dt>
  <dd>
    <p>This will make instance tags <em>a:*</em>, <em>b:*</em> be considered for the exclusion map. More precisely, the suffix of cluster tags starting with <em>htools:iextags:</em> will become the prefix of the exclusion tags.</p>
  </dd>

</dl>
<p>Both the above forms mean that two instances both having (e.g.)  the tag <em>a:foo</em> or <em>b:bar</em> won\[aq]t end on the same node.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>The options that can be passed to the program are as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-C, --print-commands</strong></p>
  </dt>
  <dd>
    <p>Print the command list at the end of the run. Without this, the program will only show a shorter, but cryptic output.</p><p>Note that the moves list will be split into independent steps, called "jobsets", but only for visual inspection, not for actually parallelisation. It is not possible to parallelise these directly when executed via "gnt-instance" commands, since a compound command (e.g. failover and replace-disks) must be executed serially. Parallel execution is only possible when using the Luxi backend and the <em>-L</em> option.</p><p>The algorithm for splitting the moves into jobsets is by accumulating moves until the next move is touching nodes already touched by the current moves; this means we can\[aq]t execute in parallel (due to resource allocation in Ganeti) and thus we start a new jobset.</p>
  </dd>
  <dt>
    <p><strong>-p, --print-nodes</strong></p>
  </dt>
  <dd>
    <p>Prints the before and after node status, in a format designed to allow the user to understand the node\[aq]s most important parameters. See the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> for more details about this option.</p>
  </dd>
  <dt>
    <p><strong>--print-instances</strong></p>
  </dt>
  <dd>
    <p>Prints the before and after instance map. This is less useful as the node status, but it can help in understanding instance moves.</p>
  </dd>
  <dt>
    <p><strong>-O </strong><em>name</em></p>
  </dt>
  <dd>
    <p>This option (which can be given multiple times) will mark nodes as being <em>offline</em>. This means a couple of things:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>instances won\[aq]t be placed on these nodes, not even temporarily; e.g. the <em>replace primary</em> move is not available if the secondary node is offline, since this move requires a failover.</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>these nodes will not be included in the score calculation (except for the percentage of instances on offline nodes)</p>
  </dd>

</dl>
<p>Note that algorithm will also mark as offline any nodes which are reported by RAPI as such, or that have "?" in file-based input in any numeric fields.</p>
  </dd>
  <dt>
    <p><strong>-e </strong><em>score</em>, --min-score=<em>score</em></p>
  </dt>
  <dd>
    <p>This parameter denotes the minimum score we are happy with and alters the computation in two ways:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>if the cluster has the initial score lower than this value, then we don\[aq]t enter the algorithm at all, and exit with success</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>during the iterative process, if we reach a score lower than this value, we exit the algorithm</p>
  </dd>

</dl>
<p>The default value of the parameter is currently 1e-9 (chosen empirically).</p>
  </dd>
  <dt>
    <p><strong>-g </strong><em>delta</em>, --min-gain=<em>delta</em></p>
  </dt>
  <dd>
    <p>Since the balancing algorithm can sometimes result in just very tiny improvements, that bring less gain that they cost in relocation time, this parameter (defaulting to 0.01) represents the minimum gain we require during a step, to continue balancing.</p>
  </dd>
  <dt>
    <p><strong>--min-gain-limit=</strong><em>threshold</em></p>
  </dt>
  <dd>
    <p>The above min-gain option will only take effect if the cluster score is already below <em>threshold</em> (defaults to 0.1). The rationale behind this setting is that at high cluster scores (badly balanced clusters), we don\[aq]t want to abort the rebalance too quickly, as later gains might still be significant. However, under the threshold, the total gain is only the threshold value, so we can exit early.</p>
  </dd>
  <dt>
    <p><strong>--no-disk-moves</strong></p>
  </dt>
  <dd>
    <p>This parameter prevents hbal from using disk move (i.e. "gnt-instance replace-disks") operations. This will result in a much quicker balancing, but of course the improvements are limited. It is up to the user to decide when to use one or another.</p>
  </dd>
  <dt>
    <p><strong>--no-instance-moves</strong></p>
  </dt>
  <dd>
    <p>This parameter prevents hbal from using instance moves (i.e. "gnt-instance migrate/failover") operations. This will only use the slow disk-replacement operations, and will also provide a worse balance, but can be useful if moving instances around is deemed unsafe or not preferred.</p>
  </dd>
  <dt>
    <p><strong>--evac-mode</strong></p>
  </dt>
  <dd>
    <p>This parameter restricts the list of instances considered for moving to the ones living on offline/drained nodes. It can be used as a (bulk) replacement for Ganeti\[aq]s own <em>gnt-node evacuate</em>, with the note that it doesn\[aq]t guarantee full evacuation.</p>
  </dd>
  <dt>
    <p><strong>--restricted-migration</strong></p>
  </dt>
  <dd>
    <p>This parameter disallows any replace-primary moves (frf), as well as those replace-and-failover moves (rf) where the primary node of the instance is not drained. If used together with the --evac-mode option, the only migrations that hbal will do are migrations of instances off a drained node. This can be useful if during a reinstall of the base operating system migration is only possible from the old OS to the new OS.</p>
  </dd>
  <dt>
    <p><strong>--select-instances=</strong><em>instances</em></p>
  </dt>
  <dd>
    <p>This parameter marks the given instances (as a comma-separated list) as the only ones being moved during the rebalance.</p>
  </dd>
  <dt>
    <p><strong>--exclude-instances=</strong><em>instances</em></p>
  </dt>
  <dd>
    <p>This parameter marks the given instances (as a comma-separated list) from being moved during the rebalance.</p>
  </dd>
  <dt>
    <p><strong>-U </strong><em>util-file</em></p>
  </dt>
  <dd>
    <p>This parameter specifies a file holding instance dynamic utilisation information that will be used to tweak the balancing algorithm to equalise load on the nodes (as opposed to static resource usage). The file is in the format "instance_name cpu_util mem_util disk_util net_util" where the "_util" parameters are interpreted as numbers and the instance name must match exactly the instance as read from Ganeti. In case of unknown instance names, the program will abort.</p><p>If not given, the default values are one for all metrics and thus dynamic utilisation has only one effect on the algorithm: the equalisation of the secondary instances across nodes (this is the only metric that is not tracked by another, dedicated value, and thus the disk load of instances will cause secondary instance equalisation). Note that value of one will also influence slightly the primary instance count, but that is already tracked via other metrics and thus the influence of the dynamic utilisation will be practically insignificant.</p>
  </dd>
  <dt>
    <p><strong>--ignore-dynu</strong></p>
  </dt>
  <dd>
    <p>If given, all dynamic utilisation information will be ignored by assuming it to be 0. This option will take precedence over any data passed by the -U option or by the MonDs with the --mond and the --mond-data option.</p>
  </dd>
  <dt>
    <p><strong>-S </strong><em>filename</em>, --save-cluster=<em>filename</em></p>
  </dt>
  <dd>
    <p>If given, the state of the cluster before the balancing is saved to the given file plus the extension "original" (i.e. <em>filename</em>.original), and the state at the end of the balancing is saved to the given file plus the extension "balanced" (i.e. <em>filename</em>.balanced). This allows re-feeding the cluster state to either hbal itself or for example hspace via the -t option.</p>
  </dd>
  <dt>
    <p><strong>-t </strong><em>datafile</em>, --text-data=<em>datafile</em></p>
  </dt>
  <dd>
    <p>Backend specification: the name of the file holding node and instance information (if not collecting via RAPI or LUXI). This or one of the other backends must be selected. The option is described in the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>--mond=</strong><em>yes|no</em></p>
  </dt>
  <dd>
    <p>If given the program will query all MonDs to fetch data from the supported data collectors over the network.</p>
  </dd>
  <dt>
    <p><strong>--mond-data </strong><em>datafile</em></p>
  </dt>
  <dd>
    <p>The name of the file holding the data provided by MonD, to override quering MonDs over the network. This is mostly used for debugging. The file must be in JSON format and present an array of JSON objects , one for every node, with two members. The first member named node is the name of the node and the second member named reports is an array of report objects. The report objects must be in the same format as produced by the monitoring agent.</p>
  </dd>
  <dt>
    <p><strong>-m </strong><em>cluster</em></p>
  </dt>
  <dd>
    <p>Backend specification: collect data directly from the <em>cluster</em> given as an argument via RAPI. The option is described in the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>-L [</strong><em>path</em>]</p>
  </dt>
  <dd>
    <p>Backend specification: collect data directly from the master daemon, which is to be contacted via LUXI (an internal Ganeti protocol). The option is described in the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>-X</strong></p>
  </dt>
  <dd>
    <p>When using the Luxi backend, hbal can also execute the given commands. The execution method is to execute the individual jobsets (see the <em>-C</em> option for details) in separate stages, aborting if at any time a jobset doesn\[aq]t have all jobs successful. Each step in the balancing solution will be translated into exactly one Ganeti job (having between one and three OpCodes), and all the steps in a jobset will be executed in parallel. The jobsets themselves are executed serially.</p><p>The execution of the job series can be interrupted, see below for signal handling.</p>
  </dd>
  <dt>
    <p><strong>-l </strong><em>N</em>, --max-length=<em>N</em></p>
  </dt>
  <dd>
    <p>Restrict the solution to this length. This can be used for example to automate the execution of the balancing.</p>
  </dd>
  <dt>
    <p><strong>--max-cpu=</strong><em>cpu-ratio</em></p>
  </dt>
  <dd>
    <p>The maximum virtual to physical cpu ratio, as a floating point number greater than or equal to one. For example, specifying <em>cpu-ratio</em> as <strong>2.5</strong> means that, for a 4-cpu machine, a maximum of 10 virtual cpus should be allowed to be in use for primary instances. A value of exactly one means there will be no over-subscription of CPU (except for the CPU time used by the node itself), and values below one do not make sense, as that means other resources (e.g. disk) won\[aq]t be fully utilised due to CPU restrictions.</p>
  </dd>
  <dt>
    <p><strong>--min-disk=</strong><em>disk-ratio</em></p>
  </dt>
  <dd>
    <p>The minimum amount of free disk space remaining, as a floating point number. For example, specifying <em>disk-ratio</em> as <strong>0.25</strong> means that at least one quarter of disk space should be left free on nodes.</p>
  </dd>
  <dt>
    <p><strong>-G </strong><em>uuid</em>, --group=<em>uuid</em></p>
  </dt>
  <dd>
    <p>On an multi-group cluster, select this group for processing. Otherwise hbal will abort, since it cannot balance multiple groups at the same time.</p>
  </dd>
  <dt>
    <p><strong>-v, --verbose</strong></p>
  </dt>
  <dd>
    <p>Increase the output verbosity. Each usage of this option will increase the verbosity (currently more than 2 doesn\[aq]t make sense) from the default of one.</p>
  </dd>
  <dt>
    <p><strong>-q, --quiet</strong></p>
  </dt>
  <dd>
    <p>Decrease the output verbosity. Each usage of this option will decrease the verbosity (less than zero doesn\[aq]t make sense) from the default of one.</p>
  </dd>
  <dt>
    <p><strong>-V, --version</strong></p>
  </dt>
  <dd>
    <p>Just show the program version and exit.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNAL HANDLING</h2>
        <div class="sectioncontent">
<p>When executing jobs via LUXI (using the -X option), normally hbal will execute all jobs until either one errors out or all the jobs finish successfully.</p><p>Since balancing can take a long time, it is possible to stop hbal early in two ways:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>by sending a SIGINT (^C), hbal will register the termination request, and will wait until the currently submitted jobs finish, at which point it will exit (with exit code 0 if all jobs finished correctly, otherwise with exit code 1 as usual)</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>by sending a SIGTERM, hbal will immediately exit (with exit code 2); it is the responsibility of the user to follow up with Ganeti and check the result of the currently-executing jobs</p>
  </dd>

</dl>
<p>Note that in any situation, it\[aq]s perfectly safe to kill hbal, either via the above signals or via any other signal (e.g. SIGQUIT, SIGKILL), since the jobs themselves are processed by Ganeti whereas hbal (after submission) only watches their progression. In this case, the user will have to query Ganeti for job results.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p>The exit status of the command will be zero, unless for some reason the algorithm failed (e.g. wrong node or instance data), invalid command line options, or (in case of job execution) one of the jobs has failed.</p><p>Once job execution via Luxi has started (-X), if the balancing was interrupted early (via <em>SIGINT</em>, or via --max-length) but all jobs executed successfully, then the exit status is zero; a non-zero exit code means that the cluster state should be investigated, since a job failed or we couldn\[aq]t compute its status and this can also point to a problem on the Ganeti side.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The program does not check all its input data for consistency, and sometime aborts with cryptic errors messages with invalid data.</p><p>The algorithm is not perfect.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Note that these examples are not for the latest version (they don\[aq]t have full node data).</p><h3>Default output</h3>
<p>With the default options, the program shows each individual step and the improvements it brings in cluster score:</p><ul>
<li>
<pre>
$&nbsp;hbal
Loaded&nbsp;20&nbsp;nodes,&nbsp;80&nbsp;instances
Cluster&nbsp;is&nbsp;not&nbsp;N+1&nbsp;happy,&nbsp;continuing&nbsp;but&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;cluster&nbsp;will&nbsp;end&nbsp;N+1&nbsp;happy.
Initial&nbsp;score:&nbsp;0.52329131
Trying&nbsp;to&nbsp;minimize&nbsp;the&nbsp;CV...
&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;instance14&nbsp;&nbsp;node1:node10&nbsp;&nbsp;=&gt;&nbsp;node16:node10&nbsp;0.42109120&nbsp;a=f&nbsp;r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;instance54&nbsp;&nbsp;node4:node15&nbsp;&nbsp;=&gt;&nbsp;node16:node15&nbsp;0.31904594&nbsp;a=f&nbsp;r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;instance4&nbsp;&nbsp;&nbsp;node5:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node2:node16&nbsp;&nbsp;0.26611015&nbsp;a=f&nbsp;r:node16
&nbsp;&nbsp;&nbsp;&nbsp;4.&nbsp;instance48&nbsp;&nbsp;node18:node20&nbsp;=&gt;&nbsp;node2:node18&nbsp;&nbsp;0.21361717&nbsp;a=r:node2&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;5.&nbsp;instance93&nbsp;&nbsp;node19:node18&nbsp;=&gt;&nbsp;node16:node19&nbsp;0.16166425&nbsp;a=r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;6.&nbsp;instance89&nbsp;&nbsp;node3:node20&nbsp;&nbsp;=&gt;&nbsp;node2:node3&nbsp;&nbsp;&nbsp;0.11005629&nbsp;a=r:node2&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;7.&nbsp;instance5&nbsp;&nbsp;&nbsp;node6:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node16:node6&nbsp;&nbsp;0.05841589&nbsp;a=r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;8.&nbsp;instance94&nbsp;&nbsp;node7:node20&nbsp;&nbsp;=&gt;&nbsp;node20:node16&nbsp;0.00658759&nbsp;a=f&nbsp;r:node16
&nbsp;&nbsp;&nbsp;&nbsp;9.&nbsp;instance44&nbsp;&nbsp;node20:node2&nbsp;&nbsp;=&gt;&nbsp;node2:node15&nbsp;&nbsp;0.00438740&nbsp;a=f&nbsp;r:node15
&nbsp;&nbsp;&nbsp;10.&nbsp;instance62&nbsp;&nbsp;node14:node18&nbsp;=&gt;&nbsp;node14:node16&nbsp;0.00390087&nbsp;a=r:node16
&nbsp;&nbsp;&nbsp;11.&nbsp;instance13&nbsp;&nbsp;node11:node14&nbsp;=&gt;&nbsp;node11:node16&nbsp;0.00361787&nbsp;a=r:node16
&nbsp;&nbsp;&nbsp;12.&nbsp;instance19&nbsp;&nbsp;node10:node11&nbsp;=&gt;&nbsp;node10:node7&nbsp;&nbsp;0.00336636&nbsp;a=r:node7
&nbsp;&nbsp;&nbsp;13.&nbsp;instance43&nbsp;&nbsp;node12:node13&nbsp;=&gt;&nbsp;node12:node1&nbsp;&nbsp;0.00305681&nbsp;a=r:node1
&nbsp;&nbsp;&nbsp;14.&nbsp;instance1&nbsp;&nbsp;&nbsp;node1:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node1:node4&nbsp;&nbsp;&nbsp;0.00263124&nbsp;a=r:node4
&nbsp;&nbsp;&nbsp;15.&nbsp;instance58&nbsp;&nbsp;node19:node20&nbsp;=&gt;&nbsp;node19:node17&nbsp;0.00252594&nbsp;a=r:node17
Cluster&nbsp;score&nbsp;improved&nbsp;from&nbsp;0.52329131&nbsp;to&nbsp;0.00252594

</pre>
</li>
</ul><p>In the above output, we can see:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>the input data (here from files) shows a cluster with 20 nodes and 80 instances</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>the cluster is not initially N+1 compliant</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>the initial score is 0.52329131</p>
  </dd>

</dl>
<p>The step list follows, showing the instance, its initial primary/secondary nodes, the new primary secondary, the cluster list, and the actions taken in this step (with \[aq]f\[aq] denoting failover/migrate and \[aq]r\[aq] denoting replace secondary).</p><p>Finally, the program shows the improvement in cluster score.</p><p>A more detailed output is obtained via the <em>-C</em> and <em>-p</em> options:</p><ul>
<li>
<pre>
$&nbsp;hbal
Loaded&nbsp;20&nbsp;nodes,&nbsp;80&nbsp;instances
Cluster&nbsp;is&nbsp;not&nbsp;N+1&nbsp;happy,&nbsp;continuing&nbsp;but&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;cluster&nbsp;will&nbsp;end&nbsp;N+1&nbsp;happy.
Initial&nbsp;cluster&nbsp;status:
N1&nbsp;Name&nbsp;&nbsp;&nbsp;t_mem&nbsp;f_mem&nbsp;r_mem&nbsp;t_dsk&nbsp;f_dsk&nbsp;pri&nbsp;sec&nbsp;&nbsp;p_fmem&nbsp;&nbsp;p_fdsk
&nbsp;*&nbsp;node1&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node2&nbsp;&nbsp;32762&nbsp;31280&nbsp;12000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;8&nbsp;0.95476&nbsp;0.55179
&nbsp;*&nbsp;node3&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;*&nbsp;node4&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;*&nbsp;node5&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;&nbsp;978&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;5&nbsp;0.03907&nbsp;0.52573
&nbsp;*&nbsp;node6&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;*&nbsp;node7&nbsp;&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node8&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node9&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;*&nbsp;node10&nbsp;32762&nbsp;&nbsp;7280&nbsp;12000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node11&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;&nbsp;922&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5&nbsp;0.22221&nbsp;0.49577
&nbsp;&nbsp;&nbsp;node12&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node13&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;&nbsp;922&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5&nbsp;0.22221&nbsp;0.49577
&nbsp;&nbsp;&nbsp;node14&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;&nbsp;922&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5&nbsp;0.22221&nbsp;0.49577
&nbsp;*&nbsp;node15&nbsp;32762&nbsp;&nbsp;7280&nbsp;12000&nbsp;&nbsp;1861&nbsp;&nbsp;1131&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;3&nbsp;0.22221&nbsp;0.60782
&nbsp;&nbsp;&nbsp;node16&nbsp;32762&nbsp;31280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;1861&nbsp;&nbsp;1860&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;0&nbsp;0.95476&nbsp;1.00000
&nbsp;&nbsp;&nbsp;node17&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1106&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.22221&nbsp;0.59479
&nbsp;*&nbsp;node18&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1396&nbsp;&nbsp;&nbsp;561&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.40239
&nbsp;*&nbsp;node19&nbsp;32762&nbsp;&nbsp;1280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;3&nbsp;0.03907&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node20&nbsp;32762&nbsp;13280&nbsp;12000&nbsp;&nbsp;1861&nbsp;&nbsp;&nbsp;689&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;9&nbsp;0.40535&nbsp;0.37068

Initial&nbsp;score:&nbsp;0.52329131
Trying&nbsp;to&nbsp;minimize&nbsp;the&nbsp;CV...
&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;instance14&nbsp;&nbsp;node1:node10&nbsp;&nbsp;=&gt;&nbsp;node16:node10&nbsp;0.42109120&nbsp;a=f&nbsp;r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;instance54&nbsp;&nbsp;node4:node15&nbsp;&nbsp;=&gt;&nbsp;node16:node15&nbsp;0.31904594&nbsp;a=f&nbsp;r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;instance4&nbsp;&nbsp;&nbsp;node5:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node2:node16&nbsp;&nbsp;0.26611015&nbsp;a=f&nbsp;r:node16
&nbsp;&nbsp;&nbsp;&nbsp;4.&nbsp;instance48&nbsp;&nbsp;node18:node20&nbsp;=&gt;&nbsp;node2:node18&nbsp;&nbsp;0.21361717&nbsp;a=r:node2&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;5.&nbsp;instance93&nbsp;&nbsp;node19:node18&nbsp;=&gt;&nbsp;node16:node19&nbsp;0.16166425&nbsp;a=r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;6.&nbsp;instance89&nbsp;&nbsp;node3:node20&nbsp;&nbsp;=&gt;&nbsp;node2:node3&nbsp;&nbsp;&nbsp;0.11005629&nbsp;a=r:node2&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;7.&nbsp;instance5&nbsp;&nbsp;&nbsp;node6:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node16:node6&nbsp;&nbsp;0.05841589&nbsp;a=r:node16&nbsp;f
&nbsp;&nbsp;&nbsp;&nbsp;8.&nbsp;instance94&nbsp;&nbsp;node7:node20&nbsp;&nbsp;=&gt;&nbsp;node20:node16&nbsp;0.00658759&nbsp;a=f&nbsp;r:node16
&nbsp;&nbsp;&nbsp;&nbsp;9.&nbsp;instance44&nbsp;&nbsp;node20:node2&nbsp;&nbsp;=&gt;&nbsp;node2:node15&nbsp;&nbsp;0.00438740&nbsp;a=f&nbsp;r:node15
&nbsp;&nbsp;&nbsp;10.&nbsp;instance62&nbsp;&nbsp;node14:node18&nbsp;=&gt;&nbsp;node14:node16&nbsp;0.00390087&nbsp;a=r:node16
&nbsp;&nbsp;&nbsp;11.&nbsp;instance13&nbsp;&nbsp;node11:node14&nbsp;=&gt;&nbsp;node11:node16&nbsp;0.00361787&nbsp;a=r:node16
&nbsp;&nbsp;&nbsp;12.&nbsp;instance19&nbsp;&nbsp;node10:node11&nbsp;=&gt;&nbsp;node10:node7&nbsp;&nbsp;0.00336636&nbsp;a=r:node7
&nbsp;&nbsp;&nbsp;13.&nbsp;instance43&nbsp;&nbsp;node12:node13&nbsp;=&gt;&nbsp;node12:node1&nbsp;&nbsp;0.00305681&nbsp;a=r:node1
&nbsp;&nbsp;&nbsp;14.&nbsp;instance1&nbsp;&nbsp;&nbsp;node1:node2&nbsp;&nbsp;&nbsp;=&gt;&nbsp;node1:node4&nbsp;&nbsp;&nbsp;0.00263124&nbsp;a=r:node4
&nbsp;&nbsp;&nbsp;15.&nbsp;instance58&nbsp;&nbsp;node19:node20&nbsp;=&gt;&nbsp;node19:node17&nbsp;0.00252594&nbsp;a=r:node17
Cluster&nbsp;score&nbsp;improved&nbsp;from&nbsp;0.52329131&nbsp;to&nbsp;0.00252594

Commands&nbsp;to&nbsp;run&nbsp;to&nbsp;reach&nbsp;the&nbsp;above&nbsp;solution:
&nbsp;&nbsp;echo&nbsp;step&nbsp;1
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance14
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance14
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance14
&nbsp;&nbsp;echo&nbsp;step&nbsp;2
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance54
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance54
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance54
&nbsp;&nbsp;echo&nbsp;step&nbsp;3
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance4
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance4
&nbsp;&nbsp;echo&nbsp;step&nbsp;4
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node2&nbsp;instance48
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance48
&nbsp;&nbsp;echo&nbsp;step&nbsp;5
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance93
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance93
&nbsp;&nbsp;echo&nbsp;step&nbsp;6
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node2&nbsp;instance89
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance89
&nbsp;&nbsp;echo&nbsp;step&nbsp;7
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance5
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance5
&nbsp;&nbsp;echo&nbsp;step&nbsp;8
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance94
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance94
&nbsp;&nbsp;echo&nbsp;step&nbsp;9
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;migrate&nbsp;instance44
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node15&nbsp;instance44
&nbsp;&nbsp;echo&nbsp;step&nbsp;10
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance62
&nbsp;&nbsp;echo&nbsp;step&nbsp;11
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node16&nbsp;instance13
&nbsp;&nbsp;echo&nbsp;step&nbsp;12
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node7&nbsp;instance19
&nbsp;&nbsp;echo&nbsp;step&nbsp;13
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node1&nbsp;instance43
&nbsp;&nbsp;echo&nbsp;step&nbsp;14
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node4&nbsp;instance1
&nbsp;&nbsp;echo&nbsp;step&nbsp;15
&nbsp;&nbsp;echo&nbsp;gnt-instance&nbsp;replace-disks&nbsp;-n&nbsp;node17&nbsp;instance58

Final&nbsp;cluster&nbsp;status:
N1&nbsp;Name&nbsp;&nbsp;&nbsp;t_mem&nbsp;f_mem&nbsp;r_mem&nbsp;t_dsk&nbsp;f_dsk&nbsp;pri&nbsp;sec&nbsp;&nbsp;p_fmem&nbsp;&nbsp;p_fdsk
&nbsp;&nbsp;&nbsp;node1&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node2&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node3&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node4&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node5&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1078&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5&nbsp;0.22221&nbsp;0.57947
&nbsp;&nbsp;&nbsp;node6&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node7&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node8&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node9&nbsp;&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node10&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node11&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1022&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.54951
&nbsp;&nbsp;&nbsp;node12&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node13&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1022&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.54951
&nbsp;&nbsp;&nbsp;node14&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1022&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.54951
&nbsp;&nbsp;&nbsp;node15&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1031&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55408
&nbsp;&nbsp;&nbsp;node16&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1060&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.57007
&nbsp;&nbsp;&nbsp;node17&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1006&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.54105
&nbsp;&nbsp;&nbsp;node18&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1396&nbsp;&nbsp;&nbsp;761&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;2&nbsp;0.22221&nbsp;0.54570
&nbsp;&nbsp;&nbsp;node19&nbsp;32762&nbsp;&nbsp;7280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1026&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;4&nbsp;0.22221&nbsp;0.55179
&nbsp;&nbsp;&nbsp;node20&nbsp;32762&nbsp;13280&nbsp;&nbsp;6000&nbsp;&nbsp;1861&nbsp;&nbsp;1089&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;5&nbsp;0.40535&nbsp;0.58565

</pre>
</li>
</ul><p>Here we see, beside the step list, the initial and final cluster status, with the final one showing all nodes being N+1 compliant, and the command list to reach the final solution. In the initial listing, we see which nodes are not N+1 compliant.</p><p>The algorithm is stable as long as each step above is fully completed, e.g. in step 8, both the migrate and the replace-disks are done. Otherwise, if only the migrate is done, the input data is changed in a way that the program will output a different solution list (but hopefully will end in the same state).</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to project website (http://code.google.com/p/ganeti/) or contact the developers using the Ganeti mailing list (ganeti@googlegroups.com).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO hbal&hellip;</h2>
        <div class="sectioncontent">
<p>Ganeti overview and specifications: <a href="../man7/ganeti.7.html"><strong>ganeti</strong>(7)</a> (general overview), <a href="../man7/ganeti-os-interface.7.html"><strong>ganeti-os-interface</strong>(7)</a> (guest OS definitions), <a href="../man7/ganeti-extstorage-interface.7.html"><strong>ganeti-extstorage-interface</strong>(7)</a> (external storage providers).</p><p>Ganeti commands: <a href="../man8/gnt-cluster.8.html"><strong>gnt-cluster</strong>(8)</a> (cluster-wide commands), <a href="../man8/gnt-job.8.html"><strong>gnt-job</strong>(8)</a> (job-related commands), <a href="../man8/gnt-node.8.html"><strong>gnt-node</strong>(8)</a> (node-related commands), <a href="../man8/gnt-instance.8.html"><strong>gnt-instance</strong>(8)</a> (instance commands), <a href="../man8/gnt-os.8.html"><strong>gnt-os</strong>(8)</a> (guest OS commands), <a href="../man8/gnt-storage.8.html"><strong>gnt-storage</strong>(8)</a> (storage commands), <a href="../man8/gnt-group.8.html"><strong>gnt-group</strong>(8)</a> (node group commands), <a href="../man8/gnt-backup.8.html"><strong>gnt-backup</strong>(8)</a> (instance import/export commands), <a href="../man8/gnt-debug.8.html"><strong>gnt-debug</strong>(8)</a> (debug commands).</p><p>Ganeti daemons: <a href="../man8/ganeti-watcher.8.html"><strong>ganeti-watcher</strong>(8)</a> (automatic instance restarter), <a href="../man8/ganeti-cleaner.8.html"><strong>ganeti-cleaner</strong>(8)</a> (job queue cleaner), <a href="../man8/ganeti-noded.8.html"><strong>ganeti-noded</strong>(8)</a> (node daemon), <strong>ganeti-masterd</strong>(8) (master daemon), <a href="../man8/ganeti-rapi.8.html"><strong>ganeti-rapi</strong>(8)</a> (remote API daemon).</p><p>Ganeti htools: <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> (generic binary), <a href="../man1/hbal.1.html"><strong>hbal</strong>(1)</a> (cluster balancer), <a href="../man1/hspace.1.html"><strong>hspace</strong>(1)</a> (capacity calculation), <a href="../man1/hail.1.html"><strong>hail</strong>(1)</a> (IAllocator plugin), <a href="../man1/hscan.1.html"><strong>hscan</strong>(1)</a> (data gatherer from remote clusters), <a href="../man1/hinfo.1.html"><strong>hinfo</strong>(1)</a> (cluster information printer), <a href="../man7/mon-collector.7.html"><strong>mon-collector</strong>(7)</a> (data collectors interface).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2006-2014 Google Inc. All rights reserved.</p><p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p><p>1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p><p>2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p><p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="hb_takeover.1.html"><span aria-hidden="true">&larr;</span> hb_takeover.1: Issues a failover request to the cluster manager</a></li>
   <li class="next"><a href="hbcixml3.1.html">hbcixml3.1: Command line tool to work on data in a hbci xml file. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
