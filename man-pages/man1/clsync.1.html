<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>clsync: Live sync tool, written in gnu c</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Live sync tool, written in gnu c">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="clsync (1) manual">
  <meta name="twitter:description" content="Live sync tool, written in gnu c">
  <meta name="twitter:image" content="https://www.carta.tech/images/clsync-clsync-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/clsync.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="clsync (1) manual" />
  <meta property="og:description" content="Live sync tool, written in gnu c" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/clsync-clsync-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">clsync<small> (1)</small></h1>
        <p class="lead">Live sync tool, written in gnu c</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/clsync.1.html">
      <span itemprop="name">clsync: Live sync tool, written in gnu c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/clsync/">
      <span itemprop="name">clsync</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/clsync.1.html">
      <span itemprop="name">clsync: Live sync tool, written in gnu c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>clsync [ ... ]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>clsync</strong> executes <em>sync-handler</em> with appropriate arguments on FS events in directory <em>watch-dir</em> using the <a href="../man7/inotify.7.html"><strong>inotify</strong>(7)</a> Linux kernel subsystem.</p><p>Extended regex-rules to filter what files and directories to sync may be placed in <em>rules-file</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>This options can be passed as arguments or to be used in the configuration file.</p><p>To disable numeric option set to zero:</p><p>	=0</p><p>To disable string option (for example path to file) set to empty string:</p><p>	=</p><p>Also you can use previously set values while setting new options. Substring <em>%option_name%</em> will be substituted with previously set value of option <em>option_name</em>. (see <strong>CONFIGURATION FILE</strong>)</p><p><strong>-W, --watch-dir</strong> <em>watch-dir</em></p><p>Root directory to be monitored by <strong>clsync</strong>.</p><p>Required.</p><p><strong>-S, --sync-handler</strong> <em>sync-handler</em></p><p>Path to <em>sync-handler</em> to be used for syncing by <strong>clsync</strong>. (see <em>--mode</em>)</p><p>Required.</p><p><strong>-R, --rules-file</strong> <em>rules-file</em></p><p>Path to file with filter rules of objects to be monitored. (see <strong>RULES</strong>)</p><p>Is not set by default.</p><p><strong>-D, --destination-dir</strong> <em>destination-directory</em></p><p>Defines directory to sync to for modes "rsyncdirect", "rsyncso" and "so". (see <em>--mode</em>)</p><p>Is not set by default.</p><p><strong>-M, --mode</strong> <em>mode</em></p><p>Sets syncing mode. Possible values:</p><p><em>simple</em></p><p>calls <em>sync-handler</em> for every event</p><p><em>shell</em></p><p>calls <em>sync-handler</em> for every sync</p><p><em>rsyncdirect</em></p><p>calls rsync by path <em>sync-handler</em> directly (inflexible and unreliable, should be used only as a proof of concept)"</p><p><em>rsyncshell</em></p><p>calls <em>sync-handler</em> that supposed to run rsync for every sync (recommended mode)"</p><p><em>rsyncso</em></p><p>loads shared object by path <em>sync-handler</em> with  <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a> and calls function <strong>clsyncapi_rsync</strong> function for every sync</p><p><em>so</em></p><p>loads shared object by path <em>sync-handler</em> with  <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a> and calls function <strong>clsyncapi_sync</strong> function for every sync</p><p>See <strong>SYNC HANDLER MODES</strong></p><p>Required.</p><p><strong>-b, --background</strong></p><p>Daemonize, forcing clsync to fork() on start.</p><p>Is not set by default.</p><p><strong>-H, --config-file</strong> <em>config-file-path</em></p><p>Use configuration from file <em>config-file-path</em> (see <strong>CONFIGURATION FILE</strong>).</p><p>Set to "/NULL/" if no config files should be read.</p><p>Is not set by default.</p><p><strong>-K, --config-block</strong> <em>config-block-name</em></p><p>Use configuration block with name <em>config-block-name</em> (see <strong>CONFIGURATION FILE</strong>).</p><p>Default value is "default".</p><p><strong>--config-block-inherits</strong> <em>config-parent-block-name</em></p><p>Use configuration block with name <em>config-parent-block-name</em> as parent for <em>config-block-name</em> (see <strong>CONFIGURATION FILE</strong>). Options from <em>config-parent-block-name</em> will be inherited to <em>config-block-name</em>.</p><p>Default value is "default".</p><p><strong>-z, --pid-file</strong> <em>path-to-pidfile</em></p><p>Writes pid to file by path <em>path-to-pidfile</em>.</p><p>Is not set by default.</p><p><strong>--status-file</strong> <em>status-file-path</em></p><p>Write status description into file with path <em>status-file-path</em>.</p><p>Possible statuses:</p><p><em>starting</em></p><p>initializing subsystems and marking file tree with FS monitor subsystem</p><p><em>initsync</em></p><p>processing initial syncing</p><p><em>running</em></p><p>waiting for events or syncing</p><p><em>rehashing</em></p><p>reloading configuration files</p><p><em>thread gc</em></p><p>running threads' garbage collector</p><p><em>terminating</em></p><p>received signal to die, preparing to die</p><p><em>exiting</em></p><p>cleaning up [for <a href="../man1/valgrind.1.html"><strong>valgrind</strong>(1)</a>]</p><p>Is not set by default.</p><p><strong>-u, --uid</strong> <em>uid</em></p><p>Drop user privileges to uid <em>uid</em> with <a href="../man2/setuid.2.html"><strong>setuid</strong>(2)</a></p><p>Is not set by default.</p><p><strong>-g, --gid</strong> <em>gid</em></p><p>Drop group privileges to gid <em>gid</em> with <a href="../man2/setgid.2.html"><strong>setgid</strong>(2)</a></p><p>Is not set by default.</p><p><strong>-r, --retries</strong> <em>number-of-tries</em></p><p>Tries limit to sync with <em>sync-handler</em>.</p><p><strong>clsync</strong> will die after <em>number-of-tries</em> tries.</p><p>To try infinite set "0".</p><p>Delay between tries is equal to <em>--delay-sync</em> value.</p><p>Default value is "1".</p><p><strong>--ignore-failures</strong></p><p>Don't die on sync failures.</p><p>Is not set by default.</p><p><strong>-p, --threading</strong> <em>threading-mode</em></p><p>Use <a href="../man7/pthreads.7.html"><strong>pthreads</strong>(7)</a> to parallelize syncing processes. For example if <strong>clsync</strong> (with <strong>--threading=off</strong>) is already syncing a huge file then all other syncs will be suspended until the huge file syncing finish. To prevent this suspends you can use "safe" or "full" threading mode.</p><p>Possbile values:</p><p><em>off</em></p><p>disable threading for syncing processes.</p><p><em>safe</em></p><p>parallelize syncs but suspend syncings of object that are already syncing in another process (until the process finish).</p><p><em>full</em></p><p>parallelize syncs without suspendings.</p><p>Characteristics:</p><p><em>off</em></p><p>New modifications won't be synced until old ones finish.</p><p><em>safe</em></p><p>Theoretically is the best way. But may utilize of lot of CPU if there's a lot of simultaneous parallel syncs. (also this way is not well tested)</p><p><em>full</em></p><p>May cause multiple simultaneous syncing of the same file, which in turn can cause bug inside <em>sync-handler</em> (see below).</p><p>If you're running <strong>clsync</strong> with option <strong>--threading=full</strong> in conjunction with <strong>rsync</strong> with option <strong>--backup</strong>, you may catch a bug due to nonatomicity of rsync's file replace operation. (see <strong>DIAGNOSTICS</strong>)</p><p>Default value is "off".</p><p><strong>-Y, --output</strong> <em>log-destination</em></p><p>Sets destination for log writing (errors, warnings, infos and debugging).</p><p>Possible values:</p><p><em>stderr</em></p><p><em>stdout</em></p><p><em>syslog</em></p><p>Default value is "stderr".</p><p><strong>--one-file-system</strong></p><p>Don't follow to different devices' mount points. This option just adds option "FTS_XDEV" for <a href="../man3/fts_open.3.html"><strong>fts_open</strong>(3)</a> function.</p><p><strong>Warning!</strong> If you're using this option (but no --exclude-mount-points) <strong>clsync</strong> will write neither includes nor excludes of content of mount points.</p><p>This may cause problems e.g. you're using rsync for sync-handler without similar option "--one-file-system".</p><p>Is not set by default.</p><p><strong>-X, --exclude-mount-points</strong></p><p>Forces <em>--one-file-system</em> but also add excludes to do not sync mount points.</p><p>This requires to do <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> syscalls on every dir and can reduce performance.</p><p>Is not set by default.</p><p><strong>-c, --cluster-iface</strong> <em>interface-ip</em></p><p><strong>Not implemented, yet.</strong></p><p><strong>DANGEROUS OPTION. This functionality wasn't tested well. You can lost your data.</strong></p><p>Enables inter-node notifing subsystem to prevent sync looping between nodes. This's very useful features that provides ability of birectional sync of the same directory between two or more nodes. <em>interface-ip</em> is an IP-address already assigned to the interface that will be used for multicast notifing.</p><p>Not enabled by default.</p><p>To find out the IP-address on interface "eth0", you can use for example next command:</p><p>ip a s eth0 | awk '{if($1=="inet") {gsub("/.*", "", $2); print $2}}'</p><p>Is not set by default.</p><p><strong>-m, --cluster-ip</strong> <em>multicast-ip</em></p><p><strong>Not implemented yet.</strong></p><p>Sets IP-address for multicast group.</p><p>This option can be used only in conjunction with <strong>--cluster-interface</strong>.</p><p>Use IP-addresses from 224.0.0.0/4 for this option.</p><p>Default value is "227.108.115.121". [(128+"c")."l"."s"."y"]</p><p><strong>-P, --cluster-port</strong> <em>multicast-port</em></p><p><strong>Not implemented yet.</strong></p><p>Sets UDP-port number for multicast messages.</p><p>This option can be used only in conjunction with <strong>--cluster-interface</strong>.</p><p><em>multicast-port</em> should be greater than 0 and less than 65535.</p><p>Default value is "40079". [("n" &lt;&lt; 8) + "c"]</p><p><strong>-W, --cluster-timeout</strong> <em>cluster-timeout</em></p><p><strong>Not implemented yet.</strong></p><p>Sets timeout (in milliseconds) of waiting answer from another nodes of the cluster. If there's no answer from some node, it will be excluded.</p><p>Default value is "1000". [1 second]</p><p><strong>-n, --cluster-node-name</strong> <em>cluster-node-name</em></p><p><strong>Not implemented yet.</strong></p><p>Sets the name of current node in the cluster. It will be used in action scripts of another nodes (see <strong>SYNC HANDLER MODES</strong>).</p><p>Default value is $(uname -n).</p><p><strong>-o, --cluster-hash-dl-min</strong> <em>hash-dirlevel-min</em></p><p>Sets minimal directory level for ctime hashing (see <strong>CLUSTERING</strong>).</p><p>Default value is "1".</p><p><strong>-O, --cluster-hash-dl-max</strong> <em>hash-dirlevel-max</em></p><p><strong>Not implemented yet.</strong></p><p>Sets maximal directory level for ctime hashing (see <strong>CLUSTERING</strong>).</p><p>Default value is "16".</p><p><strong>--cluster-scan-dl-max</strong> <em>scan-dirlevel-max</em></p><p><strong>Not implemented yet.</strong></p><p>Sets maximal directory level for ctime scanning (see <strong>CLUSTERING</strong>).</p><p>Default value is "32".</p><p><strong>--standby-file</strong> <em>standby-file-path</em></p><p>Sets file to path that should be checked before every sync. If file exists the sync will be suspended until the file is deleted. It may be useful if you need freeze destination directory while running some scripts.</p><p>Is not set by default.</p><p><strong>--max-iterations</strong> <em>iterations-count</em></p><p>Sets synchronization iterations limit. One iteration means one sync-handler execution.</p><p><em>iterations-count</em></p><p>set to 0 means no limit (infinite loop).</p><p>set to 1 means that only initial sync will be done</p><p>set to n means that only initial sync and (n-1) sync-ups after that will be done</p><p>Hint: This option may be useful in conjunction with --exit-on-no-events to prevent infinite sync-up processes.</p><p>Default value is "0".</p><p><strong>-k, --timeout-sync</strong> <em>sync-timeout</em></p><p>Sets timeout for syncing processes. <strong>clsync</strong> will die if syncing process alive more than <em>sync-timeout</em> seconds.</p><p>Set "0" to disable the timeout.</p><p>Default value is "86400" ["24 hours"].</p><p><strong>-w, --delay-sync</strong> <em>additional-delay</em></p><p>Sets the minimal delay (in seconds) between syncs.</p><p>Default value is "30".</p><p><strong>-t, --delay-collect</strong> <em>ordinary-delay</em></p><p>Sets the delay (in seconds) to collect events about ordinary files and directories.</p><p>Default value is "30".</p><p><strong>-T, --delay-collect-bigfile</strong> <em>bigfiles-delay</em></p><p>Sets the delay (in seconds) to collect events about "big files" (see <em>--threshold-bigfile</em>).</p><p>Default value is "1800".</p><p><strong>-B, --threshold-bigfile</strong> <em>filesize-threshold</em></p><p>Sets file size threshold (in bytes) that separates ordinary files from "big files". Events about "big files" are processed in another queue with a separate collecting delay. This is supposed to be used as a means of unloading IO resources.</p><p>Default value is "134217728" ["128 MiB"].</p><p><strong>-L, --lists-dir</strong> <em>tmpdir-path</em></p><p>Sets directory path to output temporary events-lists files.</p><p>If this option is enabled, <strong>clsync</strong> will execute <em>sync-handler</em> once for each aggregated event list, passing the path to a file containing this list (actions "synclist" and "rsynclist"). Otherwise, <strong>clsync</strong> will execute <em>sync-handler</em> for every file in the aggregated event list (action "sync").</p><p>Cannot be used in mode "so".</p><p>See <strong>SYNC HANDLER MODES</strong>.</p><p>Is not set by default.</p><p><strong>--have-recursive-sync</strong></p><p>Use action "recursivesync" instead of "synclist" for directories that were just marked (see <strong>SYNC HANDLER MODES</strong> case <strong>shell</strong>).</p><p>Is not set by default.</p><p><strong>--synclist-simplify</strong></p><p>Removes the first 3 parameters in list files of action "synclist" (see <strong>SYNC HANDLER MODES</strong> case <strong>shell</strong>).</p><p>Is not set by default.</p><p><strong>-A, --auto-add-rules-w</strong></p><p>Forces clsync to create a "w-rule" for every non-"w-rule" (see <strong>RULES</strong>).</p><p>Not recommended to use in modes "rsyncdirect", "rsyncshell" and "rsyncso"</p><p>Is not set by default.</p><p><strong>--rsync-inclimit</strong> <em>rsync-includes-line-limit</em></p><p>Sets soft limit for lines count in files by path <em>rsync-listpath</em>. Unfortunately, rsync works very slowly with huge "--include-from" files. So, <strong>clsync</strong> splits that list with approximately <em>rsync-includes-line-limit</em> lines per list if it's too big, and executes by one rsync instance per list part. Use value "0" to disable the limit.</p><p>Default value is "20000".</p><p><strong>--rsync-prefer-include</strong></p><p>Forces <strong>clsync</strong> to prefer a "lot of includes" method instead of a "excludes+includes" for rsync on recursive syncing.</p><p>See cases <strong>rsyncshell</strong>, <strong>rsyncdirect</strong> and <strong>rsyncso</strong> of <strong>SYNC HANDLER MODES</strong>.</p><p>This option is not recommended.</p><p>Is not set by default.</p><p><strong>-x, --ignore-exitcode</strong> <em>exitcode</em></p><p>Forces <strong>clsync</strong> to do not process exitcode <em>exitcode</em> of <em>sync-handler</em> as an error. You can set multiple ignores by passing this option multiple times.</p><p>Recommended values for rsync case is "24". You can set multiple values with listing a lot of "-x" options (e.g. "-x 23 -x 24") or via commas (e.g. "-x 23,24"). To drop the list use zero exitcode (e.g. "-x 0"). For example you can use "-x 0,23" to drop the list and set "23"-th exitcode to be ignored.</p><p>Is not set by default (or equally is set to "0").</p><p><strong>-U, --dont-unlink-lists</strong></p><p>Do not delete list-files after <em>sync-handler</em> has finished.</p><p>This may be used for debugging purposes.</p><p>Is not set by default.</p><p><strong>-F, --full-initialsync</strong></p><p>Ignore filter rules from <em>rules-file</em> on initial sync.</p><p>This may be useful for quick start or e.g. if it's required to sync "/var/log/" tree but not sync every change from there.</p><p>Is not set by default.</p><p><strong>--only-initialsync</strong></p><p>Exit after initial syncing on clsync start.</p><p>Is not set by default.</p><p><strong>--exit-on-no-events</strong></p><p>Exit if there's no events. Works like <em>--only-initialsync</em>, but also syncs events collected while the initial syncing.</p><p>Unlike <em>--only-initialsync</em> this option uses FS monitor subsystem to monitor for new events while the initial syncing. This may reduce performance. On the other hand this way may be used to be sure, that everything is synced at the moment before clsync will exit.</p><p>Is not set by default.</p><p><strong>--skip-initialsync</strong></p><p>Skip initial syncing on clsync start.</p><p>Is not set by default.</p><p><strong>--exit-hook</strong> <em>path-of-exit-hook-program</em></p><p>Sets path of program to be executed on clsync exit.</p><p>If this parameter is set, clsync will exec on exit:</p><p><em>path-of-exit-hook-program label</em></p><p>The execution will be skipped if syncing process wasn't started.</p><p>Is not set by default.</p><p><strong>-v, --verbose</strong></p><p>This option is supposed to increase verbosity. But at the moment there's no "verbose output" in the code, so the option does nothing. :)</p><p>Is not set by default.</p><p><strong>-d, --debug</strong></p><p>Increases debugging output. This may be supplied multiple times for more debugging information, up to a maximum of five "d" flags (more will do nothing), for example "-d -d -d -d -d" or "-d5" (equivalent cases)</p><p>Is not set by default.</p><p><strong>--dump-dir</strong></p><p>Directory to write clsync's instance information by signal 29 (see <strong>SIGNALS</strong>). The directory shouldn't exists before dumping.</p><p>Is set to "/tmp/clsync-dump-%label%" by default.</p><p><strong>-q, --quiet</strong></p><p>Suppresses error messages.</p><p>Is not set by default.</p><p><strong>-f, --fanotify</strong></p><p><strong>Don't use this option!</strong></p><p>Switches monitor subsystem to "fanotify" [it's described for future-compatibility].</p><p>Is not set by default.</p><p><strong>-i, --inotify</strong></p><p>Switches monitor subsystem to "inotify".</p><p>Is set by default.</p><p><strong>-l, --label</strong> <em>label</em></p><p>Sets a label for this instance of clsync. The <em>label</em> will be passed to <em>sync-handler</em> every execution.</p><p>Default value is "nolabel".</p><p><strong>-h, --help</strong></p><p>Outputs options list and exits with exitcode "0".</p><p>Is not set by default.</p><p><strong>-V, --version</strong></p><p>Outputs clsync version and exits with exitcode "0".</p><p>Is not set by default.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNC HANDLER MODES</h2>
        <div class="sectioncontent">
<p><strong>clsync</strong> executes <em>sync-handler</em> that supposed to take care of the actual syncing process. Therefore <strong>clsync</strong> is only a convenient way to run a syncing script.</p><p><strong>clsync</strong> can run <em>sync-handler</em> in six ways. Which way will be used depends on specified mode (see <em>--mode</em>)</p><p>case <strong>simple</strong></p><p>Executes for every syncing file/dir:</p><p><em>sync-handler</em> sync <em>label evmask path [nodes]</em></p><p>In this case, <em>sync-handler</em> is supposed to non-recursively sync file or directory by <em>path</em>. With <em>evmask</em> it's passed bitmask of events with the file or directory (see "/usr/include/linux/inotify.h").</p><p>Not recommended. Not well tested.</p><p>case <strong>shell</strong></p><p>Executes for every sync (if <strong>recursivesync</strong> is not used instead):</p><p><em>sync-handler</em> synclist <em>label listpath [nodes]</em></p><p>Executes for initial syncs if option <em>--have-recursive-sync</em> is set:</p><p><em>sync-handler</em> recursivesync <em>label dirpath [nodes]</em></p><p>In this case, <em>sync-handler</em> is supposed to non-recursively sync files and directories from list in a file by path <em>listpath</em> (see below). With <em>evmask</em> it's passed bitmask of events with the file or directory (see "/usr/include/linux/inotify.h").</p><p>Also <em>sync-handler</em> is supposed to recursively sync data from directory by path <em>dirpath</em> with manual excluding extra files.</p><p>Not recommended. Not well tested.</p><p>case <strong>rsyncdirect</strong></p><p>Executes for every sync:</p><p><em>sync-handler</em> --inplace -aH --delete-before [--exclude-from <em>rsync-exclude-listpath</em> ] --include-from <em>rsync-listpath</em> --exclude '*' <em>watch-dir/ dest-dir/</em></p><p>In this case, <em>sync-handler</em> is supposed to be a path to <strong>rsync</strong> binary.</p><p>Error code "24" from <em>sync-handler</em> will be ignored in this case.</p><p>This case is supposed to be used only as a proof of concept.</p><p>case <strong>rsyncshell</strong></p><p>Executes for every sync:</p><p><em>sync-handler</em> rsynclist <em>label rsync-listpath [nodes] [rsync-exclude-listpath]</em></p><p>In this case, <em>sync-handler</em> is supposed to run "rsync" application with parameters:</p><p>-aH --delete-before --include-from <em>rsync-listpath</em> --exclude '*'</p><p>if option <em>--rsync-prefer-include</em> is enabled.</p><p>And with parameters:</p><p>-aH --delete-before --exclude-from <em>rsync-exclude-listpath</em> --include-from <em>rsync-listpath</em> --exclude '*'</p><p>if option <em>--rsync-prefer-include</em> is disabled.</p><p>Recommended case.</p><p>case <strong>rsyncso</strong></p><p>In this case there's no direct exec*() calling. In this case <strong>clsync</strong> loads <em>sync-handler</em> as a shared library with <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a> and calls function "int clsyncapi_rsync(const char *inclist, const char *exclist)" from it for every sync.</p><p><strong>inclist</strong> is a path to file with rules for "--include-from" option of rsync. This argument is always not NULL.</p><p><strong>exclist</strong> is a path to file with rules for "--exclude-from" option of rsync. This argument is NULL if <strong>--rsync-prefer-include</strong> is set.</p><p><em>Excludes takes precedence over includes.</em></p><p>Also may be defined functions "int clsyncapi_init(options_t *, indexes_t *)" and "int clsyncapi_deinit()" to initialize and deinitialize the syncing process by this shared object.</p><p>To fork the process should be used function "pid_t clsyncapi_fork(options_t *)" instead of "pid_t fork()" to make clsync be able to kill the child.</p><p>See example file "clsync-synchandler-rsyncso.c".</p><p>Recommended case. IMHO, this way is the best.</p><p>case <strong>so</strong></p><p>In this case there's no direct exec*() calling. In this case <strong>clsync</strong> loads <em>sync-handler</em> as a shared library with <a href="../man3/dlopen.3.html"><strong>dlopen</strong>(3)</a> and calls function "int clsyncapi_sync(int n, api_eventinfo_t *ei)" from it for every sync. <strong>n</strong> is number of elements of <strong>ei</strong>. <strong>ei</strong> is an array of structures with information about what and how to sync (see below).</p><p>api_eventinfo_t is a structure:</p><p>struct api_eventinfo {</p>
<pre>
        uint32_t         evmask;		// event bitmask for file/dir
</pre>
<p>by path <strong>path</strong>.</p>
<pre>
        uint32_t         flags;		// flags of "how to sync" the file/dir
</pre>

<pre>
        size_t           path_len;		// strlen(path)
</pre>

<pre>
        const char      *path;		// the
</pre>
<p><strong>path</strong> to file/dir need to be synced</p>
<pre>
        eventobjtype_t   objtype_old;	// type of object by path
</pre>
<p><strong>path</strong> before the event.</p>
<pre>
        eventobjtype_t   objtype_new;	// type of object by path
</pre>
<p><strong>path</strong> after the event.</p><p>};</p><p>typedef struct api_eventinfo api_eventinfo_t;</p><p>The event bitmask (evmask) values can be learned from "/usr/include/linux/inotify.h".</p><p>There may be next flags' values (flags):</p><p>enum eventinfo_flags {</p>
<pre>
        EVIF_NONE        = 0x00000000,	// No modifier
</pre>

<pre>
        EVIF_RECURSIVELY = 0x00000001	// sync the file/dir recursively
</pre>
<p>};</p><p>Flag "EVIF_RECURSIVELY" may be used if option <em>--have-recursive-sync</em> is set.</p><p>Is that a file or directory by path <strong>path</strong> can be determined with <strong>objtype_old</strong> and <strong>objtype_new</strong>.</p><p><strong>objtype_old</strong> reports about which type was the object by the path before the event.</p><p><strong>objtype_new</strong> reports about which type became the object by the path after the event.</p><p><strong>objtype_old</strong> and <strong>objtype_new</strong> have type <strong>eventobjtype_t</strong>.</p><p>enum eventobjtype {</p>
<pre>
        EOT_UNKNOWN     = 0,	// Unknown
</pre>

<pre>
        EOT_DOESNTEXIST = 1,	// Doesn't exist (not created yet or already deleted)
</pre>

<pre>
        EOT_FILE        = 2,	// File
</pre>

<pre>
        EOT_DIR         = 3,	// Directory
</pre>
<p>} typedef enum eventobjtype eventobjtype_t;</p><p>Also may be defined functions "int clsyncapi_init(options_t *, indexes_t *)" and "int clsyncapi_deinit()" to initialize and deinitialize the syncing process by this shared object.</p><p>To fork the process should be used function "pid_t clsyncapi_fork(options_t *)" instead of "pid_t fork()" to make clsync be able to kill the child.</p><p>See example file "clsync-synchandler-so.c".</p><p>Recommended case.</p><p>About the <em>label</em> see <em>--label</em>.</p><p><em>nodes</em> is comma-separated list of cluster nodes names where to sync to (see <em>--cluster-node-name</em>)</p><p>The listfile by path <em>listpath</em> contains lines separated by NL (without CR) of next format:</p><p>sync <em>label evmask path</em></p><p>if option <em>--synclist-simplify</em> is not set</p><p><em>path</em></p><p>if option <em>--synclist-simplify</em> is set</p><p>Every lines is supposed to be proceed by external syncer to sync file or directory by path <em>path</em>. With <em>evmask</em> it's passed bitmask of events with the file or directory (see "/usr/include/linux/inotify.h").</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT VARIABLES</h2>
        <div class="sectioncontent">
<p>Output variables - variables that are set by clsync before calling <em>sync-handler</em>.</p><p><strong>Output variables</strong></p><p>CLSYNC_STATUS - <strong>clsync</strong>'s status (see possible statuses in description of <em>--status-file</em>)</p><p>CLSYNC_ITERATION - count of done synchronizaton iterations after initial sync see --max-iterations option</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RULES</h2>
        <div class="sectioncontent">
<p>Filter riles can be placed into <em>rules-file</em> with one rule per line.</p><p>Rule format: <em>[+-][fdw*]regexp</em></p><p><em>+</em> - means include; <em>-</em> - means exclude; <em>f</em> - means file; <em>d</em> - means directory; <em>w</em> - means walking to directory; <em>*</em> - means all.</p><p>For example: -*^/[Tt]est</p><p>It's not recommended to use <em>w</em> rules in modes "rsyncdirect", "rsyncshell" and "rsyncso". <a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a> allows one to set syncing and walking only together in "--include" rules ("--files-from" is not appropriate due to problem with syncing files deletions). So there may be problems with clsync's <em>w</em> rules in this cases.</p><p>More examples:</p><p>Syncing pwdb files and sshd_config (non-rsync case):</p><p>	+f^/passwd$</p><p>	+f^/group$</p><p>	+f^/shadow$</p><p>	+f^/ssh/sshd_config$</p><p>	+w^$</p><p>	+w^/ssh$</p><p>	-*</p><p>Syncing pwdb files and sshd_config (non-rsync case with option <em>--auto-add-rules-w</em>):</p><p>	+f^/passwd$</p><p>	+f^/group$</p><p>	+f^/shadow$</p><p>	+f^/ssh/sshd_config$</p><p>	-*</p><p>Syncing pwdb files and sshd_config (rsync case):</p><p>	+f^/passwd$</p><p>	+f^/group$</p><p>	+f^/shadow$</p><p>	+f^/ssh/sshd_config$</p><p>	+d^$</p><p>	+d^/ssh$</p><p>	-*</p><p>Syncing /srv/lxc tree (rsync case):</p><p>	-d/sess(ion)?s?$</p><p>	-f/tmp/</p><p>	+*</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SIGNALS</h2>
        <div class="sectioncontent">
<p>1  - to reread filter rules</p><p>10 - runs threads' GC function</p><p>12 - runs full resync</p><p>16 - interrupts sleep()/select() and wait() [for debugging and internal uses]</p><p>29 - dump information to <em>dump-dir</em> [for debugging]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>Initial rsync process works very slow on clsync start</p><p>Probably there's too huge exclude list is passed to rsync. This can happened if you're excluding with regex in clsync's rules a lot of thousands files. They will be passed to rsync's exclude list one by one.</p><p>To diagnose it, you can use "-U" option and look into <em>rsync-exclude-listpath</em> file (see <strong>SYNC HANDLER</strong> case <strong>d</strong>)</p><p>To prevent this, it's recommended to write such rules for rsync directly (not via clsync).</p><p>For example, often problem is with PHP's session files. You shouldn't exclude them in clsync's rules with "-f/sess_.*", but you should exclude it in rsync directly (e.g with «--exclude "sess_*"»).</p><p>The following diagnostics may be issued on stderr:</p><p>Error: Cannot inotify_add_watch() on [...]: No space left on device (errno: 28)</p><p>Not enough inotify watching descriptors is allowed. It can be fixed by increasing value of "sysctl fs.inotify.max_user_watches"</p><p>Error: Got non-zero exitcode <em>exitcode</em> [...]</p><p><em>sync-handler</em> returned non-zero exitcode. Probably, you should process exitcodes in it or your syncer process didn't worked well. I case of using rsync, you can find the exitcodes meanings in <strong>man 1 rsync</strong>.</p><p>If <em>exitcode</em> equals to 23 and you're using <strong>clsync</strong> in conjunction with <strong>rsync</strong>, this may happend, for example in next cases:</p><p>- Not enough space on destination.</p><p>- You're running clsync with <strong>--threading</strong> and rsync with <strong>--backup</strong>. See bugreport by URL: <em>https://bugzilla.samba.org/show_bug.cgi?id=10081</em>.</p><p>To confirm the problem, you can try to add "return 0" or "exit 0" into your <em>sync-handler</em>.</p><p>To get support see <strong>SUPPORT</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILE</h2>
        <div class="sectioncontent">
<p><strong>clsync</strong> supports configuration file.</p><p>By default <strong>clsync</strong> tries to read next files (in specified order):</p><p>~/.clsync.conf</p><p>/etc/clsync/clsync.conf</p><p>This may be overrided with option <em>--config-file</em>.</p><p><strong>clsync</strong> reads only one configuration file. In other words, if option <em>--config-file</em> is not set and file <strong>~/.clsync.conf</strong> is accessible and parsable, <strong>clsync</strong> will not try to open <strong>/etc/clsync/clsync.conf</strong>. Command line options have precedence over config file options.</p><p>Configuration file is parsed with glib's g_key_file_* API. That means, that config should consits from groups (blocks) of key-value lines as in the example:</p><p>[default]</p><p>background = 1</p><p>mode = rsyncshell</p><p>debug = 0</p><p>output = syslog</p><p>label = default</p><p>pid-file = /var/run/clsync-%label%.pid</p><p>[debug]</p><p>config-block-inherits = default</p><p>debug = 5</p><p>background = 0</p><p>output = stderr</p><p>[test]</p><p>mode=rsyncdirect</p><p>debug=3</p><p>Also glib's <strong>gkf</strong> API doesn't support multiple assignments. If you need to list some values (e.g. exitcodes) just list them with commas in single assignment (e.g. "ignore-exitcode=23,24").</p><p>In this example there're 3 blocks are set - "default", "debug" and "test". And block "debug" inherited setup of block "default" except options "debug", "background" and "output".</p><p>By default <strong>clsync</strong> uses block with name "default". Block name can be set by option <em>--config-block</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CLUSTERING</h2>
        <div class="sectioncontent">
<p>Not implemented yet. <strong>Don't try to use cluster functionality.</strong></p><p>Not described yet.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Working examples you can try out in "/usr/share/doc/clsync/examples/" directory. Copy this directory somewhere (e.g. into "/tmp"). And try to run "clsync-start-rsync.sh" in there. Any files/directories modifications in "testdir/from" will be synced to "testdir/to" with few seconds delay.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Dmitry Yu Okunev &lt;dyokunev@ut.mephi.ru&gt; 0x8E30679C</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUPPORT</h2>
        <div class="sectioncontent">
<p>You can get support on official IRC-channel in Freenode "#clsync" or on github's issue tracking system of repository "https://github.com/xaionaro/clsync".</p><p>Don't be afraid to ask about clsync configuration, ;).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO clsync&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>, <a href="../man7/pthreads.7.html"><strong>pthreads</strong>(7)</a>, <a href="../man7/inotify.7.html"><strong>inotify</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="clp.1.html"><span aria-hidden="true">&larr;</span> clp.1: Linear program solver</a></li>
   <li class="next"><a href="clubak.1.html">clubak.1: Format output from clush/pdsh-like output and more <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
