<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>y4mdenoise: Motion-compensating yuv4mpeg-frame denoiser</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Motion-compensating yuv4mpeg-frame denoiser">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="y4mdenoise (1) manual">
  <meta name="twitter:description" content="Motion-compensating yuv4mpeg-frame denoiser">
  <meta name="twitter:image" content="https://www.carta.tech/images/mjpegtools-y4mdenoise-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/y4mdenoise.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="y4mdenoise (1) manual" />
  <meta property="og:description" content="Motion-compensating yuv4mpeg-frame denoiser" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/mjpegtools-y4mdenoise-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">y4mdenoise<small> (1)</small></h1>
        <p class="lead">Motion-compensating yuv4mpeg-frame denoiser</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/y4mdenoise.1.html">
      <span itemprop="name">y4mdenoise: Motion-compensating yuv4mpeg-frame denoiser</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/mjpegtools/">
      <span itemprop="name">mjpegtools</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/y4mdenoise.1.html">
      <span itemprop="name">y4mdenoise: Motion-compensating yuv4mpeg-frame denoiser</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>y4mdenoise</strong> [<strong>-v</strong> <em>verbosity</em>] [<strong>-p</strong> <em>parallelism</em>] [<strong>-r</strong> <em>motion-search_radius</em>] [<strong>-R</strong> <em>color_motion-search_radius</em>] [<strong>-t</strong> <em>error_tolerance</em>] [<strong>-T</strong> <em>color_error_tolerance</em>] [<strong>-z</strong> <em>zero_motion_error_tolerance</em>] [<strong>-Z</strong> <em>color_zero_motion_error_tolerance</em>] [<strong>-m</strong> <em>match-count_throttle</em>] [<strong>-M</strong> <em>match-size_throttle</em>] [<strong>-f</strong> <em>reference_frames</em>] [<strong>-B</strong>] [<strong>-I</strong> <em>interlacing_type</em>] &lt; /dev/stdin &gt; /dev/stdout</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>y4mdenoise</strong> can be used to remove noise from images in a YUV4MPEG2 stream. This is useful for cleaning old sources to increase video quality, and to reduce the bitrate needed to encode your video (e.g. for VCD and SVCD creation).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOW IT WORKS</h2>
        <div class="sectioncontent">
<p>It maintains a list of the last several frames, called reference frames.  Each reference frame is composed of reference pixels. Every time a pixel in one frame is proven to be a moved instance of a pixel in another frame, the reference-pixel incorporates its value, and produces an average value for all instances of the pixel. The oldest reference frame, therefore, gets a pretty good idea of the real value of every pixel, but of course output is delayed by the number of reference frames.</p><p>The search is not actually done one pixel at a time; it's done in terms of pixel groups.  An entire pixel-group has to match for any match to be found, but all possible pixel-groups are tested (i.e. all possible overlapping combinations are checked).  Using pixel-groups helps to establish a minimum standard for what may be considered a match, in order to avoid finding lots of really small (and really useless) matches.  Presently, intensity pixel-groups are 4x2 (i.e. 4 across and 2 down), and color pixel-groups are 2x2.</p><p>It compares every pixel-group in the current frame with all pixel-groups in the previous frame, within a given search-radius, and sorts them based on how close the match was, keeping the top contenders.  It then flood-fills each found pixel-group in turn, to determine the full size of the match.  The first match found to be big enough is applied to the image.  The number of contenders to consider, and the minimum size of a match, can be specified on the command line.</p><p>At the end of the frame, any new-frame pixels not resolved yet are considered to be new information, and a new reference-pixel is generated for each one.</p><p>A "zero-motion pass" happens each frame, before motion-detection, in an attempt to resolve most of the frame cheaply.  Its error-tolerance can be set separately.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p><strong>y4mdenoise</strong> accepts the following options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-v</strong><em> [0..2] verbosity</em></p>
  </dt>
  <dd>
    <p>0 = none, 1 = normal (per-frame pixel-detection totals), 2=debug.</p>
  </dd>
  <dt>
    <p><strong>-p</strong><em> num</em></p>
  </dt>
  <dd>
    <p>Controls the level of parallelism.  Since intensity and color are denoised separately by design, it's very easy to do each in parallel on a multiple-processor machine.  The default value is 1; that reads and writes video frames in parallel with denoising.  A value of 2 causes intensity and color to be denoised in parallel.  A value of 3 does both types of concurrency.  A value of 0 turns off all concurrency.</p>
  </dd>
  <dt>
    <p><strong>-r</strong><em> [4..] search radius</em></p>
  </dt>
  <dd>
    <p>The search radius, i.e. the maximum distance that a pixel can move and still be found by motion-detection.  The default is 16. There are no particular restrictions on the search radius, e.g. it doesn't have to be an even multiple of 4.</p>
  </dd>
  <dt>
    <p><strong>-R</strong><em> [4..] color search radius</em></p>
  </dt>
  <dd>
    <p>The search radius to use for color.  Default is whatever the main search-radius was set to.  Note that this value ends up getting scaled by the relative size of intensity & color planes in your YUV4MPEG2 stream.</p>
  </dd>
  <dt>
    <p><strong>-t</strong><em> [0..255] Error tolerance</em></p>
  </dt>
  <dd>
    <p>The largest difference between two pixels that's accepted for the two pixels to be considered equal.  The default is 3, which is good for medium-noise material like analog cable TV.  (This value will have to be changed to whatever is appropriate for your YUV4MPEG2 stream in order to avoid undesirable results.  See the instructions below.)</p>
  </dd>
  <dt>
    <p><strong>-T</strong><em> [0..255] Error tolerance for color</em></p>
  </dt>
  <dd>
    <p>The default is whatever the main error-tolerance was set to.</p>
  </dd>
  <dt>
    <p><strong>-z</strong><em> [0..255] Error tolerance for zero-motion pass</em></p>
  </dt>
  <dd>
    <p>The error-tolerance used on pixels that haven't moved.  Usually equal to the main error-tolerance or one less than that.  Default is 2.</p>
  </dd>
  <dt>
    <p><strong>-Z</strong><em> [0..255] Error tolerance for color's zero-motion pass</em></p>
  </dt>
  <dd>
    <p>The default is whatever the main zero-motion error-tolerance was set to.</p>
  </dd>
  <dt>
    <p><strong>-m</strong><em> [num] Match-count throttle</em></p>
  </dt>
  <dd>
    <p>The maximum number of pixel-group matches (within the search radius) to consider.  If more are found, only the closest matches are kept. Default is 15.</p>
  </dd>
  <dt>
    <p><strong>-M</strong><em> [num] Match-size throttle</em></p>
  </dt>
  <dd>
    <p>The minimum size of the flood-filled region generated from a match. Matches smaller than this are thrown away.  Specified in terms of pixel-groups.  Default is 3.</p>
  </dd>
  <dt>
    <p><strong>-f</strong><em> num</em></p>
  </dt>
  <dd>
    <p>The number of reference frames to keep.  Pixel values are averaged over this many frames before they're written to standard output; this also implies that output is delayed by this many frames.  Default is 10.</p>
  </dd>
  <dt>
    <p><strong>-B</strong></p>
  </dt>
  <dd>
    <p>Black-and-white mode.  Denoise only the intensity plane, and set the color plane to all white.</p>
  </dd>
  <dt>
    <p><strong>-I</strong><em> num</em></p>
  </dt>
  <dd>
    <p>Set interlacing type.  Default is taken from the YUV4MPEG2 stream. 0 means not interlaced, 1 means top-field interlaced, 2 means bottom-field interlaced.  This is useful when the signal is more naturally of some other interlacing type than its current representation (e.g. if the original was shot on film and then later it was transferred to interlaced video, it will denoise better if treated as film, i.e. non-interlaced).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TYPICAL USAGE AND TIPS</h2>
        <div class="sectioncontent">
<p>Keep in mind that all of this advice was gained through experience. (Just because one writes a tool doesn't mean one understands how it should be used, for the same reason that car designers aren't necessarily professional drivers.)</p><p>The error-threshold must be determined for every individual YUV4MPEG2 stream.  If the threshold is set too low, it'll leave noise in the video, and the denoiser will run a lot slower than it has to. If it's set too high, the denoiser will start to remove detail: the video will get blurrier, you may see topographical-like bands in the relatively flat areas of the video, and small parts of the video that should be moving will be stuck in place.  It may also run a little slower.  Additionally, just because the video came to you from a clean source (digital cable TV, LaserDisc, etc.) doesn't mean the video itself is clean; <strong>y4mdenoise</strong> is capable of picking up on noise in the original recording as well as sampling error from the video-capture device.  You will have to generate small clips of representative parts of your video, denoise them with various error thresholds, and see what looks the best.  As you gain experience with the tool, you may know what error threshold generally works with various types of sources, but you'll still want to double-check your assumptions.</p><p>Flat, shiny surfaces, like gloss-painted walls, or the polished wood floor of an indoor gymnasium, seem to require a lower error threshold than other types of video.</p><p>Here is the author's experience:</p><p> -t 1 : Digital cable TV, most LaserDiscs, DV camcorder video  -t 2 : VHS camcorder video, commercially-produced videotapes  -t 3 : Analog cable TV, VHS videotape (at the 2-hour speed)  -t 4 : VHS videotape (at the 6-hour speed)</p><p>Interlaced video that was made from non-interlaced video (e.g. a videotape or LaserDisc of a film) must be denoised as non-interlaced. Otherwise the result tends to be grainy.</p><p><strong>y4mdenoise</strong> only removes temporal noise, i.e. noise that occurs over time.  And it tends to do such a good job of this, that the spatial noise (i.e. noise that occurs in nearby areas of the same frame) tends to become very distinct.  Therefore, always pipe the output of <strong>y4mdenoise</strong> through a spatial filter such as <strong>y4mspatialfilter</strong> or <strong>yuvmedianfilter</strong>.</p><p>When producing very low bitrate video (e.g. VCD-compatible video less than 900 kbps), denoise at the output frame size, e.g. don't denoise at DVD frame size then downscale to VCD size.  That will denoise as well as condition the video for the motion-detection part of <strong>mpeg2enc</strong>.  Not doing this will produce video where the less complex scenes will look really good, but high-motion scenes will blur significantly.</p><p>JPEG compression of your video frames, even 100% compression, seems to be inaccurate enough to affect MPEG encoding.  Therefore, if you're using motion-JPEG files as your intermediary video format, you may want to use the denoiser in your MPEG-encoding pipeline, i.e. after <strong>lav2yuv</strong> and before <strong>mpeg2enc</strong>.  If you're generating multiple resolutions of the same video, e.g. DVD and VCD, experience shows that it's acceptable to run <strong>y4mdenoise</strong> before <strong>yuv2lav</strong>, but you should still use the spatial-filter (e.g. <strong>y4mspatialfilter</strong>, <strong>yuvmedianfilter</strong>) in the MPEG-encoding pipeline, to try to smooth away JPEG encoding artifacts.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>The bulk of the <strong>y4mdenoise</strong> code, and this manual page, was written by Steven Boswell &lt;ulatec@users.sourceforge.net&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FURTHER INFO</h2>
        <div class="sectioncontent">
<p>If you have questions, remarks, problems or you just want to contact the developers, the main mailing list for the MJPEG-tools is:</p><p><strong></strong><em>mjpeg-users@lists.sourceforge.net</em><strong></strong></p><p>For more info, see our website at</p><p><strong></strong><em>http://mjpeg.sourceforge.net/</em><strong></strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO y4mdenoise&hellip;</h2>
        <div class="sectioncontent">
<p><strong>mjpegtools</strong>(1), <a href="../man1/mpeg2enc.1.html"><strong>mpeg2enc</strong>(1)</a>, <a href="../man1/yuvdenoise.1.html"><strong>yuvdenoise</strong>(1)</a>, <a href="../man1/yuvmedianfilter.1.html"><strong>yuvmedianfilter</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="y2racc.1.html"><span aria-hidden="true">&larr;</span> y2racc.1: Yacc grammar to racc grammar</a></li>
   <li class="next"><a href="y4munsharp.1.html">y4munsharp.1: Unsharp filter for yuv4mpeg2 streams <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
