<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>hroller: Cluster rolling maintenance scheduler for ganeti</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Cluster rolling maintenance scheduler for ganeti">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="hroller (1) manual">
  <meta name="twitter:description" content="Cluster rolling maintenance scheduler for ganeti">
  <meta name="twitter:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hroller-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/hroller.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="hroller (1) manual" />
  <meta property="og:description" content="Cluster rolling maintenance scheduler for ganeti" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hroller-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">hroller<small> (1)</small></h1>
        <p class="lead">Cluster rolling maintenance scheduler for ganeti</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hroller.1.html">
      <span itemprop="name">hroller: Cluster rolling maintenance scheduler for ganeti</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ganeti-htools-2.12/">
      <span itemprop="name">ganeti-htools-2.12</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hroller.1.html">
      <span itemprop="name">hroller: Cluster rolling maintenance scheduler for ganeti</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>hroller</strong> {backend options...} [algorithm options...] [reporting options...]</p><p><strong>hroller</strong> --version</p><p>Backend options:</p><p>{ <strong>-m</strong> <em>cluster</em> | <strong>-L[</strong> <em>path</em> <strong>]</strong> | <strong>-t</strong> <em>data-file</em> | <strong>-I</strong> <em>path</em> }</p><p><strong>[ --force ]</strong></p><p>Algorithm options:</p><p><strong>[ -G </strong><em>name</em> ] <strong>[ -O </strong><em>name...</em> ] <strong>[</strong> --node-tags <em>tag,..</em> <strong>]</strong> <strong>[ --skip-non-redundant</strong> ]</p><p><strong>[ --offline-maintenance ]</strong> <strong>[ --ignore-non-redundant ]</strong></p><p>Reporting options:</p><p><strong>[ -v... | -q ]</strong> <strong>[ -S </strong><em>file</em> ] <strong>[</strong> --one-step-only ] <strong>[ --print-moves ]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>hroller is a cluster maintenance reboot scheduler. It can calculate which set of nodes can be rebooted at the same time while avoiding having both primary and secondary nodes being rebooted at the same time.</p><p>For backends that support identifying the master node (currently RAPI and LUXI), the master node is scheduled as the last node in the last reboot group. Apart from this restriction, larger reboot groups are put first.</p><h3>ALGORITHM FOR CALCULATING OFFLINE REBOOT GROUPS</h3>
<p>hroller will view the nodes as vertices of an undirected graph, with two kind of edges. Firstly, there are edges from the primary to the secondary node of every instance. Secondly, two nodes are connected by an edge if they are the primary nodes of two instances that have the same secondary node. It will then color the graph using a few different heuristics, and return the minimum-size color set found. Node with the same color can then simultaneously migrate all instance off to their respective secondary nodes, and it is safe to reboot them simultaneously.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>For a description of the standard options check <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> and <a href="../man1/hbal.1.html"><strong>hbal</strong>(1)</a>.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--force</strong></p>
  </dt>
  <dd>
    <p>Do not fail, even if the master node cannot be determined.</p>
  </dd>
  <dt>
    <p><strong>--node-tags </strong><em>tag,...</em></p>
  </dt>
  <dd>
    <p>Restrict to nodes having at least one of the given tags.</p>
  </dd>
  <dt>
    <p><strong>--full-evacuation</strong></p>
  </dt>
  <dd>
    <p>Also plan moving secondaries out of the nodes to be rebooted. For each instance the move is at most a migrate (if it was primary on that node) followed by a replace secondary.</p>
  </dd>
  <dt>
    <p><strong>--skip-non-redundant</strong></p>
  </dt>
  <dd>
    <p>Restrict to nodes not hosting any non-redundant instance.</p>
  </dd>
  <dt>
    <p><strong>--offline-maintenance</strong></p>
  </dt>
  <dd>
    <p>Pretend that all instances are shutdown before the reboots are carried out. I.e., only edges from the primary to the secondary node of an instance are considered.</p>
  </dd>
  <dt>
    <p><strong>--ignore-non-redundnant</strong></p>
  </dt>
  <dd>
    <p>Pretend that the non-redundant instances do not exist, and only take instances with primary and secondary node into account.</p>
  </dd>
  <dt>
    <p><strong>--one-step-only</strong></p>
  </dt>
  <dd>
    <p>Restrict to the first reboot group. Output the group one node per line.</p>
  </dd>
  <dt>
    <p><strong>--print-moves</strong></p>
  </dt>
  <dd>
    <p>After each group list for each affected instance a node where it can be evacuated to. The moves are computed under the assumption that after each reboot group, all instances are moved back to their initial position.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>If instances are online the tool should refuse to do offline rolling maintenances, unless explicitly requested.</p><p>End-to-end shelltests should be provided.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<h3>Online Rolling reboots, using tags</h3>
<p>Selecting by tags and getting output for one step only can be used for planing the next maintenance step.</p><ul>
<li>
<pre>
$&nbsp;hroller&nbsp;--node-tags&nbsp;needsreboot&nbsp;--one-step-only&nbsp;-L
\[aq]First&nbsp;Reboot&nbsp;Group\[aq]
&nbsp;node1.example.com
&nbsp;node3.example.com

</pre>
</li>
</ul><p>Typically these nodes would be drained and migrated.</p><ul>
<li>
<pre>
$&nbsp;GROUP=`hroller&nbsp;--node-tags&nbsp;needsreboot&nbsp;--one-step-only&nbsp;--no-headers&nbsp;-L`
$&nbsp;for&nbsp;node&nbsp;in&nbsp;$GROUP;&nbsp;do&nbsp;gnt-node&nbsp;modify&nbsp;-D&nbsp;yes&nbsp;$node;&nbsp;done
$&nbsp;for&nbsp;node&nbsp;in&nbsp;$GROUP;&nbsp;do&nbsp;gnt-node&nbsp;migrate&nbsp;-f&nbsp;--submit&nbsp;$node;&nbsp;done

</pre>
</li>
</ul><p>After maintenance, the tags would be removed and the nodes undrained.</p>
<h3>Offline Rolling node reboot output</h3>
<p>If all instances are shut down, usually larger node groups can be found.</p><ul>
<li>
<pre>
$&nbsp;hroller&nbsp;--offline-maintainance&nbsp;-L
\[aq]Node&nbsp;Reboot&nbsp;Groups\[aq]
node1.example.com,node3.example.com,node5.example.com
node8.example.com,node6.example.com,node2.example.com
node7.example.com,node4.example.com

</pre>
</li>
</ul>
<h3>Rolling reboots with non-redundant instances</h3>
<p>By default, hroller plans capacity to move the non-redundant instances out of the nodes to be rebooted. If requested, apropriate locations for the non-redundant instances can be shown. The assumption is that instances are moved back to their original node after each reboot; these back moves are not part of the output.</p><ul>
<li>
<pre>
$&nbsp;hroller&nbsp;--print-moves&nbsp;-L
\[aq]Node&nbsp;Reboot&nbsp;Groups\[aq]
node-01-002,node-01-003
&nbsp;&nbsp;inst-20&nbsp;node-01-001
&nbsp;&nbsp;inst-21&nbsp;node-01-000
&nbsp;&nbsp;inst-30&nbsp;node-01-005
&nbsp;&nbsp;inst-31&nbsp;node-01-004
node-01-004,node-01-005
&nbsp;&nbsp;inst-40&nbsp;node-01-001
&nbsp;&nbsp;inst-41&nbsp;node-01-000
&nbsp;&nbsp;inst-50&nbsp;node-01-003
&nbsp;&nbsp;inst-51&nbsp;node-01-002
node-01-001,node-01-000
&nbsp;&nbsp;inst-00&nbsp;node-01-002
&nbsp;&nbsp;inst-01&nbsp;node-01-003
&nbsp;&nbsp;inst-10&nbsp;node-01-005
&nbsp;&nbsp;inst-11&nbsp;node-01-004

</pre>
</li>
</ul>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to project website (http://code.google.com/p/ganeti/) or contact the developers using the Ganeti mailing list (ganeti@googlegroups.com).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO hroller&hellip;</h2>
        <div class="sectioncontent">
<p>Ganeti overview and specifications: <a href="../man7/ganeti.7.html"><strong>ganeti</strong>(7)</a> (general overview), <a href="../man7/ganeti-os-interface.7.html"><strong>ganeti-os-interface</strong>(7)</a> (guest OS definitions), <a href="../man7/ganeti-extstorage-interface.7.html"><strong>ganeti-extstorage-interface</strong>(7)</a> (external storage providers).</p><p>Ganeti commands: <a href="../man8/gnt-cluster.8.html"><strong>gnt-cluster</strong>(8)</a> (cluster-wide commands), <a href="../man8/gnt-job.8.html"><strong>gnt-job</strong>(8)</a> (job-related commands), <a href="../man8/gnt-node.8.html"><strong>gnt-node</strong>(8)</a> (node-related commands), <a href="../man8/gnt-instance.8.html"><strong>gnt-instance</strong>(8)</a> (instance commands), <a href="../man8/gnt-os.8.html"><strong>gnt-os</strong>(8)</a> (guest OS commands), <a href="../man8/gnt-storage.8.html"><strong>gnt-storage</strong>(8)</a> (storage commands), <a href="../man8/gnt-group.8.html"><strong>gnt-group</strong>(8)</a> (node group commands), <a href="../man8/gnt-backup.8.html"><strong>gnt-backup</strong>(8)</a> (instance import/export commands), <a href="../man8/gnt-debug.8.html"><strong>gnt-debug</strong>(8)</a> (debug commands).</p><p>Ganeti daemons: <a href="../man8/ganeti-watcher.8.html"><strong>ganeti-watcher</strong>(8)</a> (automatic instance restarter), <a href="../man8/ganeti-cleaner.8.html"><strong>ganeti-cleaner</strong>(8)</a> (job queue cleaner), <a href="../man8/ganeti-noded.8.html"><strong>ganeti-noded</strong>(8)</a> (node daemon), <strong>ganeti-masterd</strong>(8) (master daemon), <a href="../man8/ganeti-rapi.8.html"><strong>ganeti-rapi</strong>(8)</a> (remote API daemon).</p><p>Ganeti htools: <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> (generic binary), <a href="../man1/hbal.1.html"><strong>hbal</strong>(1)</a> (cluster balancer), <a href="../man1/hspace.1.html"><strong>hspace</strong>(1)</a> (capacity calculation), <a href="../man1/hail.1.html"><strong>hail</strong>(1)</a> (IAllocator plugin), <a href="../man1/hscan.1.html"><strong>hscan</strong>(1)</a> (data gatherer from remote clusters), <a href="../man1/hinfo.1.html"><strong>hinfo</strong>(1)</a> (cluster information printer), <a href="../man7/mon-collector.7.html"><strong>mon-collector</strong>(7)</a> (data collectors interface).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2006-2014 Google Inc. All rights reserved.</p><p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p><p>1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p><p>2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p><p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="hrmdir.1.html"><span aria-hidden="true">&larr;</span> hrmdir.1: Remove an empty hfs directory</a></li>
   <li class="next"><a href="hrpt_decode.1.html">hrpt_decode.1: Decode noaa high rate picture transmission <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
