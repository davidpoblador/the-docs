<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lshell: Limited shell</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Limited shell">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="lshell (1) manual">
  <meta name="twitter:description" content="Limited shell">
  <meta name="twitter:image" content="https://www.carta.tech/images/lshell-lshell-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/lshell.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="lshell (1) manual" />
  <meta property="og:description" content="Limited shell" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/lshell-lshell-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">lshell<small> (1)</small></h1>
        <p class="lead">Limited shell</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/lshell.1.html">
      <span itemprop="name">lshell: Limited shell</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/lshell/">
      <span itemprop="name">lshell</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/lshell.1.html">
      <span itemprop="name">lshell: Limited shell</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>lshell</strong> [<em>OPTIONS</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>lshell</strong> provides a limited shell configured per user. The configuration is done quite simply using a configuration file. Coupled with ssh's <em>authorized_keys</em> or with <em>/etc/shells</em> and <em>/etc/passwd</em> , it becomes very easy to restrict user's access to a limited set of command.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>--config </strong><em>&lt;FILE&gt;</em></p>
  </dt>
  <dd>
    <p>Specify config file</p>
  </dd>
  <dt>
    <p><strong>--log </strong><em>&lt;DIR&gt;</em></p>
  </dt>
  <dd>
    <p>Specify the log directory</p>
  </dd>
  <dt>
    <p><strong>--&lt;param&gt; </strong><em>&lt;value&gt;</em></p>
  </dt>
  <dd>
    <p>where &lt;param&gt; is *any* config file parameter</p>
  </dd>
  <dt>
    <p><strong>-h, --help</strong></p>
  </dt>
  <dd>
    <p>Show help message</p>
  </dd>
  <dt>
    <p><strong>--version</strong></p>
  </dt>
  <dd>
    <p>Show version</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>You can configure lshell through its configuration file:</p>
<pre>
On Linux -&gt; /etc/lshell.conf
On *BSD  -&gt; /usr/{pkg,local}/etc/lshell.conf

</pre>
<p><strong>lshell</strong> configuration has 4 types of sections:</p>
<pre>
[global]   -&gt; lshell system configuration (only 1)
[default]  -&gt; lshell default user configuration (only 1)
[foo]      -&gt; UNIX username "foo" specific configuration
[grp:bar]  -&gt; UNIX groupname "bar" specific configuration

</pre>
<p>Order of priority when loading preferences is the following:</p>
<pre>
1- User configuration
2- Group configuration
3- Default configuration

</pre>
<h3>[global]</h3>

<dl class='dl-vertical'>
  <dt>
    <p><em>logpath</em></p>
  </dt>
  <dd>
    <p>config path (default is /var/log/lshell/)</p>
  </dd>
  <dt>
    <p><em>loglevel</em></p>
  </dt>
  <dd>
    <p>0, 1, 2, 3 or 4  (0: no logs -&gt; 4: logs everything)</p>
  </dd>
  <dt>
    <p><em>logfilename</em></p>
  </dt>
  <dd>
    <p>- set to <strong>syslog</strong> in order to log to syslog</p><p>- set log file name, e.g. %u-%y%m%d (i.e foo-20091009.log): <strong></strong><strong></strong><strong>%u</strong> -&gt; username</p><p><strong></strong><strong></strong><strong>%d</strong> -&gt; day   [1..31]</p><p><strong></strong><strong></strong><strong>%m</strong> -&gt; month [1..12]</p><p><strong></strong><strong></strong><strong>%y</strong> -&gt; year  [00..99]</p><p><strong></strong><strong></strong><strong>%h</strong> -&gt; time  [00:00..23:59]</p>
  </dd>
  <dt>
    <p><em>syslogname</em></p>
  </dt>
  <dd>
    <p>in case you are using syslog, set your logname (default: lshell)</p>
  </dd>

</dl>

<h3>[default] and/or [username] and/or [grp:groupname]</h3>

<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><em>aliases</em></p>
  </dt>
  <dd>
    <p>command aliases list (similar to bash's alias directive)</p>
  </dd>
  <dt>
    <p><em>allowed</em></p>
  </dt>
  <dd>
    <p>a list of the allowed commands or set to 'all' to allow all commands in user's  PATH</p>
  </dd>
  <dt>
    <p><em>allowed_cmd_path</em></p>
  </dt>
  <dd>
    <p>a list of path; all executable files inside these path will be allowed</p>
  </dd>
  <dt>
    <p><em>env_path</em></p>
  </dt>
  <dd>
    <p>update the environment variable $PATH of the user (optional)</p>
  </dd>
  <dt>
    <p><em>env_vars</em></p>
  </dt>
  <dd>
    <p>set environment variables (optional)</p>
  </dd>
  <dt>
    <p><em>forbidden</em></p>
  </dt>
  <dd>
    <p>a list of forbidden characters or commands</p>
  </dd>
  <dt>
    <p><em>history_file</em></p>
  </dt>
  <dd>
    <p>set the history filename. A wildcard can be used:</p><p><strong></strong><strong></strong><strong>%u</strong> -&gt; username (e.g. '/home/%u/.lhistory')</p>
  </dd>
  <dt>
    <p><em>history_size</em></p>
  </dt>
  <dd>
    <p>set the maximum size (in lines) of the history file</p>
  </dd>
  <dt>
    <p><em>home_path (deprecated)</em></p>
  </dt>
  <dd>
    <p>set the home folder of your user. If not specified, the home directory is set  to the $HOME environment variable. This variable will be removed in the next  version of lshell, please use your system's tools to set a user's home  directory. A wildcard can be used:</p><p><strong></strong><strong></strong><strong>%u</strong> -&gt; username (e.g. '/home/%u')</p>
  </dd>
  <dt>
    <p><em>intro</em></p>
  </dt>
  <dd>
    <p>set the introduction to print at login</p>
  </dd>
  <dt>
    <p><em>login_script</em></p>
  </dt>
  <dd>
    <p>define the script to run at user login</p>
  </dd>
  <dt>
    <p><em>passwd</em></p>
  </dt>
  <dd>
    <p>password of specific user (default is empty)</p>
  </dd>
  <dt>
    <p><em>path</em></p>
  </dt>
  <dd>
    <p>list of path to restrict the user geographically. It is possible to use  wildcards (e.g. '/var/log/ap*').</p>
  </dd>
  <dt>
    <p><em>prompt</em></p>
  </dt>
  <dd>
    <p>set the user's prompt format (default: username)</p><p><strong></strong><strong></strong><strong>%u</strong> -&gt; username</p><p><strong></strong><strong></strong><strong>%h</strong> -&gt; hostname</p>
  </dd>
  <dt>
    <p><em>prompt_short</em></p>
  </dt>
  <dd>
    <p>set sort prompt current directory update - set to 1 or 0 <em>overssh</em> list of command allowed to execute over ssh (e.g. rsync, rdiff-backup, scp,  etc.)</p>
  </dd>
  <dt>
    <p><em>scp</em></p>
  </dt>
  <dd>
    <p>allow or forbid the use of scp connection - set to 1 or 0</p>
  </dd>
  <dt>
    <p><em>scpforce</em></p>
  </dt>
  <dd>
    <p>force files sent through scp to a specific directory</p>
  </dd>
  <dt>
    <p><em>scp_download</em></p>
  </dt>
  <dd>
    <p>set to 0 to forbid scp downloads (default is 1)</p>
  </dd>
  <dt>
    <p><em>scp_upload</em></p>
  </dt>
  <dd>
    <p>set to 0 to forbid scp uploads (default is 1)</p>
  </dd>
  <dt>
    <p><em>sftp</em></p>
  </dt>
  <dd>
    <p>allow or forbid the use of sftp connection - set to 1 or 0</p>
  </dd>
  <dt>
    <p><em>sudo_commands</em></p>
  </dt>
  <dd>
    <p>a list of the allowed commands that can be used with <strong>sudo</strong>(8)</p>
  </dd>
  <dt>
    <p><em>timer</em></p>
  </dt>
  <dd>
    <p>a value in seconds for the session timer</p>
  </dd>
  <dt>
    <p><em>strict</em></p>
  </dt>
  <dd>
    <p>logging strictness. If set to 1, any unknown command is considered as  forbidden, and user's warning counter is decreased. If set to 0, command is  considered as unknown, and user is only warned (i.e. *** unknown synthax)</p>
  </dd>
  <dt>
    <p><em>warning_counter</em></p>
  </dt>
  <dd>
    <p>number of warnings when user enters a forbidden value before getting exited  from lshell. Set to <strong>-1</strong>  to disable the counter, and just warn the user.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SHELL BUILTIN COMMANDS</h2>
        <div class="sectioncontent">
<p>Here is the set of commands that are always available with lshell:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>clear</em></p>
  </dt>
  <dd>
    <p>clears the terminal</p>
  </dd>
  <dt>
    <p><em>help, ?</em></p>
  </dt>
  <dd>
    <p>print the list of allowed commands</p>
  </dd>
  <dt>
    <p><em>history</em></p>
  </dt>
  <dd>
    <p>print the commands history</p>
  </dd>
  <dt>
    <p><em>lpath</em></p>
  </dt>
  <dd>
    <p>lists all allowed and forbidden path</p>
  </dd>
  <dt>
    <p><em>lsudo</em></p>
  </dt>
  <dd>
    <p>lists all sudo allowed commands</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ lshell</strong></p>
  </dt>
  <dd>
    <p>Tries to run lshell using default ${PREFIX}/etc/lshell.conf as configuration  file. If it fails a warning is printed and lshell is interrupted. lshell options are loaded from the configuration file</p>
  </dd>
  <dt>
    <p><strong>$ lshell --config /path/to/myconf.file --log /path/to/mylog.log</strong></p>
  </dt>
  <dd>
    <p>This will override the default options specified for configuration and/or log  file</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USE CASE</h2>
        <div class="sectioncontent">
<p>The primary goal of lshell, was to be able to create shell accounts  with ssh access and restrict their environment to a couple a needed  commands. In this example, User 'foo' and user 'bar' both belong to the 'users' UNIX  group:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>User foo:</strong></p>
  </dt>
  <dd>
    <p> - must be able to access /usr and /var but not /usr/local  - user all command in his PATH but 'su'  - has a warning counter set to 5  - has his home path set to '/home/users'</p>
  </dd>
  <dt>
    <p><strong>User bar:</strong></p>
  </dt>
  <dd>
    <p> - must be able to access /etc and /usr but not /usr/local  - is allowed default commands plus 'ping' minus 'ls'  - strictness is set to 1 (meaning he is not allowed to type an unknown command)</p><p>In this case, my configuration file will look something like this:</p>
<pre>
# CONFIURATION START
[global]
logpath         : /var/log/lshell/
loglevel        : 2

[default]
allowed         : ['ls','pwd']
forbidden       : [';', '&', '|']
warning_counter : 2
timer           : 0
path            : ['/etc', '/usr']
env_path        : ':/sbin:/usr/bin/'
scp             : 1 # or 0
sftp            : 1 # or 0
overssh         : ['rsync','ls']
aliases         : {'ls':'ls --color=auto','ll':'ls -l'}

[grp:users]
warning_counter : 5
overssh         : - ['ls']

[foo]
allowed         : 'all' - ['su']
path            : ['/var', '/usr'] - ['/usr/local']
home_path       : '/home/users'

[bar]
allowed         : + ['ping'] - ['ls']
path            : - ['/usr/local']
strict          : 1
scpforce        : '/home/bar/uploads/'
# CONFIURATION END

</pre>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>In order to log a user's warnings into the logging directory (default  <em>/var/log/lshell/</em>) , you must firt create the folder (if it doesn't  exist yet) and chown it to lshell group:</p>
  </dt>
  <dd>
    
<pre>
# addgroup --system lshell
# mkdir /var/log/lshell
# chown :lshell /var/log/lshell
# chmod 770 /var/log/lshell

</pre>
<p>then add the user to the <em>lshell</em> group:</p>
<pre>
# usermod -aG lshell user_name

</pre>
<p>In order to set lshell as default shell for a user:</p>
<pre>
On Linux:
# chsh -s /usr/bin/lshell user_name

On *BSD:
# chsh -s /usr/{pkg,local}/bin/lshell user_name

</pre>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Currently maintained by Ignace Mouzannar (ghantoos)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EMAIL</h2>
        <div class="sectioncontent">
<p>Feel free to send me your recommendations at &lt;ghantoos@ghantoos.org&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lsh-writekey.1.html"><span aria-hidden="true">&larr;</span> lsh-writekey.1: Keypair split/store handler.</a></li>
   <li class="next"><a href="lshg.1.html">lshg.1: Secsh (ssh2) client <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
