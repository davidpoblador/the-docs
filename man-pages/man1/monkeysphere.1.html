<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>monkeysphere: Monkeysphere client user interface</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Monkeysphere client user interface">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="monkeysphere (1) manual">
  <meta name="twitter:description" content="Monkeysphere client user interface">
  <meta name="twitter:image" content="https://www.carta.tech/images/monkeysphere-monkeysphere-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/monkeysphere.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="monkeysphere (1) manual" />
  <meta property="og:description" content="Monkeysphere client user interface" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/monkeysphere-monkeysphere-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">monkeysphere<small> (1)</small></h1>
        <p class="lead">Monkeysphere client user interface</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/monkeysphere.1.html">
      <span itemprop="name">monkeysphere: Monkeysphere client user interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/monkeysphere/">
      <span itemprop="name">monkeysphere</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/monkeysphere.1.html">
      <span itemprop="name">monkeysphere: Monkeysphere client user interface</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>monkeysphere </strong><em>subcommand</em><strong> [</strong><em>args</em><strong>]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Monkeysphere</strong> is a framework to leverage the OpenPGP web of trust for OpenSSH and TLS key-based authentication.  OpenPGP keys are tracked via GnuPG, and added to the authorized_keys and known_hosts files used by OpenSSH for connection authentication.  Monkeysphere can also be used by a validation agent to validate TLS connections (e.g. https).</p><p><strong>monkeysphere</strong> is the Monkeysphere client utility.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SUBCOMMANDS</h2>
        <div class="sectioncontent">
<p><strong>monkeysphere</strong> takes various subcommands:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>update-known_hosts [HOST]...</strong></p>
  </dt>
  <dd>
    <p>Update the known_hosts file.  For each specified host, gpg will be queried for a key associated with the host URI (see HOST IDENTIFICATION in <a href="../man7/monkeysphere.7.html"><strong>monkeysphere</strong>(7)</a>),</strong> optionally querying a keyserver. If an acceptable key is found for the host (see KEY ACCEPTABILITY in <a href="../man7/monkeysphere.7.html"><strong>monkeysphere</strong>(7)</a>),</strong> the key is added to the user's known_hosts file.  If a key is found but is unacceptable for the host, any matching keys are removed from the user's known_hosts file.  If no gpg key is found for the host, nothing is done.  If no hosts are specified, all hosts listed in the known_hosts file will be processed.  This subcommand will exit with a status of 0 if at least one acceptable key was found for a specified host, 1 if no matching keys were found at all, and 2 if matching keys were found but none were acceptable.  `k' may be used in place of `update-known_hosts'.</p>
  </dd>
  <dt>
    <p><strong>update-authorized_keys</strong></p>
  </dt>
  <dd>
    <p>Update the authorized_keys file for the user executing the command (see MONKEYSPHERE_AUTHORIZED_KEYS in ENVIRONMENT, below).  First all monkeysphere keys are cleared from the authorized_keys file.  Then, for each user ID in the user's authorized_user_ids file, gpg will be queried for keys associated with that user ID, optionally querying a keyserver.  If an acceptable key is found (see KEY ACCEPTABILITY in <a href="../man7/monkeysphere.7.html"><strong>monkeysphere</strong>(7)</a>), the key is added to the user's authorized_keys file. If a key is found but is unacceptable for the user ID, any matching keys are removed from the user's authorized_keys file.  If no gpg key is found for the user ID, nothing is done.  This subcommand will exit with a status of 0 if at least one acceptable key was found for a user ID, 1 if no matching keys were found at all, and 2 if matching keys were found but none were acceptable.  `a' may be used in place of `update-authorized_keys'.</p>
  </dd>
  <dt>
    <p><strong>gen-subkey [KEYID]</strong></p>
  </dt>
  <dd>
    <p>Generate an authentication subkey for a private key in your GnuPG keyring.  KEYID is the key ID for the primary key for which the subkey with "authentication" capability will be generated.  If no key ID is specified, but only one key exists in the secret keyring, that key will be used.  The length of the generated key can be specified with the `--length' or `-l' option.  `g' may be used in place of `gen-subkey'.</p>
  </dd>
  <dt>
    <p><strong>ssh-proxycommand [--no-connect] HOST [PORT]</strong></p>
  </dt>
  <dd>
    <p>An ssh ProxyCommand that can be used to trigger a monkeysphere update of the ssh known_hosts file for a host that is being connected to with ssh.  This works by updating the known_hosts file for the host first, before an attempted connection to the host is made.  Once the known_hosts file has been updated, a TCP connection to the host is made by exec'ing <strong>netcat</strong>(1).  Regular ssh communication is then done over this netcat TCP connection (see ProxyCommand in <strong>ssh_config</strong>(5) for more info).</p><p>This command is meant to be run as the ssh "ProxyCommand".  This can either be done by specifying the proxy command on the command line:</p><p><strong>ssh -o ProxyCommand="monkeysphere ssh-proxycommand %h %p" ...</strong></p><p>or by adding the following line to your ~/.ssh/config script:</p><p><strong>ProxyCommand monkeysphere ssh-proxycommand %h %p</strong></p><p>The script can easily be incorporated into other ProxyCommand scripts by calling it with the "--no-connect" option, i.e.:</p><p><strong>monkeysphere ssh-proxycommand --no-connect $HOST $PORT</strong></p><p>This will run everything except the final exec of netcat to make the TCP connection to the host.  In this way this command can be added to another proxy command that does other stuff, and then makes the connection to the host itself.  For example, in ~/.ssh/config:</p><p><strong>ProxyCommand sh -c 'monkeysphere ssh-proxycommand --no-connect %h %p ; ssh -W %h:%p jumphost.example.net'</strong></p><p>KEYSERVER CHECKING: The proxy command has a fairly nuanced policy for when keyservers are queried when processing a host.  If the host userID is not found in either the user's keyring or in the known_hosts file, then the keyserver is queried for the host userID.  If the host userID is found in the user's keyring, then the keyserver is not checked.  This assumes that the keyring is kept up-to-date, in a cronjob or the like, so that revocations are properly handled.  If the host userID is not found in the user's keyring, but the host is listed in the known_hosts file, then the keyserver is not checked.  This last policy might change in the future, possibly by adding a deferred check, so that hosts that go from non-monkeysphere-enabled to monkeysphere-enabled will be properly checked.</p><p>Setting the CHECK_KEYSERVER variable in the config file or the MONKEYSPHERE_CHECK_KEYSERVER environment variable to either `true' or `false' will override the keyserver-checking policy defined above and either always or never check the keyserver for host key updates.</p>
  </dd>
  <dt>
    <p><strong>subkey-to-ssh-agent [ssh-add arguments]</strong></p>
  </dt>
  <dd>
    <p>Push all authentication-capable subkeys in your GnuPG secret keyring into your running ssh-agent.  Additional arguments are passed through to <strong>ssh-add</strong>(1). For example, to remove the authentication subkeys, pass an additional `-d' argument.  To require confirmation on each use of the key, pass `-c'.  The MONKEYSPHERE_SUBKEYS_FOR_AGENT environment can be used to specify the full fingerprints of specific keys to add to the agent (space separated), instead of adding them all.  `s' may be used in place of `subkey-to-ssh-agent'.</p>
  </dd>
  <dt>
    <p><strong>keys-for-userid USERID</strong></p>
  </dt>
  <dd>
    <p>Output to stdout all acceptable keys for a given user ID. `u' may be used in place of `keys-for-userid'.</p>
  </dd>
  <dt>
    <p><strong>sshfprs-for-userid USERID</strong></p>
  </dt>
  <dd>
    <p>Output the ssh fingerprints of acceptable keys for a given user ID.</p>
  </dd>
  <dt>
    <p><strong>version</strong></p>
  </dt>
  <dd>
    <p>Show the monkeysphere version number.  `v' may be used in place of `version'.</p>
  </dd>
  <dt>
    <p><strong>help</strong></p>
  </dt>
  <dd>
    <p>Output a brief usage summary.  `h' or `?' may be used in place of `help'.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>The following environment variables will override those specified in the monkeysphere.conf configuration file (defaults in parentheses):</p>
<dl class='dl-vertical'>
  <dt>
    <p>MONKEYSPHERE_LOG_LEVEL</p>
  </dt>
  <dd>
    <p>Set the log level.  Can be SILENT, ERROR, INFO, VERBOSE, DEBUG, in increasing order of verbosity. (INFO)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_GNUPGHOME, GNUPGHOME</p>
  </dt>
  <dd>
    <p>GnuPG home directory. (~/.gnupg)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_KEYSERVER</p>
  </dt>
  <dd>
    <p>OpenPGP keyserver to use. (pool.sks-keyservers.net)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_CHECK_KEYSERVER</p>
  </dt>
  <dd>
    <p>Whether or not to check keyserver when making gpg queries. (true)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_KNOWN_HOSTS</p>
  </dt>
  <dd>
    <p>Path to ssh known_hosts file. (~/.ssh/known_hosts)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_HASH_KNOWN_HOSTS</p>
  </dt>
  <dd>
    <p>Whether or not to hash to the known_hosts file entries. (false)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_AUTHORIZED_KEYS</p>
  </dt>
  <dd>
    <p>Path to ssh authorized_keys file. (~/.ssh/authorized_keys)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_PROMPT</p>
  </dt>
  <dd>
    <p>If set to `false', never prompt the user for confirmation. (true)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_STRICT_MODES</p>
  </dt>
  <dd>
    <p>If set to `false', ignore too-loose permissions on known_hosts, authorized_keys, and authorized_user_ids files.  NOTE: setting this to false may expose you to abuse by other users on the system. (true)</p>
  </dd>
  <dt>
    <p>MONKEYSPHERE_SUBKEYS_FOR_AGENT</p>
  </dt>
  <dd>
    <p>A space-separated list of authentication-capable subkeys to add to the ssh agent with subkey-to-ssh-agent.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>~/.monkeysphere/monkeysphere.conf</p>
  </dt>
  <dd>
    <p>User monkeysphere config file.</p>
  </dd>
  <dt>
    <p>/etc/monkeysphere/monkeysphere.conf</p>
  </dt>
  <dd>
    <p>System-wide monkeysphere config file.</p>
  </dd>
  <dt>
    <p>~/.monkeysphere/authorized_user_ids</p>
  </dt>
  <dd>
    <p>A list of OpenPGP user IDs, one per line.  OpenPGP keys with an exactly-matching User ID (calculated valid by the designated identity certifiers), will have any valid authorization-capable keys or subkeys added to the given user's authorized_keys file.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Written by: Jameson Rollins &lt;jrollins@finestructure.net&gt;, Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO monkeysphere&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/monkeysphere-host.8.html"><strong>monkeysphere-host</strong>(8)</a>, <a href="../man8/monkeysphere-authentication.8.html"><strong>monkeysphere-authentication</strong>(8)</a>, <a href="../man7/monkeysphere.7.html"><strong>monkeysphere</strong>(7)</a>, <strong>ssh</strong>(1), <strong>ssh-add</strong>(1), <a href="../man1/gpg.1.html"><strong>gpg</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="monkeysign.1.html"><span aria-hidden="true">&larr;</span> monkeysign.1: Sign a key in a safe fashion.</a></li>
   <li class="next"><a href="monkeystudio.1.html">monkeystudio.1: Qt 4 integrated development environment (ide) <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
