<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>knockd: Port-knock server</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Port-knock server">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="knockd (1) manual">
  <meta name="twitter:description" content="Port-knock server">
  <meta name="twitter:image" content="https://www.carta.tech/images/knockd-knockd-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/knockd.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="knockd (1) manual" />
  <meta property="og:description" content="Port-knock server" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/knockd-knockd-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">knockd<small> (1)</small></h1>
        <p class="lead">Port-knock server</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/knockd.1.html">
      <span itemprop="name">knockd: Port-knock server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/knockd/">
      <span itemprop="name">knockd</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/knockd.1.html">
      <span itemprop="name">knockd: Port-knock server</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>knockd [options]</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>knockd</strong> is a <em>port-knock</em> server.  It listens to all traffic on an ethernet (or PPP) interface, looking for special "knock" sequences of port-hits. A client makes these port-hits by sending a TCP (or UDP) packet to a port on the server.  This port need not be open -- since knockd listens at the link-layer level, it sees all traffic even if it's destined for a closed port.  When the server detects a specific sequence of port-hits, it runs a command defined in its configuration file.  This can be used to open up holes in a firewall for quick access.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDLINE OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-i, --interface &lt;int&gt;</strong></p>
  </dt>
  <dd>
    <p>Specify an interface to listen on.  The default is <em>eth0</em>.</p>
  </dd>
  <dt>
    <p><strong>-d, --daemon</strong></p>
  </dt>
  <dd>
    <p>Become a daemon.  This is usually desired for normal server-like operation.</p>
  </dd>
  <dt>
    <p><strong>-c, --config &lt;file&gt;</strong></p>
  </dt>
  <dd>
    <p>Specify an alternate location for the config file.  Default is <em>/etc/knockd.conf</em>.</p>
  </dd>
  <dt>
    <p><strong>-D, --debug</strong></p>
  </dt>
  <dd>
    <p>Ouput debugging messages.</p>
  </dd>
  <dt>
    <p><strong>-l, --lookup</strong></p>
  </dt>
  <dd>
    <p>Lookup DNS names for log entries. This may be a security risk! See section <strong>SECURITY NOTES</strong>.</p>
  </dd>
  <dt>
    <p><strong>-v, --verbose</strong></p>
  </dt>
  <dd>
    <p>Output verbose status messages.</p>
  </dd>
  <dt>
    <p><strong>-V, --version</strong></p>
  </dt>
  <dd>
    <p>Display the version.</p>
  </dd>
  <dt>
    <p><strong>-h, --help</strong></p>
  </dt>
  <dd>
    <p>Syntax help.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>knockd reads all knock/event sets from a configuration file.  Each knock/event begins with a title marker, in the form <strong>[name]</strong>, where <em>name</em> is the name of the event that will appear in the log.  A special marker, <strong>[options]</strong>, is used to define global options.</p>
<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Example #1:</h2>
        <div class="sectioncontent">
<p>This example uses two knocks.  The first will allow the knocker to access port 22 (SSH), and the second will close the port when the knocker is complete. As you can see, this could be useful if you run a very restrictive (DENY policy) firewall and would like to access it discreetly.</p>
<pre>
[options]
	logfile = /var/log/knockd.log

[openSSH]
	sequence    = 7000,8000,9000
	seq_timeout = 10
	tcpflags    = syn
	command     = /usr/sbin/iptables -A INPUT -s %IP% -j ACCEPT

[closeSSH]
	sequence    = 9000,8000,7000
	seq_timeout = 10
	tcpflags    = syn
	command     = /usr/sbin/iptables -D INPUT -s %IP% -j ACCEPT

</pre>

<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Example #2:</h2>
        <div class="sectioncontent">
<p>This example uses a single knock to control access to port 22 (SSH).  After receiving a successful knock, the daemon will run the <strong>start_command</strong>, wait for the time specified in <strong>cmd_timeout</strong>, then execute the <strong>stop_command</strong>.  This is useful to automatically close the door behind a knocker.  The knock sequence uses both UDP and TCP ports.</p>
<pre>
[options]
	logfile = /var/log/knockd.log

[opencloseSSH]
	sequence      = 2222:udp,3333:tcp,4444:udp
	seq_timeout   = 15
	tcpflags      = syn,ack
	start_command = /usr/sbin/iptables -A INPUT -s %IP% -p tcp --syn -j ACCEPT
	cmd_timeout   = 5
	stop_command  = /usr/sbin/iptables -D INPUT -s %IP% -p tcp --syn -j ACCEPT

</pre>

<dl class='dl-vertical'>
  <dt>
    
  </dt>
  <dd>
    
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Example #3:</h2>
        <div class="sectioncontent">
<p>This example doesn't use a single, fixed knock sequence to trigger an event, but a set of sequences taken from a sequence file (one time sequences), specified by the <strong>one_time_sequences</strong> directive.  After each successful knock, the used sequence will be invalidated and the next sequence from the sequence file has to be used for a successful knock.  This prevents an attacker from doing a replay attack after having discovered a sequence (eg, while sniffing the network).</p>
<pre>
[options]
	logfile = /var/log/knockd.log

[opencloseSMTP]
	one_time_sequences = /etc/knockd/smtp_sequences
	seq_timeout        = 15
	tcpflags           = fin,!ack
	start_command      = /usr/sbin/iptables -A INPUT -s %IP% -p tcp --dport 25 -j ACCEPT
	cmd_timeout        = 5
	stop_command       = /usr/sbin/iptables -D INPUT -s %IP% -p tcp --dport 25 -j ACCEPT

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION: GLOBAL DIRECTIVES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>UseSyslog</strong></p>
  </dt>
  <dd>
    <p>Log action messages through syslog().  This will insert log entries into your /var/log/messages or equivalent.</p>
  </dd>
  <dt>
    <p><strong>LogFile = /path/to/file</strong></p>
  </dt>
  <dd>
    <p>Log actions directly to a file, usually /var/log/knockd.log.</p>
  </dd>
  <dt>
    <p><strong>PidFile = /path/to/file</strong></p>
  </dt>
  <dd>
    <p>Pidfile to use when in daemon mode, default: /var/run/knockd.pid.</p>
  </dd>
  <dt>
    <p><strong>Interface = &lt;interface_name&gt;</strong></p>
  </dt>
  <dd>
    <p>Network interface to listen on. Only its name has to be given, not the path to the device (eg, "eth0" and not "/dev/eth0"). Default: eth0.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION: KNOCK/EVENT DIRECTIVES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>Sequence = &lt;port1&gt;[:&lt;tcp|udp&gt;][,&lt;port2&gt;[:&lt;tcp|udp&gt;] ...]</strong></p>
  </dt>
  <dd>
    <p>Specify the sequence of ports in the special knock. If a wrong port with the same flags is received, the knock is discarded.  Optionally, you can define the protocol to be used on a per-port basis (default is TCP).</p>
  </dd>
  <dt>
    <p><strong>One_Time_Sequences = /path/to/one_time_sequences_file</strong></p>
  </dt>
  <dd>
    <p>File containing the one time sequences to be used.  Instead of using a fixed sequence, knockd will read the sequence to be used from that file.  After each successful knock attempt this sequence will be disabled by writing a '#' character at the first position of the line containing the used sequence.  That used sequence will then be replaced by the next valid sequence from the file.</p><p>Because the first character is replaced by a '#', it is recommended that you leave a space at the beginning of each line.  Otherwise the first digit in your knock sequence will be overwritten with a '#' after it has been used.</p><p>Each line in the one time sequences file contains exactly one sequence and has the same format as the one for the <strong>Sequence</strong> directive.  Lines beginning with a '#' character will be ignored.</p><p><strong>Note</strong>: Do not edit the file while knockd is running!</p>
  </dd>
  <dt>
    <p><strong>Seq_Timeout = &lt;timeout&gt;</strong></p>
  </dt>
  <dd>
    <p>Time to wait for a sequence to complete in seconds. If the time elapses before the knock is complete, it is discarded.</p>
  </dd>
  <dt>
    <p><strong>TCPFlags = fin|syn|rst|psh|ack|urg</strong></p>
  </dt>
  <dd>
    <p>Only pay attention to packets that have this flag set.  When using TCP flags, knockd will IGNORE tcp packets that don't match the flags.  This is different than the normal behavior, where an incorrect packet would invalidate the entire knock, forcing the client to start over.  Using "TCPFlags = syn" is useful if you are testing over an SSH connection, as the SSH traffic will usually interfere with (and thus invalidate) the knock.</p><p>Separate multiple flags with commas (eg, TCPFlags = syn,ack,urg).  Flags can be explicitly excluded by a "!" (eg, TCPFlags = syn,!ack).</p>
  </dd>
  <dt>
    <p><strong>Start_Command = &lt;command&gt;</strong></p>
  </dt>
  <dd>
    <p>Specify the command to be executed when a client makes the correct port-knock.  All instances of <strong>%IP%</strong> will be replaced with the knocker's IP address.  The <strong>Command</strong> directive is an alias for <strong>Start_Command</strong>.</p>
  </dd>
  <dt>
    <p><strong>Cmd_Timeout = &lt;timeout&gt;</strong></p>
  </dt>
  <dd>
    <p>Time to wait between <strong>Start_Command</strong> and <strong>Stop_Command</strong> in seconds. This directive is optional, only required if <strong>Stop_Command</strong> is used.</p>
  </dd>
  <dt>
    <p><strong>Stop_Command = &lt;command&gt;</strong></p>
  </dt>
  <dd>
    <p>Specify the command to be executed when <strong>Cmd_Timeout</strong> seconds have passed since <strong>Start_Command</strong> has been executed.  All instances of <strong>%IP%</strong> will be replaced with the knocker's IP address.  This directive is optional.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY NOTES</h2>
        <div class="sectioncontent">
<p>Using the <strong>-l</strong> or <strong>--lookup</strong> commandline option to resolve DNS names for log entries may be a security risk!  An attacker may find out the first port of a sequence if he can monitor the DNS traffic of the host running knockd. Also a host supposed to be stealth (eg, dropping packets to closed TCP ports instead of replying with an ACK+RST packet) may give itself away by resolving a DNS name if an attacker manages to hit the first (unknown) port of a sequence.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO knockd&hellip;</h2>
        <div class="sectioncontent">
<p><strong>knock</strong> is the accompanying port-knock client, though <strong>telnet</strong> or <strong>netcat</strong> could be used for simple TCP knocks instead. For more advanced knocks, see <strong>hping</strong>, <strong>sendip</strong> or <strong>packit</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">

<pre>
Judd Vinet &lt;jvinet@zeroflux.org&gt;
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="knock.1.html"><span aria-hidden="true">&larr;</span> knock.1: Port-knock client</a></li>
   <li class="next"><a href="knocker.1.html">knocker.1: An easy to use network security port scanner <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
