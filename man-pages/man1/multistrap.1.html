<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>multistrap: None</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="None">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="multistrap (1) manual">
  <meta name="twitter:description" content="None">
  <meta name="twitter:image" content="https://www.carta.tech/images/multistrap-multistrap-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/multistrap.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="multistrap (1) manual" />
  <meta property="og:description" content="None" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/multistrap-multistrap-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">multistrap<small> (1)</small></h1>
        <p class="lead">None</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/multistrap.1.html">
      <span itemprop="name">multistrap: None</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/multistrap/">
      <span itemprop="name">multistrap</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/multistrap.1.html">
      <span itemprop="name">multistrap: None</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">Name</h2>
        <div class="sectioncontent">
<p>multistrap - multiple repository bootstraps</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Synopsis</h2>
        <div class="sectioncontent">

<pre>
 multistrap [-a ARCH] [-d DIR] -f CONFIG_FILE
 multistrap [--simulate] -f CONFIG_FILE
 multistrap -?|-h|--help|--version
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Options</h2>
        <div class="sectioncontent">
<p>-?|-h|--help|--version - output the help text and exit successfully.</p><p>--dry-run - collate all the configuration settings and output a bare summary.</p><p>--simulate - same as --dry-run</p><p>(The following options can also be set in the configuration file.)</p><p>-a|--arch - architecture of the packages to put into the multistrap.</p><p>-d|--dir - directory into which the bootstrap will be installed.</p><p>-f|--file - configuration file for multistrap [required]</p><p>-s|--shortcut - shortened version of -f for files in known locations.</p><p>--tidy-up - remove apt cache data, downloaded Packages files and the apt package cache. Same as cleanup=true.</p><p>--no-auth - allow the use of unauthenticated repositories. Same as noauth=true</p><p>--source-dir \s-1DIR\s0 - move the contents of var/cache/apt/archives/ from inside the chroot to the specified external directory, then add the Debian source packages for each used binary. Same as retainsources=DIR If the specified directory does not exist, nothing is done. Requires --tidy-up in order to calculate the full list of source packages, including dependencies.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Description</h2>
        <div class="sectioncontent">
<p>multistrap provides a debootstrap-like method based on apt and extended to provide support for multiple repositories, using a configuration file to specify the relevant suites, architecture, extra packages and the mirror to use for each bootstrap.</p><p>The aim is to create a complete bootstrap / root filesystem with all packages installed and configured, instead of just the base system.</p><p>In most cases, users will need to create a configuration file for each different multistrap usage.</p><p>Example configuration:</p><p> [General]  arch=armel  directory=/opt/multistrap/  # same as --tidy-up option if set to true  cleanup=true  # same as --no-auth option if set to true  # keyring packages listed in each bootstrap will  # still be installed.  noauth=false  # extract all downloaded archives (default is true)  unpack=true  # whether to add the /suite to be explicit about where apt  # needs to look for packages. Default is false.  explicitsuite=false  # enable MultiArch for the specified architectures  # default is empty  multiarch=  # aptsources is a list of sections to be used  # the /etc/apt/sources.list.d/multistrap.sources.list  # of the target. Order is not important  aptsources=Debian  # the bootstrap option determines which repository  # is used to calculate the list of Priority: required packages  # and which packages go into the rootfs.  # The order of sections is not important.  bootstrap=Debian</p><p> [Debian]  packages=  source=http://ftp.uk.debian.org/debian  keyring=debian-archive-keyring  suite=lenny</p><p>This will result in a completely normal bootstrap of Debian lenny from the specified mirror, for armel in '/opt/multistrap/'. (This configuration is retained in the package as <em>/usr/share/multistrap/lenny.conf</em>)</p><p>Specify a package to extend the multistrap to include that package and all dependencies of that package.</p><p>Specify more repositories for the bootstrap by adding new sections. Section names need to be listed in the bootstrap general option for the packages to be included in the bootstrap.</p><p>Specify which repositories will be available to the final system at boot by listing the section names in the aptsources general option, e.g. to exclude some internal sources or when using a local mirror when building the rootfs.</p><p>Section names are case-insensitive.</p><p>All dependencies are resolved only by apt, using all bootstrap repositories, to use only the most recent and most suitable dependencies. Note that multistrap turns off Install-Recommends so if the multistrap needs a package that is only a Recommended dependency, the recommended package needs to be specified in the packages line explicitly. See \*(C`Explicit suite specification\*(C' for more information on getting specific packages from specific suites.</p><p>'Architecture' and 'directory' can be overridden on the command line. Some other general options also have command line options.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Online examples and documentation</h2>
        <div class="sectioncontent">
<p>\*(C`multistrap\*(C' supports a range of permutations, see the wiki and the emdebian website for more information and example configurations:</p><p>http://wiki.debian.org/Multistrap</p><p>http://www.emdebian.org/multistrap/</p><p>\*(C`multistrap\*(C' includes an example configuration file with a full list of all supported config file options: <em>/usr/share/doc/multistrap/examples/full.conf</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Shortcuts</h2>
        <div class="sectioncontent">
<p>In a similar manner to \*(C`debootstrap\*(C', \*(C`multistrap\*(C' supports referring to configuration files in known locations by shortcuts. When using the \*(C`--shortcut\*(C' option, \*(C`multistrap\*(C' will look for files in <em>/usr/share/multistrap</em> and then <em>/etc/multistrap.d/</em>, appending a '.conf' suffix to the specified shortcut.</p><p>These two commands are equivalent:</p><p> $ sudo multistrap -s sid  $ sudo multistrap -f /usr/share/multistrap/sid.conf</p><p>Note that \*(C`multistrap\*(C' will still fail if the configuration file itself does not set the directory or the architecture.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Repositories</h2>
        <div class="sectioncontent">
<p>\*(C`aptsources\*(C' lists the sections which should be used to create the <em>/etc/apt/sources.list.d/multistrap.list</em> apt sources in the final system. Not all \*(C`aptsources\*(C' have to appear in the \*(C`bootstrap\*(C' section if you have some internal or local sources which are not accessible to the installed root filesystem.</p><p>\*(C`bootstrap\*(C' lists the sections which will be used to create the multistrap itself. Only packages listed in \*(C`bootstrap\*(C' will be downloaded and unpacked by multistrap.</p><p>Make sure \*(C`bootstrap\*(C' lists all sections you need for apt to be able to find all the packages to be unpacked for the multistrap.</p><p>(Older versions of multistrap supported the same option under the \*(C`debootstrap\*(C' name - this spelling is still supported but new configuration files should be \*(C`bootstrap\*(C' instead.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">General settings:</h2>
        <div class="sectioncontent">
<p>'arch' can be overridden on the command line using the \*(C`--arch\*(C' option.</p><p>'directory' specifies the top level directory where the bootstrap will be created - it is not packed into a .tgz once complete.</p><p>'bootstrap' lists the Sections which will be used to specify the packages which will be downloaded (and optionally unpacked) into the bootstrap.</p><p>'aptsources' lists the Sections which will be used to specify the apt sources in the final system, e.g. if you need to use a local repository to generate the rootfs which will not be available to the device at runtime, list that section in \*(C`bootstrap\*(C' but not in \*(C`aptsources\*(C'.</p><p>If you want a package to be in the rootfs, it <strong>must</strong> be specified in the \*(C`bootstrap\*(C' list under General.</p><p>The order of section names in either list is not important.</p><p>If \*(C`markauto\*(C' is set to true, \*(C`multistrap\*(C' will request apt to mark all packages specified in the combined \*(C`packages\*(C' list as manually installed and all dependencies not explicitly listed as automatically installed in the \s-1APT\s0 extended state database. \*(C`markauto\*(C' can be used independently of \*(C`unpack\*(C'.</p><p>As with debootstrap, multistrap will continue after errors, as long as the configuration file can be correctly parsed.</p><p>multistrap also implements the machine:variant support originally used in Emdebian Crush, although in a different implementation. Using the cascading configuration support, particular machine:variant combinations can be supported by simple changes on the command line.</p><p>Setting \*(C`tarballname\*(C' to true also packs up the final filesystem into a tarball.</p><p>Note that multistrap ignores any unrecognised options in the config file - this allows for backwards-compatible behaviour as well as overloading the multistrap config files to support other tools (like pbuilder). Use the \*(C`--simulate\*(C' option to see the combined configuration settings.</p><p>However, if the config file itself cannot be parsed, multistrap will abort. Check that the config file has a key and a value for each line, other than comments. Values must all on the same line as the key.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Section settings</h2>
        <div class="sectioncontent">
<p> [Debian]  packages=  source=http://ftp.uk.debian.org/debian  keyring=debian-archive-keyring  suite=lenny</p><p>The section name (in [] brackets) needs to be unique for this configuration file and any configuration files which this file includes. Section names are case insensitive (all comparisons happen after conversion to lower case).</p><p>'packages' is the list of packages to be added when this Section is listed in \*(C`bootstrap\*(C' - all package names must be listed on a single line or the file will fail to parse. One alternative is to define your list of packages as multiple groups with packages separated on a functional / dependency basis, e.g. base, Xorg, networking etc. and list each group under 'bootstrap'.</p><p> bootstrap=base networking</p><p> [base]  packages=udev mtd-utils  source=http://www.emdebian.org/grip  keyring=emdebian-archive-keyring  suite=lenny</p><p> [networking]  packages=netbase ifupdown iproute net-tools samba  source=http://www.emdebian.org/grip  keyring=emdebian-archive-keyring  suite=lenny</p><p>As a special case, \*(C`multistrap\*(C' also supports multiple packages keys per section, one line for each. Other keys cannot be repeated in this manner.</p><p> [Emdebian]  packages=udev mtd-utils netbase ifupdown iproute  packages=busybox net-tools samba  source=http://www.emdebian.org/grip  keyring=emdebian-archive-keyring  suite=lenny</p><p>'source' is the apt source to use for this Section. To use a local source on the same machine, ensure you use \*(C`copy://\*(C' not \*(C`file://\*(C', so that apt is told to copy the packages into the rootfs instead of assuming it can try to download them later - because that \*(L"later\*(R" will never actually happen.</p><p>'keyring' lists the package which contains the key used by the source listed in this Section. If no keyring is specified, the \*(C`noauth\*(C' option must be set to <strong>true</strong>. See Secure Apt.</p><p>'suite' is the suite to use from this source. Note that this should be the suite, not the codename.</p><p>Suites change from time to time: (oldstable, stable, testing, sid) The codename (etch, lenny, squeeze, sid) does not change.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Secure Apt</h2>
        <div class="sectioncontent">
<p>To use authenticated apt repositories, multistrap needs to be able to install an appropriate keyring package from the existing apt sources <strong>outside the multistrap environment</strong> into the destination system. Unfortunately, keyring packages cannot be downloaded from the repositories specified in the multistrap configuration - this is because \*(C`apt\*(C' needs the keyring to be updated before being able to use repositories not previously known.</p><p>If relevant packages exist, specify them in the 'keyring' option for each repository. multistrap will then check that apt has already installed this package so that the repository can be authenticated before any packages are downloaded from it.</p><p>Note that <strong>all</strong> repositories to be used with multistrap must be authenticated or apt will fail. Similarly, secure apt can only be disabled for all repositories (by using the --no-auth command line option or setting the general noauth option in the configuration file), even if only one repository does not have a suitable keyring available.</p><p>The keyring package(s) will also be installed inside the multistrap environment to match the installed apt sources for the multistrap.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">State</h2>
        <div class="sectioncontent">
<p>multistrap is stateless - if the directory exists, it will simply proceed as normal and apt will try to pick up where it left off.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Root Filesystem Configuration</h2>
        <div class="sectioncontent">
<p>multistrap unpacks the downloaded packages but other stages of system configuration are not attempted. Examples include:</p><p> /etc/inittab  /etc/fstab  /etc/hosts  /etc/securetty  /etc/modules  /etc/hostname  /etc/network/interfaces  /etc/init.d  /etc/dhcp3</p><p>Any device-specific device nodes will also need to be created using \s-1MAKEDEV\s0 or \*(C`device-table.pl\*(C' - a helper script that can work around some of the issues with \s-1MAKEDEV\s0. <em>device-table.pl</em> requires a device table file along the lines of the one in the mtd-utils source package. See <em>/usr/share/doc/multistrap/examples/device_table.txt</em></p><p>Once multistrap has successfully created the basic file and directory layout, other device-specific scripts are needed before the filesystem can be packaged up and installed onto the target device.</p><p>Once installed, the packages themselves need to be configured using the package maintainer scripts and \*(C`dpkg --configure -a\*(C', unless this is a native multistrap.</p><p>For \*(C`dpkg\*(C' to work, <em>/proc</em> and <em>/sysfs</em> must be mounted (or mountable), <em>/dev/pts</em> is also recommended.</p><p>See also: http://wiki.debian.org/Multistrap</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Environment</h2>
        <div class="sectioncontent">
<p>To configure the unpacked packages (whether in native or cross mode), certain environment variables are needed:</p><p>Debconf needs to be told to accept that user interaction is not desired:</p><p> DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true</p><p>Perl needs to be told to accept that no locales are available inside the chroot and not to complain:</p><p> LC_ALL=C LANGUAGE=C LANG=C</p><p>Then, dpkg can configure the packages:</p><p>chroot method (\s-1PATH\s0 = top directory of chroot):</p><p> DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true &#92;  LC_ALL=C LANGUAGE=C LANG=C chroot /PATH/ dpkg --configure -a</p><p>at a login shell:</p><p> # export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true  # export LC_ALL=C LANGUAGE=C LANG=C  # dpkg --configure -a</p><p>(As above, dpkg needs <em>/proc</em> and <em>/sysfs</em> mounted first.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Native mode - multistrap</h2>
        <div class="sectioncontent">
<p>multistrap was not intended for native support, it was developed for cross architecture support. In order for multiple repositories to be used, multistrap only unpacks the packages selected by apt.</p><p>In native mode, various post-multistrap operations are likely to be needed that debootstrap would do for you:</p><p> 1. copy /etc/hosts into the chroot  2. clean the environment to unset LANGUAGE, LC_ALL and LANG     to silence nuisance perl warnings that obscure other errors</p><p>(An alternative to unset the localisation variables is to add locales to your multistrap configuration file in the 'packages' option.</p><p>A native multistrap can be used directly with chroot, so \*(C`multistrap\*(C' runs \*(C`dpkg --configure -a\*(C' at the end of the multistrap process, unless the <strong>ignorenativearch</strong> option is set to true in the <strong>General</strong> section of the configuration file.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Daemons in chroots</h2>
        <div class="sectioncontent">
<p>Depending on which system you using to provide the packages for \*(C`multistrap\*(C', native chroots should generally not allow daemons to start inside the chroot. Use the <em>/usr/share/multistrap/chroot.sh</em> as your \*(C`setupscript\*(C' or include that script in your own setup script.</p><p> setupscript=/usr/share/multistrap/chroot.sh</p><p><em>chroot.sh</em> copes with systems using <em>sysvinit</em> and <em>upstart</em>.</p><p>See also</p><p> http://people.debian.org/~hmh/invokerc.d-policyrc.d-specification.txt</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Cascading configuration</h2>
        <div class="sectioncontent">
<p>To support multiple variants of a basic (common) configuration, \*(C`multistrap\*(C' allows configuration files to include other (more general) configuration files. i.e. the most detailed / specific configuration file is specified on the command line and that file includes another file which is shared by other configurations.</p><p>Base file:</p><p> /usr/share/multistrap/crosschroot.conf</p><p>Variations:</p><p> /usr/share/multistrap/armel.conf</p><p>Specifying just the armel.conf file will get the rest of the settings from crosschroot.conf so that common changes only need to be made in a single file.</p><p>It is <strong>strongly</strong> recommended that any changes to the configuration files involved in any particular cascade are tested using the \*(C`--simulate\*(C' option to multistrap which will output a summary of the options that have been set once the cascade is complete. Note that multistrap does <strong>not warn you</strong> if a configuration file contains an unrecognised option (for future compatibility with backported configurations), so a simple typo can result in an option not being set.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Machine:variant support</h2>
        <div class="sectioncontent">
<p>The old packages.conf variables from emsandbox can all be converted into \*(C`multistrap\*(C' configuration variables. The machine:variant support in \*(C`multistrap\*(C' concentrates on the scripts, <em>config.sh</em> and <em>setup.sh</em></p><p>Note: <strong>machine:variant support is likely to be replaced by the</strong> hook functionality described below.</p><p>Once \*(C`multistrap\*(C' has unpacked the downloaded packages, the \*(C`setup.sh\*(C' can be called, passing the location and architecture of the root filesystem, so that other fine tuning can take place. At this stage, any operations inside a foreign architecture rootfs must not try to execute any binaries within the rootfs. As the final stage of the multistrap process, \*(C`config.sh\*(C' is copied into the root directory of the rootfs.</p><p>One advantage of using machine:variant support is that the entire rootfilesystem can be managed by a single call to multistrap - this is useful when building root filesystems in userspace.</p><p>To enable machine:variant support, specify the path to the scripts to be called in the variant configuration file (General section):</p><p> [General]  include=/path/to/general.conf  setupscript=/path/to/setup.sh  configscript=/path/to/config.sh</p><p>Ensure that both the setupscript and the configscript are executable or \*(C`multistrap\*(C' will ignore the script.</p>
<dl class='dl-vertical'>
  <dt>
    Example configscript.sh
  </dt>
  <dd>
    <p> #!/bin/sh</p><p> set -e</p><p> export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true  export LC_ALL=C LANGUAGE=C LANG=C  /var/lib/dpkg/info/dash.preinst install  dpkg --configure -a  mount proc -t proc /proc  dpkg --configure -a  umount /proc For more information, see the Wiki: http://wiki.debian.org/Multistrap</p>
  </dd>
  <dt>
    Mounting /dev and /proc for chroot configuration
  </dt>
  <dd>
    <p>/proc can be mounted inside the chroot, as above:  mount proc -t proc /proc However, /dev should be mounted from outside the chroot, before running any \*(C`configscript.sh\*(C' in the chroot:  cd /path/chroot/  sudo tar -xzf /path/multistrap.tgz  sudo mount /dev -o bind ./dev/  sudo chroot . ./configscript.sh || true</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Restricting package selection</h2>
        <div class="sectioncontent">
<p>\*(C`multistrap\*(C' includes Required packages by default, the current list of packages on your own machine can be seen using:</p><p> grep-available  -FPriority &apos;required&apos; -sPackage</p><p>(The actual list is calculated from the downloaded Packages files and may differ from the output of \*(C`grep-available\*(C'.)</p><p>If the OmitRequired option is set to true, these packages will not be added - whilst useful, this option can easily lead to a useless rootfs. Only the packages specified manually in the configuration files will be used in the calculations - dependencies of those packages will be added but no others.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Adding Priority: important packages</h2>
        <div class="sectioncontent">
<p>\*(C`multistrap\*(C' can imitate \*(C`debootstrap\*(C' by automatically adding all packages from all sections where the downloaded Packages file lists the package as Priority: important. The default is not to add such packages unless individually included in a \*(C`packages=\*(C' option in a section specified in the \*(C`bootstrap\*(C' general option. To add all such packages, set the addimportant option to true in the general section.</p><p> addimportant=true</p><p>Priority: important can only operate for all sections listed in the \*(C`bootstrap\*(C' option. This may cause some confusion when mixing suites.</p><p>It is not possible to enable addimportant and omitrequired in the same configuration. \*(C`multistrap\*(C' will exit with error code 7 if any configuration results in addimportant and omitrequired both being set to true. (This includes the effects of including other configuration files.)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Recommends behaviour</h2>
        <div class="sectioncontent">
<p>The Debian default behaviour after the Lenny release was to consider recommended packages as extra packages to be installed when any one package is selected. Recommended packages are those which the maintainer considers that would be present on \*(C`most\*(C' installations of that package and allowing Recommends means allowing Recommends of recommended packages and so on.</p><p>The multistrap default is to turn recommends \s-1OFF\s0.</p><p>Set the allowrecommends option to true in the General section to use typical Debian behaviour.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Default release</h2>
        <div class="sectioncontent">
<p>\*(C`multistrap\*(C' supports an option to explicitly set the default release to use with apt: \*(C`aptdefaultrelease\*(C'. This determines which release apt will use for the base system packages and is not the same as pinning (which relates to the use of apt after installation). Multistrap sets the default-release to the wildcard * unless a release is named in the \*(C`aptdefaultrelease\*(C' field. Any release specified here must also be defined in a stanza referenced in the bootstrap list or apt will fail.</p><p>To install a specific version of a package from a newer release than the one specified as default, \*(C`explicitsuite\*(C' must also be set to true if the package exists at any version in the default release. Also, any packages upon which that package has a strict dependency (i.e. = rather than &gt;=) must also be explicitly added to the packages line in the stanza for the desired version, even though that package does not need to be listed to get it from the default release. This is typical apt behaviour and is not a bug in multistrap.</p><p>The combination of default release, explicit suite and apt preferences can quickly become complex and bugs can be very hard to identify. \*(C`multistrap\*(C' always outputs the complete apt command line, so test this command yourself (using the files written out by \*(C`multistrap\*(C') to see what is going on. Remember that all dependency resolution and all the logic to determine which version of a specific package gets installed in your \*(C`multistrap\*(C' chroot is entirely down to apt and all \*(C`multistrap\*(C' can do is pass files and command line options to apt.</p><p>See also: apt preferences.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Explicit suite specification</h2>
        <div class="sectioncontent">
<p>Sometimes, apt needs to be told to get a particular package from a particular suite, ignoring a more recent version in another suite in the same set of sources.</p><p>\*(C`multistrap\*(C' can operate with and without the explicit suite option, the default is to let apt use the most recent version from the collection of specified <em>bootstrap</em> sources.</p><p>Explicit suite specification has no effect on the final installed system - if your aptsources includes a repository which in turn includes a newer version of the package(s) specified explicitly, the next \*(C`apt-get upgrade\*(C' on the device will bring in the newer version.</p><p>Also, when specifying packages to get from a specific suite, apt will also try and ensure that the dependencies for that package are also from the same suite and this can cause apt to be unable to resolve the complete set of dependencies. In this situation, being explicit about one package selection may require being explicit about some (not necessarily all) of the dependencies of that package as well.</p><p>When using this support in Lenny, ensure that each section uses the suite (oldstable, stable, testing, sid) and <strong>not</strong> the codename (etch, lenny, squeeze, sid) in the \*(C`suite\*(C' configuration item as the version of apt in Lenny and previous cannot use the codename.</p><p>To test, on Lenny, try:</p><p> $ sudo apt-get install apt/stable</p><p>Compare with</p><p> $ sudo apt-get install apt/lenny</p><p>When using explicitsuite, take care in using stable-proposed-updates or other temporary locations - if the package migrates into another suite and is removed from the temporary suite (as with *-proposed-updates), multistrap will not be able to find the package.</p><p>Explicit suite handling can be very hard to get right. In general, it is best to create a small bootstrap chroot of your native arch, then chroot into it, add the relevant apt sources and work out exactly what commands are necessary to get the correct mix of packages. Avoid specifying explicit versions to sort out problems, work with suites only. Apt preferences / pinning may be useful here, see Apt preferences.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Apt preferences</h2>
        <div class="sectioncontent">
<p>If a suitable file is listed in the <strong>aptpreferences</strong> option of the <strong>General</strong> section of the configuration file, this file will be copied into the apt preferences directory of the bootstrap before apt is first used.</p><p>When an apt preferences file <strong>is</strong> provided, the \*(C`Default-Release\*(C' behaviour of \*(C`multistrap\*(C' is disabled.</p><p>As with other external scripts and files, the content of the apt preferences file is beyond the scope of this manpage. \*(C`multistrap\*(C' does not try to verify the supplied file other than ensuring that it can be read.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Omitting deb-src listings</h2>
        <div class="sectioncontent">
<p>Some multistrap environments do not need access to the Debian sources of packages being installed, typically this is required when preparing a build (or cross-build) chroot using multistrap.</p><p>To turn off this additional source (and save both download time and apt-cache size), use the omitdebsrc field in each Section.</p><p> [Baked]  packages=  source=http://www.emdebian.org/baked  keyring=emdebian-archive-keyring  suite=testing  omitdebsrc=true</p><p>omitdebsrc is necessary when using packages from debian-ports where packages do not have sources, except \*(L"unreleased\*(R".</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">fakeroot</h2>
        <div class="sectioncontent">
<p>Foreign architecture bootstraps can operate under \*(C`fakeroot\*(C' (\*(C`multistrap\*(C' is designed to do as much as it can within a single call to make this easier) but the configuration stage which normally happens with a native architecture bootstrap requires \*(C`chroot\*(C' and \*(C`chroot\*(C' itself will not operate under \*(C`fakeroot\*(C'.</p><p>Therefore, if \*(C`multistrap\*(C' detects that \*(C`fakeroot\*(C' is in use, native mode configuration is skipped with a reminder warning.</p><p>The same problem applies to \*(C`apt-get install\*(C' and therefore the installation of the keyring package on the host system is also skipped if fakeroot is detected.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Handling problematic packages</h2>
        <div class="sectioncontent">
<p>Sometimes, a particular package will fail to even unpack properly if other packages have not already been unpacked. This can happen if dpkg diversions are not setup correctly or if the package Pre-Depends on an executable in another package.</p><p>Multistrap offers two ways to handle these problems. A package can be listed as \*(C`reinstall\*(C' or as \*(C`additional\*(C'. Each section in the \*(C`multistrap\*(C' configuration file can have a single \*(C`reinstall\*(C' or \*(C`additional\*(C' listing or both.</p><p>Reinstall means that the package will be downloaded and unpacked as normal - alongside all the other packages, but will then be reinstalled at the end by running the \*(C`preinst\*(C' maintainer script with the \*(C`upgrade\*(C' argument. \*(C`dpkg\*(C' will then continue the rest of the configuration of that package.</p><p>Additional adds a second round of \*(C`apt-get install\*(C' to the multistrap process - after the initial unpacking. The additional package will then be downloaded and unpacked. If running natively, the additional package is downloaded, unpacked and configured after all the rest of the packages have been downloaded, unpacked and configured.</p><p>Neither \*(C`reinstall\*(C' nor \*(C`additional\*(C' should be seen as more than just workarounds and wishlist bugs should be filed in Debian against packages which require the use of these mechanisms (or the packages which would prevent the particular package from operating normally).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Debconf preseeding</h2>
        <div class="sectioncontent">
<p>Adding a debconf seed can help in configuring packages to a particular setting instead of the package default when running the configuration non-interactively. See http://www.debian-administration.org/articles/394 for information on how to create seed files.</p><p>Multiple seed files can be specified using the debconfseed field in the [General] section, separated by spaces:</p><p> debconfseed=seed1 seed2</p><p>Files which do not exist or which cannot be opened will be silently ignored. Check the results of the parsing using the \*(C`--simulate\*(C' option to \*(C`multistrap\*(C'. The preseeding files will be copied to a preseed directory in /tmp inside the rootfs.</p><p>To use the preseeding, add a section to the configscript.sh, prior to any calls to <strong>dpkg --configure -a</strong>. e.g. :</p><p> #!/bin/sh</p><p> set -e</p><p> export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true  export LC_ALL=C LANGUAGE=C LANG=C  if [ -d /tmp/preseeds/ ]; then     for file in &#96;ls -1 /tmp/preseeds/*&#96;; do     debconf-set-selections $file     done  fi  dpkg --configure -a</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Hooks</h2>
        <div class="sectioncontent">
<p>If a hook directory (hookdir=) is specified in the General section of the \*(C`multistrap\*(C' configuration file, the hook scripts which are executable will be run from outside the multistrap directory at the following stages:</p>
<dl class='dl-vertical'>
  <dt>
    download hooks
  </dt>
  <dd>
    <p>Executed before unpacking is started, immediately after the packages have been downloaded. Download hooks are executable scripts in the specified hook directory with a filename beginning with <strong>download</strong>.</p>
  </dd>
  <dt>
    native hooks
  </dt>
  <dd>
    <p>Native hook scripts are executed only in native mode, immediately before starting the configuration of the downloaded packages and again upon completion of the package configuration. Native hooks will be called the absolute path and the current progress state, start or end. Native scripts are executable scripts in the specified hook directory with a filename beginning with <strong>native</strong>.</p>
  </dd>
  <dt>
    completion hooks
  </dt>
  <dd>
    <p>Executed immediately before the tarball is created or \*(C`multistrap\*(C' exits if not configured to create a tarball. Completion scripts are executable scripts in the specified hook directory with a filename beginning with <strong>completion</strong>.</p>
  </dd>

</dl>
<p>Hooks are passed the absolute path to the directory which will be the top level directory of the chroot or multistrap system. Hooks which cannot be resolved using realpath or which are not executable will be ignored.</p><p>All hooks of one type are sorted into alphabetical order before being run.</p><p>Note that \*(C`multistrap\*(C' does not rollback the effects of hooks in the case of errors. However, \*(C`multistrap\*(C' will report the accumulated errors as warnings. If a hook exits non-zero, the exit value is converted to a positive number and added to the total warning count, reported at the end of the operation.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Output</h2>
        <div class="sectioncontent">
<p>\*(C`multistrap\*(C' can produce a lot of output - informational messages appear on \s-1STDOUT\s0, errors and warnings on \s-1STDERR\s0. Calls to \*(C`apt\*(C' and \*(C`dpkg\*(C' respect the same pattern, so it is simple to trim the combined \*(C`multistrap\*(C' output to just the errors, if desired.</p><p>\*(C`multistrap\*(C' accumulates error states from non-fatal processes within the operation and reports these as warnings on \s-1STDERR\s0 as well as exiting with the accumulated error count. This includes hooks which report non-zero exit values.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Bugs</h2>
        <div class="sectioncontent">
<p>As \*(C`multistrap\*(C' gets more complex, bugs will creep into the package. Please report all bugs to the Debian \s-1BTS\s0 using the \*(C`reportbug\*(C' tool and <strong>please</strong> attach all configuration files. If your configuration needs to access local or private apt repositories, please check your configuration with the latest version of \*(C`multistrap\*(C' in Debian using the \*(C`--simulate\*(C' option and include that report in your bug report.</p><p>The \*(C`--simulate\*(C' option output is regularly expanded to help users debug problems in the configuration files.</p><p>Please also check (and update) the Multistrap wiki at http://wiki.debian.org/Multistrap and the Multistrap webpage content at http://www.emdebian.org/multistrap/ before filing bugs. Various people on the debian-embedded@lists.debian.org mailing list and #emdebian \s-1IRC\s0 channel on irc.oftc.net can also help if your config file does not parse correctly. You would need to put the \*(C`--simulate\*(C' output on a pastebin website and put the \s-1URL\s0 in your message.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MultiArch support</h2>
        <div class="sectioncontent">
<p>Multiarch support is experimental - please report issues and file bugs with full details of your setup, the full multistrap config file and the errors reported.</p><p>\*(C`multistrap\*(C' overrides the existing multiarch support of the external system so that a MultiArch aware system can still create a non-MultiArch chroot from repositories which do not support all of the architectures supported by the external dpkg.</p><p>If multiarch is enabled within the multistrap chroot, \*(C`multistrap\*(C' writes out the list into <em>/var/lib/dpkg/arch</em> inside the chroot.</p><p>For multiple architectures, specify the option once and use a space separated list for the architecture list. Ensure you include what will be the host architecture of the chroot.</p><p>See also http://wiki.debian.org/Multiarch/</p><p> [General]  ...  multiarch=i386 armel armhf</p><p>Each Section will install packages from the base architecture unless the \*(C`Architecture\*(C' option is specified for particular sections.</p><p> [Foreign]  packages=libgcc1 libc6  architecture=armel  source=http://ftp.uk.debian.org/debian  keyring=debian-archive-keyring  suite=sid</p><p>In the \*(C`--simulate\*(C' output, the architecture(s) specified in the MultiArch option will be listed under the \*(L"Foreign architectures\*(R" listing. Packages for a specific architecture will be listed as the package name followed by a colon followed by the architecture.</p><p> libgcc1:armel libc6:armel</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="multinode_server.1.html"><span aria-hidden="true">&larr;</span> multinode_server.1: Server program to synchronise several instances of morse</a></li>
   <li class="next"><a href="multitail.1.html">multitail.1: Browse through several files at once <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
