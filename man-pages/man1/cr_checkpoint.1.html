<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cr_checkpoint: Checkpoints a process, process group, or session.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Checkpoints a process, process group, or session.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cr_checkpoint (1) manual">
  <meta name="twitter:description" content="Checkpoints a process, process group, or session.">
  <meta name="twitter:image" content="https://www.carta.tech/images/blcr-util-cr_checkpoint-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/cr_checkpoint.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cr_checkpoint (1) manual" />
  <meta property="og:description" content="Checkpoints a process, process group, or session." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/blcr-util-cr_checkpoint-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cr_checkpoint<small> (1)</small></h1>
        <p class="lead">Checkpoints a process, process group, or session.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/cr_checkpoint.1.html">
      <span itemprop="name">cr_checkpoint: Checkpoints a process, process group, or session.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/blcr-util/">
      <span itemprop="name">blcr-util</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/cr_checkpoint.1.html">
      <span itemprop="name">cr_checkpoint: Checkpoints a process, process group, or session.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>cr_checkpoint</strong> [<em>options</em>] <em>ID</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Invoking cr_checkpoint causes a process (with or without all of its descendants), all processes within a process group, or all processes within a session, to be checkpointed.  The result is a checkpoint file (or a directory with one checkpoint file per process) that contains all the state needed to restart the process(es) at a later time.  Checkpointed processes can be restarted via <a href="../man1/cr_restart.1.html"><strong>cr_restart</strong>(1)</a>.</p><p>To be checkpointed by cr_checkpoint, a process must have the <em>libcr.so</em> library (or one of its relatives) loaded.  This can be achieved by starting the program with <a href="../man1/cr_run.1.html"><strong>cr_run</strong>(1)</a>, or by linking your application with <strong>-lcr</strong>. Or, the library may be loaded by other libraries you have linked with (such as a checkpoint-ready MPI library), or your system's parallel job startup script, etc.  Check your system documentation for details.</p><h3>File creation/replacement</h3>
<p>By default (or if <strong>--atomic</strong> is passed) cr_checkpoint creates the new context file/directory atomically:  either the checkpoint fails (and any existing context file/directory is unchanged), or it appears in the directory ready to be used by <strong>cr_restart</strong>. If an existing checkpoint with the same file name exists, it will either be be unmodified (if the new checkpoint fails for any reason), or replaced atomically (via <a href="../man2/rename.2.html"><strong>rename</strong>(2)</a>. If <strong>--backup</strong>[=<em>NAME</em>] is passed, any existing checkpoint will be backed up instead, either to <em>NAME</em> or with a numbered extension (<em>.~1~</em>, <em>.~2~</em>, etc., with more recent checkpoints having higher numbers).  If <strong>--clobber</strong> is passed, the checkpoint will immediately remove any existing checkpoint files, and will write the checkpoint directly out into the target file/directory: this option uses less disk space if an existing checkpoint is present, since the old checkpoint is immediately discarded, but if the checkpoint fails, the pre-existing checkpoint is lost.  Finally, if <strong>--noclobber</strong> is passed, then the checkpoint will fail if the target file/directory exists.</p>
<h3>File sync</h3>
<p>By default (or when <strong>--sync</strong> is passed), cr_checkpoint waits until the checkpoint is complete in memory, and additionally calls <a href="../man2/fsync.2.html"><strong>fsync</strong>(2)</a> on all files and directories involved in the checkpoint (including back-up files) to disk before exiting.  Passing <strong>--nosync</strong> causes these fsync calls to be skipped.</p>
<h3>Timeout</h3>
<p>A maximum timeout in seconds can be set for a checkpoint via the <strong>--time</strong> flag: if the checkpoint takes longer than this, cr_checkpoint will print an error mesage and exit with an error.  If a timeout occurs, the state of the process or processes that were being checkpointed is undefined.</p>
<h3>Signals</h3>
<p>By default checkpointed processes continue to run after a checkpoint is complete.  Alternatively, you may specify that they be stopped (via <strong>--stop</strong>), or terminated/aborted/killed (via <strong>--term</strong>, <strong>--abort</strong>, or <strong>--kill</strong>). This is done by sending the appropriate signal to every process that is part of the checkpoint. If the processes were stopped at the time the checkpoint was requested, then <strong>--cont</strong> may be used to send SIGCONT to all processes after the checkpoint is completed.</p>
<h3>Memory mapped files</h3>
<p>By default, checkpoints do not include any files that are mmap()ed into the process address space unless they are already unlinked at the time the checkpoint is taken.  This is a space/time saving optimization under the assumption that the files required will still be present (and uncorrupted) at restart time.  Typically the largest savings comes from not saving the executable file or dynamic (a.k.a shared) libraries.  However, options exist to cause the checkpoint to save these files as well.  The flag <strong>--save-exe</strong> will cause the executable file to be included in the context file.  The flag <strong>--save-private</strong> will include in the context file any files that are mapped with the MAP_PRIVATE flag, which under Linux includes the executable and dynamic/shared libaries.  The flag <strong>--save-shared</strong> is for saving files that are mapped with the MAP_SHARED flag.  Note that this is <em>not</em> the flag you want for shared libraries. At restart any file saved by these flags will be mapped into the process regardless of whether any file exists at the original location. If there is file at the original location it remains untouched by the restart. Finally <strong>--save-all</strong> and <strong>--save-none</strong> will cause all (or none) of these optional mmaped files to be saved.  The default is <strong>--save-none</strong>. When passing multiple of these options they are processed from left to right with all options being additive, except for <strong>--save-none</strong> which cancels the effects of any these options appearing earlier.</p>
<h3>Checkpointing ptrace()ed processes</h3>
<p>There is (currently) no way to fully transparently deal with checkpoints of processes that are being traced with <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a>. Therefore, the default behavior (also available via <strong>--ptraced-error</strong>) is to return an error if any of the processes to be checkpointed are currently being ptraced.  However, there are two other possible behaviors to choose among:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--ptraced-skip</strong></p>
  </dt>
  <dd>
    <p>Ptraced processes will be siliently excluded from the checkpoint.  No error is generated unless this results in zero processes checkpointed.</p>
  </dd>
  <dt>
    <p><strong>--ptraced-allow</strong></p>
  </dt>
  <dd>
    <p>Ptraced processes will be checkpointed just like any other processes. <em>WARNING</em>: Because the checkpointed process and the BLCR kernel module must interact using signals and system calls, the debugger (or other tracer) may need to `continue' the target process(es), possibly more than once, to allow the checkpoint to complete.</p>
  </dd>

</dl>

<h3>Checkpointing ptrace()ing processes</h3>
<p>There is (currently) no way to fully transparently deal with checkpoints of processes that are tracing other processes using <a href="../man2/ptrace.2.html"><strong>ptrace</strong>(2)</a>. Therefore, the default behavior (also available via <strong>--ptracer-error</strong>) is to return an error if any of the processes to be checkpointed are currently ptracing other processes.  However <strong>--ptracer-skip</strong> is available to cause cr_checkpoint to silently exclude such processes from the checkpoint.  No error is generated in that case unless this would result in zero processes checkpointed.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>General options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-v</strong>, <strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>print progress messages to stderr.</p>
  </dd>
  <dt>
    <p><strong>-q</strong>, <strong>--quiet</strong></p>
  </dt>
  <dd>
    <p>suppress error/warning messages to stderr.</p>
  </dd>
  <dt>
    <p>-?, <strong>--help</strong></p>
  </dt>
  <dd>
    <p>print this message and exit.</p>
  </dd>
  <dt>
    <p><strong>--version</strong></p>
  </dt>
  <dd>
    <p>print version information and exit.</p>
  </dd>

</dl>

<h3>Options for scope of the checkpoint:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-T</strong>, <strong>--tree</strong></p>
  </dt>
  <dd>
    <p>ID identifies a process id.  It and all of its descendants are to be checkpointed. This is the default.</p>
  </dd>
  <dt>
    <p><strong>-p</strong>, <strong>--pid</strong>, <strong>--process</strong></p>
  </dt>
  <dd>
    <p>ID identifies a single process id.</p>
  </dd>
  <dt>
    <p><strong>-g</strong>, <strong>--pgid</strong>, <strong>--group</strong></p>
  </dt>
  <dd>
    <p>ID identifies a process group id.</p>
  </dd>
  <dt>
    <p><strong>-s</strong>, <strong>--sid</strong>, <strong>--session</strong></p>
  </dt>
  <dd>
    <p>ID identifies a session id.</p>
  </dd>

</dl>

<h3>Options for destination location of the checkpoint:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-c</strong>, <strong>--cwd</strong></p>
  </dt>
  <dd>
    <p>checkpoint saved as a single 'context.ID' file in cr_checkpoint's working directory (default).</p>
  </dd>
  <dt>
    <p><strong>-d</strong>, <strong>--dir</strong> DIR</p>
  </dt>
  <dd>
    <p>checkpoint saved in new directory DIR, with one 'context.ID' file per process (unimplemented).</p>
  </dd>
  <dt>
    <p><strong>-f</strong>, <strong>--file</strong> FILE</p>
  </dt>
  <dd>
    <p>checkpoint saved as FILE.</p>
  </dd>
  <dt>
    <p><strong>-F</strong>, <strong>--fd</strong> FD</p>
  </dt>
  <dd>
    <p>checkpoint written to an open file descriptor.</p>
  </dd>

</dl>

<h3>Options for creation/replacement policy for checkpoint files:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--atomic</strong></p>
  </dt>
  <dd>
    <p>checkpoint created/replaced atomically (default).</p>
  </dd>
  <dt>
    <p><strong>--backup</strong>[=<em>NAME</em>]</p>
  </dt>
  <dd>
    <p>checkpoint created atomically, and any existing checkpoint backed up to NAME or *.~1~, *.~2~, etc.</p>
  </dd>
  <dt>
    <p><strong>--clobber</strong></p>
  </dt>
  <dd>
    <p>checkpoint written incrementally to target, overwriting any pre-existing checkpoint.</p>
  </dd>
  <dt>
    <p><strong>--noclobber</strong></p>
  </dt>
  <dd>
    <p>checkpoint will fail if the target file exists.</p><ul>
<li><p>These options are ignored if the destination is a file descriptor.</p></li>
</ul>
  </dd>

</dl>

<h3>Options for signal sent to process(es) after checkpoint:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--run</strong></p>
  </dt>
  <dd>
    <p>no signal sent: continue execution (default).</p>
  </dd>
  <dt>
    <p><strong>-S</strong>, <strong>--signal</strong> NUM</p>
  </dt>
  <dd>
    <p>signal NUM sent to all processess.</p>
  </dd>
  <dt>
    <p><strong>--stop</strong></p>
  </dt>
  <dd>
    <p>SIGSTOP sent to all processes.</p>
  </dd>
  <dt>
    <p><strong>--term</strong></p>
  </dt>
  <dd>
    <p>SIGTERM sent to all processes.</p>
  </dd>
  <dt>
    <p><strong>--abort</strong></p>
  </dt>
  <dd>
    <p>SIGABRT sent to all processes.</p>
  </dd>
  <dt>
    <p><strong>--kill</strong></p>
  </dt>
  <dd>
    <p>SIGKILL sent to all processes.</p>
  </dd>
  <dt>
    <p><strong>--cont</strong></p>
  </dt>
  <dd>
    <p>SIGCONT sent to all processes.</p><ul>
<li><p>Options in this group are mutually exclusive. If more than one is given then only the last will be honored.</p></li>
</ul>
  </dd>

</dl>

<h3>Options for file system synchronization (default is --sync):</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--sync</strong></p>
  </dt>
  <dd>
    <p>fsync checkpoint file(s) to disk (default).</p>
  </dd>
  <dt>
    <p><strong>--nosync</strong></p>
  </dt>
  <dd>
    <p>do not fsync checkpoint file(s) to disk.</p>
  </dd>

</dl>

<h3>Options to save optional portions of memory:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--save-exe</strong></p>
  </dt>
  <dd>
    <p>save the executable file.</p>
  </dd>
  <dt>
    <p><strong>--save-private</strong></p>
  </dt>
  <dd>
    <p>save private mapped files. (executables and libraries are mapped this way)</p>
  </dd>
  <dt>
    <p><strong>--save-shared</strong></p>
  </dt>
  <dd>
    <p>save shared mapped files. (System V IPC is mapped this way).</p>
  </dd>
  <dt>
    <p><strong>--save-all</strong></p>
  </dt>
  <dd>
    <p>save all of the above.</p>
  </dd>
  <dt>
    <p><strong>--save-none</strong></p>
  </dt>
  <dd>
    <p>save none of the above (the default).</p>
  </dd>

</dl>

<h3>Options for ptraced processes (default is --ptraced-error):</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--ptraced-error</strong></p>
  </dt>
  <dd>
    <p>return an error if a checkpoint is requested of a process being ptraced.</p>
  </dd>
  <dt>
    <p><strong>--ptraced-skip</strong></p>
  </dt>
  <dd>
    <p>ptraced processes are silently excluded from the checkpoint request.  If the checkpoint scope is <strong>--tree</strong>, then this will also exclude any children of such processes.  No error is produced unless this results in zero processes checkpointed.</p>
  </dd>
  <dt>
    <p><strong>--ptraced-allow</strong></p>
  </dt>
  <dd>
    <p>checkpoint ptraced processes normally. WARNING: This may require the tracer to "continue" the target process(es), possibly more than once.</p>
  </dd>

</dl>

<h3>Options for processes ptracing others (default is --ptracer-error):</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--ptracer-error</strong></p>
  </dt>
  <dd>
    <p>return an error if a checkpoint is requested of a process which is ptracing others.</p>
  </dd>
  <dt>
    <p><strong>--ptracer-skip</strong></p>
  </dt>
  <dd>
    <p>processes ptracing others are silently excluded from the checkpoint request.  If the checkpoint scope is <strong>--tree</strong>, then this will also exclude any children of such processes.  No error is produced unless this results in zero processes checkpointed.</p>
  </dd>

</dl>

<h3>Options for kernel log messages (default is --kmsg-error):</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--kmsg-none</strong></p>
  </dt>
  <dd>
    <p>don't report any kernel messages.</p>
  </dd>
  <dt>
    <p><strong>--kmsg-error</strong></p>
  </dt>
  <dd>
    <p>on checkpoint failure, report on stderr any kernel messages associated with the checkpoint request.</p>
  </dd>
  <dt>
    <p><strong>--kmsg-warning</strong></p>
  </dt>
  <dd>
    <p>report on stderr any kernel messages associated with the checkpoint request, regardless of success or failure.  Messages generated in the absence of failure are considered to be warnings.</p><ul>
<li><p>Options in this group are mutually exclusive. If more than one is given then only the last will be honored. Note that <strong>--quiet</strong> suppresses all stderr output, including these messages.</p></li>
</ul>
  </dd>

</dl>

<h3>Misc Options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-t</strong>, <strong>--time</strong> SEC</p>
  </dt>
  <dd>
    <p>allow only SEC seconds for target to complete checkpoint (default: wait indefinitely).</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>To checkpoint the process with process ID 23452, saving its state to file <em>context.23452</em>:</p><p><strong>cr_checkpoint -p</strong> <em>23452</em></p><p>To checkpoint all the processes in process group 68473, and save them to file <em>groupie</em>:</p><p><strong>cr_checkpoint -g -f</strong> <em>groupie 68473</em></p><p>To checkpoint all the process in session 8362, and save separate 'context.PID' files for each process in directory 'my_checkpoints':</p><p><strong>cr_checkpoint -s -d</strong> <em>my_checkpoints 8362</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Some features in this manpage may be unimplemented.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Jason Duell, Paul Hargrove, and Eric Roman, Lawrence Berkeley National Laboratory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Bug reports may be filed on the web at <strong>http://mantis.lbl.gov/bugzilla</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO cr_checkpoint&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/cr_restart.1.html"><strong>cr_restart</strong>(1)</a>, <a href="../man1/cr_run.1.html"><strong>cr_run</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cqrlog.1.html"><span aria-hidden="true">&larr;</span> cqrlog.1: Advanced logging program for hamradio operators</a></li>
   <li class="next"><a href="cr_restart.1.html">cr_restart.1: Restarts a process, process group, or session from a checkpoint file. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
