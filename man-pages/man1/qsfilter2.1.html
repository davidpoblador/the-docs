<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>qsfilter2: An utility to generate mod_qos request line rules out from existing access/audit log data.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="An utility to generate mod_qos request line rules out from existing access/audit log data.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="qsfilter2 (1) manual">
  <meta name="twitter:description" content="An utility to generate mod_qos request line rules out from existing access/audit log data.">
  <meta name="twitter:image" content="https://www.carta.tech/images/libapache2-mod-qos-qsfilter2-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/qsfilter2.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="qsfilter2 (1) manual" />
  <meta property="og:description" content="An utility to generate mod_qos request line rules out from existing access/audit log data." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libapache2-mod-qos-qsfilter2-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">qsfilter2<small> (1)</small></h1>
        <p class="lead">An utility to generate mod_qos request line rules out from existing access/audit log data.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/qsfilter2.1.html">
      <span itemprop="name">qsfilter2: An utility to generate mod_qos request line rules out from existing access/audit log data.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libapache2-mod-qos/">
      <span itemprop="name">libapache2-mod-qos</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/qsfilter2.1.html">
      <span itemprop="name">qsfilter2: An utility to generate mod_qos request line rules out from existing access/audit log data.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>qsfilter2 -i &lt;path&gt; [-c &lt;path&gt;] [-d &lt;num&gt;] [-h] [-b &lt;num&gt;] [-p|-s|-m|-o] [-l &lt;len&gt;] [-n] [-e] [-u 'uni'] [-k &lt;prefix&gt;] [-t] [-f &lt;path&gt;] [-v 0|1|2]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>mod_qos implements a request filter which validates each request line. The module supports both, negative and positive security model. The QS_Deny* directives are used to specify request line patterns which are not allowed to access the server (negative security model / blacklist). These rules are used to restrict access to certain resources which should not be available to users or to protect the server from malicious patterns. The QS_Permit* rules implement a positive security model (whitelist). These directives are used to define allowed request line patterns. Request which do not match any of thses patterns are not allowed to access the server.</p><p>qsfilter2 is an audit log analyzer used to generate filter rules (perl compatible regular expressions) which may be used by mod_qos to deny access for suspect requests (QS_PermitUri rules). It parses existing audit log files in order to generate request patterns covering all allowed requests.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p>-i &lt;path&gt;</p>
  </dt>
  <dd>
    <p>Input file containing request URIs. The URIs for this file have to be extracted from the servers access logs. Each line of the input file contains a request URI consiting of a path and and query.</p>
<pre>
     Example:
       /aaa/index.do
       /aaa/edit?image=1.jpg
       /aaa/image/1.jpg
       /aaa/view?page=1
       /aaa/edit?document=1
</pre>
<p>These access log data must include current request URIs but also request lines from previous rule generation steps. It must also include request lines which cover manually generated rules.</p>
  </dd>
  <dt>
    <p>-c &lt;path&gt;</p>
  </dt>
  <dd>
    <p>mod_qos configuration file defining QS_DenyRequestLine and QS_PermitUri directives. qsfilter2 generates rules from access log data automatically. Manually generated rules (QS_PermitUri) may be provided from this file. Note: each manual rule must be represented by a request URI in the input data (-i) in order to make sure not to be deleted by the rule optimisation algorithm. QS_Deny* rules from this file are used to filter request lines which should not be used for whitelist rule generation.</p>
<pre>
     Example:
       # manually defined whitelist rule:
       QS_PermitUri +view deny "^[/a-zA-Z0-9]+/view&#92;?(page=[0-9]+)?$"
       # filter unwanted request line patterns:
       QS_DenyRequestLine +printable deny ".*[&#92;x00-&#92;x19].*"
</pre>

  </dd>
  <dt>
    <p>-d &lt;num&gt;</p>
  </dt>
  <dd>
    <p>Depth (sub locations) of the path string which is defined as a literal string. Default is 1.</p>
  </dd>
  <dt>
    <p>-h</p>
  </dt>
  <dd>
    <p>Always use a string representing the handler name in the path even the url does not have a query. See also -d option.</p>
  </dd>
  <dt>
    <p>-b &lt;num&gt;</p>
  </dt>
  <dd>
    <p>Replaces url pattern by the regular expression when detecting a base64/hex encoded string. Detecting sensibility is defined by a numeric value. You should use values higher than 5 (default) or 0 to disable this function.</p>
  </dd>
  <dt>
    <p>-p</p>
  </dt>
  <dd>
    <p>Repesents query by pcre only (no literal strings).</p>
  </dd>
  <dt>
    <p>-s</p>
  </dt>
  <dd>
    <p>Uses one single pcre for the whole query string.</p>
  </dd>
  <dt>
    <p>-m</p>
  </dt>
  <dd>
    <p>Uses one pcre for multipe query values (recommended mode).</p>
  </dd>
  <dt>
    <p>-o</p>
  </dt>
  <dd>
    <p>Does not care the order of query parameters.</p>
  </dd>
  <dt>
    <p>-l &lt;len&gt;</p>
  </dt>
  <dd>
    <p>Outsizes the query length by the defined length ({0,size+len}), default is 10.</p>
  </dd>
  <dt>
    <p>-n</p>
  </dt>
  <dd>
    <p>Disables redundant rules elimination.</p>
  </dd>
  <dt>
    <p>-e</p>
  </dt>
  <dd>
    <p>Exit on error.</p>
  </dd>
  <dt>
    <p>-u 'uni'</p>
  </dt>
  <dd>
    <p>Enables additional decoding methods. Use the same settings as you have used for the QS_Decoding directive.</p>
  </dd>
  <dt>
    <p>-p</p>
  </dt>
  <dd>
    <p>Repesents query by pcre only (no literal strings). Determines the worst case performance for the generated whitelist by applying each rule for each request line (output is real time filter duration per request line in milliseconds).</p>
  </dd>
  <dt>
    <p>-k &lt;prefix&gt;</p>
  </dt>
  <dd>
    <p>Prefix used to generate rule identifiers (QSF by default).</p>
  </dd>
  <dt>
    <p>-t</p>
  </dt>
  <dd>
    <p>Calculates the maximal latency per request (worst case) using the generated rules.</p>
  </dd>
  <dt>
    <p>-f &lt;path&gt;</p>
  </dt>
  <dd>
    <p>Filters the input by the provided path (prefix) only processing matching lines.</p>
  </dd>
  <dt>
    <p>-v &lt;level&gt;</p>
  </dt>
  <dd>
    <p>Verbose mode. (0=silent, 1=rule source, 2=detailed). Default is 1. Don't use rules you haven't checked the request data used to generate it! Level 1 is highly recommended (as long as you don't have created the log data using your own web crawler).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OUTPUT</h2>
        <div class="sectioncontent">
<p>The output of qsfilter2 is written to stdout. The output contains the generated QS_PermitUri directives but also information about the source which has been used to generate these rules. It is very important to check the validity of each request line which has been used to calculate the QS_PermitUri rules. Each request line which has been used to generate a new rule is shown in the output prefixed by "ADD line &lt;line number&gt;:". These request lines should be stored and reused at any later rule generation (add them to the URI input file). The subsequent line shows the generated rule. At the end of data processing a list of all generated QS_PermitUri rules is shown. These directives may be used withn the configuration file used by mod_qos.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<pre>
  ./qsfilter2 -i loc.txt -c httpd.conf -m -e
  ...
  # ADD line 1: /aaa/index.do
  # 003 ^(/[a-zA-Z0-9&#92;-_]+)+[/]?&#92;.?[a-zA-Z]{0,4}$
  # ADD line 3: /aaa/view?page=1
  # --- ^[/a-zA-Z0-9]+/view&#92;?(page=[0-9]+)?$
  # ADD line 4: /aaa/edit?document=1
  # 004 ^[/a-zA-Z]+/edit&#92;?((document)(=[0-9]*)*[&]?)*$
  # ADD line 5: /aaa/edit?image=1.jpg
  # 005 ^[/a-zA-Z]+/edit&#92;?((image)(=[0-9&#92;.a-zA-Z]*)*[&]?)*$
  ...
  QS_PermitUri +QSF001 deny "^[/a-zA-Z]+/edit&#92;?((document|image)(=[0-9&#92;.a-zA-Z]*)*[&]?)*$"
  QS_PermitUri +QSF002 deny "^[/a-zA-Z0-9]+/view&#92;?(page=[0-9]+)?$"
  QS_PermitUri +QSF003 deny "^(/[a-zA-Z0-9&#92;-_]+)+[/]?&#92;.?[a-zA-Z]{0,4}$"
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO qsfilter2&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/qsexec.1.html"><strong>qsexec</strong>(1)</a>, <strong>qsgeo</strong>(1), <a href="../man1/qsgrep.1.html"><strong>qsgrep</strong>(1)</a>, <strong>qshead</strong>(1), <a href="../man1/qslog.1.html"><strong>qslog</strong>(1)</a>, <a href="../man1/qslogger.1.html"><strong>qslogger</strong>(1)</a>, <a href="../man1/qspng.1.html"><strong>qspng</strong>(1)</a>, <a href="../man1/qsrotate.1.html"><strong>qsrotate</strong>(1)</a>, <a href="../man1/qssign.1.html"><strong>qssign</strong>(1)</a>, <a href="../man1/qstail.1.html"><strong>qstail</strong>(1)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Pascal Buchbinder, http://opensource.adnovum.ch/mod_qos/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="qsf.1.html"><span aria-hidden="true">&larr;</span> qsf.1: Quick spam filter</a></li>
   <li class="next"><a href="qsgrep.1.html">qsgrep.1: Prints matching patterns within a file. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
