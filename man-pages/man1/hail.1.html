<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>hail: Ganeti iallocator plugin</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Ganeti iallocator plugin">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="hail (1) manual">
  <meta name="twitter:description" content="Ganeti iallocator plugin">
  <meta name="twitter:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hail-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/hail.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="hail (1) manual" />
  <meta property="og:description" content="Ganeti iallocator plugin" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/ganeti-htools-2.12-hail-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">hail<small> (1)</small></h1>
        <p class="lead">Ganeti iallocator plugin</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hail.1.html">
      <span itemprop="name">hail: Ganeti iallocator plugin</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/ganeti-htools-2.12/">
      <span itemprop="name">ganeti-htools-2.12</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/hail.1.html">
      <span itemprop="name">hail: Ganeti iallocator plugin</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>hail</strong> [ <strong>-t</strong> <em>file</em> | <strong>--simulate</strong> <em>spec</em> ] [options...] <em>input-file</em></p><p><strong>hail</strong> --version</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>hail is a Ganeti IAllocator plugin that implements the instance placement and movement using the same algorithm as <a href="../man1/hbal.1.html"><strong>hbal</strong>(1)</a>.</p><p>The program takes input via a JSON-file containing current cluster state and the request details, and output (on stdout) a JSON-formatted response. In case of critical failures, the error message is printed on stderr and the exit code is changed to show failure.</p><p>If the input file name is - (a single minus sign), then the request data will be read from <em>stdin</em>.</p><p>Apart from input data, hail collects data over the network from all MonDs with the --mond option. Currently it uses only data produced by the CPUload collector.</p><h3>ALGORITHM</h3>
<p>The program uses a simplified version of the hbal algorithm.</p><p>For single-node allocations (non-mirrored instances), again we select the node which, when chosen as the primary node, gives the best score.</p><p>For dual-node allocations (mirrored instances), we chose the best pair; this is the only choice where the algorithm is non-trivial with regard to cluster size.</p><p>For relocations, we try to change the secondary node of the instance to all the valid other nodes; the node which results in the best cluster score is chosen.</p><p>For node changes (<em>change-node</em> mode), we currently support DRBD instances only, and all three modes (primary changes, secondary changes and all node changes).</p><p>For group moves (<em>change-group</em> mode), again only DRBD is supported, and we compute the correct sequence that will result in a group change; job failure mid-way will result in a split instance. The choice of node(s) on the target group is based on the group score, and the choice of group is based on the same algorithm as allocations (group with lowest score after placement).</p><p>The deprecated <em>multi-evacuate</em> modes is no longer supported.</p><p>In all cases, the cluster (or group) scoring is identical to the hbal algorithm.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>The options that can be passed to the program are as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-p, --print-nodes</strong></p>
  </dt>
  <dd>
    <p>Prints the before and after node status, in a format designed to allow the user to understand the node\[aq]s most important parameters. See the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> for more details about this option.</p>
  </dd>
  <dt>
    <p><strong>-t </strong><em>datafile</em>, --text-data=<em>datafile</em></p>
  </dt>
  <dd>
    <p>The name of the file holding cluster information, to override the data in the JSON request itself. This is mostly used for debugging. The format of the file is described in the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>--mond=</strong><em>yes|no</em></p>
  </dt>
  <dd>
    <p>If given the program will query all MonDs to fetch data from the supported data collectors over the network.</p>
  </dd>
  <dt>
    <p><strong>--mond-data </strong><em>datafile</em></p>
  </dt>
  <dd>
    <p>The name of the file holding the data provided by MonD, to override quering MonDs over the network. This is mostly used for debugging. The file must be in JSON format and present an array of JSON objects , one for every node, with two members. The first member named node is the name of the node and the second member named reports is an array of report objects. The report objects must be in the same format as produced by the monitoring agent.</p>
  </dd>
  <dt>
    <p><strong>--ignore-dynu</strong></p>
  </dt>
  <dd>
    <p>If given, all dynamic utilisation information will be ignored by assuming it to be 0. This option will take precedence over any data passed by the MonDs with the --mond and the --mond-data option.</p>
  </dd>
  <dt>
    <p><strong>--simulate </strong><em>description</em></p>
  </dt>
  <dd>
    <p>Backend specification: similar to the <strong>-t</strong> option, this allows overriding the cluster data with a simulated cluster. For details about the description, see the man page <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>-S </strong><em>filename</em>, --save-cluster=<em>filename</em></p>
  </dt>
  <dd>
    <p>If given, the state of the cluster before and the iallocator run is saved to a file named <em>filename.pre-ialloc</em>, respectively <em>filename.post-ialloc</em>. This allows re-feeding the cluster state to any of the htools utilities via the -t option.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>This option increases verbosity and can be used for debugging in order to understand how the IAllocator request is parsed; it can be passed multiple times for successively more information.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>For the tag-exclusion configuration (see the manpage of hbal for more details), the list of which instance tags to consider as exclusion tags will be read from the cluster tags, configured as follows:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>get all cluster tags starting with <strong>htools:iextags:</strong></p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>use their suffix as the prefix for exclusion tags</p>
  </dd>

</dl>
<p>For example, given a cluster tag like <strong>htools:iextags:service</strong>, all instance tags of the form <strong>service:X</strong> will be considered as exclusion tags, meaning that (e.g.)  two instances which both have a tag <strong>service:foo</strong> will not be placed on the same primary node.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>The options that can be passed to the program are as follows:</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXIT STATUS</h2>
        <div class="sectioncontent">
<p>The exist status of the command will be zero, unless for some reason the algorithm fatally failed (e.g. wrong node or instance data).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Networks (as configured by <a href="../man8/gnt-network.8.html"><strong>gnt-network</strong>(8)</a>) are not taken into account in Ganeti 2.7. The only way to guarantee that they work correctly is having your networks connected to all nodegroups. This will be fixed in a future version.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs to project website (http://code.google.com/p/ganeti/) or contact the developers using the Ganeti mailing list (ganeti@googlegroups.com).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO hail&hellip;</h2>
        <div class="sectioncontent">
<p>Ganeti overview and specifications: <a href="../man7/ganeti.7.html"><strong>ganeti</strong>(7)</a> (general overview), <a href="../man7/ganeti-os-interface.7.html"><strong>ganeti-os-interface</strong>(7)</a> (guest OS definitions), <a href="../man7/ganeti-extstorage-interface.7.html"><strong>ganeti-extstorage-interface</strong>(7)</a> (external storage providers).</p><p>Ganeti commands: <a href="../man8/gnt-cluster.8.html"><strong>gnt-cluster</strong>(8)</a> (cluster-wide commands), <a href="../man8/gnt-job.8.html"><strong>gnt-job</strong>(8)</a> (job-related commands), <a href="../man8/gnt-node.8.html"><strong>gnt-node</strong>(8)</a> (node-related commands), <a href="../man8/gnt-instance.8.html"><strong>gnt-instance</strong>(8)</a> (instance commands), <a href="../man8/gnt-os.8.html"><strong>gnt-os</strong>(8)</a> (guest OS commands), <a href="../man8/gnt-storage.8.html"><strong>gnt-storage</strong>(8)</a> (storage commands), <a href="../man8/gnt-group.8.html"><strong>gnt-group</strong>(8)</a> (node group commands), <a href="../man8/gnt-backup.8.html"><strong>gnt-backup</strong>(8)</a> (instance import/export commands), <a href="../man8/gnt-debug.8.html"><strong>gnt-debug</strong>(8)</a> (debug commands).</p><p>Ganeti daemons: <a href="../man8/ganeti-watcher.8.html"><strong>ganeti-watcher</strong>(8)</a> (automatic instance restarter), <a href="../man8/ganeti-cleaner.8.html"><strong>ganeti-cleaner</strong>(8)</a> (job queue cleaner), <a href="../man8/ganeti-noded.8.html"><strong>ganeti-noded</strong>(8)</a> (node daemon), <strong>ganeti-masterd</strong>(8) (master daemon), <a href="../man8/ganeti-rapi.8.html"><strong>ganeti-rapi</strong>(8)</a> (remote API daemon).</p><p>Ganeti htools: <a href="../man1/htools.1.html"><strong>htools</strong>(1)</a> (generic binary), <a href="../man1/hbal.1.html"><strong>hbal</strong>(1)</a> (cluster balancer), <a href="../man1/hspace.1.html"><strong>hspace</strong>(1)</a> (capacity calculation), <a href="../man1/hail.1.html"><strong>hail</strong>(1)</a> (IAllocator plugin), <a href="../man1/hscan.1.html"><strong>hscan</strong>(1)</a> (data gatherer from remote clusters), <a href="../man1/hinfo.1.html"><strong>hinfo</strong>(1)</a> (cluster information printer), <a href="../man7/mon-collector.7.html"><strong>mon-collector</strong>(7)</a> (data collectors interface).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2006-2014 Google Inc. All rights reserved.</p><p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p><p>1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p><p>2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p><p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="haddock.1.html"><span aria-hidden="true">&larr;</span> haddock.1: Documentation tool for annotated haskell source code</a></li>
   <li class="next"><a href="halibut.1.html">halibut.1: Multi-format documentation formatting tool <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
