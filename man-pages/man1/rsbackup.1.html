<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>rsbackup: Rsync-based backup utility</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Rsync-based backup utility">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="rsbackup (1) manual">
  <meta name="twitter:description" content="Rsync-based backup utility">
  <meta name="twitter:image" content="https://www.carta.tech/images/rsbackup-rsbackup-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/rsbackup.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="rsbackup (1) manual" />
  <meta property="og:description" content="Rsync-based backup utility" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/rsbackup-rsbackup-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">rsbackup<small> (1)</small></h1>
        <p class="lead">Rsync-based backup utility</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rsbackup.1.html">
      <span itemprop="name">rsbackup: Rsync-based backup utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/rsbackup/">
      <span itemprop="name">rsbackup</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rsbackup.1.html">
      <span itemprop="name">rsbackup: Rsync-based backup utility</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>rsbackup</strong> [<em>OPTIONS</em>] [<strong>--</strong>] [<em>SELECTOR</em>...]</p><p><strong>rsbackup --retire [</strong><em>OPTIONS</em>] [<strong>--</strong>] [<em>SELECTOR</em>...]</p><p><strong>rsbackup --retire-device [</strong><em>OPTIONS</em>] [<strong>--</strong>] <em>DEVICE</em>...</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Backs up files from one or more (remote) destinations to a single backup storage directory, preserving their contents, layout, ownership, permissions, timestamps and hardlink structure.</p><p>Incremental backups are achieved by hard-linking identical files within successive backups of the same files.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>Action Options</h3>
<p>At least one of these options must be specified. When multiple actions are specified, they are executed in the order shown below.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>--backup</strong>, <strong>-b</strong></p>
  </dt>
  <dd>
    <p>Make a backup of the selected volumes. At most one backup of a given volume will be made per day.</p>
  </dd>
  <dt>
    <p><strong>--retire-device</strong></p>
  </dt>
  <dd>
    <p>Retire the named devices. Retiring a device means deleting the logfiles for it. Files on the device itself are not touched.</p><ul>
<li><p>If the device is still listed in the configuration file then you will be asked whether you really want to retire it; you can suppress this check with the <strong>--force</strong> option.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>--retire</strong></p>
  </dt>
  <dd>
    <p>Retire the named hosts and volumes. Retiring a volume means deleting any available backups for the volume and their corresponding logfiles. Logfiles on backups for unavailable devices are not removed.</p><ul>
<li><p>If you just want to remove logfiles for retired volumes but want to keep the backups, you should either manually remove the logfiles, or rename it within the volume.</p></li><li><p>If the volume is still listed in the configuration file then you will be asked whether you really want to retire it; you can suppress this check with the <strong>--force</strong> option.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>--prune</strong>, <strong>-p</strong></p>
  </dt>
  <dd>
    <p>Prune old backups of selected volumes. Any backups that are older than the <strong>prune-age</strong> listed for them in the current configuration will be deleted provided that does not reduce the number of backups below the volume's <strong>min-backups</strong> setting.</p>
  </dd>
  <dt>
    <p><strong>--prune-incomplete,</strong><strong>-P</strong></p>
  </dt>
  <dd>
    <p>Prune incomplete backups of selected volumes. Any backups that failed before completion will be removed.</p>
  </dd>
  <dt>
    <p><strong>--html </strong><em>PATH</em>, <strong>-H </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Write an HTML report to <em>PATH</em>. The report covers all volumes, not just selected ones. <em>PATH</em> can be <strong>-</strong> to write to standard output.</p>
  </dd>
  <dt>
    <p><strong>--text </strong><em>PATH</em>, <strong>-T </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Write a plain text report to <em>PATH</em>. The report covers all volumes, not just selected ones. <em>PATH</em> can be <strong>-</strong> to write to standard output.</p>
  </dd>
  <dt>
    <p><strong>--email </strong><em>ADDRESS</em>, <strong>-e </strong><em>ADDRESS</em></p>
  </dt>
  <dd>
    <p>Email a report to <em>ADDRESS</em>. The contents is equivalent to the output of <strong>--text</strong> and <strong>--html</strong>.</p>
  </dd>
  <dt>
    <p><strong>--dump-config</strong></p>
  </dt>
  <dd>
    <p>Writes the parsed configuration file to standard output. Must not be combined with any other action option.</p>
  </dd>

</dl>

<h3>General Options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--config </strong><em>PATH</em>, <strong>-c </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>The path to the configuration file. The default is <em>/etc/rsbackup/config</em>.</p>
  </dd>
  <dt>
    <p><strong>--store </strong><em>PATH</em>, <strong>-s </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Specify the destination directory to back up to. Using this option (possibly more than once) is equivalent to removing the <strong>store</strong> directives from the configuration file and replacing them with the paths give in <strong>--store</strong> options.</p><ul>
<li><p>This option implicitly enables the <strong>--warn-store</strong> option.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>--verbose</strong>, <strong>-v</strong></p>
  </dt>
  <dd>
    <p>Enable verbose mode. Various messages will be displayed to report progress and the rsync <strong>--quiet</strong> option is suppressed.</p>
  </dd>
  <dt>
    <p><strong>--dry-run</strong>, <strong>-n</strong></p>
  </dt>
  <dd>
    <p>Enable dry-run mode. Commands will be displayed but nothing will actually be done.</p>
  </dd>
  <dt>
    <p><strong>--force</strong>, <strong>-f</strong></p>
  </dt>
  <dd>
    <p>Suppress checks made when retiring devices and volumes.</p>
  </dd>
  <dt>
    <p><strong>--wait</strong>, <strong>-w</strong></p>
  </dt>
  <dd>
    <p>Waits rather than giving up if another copy of <strong>rsbackup</strong> is running.</p>
  </dd>
  <dt>
    <p><strong>--help</strong>, <strong>-h</strong></p>
  </dt>
  <dd>
    <p>Display a usage message.</p>
  </dd>
  <dt>
    <p><strong>--version</strong>, <strong>-V</strong></p>
  </dt>
  <dd>
    <p>Display the version number.</p>
  </dd>

</dl>

<h3>Report Verbosity</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--logs </strong><em>VERBOSITY</em></p>
  </dt>
  <dd>
    <p>Controls which logfiles for a given volume/device pair to include in the report. The possible values of <em>VERBOSITY</em> are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>all</strong></p>
  </dt>
  <dd>
    <p>Includes all nonempty logfiles, even if the backup succeeded.</p>
  </dd>
  <dt>
    <p><strong>errors</strong></p>
  </dt>
  <dd>
    <p>Includes all error logfiles.</p>
  </dd>
  <dt>
    <p><strong>recent</strong></p>
  </dt>
  <dd>
    <p>Includes only the most recent error logfile.</p>
  </dd>
  <dt>
    <p><strong>latest</strong></p>
  </dt>
  <dd>
    <p>Includes only the latest logfile, even if the backup succeeded.</p>
  </dd>
  <dt>
    <p><strong>failed</strong></p>
  </dt>
  <dd>
    <p>Includes only the most recent logfile but only if that attempt failed. This is the default.</p>
  </dd>

</dl>

  </dd>

</dl>

<h3>Warning Options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--warn-unknown</strong></p>
  </dt>
  <dd>
    <p>Display warnings for unknown devices, hosts and volumes. (Warnings will always be included in the report, this refers to runtime error output.)</p>
  </dd>
  <dt>
    <p><strong>--warn-store</strong></p>
  </dt>
  <dd>
    <p>Display warnings for unsuitable store directories and unavailable devices.</p>
  </dd>
  <dt>
    <p><strong>--warn-unreachable</strong></p>
  </dt>
  <dd>
    <p>Display warnings for unreachable hosts.</p>
  </dd>
  <dt>
    <p><strong>--no-warn-partial</strong></p>
  </dt>
  <dd>
    <p>Suppress warnings for rsync "partial transfer" diagnostics (which are on by default).</p>
  </dd>
  <dt>
    <p><strong>--warn-all</strong>, <strong>-W</strong></p>
  </dt>
  <dd>
    <p>Enable all <strong>--warn-</strong> options.</p>
  </dd>
  <dt>
    <p><strong>--no-errors</strong></p>
  </dt>
  <dd>
    <p>Suppress display of errors from rsync.</p>
  </dd>

</dl>

<h3>Volume Selection</h3>
<p>The list of selectors on the command line determines what subset of the known volumes are backed up, pruned or retired. The following selectors are possible:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>HOST</em></p>
  </dt>
  <dd>
    <p>Select all volumes for the host.</p>
  </dd>
  <dt>
    <p><em>HOST</em>:<em>VOLUME</em></p>
  </dt>
  <dd>
    <p>Select the volume.</p>
  </dd>
  <dt>
    <p><strong>-</strong><em>HOST</em></p>
  </dt>
  <dd>
    <p>Deselect all volumes for the host.</p>
  </dd>
  <dt>
    <p><strong>-</strong><em>HOST</em><strong>:</strong><em>VOLUME</em></p>
  </dt>
  <dd>
    <p>Deselect the volume.</p>
  </dd>
  <dt>
    <p><strong>*</strong></p>
  </dt>
  <dd>
    <p>Select all volumes.</p>
  </dd>

</dl>
<p>If no hosts or volumes are specified on the command line then all volumes are selected for backing up or pruning. For retiring, you must explicitly select hosts or volumes to retire and only positive selections are possible.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION FILE</h2>
        <div class="sectioncontent">
<p>The config file contains global directives and a series of host stanzas. Each host stanze in turn contains host directives and volume stanzas. Although it is not enforced it is suggested that host and volume stanzas are indented.</p><p>Comments are introduced by an initial "#".</p><p>Command arguments may be quoted, using "double quotes". Quotes and backslashes within quoted strings are escaped with backslashes.</p><h3>Global Directives</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>store </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>A path at which a backup device may be mounted. This can be used multiple times.</p>
  </dd>
  <dt>
    <p><strong>device </strong><em>DEVICE</em></p>
  </dt>
  <dd>
    <p>Names a device. This can be used multiple times. The store must have a file called <em>STORE</em><strong>/device-id</strong> which contains a known device name. Backups will only be made to known devices.</p><ul>
<li><p>When a device is lost or destroyed, remove its device entry and use the --prune-unknown option to delete logs of backups on it.</p></li><li><p>Device names may contain letters, digits, dots and underscores.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>public</strong></p>
  </dt>
  <dd>
    <p>Backups are public. Normally backups must only be accessible by the calling user. This option suppresses the check.</p>
  </dd>
  <dt>
    <p><strong>logs </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>The directory to store logfiles. The default is <em>/var/log/backup</em>.</p>
  </dd>
  <dt>
    <p><strong>lock </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Enable locking. If this directive is present then <em>PATH</em> will be used as a lockfile for operations that change anything (--backup, --prune, etc).</p>
  </dd>
  <dt>
    <p><strong>ssh-timeout </strong><em>SECONDS</em></p>
  </dt>
  <dd>
    <p>How long to wait before concluding a host is down. The default is 3.</p>
  </dd>
  <dt>
    <p><strong>max-age </strong><em>DAYS</em></p>
  </dt>
  <dd>
    <p>The maximum age of the most recent backup before you feel uncomfortable. The default is 3, meaning that if a volume hasn't been backed up in the last 3 days it will have red ink in the HTML report.</p>
  </dd>
  <dt>
    <p><strong>min-backups </strong><em>COUNT</em></p>
  </dt>
  <dd>
    <p>The minimum number of backups for each volume to keep on each store, when pruning. The default is 1.</p>
  </dd>
  <dt>
    <p><strong>prune-age </strong><em>DAYS</em></p>
  </dt>
  <dd>
    <p>The age at which a backup may be pruned. The default is 366, meaning a backup will never be pruned until it is at least a whole year old.</p>
  </dd>
  <dt>
    <p><strong>keep-prune-logs </strong><em>DAYS</em></p>
  </dt>
  <dd>
    <p>The number of days to keep prune logs for. The default is 31.</p>
  </dd>
  <dt>
    <p><strong>include </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Include another file as part of the configuration. If <em>PATH</em> is a directory then the files within it are included (excluding dotfiles, backup and recovery files).</p>
  </dd>
  <dt>
    <p><strong>pre-access-hook </strong><em>COMMAND</em>...</p>
  </dt>
  <dd>
    <p>A command to execute before anything that accesses any backup devices (i.e. backup and prune operations). This is executed only once per invocation of <strong>rsbackup</strong> and if it fails (i.e. exits nonzero) then <strong>rsbackup</strong> terminates immediately. See <strong>HOOKS</strong> below.</p>
  </dd>
  <dt>
    <p><strong>post-access-hook </strong><em>COMMAND</em>...</p>
  </dt>
  <dd>
    <p>A command to execute after all backup and prune operations. This is executed only once per invocation of <strong>rsbackup</strong>. A backup is still considered to have succeeded even if the post-access hook fails (i.e. exits nonzero). See <strong>HOOKS</strong> below.</p>
  </dd>
  <dt>
    <p><strong>pre-backup-hook </strong><em>COMMAND</em>...</p>
  </dt>
  <dd>
    <p>A command to execute before starting a backup. If this hook fails (i.e. exits nonzero) then the backup is not made and the post-backup hook will not be run. See <strong>HOOKS</strong> below.</p><ul>
<li><p>This hook can override the source path for the backup by writing a new source path to standard output.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>post-backup-hook </strong><em>COMMAND</em>...</p>
  </dt>
  <dd>
    <p>A command to execute after finishing a backup, or after it failed. A backup is still considered to have succeeded even if the post-backup hook fails (exits nonzero). See <strong>HOOKS</strong> below.</p>
  </dd>
  <dt>
    <p><strong>rsync-timeout </strong><em>SECONDS</em></p>
  </dt>
  <dd>
    <p>How long to wait before concluding rsync has hung. The default is 0, which means to wait indefinitely.</p>
  </dd>
  <dt>
    <p><strong>hook-timeout </strong><em>SECONDS</em></p>
  </dt>
  <dd>
    <p>How long to wait before concluding a hook has hung. The default is 0, which means to wait indefinitely.</p>
  </dd>

</dl>

<h3>Host Directives</h3>
<p>A host stanza is started by a host directive. It contains other host directives, and one or more volume stanzas.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>host </strong><em>HOST</em></p>
  </dt>
  <dd>
    <p>Introduce a host stanza. The name is used for the backup directory for this host.</p>
  </dd>
  <dt>
    <p><strong>hostname </strong><em>HOSTNAME</em></p>
  </dt>
  <dd>
    <p>The SSH hostname for this host. The default is the name from the host stanza.</p><ul>
<li><p>The hostname <strong>localhost</strong> is treated specially: it is assumed to always be identical to the local system, so files will be read from the local filesystem.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>user </strong><em>USERNAME</em></p>
  </dt>
  <dd>
    <p>The SSH username for this host. The default is not to supply a username.</p>
  </dd>
  <dt>
    <p><strong>always-up</strong></p>
  </dt>
  <dd>
    <p>Indicates that the host is expected to always be available. If it is not then a warning will be issued when making a backup if it is not.</p>
  </dd>
  <dt>
    <p><strong>devices </strong><em>PATTERN</em></p>
  </dt>
  <dd>
    <p>A <a href="../man3/glob.3.html"><strong>glob</strong>(3)</a> pattern restricting the devices that this host will be backed up to.</p><ul>
<li><p>Note that only backup creation honors this restriction. Pruning and retiring do not.</p></li>
</ul>
  </dd>

</dl>
<p>In addition, the following directives can be used within a host stanza, and apply to just that host:</p><p><strong>prune-age</strong></p><p><strong>max-age</strong></p><p><strong>min-backups</strong></p><p><strong>pre-backup-hook</strong></p><p><strong>post-backup-hook</strong></p><p><strong>rsync-timeout</strong></p><p><strong>hook-timeout</strong></p><p>Remote hosts are accessed by SSH. The user <strong>rsbackup</strong> runs as must be able to connect to the remote host (and without a password being entered if it is to be run from a cron job or similar).</p>
<h3>Volume Directives</h3>
<p>A volume stanza is started by a volume directive. It contains one or more volume directives.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>volume </strong><em>VOLUME PATH</em></p>
  </dt>
  <dd>
    <p>Introduce a volume stanza. The name is used for the backup directory for this volume. The path is the absolute path on the host.</p>
  </dd>
  <dt>
    <p><strong>exclude </strong><em>PATTERN</em></p>
  </dt>
  <dd>
    <p>An exclusion for this volume. The pattern is passed to the rsync <strong>--exclude</strong> option. This directive may appear multiple times per volume.</p><ul>
<li><p>See the rsync man page for full details.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>traverse</strong></p>
  </dt>
  <dd>
    <p>Traverse mount points. This suppresses the rsync <strong>--one-file-system</strong> option.</p>
  </dd>
  <dt>
    <p><strong>check-file </strong><em>PATH</em></p>
  </dt>
  <dd>
    <p>Checks that <em>PATH</em> exists before backing up the volume. <em>PATH</em> may be either an absolute path or a relative path (to the root of the volume). It need not be inside the volume though the usual use would be to check for a file which is always present there.</p>
  </dd>

</dl>
<p>In addition, the following directives can be used within a volume stanza, and apply to just that volume:</p><p><strong>prune-age</strong></p><p><strong>max-age</strong></p><p><strong>min-backups</strong></p><p><strong>pre-backup-hook</strong></p><p><strong>post-backup-hook</strong></p><p><strong>rsync-timeout</strong></p><p><strong>hook-timeout</strong></p><p><strong>devices</strong></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOOKS</h2>
        <div class="sectioncontent">
<p>A hook is a command executed by <strong>rsbackup</strong> just before or just after some action. The command is passed directly to <a href="../man3/execvp.3.html"><strong>execvp</strong>(3)</a>; to use a shell command, therefore, either wrap it in a script or invoke the shell with the <strong>-c</strong> option.</p><h3>Access Hooks</h3>
<p>Access hooks are executed (once) before doing anything that will access backup devices (even just to read them).</p><p>The following environment variables are set when an access hook is executed:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>RSBACKUP_DEVICES</strong></p>
  </dt>
  <dd>
    <p>A space-separated list of known device names.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_HOOK</strong></p>
  </dt>
  <dd>
    <p>The name of the hook (i.e. <strong>pre-access-hook</strong>, etc). This allows a single hook script to serve as the implementation for multiple hooks.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_ACT</strong></p>
  </dt>
  <dd>
    <p>Set to <strong>false</strong> in <strong>--dry-run</strong> mode and <strong>true</strong> otherwise.</p>
  </dd>

</dl>
<p>Access hooks <em>are</em> executed in <strong>--dry-run</strong> mode.</p>
<h3>Backup Hooks</h3>
<p>Backup hooks are executed just before or just after a backup is made.</p><p>The following environment variables are set when a backup hook is executed:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>RSBACKUP_DEVICE</strong></p>
  </dt>
  <dd>
    <p>The target device name for the backup.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_HOOK</strong></p>
  </dt>
  <dd>
    <p>The name of the hook (i.e. <strong>pre-backup-hook</strong>, etc). This allows a single hook script to serve as the implementation for multiple hooks.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_HOST</strong></p>
  </dt>
  <dd>
    <p>The name of the host.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_SSH_HOSTNAME</strong></p>
  </dt>
  <dd>
    <p>The SSH hostname of the host.</p><ul>
<li><p>Recall that <strong>rsbackup</strong> treats the hostname <strong>localhost</strong> specially. If the hook also needs to do so then it must duplicate this logic.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>RSBACKUP_SSH_TARGET</strong></p>
  </dt>
  <dd>
    <p>The SSH hostname and username combined for passing to <strong>ssh</strong>(1).</p><ul>
<li><p>This will be <em>username</em><strong>@</strong><em>hostname</em> or just <em>hostname</em> depending on whether a SSH username was set.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>RSBACKUP_SSH_USERNAME</strong></p>
  </dt>
  <dd>
    <p>The SSH username of the host. If no SSH username was set, this variable will not be set.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_STATUS</strong></p>
  </dt>
  <dd>
    <p>(Only for <strong>post-backup-hook</strong>). Either <strong>ok</strong> or <strong>failed</strong>.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_STORE</strong></p>
  </dt>
  <dd>
    <p>The path to the store directory where the device is mounted.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_VOLUME</strong></p>
  </dt>
  <dd>
    <p>The name of the volume.</p>
  </dd>
  <dt>
    <p><strong>RSBACKUP_VOLUME_PATH</strong></p>
  </dt>
  <dd>
    <p>The path to the volume.</p>
  </dd>

</dl>
<p>The error output from backup hooks is written to the same logfile as the output from <strong>rsync</strong>.</p><p>Backup hooks are currently not executed in <strong>--dry-run</strong> mode but note that this will be changed in the future and an <strong>RSBACKUP_ACT</strong> variable introduced, as for access hooks.</p><p>See <a href="../man1/rsbackup-snapshot-hook.1.html"><strong>rsbackup-snapshot-hook</strong>(1)</a> for a hook program that can be used to back up from Linux LVM snapshots.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BACKUP LIFECYCLE</h2>
        <div class="sectioncontent">
<h3>Adding A New Host</h3>
<p>To add a new host create a <strong>host</strong> entry for it in the configuration file.</p><p>To back up the local host, specify <strong>hostname localhost</strong>. Otherwise you can usually omit <strong>hostname</strong>.</p><p>You may want to set host-wide values for <strong>prune-age</strong>, <strong>max-age</strong> and <strong>min-backups</strong>.</p><p>A host with no volumes has no effect.</p>
<h3>Adding A New Volume</h3>
<p>To add a new volume create a <strong>volume</strong> entry for it in the relevant <strong>host</strong> section of the configuration file.</p><p>Add <strong>exclude</strong> options to skip files you don't want to back up. This might include temporary files and the contents of "trash" directories.</p><p>If the volume contains mount points, and you want to back up the contents of the subsiduary filesystems, then be sure to include the <strong>traverse</strong> option.</p><p>You may want to set per-volume values for <strong>prune-age</strong>, <strong>max-age</strong> and <strong>min-backups</strong>.</p>
<h3>Adding A New Device</h3>
<p>To add a new device, format and mount it and create a <em>device-id</em> file in its top-level directory. Add a <strong>device</strong> entry for it in the configuration file and a <strong>store</strong> entry mentioning its usual mount point.</p><p>Under normal circumstances you should make sure that the backup filesystem is owned by root and mode 0700.</p>
<h3>Making Backups</h3>
<p>To backup up all available volumes to all available devices:</p>
<pre>
rsbackup --backup

</pre>
<p>You will probably want to automate this. To only back up a limited set of volumes specify selection arguments on the command line.</p>
<h3>Pruning Backups</h3>
<p>To prune old backups:</p>
<pre>
rsbackup --prune --prune-incomplete

</pre>
<p>You will probably want to automate this.</p><p>An "incomplete backup" occurs when a backup of a volume fails or is interrupted before completion. They are not immediately deleted because <strong>rsync</strong> may be able to use the files already transferred to save effort on subsequent backups on the same day, or (if there are no complete backups to use for this purpose) later days.</p>
<h3>Retiring A Host</h3>
<p>Retiring a host means removing all backups for it. The suggested approach is to remove configuration for it and then use <strong>rsbackup --retire </strong><em>HOST</em> to remove its backups too. You can do this the other way around but you will be prompted to check you really meant to remove backups for a host still listed in the configuration file.</p><p>If any of the backups for the host are on a retired device you should retire that device first.</p>
<h3>Retiring A Volume</h3>
<p>Retiring a volume means removing all backups for it. It is almost the same as retiring a whole host but the command is <strong>rsbackup --retire </strong><em>HOST</em><strong>:</strong><em>VOLUME</em>.</p><p>You can retire multiple hosts and volumes in a single command.</p>
<h3>Retiring A Device</h3>
<p>Retiring a device just means removing the logs for it. Use <strong>rsbackup --retire-device </strong><em>DEVICE</em> to do this. The contents of the device are not modified; if you want that you must do it manually.</p><p>You can retire multiple devices in a single command.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RESTORING</h2>
        <div class="sectioncontent">
<p>Restore costs extra l-)</p><h3>Manual Restore</h3>
<p>The backup has the same layout, permissions etc as the original system, so it's perfectly possible to simply copy files from a backup directory to their proper location.</p><p>Be careful to get file ownership right. The backup is stored with the same numeric user and group ID as the original system used.</p><p>Until a backup is completed, or while one is being pruned, a corresponding <strong>.incomplete</strong> file will exist. Check for such a file before restoring any given backup.</p>
<h3>Restoring With rsync</h3>
<p>Supposing that host <strong>chymax</strong> has a volume called <strong>users</strong> in which user home directories are backed up, and user <strong>rjk</strong> wants their entire home directory to be restored, an example restore command might be:</p>
<pre>
rsync -aSHz --numeric-ids /store/chymax/users/2010-04-01/rjk/. chymax:~rjk/.

</pre>
<p>You could add the <strong>--delete</strong> option if you wanted to restore to exactly the status quo ante, or at the opposite extreme <strong>--existing</strong> if you only wanted to restore files that had been deleted.</p><p>You might prefer to rsync back into a staging area and then pick files out manually.</p>
<h3>Restoring with tar</h3>
<p>You could tar up a backup directory (or a subset of it) and then untar it on the target. Remember to use the <strong>--numeric-owner</strong> option to tar.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">STORE VALIDITY</h2>
        <div class="sectioncontent">
<p>A store may be in the following states:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>available</strong>
  </dt>
  <dd>
    <p>The store can be used for a backup.</p>
  </dd>
  <dt>
    <strong>unavailable</strong>
  </dt>
  <dd>
    <p>The store cannot be used for a backup. Normally this does not generate an error but <strong>--warn-store</strong> can be used to report warnings for all unavailable stores, and if no store is available then the problems with the unavailable stores are described.</p>
  </dd>
  <dt>
    <strong>bad</strong>
  </dt>
  <dd>
    <p>The store cannot be used for a backup. This always generates an error message, but does not prevent backups to other stores taking place.</p>
  </dd>
  <dt>
    <strong>fatally broken</strong>
  </dt>
  <dd>
    <p>The store cannot be used for a backup. The program will be terminated.</p>
  </dd>

</dl>
<p>The states are recognized using the following tests (in this order):</p><ul>
<li><p>If the store path does not exist, the store is bad.</p></li><li><p>If the store does not have a <strong>device-id</strong> file then it is unavailable. If it has one but reading it raises an error then it is bad.</p></li><li><p>If the store's <strong>device-id</strong> file contains an unknown device name then it is bad.</p></li><li><p>If the store's <strong>device-id</strong> file names the same device as some other store then it is fatally broken.</p></li><li><p>If the store is not owned by <strong>root</strong> then it is bad. This check can be overridden with the <strong>public</strong> directive.</p></li><li><p>If the store can be read or written by group or world then it is bad. This check can be overridden with the <strong>public</strong> directive.</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><em>/etc/rsbackup/config</em></p>
  </dt>
  <dd>
    <p>Configuration file.</p>
  </dd>
  <dt>
    <p><em>LOGS/YYYY-MM-DD-DEVICE-HOST-VOLUME.log</em></p>
  </dt>
  <dd>
    <p>Log file for one attempt to back up a volume.</p>
  </dd>
  <dt>
    <p><em>LOGS/prune-YYYY-MM-DD.log</em></p>
  </dt>
  <dd>
    <p>Log of recently pruning actions.</p>
  </dd>
  <dt>
    <p><em>STORE/HOST/VOLUME/YYYY-MM-DD</em></p>
  </dt>
  <dd>
    <p>One backup for a volume.</p>
  </dd>
  <dt>
    <p><em>STORE/HOST/VOLUME/YYYY-MM-DD.incomplete</em></p>
  </dt>
  <dd>
    <p>Flag file for an incomplete backup.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO rsbackup&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/rsbackup.cron.1.html"><strong>rsbackup.cron</strong>(1)</a>, <a href="../man1/rsbackup-mount.1.html"><strong>rsbackup-mount</strong>(1)</a>, <a href="../man1/rsbackup-snapshot-hook.1.html"><strong>rsbackup-snapshot-hook</strong>(1)</a>, <a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Richard Kettlewell &lt;rjk@greenend.org.uk&gt;</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="rsakeyfind.1.html"><span aria-hidden="true">&larr;</span> rsakeyfind.1: Locates ber-encoded rsa private keys in memory images.</a></li>
   <li class="next"><a href="rsbackup-mount.1.html">rsbackup-mount.1: Mount encrypted or unencrypted disks used by rsbackup <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
