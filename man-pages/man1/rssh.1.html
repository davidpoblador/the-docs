<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>rssh: Restricted secure shell allowing only scp and/or sftp</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Restricted secure shell allowing only scp and/or sftp">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="rssh (1) manual">
  <meta name="twitter:description" content="Restricted secure shell allowing only scp and/or sftp">
  <meta name="twitter:image" content="https://www.carta.tech/images/rssh-rssh-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/rssh.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="rssh (1) manual" />
  <meta property="og:description" content="Restricted secure shell allowing only scp and/or sftp" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/rssh-rssh-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">rssh<small> (1)</small></h1>
        <p class="lead">Restricted secure shell allowing only scp and/or sftp</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rssh.1.html">
      <span itemprop="name">rssh: Restricted secure shell allowing only scp and/or sftp</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/rssh/">
      <span itemprop="name">rssh</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/rssh.1.html">
      <span itemprop="name">rssh: Restricted secure shell allowing only scp and/or sftp</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>rssh</strong> [<em> options... </em>]<em> </em>[<em> ... </em>]</p><p><strong>rssh -v</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>rssh</strong> is a restricted shell for providing limited access to a host via <strong>ssh</strong>(1), allowing a user whose shell is configured to <strong>rssh</strong> to use one or more of the command(s) <strong>scp</strong>(1), <strong>sftp</strong>(1) <a href="../man1/cvs.1.html"><strong>cvs</strong>(1)</a>, <a href="../man1/rdist.1.html"><strong>rdist</strong>(1)</a>, and <a href="../man1/rsync.1.html"><strong>rsync</strong>(1)</a>, and <em>only</em> those commands.  It is intended primarily to work with OpenSSH (see http://www.openssh.com), but may work with other implementations.</p><p>The system administrator should install the shell on the restricted system. Then the password file entry of any user for whom it is desireable to provide restricted access should be edited, such that their shell is <strong>rssh</strong>. For example:</p><p>luser:x:666:666::/home/luser:/usr/bin/rssh</p><p>If invoked with the <strong>-v</strong> option, <strong>rssh</strong> will report its version, and exit.  All other arguments to <strong>rssh</strong> are those specified by the remote <strong>ssh</strong>(1) client, and aren't of much concern to the average user.  The arguments provided must be what a shell on the remote end would receive in order to pass control to <strong>scp</strong>(1), <strong>sftp</strong>(1), etc.  If <strong>rssh</strong> receives arguments which do not conform, it will emit an error message and exit. If the program the user is trying to run is not allowed, or contains syntax which will try to execute a shell command (such as a command substitution), it will also emit an error and exit.</p><p><strong>rssh</strong> has a configuration file, <a href="../man5/rssh.conf.5.html"><strong>rssh.conf</strong>(5)</a>, which allows some of the behavior of <strong>rssh</strong> to be customized.  See that man page for details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SECURITY NOTES</h2>
        <div class="sectioncontent">
<p><em>Read this section with exceptional care, or you may put your system at risk!</em></p><h3>Using rssh With CVS</h3>
<p>If you are using <strong>rssh</strong> to allow CVS access, it should be noted that it is not possible to prevent a user who is very familiar with CVS from bypassing <strong>rssh</strong> and getting a shell, unless the user does not have write access in the repository.  Obviously, the user must have write access to the repository in order to update it, which allows them to upload arbitrary programs into the repository.  CVS provides several mechanisms for executing such arbitrary programs...  The only reasonably safe way to use <strong>rssh</strong> with CVS is to use the chroot jail facilities to place the CVS repository within a chroot jail. Please see below and all relevant documentation for details of how to set up chroot jails.  Note that <em>users will still be able to get shell access</em> within the jail; the only protection which is provided is that they can not escape the jail.  I have been pursuaded to retain support for CVS because this protection is better than no protection. <em>You have been warned. Use CVS at your own risk.</em></p>
<h3>Potential root Compromise With Old Versions</h3>
<p>Before <strong>rssh 2.3.0</strong>, if a regular user had shell access to a machine where <strong>rssh</strong> was installed, a root compromise was possible due to <strong>rssh_chroot_helper</strong> allowing a user to arbitrarily <a href="../man2/chroot.2.html"><strong>chroot</strong>(2)</a> to anywhere on the filesystem. It is possible to mitigate this attack against affected versions of <strong>rssh</strong> using strict access controls to files, by making sure that the user can not write to any file on the same partition as system executables, and that any partition where they can write files does not allow execution of SUID programs.  As of <strong>rssh 2.3.0</strong>, this attack has been prevented by preventing arbitrary chroot(), <em>if your jail is set up securely</em>.  In particular, make sure that regular users can not write to directories inside the jail which contain the copied binaries.  That should be obvious, but it needs to be said.  Though it should not be strictly necessary, to further protect your system from possible compromise, it is also advisable to follow the section below, entitled "Safeguards Against Bypassing rssh".</p>
<h3>Safeguards Against Bypassing rssh</h3>
<p><strong>rssh</strong> is designed to interact with several other programs.  Even if rssh is completely bug-free, changes in those other programs could possibly result in methods to circumvent the protection that <strong>rssh</strong> is intended to provide.  <em>It is important for you, the system administrator,</em> to stay current on the services you make available with rssh, to be sure that these commands do not provide mechanisms to allow the user to run arbitrary commands. Also, while the goal of every release is to be bug free, no one is perfect...  There may be undiscovered bugs in <strong>rssh</strong> which might allow a user to circumvent it.</p><p>You can protect your system from those who would take advantage of such weaknesses.  This is not required for <strong>rssh</strong> to work properly, but it is a really good idea.  There are six basic steps:</p>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p>protect all non-administrator accounts with rssh (i.e. no regular user should have shell access to the server)</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p>place your users in a chroot jail</p>
  </dd>
  <dt>
    <p>3.</p>
  </dt>
  <dd>
    <p>limit the binaries which live in the jail to the absolute minimum required</p>
  </dd>
  <dt>
    <p>4.</p>
  </dt>
  <dd>
    <p>mount their home filesystem with the noexec/nosuid option (i.e. use separate partitions in the jail for user home directories and all other files, if possible/reasonable)</p>
  </dd>
  <dt>
    <p>5.</p>
  </dt>
  <dd>
    <p>create a group for rssh users, and limit executable access to the binaries to users in that group.</p>
  </dd>
  <dt>
    <p>6.</p>
  </dt>
  <dd>
    <p>use standard file permissions carefully and appropriately</p>
  </dd>

</dl>
<p>If possible, make sure that no regular user has any kind of shell access to the system other than through <strong>rssh</strong>.  Otherwise, users with shell access could potentially exploit undiscovered bugs in <strong>rssh_chroot_helper</strong> to gain root access to the server.</p><p><strong>rssh</strong> gives the system administrator the ability to place the users in a chroot jail.  See details in the man page for <strong>rssh.conf</strong> and in the file <em>CHROOT</em> which is distributed with the source code.  If you want to ensure users can not run arbitrary programs, use a chroot jail, and be sure not to put any programs other than what are absolutely necessary to provide the service you are trying to provide.  This prevents them from running standard system commands.</p><p>Then, make sure the user's files inside the jail are on a separate filesystem from your system's executables.  If possible in your environment, make sure you mount this filesystem using the <em>noexec</em> and <em>nosuid</em> options, if your operating system provides them.  This prevents the users from being able to execute programs which they have uploaded to the target machine (e.g. using scp) which might otherwise be executable, and prevents SUID programs from respecting the SUID bits.  Note that these options necessitate the users' files are on separate partitions from the binaries and libraries that live in the jail.  Therefore you will need at least 2 partitions for your jail to do this properly (one for the system binaries in the jail, the other for the user directories).</p><p>Additionally, create a group, for example "rsshuser", for rssh users.  Put all your users who will be restricted by rssh in that group.  Set the ownership and permissions on rssh and rssh_chroot_helper so that only those users can execute them.  The following commands should illustrate:</p><p><strong># groupadd rsshuser</strong></p><p><strong># chown root:rsshuser rssh rssh_chroot_helper</strong></p><p><strong># chmod 550 rssh</strong></p><p><strong># chmod 4550 rssh_chroot_helper</strong></p><p>Lastly, use standard Unix/POSIX file permissions to ensure they can not access files they should not be able to within the chroot jail.</p>
<h3>Command Line Parser</h3>
<p>As of <strong>rssh</strong> version 2.2.3, the program must parse out the complete command line to avoid command line options which cause the execution of arbitrary programs (and hence bypass the security of <strong>rssh</strong>).  In order to keep the program source code sane, the parser is a little over-zealous about matching command line options.  In practice, this probably will not be an issue, but in theory it is possible.</p><p>If you run into a problem where <strong>rssh</strong> refuses to run, claiming to be rejecting insecure command line options which were not specified, try changing your command line such that all <em>short</em> options are specified as single-letter option flags (e.g. -e -p instead of -ep) and make sure you separate arguments from their respective options by a space (e.g. -p 123 instead of -p123).  In virtually all cases, this should solve the problem.  Admittedly, an exhaustive search was not performed, but no problematical cases were found which were likely to be common.</p><p>The alternative would have been to include a complete command-line parser for rcp, rdist, and rsync; this was way out of the scope of this project.  In practice, the existing parser should suffice.  If, however, you find cases where it does not, please post details to the rssh mailing list.  Details about how to post to the mailing list can be found at the rssh homepage.</p>
<h3>OpenSSH Versions and Bypassing rssh</h3>
<p>Prior to OpenSSH 3.5, <strong>sshd</strong>(8) will generally attempt to parse files in the user's home directory, and may also try to run a start-up script from the user's <em>$HOME/.ssh</em> directory. <strong>rssh</strong> does not make use of the user's environment in any way.  The relevant command is executed by calling <a href="../man3/execv.3.html"><strong>execv</strong>(3)</a> with the full path to the command, as specified at compile time.  It does not depend upon the user's PATH variable, or on any other environment variable.</p><p>There are, however, several problems that can arise.  This is due entirely to the way the OpenSSH Project's sshd works, and is in no way the fault of <strong>rssh</strong>.  For example, one problem which might exist is that, according to the <strong>sshd</strong>(8) man page from at least some releases of OpenSSH, the commands listed in the <em>$HOME/.ssh/rc</em> file are executed with <em>/bin/sh</em> instead of the user's defined shell.  This appears not to be the case on the systems the author had available to test on; commands were executed using the user's configured shell (<strong>rssh</strong>), which did not allow the execution. However if it is true on your system, then a malicious user may be able to circumvent <strong>rssh</strong> by uploading a file to <em>$HOME/.ssh/rc</em> which will be executed by <em>/bin/sh</em> on that system.  If any releases (of OpenSSH) are, in fact, vulnerable to this problem, then it is very likely that they are only old, outdated versions.  So long as you are running a recent version of OpenSSH, this should not be a problem as far as I can tell.</p><p>If your sshd <em>is</em> vulnerable to this attack, there is a workaround for this problem, though it is pretty restrictive. <em>The user's home directory absolutely must not be writable by the user.</em> If it is, the user can use sftp to remove the directory or rename it, and then create a new one, and fill it up with whatever environment files they like.  For providing file uploads, this means a user-writable directory must be created for them, and they must be made aware of their inability to write into their home directory other than in this location.</p><p>A second problem is that after authenticating the user, sshd also reads <em>$HOME/.ssh/environment</em> to allow the user to set variables in their environment.  This allows the user to completely circumvent <strong>rssh</strong> by clever manipulation of such environment variables as <em>LD_LIBRARY_PATH</em> or <em>LD_PRELOAD</em> to link the rssh binary against arbitrary shared libraries.  In order to prevent this from being a problem, as of version 0.9.3, by default <strong>rssh</strong> is now compiled statically.  The restrictive work-around mentioned above will also defeat this sort of attack.</p><p>As of OpenSSH 3.5, <em>sshd</em> now supports the option <em>PermitUserEnvironment</em> which is set to "no" by default.  This option allows restricted shells like <strong>rssh</strong> to function properly without requiring them to be linked statically.  As of <strong>rssh</strong> version 1.0.1, the configure script should detect that OpenSSH 3.5 is present, and disable the default of static compilation.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>None.  =8^)</p><h3>A Note About Getting Help</h3>
<p>If you are having trouble getting <strong>rssh</strong> working, or you think you've found a bug, please use the mailing list, and <em>do not e-mail me</em> <em>directly</em>. You must sign up for the list in order to post.  Information about how to sign up is available on the rssh homepage.  If you mail me directly with questions, I will almost certainly ignore you, or at the very least ask you to repost your question on the mailing list.  Please also feel free to provide feedback about rssh on the mailing list, whether positive or negative (especially negative).</p>
<h3>Security Problems</h3>
<p>The only exception to the above is if you believe you have found a security problem with <strong>rssh</strong>.  If that is the case, then please <em>do</em> contact me privately.  If you are unable to find my direct contact info, post a message on the mailing list requesting that I contact you about a potential security problem.  Security problems should be dealt with privately, so that the threat can be properly assessed, and so as not to needlessly endanger the installations of <strong>rssh</strong> in production environments.  I take security problems seriously, and will work to resolve them as quickly as possible.</p>
<h3>N.B.:</h3>
<p>Before you e-mail me (or the mailing list) with questions, be sure to <em>THOROUGHLY</em> read all of the following files: README, INSTALL, CHROOT, SECURITY.  All of these files are distributed with the rssh source code, as well as all binary packages of <strong>rssh</strong>.  If you downloaded a binary package, these files should be located wherever your distribution keeps its documentation files (usually /usr/share/doc/rssh-version/ or something similar).  Also <em>THOROUGHLY</em> read the man pages for <a href="../man1/rssh.1.html"><strong>rssh</strong>(1)</a>, and <a href="../man5/rssh.conf.5.html"><strong>rssh.conf</strong>(5)</a>.  Finally, if you are still having problems, read the FAQ at http://www.pizzashack.org/rssh/faq.shtml.  If it is clear to me that you have not read these documents, I will ignore you.  In most cases, these documents will already have everything you need to get rssh working, and I won't be able to explain it any better on a mailing list than I did in those documents...</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO rssh&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/rssh.conf.5.html"><strong>rssh.conf</strong>(5)</a>, <strong>sshd</strong>(8), <strong>ssh</strong>(1), <strong>scp</strong>(1), <strong>sftp</strong>(1).</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="rsrce.1.html"><span aria-hidden="true">&larr;</span> rsrce.1: Editor for raw macos resource forks</a></li>
   <li class="next"><a href="rsstail.1.html">rsstail.1: A console based rss news reader <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
