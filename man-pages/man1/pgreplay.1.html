<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pgreplay: Postgresql log file replayer for performance tests</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Postgresql log file replayer for performance tests">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pgreplay (1) manual">
  <meta name="twitter:description" content="Postgresql log file replayer for performance tests">
  <meta name="twitter:image" content="https://www.carta.tech/images/pgreplay-pgreplay-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pgreplay.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pgreplay (1) manual" />
  <meta property="og:description" content="Postgresql log file replayer for performance tests" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pgreplay-pgreplay-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pgreplay<small> (1)</small></h1>
        <p class="lead">Postgresql log file replayer for performance tests</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pgreplay.1.html">
      <span itemprop="name">pgreplay: Postgresql log file replayer for performance tests</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pgreplay/">
      <span itemprop="name">pgreplay</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pgreplay.1.html">
      <span itemprop="name">pgreplay: Postgresql log file replayer for performance tests</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>pgreplay</strong> [<em>parse options</em>] [<em>replay options</em>] [<strong>-d</strong> <em>level</em>] [<em>infile</em>]</p><p><strong>pgreplay</strong> <strong>-f</strong> [<em>parse options</em>] [<strong>-o</strong> <em>outfile</em>] [<strong>-d</strong> <em>level</em>] [<em>infile</em>]</p><p><strong>pgreplay</strong> <strong>-r</strong> [<em>replay options</em>] [<strong>-d</strong> <em>level</em>] [<em>infile</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>pgreplay</strong> reads a PostgreSQL log file (<em>not</em> a WAL file), extracts the SQL statements and executes them in the same order and relative time against a PostgreSQL database cluster. A final report gives you a useful statistical analysis of your workload and its execution.</p><p>In the first form, the log file <em>infile</em> is replayed at the time it is read.</p><p>With the <strong>-f</strong> option, <strong>pgreplay</strong> will not execute the statements, but write them to a \(oqreplay file\(cq <em>outfile</em> that can be replayed with the third form.</p><p>With the <strong>-r</strong> option, <strong>pgreplay</strong> will execute the statements in the replay file <em>infile</em> that was created by the second form.</p><p>If the execution of statements gets behind schedule, warning messages are issued that indicate that the server cannot handle the load in a timely fashion. The idea is to replay a real-world database workload as exactly as possible.</p><p>To create a log file that can be parsed by <strong>pgreplay</strong>, you need to set the following parameters in <strong>postgresql.conf</strong>:</p><ul>
<li><p><strong>log_min_messages=error</strong> (or more)</p><p><strong>log_min_error_statement=log</strong> (or more)</p><p><strong>log_connections=on</strong></p><p><strong>log_disconnections=on</strong></p><p><strong>log_line_prefix=&apos;%m|%u|%d|%c|&apos;</strong> (if you don&apos;t use CSV logging)</p><p><strong>log_statement=&apos;all&apos;</strong></p><p><strong>lc_messages</strong> must be set to English (encoding does not matter)</p><p><strong>bytea_output=escape</strong> (from version 9.0 on, only if you want to replay the log on 8.4 or earlier)</p></li>
</ul><p>The database cluster against which you replay the SQL statements must be a clone of the database cluster that generated the logs from the time <em>immediately before</em> the logs were generated.</p><p><strong>pgreplay</strong> is useful for performance tests, particularly in the following situations:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>You want to compare the performance of your PostgreSQL application on different hardware or different operating systems.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>You want to upgrade your database and want to make sure that the new database version does not suffer from performance regressions that affect you.</p>
  </dd>

</dl>
<p>Moreover, <strong>pgreplay</strong> can give you some feeling as to how your application <em>might</em> scale by allowing you to try to replay the workload at a higher speed.  Be warned, though, that 500 users working at double speed is not really the same as 1000 users working at normal speed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>Parse options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-c</strong></p>
  </dt>
  <dd>
    <p>Specifies that the log file is in &apos;csvlog&apos; format (highly recommended) and not in &apos;stderr&apos; format.</p>
  </dd>
  <dt>
    <p><strong>-b</strong> <em>timestamp</em></p>
  </dt>
  <dd>
    <p>Only log entries greater or equal to that timestamp will be parsed. The format is <strong>YYYY-MM-DD HH:MM:SS.FFF</strong> like in the log file. An optional time zone part will be ignored.</p>
  </dd>
  <dt>
    <p><strong>-e</strong> <em>timestamp</em></p>
  </dt>
  <dd>
    <p>Only log entries less or equal to that timestamp will be parsed. The format is <strong>YYYY-MM-DD HH:MM:SS.FFF</strong> like in the log file. An optional time zone part will be ignored.</p>
  </dd>
  <dt>
    <p><strong>-q</strong></p>
  </dt>
  <dd>
    <p>Specifies that a backslash in a simple string literal will escape the following single quote. This depends on configuration options like <strong>standard_conforming_strings</strong> and is the default for server version 9.0 and less.</p>
  </dd>

</dl>

<h3>Replay options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-h</strong> <em>hostname</em></p>
  </dt>
  <dd>
    <p>Host name where the target database cluster is running (or directory where the UNIX socket can be found). Defaults to local connections.</p><p>This works just like the <strong>-h</strong> option of <strong>psql</strong>.</p>
  </dd>
  <dt>
    <p><strong>-p</strong> <em>port</em></p>
  </dt>
  <dd>
    <p>TCP port where the target database cluster can be reached.</p>
  </dd>
  <dt>
    <p><strong>-W</strong> <em>password</em></p>
  </dt>
  <dd>
    <p>By default, <strong>pgreplay</strong> assumes that the target database cluster is configured for <em>trust</em> authentication. With the <strong>-W</strong> option you can specify a password that will be used for all users in the cluster.</p>
  </dd>
  <dt>
    <p><strong>-s</strong> <em>factor</em></p>
  </dt>
  <dd>
    <p>Speed factor for replay, by default 1. This can be any valid positive floating point number. A <em>factor</em> less than 1 will replay the workload in \(oqslow motion\(cq, while a <em>factor</em> greater than 1 means \(oqfast forward\(cq.</p>
  </dd>
  <dt>
    <p><strong>-E</strong> <em>encoding</em></p>
  </dt>
  <dd>
    <p>Specifies the encoding of the log file, which will be used as client encoding during replay. If it is omitted, your default client encoding will be used.</p>
  </dd>
  <dt>
    <p><strong>-j</strong></p>
  </dt>
  <dd>
    <p>If all connections are idle, jump ahead to the next request instead of sleeping. This will speed up replay. Execution delays will still be reported correctly, but replay statistics will not contain the idle time.</p>
  </dd>

</dl>

<h3>Output options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-o</strong> <em>outfile</em></p>
  </dt>
  <dd>
    <p>specifies the replay file where the statements will be written for later replay.</p>
  </dd>

</dl>

<h3>Debug options:</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-d</strong> <em>level</em></p>
  </dt>
  <dd>
    <p>Specifies the trace level (between 1 and 3). Increasing levels will produce more detailed information about what <strong>pgreplay</strong> is doing.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Prints the program version and exits.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>PGHOST</strong></p>
  </dt>
  <dd>
    <p>Specifies the default value for the <strong>-h</strong> option.</p>
  </dd>
  <dt>
    <p><strong>PGPORT</strong></p>
  </dt>
  <dd>
    <p>Specifies the default value for the <strong>-p</strong> option.</p>
  </dd>
  <dt>
    <p><strong>PGCLIENTENCODING</strong></p>
  </dt>
  <dd>
    <p>Specifies the default value for the <strong>-E</strong> option.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p><strong>pgreplay</strong> can only replay what is logged by PostgreSQL. This leads to some limitations:</p>
<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><strong>COPY</strong> statements will not be replayed, because the copy data are not logged.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>Fast-path API function calls are not logged and will not be replayed. Unfortunately, this includes the Large Object API.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>Since the log file is always in the server encoding (which you can specify with the <strong>-E</strong> switch of <strong>pgreplay</strong>), all <strong>SET client_encoding</strong> statements will be ignored.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>Since the preparation time of prepared statements is not logged (unless <strong>log_min_messages</strong> is <strong>debug2</strong> or more), these statements will be prepared immediately before they are first executed during replay.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>Because the log file contains only text, query parameters and return values will always be in text and never in binary format. If you use binary mode to, say, transfer large binary data, <strong>pgreplay</strong> can cause significantly more network traffic than the original run.</p>
  </dd>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p>Sometimes, if a connection takes longer to complete, the session ID unexpectedly changes in the PostgreSQL log file. This causes <strong>pgreplay</strong> to treat the session as two different ones, resulting in an additional connection. This is arguably a bug in PostgreSQL.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Written by Laurenz Albe <strong>&lt;laurenz.albe@wien.gv.at&gt;</strong>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pgrep.1.html"><span aria-hidden="true">&larr;</span> pgrep.1: Look up or signal processes based on name and other attributes</a></li>
   <li class="next"><a href="pgsnap.1.html">pgsnap.1: Postgresql report tool <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
