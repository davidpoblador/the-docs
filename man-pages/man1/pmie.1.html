<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pmie: Inference engine for performance metrics</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Inference engine for performance metrics">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pmie (1) manual">
  <meta name="twitter:description" content="Inference engine for performance metrics">
  <meta name="twitter:image" content="https://www.carta.tech/images/pcp-pmie-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/pmie.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pmie (1) manual" />
  <meta property="og:description" content="Inference engine for performance metrics" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pcp-pmie-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pmie<small> (1)</small></h1>
        <p class="lead">Inference engine for performance metrics</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmie.1.html">
      <span itemprop="name">pmie: Inference engine for performance metrics</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pcp/">
      <span itemprop="name">pcp</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/pmie.1.html">
      <span itemprop="name">pmie: Inference engine for performance metrics</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>pmie</strong> [<strong>-bCdefHVvWxz</strong>] [<strong>-A</strong> <em>align</em>] [<strong>-a</strong> <em>archive</em>] [<strong>-c</strong> <em>filename</em>] [<strong>-h</strong> <em>host</em>] [<strong>-l</strong> <em>logfile</em>] [<strong>-j</strong> <em>stompfile</em>] [<strong>-n</strong> <em>pmnsfile</em>] [<strong>-O</strong> <em>offset</em>] [<strong>-S</strong> <em>starttime</em>] [<strong>-T</strong> <em>endtime</em>] [<strong>-t</strong> <em>interval</em>] [<strong>-U</strong> <em>username</em>] [<strong>-Z</strong> <em>timezone</em>] [<em>filename ...</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>pmie</strong> accepts a collection of arithmetic, logical, and rule expressions to be evaluated at specified frequencies.  The base data for the expressions consists of performance metrics values delivered in real-time from any host running the Performance Metrics Collection Daemon (PMCD), or using historical data from Performance Co-Pilot (PCP) archive logs.</p><p>As well as computing arithmetic and logical values, <strong>pmie</strong> can execute actions (popup alarms, write system log messages, and launch programs) in response to specified conditions.  Such actions are extremely useful in detecting, monitoring and correcting performance related problems.</p><p>The expressions to be evaluated are read from configuration files specified by one or more <em>filename</em> arguments.  In the absence of any <em>filename</em>, expressions are read from standard input.</p><p>A description of the command line options specific to <strong>pmie</strong> follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-a</strong></p>
  </dt>
  <dd>
    <p><em>archive</em> is the base name of a PCP archive log written by <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>. Multiple instances of the <strong>-a</strong> flag may appear on the command line to specify a set of archives. In this case, it is required that only one archive be present for any one host. Also, any explicit host names occurring in a <strong>pmie</strong> expression must match the host name recorded in one of the archive labels. In the case of multiple archives, timestamps recorded in the archives are used to ensure temporal consistency.</p>
  </dd>
  <dt>
    <p><strong>-b</strong></p>
  </dt>
  <dd>
    <p>Output will be line buffered and standard output is attached to standard error.  This is most useful for background execution in conjunction with the <strong>-l</strong> option. The <strong>-b</strong> option is always used for <strong>pmie</strong> instances launched from <a href="../man1/pmie_check.1.html"><strong>pmie_check</strong>(1)</a>.</p>
  </dd>
  <dt>
    <p><strong>-C</strong></p>
  </dt>
  <dd>
    <p>Parse the configuration file(s) and exit before performing any evaluations. Any errors in the configuration file are reported.</p>
  </dd>
  <dt>
    <p><strong>-c</strong></p>
  </dt>
  <dd>
    <p>An alternative to specifying <em>filename</em> at the end of the command line.</p>
  </dd>
  <dt>
    <p><strong>-d</strong></p>
  </dt>
  <dd>
    <p>Normally <strong>pmie</strong> would be launched as a non-interactive process to monitor and manage the performance of one or more hosts. Given the <strong>-d</strong> flag however, execution is interactive and the user is presented with a menu of options. Interactive mode is useful mainly for debugging new expressions.</p>
  </dd>
  <dt>
    <p><strong>-e</strong></p>
  </dt>
  <dd>
    <p>When used with <strong>-V</strong>, <strong>-v</strong> or <strong>-W</strong>, this option forces timestamps to be reported with each expression.  The timestamps are in <a href="../man3/ctime.3.html"><strong>ctime</strong>(3)</a> format, enclosed in parenthesis and appear after the expression name and before the expression value, e.g.</p>
<pre>
	expr_1 (Tue Feb  6 19:55:10 2001): 12
</pre>

  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>If the <strong>-l</strong> option is specified and there is no <strong>-a</strong> option (ie. real-time monitoring) then <strong>pmie</strong> is run as a daemon in the background (in all other cases foreground is the default). The <strong>-f</strong> option forces <strong>pmie</strong> to be run in the foreground, independent of any other options.</p>
  </dd>
  <dt>
    <p><strong>-H</strong></p>
  </dt>
  <dd>
    <p>The default hostname written to the stats file will not be looked up via <a href="../man3/gethostbyname.3.html"><strong>gethostbyname</strong>(3)</a>, rather it will be written as-is. This option can be useful when host name aliases are in use at a site, and the logical name is more important than the physical host name.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>By default performance data is fetched from the local host (in real-time mode) or the host for the first named archive on the command line (in archive mode).  The <em>host</em> argument overrides this default. It does not override hosts explicitly named in the expressions being evaluated.</p>
  </dd>
  <dt>
    <p><strong>-l</strong></p>
  </dt>
  <dd>
    <p>Standard error is sent to <em>logfile</em>.</p>
  </dd>
  <dt>
    <p><strong>-j</strong></p>
  </dt>
  <dd>
    <p>An alternative STOMP protocol configuration is loaded from <em>stompfile</em>. If this option is not used, and the <em>stomp</em> action is used in any rule, the default location <em>$PCP_SYSCONF_DIR/pmie/config/stomp</em> will be used.</p>
  </dd>
  <dt>
    <p><strong>-n</strong></p>
  </dt>
  <dd>
    <p>An alternative Performance Metrics Name Space (PMNS) is loaded from the file <em>pmnsfile</em>.</p>
  </dd>
  <dt>
    <p><strong>-t</strong></p>
  </dt>
  <dd>
    <p>The <em>interval</em> argument follows the syntax described in <a href="../man1/PCPIntro.1.html"><strong>PCPIntro</strong>(1)</a>, and in the simplest form may be an unsigned integer (the implied units in this case are seconds). The value is used to determine the sample interval for expressions that do not explicitly set their sample interval using the <strong>pmie</strong> variable delta described below. The default is 10.0 seconds.</p>
  </dd>
  <dt>
    <p><strong>-U</strong> <em>username</em></p>
  </dt>
  <dd>
    <p>User account under which to run <strong>pmie</strong>. The default is the current user account for interactive use. When run as a daemon, the unprivileged "pcp" account is used in current versions of PCP, but in older versions the superuser account ("root") was used by default.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Unless one of the verbose options <strong>-V</strong>, <strong>-v</strong> or <strong>-W</strong> appears on the command line, expressions are evaluated silently, the only output is as a result of any actions being executed.  In the verbose mode, specified using the <strong>-v</strong> flag, the value of each expression is printed as it is evaluated. The values are in canonical units; bytes in the dimension of ``space'', seconds in the dimension of ``time'' and events in the dimension of ``count''. See <a href="../man3/pmLookupDesc.3.html"><strong>pmLookupDesc</strong>(3)</a> for details of the supported dimension and scaling mechanisms for performance metrics. The verbose mode is useful in monitoring the value of given expressions, evaluating derived performance metrics, passing these values on to other tools for further processing and in debugging new expressions.</p>
  </dd>
  <dt>
    <p><strong>-V</strong></p>
  </dt>
  <dd>
    <p>This option has the same effect as the <strong>-v</strong> option, except that the name of the host and instance (if applicable) are printed as well as expression values.</p>
  </dd>
  <dt>
    <p><strong>-W</strong></p>
  </dt>
  <dd>
    <p>This option has the same effect as the <strong>-V</strong> option described above, except that for boolean expressions, only those names and values that make the expression true are printed. These are the same names and values accessible to rule actions as the %h, %i and %v bindings, as described below.</p>
  </dd>
  <dt>
    <p><strong>-x</strong></p>
  </dt>
  <dd>
    <p>Execute in domain agent mode.  This mode is used within the Performance Co-Pilot product to derive values for summary metrics, see <a href="../man1/pmdasummary.1.html"><strong>pmdasummary</strong>(1)</a>. Only restricted functionality is available in this mode (expressions with actions may <strong>not</strong> be used).</p>
  </dd>
  <dt>
    <p><strong>-Z</strong></p>
  </dt>
  <dd>
    <p>Change the reporting timezone to <em>timezone</em> in the format of the environment variable <strong>TZ</strong> as described in <strong>environ</strong>(5).</p>
  </dd>
  <dt>
    <p><strong>-z</strong></p>
  </dt>
  <dd>
    <p>Change the reporting timezone to the timezone of the host that is the source of the performance metrics, as identified via either the <strong>-h</strong> option or the first named archive (as described above for the <strong>-a</strong> option).</p>
  </dd>

</dl>
<p>The <strong>-S</strong>, <strong>-T</strong>, <strong>-O</strong>, and <strong>-A</strong> options may be used to define a time window to restrict the samples retrieved, set an initial origin within the time window, or specify a ``natural'' alignment of the sample times; refer to <a href="../man1/PCPIntro.1.html"><strong>PCPIntro</strong>(1)</a> for a complete description of these options.</p><p>Output from <strong>pmie</strong> is directed to standard output and standard error as follows:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>stdout</strong></p>
  </dt>
  <dd>
    <p>Expression values printed in the verbose <strong>-v</strong> mode and the output of <strong>print</strong> actions.</p>
  </dd>
  <dt>
    <p><strong>stderr</strong></p>
  </dt>
  <dd>
    <p>Error and warning messages for any syntactic or semantic problems during expression parsing, and any semantic or performance metrics availability problems during expression evaluation.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The following example expressions demonstrate some of the capabilities of the inference engine.</p><p>The directory <em>$PCP_DEMOS_DIR/pmie</em> contains a number of other annotated examples of <strong>pmie</strong> expressions.</p><p>The variable delta controls expression evaluation frequency.  Specify that subsequent expressions be evaluated once a second, until further notice:</p>
<pre>
delta = 1 sec;
</pre>
<p>If the total context switch rate exceeds 10000 per second per CPU, then display an alarm notifier:</p>
<pre>
kernel.all.pswitch / hinv.ncpu &gt; 10000 count/sec
-&gt; alarm "high context switch rate %v";
</pre>
<p>If the high context switch rate is sustained for 10 consecutive samples, then launch <strong>top</strong>(1) in an <strong>xwsh</strong>(1G) window to monitor processes, but do this at most once every 5 minutes:</p>
<pre>
all_sample (
    kernel.all.pswitch @0..9 &gt; 10 Kcount/sec * hinv.ncpu
) -&gt; shell 5 min "xwsh -e 'top'";
</pre>
<p>The following rules are evaluated once every 20 seconds:</p>
<pre>
delta = 20 sec;
</pre>
<p>If any disk is performing more than 60 I/Os per second, then print a message identifying the busy disk to standard output and launch <strong>dkvis</strong>(1):</p>
<pre>
some_inst (
    disk.dev.total &gt; 60 count/sec
) -&gt; print "busy disks:" " %i" &
     shell 5 min "dkvis";
</pre>
<p>Refine the preceding rule to apply only between the hours of 9am and 5pm, and to require 3 of 4 consecutive samples to exceed the threshold before executing the action:</p>
<pre>
$hour &gt;= 9 && $hour &lt;= 17 &&
some_inst (
  75 %_sample (
    disk.dev.total @0..3 &gt; 60 count/sec
  )
) -&gt; print "disks busy for 20 sec:" " [%h]%i";
</pre>
<p>The following two rules are evaluated once every 10 minutes:</p>
<pre>
delta = 10 min;
</pre>
<p>If either the / or the /usr filesystem is more than 95% full, display an alarm popup, but not if it has already been displayed during the last 4 hours:</p>
<pre>
filesys.free #'/dev/root' /
    filesys.capacity #'/dev/root' &lt; 0.05
-&gt; alarm 4 hour "root filesystem (almost) full";

filesys.free #'/dev/usr' /
    filesys.capacity #'/dev/usr' &lt; 0.05
-&gt; alarm 4 hour "/usr filesystem (almost) full";
</pre>
<p>The following rule requires a machine that supports the PCP environment metrics. If the machine environment temperature rises more than 2 degrees over a 10 minute interval, write an entry in the system log:</p>
<pre>
environ.temp @0 - environ.temp @1 &gt; 2
-&gt; alarm "temperature rising fast" &
   syslog "machine room temperature rise alarm";
</pre>
<p>And something interesting if you have performance problems with your Oracle database:</p>
<pre>
// back to 30sec evaluations
delta = 30 sec;
db = "oracle.ptg1";
host = ":moomba.melbourne.sgi.com";
lru = "#'cache buffers lru chain'";
gets = "$db.latch.gets $host $lru";
total = "$db.latch.gets $host $lru +
         $db.latch.misses $host $lru +
         $db.latch.immisses $host $lru";

$total &gt; 100 && $gets / $total &lt; 0.2
-&gt; alarm "high lru latch contention";
</pre>
<p>The following <strong>ruleset</strong> will emit exactly one message depending on the availability and value of the 1-minute load average.</p>
<pre>
delta = 1 minute;
ruleset
     kernel.all.load #'1 minute' &gt; 10 * hinv.ncpu -&gt;
         print "extreme load average %v"
else kernel.all.load #'1 minute' &gt; 2 * hinv.ncpu -&gt;
         print "moderate load average %v"
unknown -&gt;
         print "load average unavailable"
otherwise -&gt;
         print "load average OK"
;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">QUICK START</h2>
        <div class="sectioncontent">
<p>The <strong>pmie</strong> specification language is powerful and large.</p><p>To expedite rapid development of <strong>pmie</strong> rules, the <strong>pmieconf</strong>(1) tool provides a facility for generating a <strong>pmie</strong> configuration file from a set of generalized <strong>pmie</strong> rules. The supplied set of rules covers a wide range of performance scenarios.</p><p>The <em>Performance Co-Pilot User's and Administrator's Guide</em> provides a detailed tutorial-style chapter covering <strong>pmie</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPRESSION SYNTAX</h2>
        <div class="sectioncontent">
<p>This description is terse and informal. For a more comprehensive description see the <em>Performance Co-Pilot User's and Administrator's Guide</em>.</p><p>A <strong>pmie</strong> specification is a sequence of semicolon terminated expressions.</p><p>Basic operators are modeled on the arithmetic, relational and Boolean operators of the C programming language. Precedence rules are as expected, although the use of parentheses is encouraged to enhance readability and remove ambiguity.</p><p>Operands are performance metric names (see <a href="../man5/pmns.5.html"><strong>pmns</strong>(5)</a>) and the normal literal constants.</p><p>Operands involving performance metrics may produce sets of values, as a result of enumeration in the dimensions of <strong>hosts</strong>, <strong>instances</strong> and <strong>time</strong>. Special qualifiers may appear after a performance metric name to define the enumeration in each dimension.  For example,</p><p>kernel.percpu.cpu.user :foo :bar #cpu0 @0..2</p><p>defines 6 values corresponding to the time spent executing in user mode on CPU 0 on the hosts ``foo'' and ``bar'' over the last 3 consecutive samples. The default interpretation in the absence of <strong>:</strong> (host), <strong>#</strong> (instance) and <strong>@</strong> (time) qualifiers is all instances at the most recent sample time for the default source of PCP performance metrics.</p><p>Host and instance names that do not follow the rules for variables in programming languages, ie. alphabetic optionally followed by alphanumerics, should be enclosed in single quotes.</p><p>Expression evaluation follows the law of ``least surprises''. Where performance metrics have the semantics of a counter, <strong>pmie</strong> will automatically convert to a rate based upon consecutive samples and the time interval between these samples. All expressions are evaluated in double precision, and where appropriate, automatically scaled into canonical units of ``bytes'', ``seconds'' and ``counts''.</p><p>A <strong>rule</strong> is a special form of expression that specifies a condition or logical expression, a special operator ( .BR -&gt; ) and actions to be performed when the condition is found to be true.</p><p>The following table summarizes the basic <strong>pmie</strong> operators:</p><table class="table table-striped">
<tr>
<th>Operators</th>
<th>Explanation</th>
<th></th></tr>

<tr>
<td>+ - * /</td>
<td>Arithmetic</td>
<td></td></tr>

<tr>
<td>&lt; &lt;= == &gt;= &gt; !=</td>
<td>Relational (value comparison)</td>
<td></td></tr>

<tr>
<td>! && ||</td>
<td>Boolean</td>
<td></td></tr>

<tr>
<td>-&gt;</td>
<td>Rule</td>
<td></td></tr>

<tr>
<td><strong>rising</strong></td>
<td>Boolean, false to true transition</td>
<td></td></tr>

<tr>
<td><strong>falling</strong></td>
<td>Boolean, true to false transition</td>
<td></td></tr>

<tr>
<td><strong>rate</strong></td>
<td>Explicit rate conversion (rarely required)</td>
<td></td></tr>
</table><p>Aggregate operators may be used to aggregate or summarize along one dimension of a set-valued expression. The following aggregate operators map from a logical expression to a logical expression of lower dimension.</p><table class="table table-striped">
<tr>
<th>Operators</th>
<th>Type</th>
<th>Explanation</th>
<th></th>
<th></th></tr>

<tr>
<td>some_inst          some_host          some_sample    </td>
<td>Existential</td>
<td>True if at least one set member is true in the associated dimension    </td>
<td>all_inst          all_host          all_sample    </td>
<td>Universal</td></tr>

<tr>
<td>True if all set members are true in the associated dimension    </td>
<td><strong>N</strong><strong>%_inst</strong>          <strong>N</strong><strong>%_host</strong>          <strong>N</strong><strong>%_sample</strong>    </td>
<td>Percentile</td>
<td>True if at least <em>N</em> percent of set members are true in the associated dimension    </td></tr>
</table><p>The following instantial operators may be used to filter or limit a set-valued logical expression, based on regular expression matching of instance names.  The logical expression must be a set involving the dimension of instances, and the regular expression is of the form used by <a href="../man1/egrep.1.html"><strong>egrep</strong>(1)</a> or the Extended Regular Expressions of <strong>regcomp</strong>(3G).</p><table class="table table-striped">
<tr>
<th>Operators</th>
<th>Explanation</th>
<th></th></tr>

<tr>
<td>match_inst</td>
<td>For each value of the logical expression that is ``true'', the   result is ``true'' if the associated instance name matches the   regular expression.  Otherwise the result is ``false''.  </td>
<td>nomatch_inst</td></tr>

<tr>
<td>For each value of the logical expression that is ``true'', the   result is ``true'' if the associated instance name does   <strong>not</strong> match the   regular expression.  Otherwise the result is ``false''.  </td></tr>
</table><p>For example, the expression below will be ``true'' for disks attached to controllers 2 or 3 performing more than 20 operations per second:</p>
<pre>
match_inst "^dks[23]d" disk.dev.total &gt; 20;
</pre>
<p>The following aggregate operators map from an arithmetic expression to an arithmetic expression of lower dimension.</p><table class="table table-striped">
<tr>
<th>Operators</th>
<th>Type</th>
<th>Explanation</th>
<th></th>
<th></th></tr>

<tr>
<td>min_inst          min_host          min_sample    </td>
<td>Extrema</td>
<td>Minimum value across all set members in the associated dimension    </td>
<td>max_inst          max_host          max_sample    </td>
<td>Extrema</td></tr>

<tr>
<td>Maximum value across all set members in the associated dimension    </td>
<td>sum_inst          sum_host          sum_sample    </td>
<td>Aggregate</td>
<td>Sum of values across all set members in the associated dimension    </td>
<td>avg_inst          avg_host          avg_sample    </td></tr>

<tr>
<td>Aggregate</td>
<td>Average value across all set members in the associated dimension    </td></tr>
</table><p>The aggregate operators count_inst, count_host and count_sample map from a logical expression to an arithmetic expression of lower dimension by counting the number of set members for which the expression is true in the associated dimension.</p><p>For action rules, the following actions are defined:</p><table class="table table-striped">
<tr>
<th>Operators</th>
<th>Explanation</th>
<th></th></tr>

<tr>
<td>alarm</td>
<td>Raise a visible alarm with <strong>xconfirm</strong>(1)</td>
<td></td></tr>

<tr>
<td>print</td>
<td>Display on standard output</td>
<td></td></tr>

<tr>
<td>shell</td>
<td>Execute with <strong>sh</strong>(1)</td>
<td></td></tr>

<tr>
<td>stomp</td>
<td>Send a STOMP message to a JMS server</td>
<td></td></tr>

<tr>
<td>syslog</td>
<td>Append a message to system log file</td>
<td></td></tr>
</table><p>Multiple actions may be separated by the & and | operators to specify respectively sequential execution (both actions are executed) and alternate execution (the second action will only be executed if the execution of the first action returns a non-zero error status.</p><p>Arguments to actions are an optional suppression time, and then one or more expressions (a string is an expression in this context). Strings appearing as arguments to an action may include the following special selectors that will be replaced at the time the action is executed.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>%h</strong></p>
  </dt>
  <dd>
    <p>Host(s) that make the left-most top-level expression in the condition true.</p>
  </dd>
  <dt>
    <p><strong>%i</strong></p>
  </dt>
  <dd>
    <p>Instance(s) that make the left-most top-level expression in the condition true.</p>
  </dd>
  <dt>
    <p><strong>%v</strong></p>
  </dt>
  <dd>
    <p>One value from the left-most top-level expression in the condition for each host and instance pair that makes the condition true.</p>
  </dd>

</dl>
<p>Note that expansion of the special selectors is done by repeating the whole argument once for each unique binding to any of the qualifying special selectors. For example if a rule were true for the host <strong>mumble</strong> with instances <strong>grunt</strong> and <strong>snort</strong>, and for host <strong>fumble</strong> the instance <strong>puff</strong> makes the rule true, then the action</p>
<pre>
...
-&gt; shell myscript "Warning: %h:%i busy ";
</pre>
<p>will execute <strong>myscript</strong> with the argument string "Warning: mumble:grunt busy Warning: mumble:snort busy Warning: fumble:puff busy".</p><p>By comparison, if the action</p>
<pre>
...
-&gt; shell myscript "Warning! busy:" " %h:%i";
</pre>
<p>were executed under the same circumstances, then <strong>myscript</strong> would be executed with the argument string "Warning! busy: mumble:grunt mumble:snort fumble:puff".</p><p>The semantics of the expansion of the special selectors leads to a common usage pattern in an action, where one argument is a constant (contains no special selectors) the second argument contains the desired special selectors with minimal separator characters, and an optional third argument provides a constant postscript (e.g. to terminate any argument quoting from the first argument). If necessary post-processing (eg. in <strong>myscript</strong>) can provide the necessary enumeration over each unique expansion of the string containing just the special selectors.</p><p>For complex conditions, the bindings to these selectors is not obvious. It is strongly recommended that <strong>pmie</strong> be used in the debugging mode (specify the <strong>-W</strong> command line option in particular) during rule development.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BOOLEAN EXPRESSIONS</h2>
        <div class="sectioncontent">
<p><strong>pmie</strong> expressions that have the semantics of a Boolean, e.g. foo.bar &gt; 10 or <strong>some_inst ( my.table &lt; 0 )</strong> are assigned the values <strong>true</strong> or <strong>false</strong> or <strong>unknown</strong>. A value is <strong>unknown</strong> if one or more of the underlying metric values is unavailable, e.g. <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a> on the host cannot be contacted, the metric is not in the PCP archive, no values are currently available, insufficient values have been fetched to allow a rate converted value to be computed or insufficient values have been fetched to instantiate the required number of samples in the temporal domain.</p><p>Boolean operators follow the normal rules of Kleene logic (aka 3-valued logic) when combining values that include <strong>unknown</strong>:</p><table class="table table-striped">
<tr>
<th>A <strong>and</strong> B</th></tr>

<tr>
<td>B</td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td>A</td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>
</table><table class="table table-striped">
<tr>
<th>A <strong>or</strong> B</th></tr>

<tr>
<td>B</td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>B</td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td>A</td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td></td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td>_</td></tr>

<tr>
<td></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>
</table><table class="table table-striped">
<tr>
<th>A</th></tr>

<tr>
<td><strong>not</strong> A</td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>false</strong></td></tr>

<tr>
<td><strong>true</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>

<tr>
<td><strong>unknown</strong></td></tr>
</table>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RULESETS</h2>
        <div class="sectioncontent">
<p>The <strong>ruleset</strong> clause is used to define a set of rules and actions that are evaluated in order until some action is executed, at which point the remaining rules and actions are skipped until the <strong>ruleset</strong> is again scheduled for evaluation. The keyword <strong>else</strong> is used to separate rules. After one or more regular rules (with a predicate and an action), a <strong>ruleset</strong> may include an optional</p><p><strong>unknown</strong> -&gt; action</p><p>clause, optionally followed by a</p><p><strong>otherwise</strong> -&gt; action</p><p>clause.</p><p>If all of the predicates in the rules evaluate to <strong>unknown</strong> and an <strong>unknown</strong> clause has been specified then action associated with the <strong>unknown</strong> clause will be executed.</p><p>If no rule predicate is <strong>true</strong> and the <strong>unknown</strong> action is either not specified or not executed and an <strong>otherwise</strong> clause has been specified, then the action associated with the <strong>otherwise</strong> clause will be executed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCALE FACTORS</h2>
        <div class="sectioncontent">
<p>Scale factors may be appended to arithmetic expressions and force linear scaling of the value to canonical units.  Simple scale factors are constructed from the keywords: <strong>nanosecond</strong>, <strong>nanosec</strong>, <strong>nsec</strong>, <strong>microsecond</strong>, <strong>microsec</strong>, <strong>usec</strong>, <strong>millisecond</strong>, <strong>millisec</strong>, <strong>msec</strong>, <strong>second</strong>, <strong>sec</strong>, <strong>minute</strong>, <strong>min</strong>, <strong>hour</strong>, <strong>byte</strong>, <strong>Kbyte</strong>, <strong>Mbyte</strong>, <strong>Gbyte</strong>, <strong>Tbyte</strong>, <strong>count</strong>, <strong>Kcount</strong> and <strong>Mcount</strong>, and the operator /, for example ``<strong>Kbytes / hour</strong>''.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MACROS</h2>
        <div class="sectioncontent">
<p>Macros are defined using expressions of the form:</p><p><em>name</em> = <em>constexpr</em>;</p><p>Where <em>name</em> follows the normal rules for variables in programming languages, ie. alphabetic optionally followed by alphanumerics. <em>constexpr</em> must be a constant expression, either a string (enclosed in double quotes) or an arithmetic expression optionally followed by a scale factor.</p><p>Macros are expanded when their name, prefixed by a dollar ($) appears in an expression, and macros may be nested within a <em>constexpr</em> string.</p><p>The following reserved macro names are understood.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>minute</strong></p>
  </dt>
  <dd>
    <p>Current minute of the hour.</p>
  </dd>
  <dt>
    <p><strong>hour</strong></p>
  </dt>
  <dd>
    <p>Current hour of the day, in the range 0 to 23.</p>
  </dd>
  <dt>
    <p><strong>day</strong></p>
  </dt>
  <dd>
    <p>Current day of the month, in the range 1 to 31.</p>
  </dd>
  <dt>
    <p><strong>month</strong></p>
  </dt>
  <dd>
    <p>Current month of the year, in the range 0 (January) to 11 (December).</p>
  </dd>
  <dt>
    <p><strong>year</strong></p>
  </dt>
  <dd>
    <p>Current year.</p>
  </dd>
  <dt>
    <p><strong>day_of_week</strong></p>
  </dt>
  <dd>
    <p>Current day of the week, in the range 0 (Sunday) to 6 (Saturday).</p>
  </dd>
  <dt>
    <p><strong>delta</strong></p>
  </dt>
  <dd>
    <p>Sample interval in effect for this expression.</p>
  </dd>

</dl>
<p>Dates and times are presented in the reporting time zone (see description of <strong>-Z</strong> and <strong>-z</strong> command line options above).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTOMATIC RESTART</h2>
        <div class="sectioncontent">
<p>It is often useful for <strong>pmie</strong> processes to be started and stopped when the local host is booted or shutdown, or when they have been detected as no longer running (when they have unexpectedly exited for some reason). Refer to <a href="../man1/pmie_check.1.html"><strong>pmie_check</strong>(1)</a> for details on automating this process.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EVENT MONITORING</h2>
        <div class="sectioncontent">
<p>It is common for production systems to be monitored in a central location. Traditionally on UNIX systems this has been performed by the system log facilities - see <a href="../man1/logger.1.html"><strong>logger</strong>(1)</a>, and <strong>syslogd</strong>(1). On Windows, communication with the system event log is handled by <strong>pcp-eventlog</strong>(1).</p><p><strong>pmie</strong> fits into this model when rules use the <em>syslog</em> action. Note that if the action string begins with -p (priority) and/or -t (tag) then these are extracted from the string and treated in the same way as in <a href="../man1/logger.1.html"><strong>logger</strong>(1)</a> and <strong>pcp-eventlog</strong>(1).</p><p>However, it is common to have other event monitoring frameworks also, into which you may wish to incorporate performance events from <strong>pmie</strong>. You can often use the <em>shell</em> action to send events to these frameworks, as they usually provide their a program for injecting events into the framework from external sources.</p><p>A final option is use of the <em>stomp</em> (Streaming Text Oriented Messaging Protocol) action, which allows <strong>pmie</strong> to connect to a central JMS (Java Messaging System) server and send events to the PMIE topic. Tools can be written to extract these text messages and present them to operations people (via desktop popup windows, etc). Use of the <em>stomp</em> action requires a stomp configuration file to be setup, which specifies the location of the JMS server host, port number, and username/password.</p><p>The format of this file is as follows:</p>
<pre>
host=messages.sgi.com   # this is the JMS server (required)
port=61616              # and its listening here (required)
timeout=2               # seconds to wait for server (optional)
username=joe            # (required)
password=j03ST0MP       # (required)
topic=PMIE              # JMS topic for pmie messages (optional)
</pre>
<p>The timeout value specifies the time (in seconds) that <strong>pmie</strong> should wait for acknowledgements from the JMS server after sending a message (as required by the STOMP protocol). Note that on startup, <strong>pmie</strong> will wait indefinitely for a connection, and will not begin rule evaluation until that initial connection has been established. Should the connection to the JMS server be lost at any time while <strong>pmie</strong> is running, <strong>pmie</strong> will attempt to reconnect on each subsequent truthful evaluation of a rule with a <em>stomp</em> action, but not more than once per minute. This is to avoid contributing to network congestion. In this situation, where the STOMP connection to the JMS server has been severed, the <em>stomp</em> action will return a non-zero error value.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>$PCP_DEMOS_DIR/pmie/</strong><em>*</em></p>
  </dt>
  <dd>
    <p>annotated example rules</p>
  </dd>
  <dt>
    <p><strong>$PCP_VAR_DIR/pmns/</strong><em>*</em></p>
  </dt>
  <dd>
    <p>default PMNS specification files</p>
  </dd>
  <dt>
    <p><strong>$PCP_TMP_DIR/pmie</strong></p>
  </dt>
  <dd>
    <p><strong>pmie</strong> maintains files in this directory to identify the running <strong>pmie</strong> instances and to export runtime information about each instance - this data forms the basis of the pmcd.pmie performance metrics</p>
  </dd>
  <dt>
    <p><strong>$PCP_PMIECONTROL_PATH</strong></p>
  </dt>
  <dd>
    <p>the default set of <strong>pmie</strong> instances to start at boot time - refer to <a href="../man1/pmie_check.1.html"><strong>pmie_check</strong>(1)</a> for details</p>
  </dd>
  <dt>
    <p><strong>$PCP_SYSCONF_DIR/pmie/</strong><em>*</em></p>
  </dt>
  <dd>
    <p>the predefined alarm action scripts ( .BR email , <strong>log</strong>, <strong>popup</strong> and <strong>syslog</strong>), the example action script ( .BR sample ) and the concurrent action control file ( .BR control.master ).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>The lexical scanner and parser will attempt to recover after an error in the input expressions. Parsing resumes after skipping input up to the next semi-colon (;), however during this skipping process the scanner is ignorant of comments and strings, so an embedded semi-colon may cause parsing to resume at an unexpected place.  This behavior is largely benign, as until the initial syntax error is corrected, <strong>pmie</strong> will not attempt any expression evaluation.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PCP ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>Environment variables with the prefix <strong>PCP_</strong> are used to parameterize the file and directory names used by PCP. On each installation, the file <em>/etc/pcp.conf</em> contains the local values for these variables. The <strong>$PCP_CONF</strong> variable may be used to specify an alternative configuration file, as described in <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">UNIX SEE ALSO</h2>
        <div class="sectioncontent">
<p><a href="../man1/logger.1.html"><strong>logger</strong>(1)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WINDOWS SEE ALSO</h2>
        <div class="sectioncontent">
<p><strong>pcp-eventlog</strong>(1).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO pmie&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/PCPIntro.1.html"><strong>PCPIntro</strong>(1)</a>, <a href="../man1/pmcd.1.html"><strong>pmcd</strong>(1)</a>, <a href="../man1/pmdumplog.1.html"><strong>pmdumplog</strong>(1)</a>, <strong>pmieconf</strong>(1), <a href="../man1/pmie_check.1.html"><strong>pmie_check</strong>(1)</a>, <a href="../man1/pminfo.1.html"><strong>pminfo</strong>(1)</a>, <a href="../man1/pmlogger.1.html"><strong>pmlogger</strong>(1)</a>, <a href="../man1/pmval.1.html"><strong>pmval</strong>(1)</a>, <a href="../man3/PMAPI.3.html"><strong>PMAPI</strong>(3)</a>, <a href="../man5/pcp.conf.5.html"><strong>pcp.conf</strong>(5)</a> and <a href="../man5/pcp.env.5.html"><strong>pcp.env</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">USER GUIDE</h2>
        <div class="sectioncontent">
<p>For a more complete description of the <strong>pmie</strong> language, refer to the <strong>Performance Co-Pilot Users and Administrators Guide</strong>. This is available online from:</p>
<pre>
http://www.performancecopilot.org/doc/pcp-users-and-administrators-guide.pdf
</pre>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="pmidi.1.html"><span aria-hidden="true">&larr;</span> pmidi.1: A midi file player for alsa.</a></li>
   <li class="next"><a href="pmie2col.1.html">pmie2col.1: Convert pmie output to multi-column format <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
