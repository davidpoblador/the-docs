<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>stm32flash: Flashing utility for stm32 and stm32w through uart or i2c</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Flashing utility for stm32 and stm32w through uart or i2c">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="stm32flash (1) manual">
  <meta name="twitter:description" content="Flashing utility for stm32 and stm32w through uart or i2c">
  <meta name="twitter:image" content="https://www.carta.tech/images/stm32flash-stm32flash-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/stm32flash.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="stm32flash (1) manual" />
  <meta property="og:description" content="Flashing utility for stm32 and stm32w through uart or i2c" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/stm32flash-stm32flash-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">stm32flash<small> (1)</small></h1>
        <p class="lead">Flashing utility for stm32 and stm32w through uart or i2c</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/stm32flash.1.html">
      <span itemprop="name">stm32flash: Flashing utility for stm32 and stm32w through uart or i2c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/stm32flash/">
      <span itemprop="name">stm32flash</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/stm32flash.1.html">
      <span itemprop="name">stm32flash: Flashing utility for stm32 and stm32w through uart or i2c</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>stm32flash</strong> [<strong>-cfhjkouvCR</strong>] [<strong>-a</strong> <em>bus_address</em>] [<strong>-b</strong> <em>baud_rate</em>] [<strong>-m</strong> <em>serial_mode</em>] [<strong>-r</strong> <em>filename</em>] [<strong>-w</strong> <em>filename</em>] [<strong>-e</strong> <em>num</em>] [<strong>-n</strong> <em>count</em>] [<strong>-g</strong> <em>address</em>] [<strong>-s</strong> <em>start_page</em>] [<strong>-S</strong> <em>address</em>[:<em>length</em>]] [<strong>-F</strong> <em>RX_length</em>[:<em>TX_length</em>]] [<strong>-i</strong> <em>GPIO_string</em>] [<em>tty_device</em> | <em>i2c_device</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>stm32flash</strong> reads or writes the flash memory of STM32 and STM32W.</p><p>It requires the STM32[W] to embed a bootloader compliant with ST application note AN3155. <strong>stm32flash</strong> uses the serial port <em>tty_device</em> to interact with the bootloader of STM32[W].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>-a</strong><em> bus_address</em></p>
  </dt>
  <dd>
    <p>Specify address on bus for <em>i2c_device</em>. This option is mandatory for I2C interface.</p>
  </dd>
  <dt>
    <p><strong>-b</strong><em> baud_rate</em></p>
  </dt>
  <dd>
    <p>Specify baud rate speed of <em>tty_device</em>. Please notice that the ST bootloader can automatically detect the baud rate, as explaned in chapter 2 of AN3155. This option could be required together with option <strong>-c</strong> or if following interaction with bootloader is expected. Default is <em>57600</em>.</p>
  </dd>
  <dt>
    <p><strong>-m</strong><em> mode</em></p>
  </dt>
  <dd>
    <p>Specify the format of UART data. <em>mode</em> is a three characters long string where each character specifies, in this strict order, character size, parity and stop bits. The only values currenly used are <em>8e1</em> for standard STM32 bootloader and <em>8n1</em> for standard STM32W bootloader. Default is <em>8e1</em>.</p>
  </dd>
  <dt>
    <p><strong>-r</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>Specify to read the STM32[W] flash and write its content in <em>filename</em> in raw binary format (see below <strong>FORMAT CONVERSION</strong>).</p>
  </dd>
  <dt>
    <p><strong>-w</strong><em> filename</em></p>
  </dt>
  <dd>
    <p>Specify to write the STM32[W] flash with the content of <em>filename</em>. File format can be either raw binary or intel hex (see below <strong>FORMAT CONVERSION</strong>). The file format is automatically detected. To by-pass format detection and force binary mode (e.g. to write an intel hex content in STM32[W] flash), use <strong>-f</strong> option.</p>
  </dd>
  <dt>
    <p><strong>-u</strong></p>
  </dt>
  <dd>
    <p>Specify to disable write-protection from STM32[W] flash. The STM32[W] will be reset after this operation.</p>
  </dd>
  <dt>
    <p><strong>-j</strong></p>
  </dt>
  <dd>
    <p>Enable the flash read-protection.</p>
  </dd>
  <dt>
    <p><strong>-k</strong></p>
  </dt>
  <dd>
    <p>Disable the flash read-protection.</p>
  </dd>
  <dt>
    <p><strong>-o</strong></p>
  </dt>
  <dd>
    <p>Erase only.</p>
  </dd>
  <dt>
    <p><strong>-e</strong><em> num</em></p>
  </dt>
  <dd>
    <p>Specify to erase only <em>num</em> pages before writing the flash. Default is to erase the whole flash. With <strong>-e 0</strong> the flash would not be erased.</p>
  </dd>
  <dt>
    <p><strong>-v</strong></p>
  </dt>
  <dd>
    <p>Specify to verify flash content after write operation.</p>
  </dd>
  <dt>
    <p><strong>-n</strong><em> count</em></p>
  </dt>
  <dd>
    <p>Specify to retry failed writes up to <em>count</em> times. Default is 10 times.</p>
  </dd>
  <dt>
    <p><strong>-g</strong><em> address</em></p>
  </dt>
  <dd>
    <p>Specify address to start execution from (0 = flash start).</p>
  </dd>
  <dt>
    <p><strong>-s</strong><em> start_page</em></p>
  </dt>
  <dd>
    <p>Specify flash page offset (0 = flash start).</p>
  </dd>
  <dt>
    <p><strong>-S</strong><em> address</em><strong>[:</strong><em>length</em><strong>]</strong></p>
  </dt>
  <dd>
    <p>Specify start address and optionally length for read/write/erase/crc operations.</p>
  </dd>
  <dt>
    <p><strong>-F</strong><em> RX_length</em><strong>[:</strong><em>TX_length</em><strong>]</strong></p>
  </dt>
  <dd>
    <p>Specify the maximum frame size for the current interface. Due to STM32 bootloader protocol, host will never handle frames bigger than 256 byte in RX or 258 byte in TX. Due to current code, lowest limit in RX is 20 byte (to read a complete reply of command GET). Minimum limit in TX is 5 byte, required by protocol.</p>
  </dd>
  <dt>
    <p><strong>-f</strong></p>
  </dt>
  <dd>
    <p>Force binary parser while reading file with <strong>-w</strong>.</p>
  </dd>
  <dt>
    <p><strong>-h</strong></p>
  </dt>
  <dd>
    <p>Show help.</p>
  </dd>
  <dt>
    <p><strong>-c</strong></p>
  </dt>
  <dd>
    <p>Specify to resume the existing UART connection and don't send initial INIT sequence to detect baud rate. Baud rate must be kept the same as the existing connection. This is useful if the reset fails.</p>
  </dd>
  <dt>
    <p><strong>-i</strong><em> GPIO_string</em></p>
  </dt>
  <dd>
    <p>Specify the GPIO sequences on the host to force STM32[W] to enter and exit bootloader mode. GPIO can either be real GPIO connected from host to STM32[W] beside the UART connection, or UART's modem signals used as GPIO. (See below <strong>BOOTLOADER GPIO SEQUENCE</strong> for the format of <em>GPIO_string</em> and further explanation).</p>
  </dd>
  <dt>
    <p><strong>-C</strong></p>
  </dt>
  <dd>
    <p>Specify to compute CRC on memory content. By default the CRC is computed on the whole flash content. Use <strong>-S</strong> to provide different memory address range.</p>
  </dd>
  <dt>
    <p><strong>-R</strong></p>
  </dt>
  <dd>
    <p>Specify to reset the device at exit. This option is ignored if either <strong>-g</strong>, <strong>-j</strong>, <strong>-k</strong> or <strong>-u</strong> is also specified.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BOOTLOADER GPIO SEQUENCE</h2>
        <div class="sectioncontent">
<p>This feature is currently available on Linux host only.</p><p>As explained in ST application note AN2606, after reset the STM32 will execute either the application program in user flash or the bootloader, depending on the level applied at specific pins of STM32 during reset.</p><p>STM32 bootloader is automatically activated by configuring the pins BOOT0="high" and BOOT1="low" and then by applying a reset. Application program in user flash is activated by configuring the pin BOOT0="low" (the level on BOOT1 is ignored) and then by applying a reset.</p><p>When GPIO from host computer are connected to either configuration and reset pins of STM32, <strong>stm32flash</strong> can control the host GPIO to reset STM32 and to force execution of bootloader or execution of application program.</p><p>The sequence of GPIO values to entry to and exit from bootloader mode is provided with command line option <strong>-i</strong> <em>GPIO_string</em>.</p><p>The format of <em>GPIO_string</em> is:</p><p>GPIO_string = [entry sequence][:[exit sequence]]</p><p>sequence = [-]n[,sequence]</p><p>In the above sequences, negative numbers correspond to GPIO at "low" level; numbers without sign correspond to GPIO at "high" level. The value "n" can either be the GPIO number on the host system or the string "rts", "dtr" or "brk". The strings "rts" and "dtr" drive the corresponding UART's modem lines RTS and DTR as GPIO. The string "brk" forces the UART to send a BREAK sequence on TX line; after BREAK the UART is returned in normal "non-break" mode. Note: the string "-brk" has no effect and is ignored.</p><p>As example, let's suppose the following connection between host and STM32:</p><ul>
<li><p>host GPIO_3 connected to reset pin of STM32;</p></li><li><p>host GPIO_4 connected to STM32 pin BOOT0;</p></li><li><p>host GPIO_5 connected to STM32 pin BOOT1.</p></li>
</ul><p>In this case, the sequence to enter in bootloader mode is: first put GPIO_4="high" and GPIO_5="low"; then send reset pulse by GPIO_3="low" followed by GPIO_3="high". The corresponding string for <em>GPIO_string</em> is "4,-5,-3,3".</p><p>To exit from bootloade and run the application program, the sequence is: put GPIO_4="low"; then send reset pulse. The corresponding string for <em>GPIO_string</em> is "-4,-3,3".</p><p>The complete command line flag is "-i 4,-5,-3,3:-4,-3,3".</p><p>STM32W uses pad PA5 to select boot mode; if during reset PA5 is "low" then STM32W will enter in bootloader mode; if PA5 is "high" it will execute the program in flash.</p><p>As example, supposing GPIO_3 connected to PA5 and GPIO_2 to STM32W's reset. The command:</p><p>stm32flash -i -3,-2,2:3,-2,2 /dev/ttyS0</p><p>provides:</p><ul>
<li><p>entry sequence: GPIO_3=low, GPIO_2=low, GPIO_2=high</p></li><li><p>exit sequence: GPIO_3=high, GPIO_2=low, GPIO_2=high</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Get device information:</p><p>stm32flash /dev/ttyS0</p><p>Write with verify and then start execution:</p><p>stm32flash -w filename -v -g 0x0 /dev/ttyS0</p><p>Read flash to file:</p><p>stm32flash -r filename /dev/ttyS0</p><p>Start execution:</p><p>stm32flash -g 0x0 /dev/ttyS0</p><p>Specify:</p><ul>
<li><p>entry sequence: RTS=low, DTR=low, DTR=high</p></li><li><p>exit sequence: RTS=high, DTR=low, DTR=high</p></li>
</ul><p>stm32flash -i -rts,-dtr,dtr:rts,-dtr,dtr /dev/ttyS0</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FORMAT CONVERSION</h2>
        <div class="sectioncontent">
<p>Flash images provided by ST or created with ST tools are often in file format Motorola S-Record. Conversion between raw binary, intel hex and Motorola S-Record can be done through software package SRecord.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>The original software package <strong>stm32flash</strong> is written by <em>Geoffrey McRae &lt;geoff@spacevs.com&gt;</em> and is since 2012 maintained by <em>Tormod Volden &lt;debian.tormod@gmail.com&gt;</em>.</p><p>Man page and extension to STM32W and I2C are written by <em>Antonio Borneo &lt;borneo.antonio@gmail.com&gt;</em>.</p><p>Please report any bugs at the project homepage http://stm32flash.googlecode.com .</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO stm32flash&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/srec_cat.1.html"><strong>srec_cat</strong>(1)</a>,<strong> <a href="../man5/srec_intel.5.html"><strong>srec_intel</strong>(5)</a></strong>,<strong> <a href="../man5/srec_motorola.5.html"><strong>srec_motorola</strong>(5)</a></strong>.</p><p>The communication protocol used by ST bootloader is documented in following ST application notes, depending on communication port. The current version of <strong>stm32flash</strong> only supports <em>UART</em> and <em>I2C</em> ports.</p><ul>
<li><p>AN3154: CAN protocol used in the STM32 bootloader</p></li>
</ul><p>http://www.st.com/web/en/resource/technical/document/application_note/CD00264321.pdf</p><ul>
<li><p>AN3155: USART protocol used in the STM32(TM) bootloader</p></li>
</ul><p>http://www.st.com/web/en/resource/technical/document/application_note/CD00264342.pdf</p><ul>
<li><p>AN4221: I2C protocol used in the STM32 bootloader</p></li>
</ul><p>http://www.st.com/web/en/resource/technical/document/application_note/DM00072315.pdf</p><ul>
<li><p>AN4286: SPI protocol used in the STM32 bootloader</p></li>
</ul><p>http://www.st.com/web/en/resource/technical/document/application_note/DM00081379.pdf</p><p>Boot mode selection for STM32 is documented in ST application note AN2606, available from the ST website:</p><p>http://www.st.com/web/en/resource/technical/document/application_note/CD00167594.pdf</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p><strong>stm32flash</strong> is distributed under GNU GENERAL PUBLIC LICENSE Version 2. Copy of the license is available within the source code in the file <em>gpl-2.0.txt</em>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="stl2gts.1.html"><span aria-hidden="true">&larr;</span> stl2gts.1: Convert an stl file to gts format.</a></li>
   <li class="next"><a href="stoken.1.html">stoken.1: Software token for cryptographic authentication <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
