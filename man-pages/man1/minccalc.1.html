<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>minccalc: Perform complex math operations on minc files</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Perform complex math operations on minc files">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="minccalc (1) manual">
  <meta name="twitter:description" content="Perform complex math operations on minc files">
  <meta name="twitter:image" content="https://www.carta.tech/images/minc-tools-minccalc-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/minccalc.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="minccalc (1) manual" />
  <meta property="og:description" content="Perform complex math operations on minc files" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/minc-tools-minccalc-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">minccalc<small> (1)</small></h1>
        <p class="lead">Perform complex math operations on minc files</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/minccalc.1.html">
      <span itemprop="name">minccalc: Perform complex math operations on minc files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/minc-tools/">
      <span itemprop="name">minc-tools</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/minccalc.1.html">
      <span itemprop="name">minccalc: Perform complex math operations on minc files</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>mincalc</strong> [&lt;options&gt;] &lt;in1&gt;.mnc [&lt;in2&gt;.mnc...] &lt;out&gt;.mnc</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Minccalc</em> will perform complex, voxel-by-voxel math operations, on one or more minc files of the same shape and having the same coordinate sampling, producing a single output file. The operations to be performed are input using the <strong>-expression</strong> argument (see <strong>EXPRESSIONS</strong>). By default, the output file is the last non-option argument. However, if the <strong>-outfile</strong> option is used, then all non-option arguments are considered input files and the output file names come from the <strong>-outfile</strong> options, of which there can be more than one.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Note that options can be specified in abbreviated form (as long as they are unique) and can be given anywhere on the command line.</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>-2</strong></p>
  </dt>
  <dd>
    <p>Create MINC 2.0 format output files.</p>
  </dd>
  <dt>
    <p><strong>-help</strong></p>
  </dt>
  <dd>
    <p>Print summary of command-line options and exit.</p>
  </dd>
  <dt>
    <p><strong>-version</strong></p>
  </dt>
  <dd>
    <p>Print the program's version number and exit.</p>
  </dd>
  <dt>
    <p><strong>-clobber</strong></p>
  </dt>
  <dd>
    <p>Overwrite an existing file.</p>
  </dd>
  <dt>
    <p><strong>-noclobber</strong></p>
  </dt>
  <dd>
    <p>Don't overwrite an existing file (default).</p>
  </dd>
  <dt>
    <p><strong>-no_clobber</strong></p>
  </dt>
  <dd>
    <p>Synonym for -noclobber.</p>
  </dd>
  <dt>
    <p><strong>-verbose</strong></p>
  </dt>
  <dd>
    <p>Print out progress information for each chunk of data copied (default).</p>
  </dd>
  <dt>
    <p><strong>-quiet</strong></p>
  </dt>
  <dd>
    <p>Do not print out progress information.</p>
  </dd>
  <dt>
    <p><strong>-debug</strong></p>
  </dt>
  <dd>
    <p>Print out debugging information.</p>
  </dd>
  <dt>
    <p><strong>-copy_header</strong></p>
  </dt>
  <dd>
    <p>Copy all of the header information from the first input file (default for one input file).</p>
  </dd>
  <dt>
    <p><strong>-nocopy_header</strong></p>
  </dt>
  <dd>
    <p>Do not copy all of the header from the first input file; copy only coordinate information (default for more than one input file).</p>
  </dd>
  <dt>
    <p><strong>-filetype</strong></p>
  </dt>
  <dd>
    <p>Create an output file with the same type as the first input file (default).</p>
  </dd>
  <dt>
    <p><strong>-byte</strong></p>
  </dt>
  <dd>
    <p>Store output voxels in 8-bit integer format.</p>
  </dd>
  <dt>
    <p><strong>-short</strong></p>
  </dt>
  <dd>
    <p>Store output voxels in 16-bit integer format.</p>
  </dd>
  <dt>
    <p><strong>-int</strong></p>
  </dt>
  <dd>
    <p>Store output voxels in 32-bit integer format.</p>
  </dd>
  <dt>
    <p><strong>-long</strong></p>
  </dt>
  <dd>
    <p>Superseded by <strong>-int</strong>.</p>
  </dd>
  <dt>
    <p><strong>-float</strong></p>
  </dt>
  <dd>
    <p>Store output voxels in 32-bit floating point format.</p>
  </dd>
  <dt>
    <p><strong>-double</strong></p>
  </dt>
  <dd>
    <p>Store output voxels in 64-bit floating point format.</p>
  </dd>
  <dt>
    <p><strong>-signed</strong></p>
  </dt>
  <dd>
    <p>Use signed, two's complement integer format. Applies only if the output voxel type is specified to be an integer type (one of <strong>-byte</strong>, <strong>-short</strong>, <strong>-int</strong> or <strong>-long</strong>).</p>
  </dd>
  <dt>
    <p><strong>-unsigned</strong></p>
  </dt>
  <dd>
    <p>Use unsigned integer format. Applies only if the output voxel type is specified to be an integer type (one of <strong>-byte</strong>, <strong>-short</strong>, <strong>-int</strong> or <strong>-long</strong>).</p>
  </dd>
  <dt>
    <p><strong>-range</strong> <em>min max</em></p>
  </dt>
  <dd>
    <p>Restrict the valid range of integer data.  Applies only if one of the <strong>-byte</strong>, <strong>-short</strong>, <strong>-int</strong> or <strong>-long</strong> options is specified.</p>
  </dd>
  <dt>
    <p><strong>-max_buffer_size_in_kb</strong> <em>size</em></p>
  </dt>
  <dd>
    <p>Specify the maximum size of the internal buffers (in kbytes). Default is 4096 (4MB).</p>
  </dd>
  <dt>
    <p><strong>-dimension</strong>&nbsp;<em>dimname</em></p>
  </dt>
  <dd>
    <p>Specify a dimension along which we wish to perform a cumulative operation.</p>
  </dd>
  <dt>
    <p><strong>-check_dimensions</strong></p>
  </dt>
  <dd>
    <p>Check that all input files have matching sampling in world dimensions (default).</p>
  </dd>
  <dt>
    <p><strong>-nocheck_dimensions</strong></p>
  </dt>
  <dd>
    <p>Ignore any differences in world dimensions sampling for input files.</p>
  </dd>
  <dt>
    <p><strong>-propagate_nan</strong></p>
  </dt>
  <dd>
    <p>For cumulative vector operations (<strong>sum</strong>, <strong>prod</strong> and <strong>avg</strong>), invalid data  (Not-A-Number or NaN) in any element of the vector will produce invalid data in the result (default).</p>
  </dd>
  <dt>
    <p><strong>-ignore_nan</strong></p>
  </dt>
  <dd>
    <p>For cumulative vector operations, invalid data (NaN) in the vector is ignored, ie. treated as though it is not present.</p>
  </dd>
  <dt>
    <p><strong>-nan</strong></p>
  </dt>
  <dd>
    <p>When an illegal operation is attempted at a voxel (such as divide by zero), the result is invalid data (NaN) (default). Having no valid input data for a cumulative operation is also considered an illegal operation when <strong>-ignore_nan</strong> is used.</p>
  </dd>
  <dt>
    <p><strong>-zero</strong></p>
  </dt>
  <dd>
    <p>When an illegal operation is attempted at a voxel (such as divide by zero), the result is value zero.</p>
  </dd>
  <dt>
    <p><strong>-illegal_value</strong>&nbsp;<em>value</em></p>
  </dt>
  <dd>
    <p>When an illegal operation is attempted at a voxel (such as divide by zero), the result is the value specified by this option.</p>
  </dd>
  <dt>
    <p><strong>-expression</strong> <em>string</em></p>
  </dt>
  <dd>
    <p>Specify the expression to evaluate at each voxel (see EXPRESSIONS).</p>
  </dd>
  <dt>
    <p><strong>-expfile</strong> <em>filename</em></p>
  </dt>
  <dd>
    <p>Specify a file containing an expression to evaluate at each voxel (see EXPRESSIONS). If filename ``-'' is given, then the expression is read from stdin. The only difference from command-line expressions is that comments can be given in the file. A comment line is specified by placing a ``#'' as the first non-whitespace character of the line. Minccalc scripts can be created by setting the first line to</p>
<pre>
   #! /usr/local/mni/bin/minccalc -expfile
</pre>

  </dd>
  <dt>
    <p><strong>-outfile</strong> <em>symbol output-file</em></p>
  </dt>
  <dd>
    <p>Specify that output should be written to the specified file, taking values from the symbol which should be created in the expression (see the <strong>EXAMPLES</strong> section). If this option is given, then all non-option arguments are taken as input files. This option can be used multiple times for multiple output files.</p>
  </dd>
  <dt>
    <p><strong>-eval_width</strong> <em>value</em></p>
  </dt>
  <dd>
    <p>Specify the number of voxels to process in parallel. Default is 200.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXPRESSIONS</h2>
        <div class="sectioncontent">
<p>The <strong>-expression</strong> argument is a single string that describes the function to evaluate. The function expression is typically written in terms of the vector A.</p><p>For example, the following expression will sum the first two input files together:</p>
<pre>
   A[0] + A[1]
</pre>
<p>Multiple expressions can be given separated by semicolons, in which case only the value of the last expression is used. These expression lists can be used with assignment expressions to make the syntax very C-like:</p>
<pre>
   ratio = A[0]/A[1]; A[2]*exp(-ratio)
</pre>
<p>An expression list in curly brackets is a valid expression and returns the value of last expression in the list. This is particularly useful in <strong>for</strong> and <strong>if</strong> expressions (see below).</p><p>There are two types of values in the language: vectors and scalars. Scalars literals are floating point numbers or may appear as symbols whose name starts with a lowercase letter.</p><p>Besides normal scalar operators such as +, -, * and /, the expression language also supports the infix exponentiation operator ^ , the usual relational operators &lt;, &lt;=, &gt;, &gt;=, ==, != as well as the boolean operators && (and), || (or) and ! (not). Note that the && and || boolean operators always evaluate both operands, unlike C. Scalar mathematical functions include <strong>abs</strong>, <strong>sqrt</strong>, <strong>exp</strong>, <strong>log</strong>, <strong>sin</strong>, <strong>cos</strong>, <strong>tan</strong>, <strong>asin</strong>, <strong>acos</strong> and <strong>atan</strong>. There are also some specialized functions:</p>
<pre>
   isnan(v) - 1 if v is invalid and 0 otherwise
   clamp(v1,v2,v3) - v1 bounded by [v2, v3]
   segment(v1,v2,v3) - tests if v1 is in [v2, v3]
</pre>
<p>The scalar constant NaN is defined such that isnan(NaN) return 1.</p><p>Vectors can be written in the following `extensional' form</p>
<pre>
   [ value1, value2, ... ]
</pre>
<p>or by using the following range-generating notations:</p>
<pre>
   [ a : b ]     generates {a, a+1, ..., b-1, b}
   [ a : b )     generates {a, a+1, ..., b-1}
   ( a : b ]     generates {a+1, ..., b-1, b}
   ( a : b )     generates {a+1, ..., b-1}
</pre>
<p>or be generated, by `intension'. The following intension expression generates the vector {3,2,1}:</p>
<pre>
   { i in [1:3] | 4 - i }
</pre>
<p>Vectors may also appear as symbols whose name starts with an uppercase letter.</p><p>In addition to the scalar operators, the following vector operators are supplied:</p>
<pre>
   avg  - the average value of the scalars in vector
   len  - the length of
   sum  - the sum of the elements of
   prod - the product of the elements of
   max  - the maximum value of
   min  - the minimum value of
   imax - the index of the maximum value of
   imin - the index of the minimum value of
   V[s] - the s'th element of vector V with origin 0.
</pre>
<p>Symbol names are introduced into a global symbol table by assignment expressions of the form</p>
<pre>
   a = A[2] * <strong>log</strong>(2)
</pre>
<p>Symbols starting with a lowercase letter represent scalars while those starting with an uppercase letter represent vectors. Since = is an operator, its result can be used in an expression (as in C).</p><p>A few control constructs are provided:</p><p>For loops can be created to loop over a vector, assigning each value to a symbol and then evaluating an expression. This is done with expressions of the form</p>
<pre>
   total=0; for{i in [0:len(A))} total=total+A[i]; total
</pre>
<p>which is equivalent to sum(A). Note that this is similar to using</p>
<pre>
   total=0; len{i in [0:len(A)) | total=total+A[i]}; total
</pre>
<p>since the <strong>for</strong> construct is actually an operator (although it is usually only used for changing symbol values). Note also that without the final "total", the expression would not be very useful since it would only return the length of the vector.</p><p>As in C, a list of expressions can be specified in curlies:</p>
<pre>
   total=total2 = 0;
   for {i in [0:len(A))} {
      total  = total  + A[i];
      total2 = total2 + A[i]^2
   }
</pre>
<p>There are also a few forms of the <strong>if-then-else</strong> construct:</p>
<pre>
   A[0]&lt;0 ? 0 : A[0]
</pre>

<pre>
   if (A[0]&lt;0) result=0 else result=A[0]
</pre>
<p>The <strong>else</strong> is optional. Again, the if construct is an operator, and the <strong>then</strong> or <strong>else</strong> expressions can be expression lists in curlies, in which  case the value of the last expression is returned. If the <strong>else</strong> expression is missing, then the value 0 is returned when the test expression is 0 (false).</p><p>The principal oddity with the <strong>for</strong> and <strong>if</strong> constructs is that unlike C statements, they must be separated from the next expression by a semicolon even when an expression list in curlies is used:</p>
<pre>
   for i in [0:len(A)) {total=total+A[i]} ; total/len(A)
   if (A[i]&gt;0) {result=2;} else {result=1} ; result*5
</pre>
<p>An alternative way to introduce symbol names is through <strong>let</strong>-expressions. For example, the following expression will always evaluate to 3:</p>
<pre>
   let a = 1, b = 2 in a + b
</pre>
<p>These were originally designed to create variables only within the evaluated expression, but modifications have been made so that the global symbol table is changed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Here is an expression for calculating standard deviation, taking into account the possibility of invalid input data, which is ignored:</p>
<pre>
     s0 = s1 = s2 = 0;
</pre>

<pre>
     for { i in [0:len(A)) } {
        v=A[i];
        if (!isnan(v)) {
           s0 = s0 + 1;
           s1 = s1 + v;
           s2 = s2 + v*v;
        }
     };
</pre>

<pre>
     if (s0 &gt; 1) {
        sqrt((s2 - s1*s1/s0) / (s0-1));
     }
     else {
        NaN;
     };
</pre>
<p>The last if could be changed to return 0 if s0 is &gt; 0 but &lt;= 1. We also drop the curly brackets, but then there must not be a ";" between the if and the else</p>
<pre>
     if (s0 &gt; 1)
        sqrt((s2 - s1*s1/s0) / (s0-1))
     else if (s0 &gt; 0)
        0
     else
        NaN
</pre>
<p>If we want both the mean and the standard deviation, we can use the <strong>-outfile</strong> option, invoking the command with</p>
<pre>
     minccalc -expfile stdev &#92;
        -outfile mean mean.mnc &#92;
        -outfile stdev stdev.mnc &#92;
        infile1.mnc infile2.mnc ...
</pre>
<p>And using the expression file (with yet another form of if expression):</p>
<pre>
     s0 = s1 = s2 = 0;
</pre>

<pre>
     for {i in [0:len(A))} {
        v=A[i];
        if (!isnan(v)) {
           s0 = s0 + 1;
           s1 = s1 + v;
           s2 = s2 + v*v;
        }
     };
</pre>

<pre>
     stdev = (s0 &gt; 1) ? sqrt((s2 - s1*s1/s0) / (s0-1)) :
                          (s0 &gt; 0) ? 0 : NaN ;
     mean  = (s0 &gt; 0) ? s1 / s0 : NaN ;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CAVEATS</h2>
        <div class="sectioncontent">
<p>A few things you should remember...</p><p>Vector variables must start with an uppercase letter.</p><p>Vector variable names must not be one of the function keywords,  sum, len, prod, ... etc</p><p>For loops and if expressions always need to be separated from the next expression by a semicolon.</p><p>The symbol table is global.</p><p>Boolean operators && and || always evaluate both operands.</p><p>A note on parallelism: For efficiency reasons, evaluations are done on many voxels at once (the number of voxels is referred to as the width of the evaluation and is changed with the <strong>-eval_width</strong> option). An odd consequence  of this is that both sides of an if-else statement are always evaluated  (unless all voxels give the same test result), but statements within each consequent are only evaluated on the appropriate voxels. In particular, entries in the symbol table are only modified according to a voxel mask. A side-effect of this is that any vector symbol set in an if-else consequent must not change the length of the symbol (although it can create it) and both sides of the consequent must agree on the length of any vector symbols that they both modify. If this is not clear, just try it - the program will complain if it is not happy.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Andrew Janke - a.janke@gmail.com</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHTS</h2>
        <div class="sectioncontent">
<p>Copyright &copy; 2000 by Andrew Janke</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO minccalc&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/mincmath.1.html"><strong>mincmath</strong>(1)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mincblob.1.html"><span aria-hidden="true">&larr;</span> mincblob.1: Calculate blobs from minc deformation grids</a></li>
   <li class="next"><a href="minccmp.1.html">minccmp.1: Compare one or more minc file using comparator operators <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
