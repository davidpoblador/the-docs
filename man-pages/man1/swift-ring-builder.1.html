<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>swift-ring-builder: Openstack-swift ring builder</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Openstack-swift ring builder">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="swift-ring-builder (1) manual">
  <meta name="twitter:description" content="Openstack-swift ring builder">
  <meta name="twitter:image" content="https://www.carta.tech/images/swift-swift-ring-builder-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/swift-ring-builder.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="swift-ring-builder (1) manual" />
  <meta property="og:description" content="Openstack-swift ring builder" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/swift-swift-ring-builder-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">swift-ring-builder<small> (1)</small></h1>
        <p class="lead">Openstack-swift ring builder</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/swift-ring-builder.1.html">
      <span itemprop="name">swift-ring-builder: Openstack-swift ring builder</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/swift/">
      <span itemprop="name">swift</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/swift-ring-builder.1.html">
      <span itemprop="name">swift-ring-builder: Openstack-swift ring builder</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>swift-ring-builder</strong> &lt;builder_file&gt; &lt;commands&gt; &lt;arguments&gt; &lt;...&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The swift-ring-builder utility is used to create, search and manipulate the swift storage ring. The ring-builder assigns partitions to devices and writes an optimized Python structure to a gzipped, pickled file on disk for shipping out to the servers. The server processes just check the modification time of the file occasionally and reload their in-memory copies of the ring structure as needed. Because of how the ring-builder manages changes to the ring, using a slightly older ring usually just means one of the three replicas for a subset of the partitions will be incorrect, which can be easily worked around.</p><p>The ring-builder also keeps its own builder file with the ring information and additional data required to build future rings. It is very important to keep multiple backup copies of these builder files. One option is to copy the builder files out to every server while copying the ring files themselves. Another is to upload the builder files into the cluster itself. Complete loss of a builder file will mean creating a new ring from scratch, nearly all partitions will end up assigned to different devices, and therefore nearly all data stored will have to be replicated to new locations. So, recovery from a builder file loss is possible, but data will definitely be unreachable for an extended time.</p><p>If invoked as 'swift-ring-builder-safe' the directory containing the builder file provided will be locked (via a .lock file in the files parent directory). This provides a basic safe guard against multiple instances of the swift-ring-builder (or other utilities that observe this lock) from attempting to write to or read the builder/ring files while operations are in progress. This can be useful in environments where ring management has been automated but the operator still needs to interact with the rings manually.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEARCH</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>&lt;search-value&gt;</strong>
  </dt>
  <dd>
    
<dl class='dl-vertical'>
  <dt>
    Can be of the form:
  </dt>
  <dd>
    
  </dd>
  <dt>
    d&lt;device_id&gt;z&lt;zone&gt;-&lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt;
  </dt>
  <dd>
    
  </dd>
  <dt>
    Any part is optional, but you must include at least one, examples:
  </dt>
  <dd>
    
<dl class='dl-vertical'>
  <dt>
    d74              Matches the device id 74
  </dt>
  <dd>
    
  </dd>
  <dt>
    z1               Matches devices in zone 1
  </dt>
  <dd>
    
  </dd>
  <dt>
    z1-1.2.3.4       Matches devices in zone 1 with the ip 1.2.3.4
  </dt>
  <dd>
    
  </dd>
  <dt>
    1.2.3.4          Matches devices in any zone with the ip 1.2.3.4
  </dt>
  <dd>
    
  </dd>
  <dt>
    z1:5678          Matches devices in zone 1 using port 5678
  </dt>
  <dd>
    
  </dd>
  <dt>
    :5678            Matches devices that use port 5678
  </dt>
  <dd>
    
  </dd>
  <dt>
    /sdb1            Matches devices with the device name sdb1
  </dt>
  <dd>
    
  </dd>
  <dt>
    _shiny           Matches devices with shiny in the meta data
  </dt>
  <dd>
    
  </dd>
  <dt>
    _'snet: 5.6.7.8' Matches devices with snet: 5.6.7.8 in the meta data
  </dt>
  <dd>
    
  </dd>
  <dt>
    [::1]            Matches devices in any zone with the ip ::1
  </dt>
  <dd>
    
  </dd>
  <dt>
    z1-[::1]:5678    Matches devices in zone 1 with ip ::1 and port 5678
  </dt>
  <dd>
    
  </dd>

</dl>
<p>Most specific example:</p><p>d74z1-1.2.3.4:5678/sdb1_"snet: 5.6.7.8"</p><p>Nerd explanation:</p>
<dl class='dl-vertical'>
  <dt>
    All items require their single character prefix except the ip, in which case the - is optional unless the device id or zone is also included.
  </dt>
  <dd>
    
  </dd>

</dl>

  </dd>

</dl>

  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMANDS</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>&lt;builder_file&gt;</strong>
  </dt>
  <dd>
    <p>Shows information about the ring and the devices within.</p>
  </dd>
  <dt>
    <strong>search</strong>  &lt;search-value&gt;
  </dt>
  <dd>
    <p>Shows information about matching devices.</p>
  </dd>
  <dt>
    <strong>add</strong> z&lt;zone&gt;-&lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt; &lt;weight&gt;
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>add</strong> r&lt;region&gt;z&lt;zone&gt;-&lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt; &lt;weight&gt;
  </dt>
  <dd>
    
  </dd>
  <dt>
    <strong>add</strong> -r &lt;region&gt; -z &lt;zone&gt; -i &lt;ip&gt; -p &lt;port&gt; -d &lt;device_name&gt; -m &lt;meta&gt; -w &lt;weight&gt;
  </dt>
  <dd>
    <p>Adds a device to the ring with the given information. No partitions will be assigned to the new device until after running 'rebalance'. This is so you can make multiple device changes and rebalance them all just once.</p>
  </dd>
  <dt>
    <strong>create</strong> &lt;part_power&gt; &lt;replicas&gt; &lt;min_part_hours&gt;
  </dt>
  <dd>
    <p>Creates &lt;builder_file&gt; with 2^&lt;part_power&gt; partitions and &lt;replicas&gt;. &lt;min_part_hours&gt; is number of hours to restrict moving a partition more than once.</p>
  </dd>
  <dt>
    <strong>list_parts</strong> &lt;search-value&gt; [&lt;search-value&gt;] ..
  </dt>
  <dd>
    <p>Returns a 2 column list of all the partitions that are assigned to any of the devices matching the search values given. The first column is the assigned partition number and the second column is the number of device matches for that partition. The list is ordered from most number of matches to least. If there are a lot of devices to match against, this command could take a while to run.</p>
  </dd>
  <dt>
    <strong>rebalence</strong>
  </dt>
  <dd>
    <p>Attempts to rebalance the ring by reassigning partitions that haven't been recently reassigned.</p>
  </dd>
  <dt>
    <strong>remove</strong> &lt;search-value&gt; 
  </dt>
  <dd>
    <p>Removes the device(s) from the ring. This should normally just be used for a device that has failed. For a device you wish to decommission, it's best to set its weight to 0, wait for it to drain all its data, then use this remove command. This will not take effect until after running 'rebalance'. This is so you can make multiple device changes and rebalance them all just once.</p>
  </dd>
  <dt>
    <strong>set_info</strong> &lt;search-value&gt; &lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt;
  </dt>
  <dd>
    <p>Resets the device's information. This information isn't used to assign partitions, so you can use 'write_ring' afterward to rewrite the current ring with the newer device information. Any of the parts are optional in the final &lt;ip&gt;:&lt;port&gt;/&lt;device_name&gt;_&lt;meta&gt; parameter; just give what you want to change. For instance set_info d74 _"snet: 5.6.7.8" would just update the meta data for device id 74.</p>
  </dd>
  <dt>
    <strong>set_min_part_hours</strong> &lt;hours&gt;
  </dt>
  <dd>
    <p>Changes the &lt;min_part_hours&gt; to the given &lt;hours&gt;. This should be set to however long a full replication/update cycle takes. We're working on a way to determine this more easily than scanning logs.</p>
  </dd>
  <dt>
    <strong>set_weight</strong> &lt;search-value&gt; &lt;weight&gt;
  </dt>
  <dd>
    <p>Resets the device's weight. No partitions will be reassigned to or from the device until after running 'rebalance'. This is so you can make multiple device changes and rebalance them all just once.</p>
  </dd>
  <dt>
    <strong>validate</strong>
  </dt>
  <dd>
    <p>Just runs the validation routines on the ring.</p>
  </dd>
  <dt>
    <strong>write_ring</strong>
  </dt>
  <dd>
    <p>Just rewrites the distributable ring file. This is done automatically after a successful rebalance, so really this is only useful after one or more 'set_info' calls when no rebalance is needed but you want to send out the new device information.</p><p><strong>Quick list:</strong> add create list_parts rebalance remove search set_info</p>
<pre>
            set_min_part_hours set_weight validate write_ring
</pre>
<p><strong>Exit codes:</strong> 0 = ring changed, 1 = ring did not change, 2 = error</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DOCUMENTATION</h2>
        <div class="sectioncontent">
<p>More in depth documentation about the swift ring and also Openstack-Swift as a whole can be found at <strong>http://swift.openstack.org/overview_ring.html,</strong> <strong>http://swift.openstack.org/admin_guide.html#managing-the-rings</strong> and <strong>http://swift.openstack.org</strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="swift-recon.1.html"><span aria-hidden="true">&larr;</span> swift-recon.1: Openstack-swift recon middleware cli tool</a></li>
   <li class="next"><a href="swiften-config.1.html">swiften-config.1: Swiften-config <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
