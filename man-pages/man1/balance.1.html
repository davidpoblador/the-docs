<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>balance: A simple tcp proxy with load balancing and failover mechanisms.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A simple tcp proxy with load balancing and failover mechanisms.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="balance (1) manual">
  <meta name="twitter:description" content="A simple tcp proxy with load balancing and failover mechanisms.">
  <meta name="twitter:image" content="https://www.carta.tech/images/balance-balance-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/balance.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="balance (1) manual" />
  <meta property="og:description" content="A simple tcp proxy with load balancing and failover mechanisms." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/balance-balance-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">balance<small> (1)</small></h1>
        <p class="lead">A simple tcp proxy with load balancing and failover mechanisms.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/balance.1.html">
      <span itemprop="name">balance: A simple tcp proxy with load balancing and failover mechanisms.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/balance/">
      <span itemprop="name">balance</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/balance.1.html">
      <span itemprop="name">balance: A simple tcp proxy with load balancing and failover mechanisms.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>balance</strong> [ <strong>-b addr</strong> ] [ <strong>-B addr</strong> ] [ <strong>-t sec</strong> ] [ <strong>-T sec</strong> ] [ <strong>-adfpHM6</strong> ] port host1[:port1[:maxc]] [!|%] [ ... hostn[:portn[:maxc]]]</p><p><strong>balance</strong> [ <strong>-b addr</strong> ] <strong>-i</strong> [ <strong>-d</strong> ] [ <strong>-M</strong> ] port</p><p><strong>balance</strong> [ <strong>-b addr</strong> ] <strong>-c cmd</strong> [ <strong>-d</strong> ] [ <strong>-M</strong> ] port</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><em>Balance</em> is a simple, generic "userland" TCP proxy, which allows simple round-robin load balancing and graceful failover between several destination servers.</p><p><em>Balance</em> supports IPv6 on the listening side which makes it a very useful tool for IPv6 migration of IPv4 only services and servers.</p><p><em>Balance</em> is available at http://balance.sourceforge.net.</p><p><em>Definitions:</em> A possible destination consisting of a host address and a port is called a "channel". A channel is member of a "channel group". Channels are numbered in a group starting with 0.  Groups are numbered starting with 0, which is the initial default group.</p><p><em>Balance</em> accepts connections on the given port and forwards them to the supplied channels. At least one channel (in the default group) must be specified. If there are two or more channels specified in a group <em>balance</em> performs a simple round-robin load balancing between the channels.</p><p><em>Balance</em> allows the definition of further channel groups. The connection scheme works as follows: <em>balance</em> tries first to establish a connection to a channel in the first group (0), performing the standard round-robin load balancing scheme. If no channel in this group is available, <em>balance</em> proceeds with the next higher channel group. Groups are simply separated with a "!" at the command line at startup and can be controlled interactively with the "group" command.</p><p>A "%" instead of a "!" as a group separator declares the previous group to be of type "hash". This means that instead of a round-robin algorithm, a hash distribution based on the client ip address is used to determine the destination channel. This allows connecting one client always to the same server (e.g. balancing http sessions to a single server).</p><p>Hosts may be specified either by hostname or by IP address. Ports may be specified either by name (as listed in /etc/services) or numerically. If no port is specified in a destination, the destination port defaults to the source port that <em>balance</em> controls.</p><p><em>Balance</em> allows the specification of the maximum number of connections per channel. This parameter can be optionally added after the port specification separated by a colon (":"). If a maximum number of connections is specified a channel will only be used for this maximum number of simultaneous connections. A maxc value of 0 denotes an unlimited number of connections. This is the initial default value of a channel.</p><p>The maximum number of groups and channels <em>balance</em> can handle is specified at compile time and is initially 16 channels in 16 groups.</p><p>Failover to another destination (a "channel") occurs if the connection is refused on the current channel or if the connect timeout is reached trying to establish a connection. If all possible destinations (channels) currently fail, the client connection to balance is closed.</p><p><em>Balance</em> accepts the following options:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>6</strong></p>
  </dt>
  <dd>
    <p>Forces to bind on IPv6 socket by setting hints.ai_family to AF_INET6.</p>
  </dd>
  <dt>
    <p><strong>a</strong></p>
  </dt>
  <dd>
    <p>Enable autodisable option: A channel needs to be manually re-enabled after a failure.</p>
  </dd>
  <dt>
    <p><strong>b</strong></p>
  </dt>
  <dd>
    <p>Bindhost: <em>Balance</em> binds to the specified host (or address) for listen() instead to INADDR_ANY.</p>
  </dd>
  <dt>
    <p><strong>B</strong></p>
  </dt>
  <dd>
    <p>Bindhost: <em>Balance</em> binds to the specified host (or address) for outgoing connections (the connection will be initiated from this address).</p>
  </dd>
  <dt>
    <p><strong>c</strong></p>
  </dt>
  <dd>
    <p>Command: allows to send a command to the balance master process (see interactive mode)</p>
  </dd>
  <dt>
    <p><strong>d</strong></p>
  </dt>
  <dd>
    <p>Debug: <em>Balance</em> outputs debugging and tracing information messages on stderr.</p>
  </dd>
  <dt>
    <p><strong>H</strong></p>
  </dt>
  <dd>
    <p>Hashfailover: <em>Balance</em> does failover to next node even if hash is used.</p>
  </dd>
  <dt>
    <p><strong>F</strong></p>
  </dt>
  <dd>
    <p>Foreground: tells <em>balance</em> to stay in foreground. This might be useful for testing and debugging since <em>balance</em> can be stopped in that mode using ^C (or other interrupt character).</p>
  </dd>
  <dt>
    <p><strong>M</strong></p>
  </dt>
  <dd>
    <p>Use memory mapping for IPC instead of shared memory</p>
  </dd>
  <dt>
    <p><strong>i</strong></p>
  </dt>
  <dd>
    <p>Interactive Control: <em>Balance</em> connects to the running instance defined by local port and bind address via shared memory and allows to control the behaviour of it using a command line interface. The access permission using this interface are determined by the access restrictions of the shared memory segment in effect. <em>help or ?</em> prints out a short command overview, <em>assign</em> allows to change the host_port assignment of a channel (only if disabled), <em>create</em> allows to establish a new destination definition (channel) consisting of host and port in the current group, <em>disable</em> disables a channel in the current group, <em>enable</em> enables a channel again in the current group, <em>group</em> changes the current group in interactive mode where all following commands are targeted, <em>hash</em> changes the current group to be of type "Hash", <em>help</em> prints out online help informations, <em>kill</em> shuts down the master process and exits interactive mode, <em>maxc &lt;channel&gt; &lt;maxc&gt;</em> sets the maximum number of connection ot the channel (0 means infinite), <em>mrtg-bytes &lt;group&gt; &lt;channel&gt;</em> prints out the bytes received/sent in MRTG compatible format (intended to be called with -c automatically by MRTG), <em>mrtg-conns &lt;group&gt; &lt;channel&gt;</em> prints out the total connections in MRTG compatible format (intended to be called with -c automatically by MRTG), <em>quit</em> exits the interactive mode, <em>reset</em> resets the byte counters of a channel, <em>rr</em> changes the current group to be of type "Round Robin", <em>show</em> shows an overview and the status of all channels including the incoming and outgoing transfer volume in bytes. The output is sorted by groups. Additionally the current connections (c) and the maximum allowed connections (maxc) are printed, <em>version</em> prints out the version and MAXGROUPS and MAXCHANNELS constants at compile time.</p>
  </dd>
  <dt>
    <p><strong>p</strong></p>
  </dt>
  <dd>
    <p>Packetdump: <em>Balance</em> shows all incoming and outgoing data on stdout using a simple always readable external representation of data. This might be useful for debugging and protocol analysis.</p>
  </dd>
  <dt>
    <p><strong>t</strong></p>
  </dt>
  <dd>
    <p>Connect Timeout: the default timeout trying to establish a connection to any destination can be changed using this option. The default timeout after which a destination is regarded to be currently inaccessible is 5 seconds.</p>
  </dd>
  <dt>
    <p><strong>T</strong></p>
  </dt>
  <dd>
    <p>Select Timeout: Timeout for select(), default = 0 (never). This feature is currently untested.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance smtp host1.test.net host2.test.net</strong></p>
  </dt>
  <dd>
    <p>Connection to the local SMTP port will be forwarded alterating to the SMTP port on host1 and host2. <em>Balance</em> runs automatically in background.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance -b 2001:DB8::1 80 10.1.1.1 10.1.1.2</strong></p>
  </dt>
  <dd>
    <p><em>Balance</em> binds on port 80 of the local IPv6 IP address 2001:DB8::1 and distributes connections to the IPv4 addresses 10.1.1.1 and 10.1.1.2.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance -b ::ffff:10.1.1.3 80 10.1.1.1 10.1.1.2</strong></p>
  </dt>
  <dd>
    <p><em>Balance</em> binds on port 80 of the local IPv4 IP address 10.1.1.3 (provided in IPv6 notation) and distributes connections to the IPv4 addresses 10.1.1.1 and 10.1.1.2.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance -fp imap mailserver</strong></p>
  </dt>
  <dd>
    <p>Connections to the local IMAP port will always be forwarded to the host "mailserver". <em>Balance</em> stays in foreground and all data is printed in readable format on stdout.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance -f 8888 host1 10.1.1.1:8000</strong></p>
  </dt>
  <dd>
    <p>Connections to the local port 8888 are forwarded alternating to host1, port 8888 and the host 10.1.1.1, port 8000. <em>Balance</em> stays in foreground connected to the "controlling tty".</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance imap mailserver1::16 ! mailserver2</strong></p>
  </dt>
  <dd>
    <p>Two groups are specified, each containing one channel member. First up to 16 simultaneous connections are forwarded to "mailserver1". As soon as they are consumed, <em>balance</em> proceeds with the next group (1) which will consume all remaining connections forwarding them to the imap ort on "mailserver2".</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance pop3 host1 host2 host3 ! failover1</strong></p>
  </dt>
  <dd>
    <p><em>Balance</em> does round robin load balancing for the three hosts in the default group 0 for pop3 services. If all three hosts in group 0 fail, all connections are then forwarded to the host "failover1".</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance telnet target.munich.net::1</strong></p>
  </dt>
  <dd>
    <p>Here <em>balance</em> is used to restrict all connections to exactly one at a time forwarding the telnet port.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><strong>$ balance 8888 localhost::12 ! localhost::4 ! localhost::2 localhost::2 ! localhost:25</strong></p>
  </dt>
  <dd>
    <p>This is a simple test, forming 5 groups where balance is self referencing its own services 20 times. This is simply a test which definitely can be tried at home.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>In case that <em>balance</em> is not able to forward the connection to any destination the inital connection to balance is always first accepted and then closed again immediately. This is not in every case the behaviour that would have been seen directly on the destination host.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Thomas Obermair, Inlab Software GmbH (obermair@acm.org)</p><p>Copyright (c) 2000-2009,2010 by Thomas Obermair (obermair@acm.org) and Inlab Software GmbH (http://www.inlab.de), Gruenwald, Germany. All rights reserved.</p><p>Balance is released under the GNU GENERAL PUBLIC LICENSE, see the file COPYING in the source code distribution.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="bake.php.1.html"><span aria-hidden="true">&larr;</span> bake.php.1: Generates skeleton cakephp applications</a></li>
   <li class="next"><a href="balls.1.html">balls.1: Preprocessor for space-filling models in raster3d molecular graphics package <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
