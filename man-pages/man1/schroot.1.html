<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>schroot: Securely enter a chroot environment</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Securely enter a chroot environment">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="schroot (1) manual">
  <meta name="twitter:description" content="Securely enter a chroot environment">
  <meta name="twitter:image" content="https://www.carta.tech/images/schroot-schroot-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/schroot.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="schroot (1) manual" />
  <meta property="og:description" content="Securely enter a chroot environment" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/schroot-schroot-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">schroot<small> (1)</small></h1>
        <p class="lead">Securely enter a chroot environment</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/schroot.1.html">
      <span itemprop="name">schroot: Securely enter a chroot environment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/schroot/">
      <span itemprop="name">schroot</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/schroot.1.html">
      <span itemprop="name">schroot: Securely enter a chroot environment</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>schroot</strong> [<strong>-h</strong>\[or]<strong>--help</strong> \[or] <strong>-V</strong>\[or]<strong>--version</strong>  \[or] <strong>-l</strong>\[or]<strong>--list</strong> \[or] <strong>-i</strong>\[or]<strong>--info</strong>  \[or] <strong>--config</strong> \[or] <strong>--location</strong>  \[or] <strong>--automatic-session</strong>  \[or] <strong>-b</strong>\[or]<strong>--begin-session</strong> \[or] <strong>--recover-session</strong>  \[or] <strong>-r</strong>\[or]<strong>--run-session</strong> \[or] <strong>-e</strong>\[or]<strong>--end-session</strong>] [<strong>-f</strong>\[or]<strong>--force</strong>] [<strong>-n </strong><em>session-name</em><strong></strong>\[or]<strong>--session-name=</strong><em>session-name</em><strong></strong>] [<strong>-d </strong><em>directory</em><strong></strong>\[or]<strong>--directory=</strong><em>directory</em><strong></strong>] [<strong>-u </strong><em>user</em><strong></strong>\[or]<strong>--user=</strong><em>user</em><strong></strong>] [<strong>-p</strong>\[or]<strong>--preserve-environment</strong>] [<strong>-s </strong><em>shell</em><strong></strong>\[or]<strong>--shell=</strong><em>shell</em><strong></strong>] [<strong>-q</strong>\[or]<strong>--quiet</strong> \[or] <strong>-v</strong>\[or]<strong>--verbose</strong>] [<strong>-c </strong><em>chroot</em><strong></strong>\[or]<strong>--chroot=</strong><em>chroot</em><strong></strong>  \[or] [<strong>--all</strong> \[or] <strong>--all-chroots</strong> \[or] <strong>--all-source-chroots</strong> \[or] <strong>--all-sessions</strong>] [<strong>--exclude-aliases</strong>]] [<strong>-o</strong>\[or]<strong>--option=</strong><em>key=value</em><strong></strong>] [<strong>--</strong>] [<strong>COMMAND</strong> [ <strong>ARG1</strong> [ <strong>ARG2</strong> [ <strong>ARGn</strong>]]]]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>schroot</strong> allows the user to run a command or a login shell in a chroot environment.  If no command is specified, a login shell will be started in the user's current working directory inside the chroot.</p><p>The command is a program, plus as many optional arguments as required.  Each argument may be separately quoted.</p><p>The directory the command or login shell is run in depends upon the context. See <em>--directory</em> option below for a complete description.</p><p>All chroot usage will be logged in the system logs.  Under some circumstances, the user may be required to authenticate themselves; see the section \[lq]<em>Authentication</em>\[rq], below.</p><p>If no chroot is specified, the chroot name or alias \[oq]default\[cq] will be used as a fallback.  This is equivalent to \[lq]--chroot=default\[rq].</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OVERVIEW</h2>
        <div class="sectioncontent">
<p>There is often a need to run programs in a virtualised environment rather than on the host system directly.  Unlike other virtualisation systems such as <strong>kvm</strong> or <strong>Xen</strong>, schroot does not virtualise the entire system; it only virtualises the filesystem, and some parts of the filesystem may still be shared with the host.  It is therefore fast, lightweight and flexible. However, it does not virtualise other aspects of the system, such as shared memory, networking, devices etc., and so may be less secure than other systems, depending upon its intended use.  Some examples of existing uses for schroot include:</p>
<dl class='dl-vertical'>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Running an untrusted program in a sandbox, so that it can't interfere with files on the host system; this may also be used to limit the damage a compromised service can inflict upon the host</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Using a <em>defined</em> or <em>clean</em> environment, to guarantee the reproducibility and integrity of a given task</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Using different versions of an operating system, or even different operating systems altogether, e.g. different GNU/Linux distributions</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Running 32-bit programs using a 32-bit chroot on a 64-bit host system</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Automatic building of Debian packages using <a href="../man1/sbuild.1.html"><strong>sbuild</strong>(1)</a>, which builds each package in a pristine chroot snapshot when using LVM snapshots or unions</p>
  </dd>
  <dt>
    \[bu]
  </dt>
  <dd>
    <p>Supporting multiple system images in a cluster setup, where modifying the base image is time-consuming and/or supporting all the required configurations needed by users is difficult: different chroots can support all the different configurations required, and cluster users may be given access to the chroots they need (which can include root access for trusted users to maintain their own images)</p>
  </dd>

</dl>
<p>A chroot may be used directly as root by running <a href="../man8/chroot.8.html"><strong>chroot</strong>(8)</a>, but normal users are not able to use this command.  <strong>schroot</strong> allows access to chroots for normal users using the same mechanism, but with several additional features.  While schroot uses a directory as a chroot just like <a href="../man8/chroot.8.html"><strong>chroot</strong>(8)</a>, it does not require this to be a regular directory in the filesystem.  While this is the default, the chroot can also be created from a file, a filesystem, including LVM and Btrfs snapshots and loopback mounts, or composed of a unionfs overlay.  Being user-extensible, the scope for creating chroots from different sources is limited only by your imagination.  schroot performs permissions checking and allows additional automated setup of the chroot environment, such as mounting additional filesystems and other configuration tasks.  This automated setup is done through the action of <em>setup scripts</em> which may be customised and extended to perform any actions required.  Typical actions include mounting the user's home directory, setting up networking and system databases, and even starting up services.  These are again entirely customisable by the admin.  The setup scripts are run for all types of chroot, with the exception of the \[oq]plain\[cq] type, the simplest chroot type, offering no automated setup features at all.  The configuration of schroot is covered in more detail in <a href="../man5/schroot.conf.5.html"><strong>schroot.conf</strong>(5)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p><strong>schroot</strong> accepts the following options:</p><h3>Actions</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-h</strong>, <strong>--help</strong></p>
  </dt>
  <dd>
    <p>Show help summary.</p>
  </dd>
  <dt>
    <p><strong>-V</strong>, <strong>--version</strong></p>
  </dt>
  <dd>
    <p>Print version information.</p>
  </dd>
  <dt>
    <p><strong>-l</strong>, <strong>--list</strong></p>
  </dt>
  <dd>
    <p>List all available chroots.</p>
  </dd>
  <dt>
    <p><strong>-i</strong>, <strong>--info</strong></p>
  </dt>
  <dd>
    <p>Print detailed information about the specified chroots.</p>
  </dd>
  <dt>
    <p><strong>--config</strong></p>
  </dt>
  <dd>
    <p>Print configuration of the specified chroots.  This is useful for testing that the configuration in use is the same as the configuration file.  Any comments in the original file will be missing.</p>
  </dd>
  <dt>
    <p><strong>--location</strong></p>
  </dt>
  <dd>
    <p>Print location (path) of the specified chroots.  Note that chroot types which can only be used within a session will not have a location until they are active.</p>
  </dd>

</dl>

<h3>General options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-q</strong>, <strong>--quiet</strong></p>
  </dt>
  <dd>
    <p>Print only essential messages.</p>
  </dd>
  <dt>
    <p><strong>-v</strong>, <strong>--verbose</strong></p>
  </dt>
  <dd>
    <p>Print all messages.</p>
  </dd>

</dl>

<h3>Chroot selection</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-c</strong>, <strong>--chroot=</strong><em>chroot</em><strong></strong></p>
  </dt>
  <dd>
    <p>Specify a chroot or active session to use.  This option may be used multiple times to specify more than one chroot, in which case its effect is similar to <em>--all</em>.  The chroot name may be prefixed with a <em>namespace</em>; see the section \[lq]<em>Chroot Namespaces</em>\[rq], below.</p>
  </dd>
  <dt>
    <p><strong>-a</strong>, <strong>--all</strong></p>
  </dt>
  <dd>
    <p>Select all chroots, source chroots and active sessions.  When a command has been specified, the command will be run in all chroots, source chroots and active sessions.  If <em>--info</em> has been used, display information about all chroots.  This option does not make sense to use with a login shell (run when no command has been specified).  This option is equivalent to \[lq]--all-chroots --all-source-chroots --all-sessions\[rq].</p>
  </dd>
  <dt>
    <p><strong>--all-chroots</strong></p>
  </dt>
  <dd>
    <p>Select all chroots.  Identical to <em>--all</em>, except that source chroots and active sessions are not considered.</p>
  </dd>
  <dt>
    <p><strong>--all-sessions</strong></p>
  </dt>
  <dd>
    <p>Select all active sessions.  Identical to <em>--all</em>, except that chroots and source chroots are not considered.</p>
  </dd>
  <dt>
    <p><strong>--all-source-chroots</strong></p>
  </dt>
  <dd>
    <p>Select all source chroots.  Identical to <em>--all</em>, except that chroots and sessions are not considered.</p>
  </dd>
  <dt>
    <p><strong>--exclude-aliases</strong></p>
  </dt>
  <dd>
    <p>Do not select aliases in addition to chroots.  This ensures that only real chroots are selected, and are only listed once.</p>
  </dd>

</dl>

<h3>Chroot environment</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-d</strong>, <strong>--directory=</strong><em>directory</em><strong></strong></p>
  </dt>
  <dd>
    <p>Change to <em>directory</em> inside the chroot before running the command or login shell.  If <em>directory</em> is not available, schroot will exit with an error status.</p><ul>
<li><p>The default behaviour is as follows (all directory paths are inside the chroot).  A login shell is run in the current working directory.  If this is not available, it will try $HOME (when <em>--preserve-environment</em> is used), then the user's home directory, and <em>/</em> inside the chroot in turn. A command is always run in the current working directory inside the chroot.  If none of the directories are available, schroot will exit with an error status.</p></li>
</ul>
  </dd>
  <dt>
    <p><strong>-u</strong>, <strong>--user=</strong><em>user</em><strong></strong></p>
  </dt>
  <dd>
    <p>Run as a different user.  The default is to run as the current user.  If required, the user may be required to authenticate themselves with a password. For further information, see the section \[lq]<em>Authentication</em>\[rq], below.</p>
  </dd>
  <dt>
    <p><strong>-p</strong>, <strong>--preserve-environment</strong></p>
  </dt>
  <dd>
    <p>Preserve the user's environment inside the chroot environment.  The default is to use a clean environment; this option copies the entire user environment and sets it in the session.  The environment variables allowed are subject to certain restrictions; see the section \[lq]<em>Environment</em>\[rq], below.</p>
  </dd>
  <dt>
    <p><strong>-s</strong>, <strong>--shell=</strong><em>shell</em><strong></strong></p>
  </dt>
  <dd>
    <p>Use <em>shell</em> as the login shell.  When running a login shell a number of potential shells will be considered, in this order: the command in the SHELL environment variable (if <em>--preserve-environment</em> is used, or <em>preserve-environment</em> is enabled), the user's shell in the \[oq]passwd\[cq] database, <em>/bin/bash</em> and finally <em>/bin/sh</em>.  This option overrides this list, and will use the shell specified.  This option also overrides the <em>shell</em> configuration key, if set.</p>
  </dd>
  <dt>
    <p><strong>-o</strong>, <strong>--option=</strong><em>key=value</em><strong></strong></p>
  </dt>
  <dd>
    <p>Set an option.  The value of selected configuration keys in <em>schroot.conf</em> may be modified using this option.  The key must be present in the <em>user-modifiable-keys</em> configuration key in <em>schroot.conf</em>, or additionally the <em>user-modifiable-keys</em> key if running as (or switching to) the root user.  The key and value set here will be set in the environment of the setup scripts, and may hence be used to customise the chroot on a per-session basis.</p>
  </dd>

</dl>

<h3>Session actions</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--automatic-session</strong></p>
  </dt>
  <dd>
    <p>Begin, run and end a session automatically.  This is the default action, so does not require specifying in normal operation.</p>
  </dd>
  <dt>
    <p><strong>-b</strong>, <strong>--begin-session</strong></p>
  </dt>
  <dd>
    <p>Begin a session.  A unique session identifier (session ID) is returned on standard output.  The session ID is required to use the other session options. Note that the session identifier may be specified with the <em>--session-name</em> option.</p>
  </dd>
  <dt>
    <p><strong>--recover-session</strong></p>
  </dt>
  <dd>
    <p>Recover an existing session.  If an existing session has become unavailable, for example becoming unmounted due to a reboot, this option will make the session available for use again, for example by remounting it.  The session ID is specified with the <em>--chroot</em> option.</p>
  </dd>
  <dt>
    <p><strong>-r</strong>, <strong>--run-session</strong></p>
  </dt>
  <dd>
    <p>Run an existing session.  The session ID is specified with the <em>--chroot</em> option.</p>
  </dd>
  <dt>
    <p><strong>-e</strong>, <strong>--end-session</strong></p>
  </dt>
  <dd>
    <p>End an existing session.  The session ID is specified with the <em>--chroot</em> option.</p>
  </dd>

</dl>

<h3>Session options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>-n</strong>, <strong>--session-name=</strong><em>session-name</em><strong></strong></p>
  </dt>
  <dd>
    <p>Name a session.  The specified <em>session-name</em> replaces the default session name containing an automatically-generated session ID.  The session name must not contain a namespace qualifier, since sessions are always created within the \[oq]session:\[cq] namespace.  The session name is also subject to the chroot naming restrictions documented in <a href="../man5/schroot.conf.5.html"><strong>schroot.conf</strong>(5)</a>.</p>
  </dd>
  <dt>
    <p><strong>-f</strong>, <strong>--force</strong></p>
  </dt>
  <dd>
    <p>Force a session operation, even if it would otherwise fail.  This may be used to forcibly end a session, even if it has active users.  This does not guarantee that the session will be ended cleanly; filesystems may not be unmounted, for example.</p>
  </dd>

</dl>

<h3>Separator</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--</strong></p>
  </dt>
  <dd>
    <p>End of options.  Used to indicate the end of the schroot options; any following options will be passed to the command being run, rather than to schroot.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHENTICATION</h2>
        <div class="sectioncontent">
<p>If the user is not an allowed user, or a member of the allowed groups (or if changing to root, the allowed root users or allowed root groups) for the specified chroot(s), permission will be immediately denied.  If switching users, and the user running the command has access, the user will be required to authenticate themselves using the credentials of the user being switched to.</p><p>On systems supporting Pluggable Authentication Modules (PAM), schroot will use PAM for authentication and authorisation of users.  If and when required, schroot will prompt for a password.  If PAM is not available, all authentication will automatically fail (user switching is <em>not</em> supported without PAM).</p><p>Note that when PAM is in use, the root user is not granted any special privileges by default in the program.  However, the default PAM configuration permits root to log in without a password (<em>pam_rootok.so</em>), but this may be disabled to prevent root from accessing any chroots except if specifically permitted.  In such a situation, root must be added to the allowed users or groups as for any other user or group.  If PAM is not available, the root user will be permitted to access all chroots, even when not explicitly granted access.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CHROOT NAMESPACES</h2>
        <div class="sectioncontent">
<h3>Namespace basics</h3>
<p>There are three different types of chroot: regular chroots, source chroots and session chroots.  These different types of chroot are separated into different <em>namespaces</em>.  A namespace is a prefix to a chroot name.  Currently there are three namespaces: \[oq]chroot:\[cq], \[oq]source:\[cq] and \[oq]session:\[cq].  Use <em>--list --all</em> to list all available chroots in all namespaces.  Because \[oq]:\[cq] is used as the separator between namespace and chroot names, it is not permitted to use this character in chroot names.</p><p>Depending upon the action you request schroot to take, it may look for the chroot in one of the three namespaces, or a particular namespace may be specified.  For example, a chroot named \[lq]sid\[rq] is actually named \[lq]chroot:sid\[rq] if the namespace is included, but the namespace may be omitted for most actions.</p>
<h3>Source chroots</h3>
<p>Some chroot types, for example LVM snapshots and Btrfs snapshots, provide session-managed copy-on-write snapshots of the chroot.  These also provide a <em>source chroot</em> to allow easy access to the filesystem used as a source for snapshotting.  These are regular chroots as well, just with the snapshotting disabled.  For a chroot named \[lq]sid-snapshot\[rq] (i.e. with a fully qualified name of \[lq]chroot:sid-snapshot\[rq]), there will also be a corresponding source chroot named \[lq]source:sid-snapshot\[rq].  Earlier versions of schroot provided source chroots with a \[oq]-source\[cq] suffix. These are also provided for compatibility.  In this example, this would be called \[lq]chroot:sid-snapshot-source\[rq].  These compatibility names will be dropped in a future version, so programs and scripts should switch to using the namespace-qualified names rather than the old suffix.</p>
<h3>Session chroots</h3>
<p>All sessions created with <em>--begin-session</em> are placed within the \[oq]session:\[cq] namespace.  A session named with <em>--session-name</em> may have any name, even the same name as the chroot it was created from, providing that it is unique within this namespace.  This was not permitted in previous versions of schroot which did not have namespaces.</p>
<h3>Actions and default namespaces</h3>
<p>All actions use \[oq]chroot:\[cq] as the default namespace, with some session actions being the exception.  <em>--run-session</em>, <em>--recover-session</em> and <em>--end-session</em> use \[oq]session:\[cq] as the default namespace instead, since these actions work on session chroots. The upshot is that the namespace is usually never required except when you need to work with a chroot in a namespace other than the default, such as when using a source chroot.  To make chroot selection unambiguous, it is always possible to use the full name including the namespace, even when not strictly required.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PERFORMANCE</h2>
        <div class="sectioncontent">
<p>Performance on some filesystems, for example Btrfs, is bad when running dpkg due to the amount of fsync operations performed.  This may be mitigated by installing the eatmydata package and then adding eatmydata to the <em>command-prefix</em> configuration key, which disables all fsync operations.  Note that this should only be done in snapshot chroots where data loss is not an issue.  This is useful when using a chroot for package building, for example.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIRECTORY FALLBACKS</h2>
        <div class="sectioncontent">
<p>schroot will select an appropriate directory to use within the chroot based upon whether an interactive login shell will be used, or a command invoked, and additionally if the <em>--directory</em> option is used.  In the case of running commands directly, or explicitly specifying a directory, only one directory will be used for safety and consistency, while for a login shell several possibilities may be tried.  The following subsections list the fallback sequence for each case.  CWD is the current working directory, DIR is the directory specified with <em>--directory</em>.</p><h3>Login shell</h3>
<table class="table table-striped">
<tr>
<th>Transition</th></tr>

<tr>
<td>(Host \[-&gt;] Chroot)</td></tr>

<tr>
<td>Comment</td></tr>

<tr>
<td>CWD \[-&gt;] CWD</td></tr>

<tr>
<td>Normal behaviour (if <em>--directory</em> is not used)</td></tr>

<tr>
<td>CWD \[-&gt;] $HOME</td></tr>

<tr>
<td>If CWD is nonexistent and --preserve-environment is used</td></tr>

<tr>
<td>CWD \[-&gt;] passwd pw_dir</td></tr>

<tr>
<td>If CWD is nonexistent (or --preserve-environment is used and no $HOME exists)</td></tr>

<tr>
<td>CWD \[-&gt;] /</td></tr>

<tr>
<td>None of the above exist</td></tr>

<tr>
<td><strong>FAIL</strong></td></tr>

<tr>
<td>If / is nonexistent</td></tr>
</table>
<h3>Command</h3>
<table class="table table-striped">
<tr>
<th>Transition</th></tr>

<tr>
<td>(Host \[-&gt;] Chroot)</td></tr>

<tr>
<td>Comment</td></tr>

<tr>
<td>CWD \[-&gt;] CWD</td></tr>

<tr>
<td>Normal behaviour (if <em>--directory</em> is not used)</td></tr>

<tr>
<td><strong>FAIL</strong></td></tr>

<tr>
<td>If CWD is nonexistent</td></tr>
</table><p>No fallbacks should exist under any circumstances.</p>
<h3>--directory used</h3>
<table class="table table-striped">
<tr>
<th>Transition</th></tr>

<tr>
<td>(Host \[-&gt;] Chroot)</td></tr>

<tr>
<td>Comment</td></tr>

<tr>
<td>CWD \[-&gt;] DIR</td></tr>

<tr>
<td>Normal behaviour</td></tr>

<tr>
<td><strong>FAIL</strong></td></tr>

<tr>
<td>If DIR is nonexistent</td></tr>
</table><p>No fallbacks should exist under any circumstances.</p>
<h3>Debugging</h3>
<p>Note that <em>--debug=notice</em> will show the internal fallback list computed for the session.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<h3>List available chroots</h3>

<pre>
% <strong>schroot -l</strong>\[CR]
chroot:default
chroot:etch
chroot:sid
chroot:testing
chroot:unstable
</pre>

<h3>Get information about a chroot</h3>

<pre>
% <strong>schroot -i -c sid</strong>\[CR]
  \[em]\[em]\[em] Chroot \[em]\[em]\[em]
  Name                   sid
  Description            Debian sid (unstable)
  Type                   plain
  Priority               3
  Users                  rleigh
  Groups                 sbuild
  Root Users
  Root Groups            sbuild
  Aliases                unstable unstable-sbuild unstable-p
owerpc-sbuild
  Environment Filter     ^(BASH_ENV|CDPATH|ENV|HOSTALIASES|I&#92;
FS|KRB5_CONFIG|KRBCONFDIR|KRBTKFILE|KRB_CONF|LD_.*|LOCALDOMA&#92;
IN|NLSPATH|PATH_LOCALE|RES_OPTIONS|TERMINFO|TERMINFO_DIRS|TE&#92;
RMPATH)$
  Run Setup Scripts      true
  Script Configuration   script-defaults
  Session Managed        true
  Personality            linux32
  Location               /srv/chroot/sid
</pre>
<p>Use <em>--all</em> or <em>-c</em> multiple times to use all or multiple chroots, respectively.</p>
<h3>Running commands in a chroot</h3>

<pre>
% <strong>schroot -c sid /bin/ls</strong>\[CR]
[sid chroot] Running command: \[lq]/bin/ls\[rq]
CVS          sbuild-chroot.c   sbuild-session.h  schroot.conf.5
Makefile     sbuild-chroot.h   schroot.1         schroot.conf.5.in
Makefile.am  sbuild-config.c   schroot.1.in
Makefile.in  sbuild-config.h   schroot.c
pam          sbuild-session.c  schroot.conf
% <strong>schroot -c sid -- ls -1 | head -n 5</strong>\[CR]
[sid chroot] Running command: \[lq]ls -1\[rq]
ABOUT-NLS
AUTHORS
COPYING
ChangeLog
INSTALL
</pre>
<p>Use <em>--</em> to allow options beginning with \[oq]-\[cq] or \[oq]--\[cq] in the command to run in the chroot.  This prevents them being interpreted as options for schroot itself.  Note that the top line was echoed to standard error, and the remaining lines to standard output.  This is intentional, so that program output from commands run in the chroot may be piped and redirected as required; the data will be the same as if the command was run directly on the host system.</p>
<h3>Switching users</h3>

<pre>
% <strong>schroot -c sid -u root</strong>\[CR]
Password:
[sid chroot] (rleigh\[-&gt;]root) Running login shell: \[lq]/bin/bash\[rq]
#
</pre>
<p>If the user \[oq]rleigh\[cq] was in <em>root-users</em> in <em>\*[SCHROOT_CONF]</em>, or one of the groups he belonged to was in <em>root-groups</em>, they would be granted root access without authentication, but the PAM authorisation step is still applied.</p>
<h3>Sessions</h3>
<p>A chroot may be needed to run more than one command.  In particular, where the chroot is created on the fly from an LVM LV or a file on disc, there is a need to make the chroot persistent while a given task (or set of tasks) is performed.  Sessions exist for this purpose.  For simple chroot types such as \[oq]plain\[cq] and \[oq]directory\[cq], sessions may be created but are not strictly necessary.</p><p>Let's start by looking at a session-capable chroot:</p>
<pre>
% <strong>schroot -i -c sid-snap</strong>\[CR]
  \[em]\[em]\[em] Chroot \[em]\[em]\[em]
  Name                   sid-snap
  Description            Debian sid snapshot
  Type                   lvm-snapshot
  Priority               3
  Users                  maks rleigh
  Groups                 sbuild
  Root Users
  Root Groups            root sbuild
  Aliases
  Environment Filter     ^(BASH_ENV|CDPATH|ENV|HOSTALIASES|I&#92;
FS|KRB5_CONFIG|KRBCONFDIR|KRBTKFILE|KRB_CONF|LD_.*|LOCALDOMA&#92;
IN|NLSPATH|PATH_LOCALE|RES_OPTIONS|TERMINFO|TERMINFO_DIRS|TE&#92;
RMPATH)$
  Run Setup Scripts      true
  Script Configuration   script-defaults
  Session Managed        true
  Personality            linux
  Device                 /dev/hda_vg/sid_chroot
  Mount Options          -o atime,async,user_xattr
  Source Users
  Source Groups          root rleigh
  Source Root Users
  Source Root Groups     root rleigh
  LVM Snapshot Options   --size 2G -c 128
</pre>
<p>Note that the <em>Session Managed</em> option is set to \[oq]true\[cq].  This is a requirement in order to use session management, and is supported by most chroot types.  Next, we will create a new session:</p>
<pre>
% <strong>schroot -b -c sid-snap</strong>\[CR]
sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f
</pre>
<p>The session ID of the newly-created session is returned on standard output.  It is common to store it like this:</p>
<pre>
% <strong>SESSION=$(schroot -b -c sid-snap)</strong>\[CR]
% <strong>echo $SESSION</strong>\[CR]
sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f
</pre>
<p>The session may be used just like any normal chroot.  This is what the session looks like:</p>
<pre>
% <strong>schroot -i -c sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f</strong>\[CR]
  \[em]\[em]\[em] Session \[em]\[em]\[em]
  Name                   sid-snap-46195b04-0893-49bf-beb8-0d&#92;
4ccc899f0f
  Description            Debian sid snapshot
  Type                   lvm-snapshot
  Priority               3
  Users                  maks rleigh
  Groups                 sbuild
  Root Users
  Root Groups            root sbuild
  Aliases
  Environment Filter     ^(BASH_ENV|CDPATH|ENV|HOSTALIASES|I&#92;
FS|KRB5_CONFIG|KRBCONFDIR|KRBTKFILE|KRB_CONF|LD_.*|LOCALDOMA&#92;
IN|NLSPATH|PATH_LOCALE|RES_OPTIONS|TERMINFO|TERMINFO_DIRS|TE&#92;
RMPATH)$
  Run Setup Scripts      true
  Script Configuration   script-defaults
  Session Managed        true
  Personality            linux
  Mount Location         /var/lib/schroot/mount/sid-snap-461&#92;
95b04-0893-49bf-beb8-0d4ccc899f0f
  Path                   /var/lib/schroot/mount/sid-snap-461&#92;
95b04-0893-49bf-beb8-0d4ccc899f0f
  Mount Device           /dev/hda_vg/sid-snap-46195b04-0893-&#92;
49bf-beb8-0d4ccc899f0f
  Device                 /dev/hda_vg/sid_chroot
  Mount Options          -o atime,async,user_xattr
  Source Users
  Source Groups          root rleigh
  Source Root Users
  Source Root Groups     root rleigh
  LVM Snapshot Device    /dev/hda_vg/sid-snap-46195b04-0893-&#92;
49bf-beb8-0d4ccc899f0f
  LVM Snapshot Options   --size 2G -c 128
</pre>
<p>Now the session has been created, commands may be run in it:</p>
<pre>
% <strong>schroot -r -c sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f -- &#92;</strong>
  uname -sr\[CR]
I: [sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f chroot] Running &#92;
command: \[lq]uname -sr\[rq]
Linux 2.6.18-3-powerpc
% <strong>schroot -r -c $SESSION -- uname -sr</strong>\[CR]
I: [sid-snap-fe170af9-d9be-4800-b1bd-de275858b938 chroot] Running &#92;
command: \[lq]uname -sr\[rq]
Linux 2.6.18-3-powerpc
</pre>
<p>When all the commands to run in the session have been performed, the session may be ended:</p>
<pre>
% <strong>schroot -e -c sid-snap-46195b04-0893-49bf-beb8-0d4ccc899f0f</strong><strong>\[CR]</strong>
% <strong>schroot -e -c $SESSION</strong><strong>\[CR]</strong>
</pre>
<p>Finally, the session names can be long and unwieldy.  A name may be specified instead of using the automatically generated session ID:</p>
<pre>
% <strong>schroot -b -c sid-snap -n my-session-name</strong><strong>\[CR]</strong>
my-session-name
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TROUBLESHOOTING</h2>
        <div class="sectioncontent">
<p>If something is not working, and it's not clear from the error messages what is wrong, try using the <strong>--debug=</strong><em>level</em> option to turn on debugging messages.  This gives a great deal more information.  Valid debug levels are \[oq]none\[cq], and \[oq]notice\[cq], \[oq]info\[cq], \[oq]warning\[cq] and \[oq]critical\[cq] in order of increasing severity.  The lower the severity level, the more output.</p><p>If you are still having trouble, the developers may be contacted on the mailing list:</p><p>Debian&nbsp;buildd-tools&nbsp;Developers</p><p>&lt;buildd-tools-devel@lists.alioth.debian.org&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>On the <strong>mips</strong> and <strong>mipsel</strong> architectures, Linux kernels up to and including at least version 2.6.17 have broken <a href="../man2/personality.2.html"><strong>personality</strong>(2)</a> support, which results in a failure to set the personality.  This will be seen as an \[lq]Operation not permitted\[rq] (EPERM) error.  To work around this problem, set <em>personality</em> to \[oq]undefined\[cq], or upgrade to a more recent kernel.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ENVIRONMENT</h2>
        <div class="sectioncontent">
<p>By default, the environment is not preserved, and the following environment variables are defined: HOME, LOGNAME, PATH, SHELL, TERM (preserved if already defined), and USER.  The environment variables SCHROOT_COMMAND, SCHROOT_USER, SCHROOT_GROUP, SCHROOT_UID and SCHROOT_GID are set inside the chroot specifying the command being run, the user name, group name, user ID and group ID, respectively.  Additionally, the environment variables SCHROOT_SESSION_ID, SCHROOT_CHROOT_NAME and SCHROOT_ALIAS_NAME specify the session ID, the original chroot name prior to session creation, and the alias used to originally identify the selected chroot, respectively.</p><p>The following, potentially dangerous, environment variables are removed for safety by default: BASH_ENV, CDPATH, ENV, HOSTALIASES, IFS, KRB5_CONFIG, KRBCONFDIR, KRBTKFILE, KRB_CONF, LD_.*, LOCALDOMAIN, NLSPATH, PATH_LOCALE, RES_OPTIONS, TERMINFO, TERMINFO_DIRS, and TERMPATH.  If desired, the <em>environment-filter</em> configuration key will allow the exclusion list to the modified; see <a href="../man5/schroot.conf.5.html"><strong>schroot.conf</strong>(5)</a> for further details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<h3>Configuration files</h3>

<dl class='dl-vertical'>
  <dt>
    <p><em>\*[SCHROOT_CONF]</em></p>
  </dt>
  <dd>
    <p>The system-wide chroot definition file.  This file must be owned by the root user, and not be writable by other.</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_CONF_CHROOT_D]</em></p>
  </dt>
  <dd>
    <p>Additional chroot definitions may be placed in files under this directory. They are treated in exactly that same manner as <em>\*[SCHROOT_CONF]</em>.  Each file may contain one or more chroot definitions.  Note that the files in this directory follow the same naming rules as <a href="../man8/run-parts.8.html"><strong>run-parts</strong>(8)</a> when run with the <em>--lsbsysinit</em> option.</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_CONF_SETUP_D]</em></p>
  </dt>
  <dd>
    <p>The system-wide chroot setup script directories.  See <a href="../man5/schroot-setup.5.html"><strong>schroot-setup</strong>(5)</a>.</p>
  </dd>
  <dt>
    <p><em>/etc/pam.d/schroot</em></p>
  </dt>
  <dd>
    <p>PAM configuration.</p>
  </dd>

</dl>

<h3>System directories</h3>

<dl class='dl-vertical'>
  <dt>
    <p><em>\*[SCHROOT_LIBEXEC_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory containing helper programs used by setup scripts.</p>
  </dd>

</dl>

<h3>Session directories</h3>
<p>Each directory contains a directory or file with the name of each session.  Not all chroot types make use of all the following directories.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>\*[SCHROOT_SESSION_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory containing the session configuration for each active session.</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_MOUNT_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory used to mount the filesystems used by each active session.</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_UNDERLAY_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory used for filesystem union source (underlay).</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_OVERLAY_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory used for filesystem union writeable overlay.</p>
  </dd>
  <dt>
    <p><em>\*[SCHROOT_FILE_UNPACK_DIR]</em></p>
  </dt>
  <dd>
    <p>Directory used for unpacking file chroots.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Roger Leigh.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright &copy; 2005-2012  Roger Leigh &lt;rleigh@debian.org&gt;</p><p><strong>\*[PROGRAM]</strong> is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO schroot&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/dchroot.1.html"><strong>dchroot</strong>(1)</a>, <a href="../man1/sbuild.1.html"><strong>sbuild</strong>(1)</a>, <a href="../man2/chroot.2.html"><strong>chroot</strong>(2)</a>, <a href="../man8/run-parts.8.html"><strong>run-parts</strong>(8)</a>, <a href="../man5/schroot-setup.5.html"><strong>schroot-setup</strong>(5)</a>, <strong>schroot-faq</strong>(7), <a href="../man5/schroot.conf.5.html"><strong>schroot.conf</strong>(5)</a>.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="schism.1.html"><span aria-hidden="true">&larr;</span> schism.1: Music editor</a></li>
   <li class="next"><a href="schubmult.1.html">schubmult.1: Expand a product of two schubert polynomials in the basis of schubert polynomials <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
