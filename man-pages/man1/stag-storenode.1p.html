<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>stag-storenode: Script is for storing data in database</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Script is for storing data in database">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="stag-storenode (1p) manual">
  <meta name="twitter:description" content="Script is for storing data in database">
  <meta name="twitter:image" content="https://www.carta.tech/images/libdbix-dbstag-perl-stag-storenode-1p.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1p/stag-storenode.1p.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="stag-storenode (1p) manual" />
  <meta property="og:description" content="Script is for storing data in database" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/libdbix-dbstag-perl-stag-storenode-1p.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">stag-storenode<small> (1p)</small></h1>
        <p class="lead">Script is for storing data in database</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/stag-storenode.1p.html">
      <span itemprop="name">stag-storenode: Script is for storing data in database</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/libdbix-dbstag-perl/">
      <span itemprop="name">libdbix-dbstag-perl</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/stag-storenode.1p.html">
      <span itemprop="name">stag-storenode: Script is for storing data in database</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<pre>
  stag-storenode.pl -d "dbi:Pg:dbname=mydb;host=localhost" myfile.xml
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This script is for storing data (specified in a nested file format such as \s-1XML\s0 or S-Expressions) in a database. It assumes a database schema corresponding to the tags in the input data already exists.</p><h3>\s-1ARGUMENTS\s0</h3>
<p><em>-d </em><strong>\s-1DBNAME\s0</strong><em></em></p><p>This is either a \s-1DBI\s0 locator or the logical name of a database in the \s-1DBSTAG_DBIMAP_FILE\s0 config file</p><p><em>-user </em><strong>\s-1USER\s0</strong><em></em></p><p>db user name</p><p><em>-password </em><strong>\s-1PASSWORD\s0</strong><em></em></p><p>db user password</p><p><em>-u </em><strong>\s-1UNIT\s0</strong><em></em></p><p>This is the node/element name on which to load; a database loading event will be fired every time one of these elements is parsed; this also constitutes a whole transaction</p><p><em>-c </em><strong>\s-1STAGMAPFILE\s0</strong><em></em></p><p>This is a stag mapping file, indicating which elements are aliases</p><p><em>-p </em><strong>\s-1PARSER\s0</strong><em></em></p><p>Default is xml; can be any stag compatible parser, \s-1OR\s0 a perl module which will parse the input file and fire stag events (see Data::Stag::BaseGenerator)</p><p><em>-t </em><strong>\s-1TRANSFORMER\s0</strong><em></em></p><p>This is the name of a perl module that will perform a transformation on the stag events/XML. See also stag-handle.pl</p><p><em>-noupdate </em><strong>\s-1NODELIST\s0</strong><em></em></p><p>A comma-seperated (no spaces) list of nodes/elements on which no update should be performed if a unique key is found to be present in the \s-1DB\s0</p><p><em>-trust_ids</em></p><p>If this flag is present, the values for primary key values are trusted; otherwise they are assumed to be surrogate internal IDs that should not be used. In this case they will be remapped.</p><p><em>-tracenode </em><strong>\s-1TABLE/COLUMN\s0</strong><em></em></p><p>E.g.</p><p>  -tracenode person/name</p><p>Writes out a line on \s-1STDERR\s0 for every new person inserted/updated</p><p><em>-cache </em><strong>\s-1TABLE\s0</strong><em>=</em><strong>\s-1MODE\s0</strong><em></em></p><p>Can be specified multiple times</p><p>Example:</p><p>  -cache</p><p>                   0: off (default)                    1: memory-caching ON                    2: memory-caching OFF, bulkload ON                    3: memory-caching ON, bulkload ON</p><p>IN-MEMORY \s-1CACHING\s0</p><p>By default no in-memory caching is used. If this is set to 1, then an in-memory cache is used for any particular element. No cache management is used, so you should be sure not to cache elements that will cause memory overloads.</p><p>Setting this will not affect the final result, it is purely an efficiency measure for use with <em>storenode()</em>.</p><p>The cache is indexed by all unique keys for that particular element/table, wherever those unique keys are set</p><p>\s-1BULKLOAD\s0</p><p>If bulkload is used without memory-caching (set to 2), then only INSERTs will be performed for this element. Note that this could potentially cause a unique key violation, if the same element is present twice</p><p>If bulkload is used with memory-caching (set to 3) then only INSERTs will be performed; the unique serial/autoincrement identifiers for those inserts will be cached and used. This means you can have the same element twice. However, the load must take place in one session, otherwise the contents of memory will be lost</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">XML TO DB MAPPING</h2>
        <div class="sectioncontent">
<p>See DBIx::DBStag for details of the actual mapping. Two styles of mapping are allowed: stag-dbxml and XORT-style \s-1XML\s0. You do not have to specify which, they are sufficiently similar that the loader can accept either.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MAKING DATABASE FROM XML FILES</h2>
        <div class="sectioncontent">
<p>It is possible to automatically generate a database schema and populate it directly from \s-1XML\s0 files (or from Stag objects or other Stag compatible files). Of course, this is no substitute for proper relational design, but often it can be necessary to quickly generate databases from heterogeneous \s-1XML\s0 data sources, for the purposes of data mining.</p><p>There are 3 steps involved:</p><p>1. Prepare the input \s-1XML\s0 (for instance, modifying db reserved words). 2. Autogenerate the \s-1CREATE\s0 \s-1TABLE\s0 statements, and make a db from these. 3. Store the \s-1XML\s0 data in the database.</p><h3>Step 1: Prepare input file</h3>
<p>You may need to make modifications to your \s-1XML\s0 before it can be used to make a schema. If your \s-1XML\s0 elements contain any words that are reserved by your \s-1DB\s0 you should change these.</p><p>Any \s-1XML\s0 processing tool (eg \s-1XSLT\s0) can be used. Alternatively you can use the script 'stag-mogrify'</p><p>e.g. to get rid of '-' characters (this is how Stag treates attributes) and to change the element with postgresql reserved word 'date', do this:</p><p>  stag-mogrify.pl -xml -r &apos;s/^date$/moddate/&apos; -r &apos;s/&#92;-//g&apos; data.xml &gt; data.mog.xml</p><p>You may also need to explicitly make elements where you will need linking tables. For instance, if the relationship between 'movie' and 'star' is many-to-many, and your input data looks like this:</p><p>  (movie    (name "star wars")    (star     (name "mark hamill")))</p><p>You will need to *interpose* an element between these two, like this:</p><p>  (movie    (name "star wars")    (movie2star     (star      (name "mark hamill"))))</p><p>you can do this with the -i switch:</p><p>  stag-mogrify.pl -xml -i movie,star,movie2star data.xml &gt; data.mog.xml</p><p>or if you simply do:</p><p>  stag-mogrify.pl -xml -i star data.xml &gt; data.mog.xml</p><p>the mogrifier will simply interpose an element above every time it sees 'star'; the naming rule is to use the two elements with an underscore between (in this case, 'movie_star').</p>
<h3>Step 2: Generating \s-1CREATE\s0 \s-1TABLE\s0 statements</h3>
<p>Use the stag-autoddl.pl script;</p><p>  stag-autoddl.pl data.mog.xml &gt; table.sql</p><p>The default rule is to create foreign keys from the nested element to the outer element; you will want linking tables tobe treated differently (a linking table will point to parent and child elements).</p><p>  stag-autoddl.pl -l movie2star -l star2character data.mog.xml &gt; table.sql</p><p>Once you have done this, load the statements into your db; eg for postgresql (for other databases, use SQL::Translator)</p><p>  psql -a mydb &lt; table.sql</p><p>If something goes wrong, go back to step 1 and sort it out!</p><p>Note that certain rules are followed: ever table generated gets a surrogate primary key of type 'serial'; this is used to generate foreign key relationships. The rule used is primary and foreign key names are the name of the table with the '_id' suffix.</p><p>Feel free to modify the autogenerated schema at this stage (eg add uniqueness constraints)</p>
<h3>Step 3: Store the data in the db</h3>
<p>  stag-storenode.pl -u movie -d &apos;dbi:Pg:mydb&apos; data.mog.xml</p><p>You generally don't need extra metadata here; everything can be infered by introspecting the database.</p><p>The -u|unit switch controls when transactions are committed</p><p>You can omit the -u switch, and every node directly under the top node will be stored. This will also be the transaction unit.</p><p>If this works, you should now be able to retreive \s-1XML\s0 from the database, eg</p><p>  stag-selectall_xml -d &apos;dbi:Pg:mydb&apos; &apos;SELECT * FROM x NATURAL JOIN y&apos;</p>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="stag-selectall_xml.1p.html"><span aria-hidden="true">&larr;</span> stag-selectall_xml.1p: Query all elements from database with an xml output</a></li>
   <li class="next"><a href="subplay.1p.html">subplay.1p: Play subtitles file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
