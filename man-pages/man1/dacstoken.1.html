<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dacstoken: Administer hash-based one-time passwords</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Administer hash-based one-time passwords">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dacstoken (1) manual">
  <meta name="twitter:description" content="Administer hash-based one-time passwords">
  <meta name="twitter:image" content="https://www.carta.tech/images/dacs-dacstoken-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/dacstoken.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dacstoken (1) manual" />
  <meta property="og:description" content="Administer hash-based one-time passwords" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dacs-dacstoken-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dacstoken<small> (1)</small></h1>
        <p class="lead">Administer hash-based one-time passwords</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dacstoken.1.html">
      <span itemprop="name">dacstoken: Administer hash-based one-time passwords</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dacs/">
      <span itemprop="name">dacs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/dacstoken.1.html">
      <span itemprop="name">dacstoken: Administer hash-based one-time passwords</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>dacstoken</strong> [<em>\m[blue]</em><strong>dacsoptions</strong>\m[]\s-2\u[1]\d\s+2] [<strong>-all</strong>] [<strong>-base&nbsp;</strong><strong></strong><em>num</em>] [<strong>-counter</strong>&nbsp;<em>num</em>] [<strong>-digits&nbsp;</strong><strong></strong><em>num</em>]</p><p>[<strong>-disable</strong> | <strong>-enable</strong>] [<strong>-hotp-window&nbsp;</strong><strong></strong><em>num</em>] [<strong>-inkeys&nbsp;</strong><strong></strong><em>item_type</em>]</p><p>[[<strong>-key</strong>&nbsp;<em>keyval</em>] | [<strong>-key-file</strong>&nbsp;<em>filename</em>] | [<strong>-key-prompt</strong>]] [<strong>-mode&nbsp;</strong><strong></strong><em>otp-mode</em>] [<strong>-outkeys&nbsp;</strong><strong></strong><em>item_type</em>]</p><p>[[<strong>-pin</strong>&nbsp;<em>pinval</em>] | [<strong>-pin-file</strong>&nbsp;<em>filename</em>] | [<strong>-pin-prompt</strong>]] [<strong>-pin-constraints</strong>&nbsp;<em>str</em>]</p><p>[<strong>-rnd</strong>] [<strong>-seed&nbsp;</strong><strong></strong><em>str</em>] [<strong>-serial&nbsp;</strong><strong></strong><em>str</em>] [<strong>-totp-delta&nbsp;</strong><strong></strong><em>num</em>] [<strong>-totp-drift&nbsp;</strong><strong></strong><em>nwindows</em>] [<strong>-totp-hash&nbsp;</strong><strong></strong><em>alg</em>]</p><p>[<strong>-totp-timestep&nbsp;</strong><strong></strong><em>secs</em>] [<strong>-vfs&nbsp;</strong><strong></strong><em>vfs_uri</em>] [<em>op-spec</em>] [<em>username</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This program is part of the <strong>DACS</strong> suite.</p><p>The <strong>dacstoken</strong> utility administers <strong>DACS</strong> accounts associated with one-time password (OTP) generating devices (<em>tokens</em>) or software-based clients. Using command line options, it also computes OTP values; token account parameters can be overridden, but accounts are not even required.</p><p>Strong, two-factor authentication can be provided when \m[blue]<strong>dacs_authenticate</strong>\m[]\s-2\u[2]\d\s+2 is configured to use the \m[blue]<strong>local_token_authenticate</strong>\m[]\s-2\u[3]\d\s+2 authentication module or when <strong>dacstoken</strong> is used as a standalone program to validate passwords. Both the HMAC-based one-time password mode (HOTP), based on an event counter and specified by \m[blue]<strong>RFC 4226</strong>\m[]\s-2\u[4]\d\s+2, and the time-based one-time password mode (TOTP), as specified by the \m[blue]<strong>latest IETF Internet-Draft</strong>\m[]\s-2\u[5]\d\s+2 proposal, are supported. \m[blue]<strong>Additional operational modes</strong>\m[]\s-2\u[6]\d\s+2 called OCRA (<em>OATH Challenge-Response Algorithms</em>), described in an IETF Internet-Draft, are not yet fully supported.</p><p><strong>Note</strong></p><p>This version of <strong>dacstoken</strong> incorporates many changes that are not backward compatible with release 1.4.24a and earlier. Some command line flags function differently, and the format of the account file has changed. If you have used this command in earlier releases, please make a backup copy of your token account file and review this manual page carefully before proceeding (note the \m[blue]<strong></strong><strong>-convert</strong> flag\m[]\s-2\u[7]\d\s+2 in particular).</p><p><strong>Important</strong></p><p>No vendor-supplied software is required by <strong>dacstoken</strong> to supply its functionality. The devices currently supported do not need any registration or configuration interaction with vendors and <strong>dacstoken</strong><em>does not interact with vendors&apos; servers or use any proprietary software</em>. Vendor-supplied software may be required to perform initialization or configuration for other token devices, however, and <strong>dacstoken</strong> does not provide such support for them.</p><p>Each token device generally corresponds to exactly one account that is managed by <strong>dacstoken</strong>, although some vendors produce tokens that can support multiple accounts.</p><p>To summarize, this utility:</p><p>creates and administers <strong>DACS</strong> accounts associated with counter-based and time-based one-time passwords</p><p>provides validation and testing functionality</p><p>provides a command line authentication capability</p><p><strong>Security</strong></p><p>Only the <strong>DACS</strong> administrator should be able to successfully run this program from the command line. Because <strong>DACS</strong> keys and configuration files, including the file used to store accounts, must be restricted to the administrator, this will normally be the case, but a careful administrator will set file permissions to deny access to all other users.</p><p><strong>Note</strong></p><p>The \m[blue]<a href="../man8/dacs_token.8.html"><strong>dacs_token</strong>(8)</a></strong>\m[]\s-2\u[8]\d\s+2 web service provides users with limited self-service functionality to set or reset their account PIN and synchronize their token. It also has a demonstration mode to simplify testing and evaluation.</p><h3>PINs (Account Passwords)</h3>
<p>A <strong>dacstoken</strong> account can optionally have a PIN (i.e., a password) associated with it. To authenticate against such an account, a user must provide the one-time password produced by the token <em>and</em> the PIN. The \m[blue]<strong>TOKEN_REQUIRES_PIN</strong>\m[]\s-2\u[9]\d\s+2 configuration directive determines whether a PIN must be provided when creating or importing an account; it does not apply in conjunction with the <strong>-delpin</strong> flag, since only an administrator should be able to perform that function.</p><p>A hash of the PIN is stored in the account record rather than the PIN itself. The same method used by \m[blue]<a href="../man1/dacspasswd.1.html"><strong>dacspasswd</strong>(1)</a></strong>\m[]\s-2\u[10]\d\s+2 and \m[blue]<a href="../man8/dacs_passwd.8.html"><strong>dacs_passwd</strong>(8)</a></strong>\m[]\s-2\u[11]\d\s+2 is applied, and depends on the \m[blue]<strong>PASSWORD_DIGEST</strong>\m[]\s-2\u[12]\d\s+2 and \m[blue]<strong>PASSWORD_SALT_PREFIX</strong>\m[]\s-2\u[13]\d\s+2 directives in effect. If \m[blue]<strong>PASSWORD_DIGEST</strong>\m[]\s-2\u[12]\d\s+2 is configured, that algorithm is used, otherwise a compile-time default (SHA1) is used. If a user forgets the PIN, the old one cannot be recovered so it must either be deleted or a new one must be set.</p><p>Some token devices have a PIN capability built into them. The user must enter a PIN into the device before the device will emit a one-time password. This "device PIN" is completely distinct from the account PIN that is managed by <strong>dacstoken</strong>, and this manual is only concerned with the <strong>dacstoken</strong>PIN. The device PIN should always be used when possible; the <strong>dacstoken</strong>PIN is strongly recommended and is required for two-factor authentication (unless an additional authentication factor is applied in some other way).</p><p>Since only the administrator is allowed to run this command, no restrictions are imposed on the length or quality of the PINs that the administrator supplies; a warning message will be emitted, however, if the password is considered to be weak as determined by the \m[blue]<strong>PASSWORD_CONSTRAINTS</strong>\m[]\s-2\u[14]\d\s+2 directive.</p>
<h3>One-Time Passwords</h3>
<p>Both kinds of one-time password device compute a password value by employing a secure keyed hash algorithm (\m[blue]<strong>RFC 2104</strong>\m[]\s-2\u[15]\d\s+2, \m[blue]<strong>FIPS 198</strong>\m[]\s-2\u[16]\d\s+2). In the counter-based method, the device and server share a secret key and a counter value which are hashed to yield a numerical value displayed in a certain radix with a certain number of digits. Successful authentication requires the device and server to compute matching passwords. Each time the device produces a password, it increments its counter. When the server receives a matching password, it increments its counter. Because it is possible for the two counters to become unsynchronized, the server&apos;s matching algorithm will typically allow a client&apos;s password to fall within a "window" of counter values. The time-based method is similar, the main difference being that the current Unix time (as returned by \m[blue]<strong>time</strong>(3)</strong>\m[]\s-2\u[17]\d\s+2, for instance) is used to establish a "time-step window" that serves as a counter value in the computation of the secure hash. Because the real-time clocks on the device and server may not be sufficiently synchronized, the server&apos;s matching algorithm must also allow a client&apos;s password to fall within some number of time-step windows for these devices.</p><p><strong>Security</strong></p><p>A token may be assigned a permanent secret key (sometimes called an OTP seed) by its manufacturer or the key may be programmable. This secret key is used by the token&apos;s password generation procedure and it is critical that it be kept private. If the token is not programmable, the key is obtained from the vendor (for a HOTP token, typically by providing the device&apos;s serial number and any three consecutive passwords). A record of each mapping from serial number to secret key should be kept in a secure location.</p><p>If the secret key is programmable, as it is likely to be with a software client, it is required to be at least <strong>128</strong> bits in length; a minimum of <strong>160 bits</strong> is recommended. The key is represented by a 16 (or more) character long hexadecimal string. The key should be obtained from a cryptographic-quality source of random bits. Some clients may be capable of generating a suitable key, but you may use \m[blue]<a href="../man1/dacsexpr.1.html"><strong>dacsexpr</strong>(1)</a></strong>\m[]\s-2\u[18]\d\s+2:</p>
<pre>
% dacsexpr -e "random(string, 20)"
"bb2504780e8075a49bd88891b228fc7216ac18d9"
</pre>
<p><strong>Tip</strong></p><p>Tokens can be used for authentication purposes other than computer sign on. For example, by providing an account number, PIN, and token value, customers can quickly be authenticated over the phone, reducing or eliminating the need for expensive and time-consuming security questions.</p><p>One-time password devices and applications have the following operational parameters. These parameters determine the password sequence that is generated. Some operational parameters may be fixed (by the relevant standard or due to the implementation), while others may be partially or completely configurable by the user. Please refer to the references and manufacturers&apos; documentation for details.</p><p>base</p><p>The radix in which passwords are displayed.</p><p>counter</p><p>For HOTP mode only, the current counter value.</p><p>digits</p><p>The number of digits in each one-time password.</p><p>key</p><p>The secret key (OTP seed).</p><p>serial number</p><p>A unique identifier or name for the device.</p><p>time step size</p><p>For TOTP mode only, the width of each time interval, in seconds. The same password will be generated within a given interval; i.e., this is the "lifetime" or validity period of each TOTP password.</p><p>In addition to these parameters, <strong>dacstoken</strong> employs several per-account (i.e., per-device) parameters:</p><p>accept-window</p><p>When validating a HOTP password, the maximum number of passwords to consider after the expected password.</p><p>drift</p><p>For TOTP mode only, the number of seconds by which to adjust the server&apos;s clock forward or backward to better synchronize it with the device. This is used to compensate for tokens or client software whose clocks are not well synchronized with the server&apos;s.</p><p>drift-window</p><p>For TOTP mode only, but analogous to the accept-window, the maximum number of intervals (each of the time step size) to search forward and backward when validating against a given password.</p><p>sync-otps</p><p>For HOTP mode only, the number of consecutive one-time passwords required to synchronize the account with the device.</p><p>username</p><p>The name of the <strong>DACS</strong> account bound to the device.</p><p>Authentication based on one-time password devices has the following advantages:</p><p>Each time a user authenticates, a different password will be generated (with high probability); users cannot therefore jot down "the password" because the password is always changing; users cannot forget their password;</p><p>Once used, a HOTP mode password is immediately "consumed" and is unlikely to be used again for a long time; with suitable configuration parameters, a TOTP mode password automatically "expires" within a relatively short time interval and is unlikely to be used again for a long time;</p><p>If no correction for clock drift is required, a TOTP mode account can have read-only operation;</p><p>Because the password is unlikely to be an easily-guessed number or string, it should be stronger than most user-selected passwords;</p><p>A HOTP token can be the basis of a mutual ("bidirectional") authentication method; the server shows the user his token&apos;s next password to confirm its identity (with both parties advancing their counters), then the client shows the server the next password to confirm his identity;</p><p>Should a key sniffer be installed on the user&apos;s computer, a sniffed password does not do an attacker any good unless a \m[blue]<strong>man-in-the-middle attack</strong>\m[]\s-2\u[19]\d\s+2 is possible; given <em>N</em> consecutive passwords it is still very difficult to compute password <em>N + 1</em> without knowing the secret key;</p><p>It is more difficult for users to share an account (although users might sometimes view this as an inconvenience);</p><p>If a <strong>dacstoken</strong>PIN is assigned to an account and an attacker obtains the account&apos;s token, it is still difficult for the attacker to authenticate without knowing the PIN;</p><p>A quick and immediately effective way to disable an account is by simply seizing a hardware token (e.g., if an employee is fired), although an account can be disabled by this program or using the \m[blue]<strong>revocation list</strong>\m[]\s-2\u[20]\d\s+2;</p><p>In the case of a software client that runs on a mobile device, such as a phone or PDA, users are already carrying the device with them; free clients are available, so there may be no additional cost (note that mobile devices may not offer the same tamper-resistance, durability, key secrecy, clock accuracy, etc. of a hardware token).</p><p>One-time password devices have the following potential disadvantages:</p><p>There is a one-time expense for a hardware token (depending on the purchase volume, you can expect to pay $10-$100 USD each), and there is the possibility of having to replace a lost or broken token, or a token&apos;s battery (some units have a non-replaceable battery, making them disposable after a few years);</p><p>Initial configuration is somewhat more difficult than with other authentication methods, and users unfamiliar with the devices will have to be instructed on their use;</p><p>Although they are typically quite small (e.g., 5cm x 2cm x 1cm) and can be attached to a keychain or lanyard, or kept in a wallet, users may wince at having to carry a token around with them;</p><p>Users can forget to have their token with them or lose the token;</p><p>A mobile device (with a software client) is probably a likely target for theft, more so than a hardware token (hence the extra importance of a PIN for this device);</p><p>Unlike a hardware token where the key is burned into inaccessible, tamper-proof memory, the key configured into a software client is likely to be readable by its owner, making sharing of the account possible;</p><p>Entering a 40 character or longer seed value into a mobile device can be frustrating and prone to error;</p><p>Once a TOTP device generates a password, a new password cannot be generated until the next time-step window, requiring the user to wait 30 (or possibly 60) seconds (e.g., if an entry error is made);</p><p>Some devices are difficult to read in low-light conditions; presbyopic users and those with impaired vision may have difficulty reading the display.</p>
<h3>Accounts</h3>
<p>The accounts managed by <strong>dacstoken</strong> are completely separate from the accounts used by \m[blue]<strong>local_passwd_authenticate</strong>\m[]\s-2\u[21]\d\s+2 or any other <strong>DACS</strong> authentication module.</p><p>Accounts for HOTP and TOTP devices may either be combined or kept separate. If the virtual filestore item type auth_hotp_token is defined, it is only used for accounts associated with HOTP tokens. Similarly, if the virtual filestore item type auth_totp_token is defined, it is only used for accounts associated with TOTP tokens. If either item type is not defined, accounts are accessed through <strong>DACS&apos;s</strong> virtual filestore using item type auth_token. It is assumed that file permissions on the account databases are such that all access is limited to the administrator and <strong>local_token_authenticate</strong>.</p><p>If accounts for the two device types are <em>combined</em>, because each username for an authentication method must be unique, if an individual has both types of token they must be assigned different usernames. So, for example, if Auggie has one HOTP token and one TOTP token, the former might correspond to the username auggie-hotp and the latter to auggie-totp; the sign-on form might include a device-mode input which would allow Auggie to simply type "auggie" in the username field and JavaScript to automatically append the appropriate suffix based on the select device mode. An obvious disadvantage of this configuration is that it results in two different <strong>DACS</strong> identities for the same individual; this would have to be remembered if an access control rule needed to identify Auggie explicitly. If both tokens should map to the same <strong>DACS</strong> identity, the Auth clause could strip the suffix off after successful authentication, but the administrator would then need to beware of the case of two different Auggies, each using a different device type.</p><p>Configuring both the auth_hotp_token and auth_totp_token item types (or just one of them and auth_token) keeps the accounts separate and allows the same username to be used for both types of devices. Auggie could therefore have an account record with the same username for both device types. This approach requires the device mode to be specified when an operation is requested so that the correct item type can be used; this means that users must know which type of device they are using (perhaps by afixing a label to it). Refer to important details regarding \m[blue]<strong></strong><strong>DACS</strong> identities\m[]\s-2\u[22]\d\s+2.</p><p>The <strong>-vfs</strong> is used to configure or reconfigure the auth_token item type.</p><p>Only keys that meet the minimum key length requirement (<strong>16</strong> bytes) may be stored with account information (e.g., with <strong>-set</strong> or <strong>-import</strong>). In other contexts, the requirement is not enforced.</p><p>The secret key is encrypted by <strong>dacstoken</strong> when it is written to the account file. The virtual filestore item type auth_token_keys identifies the encryption keys for <strong>dacstoken</strong> to use; the <strong>-inkeys</strong> and <strong>-outkeys</strong> flags specify alternatives (see \m[blue]<a href="../man1/dacskey.1.html"><strong>dacskey</strong>(1)</a></strong>\m[]\s-2\u[23]\d\s+2). If the encryption keys are lost, the secret keys are practically unrecoverable.</p><p><strong>Important</strong></p><p>If an attacker discovers a secret key, generating usable passwords without possessing the token will not be difficult. For at least some hardware tokens, the key is burned in to the device and cannot be changed; in this case, if the key is leaked the device should be destroyed. If a token is lost, the corresponding account should be disabled. In the event an attacker finds a lost token or discovers a secret key, having a strong PIN associated with the account will make it difficult for the attacker to gain access.</p><p><strong>Important</strong></p><p>This authentication method has been tested against the following OTP products:</p><p>\m[blue]<strong>Authenex A-Key 3600</strong>\m[]\s-2\u[24]\d\s+2 one-time password (HOTP) hardware token;</p><p>\m[blue]<strong>Feitian Technologies</strong>\m[]\s-2\u[25]\d\s+2OTP C100 and OTP C200 one-time password hardware tokens, provided by \m[blue]<strong>HyperSecu Information Systems</strong>\m[]\s-2\u[26]\d\s+2; and</p><p>\m[blue]<strong>OATH Token</strong>\m[]\s-2\u[27]\d\s+2 software application by Archie Cobbs, which implements both HOTP and TOTP on the \m[blue]<strong>iPod Touch, iPhone, and iPad</strong>\m[]\s-2\u[28]\d\s+2.</p><p>Feitian Technologies \m[blue]<strong>iOATH Lite</strong>\m[]\s-2\u[29]\d\s+2HOTP software application for the iPod Touch, iPhone, and iPad.</p><p>Other manufacturers interested in having their products supported by <strong>DACS</strong> are welcome to contact Dss.</p><p>\m[blue]<strong>Photo</strong>\m[]\s-2\u[30]\d\s+2: Feitian OTP C200, iPod Touch with the OATH Token app, Authenex A-Key 3600 (clockwise from top left)</p><p>Although this implementation should work with similar, conformant products, only these products are officially supported by <strong>DACS</strong>.</p><p>Hardware tokens can be purchased directly from the vendors.</p><p>Any problems with using tokens to authenticate through <strong>DACS</strong> are not the responsibility of the token vendor.</p>
<h3>Importing and Exporting OTP Accounts</h3>
<p>Descriptions of accounts and their tokens can be loaded or dumped (refer to the <strong>-import</strong> and <strong>-export</strong> flags). This simplifies bulk provisioning, backup, and portability. The account information is written in a simple, application-specific (almost) XML format.</p><p>The format understood by <strong>dacstoken</strong> consists of a root element ("otp_tokens"), followed by zero or more "otp_token" elements, one per line, each with required and optional attributes (described below). The XML declaration must be omitted. Leading whitespace and blank lines are ignored, as are single line XML comments. Additionally, lines having a "#" as the first non-whitespace character are ignored. Optional attributes that are not present are assigned default values. The default digest algorithm is SHA1. Short attribute names are used to save space. Unrecognized attributes, and attributes irrelevant to the device mode, are ignored. Single or double quote characters (or both) within XML attribute values must be replaced by the corresponding entity reference ("&apos;" and "&quot;", respectively), as must the "&lt;" (less than) and "&" (ampersand) characters. A "&gt;" (greater than) character may optionally be replaced by a "&gt;" sequence, but no other entity references are recognized.</p><p>Recognized attributes are:</p><p>b:</p>
<pre>
  <em>base</em>
  -- radix for OTP value
  [Optional:
  <strong>10</strong> (default),
  <strong>16</strong>, or <strong>32</strong>]
</pre>
<p>c:</p>
<pre>
  <em>counter</em>
  -- current counter value for HOTP, in hex if preceded
  by "0x" (or "0X"), decimal otherwise
  [Optional:
  default is <strong>0</strong>]
</pre>
<p>d:</p>
<pre>
  <em>OTP device mode</em>
  -- "c" (for HOTP)
  or "t" (for TOTP)
  [Required]
</pre>
<p>dn:</p>
<pre>
  <em>digest-name</em>
  -- one of the Secure Hash Algorithms
  [Optional:
  SHA1 (default),
  SHA224, SHA256,
  SHA384, SHA512]
</pre>
<p>dr:</p>
<pre>
  <em>clock-drift</em>
  -- clock adjustment, in seconds, for TOTP
  [Optional]
</pre>
<p>ek:</p>
<pre>
  <em>encrypted-key</em>
  -- encrypted secret key, base-64 encoded
  [Required:
  OTP account records only]
</pre>
<p>en:</p>
<pre>
  <em>enabled-status</em>
  -- <strong>1</strong> for enabled,
  <strong>0</strong> for disabled
  [Required]
</pre>
<p>k:</p>
<pre>
  <em>plaintext-key</em>
  -- unencrypted secret key
  [Required]
</pre>
<p>lu:</p>
<pre>
  <em>last-update</em>
  -- Unix time of last record update
  [Optional: default is current time]
</pre>
<p>nd:</p>
<pre>
  <em>ndigits</em>
  -- number of digits for OTP value
  [Optional:
  default is <strong>6</strong> for HOTP,
  <strong>8</strong> for TOTP]
</pre>
<p>p:</p>
<pre>
  <em>plaintext-PIN</em>
  -- plaintext PIN value for the account
  [Required:
  unless ph is present,
  for import only]
</pre>
<p>ph:</p>
<pre>
  <em>hashed-PIN</em>
  -- hashed PIN value for the account
  [Optional:
  generated by <strong>dacstoken</strong>
  for export and OTP account files only]
</pre>
<p>s:</p>
<pre>
  <em>serial-number</em>
  -- unique identifier string for the device
  [Required]
</pre>
<p>ts:</p>
<pre>
  <em>time-step</em>
  -- time-step value, in seconds, for TOTP
  [Optional:
  default is <strong>30</strong>]
</pre>
<p>u:</p>
<pre>
  <em>username</em>
  -- a valid <strong>DACS</strong> username associated with this account
  [Required]
</pre>
<p>The following example describes two accounts that might be created using the <strong>-import</strong> flag:</p>
<pre>
&lt;otp_tokens&gt;
&lt;!-- Staff OTP tokens for DACS authentication --&gt;
&lt;otp_token u="ietf" d="t" en="1" s="totp-ietf &quot;draft&quot;" k="3132333435363738393031323334353637383930" dn="SHA1" ts="30"/&gt;
&lt;otp_token u="ipod-c" d="c" en="1" s="ipodc-9C841SD4203" k="19c0a3519a89b4a8034c5b9306db" dn="SHA1" c="0" nd="6" b="10"/&gt;
&lt;/otp_tokens&gt;
</pre>
<p><strong>Security</strong></p><p>Because imported records include the unencrypted secret keys for the OTP devices, the exported file should be kept encrypted (e.g., using <strong>openssl</strong>) or at least have appropriate file permissions.</p><p><strong>Note</strong></p><p>A standard format for OTP device provisioning is being developed. This format may be understood by a future version of <strong>dacstoken</strong>, or a conversion utility may be written. The standard format is likely to be considerably more complex than the <strong>DACS</strong> format.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>In addition to the standard \m[blue]<strong></strong><em>dacsoptions</em>\m[]\s-2\u[1]\d\s+2, a lengthy list of command line flags are recognized. When a <em>username</em> is given, default values associated with that account are used, otherwise recommended or implementation-specific defaults are used. These default values can usually be overridden on the command line. Some flags are only allowed with a particular token mode (e.g., <strong>-counter</strong>, <strong>-totp-show</strong>) and their appearance implies that mode, making the <strong>-mode</strong> flag unnecessary; other flags are mode independent (e.g., <strong>-delete</strong>, <strong>-enable</strong>). It is an error to use a mutually incompatible flag combination. Flags that are meaningless with the selected operation are ignored, although they still imply a mode. Hexadecimal values are case insensitive. If a counter value is required but unspecified (e.g., when creating an account), an initial counter value of zero is used.</p><p>The <em>op-spec</em> specifies the operation to be performed, together with zero or more <em>modifier</em> flags. If <em>op-spec</em> is missing, the <strong>-list</strong> operation is performed. An <em>op-spec</em> is one of the following:</p><p><strong>-auth</strong> <em>otp-value</em></p><p>This flag is like \m[blue]<strong></strong><strong>-validate</strong>\m[]\s-2\u[31]\d\s+2, except:</p><p>a <em>username</em> is required, from which all parameters are obtained (such as the key);</p><p>if the account has a PIN, it must be provided;</p><p>if the account is for a HOTP token, the counter will be updated if authentication is successful.</p><p>An exit status of zero indicates successful authentication, while any other value means authentication failed.</p><p><strong>-convert </strong><strong></strong><em>filename</em></p><p>Load an older format (prior to release 1.4.25) token account file from <em>filename</em> ("-" means to read from stdin), convert it to the newer format, and write it to stdout (as by <strong>-export</strong>). This flag is deprecated and this capability will be removed in a future release of <strong>DACS</strong>.</p><p><strong>-create</strong></p><p>Create an account for <em>username</em>, which must not already exist. In other respects it works like \m[blue]<strong></strong><strong>-set</strong>\m[]\s-2\u[32]\d\s+2. When creating a new account, <strong>-serial</strong> is required and <strong>-key</strong> is implied. If no <strong>-enable</strong> flag is provided when creating an account, <strong>-disable</strong> is implied. If no <strong>-counter</strong> flag is provided, a default of zero is used. If one of the PIN flags is present, the given PIN will be assigned to the account, otherwise the account will not have a PIN (or the existing PIN will not be changed).</p><p><strong>-current</strong></p><p>Display the current moving factor (i.e., the counter value for HOTP or the interval value for TOTP) and expected OTP for <em>username</em>. For HOTP, the counter is advanced. All parameters are taken from the account.</p><p><strong>-delete</strong></p><p>Delete the account for <em>username</em>. The device&apos;s secret key and other operational parameters will be lost.</p><p><strong>-delpin</strong></p><p>Delete the PIN, if present, on the account for <em>username</em>, leaving the account without a PIN.</p><p><strong>-export</strong></p><p>Write information about all accounts, or only one account if <em>username</em> is given, to stdout. If a mode is selected, however, only accounts having that mode will be written. This information may be reloaded using <strong>-import</strong> or <strong>-import-replace</strong>. The output should be stored in an encrypted form, or at the very least have its file permissions set appropriately. For example:</p>
<pre>
% dacstoken -uj EXAMPLE -export | openssl enc -aes-256-cbc &gt; dacstoken-exported.enc
</pre>
<p>Later, you might do something like:</p>
<pre>
% openssl enc -d -aes-256-cbc &lt; dacstoken-exported.enc | dacstoken -uj EXAMPLE -import -
</pre>
<p><strong>-h</strong></p><p><strong>-help</strong></p><p>Display a help message and exit.</p><p><strong>-hotp-show</strong> <em>num</em></p><p>Display <em>num</em> consecutive HOTP passwords from a given counter value and key. The <strong>-counter</strong> flag can be used to specify an initial counter value. The key can be specified using <strong>-key</strong>, <strong>-key-file</strong>, or <strong>-key-prompt</strong>. If a <em>username</em> is provided, the initial counter value and key are obtained from the user&apos;s HOTP account, unless either value is overridden on the command line; the account&apos;s stored counter value is not modified. This is mainly intended for debugging purposes.</p><p><strong>-import </strong><strong></strong><em>filename</em></p><p><strong>-import-replace </strong><strong></strong><em>filename</em></p><p>Load account and token information from <em>filename</em>; if <em>filename</em> is "-", stdin is read. If a mode is selected, only accounts having that mode will be read. With <strong>-import</strong> it is an error if an imported account already exists, and processing stops; <strong>-import-replace</strong> will replace an existing account with imported data.</p><p><strong>-l</strong></p><p><strong>-list</strong></p><p><strong>-long</strong></p><p>If <em>username</em> is provided, display information about the corresponding account; if the <strong>-serial</strong> flag is given, display information about the account with the specified serial number; otherwise list all accounts. If the <strong>-mode</strong> flag is given in any of these cases, however, list only those accounts that have the operational mode specified. If this flag is repeated, or with the <strong>-long</strong> flag, more detail is displayed: device type, account status, device serial number, counter value (for HOTP), clock drift value (for TOTP), whether or not the account has a PIN (indicated by a "+" or "-" symbol), and the time and date of the account&apos;s last modification.</p><p><strong>-rename</strong> <em>new-username</em></p><p>Rename the existing account for <em>username</em> to be <em>new-username</em>, and modify the new account using command line arguments (as with \m[blue]<strong></strong><strong>-set</strong>\m[]\s-2\u[32]\d\s+2). As this requires two steps that are not done atomically, if an error occurs it is possible for the new account to be created and the old account to still exist.</p><p><strong>-set</strong></p><p>The <strong>-set</strong> flag is used to modify the existing account for <em>username</em> based on one or more modifier arguments (<strong>-base</strong>, <strong>-counter</strong>, <strong>-digits</strong>, <strong>-disable</strong> or <strong>-enable</strong>, <strong>-key</strong> (or <strong>-key-file</strong> or <strong>-key-prompt</strong>), <strong>-pin</strong> (or <strong>-pin-file</strong> or <strong>-pin-prompt</strong>), or <strong>-serial</strong>). The mode can also be changed by specifying <strong>-mode</strong>, but mode-specific parameters associated with the account will be lost (e.g., the current counter value will be deleted if a HOTP account is changed to a TOTP account) and general parameters (such as the serial number) will be retained unless overridden on the command line.</p><p><strong>-sync </strong><strong></strong><em>password-list</em></p><p>In HOTP mode, this attempts to synchronize the server with the token for <em>username</em>. The <em>password-list</em> is a comma-separated list of three successive passwords produced by the user&apos;s token (this "auto-synchronize" function is also available through \m[blue]<strong>local_token_authenticate</strong>\m[]\s-2\u[3]\d\s+2). The given sequence must match the computed sequence <em>exactly</em>, given the operational parameters in effect; e.g., leading zeroes are significant, as is the display radix and number of OTP digits in effect. If synchronization is successful, the user should be able to authenticate using the next password produced by the device. An exhaustive search algorithm using increasing counter values is employed, with a compile-time limit on the maximum number of computations. The search begins at the server&apos;s currently stored counter value, unless one is provided using <strong>-counter</strong>. If unsuccessful, this operation could take a long time before it terminates; the user must contact an administrator for assistance.</p><p>In TOTP mode, attempt to determine how closely synchronized the system clock is with the token&apos;s clock and display the result. This information can be used to update the user&apos;s token record to compensate for poorly synchronized clocks, or to adjust validation parameters. The token&apos;s key and the name of the digest algorithm are obtained for the token record belonging to <em>username</em>, if it is given; otherwise the key is prompted for and the digest algorithm to use is either obtained from the command line or the default. Only the first password in <em>password-list</em> is used. The <strong>-totp-timestep</strong>, <strong>-digits</strong>, and <strong>-totp-base</strong> options are effective during this operation.</p><p><strong>-test</strong></p><p>Perform some self-tests, then exit. A non-zero exit status means an error occurred.</p><p><strong>-totp-show</strong> <em>num</em></p><p>Display a sequence of TOTP passwords using the parameters currently in effect: interval size (<strong>-totp-timestep</strong>), number of digits (<strong>-digits</strong>), and base (<strong>-base</strong>). The account&apos;s stored parameters are not modified. This is mainly intended for debugging purposes.</p><p>If a <em>username</em> is provided (it must be associated with a TOTP device), the key and other stored parameters from the account are used unless overridden by command line flags. The sequence of passwords for <em>num</em> intervals before and after the current time, together with the password for the current time are printed.</p><p>If no <em>username</em> is given, the program prompts for the key (which is echoed) and uses command line flags or default values for parameters. It then emits the TOTP password for the current time each time Return/Enter is pressed. Typing EOF causes immediate termination.</p><p><strong>-validate</strong> <em>otp-value</em></p><p>If <em>otp-value</em> is the next expected one-time password, return an exit status of zero to indicate success; any other value indicates failure. If <em>username</em> is given, parameters for validation, including the key, are obtained from that account unless overridden on the command line. The server&apos;s state is not changed; e.g., a HOTP counter is not advanced. If no <em>username</em> is given, the <strong>-mode</strong> flag must be used and the parameters required for that mode must be given, including a key. For HOTP mode, a counter value must be provided. For TOTP mode, command line parameters are effective during this validation. <strong>dacstoken</strong> will test whether <em>otp-value</em> validates against the parameters in effect.</p><p>The following <em>modifier</em> flags are understood:</p><p><strong>-all</strong></p><p>With <strong>-set</strong> and no <em>username</em>, apply the changes to <em>all</em> accounts. This can be used to enable or disable all accounts, for example. The <strong>-inkeys</strong> and <strong>-outkeys</strong> flags are honoured. If an error occurs processing stops immediately, in which case only some accounts may have been modified.</p><p><strong>-base</strong> <em>num</em></p><p>Use <em>num</em> as the base (radix) when displaying an OTP. The value of <em>num</em> is restricted to <strong>10</strong> (the default), <strong>16</strong>, or <strong>32</strong>.</p><p><strong>-counter</strong> <em>num</em></p><p>This is the 8-byte HOTP counter value to set, expressed as a hex value if preceded by by "0x" (or "0X"), decimal otherwise. Leading zeroes may be elided. This implies HOTP mode. For token devices, it should not be possible to reset a counter (modulo counter overflow) because that will result in the password sequence being repeated, assuming that the key is not changed; software implementations might not have this restriction, however, so beware of the security implications.</p><p><strong>-digits</strong> <em>num</em></p><p>Use <em>num</em> digits when displaying an OTP. The value of <em>num</em> is restricted to <strong>6</strong>, <strong>7</strong>, <strong>8</strong> (the default), or <strong>9</strong> with base <strong>10</strong>. It is restricted to <strong>6</strong> with base <strong>32</strong> and is ignored with base <strong>16</strong> (hex output).</p><p><strong>-disable</strong></p><p>Disable the account for <em>username</em>. The <strong>local_token_authenticate</strong> module, and <strong>-auth</strong> and <strong>-validate</strong> flags, will not allow the user to authenticate until the account has been enabled, although other operations may still be performed on the account. If <strong>-enable</strong> is subsequently used, the account will become usable for authentication and is restored to its state at the time it was disabled. It is not an error to disable an already disabled account.</p><p><strong>-enable</strong></p><p>Enable the account for <em>username</em>. The <strong>local_token_authenticate</strong> module will allow the user to authenticate. It is not an error to enable an already enabled account.</p><p><strong>-hotp-window</strong> <em>num</em></p><p>If the expected HOTP password does not match the given password, try to match up to <em>num</em> passwords after the expected password in the sequence. A value of zero for <em>num</em> disables this search.</p><p><strong>-inkeys </strong><strong></strong><em>item_type</em></p><p>For decrypting secret keys, use the store identified by <em>item_type</em>, presumably configured in dacs.conf.</p><p><strong>-key</strong> <em>keyval</em></p><p>Use <em>keyval</em> as the secret key, expressed as a hex digit string.</p><p><strong>Security</strong></p><p>Supplying a key on the command line is not secure because it may be visible to other processes.</p><p><strong>-key-file</strong> <em>filename</em></p><p>Read the secret key, expressed as a hex digit string, from <em>filename</em>. If <em>filename</em> is "-", the key is read from stdin.</p><p><strong>-key-prompt</strong></p><p>Prompt for the secret key, expressed as a hex digit string. The input is not echoed.</p><p><strong>-mode</strong> <em>otp-mode</em></p><p>This specifies (case insensitively) the type of token (the OTP device mode) for use with <strong>-set</strong>, <strong>-create</strong>, and validation and synchronization operations. The <em>otp-mode</em> may be either counter or hotp for counter mode, or time or totp for time-based mode. This flag is required when creating a new account.</p><p><strong>-outkeys </strong><strong></strong><em>item_type</em></p><p>For encrypting secret keys, use the store identified by <em>item_type</em>, presumably defined in dacs.conf.</p><p><strong>-pin</strong> <em>pinval</em></p><p>Use <em>pinval</em> as the secret PIN for the account.</p><p><strong>Security</strong></p><p>Supplying a PIN on the command line is not secure because it may be visible to other processes.</p><p><strong>-pin-constraints</strong> <em>str</em></p><p>Instead of using \m[blue]<strong>PASSWORD_CONSTRAINTS</strong>\m[]\s-2\u[14]\d\s+2, use <em>str</em> (having the same syntax and semantics) to describe the requirements for a PIN.</p><p><strong>Note</strong></p><p>Requirements for a PIN apply to PINs obtained via a command line flag and to those obtained through importing (using the "p" attribute). Requirements are not "retroactive", however, so changing the requirements does not affect the PINs of existing accounts or importing accounts that were previously exported (having a "ph" attribute).</p><p><strong>-pin-file</strong> <em>filename</em></p><p>Read the secret PIN from <em>filename</em>. If <em>filename</em> is "-", the PIN is read from stdin.</p><p><strong>-pin-prompt</strong></p><p>Prompt for the secret PIN. The input is not echoed.</p><p><strong>-rnd</strong></p><p>Reserved for future use.</p><p><strong>-seed</strong> <em>str</em></p><p>Reserved for future use.</p><p><strong>-serial </strong><strong></strong><em>str</em></p><p>The serial number, <em>str</em>, is a (purportedly) unique identifier assigned to the token. This option is used with the <strong>-set</strong>, <strong>-create</strong>, and <strong>-list</strong> flags. A serial number identifies a specific OTP device and need not be kept secret. The uniqueness property is enforced within an item type storage unit; that is, serial numbers of all HOTP devices must be unique, serial numbers of all TOTP devices must be unique, and if accounts for the two device types are combined, all device serial numbers must be unique. Any printable string is accepted. If a software client is generating passwords, you may use the device&apos;s serial number, or choose any suitably descriptive string not already assigned to a device.</p><p><strong>Note</strong></p><p>A jurisdiction that allows (or may eventually allow) both hardware tokens and software-generating client applications should consider adopting a formalized naming scheme for its tokens. For example, the administrator might append "-hw" to the vendor&apos;s serial number to form the <strong>dacstoken</strong> serial number. For software tokens, the administrator might create a <strong>dacstoken</strong> serial number by appending "-sw" to the vendor&apos;s serial number for the device.</p><p><strong>-totp-delta</strong> <em>num</em></p><p>Adjust the base time by <em>num</em> intervals (each of the step size number of seconds) when computing a TOTP. The <em>num</em> may be negative, zero, or positive. This is used to correct for inadequately synchronized clocks.</p><p><strong>-totp-drift</strong> <em>nwindows</em></p><p>For TOTP, use a window size of <em>nwindows</em> (in terms of the interval size) for validation. If <em>nwindows</em> is <strong>0</strong>, the computed TOTP value must match the given one exactly. If <em>nwindows</em> is <strong>1</strong>, for example, <strong>dacstoken</strong> will try to match the given TOTP value in the previous, current, and next intervals. This allows the clocks in the system running <strong>dacstoken</strong> (or <strong>local_token_authenticate</strong>) and token producing device to be less well synchronized.</p><p><strong>Security</strong></p><p>Although it compensates for poorly synchronized clocks, increasing the value of <em>nwindows</em> weakens the system by extending the lifetime of a one-time password.</p><p><strong>-totp-hash</strong> <em>alg</em></p><p>Use <em>alg</em> as the digest algorithm with TOTP. The value of <em>alg</em> is restricted to (case insensitively) SHA1 (the default), SHA256, or SHA512.</p><p><strong>-totp-timestep</strong> <em>secs</em></p><p>Use <em>secs</em> as the interval size when computing a TOTP. It must be greater than zero. The default is <strong>30</strong> seconds.</p><p><strong>Security</strong></p><p>Although it compensates for poorly synchronized clocks, increasing the value of <em>secs</em> weakens the system by extending the lifetime of a one-time password.</p><p><strong>-vfs</strong> <em>vfs_uri</em></p><p>Use <em>vfs_uri</em> to override the \m[blue]<strong>VFS</strong>\m[]\s-2\u[33]\d\s+2 configuration directive in effect. This can be used to configure or reconfigure auth_token, auth_hotp_token, or auth_totp_token to specify the storage method for the accounts being acted upon.</p><p>Apart from error messages, which are printed to the standard error, all output goes to the standard output.</p><p>Ordinarily, a <em>dacsoption</em> will be specified to select the jurisdiction on behalf of which accounts are being managed.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>These examples assume that the jurisdiction name to use is EXAMPLE and its federation domain is example.com.</p><p>To use this authentication method, a <strong>DACS</strong> administrator might perform the following steps for each OTP device assigned to a user:</p><p>Obtain a supported token, review how it is used for authentication, and select values for the various parameters. Obtain the secret key for the device from the vendor; for a programmable device, select a suitable random key and program it into the device. The current counter values might also be obtained from the vendor, although it is likely to initialized to zero; for a programmable device, set the counter value to zero. Decide whether a PIN will be required (see \m[blue]<strong>TOKEN_REQUIRES_PIN</strong>\m[]\s-2\u[9]\d\s+2). If a software client is being used, install the software on the user&apos;s device (or have the user do so), and configure the software.</p><p>Decide where the account information will be stored and, if necessary, add a suitable \m[blue]<strong>VFS</strong>\m[]\s-2\u[33]\d\s+2 directive to dacs.conf. The default (found in site.conf) maintains the account information in a file named auth_tokens within each jurisdiction&apos;s default private area:</p>
<pre>
VFS "[auth_token]dacs-kwv-fs:${Conf::FEDERATIONS_ROOT}/&#92;
${Conf::FEDERATION_DOMAIN}/${Conf::JURISDICTION_NAME}/auth_tokens"
</pre>
<p>Generate keys to encrypt the account information (see \m[blue]<strong>Tokens and secret keys</strong>\m[]\s-2\u[34]\d\s+2) and decide where they will be stored; for example (your user ID, group ID, path, jurisdiction name, and federation domain may vary):</p>
<pre>
% cd /usr/local/dacs/federations_root/example.com/EXAMPLE
% dacskey -uj EXAMPLE -q auth_token_keys
% chgrp www auth_token_keys
% chmod 0640 auth_token_keys
</pre>
<p>If necessary, add a suitable \m[blue]<strong>VFS</strong>\m[]\s-2\u[33]\d\s+2 directive to dacs.conf; the default, which is used above, maintains the account information in a file named auth_token_keys within each jurisdiction&apos;s default private area:</p>
<pre>
VFS "[auth_token_keys]dacs-fs:${Conf::FEDERATIONS_ROOT}/&#92;
${Conf::FEDERATION_DOMAIN}/${Conf::JURISDICTION_NAME}/auth_token_keys"
</pre>
<p>If you need users to sign on through \m[blue]<a href="../man8/dacs_authenticate.8.html"><strong>dacs_authenticate</strong>(8)</a></strong>\m[]\s-2\u[2]\d\s+2, you must configure a suitable Auth clause in dacs.conf, for example:</p>
<pre>
&lt;Auth id="token"&gt;
  URL "token"
  STYLE "pass"
  CONTROL "sufficient"
&lt;/Auth&gt;
</pre>
<p>There are several ways that an administrator might proceed, depending on how much of the effort can be done by users (e.g., whether they can be trusted, their technical ability), how many users there are (a few, or thousands), and the level of security required.</p><p>prepare a file containing an \m[blue]<strong>XML record</strong>\m[]\s-2\u[35]\d\s+2 for each account to be created; if PINs are to be used, assign a random PIN to each account;</p><p>use the \m[blue]<strong>-import</strong>\m[]\s-2\u[36]\d\s+2 flag to create the accounts;</p><p>give the token device, username, and (if necessary) initial PIN to the user (perhaps verifying identity), providing any necessary demonstration and instructions;</p><p>have the user set or reset the PIN for the account, and ask the user to sign on using the token to confirm correct operation.</p><p>To create a disabled account for user bobo for a HOTP device:</p>
<pre>
% dacstoken -uj EXAMPLE -mode hotp -serial 37000752 -key-file bobo.key -create bobo
</pre>
<p>The secret key for the account (which must not already exist) is read from the file bobo.key. New accounts are disabled by default; use <strong>-enable</strong> to create an enabled account.</p><p>Once an account has been created, it can be synchronized with the token. To synchronize the HOTP token for user bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -sync 433268,894121,615120 bobo
</pre>
<p>In this example, the particular token produced the three consecutive passwords 433268, 894121, and 615120. Note that the password sequence string that follows the <strong>-sync</strong> flag is a single argument that cannot have any embedded spaces. If the key for this token is 19c0a3519a89b4a8034c5b9306db, the next password generated by this token should be 544323 (with counter value <strong>13</strong>). This can be verified using <strong>-hotp-show</strong>:</p>
<pre>
% dacstoken -hotp-show 5 -counter 10 -key 19c0a3519a89b4a8034c5b9306db
000000000000000a: 433268
000000000000000b: 894121
000000000000000c: 615120
000000000000000d: 544323
000000000000000e: 002442
</pre>
<p>To enable the account for user bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -enable -set bobo
</pre>
<p>To both set the PIN and enable the account for user bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -enable -pin "CzAy" -set bobo
</pre>
<p>To list all accounts in detail:</p>
<pre>
% dacstoken -uj EXAMPLE -long
</pre>
<p>The <strong>-list</strong> flag is redundant because it is the default operation. The <strong>-mode</strong>, <strong>-counter</strong>, etc. modifiers have no effect when listing.</p><p>To list only the account for bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -list bobo
</pre>
<p>The exit status will be non-zero if this user does not have an account.</p><p>To display the account for the device with serial number 37000752:</p>
<pre>
% dacstoken -uj EXAMPLE -serial 37000752
</pre>
<p>The serial number, which should uniquely identify a token, is often printed on the token or can be displayed by the token.</p><p>To set the counter value for the existing account of bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -counter 9 -set bobo
</pre>
<p>This operation might be used for testing or with a software token. The <strong>-sync</strong> operation is more appropriate for a hardware token.</p><p>To change the PIN for username bobo:</p>
<pre>
% dacstoken -uj EXAMPLE -pin-prompt -set bobo
</pre>
<p>The program will prompt for the new PIN.</p><p>To use an alternate account file, /secure/auth_tokens:</p>
<pre>
% dacstoken -uj EXAMPLE -vfs "dacs-kwv-fs:/secure/auth_tokens" -list
</pre>
<p>To use new keys (making the same assumptions as earlier), add a suitable VFS directive to dacs.conf; the default defines the item type auth_token_keys_prev as follows:</p>
<pre>
VFS "[auth_token_keys_prev]dacs-fs:${Conf::FEDERATIONS_ROOT}/&#92;
${Conf::FEDERATION_DOMAIN}/${Conf::JURISDICTION_NAME}/auth_token_keys.prev"
</pre>

<pre>
% cd /usr/local/dacs/federations_root/example.com/EXAMPLE
% mv auth_token_keys auth_token_keys.prev
% dacskey -uj EXAMPLE -q auth_token_keys
% chgrp www auth_token_keys
% chmod 0640 auth_token_keys
% dacstoken -uj EXAMPLE -inkeys auth_token_keys.prev -set
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIAGNOSTICS</h2>
        <div class="sectioncontent">
<p>The program exits 0, or 1 if an error occurred.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>HOTP should probably be called COTP, but HOTP came before TOTP. WOTP?</p><p>Listings may only be sorted by username.</p><p>The drift adjustment for TOTP accounts is tied to the real time clocks of a particular client/server pair. If either clock is effectively changed "too much" (e.g., by resetting a very fast server clock or replacing an old token that had a relatively slower clock), then a user will observe the token to suddenly stop working. Resynchronization is required in these cases. Sharing an account file amongst two or more servers should be avoided in general (because locks are unlikely to be visible across hosts), but also if their clocks are not always well synchronized. It is recommended that the Network Time Protocol (\m[blue]<strong>RFC 1305</strong>\m[]\s-2\u[37]\d\s+2) or equivalent be used on any host that runs <strong>DACS</strong> commands or web services.</p><p>The implementation of time-based tokens is based on the latest available Internet-Draft, which is considered by the IETF to be a "work in progress". Hence the algorithm, its implementation (including <strong>DACS</strong> accounts based on this operational mode), and documentation are all subject to change.</p><p>TOTP password matching windows are symmetrical.</p><p>This functionality should probably be available through \m[blue]<a href="../man8/dacs_admin.8.html"><strong>dacs_admin</strong>(8)</a></strong>\m[]\s-2\u[38]\d\s+2 and \m[blue]<a href="../man1/dacsauth.1.html"><strong>dacsauth</strong>(1)</a></strong>\m[]\s-2\u[39]\d\s+2, but it&apos;s not.</p><p>Mutual authentication using tokens should be implemented.</p><p>Although release 1.4.25 introduced many improvements, some cause incompatibilities with earlier versions of <strong>dacstoken</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dacstoken&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong>RFC 4226</strong>\m[]\s-2\u[4]\d\s+2, \m[blue]<strong>draft-mraihi-totp-timebased-05.txt</strong>\m[]\s-2\u[5]\d\s+2, \m[blue]<a href="../man8/dacs_authenticate.8.html"><strong>dacs_authenticate</strong>(8)</a></strong>\m[]\s-2\u[2]\d\s+2, \m[blue]<a href="../man8/dacs_token.8.html"><strong>dacs_token</strong>(8)</a></strong>\m[]\s-2\u[8]\d\s+2, \m[blue]<a href="../man1/dacsgrid.1.html"><strong>dacsgrid</strong>(1)</a></strong>\m[]\s-2\u[40]\d\s+2, \m[blue]<a href="../man1/dacspasswd.1.html"><strong>dacspasswd</strong>(1)</a></strong>\m[]\s-2\u[10]\d\s+2, \m[blue]<strong>opie</strong>(4)</strong>\m[]\s-2\u[41]\d\s+2, \m[blue]<strong>Mobile One Time Passwords</strong>\m[]\s-2\u[42]\d\s+2, \m[blue]<strong>mod_authn_otp</strong>\m[]\s-2\u[43]\d\s+2</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Distributed Systems Software (\m[blue]<strong>www.dss.ca</strong>\m[]\s-2\u[44]\d\s+2)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">
<p>Our sincere thanks to \m[blue]<strong>Authenex, Inc.</strong>\m[]\s-2\u[24]\d\s+2 and \m[blue]<strong>HyperSecu Information Systems, Inc.</strong>\m[]\s-2\u[26]\d\s+2 for generously providing samples of their products and technical support.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYING</h2>
        <div class="sectioncontent">
<p>Copyright2003-2013 Distributed Systems Software. See the \m[blue]<strong>LICENSE</strong>\m[]\s-2\u[45]\d\s+2 file that accompanies the distribution for licensing information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>dacsoptions</p><p>http://dacs.dss.ca/man/dacs.1.html#dacsoptions</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p>dacs_authenticate</p><p>http://dacs.dss.ca/man/dacs_authenticate.8.html</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p>local_token_authenticate</p><p>http://dacs.dss.ca/man/dacs_authenticate.8.html#token</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p>RFC 4226</p><p>http://www.rfc-editor.org/rfc/rfc4226.txt</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p>latest IETF Internet-Draft</p><p>http://www.ietf.org/id/draft-mraihi-totp-timebased-05.txt</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p>Additional operational modes</p><p>http://www.ietf.org/id/draft-mraihi-mutual-oath-hotp-variants-11.txt</p>
  </dd>
  <dt>
     7.
  </dt>
  <dd>
    <p><strong>-convert</strong> flag</p><p>http://dacs.dss.ca/man/#convert_flag</p>
  </dd>
  <dt>
     8.
  </dt>
  <dd>
    <p><a href="../man8/dacs_token.8.html"><strong>dacs_token</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_token.8.html</p>
  </dd>
  <dt>
     9.
  </dt>
  <dd>
    <p>TOKEN_REQUIRES_PIN</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#TOKEN_REQUIRES_PIN</p>
  </dd>
  <dt>
    10.
  </dt>
  <dd>
    <p><a href="../man1/dacspasswd.1.html"><strong>dacspasswd</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacspasswd.1.html</p>
  </dd>
  <dt>
    11.
  </dt>
  <dd>
    <p><a href="../man8/dacs_passwd.8.html"><strong>dacs_passwd</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_passwd.8.html</p>
  </dd>
  <dt>
    12.
  </dt>
  <dd>
    <p>PASSWORD_DIGEST</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#PASSWORD_DIGEST</p>
  </dd>
  <dt>
    13.
  </dt>
  <dd>
    <p>PASSWORD_SALT_PREFIX</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#PASSWORD_SALT_PREFIX</p>
  </dd>
  <dt>
    14.
  </dt>
  <dd>
    <p>PASSWORD_CONSTRAINTS</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#PASSWORD_CONSTRAINTS</p>
  </dd>
  <dt>
    15.
  </dt>
  <dd>
    <p>RFC 2104</p><p>http://www.rfc-editor.org/rfc/rfc2104.txt</p>
  </dd>
  <dt>
    16.
  </dt>
  <dd>
    <p>FIPS 198</p><p>http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</p>
  </dd>
  <dt>
    17.
  </dt>
  <dd>
    <p><strong>time</strong>(3)</p><p>http://www.freebsd.org/cgi/man.cgi?query=time&apropos=0&sektion=3&manpath=FreeBSD+9.1-RELEASE&format=html</p>
  </dd>
  <dt>
    18.
  </dt>
  <dd>
    <p><a href="../man1/dacsexpr.1.html"><strong>dacsexpr</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsexpr.1.html</p>
  </dd>
  <dt>
    19.
  </dt>
  <dd>
    <p>man-in-the-middle attack</p><p>http://en.wikipedia.org/wiki/Man-in-the-middle_attack</p>
  </dd>
  <dt>
    20.
  </dt>
  <dd>
    <p>revocation list</p><p>http://dacs.dss.ca/man/dacs.acls.5.html#revocation_list</p>
  </dd>
  <dt>
    21.
  </dt>
  <dd>
    <p>local_passwd_authenticate</p><p>http://dacs.dss.ca/man/dacs_authenticate.8.html#passwd</p>
  </dd>
  <dt>
    22.
  </dt>
  <dd>
    <p><strong>DACS</strong> identities</p><p>http://dacs.dss.ca/man/dacs.1.html#gloss_identity</p>
  </dd>
  <dt>
    23.
  </dt>
  <dd>
    <p><a href="../man1/dacskey.1.html"><strong>dacskey</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacskey.1.html</p>
  </dd>
  <dt>
    24.
  </dt>
  <dd>
    <p>Authenex A-Key 3600</p><p>http://www.authenex.com</p>
  </dd>
  <dt>
    25.
  </dt>
  <dd>
    <p>Feitian Technologies</p><p>http://www.ftSafe.com</p>
  </dd>
  <dt>
    26.
  </dt>
  <dd>
    <p>HyperSecu Information Systems</p><p>http://www.hypersecu.com</p>
  </dd>
  <dt>
    27.
  </dt>
  <dd>
    <p>OATH Token</p><p>http://oathtoken.googlecode.com</p>
  </dd>
  <dt>
    28.
  </dt>
  <dd>
    <p>iPod Touch, iPhone, and iPad</p><p>http://itunes.apple.com/us/app/oath-token/id364017137?mt=8</p>
  </dd>
  <dt>
    29.
  </dt>
  <dd>
    <p>iOATH Lite</p><p>http://itunes.apple.com/ca/app/ioath-lite/id327109243?mt=8</p>
  </dd>
  <dt>
    30.
  </dt>
  <dd>
    <p>Photo</p><p>http://dacs.dss.ca/otp-tokens2.jpg</p>
  </dd>
  <dt>
    31.
  </dt>
  <dd>
    <p><strong>-validate</strong></p><p>http://dacs.dss.ca/man/#validate_flag</p>
  </dd>
  <dt>
    32.
  </dt>
  <dd>
    <p><strong>-set</strong></p><p>http://dacs.dss.ca/man/#set_flag</p>
  </dd>
  <dt>
    33.
  </dt>
  <dd>
    <p>VFS</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#VFS</p>
  </dd>
  <dt>
    34.
  </dt>
  <dd>
    <p>Tokens and secret keys</p><p>http://dacs.dss.ca/man/#security1</p>
  </dd>
  <dt>
    35.
  </dt>
  <dd>
    <p>XML record</p><p>http://dacs.dss.ca/man/#user_provisioning</p>
  </dd>
  <dt>
    36.
  </dt>
  <dd>
    <p>-import</p><p>http://dacs.dss.ca/man/import_flag</p>
  </dd>
  <dt>
    37.
  </dt>
  <dd>
    <p>RFC 1305</p><p>http://www.rfc-editor.org/rfc/rfc1305.txt</p>
  </dd>
  <dt>
    38.
  </dt>
  <dd>
    <p><a href="../man8/dacs_admin.8.html"><strong>dacs_admin</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_admin.8.html</p>
  </dd>
  <dt>
    39.
  </dt>
  <dd>
    <p><a href="../man1/dacsauth.1.html"><strong>dacsauth</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsauth.1.html</p>
  </dd>
  <dt>
    40.
  </dt>
  <dd>
    <p><a href="../man1/dacsgrid.1.html"><strong>dacsgrid</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsgrid.1.html</p>
  </dd>
  <dt>
    41.
  </dt>
  <dd>
    <p><strong>opie</strong>(4)</p><p>http://www.freebsd.org/cgi/man.cgi?query=opie&apropos=0&sektion=4&manpath=FreeBSD+9.1-RELEASE&format=html</p>
  </dd>
  <dt>
    42.
  </dt>
  <dd>
    <p>Mobile One Time Passwords</p><p>http://motp.sourceforge.net</p>
  </dd>
  <dt>
    43.
  </dt>
  <dd>
    <p>mod_authn_otp</p><p>http://code.google.com/p/mod-authn-otp</p>
  </dd>
  <dt>
    44.
  </dt>
  <dd>
    <p>www.dss.ca</p><p>http://www.dss.ca</p>
  </dd>
  <dt>
    45.
  </dt>
  <dd>
    <p>LICENSE</p><p>http://dacs.dss.ca/man/../misc/LICENSE</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dacssched.1.html"><span aria-hidden="true">&larr;</span> dacssched.1: Rule-based command scheduling</a></li>
   <li class="next"><a href="dacstransform.1.html">dacstransform.1: Rule-based document transformation <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
