<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cmtk-imagemath: Image operations</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Image operations">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cmtk-imagemath (1) manual">
  <meta name="twitter:description" content="Image operations">
  <meta name="twitter:image" content="https://www.carta.tech/images/cmtk-cmtk-imagemath-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/cmtk-imagemath.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cmtk-imagemath (1) manual" />
  <meta property="og:description" content="Image operations" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cmtk-cmtk-imagemath-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cmtk-imagemath<small> (1)</small></h1>
        <p class="lead">Image operations</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/cmtk-imagemath.1.html">
      <span itemprop="name">cmtk-imagemath: Image operations</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cmtk/">
      <span itemprop="name">cmtk</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/cmtk-imagemath.1.html">
      <span itemprop="name">cmtk-imagemath: Image operations</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Perform operations on images using stack-based postfix notation.</p><p>Images can be read from files and pushed onto the stack. Images on the stack can be processed and combined via different operators. Results of all operations are put back onto the stack, where they can be further processed or written back to image files.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>Global Toolkit Options (these are shared by all CMTK tools)</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--help</strong></p>
  </dt>
  <dd>
    <p>Write list of basic command line options to standard output.</p>
  </dd>
  <dt>
    <p><strong>--help-all</strong></p>
  </dt>
  <dd>
    <p>Write complete list of basic and advanced command line options to standard output.</p>
  </dd>
  <dt>
    <p><strong>--wiki</strong></p>
  </dt>
  <dd>
    <p>Write list of command line options to standard output in MediaWiki markup.</p>
  </dd>
  <dt>
    <p><strong>--man</strong></p>
  </dt>
  <dd>
    <p>Write man page source in 'nroff' markup to standard output.</p>
  </dd>
  <dt>
    <p><strong>--version</strong></p>
  </dt>
  <dd>
    <p>Write toolkit version to standard output.</p>
  </dd>
  <dt>
    <p><strong>--echo</strong></p>
  </dt>
  <dd>
    <p>Write the current command line to standard output.</p>
  </dd>
  <dt>
    <p><strong>--verbose-level</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Set verbosity level.</p>
  </dd>
  <dt>
    <p><strong>--verbose</strong>, <strong>-v</strong></p>
  </dt>
  <dd>
    <p>Increment verbosity level by 1 (deprecated; supported for backward compatibility).</p>
  </dd>
  <dt>
    <p><strong>--threads</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Set maximum number of parallel threads (for POSIX threads and OpenMP).</p>
  </dd>

</dl>

<h3>Input/output operations</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--in</strong> <em>&lt;string-vector&gt;</em></p>
  </dt>
  <dd>
    <p>Read input image(s) to top of stack</p>
  </dd>
  <dt>
    <p><strong>--out</strong> <em>&lt;string&gt;</em></p>
  </dt>
  <dd>
    <p>Write output image from top of stack (but leave it on the stack)</p>
  </dd>
  <dt>
    <p><strong>--set-padding-value</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Set the value that is interpreted as padding value in subsequently read images.</p>
  </dd>
  <dt>
    <p><strong>--unset-padding</strong></p>
  </dt>
  <dd>
    <p>Disable padding. All values in subsequently read images will be interpreted as actual data.</p>
  </dd>

</dl>

<h3>Internal settings</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--float</strong></p>
  </dt>
  <dd>
    <p>Use single precision for computations and results <strong>[This is the default]</strong></p>
  </dd>
  <dt>
    <p><strong>--double</strong></p>
  </dt>
  <dd>
    <p>Use double precision for computations and results</p>
  </dd>

</dl>

<h3>Stack operations</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--pop</strong></p>
  </dt>
  <dd>
    <p>Pop (discard) top image from stack.</p>
  </dd>
  <dt>
    <p><strong>--dup</strong></p>
  </dt>
  <dd>
    <p>Duplicate image on top of the stack.</p>
  </dd>
  <dt>
    <p><strong>--all</strong></p>
  </dt>
  <dd>
    <p>Apply next single-image operation to all images on the stack.</p>
  </dd>

</dl>

<h3>Single-image operators</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--fill</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Fill top image with constant value (i.e., assign value to all pixels)</p>
  </dd>
  <dt>
    <p><strong>--abs</strong></p>
  </dt>
  <dd>
    <p>Apply abs() function to top image</p>
  </dd>
  <dt>
    <p><strong>--log</strong></p>
  </dt>
  <dd>
    <p>Apply log() function to top image</p>
  </dd>
  <dt>
    <p><strong>--logit</strong></p>
  </dt>
  <dd>
    <p>Apply log(x/(1-x)) function to top image</p>
  </dd>
  <dt>
    <p><strong>--logistic</strong></p>
  </dt>
  <dd>
    <p>Apply 1/(1+exp(-x)) function to top image</p>
  </dd>
  <dt>
    <p><strong>--exp</strong></p>
  </dt>
  <dd>
    <p>Apply exp() function to top image</p>
  </dd>
  <dt>
    <p><strong>--sqr</strong></p>
  </dt>
  <dd>
    <p>Apply square operator to top image</p>
  </dd>
  <dt>
    <p><strong>--sqrt</strong></p>
  </dt>
  <dd>
    <p>Apply square root operator to top image</p>
  </dd>
  <dt>
    <p><strong>--trunc</strong></p>
  </dt>
  <dd>
    <p>Truncate all values in top image to integer</p>
  </dd>
  <dt>
    <p><strong>--one-over</strong></p>
  </dt>
  <dd>
    <p>For each pixel, replace its value x with 1.0/x</p>
  </dd>
  <dt>
    <p><strong>--scalar-mul</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Multiply top image with a scalar value</p>
  </dd>
  <dt>
    <p><strong>--scalar-add</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Add a scalar to each pixel of the top image</p>
  </dd>
  <dt>
    <p><strong>--scalar-xor</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Bitwise exclusive-or between top level and given scalar value</p>
  </dd>
  <dt>
    <p><strong>--scalar-and</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Bitwise and operation between top level and given scalar value</p>
  </dd>
  <dt>
    <p><strong>--thresh-below</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Set values below given threshold to threshold.</p>
  </dd>
  <dt>
    <p><strong>--thresh-above</strong> <em>&lt;double&gt;</em></p>
  </dt>
  <dd>
    <p>Set values above given threshold to threshold.</p>
  </dd>

</dl>

<h3>Image pair operators</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--add</strong></p>
  </dt>
  <dd>
    <p>Add top and second image, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--mul</strong></p>
  </dt>
  <dd>
    <p>Multiply top and second image, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--div</strong></p>
  </dt>
  <dd>
    <p>Divide top image by second image, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--atan2</strong></p>
  </dt>
  <dd>
    <p>Compute atan2() function from tup two image pixel pairs, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--match-histograms</strong></p>
  </dt>
  <dd>
    <p>Scale intensities in one image to match intensities of another. The last image pushed onto the stack provides the reference intensity distribution, the preceding image will be modified. Both input images are removed from the stack and the modified image is pushed onto the stack.</p>
  </dd>
  <dt>
    <p><strong>--match-mean-sdev</strong></p>
  </dt>
  <dd>
    <p>Scale intensities of one image to match mean and standard deviation of another. The last image pushed onto the stack provides the reference intensity distribution, the preceding image will be modified. Both input images are removed from the stack and the modified image is pushed onto the stack.</p>
  </dd>
  <dt>
    <p><strong>--match-mean-sdev3</strong></p>
  </dt>
  <dd>
    <p>Scale intensities of an image by a factor and offset computed from two other images to match their mean and standard deviations. The last image pushed onto the stack provides the reference intensity distribution, the preceding image provides the intensity distribution to match to the reference image's, and the third image on the stack will be modified. All three input images are removed from the stack and the modified image is pushed onto the stack.</p>
  </dd>
  <dt>
    <p><strong>--mask-average</strong></p>
  </dt>
  <dd>
    <p>Mask averaging: the top image is taken as a multi-label mask. The pixels in the second image are averaged by mask labels, and then replaced with the average value for each mask label.</p>
  </dd>

</dl>

<h3>Complex Arithmetic</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--complex-div</strong></p>
  </dt>
  <dd>
    <p>Complex division, (a+ib)/(c+id), assuming four values were put on the stack in order a, b, c, d. Place result on stack, real first, imaginary second (i.e., imaginary is top).</p>
  </dd>

</dl>

<h3>Operators that contract the entire stack into a single image</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--sum</strong></p>
  </dt>
  <dd>
    <p>Sum all images on stack, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--product</strong></p>
  </dt>
  <dd>
    <p>Compute product of all images on stack, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--average</strong></p>
  </dt>
  <dd>
    <p>Average all images on stack, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--variance</strong></p>
  </dt>
  <dd>
    <p>For each pixel, compute variance over all images on stack, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--combine-pca</strong></p>
  </dt>
  <dd>
    <p>Combine images using PCA by projecting onto direction of largest correlation</p>
  </dd>
  <dt>
    <p><strong>--max-value</strong></p>
  </dt>
  <dd>
    <p>For each pixel, compute maximum VALUE over all images, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--min-value</strong></p>
  </dt>
  <dd>
    <p>For each pixel, compute minimum VALUE over all images, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--max-index</strong></p>
  </dt>
  <dd>
    <p>For each pixel, compute INDEX of image with maximum value, place result on stack</p>
  </dd>

</dl>

<h3>Operators that contract a stack of label images into a single label image</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--vote</strong></p>
  </dt>
  <dd>
    <p>Merge all images on stack with voting, place result on stack</p>
  </dd>
  <dt>
    <p><strong>--staple</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Combine binary maps on the stack using [arg] iterations of the STAPLE algorithm. The result of this operation is the spatial map of 'weights' W, which are the probabilities of image foreground at each pixel. In 'verbose' mode, estimated expert parameters p (sensitivity) and q (specificity) are also written to standard output.</p>
  </dd>
  <dt>
    <p><strong>--contract-labels</strong></p>
  </dt>
  <dd>
    <p>Contract multiple label maps into one by selecting the first (over all images on the stack) non-zero label at each pixel</p>
  </dd>
  <dt>
    <p><strong>--mstaple</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Combine multi-label maps on the stack using [arg] iterations of the multi-class STAPLE algorithm.The result of this operation is the combined maximum-likeliood multi-label map.</p>
  </dd>
  <dt>
    <p><strong>--mstaple-disputed</strong> <em>&lt;integer&gt;</em></p>
  </dt>
  <dd>
    <p>Like previous operation, apply multi-class STAPLE algorithm, but restrict computation to 'disputed'voxels, i.e., those where the input label maps disagree. This often improves results by reducing, e.g., background effects.</p>
  </dd>
  <dt>
    <p><strong>--stack-entropy-labels</strong></p>
  </dt>
  <dd>
    <p>Compute stack entropy at each pixel from integer (label) input images</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Torsten Rohlfing, with contributions from Michael P. Hasak, Greg Jefferis, Calvin R. Maurer, Daniel B. Russakoff, and Yaroslav Halchenko</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>http://www.fsf.org/licensing/licenses/gpl.html</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Report bugs at http://nitrc.org/projects/cmtk/</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGMENTS</h2>
        <div class="sectioncontent">
<p>CMTK is developed with support from the NIAAA under Grant AA021697, National Consortium on Alcohol and Neurodevelopment in Adolescence (N-CANDA): Data Integration Component. From April 2009 through September 2011, CMTK development and maintenance was supported by the NIBIB under Grant EB008381.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cmtk-histogram.1.html"><span aria-hidden="true">&larr;</span> cmtk-histogram.1: Image histogram</a></li>
   <li class="next"><a href="cmtk-interleaved_bad_slices.1.html">cmtk-interleaved_bad_slices.1: Find bad slices in a time series of interleaved images (e.g., a resting-state fmri series). <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
