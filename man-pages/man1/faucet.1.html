<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>faucet: A fixture for a bsd network pipe  netpipes 4.2</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A fixture for a bsd network pipe  netpipes 4.2">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="faucet (1) manual">
  <meta name="twitter:description" content="A fixture for a bsd network pipe  netpipes 4.2">
  <meta name="twitter:image" content="https://www.carta.tech/images/netpipes-faucet-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/faucet.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="faucet (1) manual" />
  <meta property="og:description" content="A fixture for a bsd network pipe  netpipes 4.2" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/netpipes-faucet-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">faucet<small> (1)</small></h1>
        <p class="lead">A fixture for a bsd network pipe  netpipes 4.2</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/faucet.1.html">
      <span itemprop="name">faucet: A fixture for a bsd network pipe  netpipes 4.2</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/netpipes/">
      <span itemprop="name">netpipes</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/faucet.1.html">
      <span itemprop="name">faucet: A fixture for a bsd network pipe  netpipes 4.2</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>faucet</strong> <em>port</em> (<strong>--in</strong>|<strong>--out</strong>|<strong>--err</strong>|<strong>--fd</strong> <em>n</em>)+ [<strong>--once</strong>] [<strong>--verbose</strong>] [<strong>--quiet</strong>] [<strong>--unix</strong>] [<strong>--foreignhost</strong> <em>addr</em>] [<strong>--foreignport</strong> <em>port</em>] [<strong>--localhost</strong> <em>addr</em>] [<strong>--serial</strong>] [<strong>--daemon</strong>] [<strong>--shutdown</strong> (r|w) ] [<strong>--pidfile</strong> <em>filename</em>] [<strong>--noreuseaddr</strong>] [<strong>--backlog</strong> <em>n</em>] [<strong>-</strong>[<strong>i</strong>][<strong>o</strong>][<strong>e</strong>][<strong>#</strong><em>3</em>[,<em>4</em>[,<em>5</em>...]]][<strong>v</strong>][<strong>1</strong>][<strong>q</strong>][<strong>u</strong>][<strong>d</strong>][<strong>s</strong>]] [<strong>-p</strong> <em>foreign-port</em>] [<strong>-h</strong> <em>foreign-host</em>] [<strong>-H</strong> <em>local-host</em>] <em>command</em> <em>args</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>faucet</strong> attempts to provide the functionality of pipes over the network. It behaves as the server end of a server-client connection. When used with <a href="../man1/hose.1.html"><strong>hose</strong>(1)</a></strong> it can function as a replacement for</p>
<pre>
tar -cf - . | rsh other "cd destdir; tar -xf -"
</pre>
<p><strong>faucet</strong> and <strong>hose</strong> are especially useful when you don't have easy non-interactive access to the destination account (such as a root account where .rhosts are a bad idea).</p><p><strong>faucet</strong> creates a BSD socket, binds it to the <em>port</em> specified on the command line, and listens for connections.</p><p>Every time <strong>faucet</strong> gets a connection it <strong>exec</strong>(2)s <em>command</em> and its <em>args</em> with stdin, stdout, stderr, and/or arbitrary file descriptors redirected according to the <strong>--in --out --err --fd</strong> <em>n</em> flags.  <strong>faucet</strong> also automagically shuts down the unused half of the connection if only <strong>--in</strong> is specified or if only <strong>--out</strong> and/or <strong>--err</strong> are specified.  See the <strong>--shutdown</strong> option for more information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>If the <strong>--once</strong> flag is specified, <strong>faucet</strong> will <strong>exec</strong>(2) the <em>command</em> instead of <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a>ing and <strong>exec</strong>(2)ing. <strong>--once</strong> means that the network pipe is only good for one shot.</p><p>The <strong>--verbose</strong> flag specifies that <strong>faucet</strong> should print information about connecting hosts.  This information includes the numeric host address, host names, and foreign port numbers. The <strong>--quiet</strong> flag specifies that <strong>faucet</strong> should NOT print such info. <strong>--quiet</strong> is the default.</p><p>The <strong>--unix</strong> flag specifies that the <em>port</em> is not an internet port number or service name, but instead it is a file name for a UNIX domain socket.</p><p>The <strong>--foreignhost</strong> option specifies that faucet should reject all connections that do not come from the <em>host</em> machine. Similarly <strong>--foreignport</strong> specifies that faucet should reject all connections that are not bound on their local machine to the <em>port</em> argument.  The above two options allow a crude form of authentication.  Note that on UNIX systems only root can bind a socket to a port number below 1024.</p><p><strong>Please</strong> do not be fooled into thinking this makes faucet secure.  There are ways to spoof IP numbers that have been known for years (but only publicized recently).  I do think that this method is safe from DNS spoofs, but you probably should have  <strong>nospoof on</strong> in /etc/host.conf anyway.</p><p><strong>--localhost</strong> specifies that the listening socket should be bound to a specific internet address on this host.  This is only useful on hosts with several internet numbers.</p><p><strong>--daemon</strong> specifies that the faucet should disassociate from the controlling terminal once it has started listening on the socket.  This is done using the setsid() system call.  If you don't have setsid on your system, it uses the standard ``close all file descriptors, ioctl TIOCNOTTY, fork() and parent exit'' sequence.</p><p><strong>--shutdown</strong> is used to turn the (normally) bi-directional socket into a uni-directional one If the `r' is present, then <strong>faucet</strong> will close half the connection to make it a read-only socket.  If we try to write, it will fail.  If the remote connection tries to read, it will percieve the socket as closed. If instead the `w' is present, then <strong>faucet</strong> will close the other half of the connection to make it a write-only socket.  If we try to read, we will percieve the socket as closed.  If the remote connection tries to write, it will fail. The default behavior is to leave both halves open, however the shutdown of half of the connection is automagically done by certain combinations of the <strong>--in</strong>, <strong>--out</strong>, and <strong>--err</strong> flags. To suppress their automagic behavior you can use (respectively) --fd 0, --fd 1, and --fd 2.</p><p><strong>--shutdown</strong> may not be used with some internet servers (such as certain httpds) because they interpret the closing of one half of the connection as a close on the entire connection.  This warning applies to <strong>--in</strong>, <strong>--out</strong>, and <strong>--err</strong>.</p><p><strong>--serial</strong> causes faucet to wait for one child to finish before accepting any more connections.  Serialization is a very crude form of critical-section management.</p><p><strong>--pidfile</strong> <em>filename</em> commands <strong>faucet</strong> to write its process id into <em>filename</em>.  This is useful when faucet is part of a larger system and a controlling process might want to kill the faucet.  <strong>--pidfile</strong> functions properly when using the <strong>--daemon </strong> option.</p><p>By default, <strong>faucet</strong> performs a</p>
<pre>
setsockopt(fd, SOL_SOCKET, SO_REUSEADDR...)
</pre>
<p>which prevents the ``Address in use'' problem that ``plagued'' netpipes versions 4.0 and earlier.  <strong>--noreuseaddr</strong> tells faucet to skip that system call, and revert to pre-4.1 behavior.  Without this call, the socket is not always available for immediate reuse after the faucet exits.</p><p><strong>--backlog</strong> <em>n</em> allows you to specify the second parameter to the <a href="../man2/listen.2.html"><strong>listen</strong>(2)</a> system call.  The default is 5.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SHORT FLAGS</h2>
        <div class="sectioncontent">
<p>To reduce the typing requirements for arguments (and to pay homage to the age-old tradition of UNIX cryptotaxonomy) I have added some short forms of the flags.  Here is a correspondence chart:</p><table class="table table-striped">
<tr>
<th>Short</th></tr>

<tr>
<td>Long</td></tr>

<tr>
<td><strong>i</strong></td></tr>

<tr>
<td><strong>in</strong></td></tr>

<tr>
<td><strong>o</strong></td></tr>

<tr>
<td><strong>out</strong></td></tr>

<tr>
<td><strong>e</strong></td></tr>

<tr>
<td><strong>err</strong></td></tr>

<tr>
<td><strong>#</strong><em>n</em></td></tr>

<tr>
<td><strong>fd</strong><em>n</em></td></tr>

<tr>
<td><strong>v</strong></td></tr>

<tr>
<td><strong>verbose</strong></td></tr>

<tr>
<td><strong>1</strong></td></tr>

<tr>
<td><strong>once</strong></td></tr>

<tr>
<td><strong>q</strong></td></tr>

<tr>
<td><strong>quiet</strong></td></tr>

<tr>
<td><strong>u</strong></td></tr>

<tr>
<td><strong>unix</strong></td></tr>

<tr>
<td><strong>d</strong></td></tr>

<tr>
<td><strong>daemon</strong></td></tr>

<tr>
<td><strong>s</strong></td></tr>

<tr>
<td><strong>serial</strong></td></tr>

<tr>
<td><strong>p</strong></td></tr>

<tr>
<td><strong>foreignport</strong></td></tr>

<tr>
<td><strong>h</strong></td></tr>

<tr>
<td><strong>foreignhost</strong></td></tr>

<tr>
<td><strong>H</strong></td></tr>

<tr>
<td><strong>localhost</strong></td></tr>
</table><p>For example, the following command</p>
<pre>
example$ faucet 3000 --out --verbose --once --foreignhost client echo blah
</pre>
<p>could be written</p>
<pre>
example$ faucet 3000 -ov1h client echo blah
</pre>
<p>The <strong>-p</strong>, <strong>-h</strong>, and <strong>-H</strong> flags take an argument, but the flags may be grouped into one argument.  They then grab the arguments they need from the command line in the order the flags appear.</p>
<pre>
example$ faucet 3000 -hpHov1 client 2999 example-le2 echo blah
</pre>
<p>Whereas each <strong>--fd</strong> word flag required an individual descriptor, the <strong>-#</strong> character flag can take multiple descriptors.  The following are equivalent:</p>
<pre>
example$ faucet 3000 --fd 0 --fd 1 --verbose --once echo blah
example$ faucet 3000 -#0,1v --once echo blah
example$ faucet 3000 -v1#0,1 echo blah
example$ faucet 3000 -#0,1v1 echo blah
</pre>
<p>Note that you have to pay attention when using the <strong>-#</strong> character flag and the <strong>-1</strong> character flag in the same argument. Also, remember the special <a href="../man2/shutdown.2.html"><strong>shutdown</strong>(2)</a> semantics of <strong>-in</strong> and <strong>-out</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>This creates a TCP-IP socket on the local machine bound to port 3000.</p>
<pre>
example$ faucet 3000 --out --verbose tar -cf - .
</pre>
<p>Every time some process (from any machine) attempts to connect to port 3000 on this machine the <strong>faucet</strong> program will <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a> a process and the child will <strong>exec</strong>(2) a</p>
<pre>
tar -cf - .
</pre>
<p>The <strong>--out</strong> option means that the output of the child process will have been redirected into the new socket retrieved by the <a href="../man2/accept.2.html"><strong>accept</strong>(2)</a> call.  <strong>--verbose</strong> means that faucet will print information about each new connection.</p><p>This creates a UNIX domain socket in the current directory</p>
<pre>
example$ faucet u-socket --out --err --once --unix csh -c &#92;
	"dd if=angio.pgm | funky.perl.script"
</pre>
<p>The <strong>--out --err</strong> option means that stdout and stderr will be redirected in the child process.  The <strong>--once</strong> option means that the faucet will not <a href="../man2/fork.2.html"><strong>fork</strong>(2)</a>, but <strong>exec</strong>(2) the process so that only the first process can connect to the u-socket before the faucet becomes unavailable.</p><p>This example listens on a socket until the first connection comes through.  It then spawns a bidirectional copy that is similar to hose -slave.</p>
<pre>
faucet 3000 -1v --fd 3 sh -c 'cat &lt;&3 & cat &gt;&3 ; sockdown 3'
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO faucet&hellip;</h2>
        <div class="sectioncontent">
<p>netpipes (1), hose (1), sockdown (1), getpeername (1), socket (2), bind (2), listen (2), accept (2), shutdown (2), services (5), gethostbyaddr (3)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>There is a problem with almost every OS I have used faucet on. Ports are sometimes not recycled swiftly enough.  If you kill one faucet and try to start another that wants to listen on the same port you will often see pre-4.1 faucets print the following warning over and over again:</p>
<pre>
faucet: Address 3000 in use, sleeping 10.
faucet: Trying again . . .
</pre>
<p>but you won't actually be able to <a href="../man2/connect.2.html"><strong>connect</strong>(2)</a> to that port (with <a href="../man1/hose.1.html"><strong>hose</strong>(1)</a>, for example) because you'll get a ``connection refused''.</p><p>There was also an experimental Linux kernel that NEVER recycled ports (I quickly switched back to my old kernel).</p><p>I have been informed that this is a side-effect of the TCP specification and that I should use the SO_REUSEADDR option to work around it, so I do.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<p>Doubtless there are bugs in this program, especially in the unix domain socket portions.  I welcome problem reports and would like to make these programs as "clean" (no leftover files, sockets) as possible.</p><p>4.1 added <strong>--backlog</strong> and <strong>--noreuseaddr</strong>.  <strong>--noreuseaddr</strong> reflects the fact that 4.1 also added the SO_REUSEADDR socket option as the default.</p><p>4.0 made the full-word arguments use -- like many GNU programs. They are still available with a single - for backward-compatibility.</p><p>3.1 added the single-character flags and the -pidfile option.  It also switched to the <a href="../man2/setsid.2.html"><strong>setsid</strong>(2)</a> system call to detach itself from the process group for the -daemon flag.  I've been hacking at UNIX for years, but there are still some things that I never really learned, and others that have been changing.  I need to buy a book.</p><p>Release 2.3 added support for multi-homed hosts: hosts with multiple internet numbers (such as gateways).  Before this faucet assumed that the first internet number that gethostbyname returned was the only one.  <strong>--foreignhost</strong> authentication was weakened by this inadequacy so I beefed up the algorithms.  <strong>--foreignhost</strong> will accept a connection from any of the internet numbers associated with the host name.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CREDITS</h2>
        <div class="sectioncontent">
<p>Thanks to Steve Clift &lt;clift@ml.csiro.au&gt; for SGI (SysV) patches.</p><p>Many people complained about the old way of specifying the command. Thanks to whoever gave me the alternative which is now implemented. It is much better.</p><p>Randy Fischer &lt;fischer@ucet.ufl.edu&gt; finally prodded me into fixing the old lame non-handling of multi-homed host.</p><p>Thanks to all who suggested I use setsid() for -daemon mode.</p><p>Thanks to the Spring 1996 UF CIS consulting staff &lt;consult@cis.ufl.edu&gt; for pointing out the sys_errlist[] declaration conflict on FreeBSD.  Sometimes I hate Sun Microsystems.</p><p>Thanks to Daniel O'Connor &lt;doconnor@adam.ist.flinders.edu.au&gt; for suggesting the -pidfile flag.</p><p>Big thanks to Joe Traister &lt;traister@gate.net&gt; for his signal handling patches, strerror surrogate, and other assorted hacks.</p><p>Thanks to Thomas A. Endo &lt;tendo@netcom.com&gt; for dropping an SO_REUSEADDR patch in my lap.  Otherwise I wouldn't have gotten to it till 2001.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 1992-98 Robert Forsman</p><p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Robert Forsman  thoth@purplefrog.com  Purple Frog Software  http://web.purplefrog.com/~thoth/</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="faucc.1.html"><span aria-hidden="true">&larr;</span> faucc.1: C compiler generating intel code for 16 bit/32 bit cpus.</a></li>
   <li class="next"><a href="fauhdlc.1.html">fauhdlc.1: Compile vhdl files to intermediate code. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
