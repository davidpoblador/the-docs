<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pgbadger: A fast postgresql log analysis report</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="A fast postgresql log analysis report">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="pgbadger (1p) manual">
  <meta name="twitter:description" content="A fast postgresql log analysis report">
  <meta name="twitter:image" content="https://www.carta.tech/images/pgbadger-pgbadger-1p.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1p/pgbadger.1p.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="pgbadger (1p) manual" />
  <meta property="og:description" content="A fast postgresql log analysis report" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/pgbadger-pgbadger-1p.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">pgbadger<small> (1p)</small></h1>
        <p class="lead">A fast postgresql log analysis report</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/pgbadger.1p.html">
      <span itemprop="name">pgbadger: A fast postgresql log analysis report</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/pgbadger/">
      <span itemprop="name">pgbadger</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1p/pgbadger.1p.html">
      <span itemprop="name">pgbadger: A fast postgresql log analysis report</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>pgbadger [options] logfile [...]</p>
<pre>
        PostgreSQL log analyzer with fully detailed reports and charts.
</pre>
<p>Arguments:</p><p>    logfile can be a single log file, a list of files, or a shell command     returning a list of files. If you want to pass log content from stdin     use - as filename. Note that input from stdin will not work with csvlog.</p><p>Options:</p><p>    -a | --average minutes : number of minutes to build the average graphs of                              queries and connections.     -b | --begin datetime  : start date/time for the data to be parsed in log.     -c | --dbclient host   : only report on entries for the given client host.     -C | --nocomment       : remove comments like /* ... */ from queries.     -d | --dbname database : only report on entries for the given database.     -e | --end datetime    : end date/time for the data to be parsed in log.     -f | --format logtype  : possible values: syslog,stderr,csv. Default: stderr     -G | --nograph         : disable graphs on HTML output. Enable by default.     -h | --help            : show this message and exit.     -i | --ident name      : programname used as syslog ident. Default: postgres     -j | --jobs number     : number of jobs to run on parallel on each log file.                              Default is 1, run as single process.     -J | --Jobs number     : number of log file to parse in parallel. Default                              is 1, run as single process.     -l | --last-parsed file: allow incremental log parsing by registering the                              last datetime and line parsed. Useful if you want                              to watch errors since last run or if you want one                              report per day with a log rotated each week.     -m | --maxlength size  : maximum length of a query, it will be restricted to                              the given size. Default: no truncate     -n | --nohighlight     : disable SQL code highlighting.     -N | --appname name    : only report on entries for given application name     -o | --outfile filename: define the filename for output. Default depends on                              the output format: out.html, out.txt or out.tsung.                              To dump output to stdout use - as filename.     -p | --prefix string   : give here the value of your custom log_line_prefix                              defined in your postgresql.conf. Only use it if you                              aren&apos;t using one of the standard prefixes specified                              in the pgBadger documentation, such as if your prefix                              includes additional variables like client ip or                              application name. See examples below.     -P | --no-prettify     : disable SQL queries prettify formatter.     -q | --quiet           : don&apos;t print anything to stdout, even not a progress bar.     -s | --sample number   : number of query samples to store/display. Default: 3     -S | --select-only     : use it if you want to report select queries only.     -t | --top number      : number of queries to store/display. Default: 20     -T | --title string    : change title of the HTML page report.     -u | --dbuser username : only report on entries for the given user.     -U | --exclude-user username : exclude entries for the specified user from report.     -v | --verbose         : enable verbose or debug mode. Disabled by default.     -V | --version         : show pgBadger version and exit.     -w | --watch-mode      : only report errors just like logwatch could do.     -x | --extension       : output format. Values: text, html or tsung. Default: html     -z | --zcat exec_path  : set the full path to the zcat program. Use it if                              zcat or bzcat or unzip is not on your path.     --pie-limit num        : pie data lower than num% will show a sum instead.     --exclude-query regex  : any query matching the given regex will be excluded                              from the report. For example: "^(VACUUM|COMMIT)"                              You can use this option multiple times.     --exclude-file filename: path of the file which contains all the regex to use                              to exclude queries from the report. One regex per line.     --include-query regex  : any query that does not match the given regex will be                              excluded from the report. For example: "(table_1|table_2)"                              You can use this option multiple times.     --include-file filename: path of the file which contains all the regex of the                              queries to include from the report. One regex per line.     --disable-error        : do not generate error report.     --disable-hourly       : do not generate hourly report.     --disable-type         : do not generate query type report.     --disable-query        : do not generate query reports (slowest, most                              frequent, ...).     --disable-session      : do not generate session report.     --disable-connection   : do not generate connection report.     --disable-lock         : do not generate lock report.     --disable-temporary    : do not generate temporary report.     --disable-checkpoint   : do not generate checkpoint report.     --disable-autovacuum   : do not generate autovacuum report.</p><p>Examples:</p><p>        pgbadger /var/log/postgresql.log         pgbadger /var/log/postgres.log.2.gz /var/log/postgres.log.1.gz /var/log/postgres.log         pgbadger /var/log/postgresql/postgresql-2012-05-*         pgbadger --exclude-query="^(COPY|COMMIT)" /var/log/postgresql.log         pgbadger -b "2012-06-25 10:56:11" -e "2012-06-25 10:59:11" /var/log/postgresql.log         cat /var/log/postgres.log | pgbadger -         # log prefix with stderr log output         perl pgbadger --prefix &apos;%t [%p]: [%l-1] user=%u,db=%d,client=%h&apos; &#92;                         /pglog/postgresql-2012-08-21*         perl pgbadger --prefix &apos;%m %u@%d %p %r %a : &apos; /pglog/postgresql.log         # Log line prefix with syslog log output         perl pgbadger --prefix &apos;user=%u,db=%d,client=%h,appname=%a&apos; &#92;                         /pglog/postgresql-2012-08-21*</p><p>Use my 8 CPUs to parse my 10GB file faster, really faster</p><p>        perl pgbadger -j 8 /pglog/postgresql-9.1-main.log</p><p>Generate Tsung sessions \s-1XML\s0 file with select queries only:</p><p>    perl pgbadger -S -o sessions.tsung --prefix &apos;%t [%p]: [%l-1] user=%u,db=%d &apos; /pglog/postgresql-9.1.log</p><p>Reporting errors every week by cron job:</p><p>    30 23 * * 1 /usr/bin/pgbadger -q -w /var/log/postgresql.log -o /var/reports/pg_errors.html</p><p>Generate report every week using incremental behavior:</p><p>    0 4 * * 1 /usr/bin/pgbadger -q &#96;find /var/log/ -mtime -7 -name "postgresql.log*"&#96; &#92;         -o /var/reports/pg_errors-&#96;date +%F&#96;.html -l /var/reports/pgbadger_incremental_file.dat</p><p>This supposes that your log file and \s-1HTML\s0 report are also rotated every week.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>pgBadger is a PostgreSQL log analyzer built for speed with fully detailed reports from your PostgreSQL log file. It's a single and small Perl script that aims to replace and out-perform the old \s-1PHP\s0 script pgFouine.</p><p>By the way, we would like to thank Guillaume Smet for all the work he has done on this really nice tool. We've been using it a long time, it is a really great tool!</p><p>pgBadger is written in pure Perl language. It uses a Javascript library to draw graphs so that you don't need additional Perl modules or any other package to install. Furthermore, this library gives us additional features, such as zooming.</p><p>pgBadger is able to autodetect your log file format (syslog, stderr or csvlog). It is designed to parse huge log files, as well as gzip, zip or bzip2 compressed files. See a complete list of features below.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FEATURE</h2>
        <div class="sectioncontent">
<p>pgBadger reports everything about your \s-1SQL\s0 queries:</p><p>        Overall statistics.         The most frequent waiting queries.         Queries that waited the most.         Queries generating the most temporary files.         Queries generating the largest temporary files.         The slowest queries.         Queries that took up the most time.         The most frequent queries.         The most frequent errors.</p><p>The following reports are also available with hourly charts:</p><p>        Hourly queries statistics.         Hourly temporary file statistics.         Hourly checkpoints statistics.         Hourly restartpoints statistics.         Locks statistics.         Queries by type (select/insert/update/delete).         Distribution of queries type per database/application         Sessions per database/user/client.         Connections per database/user/client.         Autovacuum and autoanalyze per table.</p><p>All charts are zoomable and can be saved as \s-1PNG\s0 images. \s-1SQL\s0 queries reported are highlighted and beautified automatically.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REQUIREMENT</h2>
        <div class="sectioncontent">
<p>pgBadger comes as a single Perl script - you do not need anything other than a modern Perl distribution. Charts are rendered using a Javascript library so you don't need anything. Your browser will do all the work.</p><p>If you planned to parse PostgreSQL \s-1CSV\s0 log files you might need some Perl Modules:</p><p>        Text::CSV_XS - to parse PostgreSQL CSV log files.</p><p>This module is optional, if you don't have PostgreSQL log in the \s-1CSV\s0 format you don't need to install it.</p><p>Compressed log file format is autodetected from the file exension. If pgBadger find a gz extension it will use the zcat utility, with a bz2 extension it will use bzcat and if the file extension is zip then the unzip utility will be used.</p><p>If those utilities are not found in the \s-1PATH\s0 environment variable then use the --zcat command line option to change this path. For example:</p><p>        --zcat="/usr/local/bin/gunzip -c" or --zcat="/usr/local/bin/bzip2 -dc"         --zcat="C:&#92;tools&#92;unzip -p"</p><p>By default pgBadger will use the zcat, bzcat and unzip utilities following the file extension. If you use the default autodetection compress format you can mixed gz, bz2 or zip files. Specifying a custom value to --zcat option will remove this feature of mixed compressed format.</p><p>Note that multiprocessing can not be used with compressed files or \s-1CSV\s0 files as well as under Windows platform.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">POSTGRESQL CONFIGURATION</h2>
        <div class="sectioncontent">
<p>You must enable and set some configuration directives in your postgresql.conf before starting.</p><p>You must first enable \s-1SQL\s0 query logging to have something to parse:</p><p>        log_min_duration_statement = 0</p><p>Here every statement will be logged, on busy server you may want to increase this value to only log queries with a higher duration time. Note that if you have log_statement set to 'all' nothing will be logged with log_line_prefix. See next chapter for more information.</p><p>With 'stderr' log format, log_line_prefix must be at least:</p><p>        log_line_prefix = &apos;%t [%p]: [%l-1] &apos;</p><p>Log line prefix could add user and database name as follows:</p><p>        log_line_prefix = &apos;%t [%p]: [%l-1] user=%u,db=%d &apos;</p><p>or for syslog log file format:</p><p>        log_line_prefix = &apos;user=%u,db=%d &apos;</p><p>Log line prefix for stderr output could also be:</p><p>        log_line_prefix = &apos;%t [%p]: [%l-1] db=%d,user=%u &apos;</p><p>or for syslog output:</p><p>        log_line_prefix = &apos;db=%d,user=%u &apos;</p><p>You need to enable other parameters in postgresql.conf to get more information from your log files:</p><p>        log_checkpoints = on         log_connections = on         log_disconnections = on         log_lock_waits = on         log_temp_files = 0</p><p>Do not enable log_statement as their log format will not be parsed by pgBadger.</p><p>Of course your log messages should be in English without locale support:</p><p>        lc_messages=&apos;C&apos;</p><p>but this is not only recommended by pgBadger.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">log_min_duration_statement, log_duration and log_statement</h2>
        <div class="sectioncontent">
<p>If you want full statistics reports you must set log_min_duration_statement to 0 or more milliseconds.</p><p>If you just want to report duration and number of queries and don't want all details about queries, set log_min_duration_statement to -1 to disable it and enable log_duration in your postgresql.conf file. If you want to add the most common request report you can either choose to set log_min_duration_statement to a higher value or choose to enable log_statement.</p><p>Enabling log_min_duration_statement will add reports about slowest queries and queries that took up the most time. Take care that if you have log_statement set to 'all' nothing will be logged with log_line_prefix.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Parallel processing</h2>
        <div class="sectioncontent">
<p>To enable parallel processing you just have to use the -j N option where N is the number of cores you want to use.</p><p>pgbadger will then proceed as follow:</p><p>        for each log file             chunk size = int(file size / N)             look at start/end offsets of these chunks             fork N processes and seek to the start offset of each chunk                 each process will terminate when the parser reach the end offset                 of its chunk                 each process write stats into a binary temporary file            wait for all children has terminated         All binary temporary files generated will then be read and loaded into         memory to build the html output.</p><p>With that method, at start/end of chunks pgbadger may truncate or omit a maximum of N queries perl log file which is an insignificant gap if you have millions of queries in your log file. The chance that the query that you were looking for is loose is near 0, this is why I think this gap is livable. Most of the time the query is counted twice but truncated.</p><p>When you have lot of small log files and lot of CPUs it is speedier to dedicate one core to one log file at a time. To enable this behavior you have to use option -J N instead. With 200 log files of 10MB each the use of the -J option start being really interesting with 8 Cores. Using this method you will be sure to not loose any queries in the reports.</p><p>He are a benchmarck done on a server with 8 CPUs and a single file of 9.5GB.</p><p>         Option |  1 CPU  | 2 CPU | 4 CPU | 8 CPU         --------+---------+-------+-------+------            -j   | 1h41m18 | 50m25 | 25m39 | 15m58            -J   | 1h41m18 | 54m28 | 41m16 | 34m45</p><p>With 200 log files of 10MB each and a total og 2GB the results are slightly different:</p><p>         Option | 1 CPU | 2 CPU | 4 CPU | 8 CPU         --------+-------+-------+-------+------            -j   | 20m15 |  9m56 |  5m20 | 4m20            -J   | 20m15 |  9m49 |  5m00 | 2m40</p><p>So it is recommanded to use -j unless you have hundred of small log file and can use at least 8 CPUs.</p><p>\s-1IMPORTANT:\s0 when you are using parallel parsing pgbadger will generate a lot of temporary files in the /tmp directory and will remove them at end, so do not remove those files unless pgbadger is not running. They are all named with the following template tmp_pgbadgerXXXX.bin so they can be easily identified.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">INSTALLATION</h2>
        <div class="sectioncontent">
<p>Download the tarball from github and unpack the archive as follow:</p><p>        tar xzf pgbadger-3.x.tar.gz         cd pgbadger-3.x/         perl Makefile.PL         make && sudo make install</p><p>This will copy the Perl script pgbadger to /usr/local/bin/pgbadger by default and the man page into /usr/local/share/man/man1/pgbadger.1. Those are the default installation directories for 'site' install.</p><p>If you want to install all under /usr/ location, use INSTALLDIRS='perl' as an argument of Makefile.PL. The script will be installed into /usr/bin/pgbadger and the manpage into /usr/share/man/man1/pgbadger.1.</p><p>For example, to install everything just like Debian does, proceed as follows:</p><p>        perl Makefile.PL INSTALLDIRS=vendor</p><p>By default \s-1INSTALLDIRS\s0 is set to site.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>pgBadger is an original work from Gilles Darold. It is maintained by the good folk at Dalibo and everyone who wants to contribute.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LICENSE</h2>
        <div class="sectioncontent">
<p>pgBadger is free software distributed under the PostgreSQL Licence.</p><p>Copyright (c) 2012-2013, Dalibo</p><p>A modified version of the SQL::Beautify Perl Module is embedded in pgBadger with copyright (C) 2009 by Jonas Kramer and is published under the terms of the Artistic License 2.0.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="perldig.1p.html"><span aria-hidden="true">&larr;</span> perldig.1p: </a></li>
   <li class="next"><a href="pm-uninstall.1p.html">pm-uninstall.1p:  <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
