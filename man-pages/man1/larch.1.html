<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>larch: Copy messages from one imap server to another</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Copy messages from one imap server to another">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="larch (1) manual">
  <meta name="twitter:description" content="Copy messages from one imap server to another">
  <meta name="twitter:image" content="https://www.carta.tech/images/larch-larch-1.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man1/larch.1.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="larch (1) manual" />
  <meta property="og:description" content="Copy messages from one imap server to another" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/larch-larch-1.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">larch<small> (1)</small></h1>
        <p class="lead">Copy messages from one imap server to another</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/">
      <span itemprop="name">Executable programs or shell commands</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/larch.1.html">
      <span itemprop="name">larch: Copy messages from one imap server to another</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/larch/">
      <span itemprop="name">larch</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man1/larch.1.html">
      <span itemprop="name">larch: Copy messages from one imap server to another</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>larch</strong> [<em>options</em>]</p><p><strong>larch</strong> [<strong>--from</strong> <em>URI</em>] [<strong>--to</strong> <em>URI</em>]</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>Larch</strong> is a tool to copy messages from one IMAP server to another quickly and safely. It's smart enough not to copy messages that already exist on the destination and robust enough to deal with interruptions caused by flaky connections or misbehaving servers.</p><p><strong>Larch</strong> is particularly well-suited for copying email to, from, or between Gmail accounts.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<h3>Server options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--from</strong>, <strong>-f</strong> <strong></strong><em>URI</em></p>
  </dt>
  <dd>
    <p>URI of the source IMAP server.</p>
  </dd>
  <dt>
    <p><strong>--from-folder</strong>, <strong>-F</strong> <strong></strong><em>FOLDER</em></p>
  </dt>
  <dd>
    <p>Source folder to copy from. Default is INBOX.</p>
  </dd>
  <dt>
    <p><strong>--from-pass</strong>, <strong>-p</strong> <strong></strong><em>PASSWD</em></p>
  </dt>
  <dd>
    <p>Source server password. Default is to prompt the user.</p>
  </dd>
  <dt>
    <p><strong>--from-user</strong>, <strong>-u</strong> <strong></strong><em>USER</em></p>
  </dt>
  <dd>
    <p>Source server username. Default is to prompt the user.</p>
  </dd>
  <dt>
    <p><strong>--to</strong>, <strong>-t</strong> <strong></strong><em>URI</em></p>
  </dt>
  <dd>
    <p>URI of the destination IMAP server.</p>
  </dd>
  <dt>
    <p><strong>--to-folder</strong>, <strong>-T</strong> <strong></strong><em>FOLDER</em></p>
  </dt>
  <dd>
    <p>Destination folder to copy to. Default is INBOX.</p>
  </dd>
  <dt>
    <p><strong>--to-pass</strong>, <strong>-P</strong> <strong></strong><em>PASSWD</em></p>
  </dt>
  <dd>
    <p>Destination server password. Default is to prompt the user.</p>
  </dd>
  <dt>
    <p><strong>--to-user</strong>, <strong>-U</strong> <strong></strong><em>USER</em></p>
  </dt>
  <dd>
    <p>Destination server username. Default is to prompt the user.</p>
  </dd>

</dl>

<h3>Copy options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--all</strong>, <strong>-a</strong></p>
  </dt>
  <dd>
    <p>Copy all folders recursively.</p>
  </dd>
  <dt>
    <p><strong>--all-subscribed</strong>, <strong>-s</strong></p>
  </dt>
  <dd>
    <p>Copy all subscribed folders recursively.</p>
  </dd>
  <dt>
    <p><strong>--delete</strong>, <strong>-d</strong></p>
  </dt>
  <dd>
    <p>Delete messages from the source after copying them, or if they already exist at the destination.</p>
  </dd>
  <dt>
    <p><strong>--exclude</strong> <strong></strong><em>PATTERN</em> [ <strong></strong><em>PATTERN</em>... ]</p>
  </dt>
  <dd>
    <p>List of mailbox names/patterns that shouldn't be copied.</p>
  </dd>
  <dt>
    <p><strong>--exclude-file</strong> <strong></strong><em>FILE</em></p>
  </dt>
  <dd>
    <p>Filename containing mailbox names/patterns that shouldn't be copied.</p>
  </dd>
  <dt>
    <p><strong>--expunge</strong>, <strong>-x</strong></p>
  </dt>
  <dd>
    <p>Expunge deleted messages from the source.</p>
  </dd>
  <dt>
    <p><strong>--sync-flags</strong>, <strong>-S</strong></p>
  </dt>
  <dd>
    <p>Sync message flags from the source to the destination for messages that already exist at the destination.</p>
  </dd>

</dl>

<h3>General options</h3>

<dl class='dl-vertical'>
  <dt>
    <p><strong>--config</strong>, <strong>-c</strong> <strong></strong><em>FILE</em></p>
  </dt>
  <dd>
    <p>Specify a non-default config file to use. Default is ~/.larch/config.yaml.</p>
  </dd>
  <dt>
    <p><strong>--database</strong> <strong></strong><em>FILE</em></p>
  </dt>
  <dd>
    <p>Specify a non-default message database to use. Default is ~/.larch/larch.db.</p>
  </dd>
  <dt>
    <p><strong>--dry-run</strong>, <strong>-n</strong></p>
  </dt>
  <dd>
    <p>Don't actually make any changes.</p>
  </dd>
  <dt>
    <p><strong>--max-retries</strong> <strong></strong><em>NUM</em></p>
  </dt>
  <dd>
    <p>Maximum number of times to retry after a recoverable error. Default is 3.</p>
  </dd>
  <dt>
    <p><strong>--no-create-folder</strong></p>
  </dt>
  <dd>
    <p>Don't create destination folders that don't already exist.</p>
  </dd>
  <dt>
    <p><strong>--ssl-certs</strong> <strong></strong><em>FILE</em></p>
  </dt>
  <dd>
    <p>Path to a trusted certificate bundle to use to verify server SSL certificates.</p>
  </dd>
  <dt>
    <p><strong>--ssl-verify</strong></p>
  </dt>
  <dd>
    <p>Verify server SSL certificates.</p>
  </dd>
  <dt>
    <p><strong>--verbosity</strong>, <strong>-V</strong> <strong></strong><em>STR</em></p>
  </dt>
  <dd>
    <p>Output verbosity: debug, info, warn, error, or fatal. Default is info.</p>
  </dd>
  <dt>
    <p><strong>--version</strong>, <strong>-v</strong></p>
  </dt>
  <dd>
    <p>Print version and exit.</p>
  </dd>
  <dt>
    <p><strong>--help</strong>, <strong>-h</strong></p>
  </dt>
  <dd>
    <p>Show a help message.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONFIGURATION</h2>
        <div class="sectioncontent">
<p>While it's possible to control <strong>Larch</strong> entirely from the command line, this can be inconvenient if you need to specify a lot of options or if you run <strong>Larch</strong> frequently and can't always remember which options to use. Using a configuration file can simplify things.</p><p>By default, <strong>Larch</strong> looks for a config file at <strong>~/.larch/config.yaml</strong> and uses it if found. You may specify a custom config file using the <strong>--config</strong> command line option.</p><p>The <strong>Larch</strong> configuration file is a simple &#92;$2 \(laURL: &#92;$1 \(ra&#92;$3 file that may contain multiple sections, each with a different set of options, as well as a special <em>default</em> section. The options in the <em>default</em> section will be used unless they're overridden either in another config section or on the command line.</p><p>Here's a sample Larch config file:</p>
<pre>
# Copy all subscribed folders by default
default:
  all-subscribed: true

# Copy mail from Gmail to my server, excluding stuff I don't want.
gmail to my server:
  from: imaps://imap.gmail.com
  from-user: example
  from-pass: secret

  to: imaps://mail.example.com
  to-user: example
  to-pass: secret

  exclude:
    - "[Gmail]/Sent Mail"
    - "[Gmail]/Spam"
    - "[Gmail]/Trash"

# Copy mail from my INBOX to Gmail's INBOX
my inbox to gmail inbox:
  all-subscribed: false

  from: imaps://mail.example.com
  from-folder: INBOX
  from-user: example
  from-pass: secret

  to: imaps://imap.gmail.com
  to-folder: INBOX
  to-user: example
  to-pass: secret
</pre>
<p>This file contains three sections. The options from <em>default</em> will be used in all other sections as well unless they're overridden.</p><p>To specify which config section you want Larch to use, just pass its name on the command line (use quotes if the name contains spaces):</p>
<pre>
larch &apos;gmail to my server&apos;
</pre>
<p>If you specify additional command line options, they'll override options in the config file:</p>
<pre>
larch &apos;gmail to my server&apos; --from-user anotheruser
</pre>
<p>Running Larch with no command line arguments will cause the <em>default</em> section to be used. With the example above, this will result in an error since the <em>default</em> section doesn't contain the required <em>from</em> and <em>to</em> options, but if you only need to use Larch with a single configuration, you could use the <em>default</em> section for everything and save yourself some typing on the command line.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p><em></em> ~/.larch/config.yaml</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">
<h3>Server compatibility</h3>
<p>Larch should work well with any server that properly supports , and does its best to get along with servers that have buggy, unreliable, or incomplete IMAP implementations.</p><p>Larch has been tested on and is known to work well with the following IMAP servers:</p><ul>
<li><p><strong>Dovecot</strong></p></li><li><p><strong>Gmail</strong></p></li><li><p><strong>Microsoft Exchange 2003</strong></p></li>
</ul><p>The following servers are known to work, but with caveats:</p><ul>
<li><p><strong>Yahoo! Mail</strong></p></li>
</ul><p>The following servers do not work well with Larch:</p><ul>
<li><p><strong>BlitzMail</strong> Buggy server implementation; fails to properly quote or escape some IMAP responses, which can cause Net::IMAP to hang waiting for a terminating character that will never arrive.</p></li>
</ul>
<h3>Gmail quirks</h3>
<p>Gmail's IMAP implementation is quirky. Larch does its best to work around these quirks whenever possible, but here are a few things to watch out for:</p><p><strong>Some messages could not be FETCHed </strong>error</p><p>This error indicates that a message on Gmail is corrupt, and Gmail itself is unable to read it. The message will continue to show up in the mailbox, but all attempts to access it via IMAP, POP, or the Gmail web interface will result in errors. Larch will try to skip these messages and continue processing others if possible.</p><p>It's not clear how this corruption occurs or exactly what kind of corruption causes these errors, although in every case I'm aware of, the corrupt message has originated outside of Gmail (Gmail itself does not corrupt the message). There is currently no known solution for this problem apart from deleting the corrupted messages.</p><p><strong>Folder names cannot contain leading or trailing whitespace</strong></p><p>Most IMAP servers allow folder names to contain leading and trailing whitespace, such as "  folder  ". Gmail does not. When copying folders to Gmail, Larch will automatically remove leading and trailing whitespace in folder names to prevent errors.</p>
<h3>Yahoo! mail quirks</h3>
<p>Yahoo! doesn't officially support IMAP access for general usage, but Larch is able to connect to imap.mail.yahoo.com and imap-ssl.mail.yahoo.com by using a fairly well-known trick. That said, as with anything tricky, there are caveats.</p><p><strong>No hierarchical folders</strong></p><p>Similar to Gmail, Yahoo! Mail doesn't allow hierarchical (nested) folders. If you try to copy a folder hierarchy to Yahoo!, it will work, but you'll end up with a set of folders named "folder" and "folder.subfolder" rather than seeing "subfolder" as an actual subfolder of "folder".</p><p><strong>No custom flags</strong></p><p>Yahoo! Mail IMAP doesn't support custom message flags, such as the tags and junk/not junk flags used by Thunderbird. When transferring messages with custom flags to a Yahoo! Mail IMAP account, the custom flags will be lost.</p><p><strong>Here there be dragons</strong></p><p>Larch's support for Yahoo! Mail is very new and very lightly tested. Given its newness and the fact that Yahoo!'s IMAP gateway isn't official, there are likely to be other quirks we're not yet aware of. There's also no guarantee that Yahoo!  won't shut down its IMAP gateway, deprecate the trick Larch uses to connect, or just outright block Larch. Use at your own risk.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Larch uses Ruby's Net::IMAP standard library for all IMAP operations. While Net::IMAP is generally a very solid library, it contains a bug that can cause a deadlock to occur if a connection drops unexpectedly (either due to network issues or because the server closed the connection without warning) when the server has already begun sending a response and Net::IMAP is waiting to receive more data. If this happens, Net::IMAP will continue waiting forever without passing control back to Larch, and you will need to manually kill and restart Larch.</p><p>Net::IMAP in Ruby 1.8 has also been known to hang when it can't parse a server response, either because the response itself is malformed or because of a bug in Net::IMAP's parser. This is rare, but it happens. Unfortunately there's nothing Larch can do about this.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p><strong>Larch</strong> is run from the command line. The following examples demonstrate how to run <strong>Larch</strong> using only command line arguments, but you may also place these options in a config file and run <strong>Larch</strong> without any arguments if you prefer.</p><p>At a minimum, you must <em>specify a source server and a destination server</em> in the form of IMAP URIs:</p>
<pre>
larch --from imap://mail.example.com &#92;
      --to imap://imap.gmail.com
</pre>
<p><strong>Larch</strong> will prompt you for the necessary usernames and passwords, then sync the contents of the source's INBOX folder to the destination's INBOX folder.</p><p>To <em>connect using SSL</em>, specify a URI beginning with <strong>imaps://</strong>:</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com
</pre>
<p>If you'd like to <em>sync a specific folder</em> other than INBOX, specify the source and destination folders using <strong>--from-folder</strong> and <strong>--to-folder</strong>. Folder names containing spaces must be enclosed in quotes:</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com &#92;
      --from-folder &apos;Sent Mail&apos; --to-folder &apos;Sent Mail&apos;
</pre>
<p>To <em>sync all folders</em>, use the <strong>--all</strong> option (or <strong>--all-subscribed</strong> if you only want to <em>sync subscribed folders</em>):</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com --all
</pre>
<p>By default <strong>Larch</strong> will create folders on the destination server if they don't already exist. To prevent this, add the <strong>--no-create-folder</strong> option:</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com --all &#92;
      --no-create-folder
</pre>
<p>You can <em>prevent Larch from syncing one or more folders</em> by using the <strong>--exclude</strong> option, which accepts multiple arguments:</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com --all &#92;
      --exclude Spam Trash Drafts "[Gmail]/*"
</pre>
<p>If your exclusion list is long or complex, create a text file with one exclusion pattern per line and tell <strong>Larch</strong> to load it with the <strong>--exclude-file</strong> option:</p>
<pre>
larch --from imaps://mail.example.com &#92;
      --to imaps://imap.gmail.com --all &#92;
      --exclude-file exclude.txt
</pre>
<p>The wildcard characters <strong>*</strong> and <strong>?</strong> are supported in exclusion lists. You may also use a regular expression by enclosing a pattern in forward slashes, so the previous example could be achieved with the pattern <strong>/(Spam|Trash|Drafts|&#92;[Gmail\]&#92;/.*)/</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Adapted from the program's documentation for Debian by Martín Ferrari &lt;tincho@tincho.org&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="lapcat.1.html"><span aria-hidden="true">&larr;</span> lapcat.1: Location aware proxy chooser and tunneler</a></li>
   <li class="next"><a href="las2las.1.html">las2las.1: Advanced las filtering and manipulation <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
