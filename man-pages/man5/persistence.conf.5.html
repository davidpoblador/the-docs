<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>persistence.conf: Configuration file for persistence media in live-boot</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Configuration file for persistence media in live-boot">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="persistence.conf (5) manual">
  <meta name="twitter:description" content="Configuration file for persistence media in live-boot">
  <meta name="twitter:image" content="https://www.carta.tech/images/live-boot-doc-persistence.conf-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/persistence.conf.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="persistence.conf (5) manual" />
  <meta property="og:description" content="Configuration file for persistence media in live-boot" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/live-boot-doc-persistence.conf-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">persistence.conf<small> (5)</small></h1>
        <p class="lead">Configuration file for persistence media in live-boot</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/persistence.conf.5.html">
      <span itemprop="name">persistence.conf: Configuration file for persistence media in live-boot</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/live-boot-doc/">
      <span itemprop="name">live-boot-doc</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/persistence.conf.5.html">
      <span itemprop="name">persistence.conf: Configuration file for persistence media in live-boot</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>If live-boot probes a persistence volume with the label (or GPT name, or file name, but from now on we will just say "label") "persistence", that volume's persistence is fully customizable through the <strong>persistence.conf</strong> file stored on the root of its file system. Any such labeled volume must have such a file, or it will be ignored.</p><p>The format of <strong>persistence.conf</strong> allows empty lines and lines starting with a "#" (used for comments), both which will be ignored. A so called "custom mount" has the format:</p><p><em>DIR</em> [<em>OPTION</em>]...</p><p>which roughly translates to "make <em>DIR</em> persistence in the way described by the list of <em>OPTION</em>s".</p><p>For each custom mount <em>DIR</em> must be an absolute path that cannot contain white spaces or the special . and .. path components, and cannot be /live (or any of its sub-directories). Once activated all changes (file deletion, creation and modification) to <em>DIR</em> on the live file system are stored persistently into a path equivalent to <em>DIR</em> on the persistence media, called the source directory. The default way to achieve persistence is to simply bind-mount the corresponding source directory to <em>DIR</em>, but this can be changed through the use of <em>OPTION</em>s.</p><p>All custom mounts will be done in an order so that no two custom mounts can "hide" each other. For instance, if we have the two <em>DIR</em>:s /a and /a/b it would always be the case that /a is mounted first, then /a/b. This remains true no matter how the lines in <strong>persistence.conf</strong> are ordered, or if several <strong>persistence.conf</strong> files on different persistence media are used at the same time. However, it is forbidden for custom mounts to have their source directory inside the source directory of another custom mount, so the source directories that are auto-created by live-boot does not support "nested" mounts like /a and /a/b on the same media. In this case you must use the <strong>source</strong> option (see below) to make sure that they are stored in different source directories.</p><p>When a source directory doesn't exist on the persistence media for a certain custom mount, it will be created automatically, and permissions and ownership will be optimistically set according to <em>DIR</em>. It will also be bootstrapped by copying the contents of the <em>DIR</em> into its source directory on the persistence media. The bootstrapping will not happen when the <strong>link</strong> or <strong>union</strong> options are used (see below).</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OPTIONS</h2>
        <div class="sectioncontent">
<p>Custom mounts defined in <strong>persistence.conf</strong> accept the following options in a comma-separated list:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>source</strong>=<em>PATH</em>
  </dt>
  <dd>
    <p>When given, store the persistence changes into <em>PATH</em> on the persistence media. <em>PATH</em> must be a relative path (with respect to the persistence media root) that cannot contain white spaces or the special . or .. path components, with the exception that it can be just . which means the persistence media root. This option is mostly relevant if you want to nest custom mounts, which otherwise would cause errors, or if you want to make the whole media root available (similar to the now deprecated <strong>home-rw</strong> type of persistence).</p>
  </dd>

</dl>
<p>The following options are mutually exclusive (only the last given one will be in effect):</p>
<dl class='dl-vertical'>
  <dt>
    <strong>bind</strong>
  </dt>
  <dd>
    <p>Bind-mount the source directory to <em>DIR</em>. This is the default.</p>
  </dd>
  <dt>
    <strong>link</strong>
  </dt>
  <dd>
    <p>Create the directory structure of the source directory on the persistence media in <em>DIR</em> and create symbolic links from the corresponding place in <em>DIR</em> to each file in the source directory. Existing files or directories with the same name as any link will be overwritten. Note that deleting the links in <em>DIR</em> will only remove the link, not the corresponding file in the source; removed links will reappear after a reboot. To permanently add or delete a file one must do so directly in the source directory.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>Effectively <strong>link</strong> will make only files already in the source directory persistent, not any other files in <em>DIR</em>. These files must be manually added to the source directory to make use of this option, and they will appear in <em>DIR</em> in addition to files already there. This option is useful when only certain files need to be persistent, not the whole directory they're in, e.g. some configuration files in a user's home directory.</p>
  </dd>
  <dt>
    <strong>union</strong>
  </dt>
  <dd>
    <p>Save the rw branch of a union on the persistence media, so only the changes are stored persistently. This can potentially reduce disk usage compared to bind-mounts, and will not hide files added to the read-only media. One caveat is that the union will use <em>DIR</em> from the image's read-only file system, not the real file system root, so files created after boot (e.g. by live-config) will not appear in the union. This option will use the union file system specified by live-boot's <strong>union</strong> boot parameter, but is not supported with <strong>union=unionmount</strong>.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DIRECTORIES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>/live/persistence</strong>
  </dt>
  <dd>
    <p>All persistence volumes will be mounted here (in a directory corresponding to the device name). The <strong>persistence.conf</strong> file can easily be edited through this mount, as well as any source directories (which is especially practical for custom mounts using the <strong>link</strong> option).</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Let's say we have a persistence volume <em>VOL</em> with the a <strong>persistence.conf</strong> file containing the following four lines (numbered for ease of reference):</p>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p>/home/user1 link,source=config-files/user1</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p>/home/user2 link,source=config-files/user2</p>
  </dd>
  <dt>
    <p>3.</p>
  </dt>
  <dd>
    <p>/home</p>
  </dd>
  <dt>
    <p>4.</p>
  </dt>
  <dd>
    <p>/usr union</p>
  </dd>

</dl>
<p>The corresponding source directories are:</p>
<dl class='dl-vertical'>
  <dt>
    <p>1.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/config-files/user1 (but it would be <em>VOL</em>/home/user1 without the <strong>source</strong> option)</p>
  </dd>
  <dt>
    <p>2.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/config-files/user2 (but it would be <em>VOL</em>/home/user2 without the <strong>source</strong> option)</p>
  </dd>
  <dt>
    <p>3.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/home</p>
  </dd>
  <dt>
    <p>4.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/usr</p>
  </dd>

</dl>
<p>It was necessary to set the <strong>source</strong> options for 1 and 2, since they otherwise would become nested with 3's source, which is invalid.</p><p>Line 3 will be taken care of before line 1 and 2 in order to prevent custom mounts 1 and 2 from being hidden by 3. When line 3 is handled, <em>VOL</em>/home is simply bind-mounted on /home. To illustrate what happens for lines 1 and 2, let's say that the following files exist:</p>
<dl class='dl-vertical'>
  <dt>
    <p>a.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/config-files/user1/.emacs</p>
  </dd>
  <dt>
    <p>b.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/config-files/user2/.bashrc</p>
  </dd>
  <dt>
    <p>c.</p>
  </dt>
  <dd>
    <p><em>VOL</em>/config-files/user2/.ssh/config</p>
  </dd>

</dl>
<p>Then the following links and directories will be created:</p>
<dl class='dl-vertical'>
  <dt>
    <p>Link:</p>
  </dt>
  <dd>
    <p>/home/user1/.emacs -&gt; <em>VOL</em>/config-files/user1/.emacs (from a)</p>
  </dd>
  <dt>
    <p>Link:</p>
  </dt>
  <dd>
    <p>/home/user2/.bashrc -&gt; <em>VOL</em>/config-files/user2/.bashrc (from b)</p>
  </dd>
  <dt>
    <p>Dir:</p>
  </dt>
  <dd>
    <p>/homea/user2/.ssh (from c)</p>
  </dd>
  <dt>
    <p>Link:</p>
  </dt>
  <dd>
    <p>/home/user2/.ssh/config -&gt; <em>VOL</em>/config-files/user2/.ssh/config (from c)</p>
  </dd>

</dl>
<p>One could argue, though, that lines 1 and 2 in the example <strong>persistence.conf</strong> file above are unnecessary since line 3 already would make all of /home persistent. The <strong>link</strong> option is intended for situations where you don't want a complete directory to be persistent, only certain files in it or its sub-directories.</p><p>Line 4 can be mounted at any time since its <em>DIR</em> (and source directory) is completely disjoint from all the other custom mounts. When mounted, <em>VOL</em>/usr will be the rw branch due to the <strong>union</strong> option, and will only contain the difference compared to the underlying read-only file system. Hence packages could be installed into /usr with great space-wise efficiency compared to bind-mounts, since in the latter case all of /usr would have to be copied into <em>VOL</em>/usr during the initial bootstrap.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO persistence.conf&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man7/live-boot.7.html"><strong>live-boot</strong>(7)</a></p><p><a href="../man7/live-build.7.html"><strong>live-build</strong>(7)</a></p><p><a href="../man7/live-config.7.html"><strong>live-config</strong>(7)</a></p><p><a href="../man7/live-tools.7.html"><strong>live-tools</strong>(7)</a></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOMEPAGE</h2>
        <div class="sectioncontent">
<p>More information about live-boot and the Live Systems project can be found on the homepage at &lt;<em>http://live-systems.org/</em>&gt; and in the manual at &lt;<em>http://live-systems.org/manual/</em>&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BUGS</h2>
        <div class="sectioncontent">
<p>Bugs can be reported by submitting a bugreport for the live-boot package in the Bug Tracking System at &lt;<em>http://bugs.debian.org/</em>&gt; or by writing a mail to the Live Systems mailing list at &lt;<em>debian-live@lists.debian.org</em>&gt;.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>live-boot was written by Daniel Baumann &lt;<em>mail@daniel-baumann.ch</em>&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="perditiondb.5.html"><span aria-hidden="true">&larr;</span> perditiondb.5: Perdition modular popmap support</a></li>
   <li class="next"><a href="pfqueue.conf.5.html">pfqueue.conf.5: Pfqueue configuration file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
