<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>srec_fpc: Four packed code file format</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Four packed code file format">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="srec_fpc (5) manual">
  <meta name="twitter:description" content="Four packed code file format">
  <meta name="twitter:image" content="https://www.carta.tech/images/srecord-srec_fpc-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/srec_fpc.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="srec_fpc (5) manual" />
  <meta property="og:description" content="Four packed code file format" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/srecord-srec_fpc-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">srec_fpc<small> (5)</small></h1>
        <p class="lead">Four packed code file format</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/srec_fpc.5.html">
      <span itemprop="name">srec_fpc: Four packed code file format</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/srecord/">
      <span itemprop="name">srecord</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/srec_fpc.5.html">
      <span itemprop="name">srec_fpc: Four packed code file format</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>All ASCII based file formats have one disadvantage in common: they all need more than double the amount of characters as opposed to the number of bytes to be sent.  Address fields and checksums will add even more characters.  So the shorter the records, the more characters have to be sent to get the file across.</p><p>The FPC format may be used to reduce the number of characters needed to send a file in ASCII format, although it still needs more characters than the actual bytes it sends.  FPC stands for "Four Packed Code". The reduction is accomplished by squeezing 4 real bytes into 5 ASCII characters.  In fact every ASCII character will be a digit in the base 85 number system.  There aren't enough letters, digits and punctuation marks available to get 85 different characters, but if we use both upper case and lower case letters we will manage.  This implies that the FPC <em>is</em> case sensitive, as opposed to all other ASCII based file formats.</p><h3>Base 85</h3>
<p>The numbering system is in base 85, and is somewhat hard to understand for us humans who are usually only familiar with base 10 numbers.  Some of us understand base 2 and base 16 as well, but base 85 is for most people something new.  Luckily we don't have to do any math with this number system.  We just convert a 32 bit number into a 5 digit number in base 85. A 32 bit number has a range of 4,294,967,296, while a 5 digit number in base 85 has a range of 4,437,053,125, which is enough to do the trick. One drawback is that we always have to send multiples of 4 bytes, even if we actually want to send 1, 2 or 3 bytes.  Unused bytes are padded with zeroes, and are discarded at the receiving end.</p><p>The digits of the base 85 numbering system start at %, which represents the value of 0.  The highest value of a digit in base 85 is 84, and is represented by the character 'z'.  If you want to check this with a normal ASCII table you will notice that we have used one character too many!  Why?  I don't know, but for some reason we have to skip the '*' character in the row.  This means that after the ')' character follows the '+' character.</p><p>We can use normal number conversion algorithms to generate the FPC digits, with this tiny difference.  We have to check whether the digit is going to be equal or larger than the ASCII value for '*'.  If this is the case we have to increment the digit once to stay clear of the '*'. In base 85 MSD digits go first, like in all number systems!</p><p>The benefit of this all is hopefully clear. For every 4 bytes we only have to send 5 ASCII characters, as opposed to 8 characters for all other formats.</p>
<h3>Records</h3>
<p>Now we take a look at the the formatting of the FPC records.  We look at the record at byte level, not at the actual base 85 encoded level. Only after formatting the FPC record at byte level we convert 4 bytes at a time to a 5 digit base 85 number.  If we don't have enough bytes in the record to fill the last group of 5 digits we will add bytes with the value of 0 behind the record.</p><table class="table table-striped">
<tr>
<th>$</th>
<th>ss</th>
<th>cc</th>
<th>ffff</th>
<th>aaaaaaaa</th>
<th>dddddddd</th></tr>
</table><p>The field are defined as:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>$</strong></p>
  </dt>
  <dd>
    <p>Every line starts with the character $, all other characters are digits of base 85.</p>
  </dd>
  <dt>
    <p>ss</p>
  </dt>
  <dd>
    <p>The checksum. A one byte 2's\[hy]complement checksum of all bytes of the record.</p>
  </dd>
  <dt>
    <p>cc</p>
  </dt>
  <dd>
    <p>The byte\[hy]count. A one byte value, counting all the bytes in the record minus 4.</p>
  </dd>
  <dt>
    <p>ffff</p>
  </dt>
  <dd>
    <p>Format code, a two byte value, defining the record type.</p>
  </dd>
  <dt>
    <p>aaaaaaaa</p>
  </dt>
  <dd>
    <p>The address field. A 4 byte number representing the first address of this record.</p>
  </dd>
  <dt>
    <p>dddddddd</p>
  </dt>
  <dd>
    <p>The actual data of this record.</p>
  </dd>

</dl>

<h3>Record Begin</h3>
<p>Every record begins with the ASCII character "<strong>$</strong>".  No spaces or tabs are allowed in a record.  All other characters in the record are formed by groups of 5 digits of base 85.</p>
<h3>Checksum field</h3>
<p>This field is a one byte 2's\[hy]complement checksum of the entire record. To create the checksum make a one byte sum from all of the bytes from all of the fields of the record:</p><p>Then take the 2's\[hy]complement of this sum to create the final checksum. The 2's\[hy]complement is simply inverting all bits and then increment by 1 (or using the negative operator).  Checking the checksum at the receivers end is done by adding all bytes together including the checksum itself, discarding all carries, and the result must be $00.  The padding bytes at the end of the line, should they exist, should not be included in checksum.  But it doesn't really matter if they are, for their influence will be 0 anyway.</p>
<h3>Byte Count</h3>
<p>The byte count <strong>cc</strong> counts the number of bytes in the current record minus 4.  So only the number of address bytes and the data bytes are counted and not the first 4 bytes of the record (checksum, byte count and format flags).  The byte count can have any value from 0 to 255.</p><p>Usually records have 32 data bytes.  It is not recommended to send too many data bytes in a record for that may increase the transmission time in case of errors.  Also avoid sending only a few data bytes per record, because the address overhead will be too heavy in comparison to the payload.</p>
<h3>Format Flags</h3>
<p>This is a 2 byte number, indicating what format is represented in this record.  Only a few formats are available, so we actually waste 1 byte in each record for the sake of having multiples of 4 bytes.</p><p>Format code 0 means that the address field in this record is to be treated as the absolute address where the first data byte of the record should be stored.</p><p>Format code 1 means that the address field in this record is missing. Simply the last known address of the previous record +1 is used to store the first data byte.  As if the FPC format wasn't fast enough already ;\[hy])</p><p>Format code 2 means that the address field in this record is to be treated as a relative address.  Relative to what is not really clear. The relative address will remain in effect until an absolute address is received again.</p>
<h3>Address Field</h3>
<p>The first data byte of the record is stored in the address specified by the Address field <strong>aaaaaaaa</strong>.  After storing that data byte, the address is incremented by 1 to point to the address for the next data byte of the record.  And so on, until all data bytes are stored.</p><p>The length of the address field is always 4 bytes, if present of course. So the address range for the FPC format is always 2**32.</p><p>If only the address field is given, without any data bytes, the address will be set as starting address for records that have no address field.</p><p>Addresses between records are non sequential.  There may be gaps in the addressing or the address pointer may even point to lower addresses as before in the same file.  But every time the sequence of addressing must be changed, a format 0 record must be used.  Addressing within one single record <em>is</em> sequential of course.</p>
<h3>Data Field</h3>
<p>This field contains 0 or more data bytes.  The actual number of data bytes is indicated by the byte count in the beginning of the record less the number of address bytes.  The first data byte is stored in the location indicated by the address in the address field.  After that the address is incremented by 1 and the next data byte is stored in that new location. This continues until all bytes are stored.  If there are not enough data bytes to obtain a multiple of 4 we use 0x00 as padding bytes at the end of the record.  These padding bytes are ignored on the receiving side.</p>
<h3>End of File</h3>
<p>End of file is recognized if the first four bytes of the record all contain 0x00.  In base 85 this will be \[lq]W$%%%%%\[rq].  This is the only decent way to terminate the file.</p>
<h3>Size Multiplier</h3>
<p>In general, binary data will expand in sized by approximately 1.7 times when represented with this format.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Example</h2>
        <div class="sectioncontent">
<p>Now it's time for an example.  In the first table you can see the byte representation of the file to be transferred.  The 4th row of bytes is not a multiple of 4 bytes.  But that does not matter, for we append $00 bytes at the end until we do have a multiple of 4 bytes.  These padding bytes are not counted in the byte count however!</p>
<pre>
D81400000000B000576F77212044696420796F7520726561
431400000000B0106C6C7920676F207468726F7567682061
361400000000B0206C6C20746861742074726F75626C6520
591100000000B030746F207265616420746869733F000000
00000000
</pre>
<p>Only after converting the bytes to base 85 we get the records of the FPC type file format presented in the next table.  Note that there is always a multiple of 5 characters to represent a multiple of 4 bytes in each record.</p>
<pre>
$kL&@h%%,:,B.&#92;?00EPuX0K3rO0JI))
$;UPR'%%,:&lt;Hn&FCG:at&lt;GVF(;G9wIw
$7FD1p%%,:LHmy:&gt;GTV%/KJ7@GE[kYz
$B[6&#92;;%%,:&#92;KIn?GFWY/qKI1G5:;-_e
$%%%%%
</pre>
<p>As you can see the length of the lines is clearly shorter than the original ASCII lines.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO srec_fpc&hellip;</h2>
        <div class="sectioncontent">
<p>http://sbprojects.fol.nl/knowledge/fileformats/fpc.htm</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This man page was taken from the above Web page. It was written by San Bergmans &lt;sanmail@bigfoot.com&gt;</p><p>For extra points: Who invented this format? Where is it used?</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="srec_forth.5.html"><span aria-hidden="true">&larr;</span> srec_forth.5: Forth file format</a></li>
   <li class="next"><a href="srec_intel.5.html">srec_intel.5: Intel hexadecimal object file format specification <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
