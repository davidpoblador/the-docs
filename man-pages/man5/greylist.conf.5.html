<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>greylist.conf: Milter-greylist configuration file</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Milter-greylist configuration file">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="greylist.conf (5) manual">
  <meta name="twitter:description" content="Milter-greylist configuration file">
  <meta name="twitter:image" content="https://www.carta.tech/images/milter-greylist-greylist.conf-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/greylist.conf.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="greylist.conf (5) manual" />
  <meta property="og:description" content="Milter-greylist configuration file" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/milter-greylist-greylist.conf-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">greylist.conf<small> (5)</small></h1>
        <p class="lead">Milter-greylist configuration file</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/greylist.conf.5.html">
      <span itemprop="name">greylist.conf: Milter-greylist configuration file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/milter-greylist/">
      <span itemprop="name">milter-greylist</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/greylist.conf.5.html">
      <span itemprop="name">greylist.conf: Milter-greylist configuration file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p><strong>greylist.conf</strong> configures <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> operation. The format is simple: each line contains a keyword and optional arguments. Any line starting with a # is considered as a comment and is ignored. Blank lines are ignored as well. Comments at the end of lines are accepted in some situations, but do not take them as granted. A statement can be continued on the next line by using a backslash. Anything after the backslash will be ignored.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">WHITELIST</h2>
        <div class="sectioncontent">
<p>The primary use of <strong>greylist.conf</strong> is to setup <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> whitelist. It also offers a handy blacklist feature. Access-lists (ACL) are used to do that. ACL enable the administrator to specify complex conditions on sender IP, sender DNS address, sender e-mail address, and recipient e-mail address. If support for DNSRBL was built-in, it is even possible to use DNSRBL in ACL.</p><p>An access-list entry starts with the <em>racl</em> keyword followed by an optional id quoted string, then the <em>greylist</em>, <em>whitelist</em>, <em>blacklist</em>, or <em>continue</em> keyword, and by any set of the following clauses: <em>addr</em>, <em>domain</em>, <em>from</em>, <em>rcpt</em>, <em>rcptcount</em>, <em>helo</em>, <em>sm_macro</em>, <em>time</em>, <em>auth</em>, <em>tls</em>, <em>spf</em> (if build with SPF support), <em>geoip</em> (if build with GeoIP support), <em>p0f</em> (if build with p0f support), <em>ldapcheck</em> (if build with --with-openldap), <em>urlcheck</em> (if built with --with-libcurl), <em>dnsrbl</em> (if built with --enable-dnsrbl), and <em>nsupdate</em> (if supported by the DNS resolver). A message will match an ACL entry when it complies with all of its clauses.</p><p>The <em>greylist</em>, <em>whitelist</em>, and <em>blacklist</em> keywords will cause the message to be respectively greylisted, accepted or rejected if all ACL clauses match, and ACL evaluation is terminated there. If an ACL with <em>continue</em> keyword does match, nothing is decided and next ACL are evaluated.</p><p>Clauses can be negated, by prefixing them by the <em>not</em> keyword. Here is the detail of all possible clauses.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>addr</em></p>
  </dt>
  <dd>
    <p>This clause is used to specify a netblock of source IP addresses. The syntax is an IP address followed by a slash and a CIDR netmask. Here is an example:</p><ul>
<li>
<pre>
  racl whitelist addr 127.0.0.0/8
  racl whitelist addr 192.168.3.0/24
  racl whitelist addr ::1
</pre>
</li><li><p>If the netmask is omitted, /32 is assumed for an IPv4 address and /128 is assumed for an IPv6 address.</p></li><li><p>You should at least whitelist localhost (127.0.0.1/8), and if you have some user clients connecting to the machine, you should whitelist the addresses they connect from if you don't want them to get error messages when sending e-mail.</p></li>
</ul>
  </dd>
  <dt>
    <p><em>domain</em></p>
  </dt>
  <dd>
    <p>This clause selects source machines based on their DNS name, performing a suffix search. For instance, this will whitelist any machine in the <em>example.net</em> domain:</p><ul>
<li>
<pre>
  racl whitelist domain example.net
</pre>
</li><li><p>Suffix search matching  means, for example, that gle.com will match google.com. If you want domain names to match on subdomain boundaries (e.g.  gle.com will match mail.gle.com and gle.com but not google.com) then enable <em>domainexact</em></p></li>
</ul>
  </dd>

</dl>
<p>The name resolution is made by Sendmail, which hands it to <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong>. As a result, it is impossible to use DNS aliases here. On the other hand, this will work even if your DNS resolver is not thread-safe.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>from</em></p>
  </dt>
  <dd>
    <p>This is used to select sender e-mail addresses. You should not use that feature, because sender e-mail addresses can be trivially forged. Example:</p><ul>
<li>
<pre>
  racl whitelist from postmaster@example.com
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>rcpt</em></p>
  </dt>
  <dd>
    <p>This is used to select recipient addresses. Example:</p><ul>
<li>
<pre>
  racl greylist rcpt John.Doe@example.net
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>rcptcount</em></p>
  </dt>
  <dd>
    <p>Followed by an operator and a recipient count, this is used to select the amount of recipients. Example:</p><ul>
<li>
<pre>
  racl blacklist rcptcount &gt;= 25 msg "No more than 25 recipients, please"
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>helo</em></p>
  </dt>
  <dd>
    <p>Followed by a quoted string or a regular expression, this can be used to filter on the HELO string.</p>
  </dd>
  <dt>
    <p><em>sm_macro</em></p>
  </dt>
  <dd>
    <p>This is used to select a Sendmail macro value. See the section on that topic for more information.</p>
  </dd>
  <dt>
    <p><em>time</em></p>
  </dt>
  <dd>
    <p>This is used to specify a time set. It should be followed by a quoted string of <a href="../man5/crontab.5.html"><strong>crontab</strong>(5)</a></strong>-like time specification. Here is an example that whitelists mail addressed to a single recipient during office hours (from 8:00 to 16:59 from monday to friday):</p><ul>
<li>
<pre>
  racl whitelist time "* 8-16 * * 1-5" rcpt info@example.net
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>geoip</em></p>
  </dt>
  <dd>
    <p>This is used to specify a country, as reported by GeoIP. The country code must be upper case, and is only available if <strong>milter-greylist</strong> was built with GeoIP support. Special country code <strong>ZZ</strong> is used when the country cannot be determined (this happens for private addresses, for instance). The <em>geoipdb</em> statement can be used to specify the location of GeoIP database.</p>
  </dd>
  <dt>
    <p><em>p0f</em></p>
  </dt>
  <dd>
    <p>This is used to match against the remote system OS fingerprint genre and detail,obtained from p0f. It is only available if <strong>milter-greylist</strong> was built with p0f support. <em>p0f</em> clauses can be used with a quoted string for case-insensitive substring match, or against regular expressions. The <em>p0fsock</em> statement can be used to specify the location of the p0f socket.</p>
  </dd>
  <dt>
    <p><em>auth</em></p>
  </dt>
  <dd>
    <p>This is used to select a user that succeeded SMTP AUTH. In order to select any user that succeeds SMTP AUTH, you can use a regular expression matching, like below;</p><ul>
<li>
<pre>
  racl whitelist auth /.*/
</pre>
</li><li><p>Using such a clause automatically disable global STARTTLS and SMTP AUTH whitelisting, like if the <em>noauth</em> keyword would have been used.</p></li>
</ul>
  </dd>
  <dt>
    <p><em>tls</em></p>
  </dt>
  <dd>
    <p>This is used to select the distinguished name (DN) of a user that succeeded STARTTLS. Using such a clause automatically disable global STARTTLS and SMTP AUTH whitelisting, like if the <em>noauth</em> keyword would have been used.</p>
  </dd>
  <dt>
    <p><em>spf</em></p>
  </dt>
  <dd>
    <p>This is used to test SPF status. Possible values are <em>pass</em>, <em>softfail</em>, <em>fail</em>, <em>neutral</em>, <em>unknown</em>, <em>error</em>, <em>none</em>, and <em>self</em>. The first seven values are plain SPF validation status. The <em>self</em> value is a special test that checks the server's local IP address against the sender's SPF record. If that test validates, odds are good that the sender SPF record is wide open, and this is hint that SPF should not be trusted.</p><ul>
<li><p>In order to use <em>spf self</em>, Postfix users must specify the local address in the configuration file, using the <em>localaddr</em> option.</p></li><li><p>Absence of any value after the <em>spf</em> keyword is a synonym for <em>spf pass</em>. This is present for backward compatibility.</p></li><li><p>The <em>spf</em> clause is only available if SPF support was compiled in. Using it will disable global SPF whitelisting, like if the <em>nospf</em> keyword would have been used.</p></li>
</ul>
  </dd>
  <dt>
    <p><em>ldapcheck</em></p>
  </dt>
  <dd>
    <p>This is used to query an LDAP directory. See the section on that topic for more information.</p>
  </dd>
  <dt>
    <p><em>urlcheck</em></p>
  </dt>
  <dd>
    <p>This is used to query an external configuration source through an URL. See the section on that topic for more information.</p>
  </dd>
  <dt>
    <p><em>dnsrbl</em></p>
  </dt>
  <dd>
    <p>This is used to select a DNSRBL. See the section on that topic for more information.</p>
  </dd>
  <dt>
    <p><em>nsupdate</em></p>
  </dt>
  <dd>
    <p>This always-matching clause performs a DNS update, see the section on that topic for more information.</p>
  </dd>

</dl>
<p>The <em>domain</em>, <em>from</em>, and <em>rcpt</em> clauses may be used with regular expressions. The regular expressions must be enclosed by slashes (/). No escaping is available to provide a slash inside a regular expression, so just do not use it. Regular expressions follow the format described in <a href="../man7/re_format.7.html"><strong>re_format</strong>(7)</a></strong>. Here is an example:</p>
<pre>
  racl greylist rcpt /@example&#92;.net$/
</pre>
<p>When regular expressions are not used, <em>from</em>, and <em>rcpt</em> perform a case insensitive substring match with leading and trailing brackets, spaces and tabs stripped out. <em>domain</em> performs a case insensitive suffix match.  This means, for example, that gle.com will match google.com. If you want domain names to match on subdomain boundaries (e.g.  gle.com will match mail.gle.com and gle.com but not google.com) then enable <em>domainexact</em></p><p>An ACL entry can also hold various optional parameter used on match: <em>delay</em>, <em>autowhite</em>, <em>flushaddr</em>, <em>nolog</em>, <em>code</em>, <em>ecode</em>, <em>report</em>, <em>maxpeek</em>, <em>addheader</em>, <em>addfooter</em>, and <em>msg</em></p>
<dl class='dl-vertical'>
  <dt>
    <p><em>delay</em></p>
  </dt>
  <dd>
    <p>Specify the greylisting delay used before the message can be accepted. This overrides the <em>greylist</em> global setting, and it only  makes sense on an <em>racl greylist</em> entry.</p>
  </dd>
  <dt>
    <p><em>autowhite</em></p>
  </dt>
  <dd>
    <p>Specify the autowhitelisting duration for messages matching this ACL. This overrides the <em>autowhite</em> global setting, and it only makes sense on an <em>racl greylist</em> entry. Example:</p><ul>
<li>
<pre>
  racl greylist rcpt JDoe@example.net delay 15m autowhite 3d
  racl greylist rcpt root@example.net delay 1h autowhite 3d
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>flushaddr</em></p>
  </dt>
  <dd>
    <p>If a message matches the rule, any entry in the greylist or autowhite databases matching the sender IP is removed. Used with a DNSRBL blacklist ACL, it is useful for freeing the database from entries set up by a machine which is known to be a spammer. Example:</p><ul>
<li>
<pre>
  racl blacklist dnsrbl "known-spammer" flushaddr
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>nolog</em></p>
  </dt>
  <dd>
    <p>Do not generate syslog message if this rule matches. Example:</p><ul>
<li>
<pre>
  racl whitelist default nolog
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>code</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><em>ecode</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><em>msg</em></p>
  </dt>
  <dd>
    <p>These 3 values can be used to choose the SMTP code, extended code and reply message for temporary failures and rejects. Example:</p><ul>
<li>
<pre>
  racl blacklist dnsrbl "spamstomp" msg "IP caught by spamstomp"
  racl greylist default code "451" ecode "4.7.1"
</pre>
</li><li><p>The <em>msg</em> strings accepts format string substitution as documented in the <strong>FORMAT STRINGS</strong> section. For instance, <em>%A</em> gets substituted by the ACL line number.</p></li><li><p>None of the last 3 values makes sense for a whitelist entry.</p></li>
</ul>
  </dd>
  <dt>
    <p><em>report</em></p>
  </dt>
  <dd>
    <p>This value overrides the text displayed in the <em>X-Greylist</em> header, for messages that <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> lets pass through, either because they are whitelisted, or because they passed greylisting (see <strong>REPORTING</strong>). This string can be substituted as documented in the <strong>FORMAT STRINGS</strong> section.</p>
  </dd>
  <dt>
    <p><em>maxpeek</em></p>
  </dt>
  <dd>
    <p>This parameter only makes sense in a RCPT-stage ACL. It overrides the global <em>maxpeek</em> setting for DATA-stage handling of the message. It has no effect if global <em>maxpeek</em> is set to 0.</p>
  </dd>
  <dt>
    <p><em>addheader</em></p>
  </dt>
  <dd>
    <p>This quoted string is a RFC822 header that gets added to the message. Format string substitution is supported. No check is done for header length standard compliance, so make sure the substituted string is shorter than 2048 characters.</p>
  </dd>
  <dt>
    <p><em>addfooter</em></p>
  </dt>
  <dd>
    <p>Append a footer to the message. Usual escape sequences such as &#92;n can be used to get special characters. The string is subject to format string expantion as described in the <strong>FORMAT STRINGS</strong> section. The footer will not be append if <em>milter-greylist</em> was not able to capture the whole message, therefore <em>maxpeek</em> must be set approriately.</p>
  </dd>

</dl>
<p>Entries in the access-list are evaluated sequentially, so order is very important. The first matching entry is used to decide if a message will be whitelisted or greylisted. A special <em>default</em> clause can be used in the last ACL entry as a wildcard. Here are a few complete ACL examples:</p><p>Example 1:</p>
<pre>
racl whitelist from friend@toto.com rcpt grandma@example.com
racl whitelist from other.friend@example.net rcpt grandma@example.com
racl greylist rcpt grandma@example.com
racl whitelist default
</pre>
<p>Example 2:</p>
<pre>
racl whitelist addr 193.54.0.0/16 domain friendly.com
racl greylist rcpt user1@atmine.com
racl greylist rcpt user2@atmine.com
racl greylist rcpt user3@atmine.com
racl whitelist default
</pre>
<p>Example 3:</p>
<pre>
racl whitelist rcpt /@.*otherdomain&#92;.org$/
racl whitelist addr 192.168.42.0/24 rcpt user1@mydomain.org
racl whitelist from friend@example.net rcpt /@.*mydomain&#92;.org$/
racl whitelist rcpt user2@mydomain.org
racl greylist rcpt /@.*mydomain&#92;.org$/
racl whitelist default
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DATA-STAGE ACL</h2>
        <div class="sectioncontent">
<p>ACL using the <em>racl</em> keyword are evaluated at the RCPT stage of the SMTP transaction. It is also possible to have ACL evaluated at the DATA stage of the SMTP transaction, using the <em>dacl</em> keyword, provided the message went through RCPT-stage ACL, and possibly greylisting. Note that you cannot use the <em>greylist</em> action at DATA-stage if the RCPT-stage ACL that matched had a <em>greylist</em> action itself. The following clauses can be used to work on message content:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>dkim</em></p>
  </dt>
  <dd>
    <p>DKIM status (if build with DKIM support). Possible values are <em>pass</em>, <em>fail</em>, <em>unknown</em>, <em>error</em>, and <em>none</em>,</p>
  </dd>
  <dt>
    <p><em>header</em></p>
  </dt>
  <dd>
    <p>String or regular expression searched in message headers</p>
  </dd>
  <dt>
    <p><em>body</em></p>
  </dt>
  <dd>
    <p>String or regular expression searched in message body</p>
  </dd>
  <dt>
    <p><em>msgsize</em></p>
  </dt>
  <dd>
    <p>Operator followed by a message size (k or M suffix allowed for kilobytes or megabytes). Example:</p><ul>
<li>
<pre>
  dacl blacklist msgsize &gt;= 4M msg "No more than 4 MB please"
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>spamd</em></p>
  </dt>
  <dd>
    <p>SpamAssassin score (if build with SpamAssassin support). If used without comparison operator <em>spamd</em> is true if the score is above threshold. The <em>spamdsock</em> keyword can be used to specify the location of the spamd socket.</p><ul>
<li><p>Example 1:</p>
<pre>
  spamdsock unix "/var/spamassassin/spamd.sock"
  racl whitelist default
  dacl greylist spamd
</pre>
</li><li><p>Example 2:</p>
<pre>
  spamdsock inet "127.0.0.1:783"
  racl whitelist default
  dacl blacklist spamd &gt; 15 msg "Your message is considered spam."
  dacl greylist  spamd &gt; 10 delay 2h
  dacl greylist  spamd &gt; 5  delay 1h
</pre>
</li>
</ul>
  </dd>

</dl>
<p>Note that if there are multiple recipient, a <em>rcpt</em> clause at DATA stage evaluates to true if it matches any of them. If you want to match an exact set of recipients, you can use multiple <em>rcpt</em> clauses along with a <em>rcptcount</em> clause.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LISTS</h2>
        <div class="sectioncontent">
<p>It is often useful to group several users or sender IP addresses in a single ACL. This can be done with lists. Lists must be first defined and given a name before they can be used in ACL entries. Here is an example:</p><ul>
<li>
<pre>
  list "my users" rcpt { user1@example.com user2@example.com }
  list "local" addr { 192.0.2.0/24 10.0.0.0/8 }
</pre>

<pre>
  racl whitelist list "local"
  racl greylist list "my users"
  racl whitelist default
</pre>
</li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BACKWARD COMPATIBILITY</h2>
        <div class="sectioncontent">
<p>Previous versions of <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> used <em>addr</em>, <em>domain</em>, <em>from</em>, and <em>rcpt</em> lines, without the <em>racl</em> keyword. Access-list management is intended to replace them. These lines are still accepted by <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong>, but they are deprecated. <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> handles them as access-list entries with a single clause. They are added at the head of the access-list so the use of these keywords and access-lists may lead to unspecified behaviour. Do not mix them.</p><p>test mode (using <strong>-T</strong>) is also deprecated. Access-list semantics do not depend on this flag.</p><p><a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> also used to only have a RCPT-stage ACL, which was configured through <em>acl</em> statements. These have been replaced by <em>racl</em> statements (as opposed to <em>dacl</em> statements for DATA-stage ACL). <em>acl</em> statements are still accepted for backward compatibility and are a synonym for <em>racl</em> statements.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MX SYNC</h2>
        <div class="sectioncontent">
<p>Synchronization of the greylist among multiple MX is configured using the <em>peer</em> keyword. List each other MX IP addresses using the <em>peer</em> keyword. Here is an example:</p>
<pre>
  peer 192.0.2.18
  peer 192.0.2.17
  peer 192.0.2.22 timeout 7
  peer 192.0.2.38 timeout 5m
</pre>
<p>You can list the local machine in the peer statements, it will be ignored.</p><p>The <em>timeout</em> clause sets a peer communication timeout to have proper retrial in case of slow MX peer. The default value is 3 seconds. The special value of 0 disables the connection retrials.</p><p>By default, milter-greylist will listen on all interfaces using TCP port 5252 or the port number given by service named mxglsync if defined in <em>/etc/services</em> or other directory service. This behaviour can be changed by using the <em>syncaddr</em> keyword. Here are a few examples:</p>
<pre>
  syncaddr *
  syncaddr * port 7689
  syncaddr 192.0.2.2 port 9785
  syncaddr 2001:db8::1:c3b5:123
  syncaddr 2001:db8::1:c3b5:123 port 1234
</pre>
<p>Using '*' as the address means to bind to all local interfaces' addresses. Note that if you are not using the default port, all MXs must use the same port number.</p><p>For outbound connections the system is selecting one of the possible addresses. If you want to use a specific IP you can use:</p>
<pre>
  syncsrcaddr 123.456.78.9
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">TEXT DUMP</h2>
        <div class="sectioncontent">
<p><a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> uses a text dump of its database to resume operation after a crash. The dump is performed at regular time interval, but as it is a heavy operation, you might want to configure a particular time interval, using the <em>dumpfreq</em> option.</p><p>If the <em>dumpfreq</em> value is too small, it will kill performance. If it is too high, you will loose a bigger part of the database on a crash.</p><p>Set <em>dumpfreq</em> to 0 to get a dump on each change (kills performance), Set it to -1 to never dump to a file (unsafe as you lose the whole greylist on each crash), or give a time value for the delay between dumps. The time is given in seconds, except if a unit is given: m for minutes, h for hours, and d for days.</p><p>You may further improve the performance of the dump operation at the expense of humanly readable timestamp which by default appears as a comment at the end of each line in the dumpfile. You may disable generation of this comment by specifying <em>dump_no_time_translation</em> option in the configuration file. This is specifically recommended if your dumpfile grows to 100's of megabytes - it can reduce the time needed for the dump operation by the order of magnitude!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">REPORTING</h2>
        <div class="sectioncontent">
<p>By default, <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> will add a <em>X-Greylist</em> header to any message it handles. The header shows what happened to the message: delayed or not delayed, and why. The following options can be used in <strong>greylist.conf</strong> to alter this behavior:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>report none</em></p>
  </dt>
  <dd>
    <p>Never add a <em>X-Greylist</em> header.</p>
  </dd>
  <dt>
    <p><em>report delays</em></p>
  </dt>
  <dd>
    <p>Only add a header if the message was delayed.</p>
  </dd>
  <dt>
    <p><em>report nodelays</em></p>
  </dt>
  <dd>
    <p>Add a header if the message was not delayed. The header explains why the message was not delayed.</p>
  </dd>
  <dt>
    <p><em>report all</em></p>
  </dt>
  <dd>
    <p>Always add a header. This is the default.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SENDER CALLBACK SYSTEMS</h2>
        <div class="sectioncontent">
<p>Sender callback systems are another anti-spam measure that attempts to send a DSN to the sender address before accepting a message. If that fails, then the sender address is wrong and the message is rejected. Such systems usually stop their callback check at the RCPT stage of the SMTP transaction.</p><p>Greylisting temporarily rejects at the RCPT stage, so sender callback and greylisting love to fight each other. <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> proposes a workaround to that problem with the <em>delayedreject</em> option. For messages coming from &lt;&gt; (that is, for DSN), it will cause the temporary reject to happen at the DATA stage of the SMTP transaction instead of the RCPT stage. That way, <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> will cope much better with sender callback systems.</p><p>This has a minor drawback (and this is why it is not enabled by default): for a multi recipient DSN, whitelisted recipient will not be honoured: the message will be delayed for everyone.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SENDMAIL MACROS</h2>
        <div class="sectioncontent">
<p>Any sendmail macro can be used as a clause in the access list. You need to define a (macro, value) pair using the <em>sm_macro</em> keyword before using it.  Here is an example that uses the <em>{client_resolve}</em> macro to apply a larger greylisting delay to hosts that have a bogus reverse DNS:</p><ul>
<li>
<pre>
  sm_macro "maybe_forged" "{client_resolve}" "FORGED"
</pre>

<pre>
  racl greylist sm_macro "maybe_forged" delay 1h
  racl greylist default delay 15m
</pre>
</li>
</ul><p>A regular expression can be used as the macro value. It must be surrounded with slashes and not by quotes. The special value <em>unset</em> can also be used to match an unset macro:</p><ul>
<li>
<pre>
  sm_macro "not_foo" "{foo}" unset
</pre>
</li>
</ul><p>Note that any Sendmail macro that is not exported using the <em>Milter.macros.envrcpt</em> setting of <em>sendmail.cf</em> will be seen as unset from milter-greylist.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DNSRBL</h2>
        <div class="sectioncontent">
<p>DNS Reverse Black List can be used to toggle an ACL. They must be defined and named before they can be used. Here is an example which uses a bigger greylisting delay for hosts caught in the SORBS dynamic pool DNRSBL (this will include DSL and cable customers pools, which are well known to be massively infected by spamwares):</p><ul>
<li>
<pre>
  dnsrbl "SORBS DUN" dnsbl.sorbs.net 127.0.0.10/32
</pre>

<pre>
  racl greylist dnsrbl "SORBS DUN" delay 1h
  racl greylist default delay 15m
</pre>
</li>
</ul><p>The definition of a DNSRBL starts by the <em>dnsrbl</em> keyword, followed by the quoted name of the DNSRBL, the DNS domain on which addresses should be looked up, and the answer we should consider as a positive hit.</p><p>DNSRBL support is only available if enabled through the --enable-dnsrbl config flag. Please make sure <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> is linked against a thread-safe DNS resolver, otherwise it shall crash.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DNS updates</h2>
        <div class="sectioncontent">
<p>ACL are able to trigger a DNS update, which can be used to feed a DNSRBL. That functionnality is enabled at build time if the DNS resolver has DNS update support.</p><p>Configuration is done with the <em>nsupdate</em> statement, which may be used several times, and the optionnal <em>tsig</em> statement, if you want ot use authenticated DNS update. Here is an example syntax:</p><ul>
<li>
<pre>
  tsig "dns-update" "hmac-md5" "1B2M2Y8AsgTpgAmY7PhCfg=="
  nsupdate "bl.example.net" { rname "%j.bl.example.net" rvalue "127.0.0.2" tsig "dns-update" }
</pre>
</li>
</ul><p>The options for <em>nsupdate</em> are:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>rname</em></p>
  </dt>
  <dd>
    <p>Created record name, which uses format strings.</p>
  </dd>
  <dt>
    <p><em>rvalue</em></p>
  </dt>
  <dd>
    <p>Created record value, which uses format strings.</p>
  </dd>
  <dt>
    <p><em>servers</em></p>
  </dt>
  <dd>
    <p>Quoted comma-separated list of DNS server the update should be sent to. Default is to use the system confifugration, usualy from <em>/etc/resolv.conf</em></p>
  </dd>
  <dt>
    <p><em>ttl</em></p>
  </dt>
  <dd>
    <p>TTL of created DNS record. Default is 0 seconds.</p>
  </dd>
  <dt>
    <p><em>class</em></p>
  </dt>
  <dd>
    <p>Created record class, as numeric value. Default is 1, for IN class.</p>
  </dd>
  <dt>
    <p><em>type</em></p>
  </dt>
  <dd>
    <p>Created record type, as numeric value. Default is 1, for A type.</p>
  </dd>
  <dt>
    <p><em>tsig</em></p>
  </dt>
  <dd>
    <p>The name of a <em>tsig</em> configuration, which must have been supplied before. If unspecified, unauthenticated DNS updates are performed.</p>
  </dd>

</dl>
<p>Once configured, DNS updates can be used in any ACL:</p><ul>
<li>
<pre>
  racl blacklist rcpt spamtrap@example.net nsupdate "bl.example.net"
</pre>
</li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROPERTIES</h2>
        <div class="sectioncontent">
<p>Properties are variables that can be set, evaluated and printed in ACL. A property may be dropped once the current recipient is processed, or it can be retained until the message is processed. They can be created through the following always-matching ACL clauses:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>set\~\[char36]name="value"</em></p>
  </dt>
  <dd>
    <p>This sets a property that will be retained for all next recipients. Right hand side of the clause may be a quoted string (which will be substituted using format strings, as described in the <strong>FORMAT STRINGS</strong> section), a number, or another property name (which will be substituted by the property value).</p>
  </dd>
  <dt>
    <p><em>rset\~\[char36]name="value"</em></p>
  </dt>
  <dd>
    <p>Same as <em>set</em> clause, except that the property will be droped once the current user will have been processed.</p>
  </dd>
  <dt>
    <p><em>urlcheck</em></p>
  </dt>
  <dd>
    <p>These clause will cause properties to be fetched from an external web service. See the <strong>URL checks</strong> section below for details.</p>
  </dd>
  <dt>
    <p><em>ldapcheck</em></p>
  </dt>
  <dd>
    <p>These clause will cause properties to be fetched from a LDAP directory See the <strong>LDAP CHECKS</strong> section below for details.</p>
  </dd>

</dl>
<p>Properties can be used as left-hand side part of ACL clauses:</p><ul>
<li>
<pre>
  racl blacklist $name "badvalue"
  racl blacklist $name /badregex/
</pre>
</li>
</ul><p>They are also available as right-hand side of many ACL clauses:</p><ul>
<li>
<pre>
  racl continue set $badword="spam"
  racl blacklist body $badword
</pre>
</li>
</ul><p>Values of properties can be obtained in any quoted string that is subject to format string expantion:</p><ul>
<li>
<pre>
  racl continue set $webmaster="webmaster@example.net"
  racl blacklist domain evil.net msg "blacklisted, ask $P{webmaster} why"
</pre>
</li>
</ul><p>When the property value is a number, it can be increased or decreased using this syntax:</p><ul>
<li>
<pre>
  racl continue set $score+=5
  racl continue set $score-=5
</pre>
</li>
</ul><p>Here again, right hand side may be a quoted string, a number or another property. For the quoted string and property cases, a conversion is first made to an integer, using 0 as a value on failure. Note that no arithmetic evaluation occurs. For instance, the quoted string <em>\[char34]1 + 1\[char34]</em> will be evaluated as 0.</p><p>The <strong>log</strong> ACL clause can be helpful when one need to figure what happens to property values during the ACL flow. See the <strong>CUSTOM REPORT</strong> section for more details.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">URL checks</h2>
        <div class="sectioncontent">
<p><a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> is able to query external sources of information through various URL, if it was built with --with-libcurl. Here is an example:</p><ul>
<li>
<pre>
  urlcheck "glusr" "http://www.example.net/mgl-config?rcpt=%r" 5
</pre>

<pre>
  racl greylist urlcheck "glusr" delay 15m
  racl whitelist default
</pre>
</li>
</ul><p>The trailing 5 at the end of the <em>urlcheck</em> definition is the maximum number of simultaneous connections we want to launch on this URL. For each message, the URL will be queried, with  % format tags being substituted. For instance, <em>%r</em> is substituted by the recipient. See the <strong>FORMAT STRINGS</strong> section for the complete list of substitutions.</p><p><a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> expects an answer containing a list of &#92;n terminated lines, with <em>key: value</em> pairs. The most basic answer to get a match is:</p><ul>
<li>
<pre>
  milterGreylistStatus: Ok
</pre>
</li>
</ul><p><em>TRUE</em> can be used as an alias for <em>Ok</em> here.</p><p>The answer can be more complex, with keys that will overload the ACL settings:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>milterGreylistDelay</em></p>
  </dt>
  <dd>
    <p>The greylisting delay to use (time unit suffix allowed).</p>
  </dd>
  <dt>
    <p><em>milterGreylistAutowhite</em></p>
  </dt>
  <dd>
    <p>The autowhite delay to use (time unit suffix allowed).</p>
  </dd>
  <dt>
    <p><em>milterGreylistFlushAddr</em></p>
  </dt>
  <dd>
    <p>The value is ignored. If this key is present, then the IP address for the sender machine will be flushed from greylist and autowhite databases.</p>
  </dd>
  <dt>
    <p><em>milterGreylistCode</em></p>
  </dt>
  <dd>
    <p>The SMTP code to return (e.g.: 551).</p>
  </dd>
  <dt>
    <p><em>milterGreylistECode</em></p>
  </dt>
  <dd>
    <p>The SMTP extended code to return (e.g.: 5.7.1)</p>
  </dd>
  <dt>
    <p><em>milterGreylistMsg</em></p>
  </dt>
  <dd>
    <p>The string to return with SMTP codes.</p>
  </dd>
  <dt>
    <p><em>milterGreylistReport</em></p>
  </dt>
  <dd>
    <p>The string to display in the <em>X-Greylist</em> header.</p>
  </dd>
  <dt>
    <p><em>milterGreylistIgnore</em></p>
  </dt>
  <dd>
    <p>This line will be ignored, without warnings in the logs.</p>
  </dd>
  <dt>
    <p><em>milterGreylistAction</em></p>
  </dt>
  <dd>
    <p>This feature is nifty but use it with caution, as it makes the access list a bit difficult to understand. By specifying the values <em>greylist</em>, <em>whitelist</em>, or <em>blacklist</em>, it is possible to overload the ACL action itself.</p>
  </dd>

</dl>
<p>The ACL will match if any of the above key is returned: <em>milterGreylistStatus</em> is not mandatory.</p><p>Optional keywords can be appended to a <em>urlcheck</em> definition:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>postmsg</em></p>
  </dt>
  <dd>
    <p>On DATA-stage ACL, This causes the message to be sent (up to <em>maxpeek</em> bytes) in a POST request. Here is an example:</p><ul>
<li>
<pre>
  urlcheck "extfilter" "http://www.example.net/f.cgi" 5 postmsg
</pre>

<pre>
  dacl blacklist urlcheck "extfilter"
  dacl whitelist default
</pre>
</li>
</ul>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p><em>getprop</em></p>
  </dt>
  <dd>
    <p>Gather the properties returned by the URL and reuse them in the ACL. The gathered properties can be accessed in the current and following ACL by prefixing them by a dollar ($).</p>
  </dd>
  <dt>
    <p><em>clear</em></p>
  </dt>
  <dd>
    <p>This causes gathered properties to be cleared on each new recipient. This avoids properties for several recipients to mix.</p>
  </dd>
  <dt>
    <p><em>fork</em></p>
  </dt>
  <dd>
    <p>Tells <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> to fork a separate instance of itself for performing the queries. Use it if you encounter thread-safety problems. <em>fork</em> is not compatible with <em>postmsg</em>.</p>
  </dd>
  <dt>
    <p><em>domatch</em></p>
  </dt>
  <dd>
    <p>Cause the ldapcheck clause to be evaluated in ACL. Default behavior is to ignore the result and just fecth properties, except if the LDAP directory is unreachecable, in which case a temporary failure occurs. The <em>fixldapcheck</em> gloabal settings may also be used to globaly cause all <em>ldapcheck</em> and <em>urlcheck</em> clauses to match.</p>
  </dd>

</dl>
<p>Here is an example that will use various DNSRBL depending on a per-recipient setting stored in the <em>dnsrbl</em> attribute of a LDAP directory.</p><ul>
<li>
<pre>
  dnsrbl "RBL2" "rbl.example.net" "127.0.0.2"
  dnsrbl "RBL3" "rbl.example.net" "127.0.0.3"
  dnsrbl "RBL4" "rbl.example.net" "127.0.0.4"
  urlcheck "userconf" "ldap://localhost/dc=example,dc=net?milterGreylistStatus,dnsrbl?one?mail=%r" 5 getprop clear
</pre>

<pre>
  racl blacklist urlcheck "userconf" $dnsrbl "RBL2" dnsrbl "RBL2"
  racl blacklist $dnsrbl "RBL3" dnsrbl "RBL3"
  racl blacklist $dnsrbl "RBL4" dnsrbl "RBL4"
</pre>
</li>
</ul><p>Note that when matching gathered properties, format strings and regex can be used.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LDAP CHECKS</h2>
        <div class="sectioncontent">
<p>If milter-greylist was built with --with-openldap, then you can also use <em>ldapcheck</em> for pulling information from an LDAP directory. This works exactly like <em>urlcheck</em>, except that properties are always collected: The <em>getprop</em> option is implicit.</p><p>A list of LDAP URL to use can be specified with the <em>ldapconf</em> keyword. The network timeout is optional.</p><ul>
<li>
<pre>
  ldapconf "ldap://localhost ldaps://ldap.example.net" timeout 2s
</pre>
</li>
</ul><p>When <em>ldaps://</em> is used, the system's <em>ldap.conf</em> file is used to locate x509 certificates.</p><p>When defining LDAP queries with the <em>ldapcheck</em> statement, note that the scheme and host part of the URL are ignored. Servers listed in <em>ldapconf</em> are used instead.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RATE LIMIT</h2>
        <div class="sectioncontent">
<p>The <em>ratelimit</em> keyword specifies a ratelimit configuration to be used in access lists. It must be followed by the rate limit configuration name, what is being accounted (i.e.: <em>session</em> for SMTP sessions, <em>rcpt</em> for recipients, <em>data</em> for bytes in body and headers), the actual limit, and the sampling period. Example:</p><ul>
<li>
<pre>
  ratelimit "internalclients" rcpt 10 / 1m
</pre>

<pre>
  racl blacklist addr 192.0.2.0/24 ratelimit "internalclients" &#92;
</pre>
<p>	msg "you speak too much"</p></li>
</ul><p>The <em>ratelimit</em> keyword can also have an option <em>key</em> statement, which determine the set of key for message accounting. The default is <em>%i</em> for per IP address accounting (see the <strong>FORMAT STRINGS</strong> sections for the possible syntax of this field). Here is an example that configures a rate limit of 100 messages per hour for each individual recipient-IP set.</p><ul>
<li>
<pre>
  ratelimit "internalclients" rcpt 100 / 1h key "%r%i"
</pre>

<pre>
  racl blacklist addr 192.0.2.0/24 ratelimit "internalclients" &#92;
</pre>
<p>	msg "you speak too much"</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CUSTOM REPORTS</h2>
        <div class="sectioncontent">
<p>The <em>stat</em> keyword can be used to specify a custom report for milter-greylist activity. It should be supplied with an output (either file or external command) and a format string. Here is an example:</p><ul>
<li>
<pre>
  stat "&gt;&gt;/var/log/milter-greylist.log" "%T{%T},%i,%f,%r,%A&#92;n"
</pre>
</li>
</ul><p>If the output starts by <em>&gt;&gt;</em> or <em>&gt;</em> then it is a file. Use <em>&gt;&gt;</em> to append to an existing file, and use <em>&gt;</em> to overwrite it. If the output starts by a <em>|</em> then the output is a shell command, like in the example below:</p><ul>
<li>
<pre>
  stat "|logger -p local7.info" "%T{%T},%i,%f,%r,%A&#92;n"
</pre>
</li>
</ul><p>The format string gets substituted as URL checks format string: %r gets substituted by the recipient, %f by the sender, and so on. See the <strong>FORMAT STRINGS</strong> section for a complete list of available substitutions.</p><p>There is also an always-matching <em>log</em> ACL clause that can be used to send a formated string to syslog with <em>LOG_INFO</em> level.  Here is an example:</p><ul>
<li><p>racl continue rcpt /@example&#92;.com$/ log "I was here"</p></li>
</ul>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMMAND-LINE FLAG EQUIVALENTS</h2>
        <div class="sectioncontent">
<p>Most <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> command-line options have equivalent options that can be set in the configuration file. Note that if a command line option is supplied, it will always override the configuration file.</p><p>If a command-line equivalent keyword is used more than once, the last keyword will override the previous ones.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>verbose</em></p>
  </dt>
  <dd>
    <p>Enable debug output. This is equivalent to the <strong>-v</strong> flag.</p>
  </dd>
  <dt>
    <p><em>quiet</em></p>
  </dt>
  <dd>
    <p>Do not tell clients how much time remains before their e-mail will be accepted. This is equivalent to the <strong>-q</strong> flag.</p>
  </dd>
  <dt>
    <p><em>nodetach</em></p>
  </dt>
  <dd>
    <p>Do not fork and go into the background. This is equivalent to the <strong>-D</strong> flag.</p>
  </dd>
  <dt>
    <p><em>noauth</em></p>
  </dt>
  <dd>
    <p>Greylist clients regardless if they succeeded SMTP AUTH or STARTTLS. Equivalent to the <strong>-A</strong> flag.</p>
  </dd>
  <dt>
    <p><em>noaccessdb</em></p>
  </dt>
  <dd>
    <p>Normally <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> will whitelist a message if <a href="../man8/sendmail.8.html"><strong>sendmail</strong>(8)</a></strong> defines a ${greylist} macro set to WHITE. This enables complex whitelisting rules based on the Sendmail access DB. This option inhibits this behavior.</p>
  </dd>
  <dt>
    <p><em>nospf</em></p>
  </dt>
  <dd>
    <p>Greylist clients regardless if they are SPF-compliant. Equivalent to the <strong>-S</strong> flag.</p>
  </dd>
  <dt>
    <p><em>testmode</em></p>
  </dt>
  <dd>
    <p>Enable test mode. Equivalent to the <strong>-T</strong> flag. This option is deprecated.</p>
  </dd>
  <dt>
    <p><em>greylist</em></p>
  </dt>
  <dd>
    <p>The argument sets how much time <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> will want the client to wait between the first attempt and the time the message is accepted. The time is given in seconds, except if a unit is given: m for minutes, h for hours, and d for days. The <em>greylist</em> keyword is equivalent to the <strong>-w</strong> option. Here is an example that sets the delay to 45 minutes:</p><ul>
<li>
<pre>
  greylist 45m
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>autowhite</em></p>
  </dt>
  <dd>
    <p>This sets the auto-whitelisting duration, equivalent to the <strong>-a</strong> command-line option. As for the <em>greylist</em> keyword, units can be supplied. Here is an example for a 3 day long auto-whitelisting:</p><ul>
<li>
<pre>
  autowhite 3d
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>pidfile</em></p>
  </dt>
  <dd>
    <p>This causes <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> to write its PID into the file given as argument, like the <strong>-P</strong> command line argument does. The path to the file must be absolute and it must be enclosed in quotes. Here is an example:</p><ul>
<li>
<pre>
  pidfile "/var/run/greylist.pid"
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>dumpfile</em></p>
  </dt>
  <dd>
    <p>This chooses the location of the greylist dump file, like the <strong>-d</strong> command line option does. The path must be absolute and enclosed in quotes. It can optionally be followed by an octal permission mode. Example:</p><ul>
<li>
<pre>
  dumpfile "/var/milter-greylist/greylist.db" 640
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>subnetmatch</em></p>
  </dt>
  <dd>
    <p>This is equivalent to the <strong>-L</strong> command line option. It takes a slash followed by a CIDR mask as argument, and it commands the subnet matching feature. Example, for a class C wide matching:</p><ul>
<li>
<pre>
  subnetmatch /24
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>subnetmatch6</em></p>
  </dt>
  <dd>
    <p>This is equivalent to the <strong>-M</strong> command line option. It takes a slash followed by a prefixlen as argument, and it commands the subnet matching feature. Example, for a subnet wide matching:</p><ul>
<li>
<pre>
  subnetmatch6 /64
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>socket</em></p>
  </dt>
  <dd>
    <p>Like the <strong>-p</strong> command line option, this keyword is used to specify the socket used to communicate with <a href="../man8/sendmail.8.html"><strong>sendmail</strong>(8)</a></strong>. It must be enclosed in quotes and can optionally be followed by an octal permission mode (valid values are 666, 660 or 600, other values cause an error):</p><ul>
<li>
<pre>
  socket "/var/milter-greylist/milter-greylist.sock" 660
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>user</em></p>
  </dt>
  <dd>
    <p>This keyword should be followed by a quoted user login and optionally a colon followed by a groupname. Like the <strong>-u</strong> option, this is used to run <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong> as a non root user.  Here is an example:</p><ul>
<li>
<pre>
  user "smmsp"
</pre>
</li>
</ul>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">MISCELLANEOUS</h2>
        <div class="sectioncontent">
<p>These options have no command line equivalent:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>logfac</em></p>
  </dt>
  <dd>
    <p>Sets the syslog facility for messages.  Can be set to any of the standard facilities: <em>kern</em>, <em>user</em>, <em>mail</em>, <em>daemon</em>, <em>auth</em>, <em>syslog</em>, <em>lpr</em>, <em>news</em>, <em>uucp</em>, <em>cron</em>, <em>authpriv</em>, <em>ftp</em>, <em>local0</em>, <em>local1</em>, <em>local2</em>, <em>local3</em>, <em>local4</em>, <em>local5</em>, <em>local6</em>, <em>local7</em>. Can also be set to <em>none</em> to disable syslog output completely.</p>
  </dd>
  <dt>
    <p><em>timeout</em></p>
  </dt>
  <dd>
    <p>is used to control how long greylist tuples are retained in the database. Value is in seconds, except if a suffix is given (m for minutes, h for hours, d for days). Default is 5 days.</p>
  </dd>
  <dt>
    <p><em>extendedregex</em></p>
  </dt>
  <dd>
    <p>Use extended regular expressions instead of basic regular expressions.</p>
  </dd>
  <dt>
    <p><em>unbracket</em></p>
  </dt>
  <dd>
    <p>Attempt to resolve sender address when the MTA handed it as bracketed IP address (e.g.: <em>[192.0.2.18]</em> ). Default is to leave it as is.</p>
  </dd>
  <dt>
    <p><em>maxpeek</em></p>
  </dt>
  <dd>
    <p>Limit (in bytes) how much of messages are examined for header and body searches.</p>
  </dd>
  <dt>
    <p><em>lazyaw</em></p>
  </dt>
  <dd>
    <p>Make auto-whitelist look at just the IP instead of the (sender IP, sender e-mail address, recipient e-mail address) tuple.</p>
  </dd>
  <dt>
    <p><em>domainexact</em></p>
  </dt>
  <dd>
    <p>match on subdomain boundaries instead of the default suffix matching. E.g. if <em>domainexact</em> is not enabled (the default) then gle.com will match google.com in addition to gle.com. If <em>domainexact</em> is enabled then, domain names will match on subdomain boundaries (e.g.  gle.com will match mail.gle.com and gle.com but not google.com)</p>
  </dd>
  <dt>
    <p><em>drac db</em></p>
  </dt>
  <dd>
    <p>Tell where the DRAC DB file is. This is only available if DRAC support was compiled in. Here is an example:</p><ul>
<li>
<pre>
  drac db "/usr/local/etc/drac.db"
</pre>
</li>
</ul>
  </dd>
  <dt>
    <p><em>nodrac</em></p>
  </dt>
  <dd>
    <p>Disable DRAC.</p>
  </dd>
  <dt>
    <p><em>logexpired</em></p>
  </dt>
  <dd>
    <p>This option causes greylist entries that expire to be logged via syslog. This allows you to easily collect the IP addresses and sender names and use them for blacklisting, SPAM scoring, etc.  Normally, expiration's are only logged if the <strong>debug</strong> option is set, but that generates a lot of extra messages.</p>
  </dd>
  <dt>
    <p><em>localaddr</em></p>
  </dt>
  <dd>
    <p>This keyword can be used to manually define the local MTA's IP address for such uses as <em>spf self</em> and <em>p0f</em> in absence of the milter-API <em>{if_addr}</em> macro support in your MTA (Postfix, Sun/Oracle CommSuite Messaging Server). This is not so useful when using Sendmail, since it serves the macro and the local address can be detected automatically.</p>
  </dd>

</dl>
<p>The configuration file is reloaded automatically once it is modified when new e-mail arrives. Most configuration keywords will take effect immediately, except the following, which will only take effect after a restart of <a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a></strong>: <em>nodetach</em>, <em>pidfile</em>, <em>socket</em>, and <em>user</em>.</p><p>The <em>dumpfreq</em> option can be changed dynamically, but the change will only take effect after the next dump.</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>multiracl</em></p>
  </dt>
  <dd>
    <p>By default, once a RCPT-stage ACL whitelists a recipient, next recipient gets automatically whitelisted. This historical behavior can be considered a bug, and this option disables it.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FORMAT STRINGS</h2>
        <div class="sectioncontent">
<p>Various statements in the configuration file accept format strings, where the following % prefixed tokens are substituted. Here is the complete list of available substitutions (Note that some substitutions are not relevant in any context).</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>%r</em></p>
  </dt>
  <dd>
    <p>the message recipient e-mail address. This is not substituted for DATA stage ACL since there can be multiple recipients for the message.</p>
  </dd>
  <dt>
    <p><em>%f</em></p>
  </dt>
  <dd>
    <p>the message sender e-mail address</p>
  </dd>
  <dt>
    <p><em>%i</em></p>
  </dt>
  <dd>
    <p>the sender machine IP address</p>
  </dd>
  <dt>
    <p><em>%j</em></p>
  </dt>
  <dd>
    <p>the reversed sender machine IP address. For instance, 192.0.2.12 becomes 12.2.0.192.</p>
  </dd>
  <dt>
    <p><em>%I</em></p>
  </dt>
  <dd>
    <p>the sender machine IP address masked by a CIDR. Example: <em>%I{/24}</em></p>
  </dd>
  <dt>
    <p><em>%d</em></p>
  </dt>
  <dd>
    <p>the sender machine DNS address</p>
  </dd>
  <dt>
    <p><em>%h</em></p>
  </dt>
  <dd>
    <p>the SMTP transaction HELO string</p>
  </dd>
  <dt>
    <p><em>%mr</em></p>
  </dt>
  <dd>
    <p>the mailbox part of %r (before the @ sign). This is not substituted for DATA stage ACL since there can be multiple recipients for the message.</p>
  </dd>
  <dt>
    <p><em>%sr</em></p>
  </dt>
  <dd>
    <p>the site part of %r (after the @ sign). This is not substituted for DATA stage ACL since there can be multiple recipients for the message.</p>
  </dd>
  <dt>
    <p><em>%mf</em></p>
  </dt>
  <dd>
    <p>the mailbox part of %f (before the @ sign)</p>
  </dd>
  <dt>
    <p><em>%sf</em></p>
  </dt>
  <dd>
    <p>the site part of %f (after the @ sign)</p>
  </dd>
  <dt>
    <p><em>%md</em></p>
  </dt>
  <dd>
    <p>the machine part of %d (before the first . sign)</p>
  </dd>
  <dt>
    <p><em>%sd</em></p>
  </dt>
  <dd>
    <p>the site part of %d (after the first . sign)</p>
  </dd>
  <dt>
    <p><em>%Xc</em></p>
  </dt>
  <dd>
    <p>the SMTP code returned</p>
  </dd>
  <dt>
    <p><em>%Xe</em></p>
  </dt>
  <dd>
    <p>the SMTP extended code returned</p>
  </dd>
  <dt>
    <p><em>%Xm</em></p>
  </dt>
  <dd>
    <p>the SMTP message returned</p>
  </dd>
  <dt>
    <p><em>%Xh</em></p>
  </dt>
  <dd>
    <p>the message displayed in the X-Greylist header</p>
  </dd>
  <dt>
    <p><em>%D</em></p>
  </dt>
  <dd>
    <p>Comma-separated list of DNSRBL for which the sender host matched</p>
  </dd>
  <dt>
    <p><em>%M</em></p>
  </dt>
  <dd>
    <p>a sendmail macro value. Examples: <em>%Mj</em> or <em>%M{if_addr}</em></p>
  </dd>
  <dt>
    <p><em>%g</em></p>
  </dt>
  <dd>
    <p>a regex back reference. For instance, <em>%g{&#92;&#92;2}</em> is substituted by the string matching the second parenthesis group in all ACL regex clauses</p>
  </dd>
  <dt>
    <p><em>%T</em></p>
  </dt>
  <dd>
    <p>a brace-enclosed <a href="../man3/strftime.3.html"><strong>strftime</strong>(3)</a></strong> format string that will be substituted by the system time. Example: <em>%T{%Y%m%d:%H%M%S}</em></p>
  </dd>
  <dt>
    <p><em>%v</em></p>
  </dt>
  <dd>
    <p>milter-greylist's version</p>
  </dd>
  <dt>
    <p><em>%G</em></p>
  </dt>
  <dd>
    <p>Offset to GMT (e.g.: -0100)</p>
  </dd>
  <dt>
    <p><em>%C</em></p>
  </dt>
  <dd>
    <p>Sender IP country code, as reported by GeoIP. This is only available if <strong>milter-greylist</strong> was built with GeoIP support</p>
  </dd>
  <dt>
    <p><em>%Fx</em></p>
  </dt>
  <dd>
    <p>p0f OS fingerprint genre and detail. This is only available if <strong>milter-greylist</strong> was built with p0f support.</p>
  </dd>
  <dt>
    <p><em>%V</em></p>
  </dt>
  <dd>
    <p>Shortcut to "milter-greylist-%v (%Mj [%M{if_addr}]); %T{%a, %d %b %Y %T} %G (%T{%Z})"</p>
  </dd>
  <dt>
    <p><em>%S</em></p>
  </dt>
  <dd>
    <p>the action performed: <em>accept</em>, <em>tempfail</em>, or <em>reject</em>.</p>
  </dd>
  <dt>
    <p><em>%A</em></p>
  </dt>
  <dd>
    <p>the line number of the ACL that caused the action.</p>
  </dd>
  <dt>
    <p><em>%a</em></p>
  </dt>
  <dd>
    <p>the id string of the ACL that caused the action. If no id was given, the line number is used instead.</p>
  </dd>
  <dt>
    <p><em>%cA</em></p>
  </dt>
  <dd>
    <p>the line number of the ACL being evaluated, whether it matches or not.</p>
  </dd>
  <dt>
    <p><em>%ca</em></p>
  </dt>
  <dd>
    <p>the id string of the ACL being avaluated, whether it matches or not. If no id was given, the line number is used instead.</p>
  </dd>
  <dt>
    <p><em>%Et</em></p>
  </dt>
  <dd>
    <p>total elapsed time in seconds before a greylisted message has been accepted</p>
  </dd>
  <dt>
    <p><em>%Eh</em></p>
  </dt>
  <dd>
    <p>hours elapsed</p>
  </dd>
  <dt>
    <p><em>%Em</em></p>
  </dt>
  <dd>
    <p>minutes elapsed (modulo one hour)</p>
  </dd>
  <dt>
    <p><em>%Es</em></p>
  </dt>
  <dd>
    <p>seconds elapsed (modulo one minute)</p>
  </dd>
  <dt>
    <p><em>%E</em></p>
  </dt>
  <dd>
    <p>shortcut to %Eh:%Em:Es</p>
  </dd>
  <dt>
    <p><em>%Rt</em></p>
  </dt>
  <dd>
    <p>total remaining time in seconds before a greylisted message will be accepted</p>
  </dd>
  <dt>
    <p><em>%Rh</em></p>
  </dt>
  <dd>
    <p>hours remaining</p>
  </dd>
  <dt>
    <p><em>%Rm</em></p>
  </dt>
  <dd>
    <p>minutes remaining (modulo one hour)</p>
  </dd>
  <dt>
    <p><em>%Rs</em></p>
  </dt>
  <dd>
    <p>seconds remaining (modulo one minute)</p>
  </dd>
  <dt>
    <p><em>%R</em></p>
  </dt>
  <dd>
    <p>shortcut to %Rh:%Rm:Rs</p>
  </dd>
  <dt>
    <p><em>%Hs</em></p>
  </dt>
  <dd>
    <p>SpamAssassin score (if build with SpamAssassin support)</p>
  </dd>
  <dt>
    <p><em>%pn</em></p>
  </dt>
  <dd>
    <p>Name of last LDAP or CURL gathered property that matched an ACL.</p>
  </dd>
  <dt>
    <p><em>%pv</em></p>
  </dt>
  <dd>
    <p>Value of last LDAP or CURL gathered property that matched an ACL.</p>
  </dd>
  <dt>
    <p><em>%pr</em></p>
  </dt>
  <dd>
    <p>Recipient that caused storage of the last matching LDAP or CURL gathered property. <em>%P</em> a LDAP or CURL gathered propery. Example: <em>%P{mail}</em> Note that this copes very badly with multivalued properties.</p>
  </dd>
  <dt>
    <p><em>%%</em></p>
  </dt>
  <dd>
    <p>a single % character</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHORS</h2>
        <div class="sectioncontent">
<p>Emmanuel Dreyfus &lt;manu@netbsd.org&gt;</p><p><strong>milter-greylist</strong> received many contributions from (in alphabetical order): Adrian Dabrowski, Aida Shinra, Adam Katz, Alexander Lobodzinski, Alexandre Cherif, Alexey Popov, Andrew McGill, Attila Bruncsak, Benoit Branciard, Bernhard Schneider, Bob Smith, Constantine A. Murenin, Christian Pelissier, Cyril Guibourg, Dan Hollis, Denis Solovyov, Elrond, Enrico Scholz, Eugene Crosser, Fabien Tassin, Fredrik Pettai, Gary Aitken, Georg Horn, Gert Doering, Greg Troxel, Guido Kerkewitz, Hajimu Umemoto, Hideki ONO, Ivan F. Martinez, Jacques Beigbeder, Jean Benoit, Jean-Jacques Puig, Jeff Rife, Jim Klimov, Jobst Schmalenbach, Joe Pruett, Joel Bertrand, Johann E. Klasek, Johann Klasek, John Thiltges, John Wood, Jorgen Lundman, Klas Heggemann, Kouhei Sutou, Laurence Moindrot, Lev Walkin, Manuel Badzong, Martin Paul, Matt Kettler, Mattheu Herrb, Matthias Scheler, Matthieu Herrb, Michael Fromme, Moritz Both, Nerijus Baliunas, Ole Hansen, Pavel Cahyna, Pascal Lalonde, Per Holm, Petr Kristof, Piotr Wadas, R P Herrold, Ralf S. Engelschall, Ranko Zivojnovic, Remy Card, Rick Adams, Rogier Maas, Romain Kang, Rudy Eschauzier, Stephane Lentz, Thomas Scheunemann, Tim Mooney, Wolfgang Solfrank, and Yaroslav Boychuk.</p><p>Thanks to Helmut Messerer and Thomas Pfau for their feedback on the first releases of this software.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO greylist.conf&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/milter-greylist.8.html"><strong>milter-greylist</strong>(8)</a>, <a href="../man8/sendmail.8.html"><strong>sendmail</strong>(8)</a>, <strong>syslogd</strong>(8).</p>
<dl class='dl-vertical'>
  <dt>
    <p>Evan Harris's paper:</p>
  </dt>
  <dd>
    <p><em>http://projects.puremagic.com/greylisting/</em></p>
  </dd>
  <dt>
    <p>milter-greylist's web site:</p>
  </dt>
  <dd>
    <p><em>http://hcpnet.free.fr/milter-greylist/</em></p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="gres.conf.5.html"><span aria-hidden="true">&larr;</span> gres.conf.5: Slurm configuration file for generic resource management.</a></li>
   <li class="next"><a href="grossd.conf.5.html">grossd.conf.5: Greylisting of suspicious sources daemon configuration file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
