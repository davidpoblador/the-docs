<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tcpspy.rules: Configuration file for tcpspy</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Configuration file for tcpspy">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="tcpspy.rules (5) manual">
  <meta name="twitter:description" content="Configuration file for tcpspy">
  <meta name="twitter:image" content="https://www.carta.tech/images/tcpspy-tcpspy.rules-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/tcpspy.rules.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="tcpspy.rules (5) manual" />
  <meta property="og:description" content="Configuration file for tcpspy" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/tcpspy-tcpspy.rules-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">tcpspy.rules<small> (5)</small></h1>
        <p class="lead">Configuration file for tcpspy</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/tcpspy.rules.5.html">
      <span itemprop="name">tcpspy.rules: Configuration file for tcpspy</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/tcpspy/">
      <span itemprop="name">tcpspy</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/tcpspy.rules.5.html">
      <span itemprop="name">tcpspy.rules: Configuration file for tcpspy</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>This file, by default <em>/etc/tcpspy.rules</em>, is read by the <em>/etc/init.d/tcpspy</em> script at init time in order to configure tcpspy (see <a href="../man8/tcpspy.8.html"><strong>tcpspy</strong>(8)</a>) logger filtering rules.</p><p>It might look like:</p><ul>
<li>
<pre>
# /etc/tcpspt.rules example
user "joedoe" and rport 22 and raddr 192.168.1.10
user 1003
lport 22 or lport 21
(lport 23 and user "joedoe") or raddr 192.168.1.20
</pre>
</li>
</ul><p>This rules file specifies that tcpspy logs tcp connections according to 4 rules (line 1 to line 4 - one per each line) using the boolean logic (see below) to evaluate each rule.</p><p>This particular example logs conections:</p>
<dl class='dl-vertical'>
  <dt>
    <p>line 1 - for user "joedoe" connecting to 192.168.1.10:22 (remote)</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>line 2 - for user whose UID is 1003</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>line 3 - to *:22 or *:21 (both locally)</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p>line 4 - for user "joedoe" to *:23 (local) or to 192.168.1.20 (remote)</p>
  </dt>
  <dd>
    
  </dd>

</dl>
<p>Everything from an "#" signal and the end of the line will not be evaluated.</p><h3>Rule Syntax - just extracted from <a href="../man8/tcpspy.8.html"><strong>tcpspy</strong>(8)</a></h3>
<p>A rule may be specified with the following comparison operators:</p>
<dl class='dl-vertical'>
  <dt>
    <p><strong>user</strong><em> uid</em></p>
  </dt>
  <dd>
    <p>True if the local user initiating or accepting the connection has the <strong>effective</strong> user id <em>uid</em>.</p>
  </dd>
  <dt>
    <p><strong>user</strong><em> \N'34'username\N'34'</em></p>
  </dt>
  <dd>
    <p>Same as above, but using a username instead of a user id.</p>
  </dd>
  <dt>
    <p><strong>ip</strong></p>
  </dt>
  <dd>
    <p>True if the connection is IPv4.</p>
  </dd>
  <dt>
    <p><strong>ip6</strong></p>
  </dt>
  <dd>
    <p>True if the connection is IPv6.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> port</em></p>
  </dt>
  <dd>
    <p>True if the local end of the connection has port number <em>port</em>.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> [low] - [high]</em></p>
  </dt>
  <dd>
    <p>True if the local end of the connection has a port number greater than or equal to <em>low</em> and less than or equal to <em>high</em>. If the form <em>low-</em> is used, high is assumed to be 65535. If the form <em>-high</em> is used, low is assumed to be 0. It is an error to omit both <em>low</em> and <em>high</em>.</p>
  </dd>
  <dt>
    <p><strong>lport</strong><em> \N'34'service\N'34'</em></p>
  </dt>
  <dd>
    <p>Same as above, but using a service name from <em>/etc/services</em> instead of a port number.</p>
  </dd>
  <dt>
    <p><strong>rport</strong></p>
  </dt>
  <dd>
    <p>Same as <strong>lport</strong> but compares the port number of the remote end of the connection.</p>
  </dd>
  <dt>
    <p><strong>laddr</strong><em> n.n.n.n[/m.m.m.m]</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>laddr</strong><em> n.n.n.n/m</em></p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    <p><strong>laddr</strong><em> ip6-addr[/m]</em></p>
  </dt>
  <dd>
    <p>Interpreted as a "net/mask" expression; true if "net" is equal to the bitwise AND of the local address of the connection and "mask". If no mask is specified, a default mask with all bits set (255.255.255.255) is used. The CIDR type netmask is also possible. With IPv6 only a prefix length netmask is allowed, and the length defaults to 128. Depending on the address family, these rules contain an implicit match condition "ip" or "ip6", respectively.</p>
  </dd>
  <dt>
    <p><strong>raddr</strong></p>
  </dt>
  <dd>
    <p>Same as <strong>laddr</strong> but compares the remote address.</p>
  </dd>
  <dt>
    <p><strong>exe</strong><em> \N'34'pattern\N'34'</em></p>
  </dt>
  <dd>
    <p>True if the full filename (including directory) of the executable that created/accepted the connection matches <em>pattern</em>, a <a href="../man7/glob.7.html"><strong>glob</strong>(7)</a>-style wildcard pattern.</p><ul>
<li><p>The pattern "" (an empty string) matches connections created/accepted by processes whose executable filename is unknown.</p></li><li><p>If the <strong>-p</strong> option is not specified, a warning message will be printed, and the result of this comparison will always be true.</p></li>
</ul>
  </dd>

</dl>
<p>Expressions (including the  comparisons listed above) may be joined together with the following logical operations:</p>
<dl class='dl-vertical'>
  <dt>
    <p><em>expr1</em><strong> or </strong><em>expr2</em></p>
  </dt>
  <dd>
    <p>True if either of <em>expr1</em> or <em>expr2</em> are true (logical OR).</p>
  </dd>
  <dt>
    <p><em>expr1</em><strong> and </strong><em>expr2</em></p>
  </dt>
  <dd>
    <p>True if both <em>expr1</em> and <em>expr2</em> are true (logical AND).</p>
  </dd>
  <dt>
    <p><strong>not</strong><em> expr</em></p>
  </dt>
  <dd>
    <p>True if <em>expr</em> is false (logical NOT).</p>
  </dd>

</dl>
<p>Rules are evaluated from left to right. Whitespace (space, tab and newline) characters are ignored between "words". Rules consisting of only whitespace match no connections, but do not cause an error. Parentheses, '(' and ')' may be placed around expressions to affect the order of evaluation.</p>
<h3>Examples</h3>

<dl class='dl-vertical'>
  <dt>
    <p>These are some sample rules which further demonstrate how they are constructed:</p>
  </dt>
  <dd>
    
  </dd>
  <dt>
    
<pre>
user "joe" and rport "ssh"
</pre>

  </dt>
  <dd>
    <p>Log connections made by user "joe" for the service "ssh".</p>
  </dd>
  <dt>
    
<pre>
not raddr 10.0.0.0/255.0.0.0 and rport 25 and (user "bob" or user "joe")
</pre>

  </dt>
  <dd>
    <p>Log connections made by users "bob" and "joe" to remote port 25 on machines not on a fictional "intranet".</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Tim J. Robbins (tcpspy), Pablo Lorenzzoni (this manpage) and  Mats Erik Andersson (changes for IPv6)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO tcpspy.rules&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man7/glob.7.html"><strong>glob</strong>(7)</a>, <a href="../man5/proc.5.html"><strong>proc</strong>(5)</a>, <a href="../man5/services.5.html"><strong>services</strong>(5)</a>, <a href="../man7/signal.7.html"><strong>signal</strong>(7)</a>, <a href="../man3/syslog.3.html"><strong>syslog</strong>(3)</a>, <a href="../man8/tcpspy.8.html"><strong>tcpspy</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="tcp-environ.5.html"><span aria-hidden="true">&larr;</span> tcp-environ.5: Tcp-related environment variables</a></li>
   <li class="next"><a href="tcsd.conf.5.html">tcsd.conf.5: Configuration file for the trousers tcs daemon. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
