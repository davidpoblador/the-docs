<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>gvpe: Overview of the gnu virtual private ethernet suite.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Overview of the gnu virtual private ethernet suite.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="gvpe (5) manual">
  <meta name="twitter:description" content="Overview of the gnu virtual private ethernet suite.">
  <meta name="twitter:image" content="https://www.carta.tech/images/gvpe-gvpe-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/gvpe.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="gvpe (5) manual" />
  <meta property="og:description" content="Overview of the gnu virtual private ethernet suite." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/gvpe-gvpe-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">gvpe<small> (5)</small></h1>
        <p class="lead">Overview of the gnu virtual private ethernet suite.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/gvpe.5.html">
      <span itemprop="name">gvpe: Overview of the gnu virtual private ethernet suite.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/gvpe/">
      <span itemprop="name">gvpe</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/gvpe.5.html">
      <span itemprop="name">gvpe: Overview of the gnu virtual private ethernet suite.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>\s-1GVPE\s0 is a suite designed to provide a virtual private network for multiple nodes over an untrusted network. This document first gives an introduction to VPNs in general and then describes the specific implementation of \s-1GVPE\s0.</p><h3>\s-1WHAT\s0 \s-1IS\s0 A \s-1VPN\s0?</h3>
<p>\s-1VPN\s0 is an acronym, it stands for:</p>
<dl class='dl-vertical'>
  <dt>
    Virtual
  </dt>
  <dd>
    <p>Virtual means that no physical network is created (of course), but a network is <em>emulated</em> by creating multiple tunnels between the member nodes by encapsulating and sending data over another transport network. Usually the emulated network is a normal \s-1IP\s0 or Ethernet, and the transport network is the Internet. However, using a \s-1VPN\s0 system like \s-1GVPE\s0 to connect nodes over other untrusted networks such as Wireless \s-1LAN\s0 is not uncommon.</p>
  </dd>
  <dt>
    Private
  </dt>
  <dd>
    <p>Private means that non-participating nodes cannot decode (\*(L"sniff)\*(R" nor inject (\*(L"spoof\*(R") packets. This means that nodes can be connected over untrusted networks such as the public Internet without fear of being eavesdropped while at the same time being able to trust data sent by other nodes. In the case of \s-1GVPE\s0, even participating nodes cannot sniff packets send to other nodes or spoof packets as if sent from other nodes, so communications between any two nodes is private to those two nodes.</p>
  </dd>
  <dt>
    Network
  </dt>
  <dd>
    <p>Network means that more than two parties can participate in the network, so for instance it's possible to connect multiple branches of a company into a single network. Many so-called \*(L"\s-1VPN\s0\*(R" solutions only create point-to-point tunnels, which in turn can be used to build larger networks. \s-1GVPE\s0 provides a true multi-point network in which any number of nodes (at least a few dozen in practise, the theoretical limit is 4095 nodes) can participate.</p>
  </dd>

</dl>

<h3>\s-1GVPE\s0 \s-1DESIGN\s0 \s-1GOALS\s0</h3>

<dl class='dl-vertical'>
  <dt>
    \s-1SIMPLE\s0 \s-1DESIGN\s0
  </dt>
  <dd>
    <p>Cipher, \s-1HMAC\s0 algorithms and other key parameters must be selected at compile time - this makes it possible to only link in algorithms you actually need. It also makes the crypto part of the source very transparent and easy to inspect, and last not least this makes it possible to hardcode the layout of all packets into the binary. \s-1GVPE\s0 goes a step further and internally reserves blocks of the same length for all packets, which virtually removes all possibilities of buffer overflows, as there is only a single type of buffer and it's always of fixed length.</p>
  </dd>
  <dt>
    \s-1EASY\s0 \s-1TO\s0 \s-1SETUP\s0
  </dt>
  <dd>
    <p>A few lines of config (the config file is shared unmodified between all hosts) and a single run of \*(C`gvpectrl\*(C' to generate the keys suffices to make it work.</p>
  </dd>
  <dt>
    MAC-BASED \s-1SECURITY\s0
  </dt>
  <dd>
    <p>Since every host has it's own private key, other hosts cannot spoof traffic from this host. That makes it possible to filter packet by \s-1MAC\s0 address, e.g. to ensure that packets from a specific \s-1IP\s0 address come, in fact, from a specific host that is associated with that \s-1IP\s0 and not from another host.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">PROGRAMS</h2>
        <div class="sectioncontent">
<p>Gvpe comes with two programs: one daemon (\*(C`gvpe\*(C') and one control program (\*(C`gvpectrl\*(C').</p>
<dl class='dl-vertical'>
  <dt>
    gvpectrl
  </dt>
  <dd>
    <p>This program is used to generate the keys, check and give an overview of of the configuration and to control the daemon (restarting etc.).</p>
  </dd>
  <dt>
    gvpe
  </dt>
  <dd>
    <p>This is the daemon used to establish and maintain connections to the other network nodes. It should be run on the gateway of each \s-1VPN\s0 subnet.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COMPILETIME CONFIGURATION</h2>
        <div class="sectioncontent">
<p>Please have a look at the \*(C`<a href="../man5/gvpe.osdep.5.html"><strong>gvpe.osdep</strong>(5)</a>\*(C' manpage for platform-specific information.</p><p>Gvpe hardcodes most encryption parameters. While this reduces flexibility, it makes the program much simpler and helps making buffer overflows impossible under most circumstances.</p><p>Here are a few recipes for compiling your gvpe, showing the extremes (fast, small, insecure \s-1OR\s0 slow, large, more secure), between which you should choose:</p><h3>\s-1AS\s0 \s-1LOW\s0 \s-1PACKET\s0 \s-1OVERHEAD\s0 \s-1AS\s0 \s-1POSSIBLE\s0</h3>

<pre>
   ./configure --enable-hmac-length=4 --enable-rand-length=0
</pre>
<p>Minimize the header overhead of \s-1VPN\s0 packets (the above will result in only 4 bytes of overhead over the raw ethernet frame). This is a insecure configuration because a \s-1HMAC\s0 length of 4 makes collision attacks almost trivial.</p>
<h3>\s-1MINIMIZE\s0 \s-1CPU\s0 \s-1TIME\s0 \s-1REQUIRED\s0</h3>
<p>   ./configure --enable-cipher=bf --enable-digest=md4</p><p>Use the fastest cipher and digest algorithms currently available in gvpe. \s-1MD4\s0 has been broken and is quite insecure, though, so using another digest algorithm is recommended.</p>
<h3>\s-1MAXIMIZE\s0 \s-1SECURITY\s0</h3>
<p>   ./configure --enable-hmac-length=16 --enable-rand-length=12 --enable-digest=ripemd610</p><p>This uses a 16 byte \s-1HMAC\s0 checksum to authenticate packets (I guess 8-12 would also be pretty secure ;) and will additionally prefix each packet with 12 bytes of random data.</p><p>In general, remember that \s-1AES-128\s0 seems to be as secure but faster than \s-1AES-192\s0 or \s-1AES-256\s0, more randomness helps against sniffing and a longer \s-1HMAC\s0 helps against spoofing. \s-1MD4\s0 is a fast digest, \s-1SHA1\s0, \s-1RIPEMD160\s0, \s-1SHA256\s0 are consecutively better, and Blowfish is a fast cipher (and also quite secure).</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">HOW TO SET UP A SIMPLE VPN</h2>
        <div class="sectioncontent">
<p>In this section I will describe how to get a simple \s-1VPN\s0 consisting of three hosts up and running.</p><h3>\s-1STEP\s0 1: configuration</h3>
<p>First you have to create a daemon configuration file and put it into the configuration directory. This is usually \*(C`/etc/gvpe\*(C', depending on how you configured gvpe, and can be overwritten using the \*(C`-c\*(C' command line switch.</p><p>Put the following lines into \*(C`/etc/gvpe/gvpe.conf\*(C':</p><p>   udp-port = 50000 # the external port to listen on (configure your firewall)    mtu = 1400       # minimum MTU of all outgoing interfaces on all hosts    ifname = vpn0    # the local network device name</p><p>   node = first     # just a nickname    hostname = first.example.net # the DNS name or IP address of the host</p><p>   node = second    hostname = 133.55.82.9</p><p>   node = third    hostname = third.example.net</p><p>The only other file necessary is the \*(C`if-up\*(C' script that initializes the virtual ethernet interface on the local host. Put the following lines into \*(C`/etc/gvpe/if-up\*(C' and make it executable (\*(C`chmod 755 /etc/gvpe/if-up\*(C'):</p><p>   #!/bin/sh    ip link set $IFNAME address $MAC mtu $MTU up    [ $NODENAME = first  ] && ip addr add 10.0.1.1 dev $IFNAME    [ $NODENAME = second ] && ip addr add 10.0.2.1 dev $IFNAME    [ $NODENAME = third  ] && ip addr add 10.0.3.1 dev $IFNAME    ip route add 10.0.0.0/16 dev $IFNAME</p><p>This script will give each node a different \s-1IP\s0 address in the \*(C`10.0/16\*(C' network.  The internal network (if gvpe runs on a router) should then be set to a subset of that network, e.g.  \*(C`10.0.1.0/24\*(C' on node \*(C`first\*(C', \*(C`10.0.2.0/24\*(C' on node \*(C`second\*(C', and so on.</p><p>By enabling routing on the gateway host that runs \*(C`gvpe\*(C' all nodes will be able to reach the other nodes. You can, of course, also use proxy \s-1ARP\s0 or other means of pseudo-bridging, or (best) full routing - the choice is yours.</p>
<h3>\s-1STEP\s0 2: create the \s-1RSA\s0 key pairs for all hosts</h3>
<p>Run the following command to generate all key pairs for all nodes (that might take a while):</p><p>   gvpectrl -c /etc/gvpe -g</p><p>This command will put the public keys into \*(C`/etc/gvpe/pubkeys/<strong>nodename\*(C'</strong> and the private keys into \*(C`/etc/gvpe/hostkeys/<strong>nodename\*(C'</strong>.</p>
<h3>\s-1STEP\s0 3: distribute the config files to all nodes</h3>
<p>Now distribute the config files and private keys to the other nodes. This should be done in two steps, since only the private keys meant for a node should be distributed (so each node has only it's own private key).</p><p>The example uses rsync-over-ssh</p><p>First all the config files without the hostkeys should be distributed:</p><p>   rsync -avzessh /etc/gvpe first.example.net:/etc/. --exclude hostkeys    rsync -avzessh /etc/gvpe 133.55.82.9:/etc/. --exclude hostkeys    rsync -avzessh /etc/gvpe third.example.net:/etc/. --exclude hostkeys</p><p>Then the hostkeys should be copied:</p><p>   rsync -avzessh /etc/gvpe/hostkeys/first  first.example.net:/etc/hostkey    rsync -avzessh /etc/gvpe/hostkeys/second 133.55.82.9:/etc/hostkey    rsync -avzessh /etc/gvpe/hostkeys/third  third.example.net:/etc/hostkey</p><p>You should now check the configuration by issuing the command \*(C`gvpectrl -c /etc/gvpe -s\*(C' on each node and verify it's output.</p>
<h3>\s-1STEP\s0 4: starting gvpe</h3>
<p>You should then start gvpe on each node by issuing a command like:</p><p>   gvpe -D -l info first # first is the nodename</p><p>This will make the gvpe daemon stay in foreground. You should then see \*(L"connection established\*(R" messages. If you don't see them check your firewall and routing (use tcpdump ;).</p><p>If this works you should check your networking setup by pinging various endpoints.</p><p>To make gvpe run more permanently you can either run it as a daemon (by starting it without the \*(C`-D\*(C' switch), or, much better, from your inittab or equivalent. I use a line like this on all my systems:</p><p>   t1:2345:respawn:/opt/gvpe/sbin/gvpe -D -L first &gt;/dev/null 2&gt;&1</p>
<h3>\s-1STEP\s0 5: enjoy</h3>
<p>... and play around. Sending a -HUP (\*(C`gvpectrl -kHUP\*(C') to the daemon will make it try to connect to all other nodes again. If you run it from inittab, as is recommended, \*(C`gvpectrl -k\*(C' (or simply \*(C`killall gvpe\*(C') will kill the daemon, start it again, making it read it's configuration files again.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO gvpe&hellip;</h2>
        <div class="sectioncontent">
<p><em>gvpe.osdep</em>\|(5) for OS-dependent information, <em>gvpe.conf</em>\|(5), <em>gvpectrl</em>\|(8), and for a description of the transports, protocol, and routing algorithm, <em>gvpe.protocol</em>\|(7).</p><p>The \s-1GVPE\s0 mailing list, at &lt;http://lists.schmorp.de/&gt;, or \*(C`gvpe@lists.schmorp.de\*(C'.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Marc Lehmann &lt;gvpe@schmorp.de&gt;</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHTS AND LICENSES</h2>
        <div class="sectioncontent">
<p>\s-1GVPE\s0 itself is distributed under the \s-1GENERAL\s0 \s-1PUBLIC\s0 \s-1LICENSE\s0 (see the file \s-1COPYING\s0 that should be part of your distribution).</p><p>In some configurations it uses modified versions of the tinc vpn suite, which is also available under the \s-1GENERAL\s0 \s-1PUBLIC\s0 \s-1LICENSE\s0.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="gtkwaverc.5.html"><span aria-hidden="true">&larr;</span> gtkwaverc.5: Gtkwave configuration file</a></li>
   <li class="next"><a href="gvpe.osdep.5.html">gvpe.osdep.5: Os dependent information <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
