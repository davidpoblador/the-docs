<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>shorewall6-masq: Shorewall6 masquerade/snat definition file</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Shorewall6 masquerade/snat definition file">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="shorewall6-masq (5) manual">
  <meta name="twitter:description" content="Shorewall6 masquerade/snat definition file">
  <meta name="twitter:image" content="https://www.carta.tech/images/shorewall6-shorewall6-masq-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/shorewall6-masq.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="shorewall6-masq (5) manual" />
  <meta property="og:description" content="Shorewall6 masquerade/snat definition file" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/shorewall6-shorewall6-masq-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">shorewall6-masq<small> (5)</small></h1>
        <p class="lead">Shorewall6 masquerade/snat definition file</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/shorewall6-masq.5.html">
      <span itemprop="name">shorewall6-masq: Shorewall6 masquerade/snat definition file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/shorewall6/">
      <span itemprop="name">shorewall6</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/shorewall6-masq.5.html">
      <span itemprop="name">shorewall6-masq: Shorewall6 masquerade/snat definition file</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p><strong>/etc/shorewall6/masq</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Use this file to define Source NAT (SNAT). Requires Shorewall 4.5.14 or later.</p><p><strong>Warning</strong></p><p>The entries in this file are order-sensitive. The first entry that matches a particular connection will be the one that is used.</p><p><strong>Warning</strong></p><p>If you have more than one ISP link, adding entries to this file will <strong>not</strong> force connections to go out through a particular link. You must use entries in \m[blue]<strong>shorewall6-rtrules</strong>\m[]\s-2\u[1]\d\s+2(5) or PREROUTING entries in \m[blue]<strong>shorewall-tcrules</strong>\m[]\s-2\u[2]\d\s+2(5) to do that.</p><p>The columns in the file are as follows.</p><p><strong>INTERFACE:DEST</strong> - {[<strong>+</strong>]<em>interfacelist</em>|[<strong>:</strong>[<em>dest-address</em>[<strong>,</strong><em>dest-address</em>]...[<em>exclusion</em>]]|[?]COMMENT}</p><p>Outgoing <em>interfacelist</em>. This may be a comma-separated list of interface names. This is usually your internet interface.</p><p>Each interface must match an entry in \m[blue]<strong>shorewall6-interfaces</strong>\m[]\s-2\u[3]\d\s+2(5). Shorewall allows loose matches to wildcard entries in \m[blue]<strong>shorewall6-interfaces</strong>\m[]\s-2\u[3]\d\s+2(5). For example, ppp0 in this file will match a \m[blue]<strong>shorewall6-interfaces</strong>\m[]\s-2\u[3]\d\s+2(5) entry that defines ppp+.</p><p>Where \m[blue]<strong>more that one internet provider share a single interface</strong>\m[]\s-2\u[4]\d\s+2, the provider is specified by including the provider name or number in parentheses:</p>
<pre>
        eth0(Avvanta)
</pre>
<p>In that case, you will want to specify the interface&apos;s address for that provider in the ADDRESS column.</p><p>The interface may be qualified by adding the character ":" followed by a comma-separated list of destination host or subnet addresses to indicate that you only want to change the source IP address for packets being sent to those particular destinations. Exclusion is allowed (see \m[blue]<strong>shorewall6-exclusion</strong>\m[]\s-2\u[5]\d\s+2(5)) as are ipset names preceded by a plus sign &apos;+&apos;.</p><p>Comments may be attached to Netfilter rules generated from entries in this file through the use of COMMENT lines. These lines begin with the word COMMENT; the remainder of the line is treated as a comment which is attached to subsequent rules until another COMMENT line is found or until the end of the file is reached. To stop adding comments to rules, use a line with only the word COMMENT.</p><p><strong>Note</strong></p><p>Beginning with Shorewall 4.5.11, ?COMMENT is a synonym for COMMENT and is preferred.</p><p>Beginning with Shorewall 4.6.0, a new syntax is also accepted. With the exception of the leading &apos;+&apos;, the interfacelist and qualifiers may appear within the parentheses of <strong>INLINE</strong>(...).</p><p>Example:</p>
<pre>
        +INLINE(eth0)
</pre>
<p>When this is done, you may augment the rule generated by Shorewall with iptables matches of your own. These matches appear after a semicolon (&apos;;&apos;) at the end of the line.</p><p>See example 2 below.</p><p><strong>SOURCE</strong> (Optional) - [<em>interface</em>|<em>address</em>[<strong>,</strong><em>address</em>][<em>exclusion</em>]]</p><p>Set of hosts that you wish to SNAT; one or more host or network addresses separated by comma. You may use ipset names preceded by a plus sign (+) to specify a set of hosts.</p><p><strong>ADDRESS</strong> (Optional) - [<strong>-</strong>|<strong>NONAT</strong>|[<em>address-or-address-range</em>[,<em>address-or-address-range</em>]...][:<em>lowport</em><strong>-</strong><em>highport</em>][<strong>:random</strong>][:persistent]|<strong>detect</strong>|<strong>random</strong>]</p><p>If you do not specify an address or address range, masquerading will be performed. This requires Masquerade Target support in your kernel and ip6tables.</p><p>If you specify an address here, SNAT will be used and this will be the source address.</p><p>You may also specify a range of up to 256 IP addresses if you want the SNAT address to be assigned from that range in a round-robin fashion by connection. The range is specified by <em>first.ip.in.range</em>-<em>last.ip.in.range</em>. You may follow the port range with<strong>:random</strong> in which case assignment of ports from the list will be random. <strong>random</strong> may also be specified by itself in this column in which case random local port assignments are made for the outgoing connections.</p><p>Example: [2001:470:a:227::2]-[2001:470:a:227::10]:1000-1010</p><p>You may follow the port range (or <strong>:random</strong>) with <strong>:persistent</strong>. This is only useful when an address range is specified and causes a client to be given the same source/destination IP pair.</p><p>This column may not contain DNS Names.</p><p>Normally, Netfilter will attempt to retain the source port number. You may cause netfilter to remap the source port by following an address or range (if any) by ":" and a port range with the format <em>lowport</em>-<em>highport</em>. If this is done, you must specify "tcp" or "udp" in the PROTO column.</p><p>Examples:</p>
<pre>
        [2001:470:a:787::2]:5000-6000
</pre>
<p>If you simply place <strong>NONAT</strong> in this column, no rewriting of the source IP address or port number will be performed. This is useful if you want particular traffic to be exempt from the entries that follow in the file.</p><p><strong>PROTO</strong> (Optional) - {<strong>-</strong>|[!]{<em>protocol-name</em>|<em>protocol-number</em>}[,...]|+<em>ipset</em>}</p><p>If you wish to restrict this entry to a particular protocol then enter the protocol name (from <a href="../man5/protocols.5.html"><strong>protocols</strong>(5)</a>) or number here.</p><p>Beginning with Shorewall 4.5.12, this column can accept a comma-separated list of protocols.</p><p>Beginning with Shorewall 4.6.0, an <em>ipset</em> name can be specified in this column. This is intended to be used with bitmap:port ipsets.</p><p><strong>PORT(S)</strong> (Optional) - {-|[!]<em>port-name-or-number</em>[,<em>port-name-or-number</em>]...|+<em>ipset</em>}</p><p>If the PROTO column specifies TCP (6), UDP (17), DCCP (33), SCTP (132) or UDPLITE (136) then you may list one or more port numbers (or names from <a href="../man5/services.5.html"><strong>services</strong>(5)</a>) or port ranges separated by commas.</p><p>Port ranges are of the form <em>lowport</em>:<em>highport</em>.</p><p>Beginning with Shorewall 4.6.0, an <em>ipset</em> name can be specified in this column. This is intended to be used with bitmap:port ipsets.</p><p><strong>IPSEC</strong> (Optional) - [<em>option</em>[<strong>,</strong><em>option</em>]...]</p><p>If you specify a value other than "-" in this column, you must be running kernel 2.6 and your kernel and iptables must include policy match support.</p><p>Comma-separated list of options from the following. Only packets that will be encrypted via an SA that matches these options will have their source address changed.</p><p><strong>reqid=</strong><em>number</em></p><p>where <em>number</em> is specified using <strong>setkey</strong>(8) using the &apos;unique:<em>number</em> option for the SPD level.</p><p><strong>spi=</strong>&lt;number&gt;</p><p>where <em>number</em> is the SPI of the SA used to encrypt/decrypt packets.</p><p><strong>proto=</strong><strong>ah</strong>|<strong>esp</strong>|<strong>ipcomp</strong></p><p>IPSEC Encapsulation Protocol</p><p><strong>mss=</strong><em>number</em></p><p>sets the MSS field in TCP packets</p><p><strong>mode=</strong><strong>transport</strong>|<strong>tunnel</strong></p><p>IPSEC mode</p><p><strong>tunnel-src=</strong><em>address</em>[/<em>mask</em>]</p><p>only available with mode=tunnel</p><p><strong>tunnel-dst=</strong><em>address</em>[/<em>mask</em>]</p><p>only available with mode=tunnel</p><p><strong>strict</strong></p><p>Means that packets must match all rules.</p><p><strong>next</strong></p><p>Separates rules; can only be used with strict</p><p><strong>yes</strong></p><p>When used by itself, causes all traffic that will be encrypted/encapsulated to match the rule.</p><p><strong>MARK</strong> - [<strong>!</strong>]<em>value</em>[/<em>mask</em>][<strong>:C</strong>]</p><p>Defines a test on the existing packet or connection mark. The rule will match only if the test returns true.</p><p>If you don&apos;t want to define a test but need to specify anything in the following columns, place a "-" in this field.</p><p>!</p><p>Inverts the test (not equal)</p><p><em>value</em></p><p>Value of the packet or connection mark.</p><p><em>mask</em></p><p>A mask to be applied to the mark before testing.</p><p><strong>:C</strong></p><p>Designates a connection mark. If omitted, the packet mark&apos;s value is tested.</p><p><strong>USER/GROUP</strong> (Optional) - [<strong>!</strong>][<em>user-name-or-number</em>][<strong>:</strong><em>group-name-or-number</em>][<strong>+</strong><em>program-name</em>]</p><p>Only locally-generated connections will match if this column is non-empty.</p><p>When this column is non-empty, the rule matches only if the program generating the output is running under the effective <em>user</em> and/or <em>group</em> specified (or is NOT running under that id if "!" is given).</p><p>Examples:</p><p>joe</p><p>program must be run by joe</p><p>:kids</p><p>program must be run by a member of the &apos;kids&apos; group</p><p>!:kids</p><p>program must not be run by a member of the &apos;kids&apos; group</p><p>+upnpd</p><p>#program named upnpd</p><p><strong>Important</strong></p><p>The ability to specify a program name was removed from Netfilter in kernel version 2.6.14.</p><p><strong>SWITCH - [!]</strong><strong></strong><em>switch-name</em><strong>[={0|1}]</strong></p><p>Added in Shorewall 4.5.1 and allows enabling and disabling the rule without requiring <strong>shorewall restart</strong>.</p><p>The rule is enabled if the value stored in /proc/net/nf_condition/<em>switch-name</em> is 1. The rule is disabled if that file contains 0 (the default). If &apos;!&apos; is supplied, the test is inverted such that the rule is enabled if the file contains 0.</p><p>Within the <em>switch-name</em>, &apos;@0&apos; and &apos;@{0}&apos; are replaced by the name of the chain to which the rule is a added. The <em>switch-name</em> (after &apos;@...&apos; expansion) must begin with a letter and be composed of letters, decimal digits, underscores or hyphens. Switch names must be 30 characters or less in length.</p><p>Switches are normally <strong>off</strong>. To turn a switch <strong>on</strong>:</p><p><strong>echo 1 &gt;</strong></p>
<pre>
            /proc/net/nf_condition/<strong></strong><em>switch-name</em>
</pre>
<p>To turn it <strong>off</strong> again:</p><p><strong>echo 0 &gt;</strong></p>
<pre>
            /proc/net/nf_condition/<strong></strong><em>switch-name</em>
</pre>
<p>Switch settings are retained over <strong>shorewall restart</strong>.</p><p>Beginning with Shorewall 4.5.10, when the <em>switch-name</em> is followed by <strong>=0</strong> or <strong>=1</strong>, then the switch is initialized to off or on respectively by the <strong>start</strong> command. Other commands do not affect the switch setting.</p><p><strong>ORIGINAL DEST</strong> (origdest) - [<strong>-</strong>|<em>address</em>[,<em>address</em>]...[<em>exclusion</em>]|<em>exclusion</em>]</p><p>(Optional) This column may be included and may contain one or more addresses (host or network) separated by commas. Address ranges are not allowed. When this column is supplied, rules are generated that require that the original destination address matches one of the listed addresses. It is useful for specifying that SNAT should occur only for connections that were acted on by a DNAT when they entered the firewall.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>Example 1:</p><p>You have a simple &apos;masquerading&apos; setup where eth0 connects to a DSL or cable modem and eth1 connects to your local network with subnet 2001:470:b:787::0/64</p><p>Your entry in the file will be:</p>
<pre>
        #INTERFACE   SOURCE                  ADDRESS
        eth0         2001:470:b:787::0/64    -
</pre>
<p>Example 2:</p><p>Your sit1 interface has two public IP addresses: 2001:470:a:227::1 and 2001:470:b:227::1. You want to use the iptables statistics match to masquerade outgoing connections evenly between these two addresses.</p>
<pre>
/etc/shorewall/masq:

       #INTERFACE    SOURCE         ADDRESS
       INLINE(sit1)  0.0.0.0/0      2001:470:a:227::1 ;  -m statistic --mode random --probability 0.50
       sit1          0.0.0.0/0      2001:470:a:227::2
</pre>
<p>If INLINE_MATCHES=Yes in \m[blue]<strong>shorewall6.conf</strong>\m[]\s-2\u[6]\d\s+2(5), then these rules may be specified as follows:</p>
<pre>
/etc/shorewall/masq:

       #INTERFACE    SOURCE         ADDRESS
       sit1          0.0.0.0/0      2001:470:a:227::1 ;  -m statistic --mode random --probability 0.50
       sit1          0.0.0.0/0      2001:470:a:227::2
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">
<p>/etc/shorewall6/masq</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>shorewall6-rtrules</p><p>http://www.shorewall.net/manpages6/shorewall6-rtrules.html</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p>shorewall-tcrules</p><p>http://www.shorewall.net/manpages6/shorewall6-tcrules.html</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p>shorewall6-interfaces</p><p>http://www.shorewall.net/manpages6/shorewall6-interfaces.html</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p>more that one internet provider share a single interface</p><p>http://www.shorewall.net/4.4/MultiISP.html#Shared</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p>shorewall6-exclusion</p><p>http://www.shorewall.net/manpages6/shorewall6-exclusion.html</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p>shorewall6.conf</p><p>http://www.shorewall.net/manpages6/shorewall6.conf.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="shorewall6-mangle.5.html"><span aria-hidden="true">&larr;</span> shorewall6-mangle.5: Shorewall packet marking/mangling rules file</a></li>
   <li class="next"><a href="shorewall6-nat.5.html">shorewall6-nat.5: Shorewall6 one-to-one nat file <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
