<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>slapo-retcode - return code overlay to slapd</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Return code overlay to slapd">
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">slapo-retcode<small> (5)</small></h1>
        <p class="lead">Return code overlay to slapd</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/slapo-retcode.5.html">
      <span itemprop="name">slapo-retcode</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/openldap/">
      <span itemprop="name">openldap</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/slapo-retcode.5.html">
      <span itemprop="name">slapo-retcode</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">

<p>ETCDIR/slapd.conf</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">

<p>The <strong>retcode</strong> overlay to <strong>slapd</strong>(8) is useful to test the behavior of clients when server-generated erroneous and/or unusual responses occur, e.g. error codes, referrals, excessive response times and so on.</p>
<p class='spacer'>

<p>The error responses are generated according to different strategies.</p>
<p class='spacer'>

<p>In the first case, all operations targeted at a specific configurable subtree cause the object related to the request DN to be looked up and checked for return code data: a response code, plus an optional textual message, an optional configurable delay, an optional matched DN field, and, when the response code is "referral", a (list of) referral(s).</p>
<p class='spacer'>

<p>Well-known response codes from standard track documents are provided in <strong>retcode.conf</strong>, which can be included after instantiating the overlay.</p>
<p class='spacer'>

<p>In the second case, objects of classes inherited from the <strong>errAbsObject</strong>, like <strong>errObject</strong> or <strong>errAuxObject</strong>, when returned as intermediate responses of a search request, are changed into the response dictated by their content.</p>
<p class='spacer'>

<p>A third mode causes objects to be looked up from the underlying database to discover if their class inherits from <strong>errABsObject</strong>; in that case, their content is used to compute the corresponding response.</p>
<p class='spacer'>

<p>The behavior is disabled by using the <strong>manageDSAit</strong> control (RFC 3296); in that case, the resulting object, either present in the directory or dynamically generated by the overlay, or contained in the request, is handled as usual.</p>
<p class='spacer'>

  <p>The config directives that are specific to the <strong>retcode</strong> overlay must be prefixed by <strong>retcode-</strong>, to avoid conflicts with directives specific to the underlying database or to other stacked overlays.  The following specific directives can be used to configure the retcode overlay:</p>
  <dl class='dl-vertical'>
    <dt><strong>retcode-parent &lt;DN&gt;</strong></dt>
    <dd>
  <p>This directive defines the parent DN where dynamically generated entries reside. If not defined, the suffix of the database is used. <strong>retcode-item &lt;RDN&gt; &lt;errCode&gt; [op=&lt;oplist&gt;] [text=&lt;message&gt;]</strong> <strong>[ref=&lt;referral&gt;] [sleeptime=&lt;sec&gt;] [matched=&lt;DN&gt;]</strong> <strong>[unsolicited=&lt;OID&gt;[:&lt;data&gt;]] [flags=[{pre|post}-]disconnect[,...]]</strong> A dynamically generated entry, located below <strong>retcode-parent</strong>. The <strong>errCode</strong> is the number of the response code; it can be in any format supported by <a href="../man3/strtol.3.html"><strong>strtol</strong>(3)</a>. The optional <strong>oplist</strong> is a list of operations that cause response code generation; if absent, all operations are affected. The <strong>matched</strong> field is the matched DN that is returned along with the error, while the <strong>text</strong> field is an optional diagnostics message. The <strong>ref</strong> field is only allowed for the <strong>referral</strong> response code. The <strong>sleeptime</strong> field causes <strong>slapd</strong>(8) to sleep the specified number of seconds before proceeding with the operation. The <strong>unsolicited</strong> field can be used to cause the return of an RFC 4511 unsolicited response message; if <strong>OID</strong> is not "0", an extended response is generated, with the optional <strong>data</strong> appended. If <strong>flags</strong> contains <strong>disconnect</strong>, or <strong>pre-disconnect</strong>, <strong>slapd</strong>(8) disconnects abruptly, without notice; <strong>post-disconnect</strong> causes disconnection right after sending response as appropriate.</p>
    </dd>
    <dt><strong>retcode-indir</strong></dt>
    <dd>
  <p>Enables exploitation of in-directory stored errAbsObject. May result in a lot of unnecessary overhead.</p>
    </dd>
    <dt><strong>retcode-sleep [-]&lt;n&gt;</strong></dt>
    <dd>
  <p>Defines a sleep time in seconds that is spent before actually handling any operation. If negative, a random time between 0 and the absolute value of the argument is used.</p>
<p class='spacer'>

    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SCHEMA</h2>
        <div class="sectioncontent">

<p>The <strong>retcode</strong> overlay utilizes the "return code" schema described herein. This schema is specifically designed for use with this overlay and is not intended to be used otherwise. It is also noted that the schema described here is <em>a work in</em> <em>progress</em>, and hence subject to change without notice. The schema is loaded automatically by the overlay.</p>
<p class='spacer'>

<p>The schema includes a number of object classes and associated attribute types as described below.</p>
<p class='spacer'>

<p class='spacer'>

  <p>The error code: (  1.3.6.1.4.1.4203.666.11.4.1.1</p>
<pre>    NAME ( 'errCode' )
    DESC 'LDAP error code'
    EQUALITY integerMatch
    ORDERING integerOrderingMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The operations that trigger the response code: ( 1.3.6.1.4.1.4203.666.11.4.1.2</p>
<pre>    NAME ( 'errOp' )
    DESC 'Operations the errObject applies to'
    EQUALITY caseIgnoreMatch
    SUBSTR caseIgnoreSubstringsMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )</pre>

<p class='spacer'>

  <p>The text message: ( 1.3.6.1.4.1.4203.666.11.4.1.3</p>
<pre>    NAME ( 'errText' )
    DESC 'LDAP error textual description'
    EQUALITY caseIgnoreMatch
    SUBSTR caseIgnoreSubstringsMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The sleep time before the response is actually returned to the client: ( 1.3.6.1.4.1.4203.666.11.4.1.4</p>
<pre>    NAME ( 'errSleepTime' )
    DESC 'Time to wait before returning the error'
    EQUALITY integerMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The matched DN returned to the client: ( 1.3.6.1.4.1.4203.666.11.4.1.5</p>
<pre>    NAME ( 'errMatchedDN' )
    DESC 'Value to be returned as matched DN'
    EQUALITY distinguishedNameMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The OID to be returned as extended response OID in RFC 4511 unsolicited responses ("0" generates a regular response with msgid set to 0): ( 1.3.6.1.4.1.4203.666.11.4.1.6</p>
<pre>    NAME ( 'errUnsolicitedOID' )
    DESC 'OID to be returned within unsolicited response'
    EQUALITY objectIdentifierMatch
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.38
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The octet string to be returned as extended response data in RFC 4511 unsolicited response: ( 1.3.6.1.4.1.4203.666.11.4.1.7</p>
<pre>    NAME ( 'errUnsolicitedData' )
    DESC 'Data to be returned within unsolicited response'
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>If TRUE, <strong>slapd</strong>(8) disconnects abruptly without notice; if FALSE, it disconnects after sending response as appropriate: ( 1.3.6.1.4.1.4203.666.11.4.1.8</p>
<pre>    NAME ( 'errDisconnect' )
    DESC 'Disconnect without notice'
    SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
    SINGLE-VALUE )</pre>

<p class='spacer'>

  <p>The abstract class that triggers the overlay: ( 1.3.6.1.4.1.4203.666.11.4.3.0</p>
<pre>    NAME ( 'errAbsObject' )
    SUP top ABSTRACT
    MUST ( errCode )
    MAY ( cn $ description $ errOp $ errText $ errSleepTime
        $ errMatchedDN ) )</pre>

<p class='spacer'>

  <p>The standalone structural objectclass for specifically created data: ( 1.3.6.1.4.1.4203.666.11.4.3.1</p>
<pre>    NAME ( 'errObject' )
    SUP errAbsObject STRUCTURAL )</pre>

<p class='spacer'>

  <p>The auxiliary objectclass to alter the behavior of existing objects: ( 1.3.6.1.4.1.4203.666.11.4.3.2</p>
<pre>    NAME ( 'errAuxObject' )
    SUP errAbsObject AUXILIARY )</pre>

<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">

<p class='spacer'>

<pre>overlay         retcode
retcode-parent  "ou=RetCodes,dc=example,dc=com"

# retcode.conf is found in tests/data/ of the source tree
include         ./retcode.conf

# Wait 10 seconds, then return success (0x00)
retcode-item    "cn=Success after 10 seconds" 0x00 sleeptime=10
# Wait 10 seconds, then return timelimitExceeded (0x03)
retcode-item    "cn=Timelimit after 10 seconds" 0x03 sleeptime=10</pre>

<p class='spacer'>

<p class='spacer'>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

  <dl class='dl-vertical'>
    <dt>ETCDIR/slapd.conf</dt>
    <dd>
  <p>default slapd configuration file</p>
    </dd>
  </dl>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SEE ALSO</h2>
        <div class="sectioncontent">

<p><strong>slapd.conf</strong>(5), <strong>slapd-config</strong>(5), <strong>slapd</strong>(8). The <a href="../man5/slapo-retcode.5.html"><strong>slapo-retcode</strong>(5)</a> overlay supports dynamic configuration via <strong>back-config</strong>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ACKNOWLEDGEMENTS</h2>
        <div class="sectioncontent">

<p class='spacer'>

<p>This module was written in 2005 by Pierangelo Masarati for SysNet s.n.c.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="slapo-pcache.5.html"><span aria-hidden="true">&larr;</span> slapo-pcache.5: proxy cache overlay to slapd</a></li>
   <li class="next"><a href="slapo-rwm.5.html">slapo-rwm.5: rewrite/remap overlay to slapd <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
