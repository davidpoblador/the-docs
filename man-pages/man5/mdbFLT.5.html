<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mdbFLT: Font layout table</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Font layout table">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mdbFLT (5) manual">
  <meta name="twitter:description" content="Font layout table">
  <meta name="twitter:image" content="https://www.carta.tech/images/m17n-docs-mdbFLT-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/mdbFLT.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mdbFLT (5) manual" />
  <meta property="og:description" content="Font layout table" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/m17n-docs-mdbFLT-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mdbFLT<small> (5)</small></h1>
        <p class="lead">Font layout table</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/mdbFLT.5.html">
      <span itemprop="name">mdbFLT: Font layout table</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/m17n-docs/">
      <span itemprop="name">m17n-docs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/mdbFLT.5.html">
      <span itemprop="name">mdbFLT: Font layout table</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>For simple scripts, the rendering engine converts character codes into glyph codes one by one by consulting the encoding of each selected font. But, to render text that requires complicated layout (e.g. Thai and Indic scripts), one to one conversion is not sufficient. A sequence of characters may have to be drawn as a single ligature. Some glyphs may have to be drawn at 2-dimensionally shifted positions.</p><p>To handle those complicated scripts, the m17n library uses Font Layout Tables (FLTs for short). The FLT driver interprets an FLT and converts a character sequence into a glyph sequence that is ready to be passed to the rendering engine.</p><p>An FLT can contain information to extract a grapheme cluster from a character sequence and to reorder the characters in the cluster, in addition to information found in OpenType Layout Tables (CMAP, GSUB, and GPOS).</p><p>An FLT is a cascade of one or more conversion stages. In each stage, a sequence is converted into another sequence to be read in the next stage. The length of sequences may differ from stage to stage. Each element in a sequence has the following integer attributes.</p><ul>
<li><p>code</p></li>
</ul><p>In the first conversion stage, this is the character code in the original character sequence. In the last stage, it is the glyph code passed to the rendering engine. In other cases, it is an intermediate glyph code.</p><ul>
<li><p>category</p></li>
</ul><p>The category code defined in the CATEGORY-TABLE of the current stage, or defined in the one of the former stages and not overwritten by later stages.</p><ul>
<li><p>combining-spec</p></li>
</ul><p>If nonzero, it specifies how to combine this (intermediate) glyph with the previous one.</p><ul>
<li><p>left-padding-flag</p></li>
</ul><p>If nonzero, it instructs the rendering function to insert a padding space before this (intermediate) glyph so that the glyph does not overlap with the previous one.</p><ul>
<li><p>right-padding-flag</p></li>
</ul><p>If nonzero, it instructs the rendering function to insert a padding space after this (intermediate) glyph so that the glyph does not overlap with the next one.</p><p>When the layout engine draws text, it at first determines a font and an FLT for each character in the text. For each subsequence of characters that use the same font and FLT, the layout engine generates a corresponding intermediate glyph sequence. The code attribute of each element in the intermediate glyph sequence is its character code, and all other attributes are zeros. This sequence is processed in the first stage of FLT as the current <em>run</em> (substring).</p><p>Each stage works as follows.</p><p>At first, if the stage has a CATEGORY-TABLE, the category of each glyph in the current run is updated. If there is a glyph that has no category, the current run ends before that glyph.</p><p>Then, the default values of code-offset, combining-spec, and left-padding-flag of this stage are initialized to zero.</p><p>Next, the initial conversion rule of the stage is applied to the current run.</p><p>Lastly, the current run is replaced with the newly produced (intermediate) glyph sequence.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SYNTAX and SEMANTICS</h2>
        <div class="sectioncontent">
<p>The m17n library loads an FLT from the m17n database using the tag &lt;font, layouter, FLT-NAME&gt;. The date format of an FLT is as follows:</p>
<pre>
FONT-LAYOUT-TABLE ::= FLT-DECLARATION ? STAGE0 STAGE *

FLT-DECLARATION ::= '(' 'font' 'layouter' FLT-NAME nil PROP * ')'
FLT-NAME ::= SYMBOL
PROP :: = VERSION | FONT
VERSION ::= '(' 'version' MTEXT ')'
FONT ::= '(' 'font' FONT-SPEC ')'
FONT-SPEC ::=
     '(' [[ FOUNDRY FAMILY
           [ WEIGHT [ STYLE [ STRETCH [ ADSTYLE ]]]]]
         REGISTRY ]
	 [ OTF-SPEC ] [ LANG-SPEC ] ')'

STAGE0 ::= CATEGORY-TABLE GENERATOR

STAGE ::= CATEGORY-TABLE ? GENERATOR

CATEGORY-TABLE ::= '(' 'category' CATEGORY-SPEC + ')'

CATEGORY-SPEC ::= '(' CODE CATEGORY ')'
                  | '(' CODE CODE CATEGORY ')'

CODE ::= INTEGER

CATEGORY ::= INTEGER
</pre>
<p>In the definition of CATEGORY-SPEC, CODE is a glyph code, and CATEGORY is ASCII code of an upper or lower letter, i.e. one of 'A', ... 'Z', 'a', .. 'z'.</p><p>The first form of CATEGORY-SPEC assigns CATEGORY to a glyph whose code is CODE. The second form assigns CATEGORY to glyphs whose code falls between the two CODEs.</p>
<pre>
GENERATOR ::= '(' 'generator' RULE MACRO-DEF * ')'

RULE ::= REGEXP-BLOCK | MATCH-BLOCK | SUBST-BLOCK | COND-BLOCK
         FONT-FACILITY-BLOCK | DIRECT-CODE | COMBINING-SPEC | OTF-SPEC
         | PREDEFINED-RULE | MACRO-NAME

MACOR-DEF ::= '(' MACRO-NAME RULE + ')'
</pre>
<p>Each RULE specifies glyphs to be consumed and glyphs to be produced. When some glyphs are consumed, they are taken away from the current run. A rule may fail in some condition. If not described explicitly to fail, it should be regarded that the rule succeeds.</p>
<pre>
DIRECT-CODE ::= INTEGER
</pre>
<p>This rule consumes no glyph and produces a glyph which has the following attributes:</p><ul>
<li><p>code : INTEGER plus the default code-offset</p></li><li><p>combining-spec : default value</p></li><li><p>left-padding-flag : default value</p></li><li><p>right-padding-flag : zero</p></li>
</ul><p>After having produced the glyph, the default code-offset, combining-spec, and left-padding-flag are all reset to zero.</p>
<pre>
PREDEFINED-RULE ::= '=' | '*' | '&lt;' | '&gt;' | '|' | '[' | ']'
</pre>
<p>They perform actions as follows.</p><ul>
<li><p>=</p></li>
</ul><p>This rule consumes the first glyph in the current run and produces the same glyph. It fails if the current run is empty.</p><ul>
<li><p>*</p></li>
</ul><p>This rule repeatedly executes the previous rule. If the previous rule fails, this rule does nothing and fails.</p><ul>
<li><p>&lt;</p></li>
</ul><p>This rule specifies the start of a grapheme cluster.</p><ul>
<li><p>&gt;</p></li>
</ul><p>This rule specifies the end of a grapheme cluster.</p><ul>
<li><p>@[</p></li>
</ul><p>This rule sets the default left-padding-flag to 1. No glyph is consumed. No glyph is produced.</p><ul>
<li><p>@]</p></li>
</ul><p>This rule changes the right-padding-flag of the lastly generated glyph to 1. No glyph is consumed. No glyph is produced.</p><ul>
<li><p>|</p></li>
</ul><p>This rule consumes no glyph and produces a special glyph whose category is ' ' and other attributes are zero. This is the only rule that produces that special glyph.</p>
<pre>
REGEXP-BLOCK ::= '(' REGEXP RULE * ')'

REGEXP ::= MTEXT
</pre>
<p>MTEXT is a regular expression that should match the sequence of categories of the current run. If a match is found, this rule executes RULEs temporarily limiting the current run to the matched part. The matched part is consumed by this rule.</p><p>Parenthesized subexpressions, if any, are recorded to be used in MATCH-BLOCK that may appear in one of RULEs.</p><p>If no match is found, this rule fails.</p>
<pre>
MATCH-BLOCK ::= '(' MATCH-INDEX RULE * ')'

MATCH-INDEX ::= INTEGER
</pre>
<p>MATCH-INDEX is an integer specifying a parenthesized subexpression recorded by the previous REGEXP-BLOCK. If such a subexpression was found by the previous regular expression matching, this rule executes RULEs temporarily limiting the current run to the matched part of the subexpression. The matched part is consumed by this rule.</p><p>If no match was found, this rule fails.</p><p>If this is the first rule of the stage, MATCH-INDEX must be 0, and it matches the whole current run.</p>
<pre>
SUBST-BLOCK ::= '(' SOURCE-PATTERN RULE * ')'

SOURCE-PATTERN ::= '(' CODE + ')'
                   | (' 'range' CODE CODE ')'
</pre>
<p>If the sequence of codes of the current run matches SOURCE-PATTERN, this rule executes RULEs temporarily limiting the current run to the matched part. The matched part is consumed.</p><p>The first form of SOURCE-PATTERN specifies a sequence of glyph codes to be matched. In this case, this rule resets the default code-offset to zero.</p><p>The second form specifies a range of codes that should match the first glyph code of the code sequence. In this case, this rule sets the default code-offset to the first glyph code minus the first CODE specifying the range.</p><p>If no match is found, this rule fails.</p>
<pre>
FONT-FACILITY-BLOCK ::= '(' FONT-FACILITY RULE * ')'
FONT-FACILITY = '(' 'font-facility' CODE * ')'
	      	| '(' 'font-facility' FONT-SPEC ')'
</pre>
<p>If the current font has glyphs for CODEs or matches with FONT-SPEC, this rule succeeds and RULEs are executed. Otherwise, this rule fails.</p>
<pre>
COND-BLOCK ::= '(' 'cond' RULE + ')'
</pre>
<p>This rule sequentially executes RULEs until one succeeds. If no rule succeeds, this rule fails. Otherwise, it succeeds.</p>
<pre>
OTF-SPEC ::= SYMBOL

</pre>
<p>OTF-SPEC is a symbol whose name specifies an instruction to the OTF driver. The name has the following syntax.</p>
<pre>
  OTF-SPEC-NAME ::= ':otf=' SCRIPT LANGSYS ? GSUB-FEATURES ? GPOS-FEATURES ?

  SCRIPT ::= SYMBOL

  LANGSYS ::= '/' SYMBOL

  GSUB-FEATURES ::= '=' FEATURE-LIST ?

  GPOS-FEATURES ::= '+' FEATURE-LIST ?

  FEATURE-LIST ::= ( SYMBOL ',' ) * [ SYMBOL | '*' ]

</pre>
<p>Each SYMBOL specifies a tag name defined in the OpenType specification.</p><p>For SCRIPT, SYMBOL specifies a Script tag name (e.g. deva for Devanagari).</p><p>For LANGSYS, SYMBOL specifies a Language System tag name. If LANGSYS is omitted, the Default Language System table is used.</p><p>For GSUB-FEATURES, each SYMBOL in FEATURE-LIST specifies a GSUB Feature tag name to apply. '*' is allowed as the last item to specify all remaining features. If SYMBOL is preceded by '~' and the last item is '*', SYMBOL is excluded from the features to apply. If no SYMBOL is specified, no GSUB feature is applied. If GSUB-FEATURES itself is omitted, all GSUB features are applied.</p><p>When OTF-SPEC appears in a FONT-SPEC, FEATURE-LIST specifies features that the font must have (or must not have if preceded by '~'), and the last'*', even if exists, has no meaning.</p><p>The specification of GPOS-FEATURES is analogous to that of GSUB-FEATURES.</p><p>Please note that all the tags above must be 4 ASCII printable characters.</p><p>See the following page for the OpenType specification.</p><p> &lt;http://www.microsoft.com/typography/otspec/default.htm&gt;</p>
<pre>
COMBINING ::= SYMBOL
</pre>
<p>COMBINING is a symbol whose name specifies how to combine the next glyph with the previous one. This rule sets the default combining-spec to an integer code that is unique to the symbol name. The name has the following syntax.</p>
<pre>
  COMBINING-NAME ::= VPOS HPOS OFFSET VPOS HPOS

  VPOS ::= 't' | 'c' | 'b' | 'B'

  HPOS ::= 'l' | 'c' | 'r'

  OFFSET :: = '.' | XOFF | YOFF XOFF ?

  XOFF ::= ('&lt;' | '&gt;') INTEGER ?

  YOFF ::= ('+' | '-') INTEGER ?
</pre>
<p>VPOS and HPOS specify the vertical and horizontal positions as described below.</p>
<pre>
                                POINT VPOS HPOS
                                ----- ---- ----
    0----1----2 &lt;---- top       0     t    l
    |         |                 1     t    c
    |         |                 2     t    r
    |         |                 3     B    l
    9   10   11 &lt;---- center    4     B    c
    |         |                 5     B    r
  --3----4----5-- &lt;-- baseline  6     b    l
    |         |                 7     b    c
    6----7----8 &lt;---- bottom    8     b    r
                                9     c    l
    |    |    |                10     c    c
  left center right            11     c    r
</pre>
<p>The left figure shows 12 reference points of a glyph by numbers 0 to 11. The rectangle 0-6-8-2 is the bounding box of the glyph, the positions 3, 4, and 5 are on the baseline, 9-11 are on the vertical center of the box, 0-2 and 6-8 are on the top and on the bottom respectively. 1, 10, 4, and 7 are on the horizontal center of the box.</p><p>The right table shows how those reference points are specified by a pair of VPOS and HPOS.</p><p>The first VPOS and HPOS in the definition of COMBINING-NAME specify the reference point of the previous glyph, and the second VPOS and HPOS specify that of the next glyph. The next glyph is drawn so that these two reference points align.</p><p>OFFSET specifies the way of alignment in detail. If it is '.', the reference points are on the same position.</p><p>XOFF specifies how much the X position of the reference point of the next glyph should be shifted to the left ('&lt;') or right ('&gt;') from the previous reference point.</p><p>YOFF specifies how much the Y position of the reference point the next glyph should be shifted upward ('+') or downward ('-') from the previous reference point.</p><p>In both cases, INTEGER is the amount of shift expressed as a percentage of the font size, i.e., if INTEGER is 10, it means 10% (1/10) of the font size. If INTEGER is omitted, it is assumed that 5 is specified.</p><p>Once the next glyph is combined with the previous one, they are treated as a single combined glyph.</p>
<pre>
MACRO-NAME ::= SYMBOL
</pre>
<p>MACRO-NAME is a symbol that appears in one of MACRO-DEF. It is exapanded to the sequence of the corresponding RULEs.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTEXT DEPENDENT BEHAVIOR</h2>
        <div class="sectioncontent">
<p>So far, it has been assumed that each sequence, which is drawn with a specific font, is context free, i.e. not affected by the glyphs preceding or following that sequence. This is true when sequence S1 is drawn with font F1 while the preceding sequence S0 unconditionally requires font F0.</p>
<pre>
  sequence                              S0      S1
  currently used font                   F0      F1
  usable font(s)                        F0      F1
</pre>
<p>Sometimes, however, a clear separation of sequences is not possible. Suppose that the preceding sequence S0 can be drawn not only with F0 but also with F1.</p>
<pre>
  sequence                              S0      S1
  currently used font                   F0      F1
  usable font(s)                        F0,F1   F1
</pre>
<p>In this case, glyphs used to draw the preceding S0 may affect glyph generation of S1. Therefore it is necessary to access information about S0, which has already been processed, when processing S1. Generation rules in the first stage (only in the first stage) accept a special regular expression to access already processed parts.</p>
<pre>
  "RE0 RE1"
</pre>
<p>RE0 and RE1 are regular expressions that match the preceding sequence S0 and the following sequence S1, respectively.</p><p>Pay attention to the space between the two regular expressions. It represents the special category ' ' (see above). Note that the regular expression above belongs to glyph generation rules using font F1, therefore not only RE1 but also RE0 must be expressed with the categories for F1. This means when the preceding sequence S0 cannot be expressed with the categories for F1 (as in the first example above) generation rules having these patterns never match.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mdbFLT&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/mdbGeneral.5.html"><strong>mdbGeneral</strong>(5)</a></strong>, <strong>FLTs provided by the m17n database</strong></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYRIGHT</h2>
        <div class="sectioncontent">
<p>Copyright (C) 2001 Information-technology Promotion Agency (IPA)</p><p>Copyright (C) 2001-2011 National Institute of Advanced Industrial Science and Technology (AIST)</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License &lt;http://www.gnu.org/licenses/fdl.html&gt;.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mdbDir.5.html"><span aria-hidden="true">&larr;</span> mdbDir.5: List of data in a database directory.</a></li>
   <li class="next"><a href="mdbFontEncoding.5.html">mdbFontEncoding.5: Font encoding <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
