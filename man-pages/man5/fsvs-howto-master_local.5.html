<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>fsvs-howto-master_local: This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="fsvs-howto-master_local (5) manual">
  <meta name="twitter:description" content="This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.">
  <meta name="twitter:image" content="https://www.carta.tech/images/fsvs-fsvs-howto-master_local-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/fsvs-howto-master_local.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="fsvs-howto-master_local (5) manual" />
  <meta property="og:description" content="This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/fsvs-fsvs-howto-master_local-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">fsvs-howto-master_local<small> (5)</small></h1>
        <p class="lead">This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/fsvs-howto-master_local.5.html">
      <span itemprop="name">fsvs-howto-master_local: This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/fsvs/">
      <span itemprop="name">fsvs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/fsvs-howto-master_local.5.html">
      <span itemprop="name">fsvs-howto-master_local: This howto describes how to use a single working copy with multiple repositories. this howto describes how to use a single working copy with multiple repositories.  please read the howto: backup first, to know about basic steps using fsvs.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">Rationale</h2>
        <div class="sectioncontent">
<p>If you manage a lot of machines with similar or identical software, you might notice that it's a bit of work keeping them all up-to-date. Sure, automating distribution via rsync or similar is easy; but then you get identical machines, or you have to play with lots of exclude patterns to keep the needed differences.</p><p>Here another way is presented; and even if you don't want to use FSVS for distributing your files, the ideas presented here might help you keep your machines under control.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Preparation, repository layout</h2>
        <div class="sectioncontent">
<p>In this document the basic assumption is that there is a group of (more or less identical) machines, that share most of their filesystems.</p><p>Some planning should be done beforehand; while the ideas presented here might suffice for simple versioning, your setup can require a bit of thinking ahead.</p><p>This example uses some distinct repositories, to achieve a bit more clarity; of course these can simply be different paths in a single repository (see <strong>Using a single repository</strong> for an example configuration).</p><p>Repository in URL base:</p>
<pre>
  trunk/
    bin/
      ls
      true
    lib/
      libc6.so
      modules/
    sbin/
      mkfs
    usr/
      local/
      bin/
      sbin/
  tags/
  branches/

</pre>
<p>Repository in URL machine1 (similar for machine2):</p>
<pre>
  trunk/
    etc/
      HOSTNAME
      adjtime
      network/
        interfaces
      passwd
      resolv.conf
      shadow
    var/
      log/
        auth.log
        messages
  tags/
  branches/

</pre>
<h3>User data versioning</h3>
<p>If you want to keep the user data versioned, too, a idea might be to start a new working copy in <strong>every</strong> home directory; this way</p><ul>
<li><p>the system- and (several) user-commits can be run in parallel,</p></li><li><p>the intermediate home directory in the repository is not needed, and</p></li><li><p>you get a bit more isolation (against FSVS failures, out-of-space errors and similar).</p></li><li><p>Furthermore FSVS can work with smaller file sets, which helps performance a bit (less dentries to cache at once, less memory used, etc.).</p></li>
</ul>
<pre>
  A/
      Andrew/
            .bashrc
            .ssh/
            .kde/
    Alexander/
            .bashrc
            .ssh/
            .kde/
  B/
      Bertram/
</pre>
<p>A cronjob could simply loop over the directories in /home, and call fsvs for each one; giving a target URL name is not necessary if every home-directory is its own working copy.</p><p><strong>Note:</strong></p><p>URL names can include a forward slash / in their name, so you might give the URLs names like home/Andrew - although that should not be needed, if every home directory is a distinct working copy.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Using master/local repositories</h2>
        <div class="sectioncontent">
<p>Imagine having 10 similar machines with the same base-installation.</p><p>Then you install one machine, commit that into the repository as base/trunk, and make a copy as base/released.</p><p>The other machines get base/released as checkout source, and another (overlaid) from eg. machine1/trunk.</p><p> Per-machine changes are always committed into the machineX/trunk of the per-machine repository; this would be the host name, IP address, and similar things.</p><p>On the development machine all changes are stored into base/trunk; if you're satisfied with your changes, you merge them (see <strong>Branching, tagging, merging</strong>) into base/released<strong>, whereupon all other machines can update to this latest version.</strong></p><p>So by looking at machine1/trunk you can see the history of the machine-specific changes; and in base/released you can check out every old version to verify problems and bugs.</p><p><strong>Note:</strong></p><p>You can take this system a bit further: optional software packages could be stored in other subtrees. They should be of lower priority than the base tree, so that in case of conflicts the base should always be preferred (but see <strong>1</strong>).</p><p>Here is a small example; machine1 is the development machine, machine2 is a <em>client</em>.</p>
<pre>
  machine1$ fsvs urls name:local,P:200,svn+ssh://lserver/per-machine/machine1/trunk
  machine1$ fsvs urls name:base,P:100,http://bserver/base-install1/trunk
    # Determine differences, and commit them
  machine1$ fsvs ci -o commit_to=local /etc/HOSTNAME /etc/network/interfaces /var/log
  machine1$ fsvs ci -o commit_to=base /

</pre>
<p>Now you've got a base-install in your repository, and can use that on the other machine:</p>
<pre>
  machine2$ fsvs urls name:local,P:200,svn+ssh://lserver/per-machine/machine2/trunk
  machine2$ fsvs urls name:base,P:100,http://bserver/base-install1/trunk
  machine2$ fsvs sync-repos
    # Now you see differences of this machines' installation against the other:
  machine2$ fsvs st
    # You can see what is different:
  machine2$ fsvs diff /etc/X11/xorg.conf
    # You can take the base installations files:
  machine2$ fsvs revert /bin/ls
    # And put the files specific to this machine into its repository:
  machine2$ fsvs ci -o commit_to=local /etc/HOSTNAME /etc/network/interfaces /var/log

</pre>
<p>Now, if this machine has a harddisk failure or needs setup for any other reason, you boot it (eg. via PXE, Knoppix or whatever), and do (<strong>3</strong>)</p>
<pre>
  # Re-partition and create filesystems (if necessary)
  machine2-knoppix$ fdisk ...
  machine2-knoppix$ mkfs ...
    # Mount everything below /mnt
  machine2-knoppix$ mount &lt;partition[s]&gt; /mnt/[...]
  machine2-knoppix$ cd /mnt
    # Do a checkout below /mnt
  machine2-knoppix$ fsvs co -o softroot=/mnt &lt;urls&gt;

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Branching, tagging, merging</h2>
        <div class="sectioncontent">
<p>Other names for your branches (instead of trunk, tags and branches) could be unstable, testing, and stable; your production machines would use stable, your testing environment testing, and in unstable you'd commit all your daily changes.</p><p><strong>Note:</strong></p><p>Please note that there's no merging mechanism in FSVS; and as far as I'm concerned, there won't be. Subversion just gets automated merging mechanisms, and these should be fine for this usage too. (<strong>4</strong>)</p><h3>Thoughts about tagging</h3>
<p>Tagging works just like normally; although you need to remember to tag more than a single branch. Maybe FSVS should get some knowledge about the subversion repository layout, so a fsvs tag would tag all repositories at once? It would have to check for duplicate tag-names (eg. on the base -branch), and just keep it if it had the same copyfrom-source.</p><p>But how would tags be used? Define them as source URL, and checkout? Would be a possible case.</p><p>Or should fsvs tag do a <em>merge</em> into the repository, so that a single URL contains all files currently checked out, with copyfrom-pointers to the original locations? Would require using a single repository, as such pointers cannot be across different repositories. If the committed data includes the $FSVS_CONF/<em>.../Urls file, the original layout would be known, too - although to use it a </em><strong>sync-repos</strong><em> would be necessary.</em></p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Using a single repository</h2>
        <div class="sectioncontent">
<p>A single repository would have to be partitioned in the various branches that are needed for bookkeeping; see these examples.</p><p>Depending on the number of machines it might make sense to put them in a 1- or 2 level deep hierarchy; named by the first character, like</p>
<pre>
  machines/
    A/
      Axel/
      Andreas/
    B/
      Berta/
    G/
      Gandalf/
</pre>
<h3>Simple layout</h3>
<p>Here only the base system gets branched and tagged; the machines simply backup their specific/localized data into the repository.</p>
<pre>
# For the base-system:
  trunk/
    bin/
    usr/
    sbin/
  tags/
    tag-1/
  branches/
    branch-1/
# For the machines:
  machines/
    machine1/
      etc/
        passwd
        HOSTNAME
    machine2/
      etc/
        passwd
        HOSTNAME
</pre>

<h3>Per-area</h3>
<p>Here every part gets its trunk, branches and tags:</p>
<pre>
  base/
    trunk/
      bin/
      sbin/
      usr/
    tags/
      tag-1/
    branches/
      branch-1/
  machine1/
    trunk/
      etc/
       passwd
       HOSTNAME
    tags/
      tag-1/
    branches/
  machine2/
    trunk/
      etc/
       passwd
       HOSTNAME
    tags/
    branches/
</pre>

<h3>Common trunk, tags, and branches</h3>
<p>Here the base-paths trunk, tags and branches are shared:</p>
<pre>
  trunk/
    base/
      bin/
      sbin/
      usr/
    machine2/
      etc/
        passwd
        HOSTNAME
    machine1/
      etc/
        passwd
        HOSTNAME
  tags/
     tag-1/
  branches/
     branch-1/
</pre>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Other notes</h2>
        <div class="sectioncontent">
<h3>1</h3>
<p>Conflicts should not be automatically merged. If two or more trees bring the same file, the file from the <em>highest</em> tree wins - this way you always know the file data on your machines. It's better if a single software doesn't work, compared to a machine that no longer boots or is no longer accessible (eg. by SSH)).</p><p>So keep your base installation at highest priority, and you've got good chances that you won't loose control in case of conflicting files.</p>
<h3>2</h3>
<p>If you don't know which files are different in your installs,</p><ul>
<li><p>install two machines,</p></li><li><p>commit the first into fsvs,</p></li><li><p>do a <strong>sync-repos</strong> on the second,</p></li><li><p>and look at the <strong>status</strong> output.</p></li>
</ul>
<h3>3</h3>
<p>As debian includes FSVS in the near future, it could be included on the next KNOPPIX, too!</p><p>Until then you'd need a custom boot CD, or copy the absolute minimum of files to the harddisk before recovery.</p><p>There's a utility svntar available; it allows you to take a snapshot of a subversion repository directly into a .tar -file, which you can easily export to destination machine. (Yes, it knows about the meta-data properties FSVS uses, and stores them into the archive.)</p>
<h3>4</h3>
<p>Why no file merging? Because all real differences are in the per-machine files -- the files that are in the base repository are changed only on a single machine, and so there's an unidirectional flow.</p><p>BTW, how would you merge your binaries, eg. /bin/ls?</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Feedback</h2>
        <div class="sectioncontent">
<p>If you've got any questions, ideas, wishes or other feedback, please tell us in the mailing list users [at] fsvs.tigris.org.</p><p>Thank you!</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">Author</h2>
        <div class="sectioncontent">
<p>Generated automatically by Doxygen for fsvs from the source code.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="fsvs-howto-backup.5.html"><span aria-hidden="true">&larr;</span> fsvs-howto-backup.5: This document is a step-by-step explanation how to do backups using fsvs. this document is a step-by-step explanation how to do backups using fsvs.</a></li>
   <li class="next"><a href="fsvs-url-format.5.html">fsvs-url-format.5: Fsvs can use more than one url; the given urls are overlaid according to their priority. fsvs can use more than one url; the given urls are overlaid according to their priority.  for easier managing they get a name, and can optionally take a target revision.  such an extended url has the form <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
