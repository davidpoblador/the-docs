<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mh-format: Format file for nmh message system</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Format file for nmh message system">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="mh-format (5mh) manual">
  <meta name="twitter:description" content="Format file for nmh message system">
  <meta name="twitter:image" content="https://www.carta.tech/images/nmh-mh-format-5mh.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5mh/mh-format.5mh.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="mh-format (5mh) manual" />
  <meta property="og:description" content="Format file for nmh message system" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/nmh-mh-format-5mh.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">mh-format<small> (5mh)</small></h1>
        <p class="lead">Format file for nmh message system</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5mh/">
      <span itemprop="name">MISSING SECTION</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5mh/mh-format.5mh.html">
      <span itemprop="name">mh-format: Format file for nmh message system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/nmh/">
      <span itemprop="name">nmh</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5mh/mh-format.5mh.html">
      <span itemprop="name">mh-format: Format file for nmh message system</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Several <strong>nmh</strong> commands utilize either a <em>format</em> string or a <em>format</em> file during their execution.  For example, <strong>scan</strong> uses a format string which directs it how to generate the scan listing for each message; <strong>repl</strong> uses a format file which directs it how to generate the reply to a message, and so on.</p><p>There are a few alternate scan listing formats available in <em>nmh/etc/scan.time</em>, <em>nmh/etc/scan.size</em>, and <em>nmh/etc/scan.timely</em>. Look in <em>nmh/etc</em> for other <strong>scan</strong> and <strong>repl</strong> format files which may have been written at your site.</p><p>It suffices to have your local <strong>nmh</strong> expert actually write new format commands or modify existing ones.  This manual section explains how to do that.  Note: familiarity with the C <strong>printf</strong> routine is assumed.</p><p>A format string consists of ordinary text, and special multi-character escape sequences which begin with `%'.  When specifying a format string, the usual C backslash characters are honored: `&#92;b', `&#92;f', `&#92;n', `&#92;r', and `&#92;t'.  Continuation lines in format files end with `&#92;' followed by the newline character. A literal `%' can be inserted into a format file by using the sequence `%%'.</p><h3>SYNTAX</h3>
<p>Format strings are built around <em>escape sequences</em>. There are three types of escape sequences: header <em>components</em>, built-in <em>functions</em>, and flow <em>control</em>. Comments may be inserted in most places where a function argument is not expected.  A comment begins with `%;' and ends with a (non-escaped) newline.</p><p>A <em>component</em> escape is specified as `%{<em>component</em>}', and exists for each header found in the message being processed.  For example `%{<em>date</em>}' refers to the &ldquo;Date:&rdquo; field of the appropriate message. All component escapes have a string value.  Normally, component values are compressed by converting any control characters (tab and newline included) to spaces, then eliding any leading or multiple spaces.  However, commands may give different interpretations to some component escapes; be sure to refer to each command's manual entry for complete details.  Some commands (such as <strong>ap</strong> and <strong>mhl</strong>) use a special component `%{<em>text</em>}' to refer to the text being processed; see their respective man pages for details and examples.</p><p>A <em>function</em> escape is specified as `%(<em>function</em>)'. All functions are built-in, and most have a string or numeric value. A function escape may have an <em>argument</em>. The argument follows the function escape: separating whitespace is discarded: `%(<em>function</em> <em>argument</em>)'.</p><p>In addition to literal numbers or strings, the argument to a function escape can be another function, a component, or a control escape.  When the argument is a function or a component, they are listed without a leading `%'.  When control escapes are used as function arguments, they written as normally, with a leading `%';</p>
<h3>Control escapes</h3>
<p>A <em>control</em> escape is one of: `%&lt;', `%?', `%|', or `%&gt;'. These are combined into the conditional execution construct:</p>
<pre>
%&lt; <em>condition</em> <em>format-text</em>
%? <em>condition</em> <em>format-text</em>
    ...
%| <em>format-text</em>
%&gt;
</pre>
<p>Extra white space is shown here only for clarity.  These constructs may be nested without ambiguity.  They form a general <strong>if-elseif-else-endif</strong> block where only one of the format-texts is interpreted.  In other words, `%&lt;' is like the "if", `%?' is like the "elseif", `%|' is like "else", and `%&gt;' is like "endif".</p><p>A `%&lt;' or `%?' control escape causes its condition to be evaluated. This condition is a <em>component</em> or <em>function</em>. For integer valued functions or components, the condition is true if the function return or component value is non-zero, and false if zero. For string valued functions or components, the condition is true if the function return or component value is a non-empty string, and false for an empty string.</p><p>The `%?' control escape is optional, and may there may be more than one `%?' control escape in a conditional block. The `%|' control escape is also optional, but may be included at most once.</p>
<h3>Function escapes</h3>
<p>Functions expecting an argument generally require an argument of a particular type. In addition to the number and string types, these include:</p>
<pre>
<em>Argument	Description	Example Syntax</em>
literal	A literal number	%(<em>func</em> 1234)
	or string		%(<em>func</em> text string)
comp	Any component		%(<em>func</em>\^{<em>in-reply-to</em>\^})
date	A date component	%(<em>func</em>\^{<em>date</em>\^})
addr	An address component	%(<em>func</em>\^{<em>from</em>\^})
expr	Nothing	%(<em>func</em>)
	or a subexpression	%(<em>func</em>\^(<em>func2</em>\^))
	or control escape	%(<em>func</em> %&lt;{<em>reply-to</em>\^}%|%{<em>from</em>\^}%&gt;)
</pre>
<p>The types <em>date</em> and <em>addr</em> have the same syntax as <em>comp</em>, but require that the header component be a date string, or address string, respectively.</p><p>Most arguments not of type <em>expr</em> are required. When escapes are nested (via expr arguments), evaluation is done from inner-most to outer-most. As noted above, for the expr argument type, functions and components are written without a leading `%'. Control escape arguments must use a leading `%', preceded by a space.</p><p>For example,</p>
<pre>
%&lt;(mymbox{from}) To: %{to}%&gt;
</pre>
<p>writes  the  value of the header component &ldquo;From:&rdquo; to the internal register named str; then (<em>mymbox</em>\^) reads str and writes its result to the internal register named <em>num</em>; then the control escape evaluates <em>num</em>. If <em>num</em> is non-zero, the string &ldquo;To:&rdquo; is printed  followed  by  the  value  of  the header component &ldquo;To:&rdquo;.</p>
<h3>Evaluation</h3>
<p>The evaluation of format strings is performed by a small virtual machine. The machine is capable of evaluating nested expressions as described above, and in addition has an integer register <em>num</em>, and a text string register <em>str</em>. When a function escape that accepts an optional argument is processed, and the argument is not present, the current value of either <em>num</em> or <em>str</em> is used as the argument: which register is used depends on the function, as listed below.</p><p>Component escapes write the value of their message header in <em>str</em>. Function escapes write their return value in <em>num</em> for functions returning integer or boolean values, and in <em>str</em> for functions returning string values.  (The boolean type is a subset of integers with usual values 0=false and 1=true.)  Control escapes return a boolean value, setting <em>num</em> to 1 if the last explicit condition evaluated by a `%&lt;' or `%?' control succeeded, and 0 otherwise.</p><p>All component escapes, and those function escapes which return an integer or string value, evaluate to their value as well as setting <em>str</em> or <em>num</em>. Outermost escape expressions in these forms will print their value, but outermost escapes which return a boolean value do not result in printed output.</p>
<h3>Functions</h3>
<p>The function escapes may be roughly grouped into a few categories.</p>
<pre>
<em>Function	Argument   Result	Description</em>
msg		integer	message number
cur		integer	message is current (0 or 1)
unseen		integer	message is unseen (0 or 1)
size		integer	size of message
strlen		integer	length of <em>str</em>
width		integer	column width of terminal
charleft		integer	bytes left in output buffer
timenow		integer	seconds since the UNIX epoch
me		string	the user's mailbox (username)
myhost		string	the user's local hostname
myname		string	the user's name
localmbox		string	the complete local mailbox
eq	literal	boolean	<em>num</em> == <em>arg</em>
ne	literal	boolean	<em>num</em> != <em>arg</em>
gt	literal	boolean	<em>num</em> &gt; <em>arg</em>
match	literal	boolean	<em>str</em> contains <em>arg</em>
amatch	literal	boolean	<em>str</em> starts with <em>arg</em>
plus	literal	integer	<em>arg</em> plus <em>num</em>
minus	literal	integer	<em>arg</em> minus <em>num</em>
divide	literal	integer	<em>num</em> divided by <em>arg</em>
modulo	literal	integer	<em>num</em> modulo <em>arg</em>
num	literal	integer	Set <em>num</em> to <em>arg</em>.
num		integer	Set <em>num</em> to zero.
lit 	literal	string	Set <em>str</em> to <em>arg</em>.
lit		string	Clear <em>str</em>.
getenv 	literal	string	Set <em>str</em> to environment value of <em>arg</em>
profile	literal	string	Set <em>str</em> to profile component <em>arg</em>
			value
nonzero	expr	boolean	<em>num</em> is non-zero
zero	expr	boolean	<em>num</em> is zero
null	expr	boolean	<em>str</em> is empty
nonnull	expr	boolean	<em>str</em> is non-empty
void	expr		Set <em>str</em> or <em>num</em>
comp	comp	string	Set <em>str</em> to component text
compval	comp	integer	Set <em>num</em> to &ldquo;<strong>atoi</strong>(<em>comp</em>\^)&rdquo;
decode	expr	string	decode <em>str</em> as RFC 2047 (MIME-encoded)
			component
unquote	expr	string	remove RFC 2822 quotes from <em>str</em>
trim	expr		trim trailing whitespace from <em>str</em>
putstr	expr		print <em>str</em>
putstrf	expr		print <em>str</em> in a fixed width
putnum	expr		print <em>num</em>
putnumf	expr		print <em>num</em> in a fixed width
putlit	expr		print <em>str</em> without space compression
zputlit	expr		print <em>str</em> without space compression;
			<em>str</em> must occupy no width on display
bold		string	set terminal bold mode
underline		string	set terminal underlined mode
standout		string	set terminal standout mode
resetterm		string	reset all terminal attributes
hascolor		boolean	terminal supports color
fgcolor	literal	string	set terminal foreground color
bgcolor	literal	string	set terminal background color
formataddr	expr		append <em>arg</em> to <em>str</em> as a
			(comma separated) address list
concataddr	expr		append <em>arg</em> to <em>str</em> as a
			(comma separated) address list,
			including duplicates,
			see Special Handling
putaddr	literal		print <em>str</em> address list with
			<em>arg</em> as optional label;
			get line width from <em>num</em>
</pre>
<p>The (<em>me</em>\^) function returns the username of the current user.  The (<em>myhost</em>\^) function returns the <strong>localname</strong> entry in <em>mts.conf</em>, or the local hostname if <strong>localname</strong> is not configured.  The (<em>myname</em>\^) function will return the value of the <strong>SIGNATURE</strong> environment variable if set, otherwise will return the passwd GECOS field (truncated at the first comma if it contains one) for the current user.  The (<em>localmbox</em>\^) function will return the complete form of the local mailbox, suitable for use in a &ldquo;From&rdquo; header. It will return the &ldquo;<em>Local-Mailbox</em>&rdquo; profile entry if it is set; if it is not, it will be equivalent to:</p>
<pre>
%(myname) &lt;%(me)@%(myhost)&gt;
</pre>
<p>The following functions require a date component as an argument:</p>
<pre>
<em>Function	Argument	Return	Description</em>
sec	date	integer	seconds of the minute
min	date	integer	minutes of the hour
hour	date	integer	hours of the day (0-23)
wday	date	integer	day of the week (Sun=0)
day	date	string	day of the week (abbrev.)
weekday	date	string	day of the week
sday	date	integer	day of the week known?
			(1=explicit,0=implicit,-1=unknown)
mday	date	integer	day of the month
yday	date	integer	day of the year
mon	date	integer	month of the year
month	date	string	month of the year (abbrev.)
lmonth	date	string	month of the year
year	date	integer	year (may be &gt; 100)
zone	date	integer	timezone in hours
tzone	date	string	timezone string
szone	date	integer	timezone explicit?
			(1=explicit,0=implicit,-1=unknown)
date2local	date		coerce date to local timezone
date2gmt	date		coerce date to GMT
dst	date	integer	daylight savings in effect? (0 or 1)
clock	date	integer	seconds since the UNIX epoch
rclock	date	integer	seconds prior to current time
tws	date	string	official RFC 822 rendering
pretty	date	string	user-friendly rendering
nodate	date	integer	returns 1 if date is invalid
</pre>
<p>These functions require an address component as an argument. The return value of functions noted with `*' is computed from the first address present in the header component.</p>
<pre>
<em>Function	Argument	Return	Description</em>
proper	addr	string	official RFC 822 rendering
friendly	addr	string	user-friendly rendering
addr	addr	string	mbox@host or host!mbox rendering*
pers	addr	string	the personal name*
note	addr	string	commentary text*
mbox	addr	string	the local mailbox*
mymbox	addr	integer	List has the user's address? (0 or 1)
host	addr	string	the host domain*
nohost	addr	integer	no host was present (0 or 1)*
type	addr	integer	host type* (0=local,1=network,
			-1=uucp,2=unknown)
path	addr	string	any leading host route*
ingrp	addr	integer	address was inside a group (0 or 1)*
gname	addr	string	name of group*
</pre>
<p>(A clarification on (<em>mymbox</em>\^{<em>comp</em>\^}) is in order. This function checks each of the addresses in the header component &ldquo;<em>comp</em>&rdquo; against the user's mailbox name and any &ldquo;<em>Alternate-Mailboxes</em>&rdquo;. It returns true if any address matches, however, it also returns true if the &ldquo;<em>comp</em>&rdquo; header is not present in the message.  If needed, the (<em>null</em>\^) function can be used to explicitly test for this case.)</p>
<h3>Formatting</h3>
<p>When a function or component escape is interpreted and the result will be immediately printed, an optional field width can be specified to print the field in exactly a given number of characters.  For example, a numeric escape like %4(<em>size</em>\^) will print at most 4 digits of the message size; overflow will be indicated by a `?' in the first position (like `?234').  A string escape like %4(<em>me</em>\^) will print the first 4 characters and truncate at the end.  Short fields are padded at the right with the fill character (normally, a blank).  If the field width argument begins with a leading zero, then the fill character is set to a zero.</p><p>The functions (<em>putnumf</em>\^) and (<em>putstrf</em>\^) print their result in exactly the number of characters specified by their leading field width argument.  For example, %06(<em>putnumf</em>\^(<em>size</em>\^)) will print the message size in a field six characters wide filled with leading zeros; %14(<em>putstrf\^</em>{<em>from\^</em>}) will print the &ldquo;From:&rdquo; header component in fourteen characters with trailing spaces added as needed. For <em>putstrf</em>, using a negative value for the field width causes right-justification of the string within the field, with padding on the left up to the field width. The functions (<em>putnum</em>\^) and (<em>putstr</em>\^) are somewhat special: they print their result in the minimum number of characters required, and ignore any leading field width argument.  The (<em>putlit</em>\^) function outputs the exact contents of the str register without any changes such as duplicate space removal or control character conversion. The (<em>zputlit</em>\^) function similarly outputs the exact contents of the str register, but requires that those contents not occupy any output width.  It can therefore be used for outputting terminal escape sequences.</p><p>There are a limited number of function escapes to output terminal escape sequences. These sequences are retrieved from the <a href="../man5/terminfo.5.html"><strong>terminfo</strong>(5)</a> database according to the current terminal setting.  The (<em>bold</em>\^), (<em>underline</em>\^), and (<em>standout</em>\^) escapes set bold mode, underline mode, and standout mode respectively.</p><p>(<em>hascolor</em>\^) can be used to determine if the current terminal supports color. (<em>fgcolor</em>\^) and (<em>bgcolor</em>\^) set the foreground and background colors respectively.  Both of these escapes take one literal argument, the color name, which can be one of: black, red, green, yellow, blue, magenta, cyan, white.  (<em>resetterm</em>\^) resets all terminal attributes back to their default setting.</p><p>All of these terminal escape should be used in conjunction with (<em>zputlit</em>\^) (preferred) or (<em>putlit</em>\^), as the normal (<em>putstr</em>\^) function will strip out control characters.</p><p>The available output width is kept in an internal register; any output past this width will be truncated.  The one exception to this is (<em>zputlit</em>\^) functions will still be executed in case a terminal reset code is being placed at the end of the line.</p>
<h3>Special Handling</h3>
<p>A few functions have different behavior depending on what command they are being invoked from.</p><p>In <strong>repl</strong> the (<em>formataddr</em>\^) function stores all email addresses encountered into an internal cache and will use this cache to suppress duplicate addresses. If you need to create an address list that includes previously-seen addresses you may use the (<em>concataddr</em>\^) function, which is identical to (<em>formataddr</em>\^) in all other respects.  Note that (<em>concataddr</em>\^) will NOT add addresses to the duplicate-suppression cache.</p>
<h3>Other Hints and Tips</h3>
<p>Sometimes to format function writers it is confusing as to why output is duplicated.  The general rule to remember is simple: If a function or component escape is used where it starts with a %, then it will generate text in the output file.  Otherwise, it will not.</p><p>A good example is a simple attempt to generate a To: header based on the From: and Reply-To: headers:</p>
<pre>
%(formataddr %&lt;{reply-to}%|%{from})%(putaddr To: )
</pre>
<p>Unfortuantely if the Reply-to: header is NOT present, the output line that is generated will be something like:</p>
<pre>
My From User &lt;from@example.com&gt;To: My From User &lt;from@example.com&gt;
</pre>
<p>What went wrong?  When performing the test for the <strong>if</strong> clause (%&lt;), the component is not output because it is considered an argument to the <strong>if</strong> statement (hence the rule about the lack of % applies).  But the component escape in our <strong>else</strong> statement (everything after the `%|') is NOT an argument to anything; the syntax is that it is written with a %, and thus the value of that component is output.  This also has the side effect of setting the <em>str</em> register, which is later picked up by the (<em>formataddr</em>\^) function and then output by (<em>putaddr</em>\^).  This format string has another bug as well; there should always be a valid width value in the <em>num</em> register when (<em>putaddr</em>\^) is called, otherwise bad formatting can take place.</p><p>The solution is to use the (<em>void</em>\^) function; this will prevent the function or component from outputting any text.  With this in place (and using (<em>width</em>\^) to set the <em>num</em> register for the width, a better implementation would look like:</p>
<pre>
%(formataddr %&lt;{reply-to}%|%(void{from})%(void(width))%(putaddr To: )
</pre>
<p>It should be noted here that the side-effects of functions and component escapes still are in force: as a result each component test in the <strong>if-elseif-else-endif</strong> clause sets the <em>str</em> register.</p><p>As an additional note, the (<em>formataddr</em>\^) and (<em>concataddr</em>\^) functions have special behavior when it comes to the <em>str</em> register.  The starting point of the register is saved and is used to build up entries in the address list.</p><p>You will find the <strong>fmttest</strong> utility invaluable when debugging problems with format strings.</p>
<h3>Examples</h3>
<p>With all this in mind, here's the default format string for <strong>scan</strong>. It's been divided into several pieces for readability. The first part is:</p>
<pre>
%4(msg)%&lt;(cur)+%| %&gt;%&lt;{replied}-%?{encrypted}E%| %&gt;
</pre>
<p>which says that the message number should be printed in four digits. If the message is the current message then a `+' else a space should be printed; if a &ldquo;Replied:&rdquo; field is present then a `-' else if an &ldquo;Encrypted:&rdquo; field is present then an `E' otherwise a space should be printed.  Next:</p>
<pre>
%02(mon{date})/%02(mday{date})
</pre>
<p>the month and date are printed in two digits (zero filled) separated by a slash. Next,</p>
<pre>
%&lt;{date} %|*%&gt;
</pre>
<p>If a &ldquo;Date:&rdquo; field was present, then a space is printed, otherwise a `*'. Next,</p>
<pre>
%&lt;(mymbox{from})%&lt;{to}To:%14(decode(friendly{to}))%&gt;%&gt;
</pre>
<p>if the message is from me, and there is a &ldquo;To:&rdquo; header, print &ldquo;To:&rdquo; followed by a &ldquo;user-friendly&rdquo; rendering of the first address in the &ldquo;To:&rdquo; field; any MIME-encoded characters are decoded into the actual characters. Continuing,</p>
<pre>
%&lt;(zero)%17(decode(friendly{from}))%&gt;
</pre>
<p>if either of the above two tests failed, then the &ldquo;From:&rdquo; address is printed in a mime-decoded, &ldquo;user-friendly&rdquo; format. And finally,</p>
<pre>
%(decode{subject})%&lt;{body}&lt;&lt;%{body}&gt;&gt;%&gt;
</pre>
<p>the mime-decoded subject and initial body (if any) are printed.</p><p>For a more complicated example, next consider a possible <em>replcomps</em> format file.</p>
<pre>
%(lit)%(formataddr %&lt;{reply-to}
</pre>
<p>This clears <em>str</em> and formats the &ldquo;Reply-To:&rdquo; header if present.  If not present, the else-if clause is executed.</p>
<pre>
%?{from}%?{sender}%?{return-path}%&gt;)&#92;
</pre>
<p>This formats the &ldquo;From:&rdquo;, &ldquo;Sender:&rdquo; and &ldquo;Return-Path:&rdquo; headers, stopping as soon as one of them is present.  Next:</p>
<pre>
%&lt;(nonnull)%(void(width))%(putaddr To: )&#92;n%&gt;&#92;
</pre>
<p>If the <em>formataddr</em> result is non-null, it is printed as an address (with line folding if needed) in a field <em>width</em> wide with a leading label of &ldquo;To:&rdquo;.</p>
<pre>
%(lit)%(formataddr{to})%(formataddr{cc})%(formataddr(me))&#92;
</pre>
<p><em>str</em> is cleared, and the &ldquo;To:&rdquo; and &ldquo;Cc:&rdquo; headers, along with the user's address (depending on what was specified with the &ldquo;-cc&rdquo; switch to <em>repl</em>\^) are formatted.</p>
<pre>
%&lt;(nonnull)%(void(width))%(putaddr cc: )&#92;n%&gt;&#92;
</pre>
<p>If the result is non-null, it is printed as above with a leading label of &ldquo;cc:&rdquo;.</p>
<pre>
%&lt;{fcc}Fcc: %{fcc}&#92;n%&gt;&#92;
</pre>
<p>If a <strong>-fcc</strong> <em>folder</em> switch was given to <strong>repl</strong> (see <strong>repl</strong>(1) for more details about %{<em>fcc</em>\^}), an &ldquo;Fcc:&rdquo; header is output.</p>
<pre>
%&lt;{subject}Subject: Re: %{subject}&#92;n%&gt;&#92;
</pre>
<p>If a subject component was present, a suitable reply subject is output.</p>
<pre>
%&lt;{message-id}In-Reply-To: %{message-id}&#92;n%&gt;&#92;
%&lt;{message-id}References: %&lt;{references} %{references}%&gt;&#92;
%{message-id}&#92;n%&gt;
--------
</pre>
<p>If a message-id component was present, an &ldquo;In-Reply-To:&rdquo; header is output including the message-id, followed by a &ldquo;References:&rdquo; header with references, if present, and the message-id. As with all plain-text, the row of dashes are output as-is.</p><p>This last part is a good example for a little more elaboration. Here's that part again in pseudo-code:</p>
<pre>
if (comp_exists(message-id))  then
	print (&ldquo;In-reply-to: &rdquo;)
	print (message-id.value)
	print (&ldquo;&#92;n&rdquo;)
endif
if (comp_exists(message-id)) then
	print (&ldquo;References: &rdquo;)
	if (comp_exists(references)) then
	      print(references.value);
	endif
	print (message-id.value)
	print (&ldquo;&#92;n&rdquo;)
endif
</pre>
<p>One more example: Currently, <strong>nmh</strong> supports very large message numbers, and it is not uncommon for a folder to have far more than 10000 messages. Nontheless (as noted above) the various scan format strings are inherited from older MH versions, and are generally hard-coded to 4 digits of message number before formatting problems start to occur. The nmh format strings can be modified to behave more sensibly with larger message numbers:</p>
<pre>
%(void(msg))%&lt;(gt 9999)%(msg)%|%4(msg)%&gt;
</pre>
<p>The current message number is placed in <em>num</em>. (Note that (<em>msg</em>) is an int function, not a component.) The (<em>gt</em>) conditional is used to test whether the message number has 5 or more digits. If so, it is printed at full width, otherwise at 4 digits.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO mh-format&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man1/scan.1.html"><strong>scan</strong>(1)</a>, <strong>repl</strong>(1), <strong>fmttest</strong>(1),</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">CONTEXT</h2>
        <div class="sectioncontent">
<p>None</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="mh-alias.5mh.html"><span aria-hidden="true">&larr;</span> mh-alias.5mh: Format of nmh alias files</a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
