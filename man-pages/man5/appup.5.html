<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>appup: Application upgrade file.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Application upgrade file.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="appup (5) manual">
  <meta name="twitter:description" content="Application upgrade file.">
  <meta name="twitter:image" content="https://www.carta.tech/images/erlang-manpages-appup-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/appup.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="appup (5) manual" />
  <meta property="og:description" content="Application upgrade file." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/erlang-manpages-appup-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">appup<small> (5)</small></h1>
        <p class="lead">Application upgrade file.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/appup.5.html">
      <span itemprop="name">appup: Application upgrade file.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/erlang-manpages/">
      <span itemprop="name">erlang-manpages</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/appup.5.html">
      <span itemprop="name">appup: Application upgrade file.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>The <em>application upgrade file</em> defines how an application is upgraded or downgraded in a running system.</p><p>This file is used by the functions in <em>systools</em> when generating a release upgrade file <em>relup</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILE SYNTAX</h2>
        <div class="sectioncontent">
<p>The application upgrade file should be called <em>Application.appup</em> where <em>Application</em> is the name of the application. The file should be located in the <em>ebin</em> directory for the application.</p><p>The <em>.appup</em> file contains one single Erlang term, which defines the instructions used to upgrade or downgrade the application. The file has the following syntax:</p>
<pre>
{Vsn,
  [{UpFromVsn, Instructions}, ...],
  [{DownToVsn, Instructions}, ...]}.

</pre>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>Vsn = string()</em> is the current version of the application.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>UpFromVsn = string() | binary()</em> is an earlier version of the application to upgrade from. If it is a string, it will be interpreted as a specific version number. If it is a binary, it will be interpreted as a regular expression which can match multiple version numbers.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>DownToVsn = string() | binary()</em> is an earlier version of the application to downgrade to. If it is a string, it will be interpreted as a specific version number. If it is a binary, it will be interpreted as a regular expression which can match multiple version numbers.</p>
  </dd>

</dl>

<dl class='dl-vertical'>
  <dt>
    <p>*</p>
  </dt>
  <dd>
    <p><em>Instructions</em> is a list of <em>release upgrade instructions</em>, see below. It is recommended to use high-level instructions only. These are automatically translated to low-level instructions by <em>systools</em> when creating the <em>relup</em> file.</p>
  </dd>

</dl>
<p>In order to avoid duplication of upgrade instructions it is allowed to use regular expressions to specify the <em>UpFromVsn</em> and <em>DownToVsn</em>. To be considered a regular expression, the version identifier must be specified as a binary, e.g.</p>
<pre>
&lt;&lt;"2&#92;&#92;.1&#92;&#92;.[0-9]+"&gt;&gt;
</pre>
<p>will match all versions <em>2.1.x</em>, where x is any number.</p><p>Note that the regular expression must match the complete version string, so the above example will work for for e.g. <em>2.1.1</em>, but not for <em>2.1.1.1</em></p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELEASE UPGRADE INSTRUCTIONS</h2>
        <div class="sectioncontent">
<p>Release upgrade instructions are interpreted by the release handler when an upgrade or downgrade is made. For more information about release handling, refer to <em>OTP Design Principles</em>.</p><p>A process is said to <em>use</em> a module <em>Mod</em>, if <em>Mod</em> is listed in the <em>Modules</em> part of the child specification used to start the process, see <em>supervisor(3erl)</em>. In the case of gen_event, an event manager process is said to use <em>Mod</em> if <em>Mod</em> is an installed event handler.</p><p><em>High-level instructions</em></p>
<pre>
{update, Mod}
{update, Mod, supervisor}
{update, Mod, Change}
{update, Mod, DepMods}
{update, Mod, Change, DepMods}
{update, Mod, Change, PrePurge, PostPurge, DepMods}
{update, Mod, Timeout, Change, PrePurge, PostPurge, DepMods}
{update, Mod, ModType, Timeout, Change, PrePurge, PostPurge, DepMods}
  Mod = atom()
  ModType = static | dynamic
  Timeout = int()&gt;0 | default | infinity
  Change = soft | {advanced,Extra}
    Extra = term()
  PrePurge = PostPurge = soft_purge | brutal_purge
  DepMods = [Mod]

</pre>
<p>Synchronized code replacement of processes using the module <em>Mod</em>. All those processes are suspended using <em>sys:suspend</em>, the new version of the module is loaded and then the processes are resumed using <em>sys:resume</em>.</p><p><em>Change</em> defaults to <em>soft</em> and defines the type of code change. If it is set to <em>{advanced,Extra}</em>, processes implemented using gen_server, gen_fsm or gen_event will transform their internal state by calling the callback function <em>code_change</em>. Special processes will call the callback function <em>system_code_change/4</em>. In both cases, the term <em>Extra</em> is passed as an argument to the callback function.</p><p><em>PrePurge</em> defaults to <em>brutal_purge</em> and controls what action to take with processes that are executing old code before loading the new version of the module. If the value is <em>brutal_purge</em>, the processes are killed. If the value is <em>soft_purge</em>, <em>release_handler:install_release/1</em> returns <em>{error,{old_processes,Mod}}</em>.</p><p><em>PostPurge</em> defaults to <em>brutal_purge</em> and controls what action to take with processes that are executing old code when the new version of the module has been loaded. If the value is <em>brutal_purge</em>, the code is purged when the release is made permanent and the processes are killed. If the value is <em>soft_purge</em>, the release handler will purge the old code when no remaining processes execute the code.</p><p><em>DepMods</em> defaults to [] and defines which other modules <em>Mod</em> is dependent on. In <em>relup</em>, instructions for suspending processes using <em>Mod</em> will come before instructions for suspending processes using modules in <em>DepMods</em> when upgrading, and vice versa when downgrading. In case of circular dependencies, the order of the instructions in the <em>appup</em> script is kept.</p><p><em>Timeout</em> defines the timeout when suspending processes. If no value or <em>default</em> is given, the default value for <em>sys:suspend</em> is used.</p><p><em>ModType</em> defaults to <em>dynamic</em> and specifies if the code is "dynamic", that is if a process using the module does spontaneously switch to new code, or if it is "static". When doing an advanced update and upgrading, the new version of a dynamic module is loaded before the process is asked to change code. When downgrading, the process is asked to change code before loading the new version. For static modules, the new version is loaded before the process is asked to change code, both in the case of upgrading and downgrading. Callback modules are dynamic.</p><p><em>update</em> with argument <em>supervisor</em> is used when changing the start specification of a supervisor.</p>
<pre>
{load_module, Mod}
{load_module, Mod, DepMods}
{load_module, Mod, PrePurge, PostPurge, DepMods}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge
  DepMods = [Mod]

</pre>
<p>Simple code replacement of the module <em>Mod</em>.</p><p>See <em>update</em> above for a description of <em>PrePurge</em> and <em>PostPurge</em>.</p><p><em>DepMods</em> defaults to [] and defines which other modules <em>Mod</em> is dependent on. In <em>relup</em>, instructions for loading these modules will come before the instruction for loading <em>Mod</em> when upgrading, and vice versa when downgrading.</p>
<pre>
{add_module, Mod}
  Mod = atom()

</pre>
<p>Loads a new module <em>Mod</em>.</p>
<pre>
{delete_module, Mod}
  Mod = atom()

</pre>
<p>Deletes a module <em>Mod</em> using the low-level instructions <em>remove</em> and <em>purge</em>.</p>
<pre>
{add_application, Application}
{add_application, Application, Type}
  Application = atom()
  Type = permanent | transient | temporary | load | none

</pre>
<p>Adding an application means that the modules defined by the <em>modules</em> key in the <em>.app</em> file are loaded using <em>add_module</em>.</p><p><em>Type</em> defaults to <em>permanent</em> and specifies the start type of the application. If <em>Type = permanent | transient | temporary</em>, the application will be loaded and started in the corresponding way, see <em>application(3erl)</em>. If <em>Type = load</em>, the application will only be loaded. If <em>Type = none</em>, the application will be neither loaded nor started, although the code for its modules will be loaded.</p>
<pre>
{remove_application, Application}
  Application = atom()

</pre>
<p>Removing an application means that the application is stopped, the modules are unloaded using <em>delete_module</em> and then the application specification is unloaded from the application controller.</p>
<pre>
{restart_application, Application}
  Application = atom()

</pre>
<p>Restarting an application means that the application is stopped and then started again similar to using the instructions <em>remove_application</em> and <em>add_application</em> in sequence.</p><p><em>Low-level instructions</em></p>
<pre>
{load_object_code, {App, Vsn, [Mod]}}
  App = Mod = atom()
  Vsn = string()

</pre>
<p>Reads each <em>Mod</em> from the directory <em>App-Vsn/ebin</em> as a binary. It does not load the modules. The instruction should be placed first in the script in order to read all new code from file to make the suspend-load-resume cycle less time consuming. After this instruction has been executed, the code server with the new version of <em>App</em>.</p>
<pre>
point_of_no_return

</pre>
<p>If a crash occurs after this instruction, the system cannot recover and is restarted from the old version of the release. The instruction must only occur once in a script. It should be placed after all <em>load_object_code</em> instructions.</p>
<pre>
{load, {Mod, PrePurge, PostPurge}}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge

</pre>
<p>Before this instruction occurs, <em>Mod</em> must have been loaded using <em>load_object_code</em>. This instruction loads the module. <em>PrePurge</em> is ignored. See the high-level instruction <em>update</em> for a description of <em>PostPurge</em>.</p>
<pre>
{remove, {Mod, PrePurge, PostPurge}}
  Mod = atom()
  PrePurge = PostPurge = soft_purge | brutal_purge

</pre>
<p>Makes the current version of <em>Mod</em> old. <em>PrePurge</em> is ignored. See the high-level instruction <em>update</em> for a description of <em>PostPurge</em>.</p>
<pre>
{purge, [Mod]}
  Mod = atom()

</pre>
<p>Purges each module <em>Mod</em>, that is removes the old code. Note that any process executing purged code is killed.</p>
<pre>
{suspend, [Mod | {Mod, Timeout}]}
  Mod = atom()
  Timeout = int()&gt;0 | default | infinity

</pre>
<p>Tries to suspend all processes using a module <em>Mod</em>. If a process does not respond, it is ignored. This may cause the process to die, either because it crashes when it spontaneously switches to new code, or as a result of a purge operation. If no <em>Timeout</em> is specified or <em>default</em> is given, the default value for <em>sys:suspend</em> is used.</p>
<pre>
{resume, [Mod]}
  Mod = atom()

</pre>
<p>Resumes all suspended processes using a module <em>Mod</em>.</p>
<pre>
{code_change, [{Mod, Extra}]}
{code_change, Mode, [{Mod, Extra}]}
  Mod = atom()
  Mode = up | down
  Extra = term()

</pre>
<p><em>Mode</em> defaults to <em>up</em> and specifies if it is an upgrade or downgrade.</p><p>This instruction sends a <em>code_change</em> system message to all processes using a module <em>Mod</em> by calling the function <em>sys:change_code</em>, passing the term <em>Extra</em> as argument.</p>
<pre>
{stop, [Mod]}
  Mod = atom()

</pre>
<p>Stops all processes using a module <em>Mod</em> by calling <em>supervisor:terminate_child/2</em>. The instruction is useful when the simplest way to change code is to stop and restart the processes which run the code.</p>
<pre>
{start, [Mod]}
  Mod = atom()

</pre>
<p>Starts all stopped processes using a module <em>Mod</em> by calling <em>supervisor:restart_child/2</em>.</p>
<pre>
{sync_nodes, Id, [Node]}
{sync_nodes, Id, {M, F, A}}
  Id = term()
  Node = node()
  M = F = atom()
  A = [term()]

</pre>
<p><em>apply(M, F, A)</em> must return a list of nodes.</p><p>The instruction synchronizes the release installation with other nodes. Each <em>Node</em> must evaluate this command, with the same <em>Id</em>. The local node waits for all other nodes to evaluate the instruction before execution continues. In case a node goes down, it is considered to be an unrecoverable error, and the local node is restarted from the old release. There is no timeout for this instruction, which means that it may hang forever.</p>
<pre>
{apply, {M, F, A}}
  M = F = atom()
  A = [term()]

</pre>
<p>Evaluates <em>apply(M, F, A)</em>. If the instruction appears before the <em>point_of_no_return</em> instruction, a failure is caught. <em>release_handler:install_release/1</em> then returns <em>{error,{'EXIT',Reason}}</em>, unless <em>{error,Error}</em> is thrown or returned. Then it returns <em>{error,Error}</em>.</p><p>If the instruction appears after the <em>point_of_no_return</em> instruction, and the function call fails, the system is restarted.</p>
<pre>
restart_new_emulator

</pre>
<p>This instruction is used when erts, kernel, stdlib or sasl is upgraded. It shuts down the current emulator and starts a new one. All processes are terminated gracefully, and the new version of erts, kernel, stdlib and sasl are used when the emulator restarts. Only one <em>restart_new_emulator</em> instruction is allowed in the relup, and it shall be placed first. <strong>systools:make_relup/3,4</strong> will ensure this when the relup is generated. The rest of the relup script is executed after the restart as a part of the boot script.</p><p>An info report will be written when the upgrade is completed. To programatically find out if the upgrade is complete, call <strong> release_handler:which_releases/0,1</strong> and check if the expected release has status <em>current</em>.</p><p>The new release must still be made permanent after the upgrade is completed. Otherwise, the old emulator is started in case of an emulator restart.</p><p><strong></strong> Warning:</p><p>As stated above, the <em>restart_new_emulator</em> instruction causes the emulator to be restarted with new versions of <em>erts</em>, <em>kernel</em>, <em>stdlib</em> and <em>sasl</em>. All other applications, however, will at startup be running their old versions in this new emulator. In most cases this is no problem, but every now and then there will be incompatible changes to the core applications which may cause trouble in this setting. Such incompatible changes (when functions are removed) are normally preceded by a deprecation over two major releases. To make sure your application is not crashed by an incompatible change, always remove any call to deprecated functions as soon as possible.</p>
<pre>
restart_emulator

</pre>
<p>This instruction is similar to <em>restart_new_emulator</em>, except it shall be placed at the end of the relup script. It is not related to an upgrade of the emulator or the core applications, but can be used by any application when a complete reboot of the system is reqiured. When generating the relup, <strong>systools:make_relup/3,4</strong> ensures that there is only one <em>restart_emulator</em> instruction and that it is the last instruction of the relup.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO appup&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/relup.5.html"><strong>relup</strong>(5)</a></strong>, <strong>release_handler(3erl)</strong>, supervisor(3erl), <strong>systools(3erl)</strong></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="appschema.5.html"><span aria-hidden="true">&larr;</span> appschema.5: Lam application schema format</a></li>
   <li class="next"><a href="apt-p2p.conf.5.html">apt-p2p.conf.5: Apt-p2p.conf  configuration file for apt-p2p.conf <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
