<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>filter_syntax: Input format for filtergen packet filter compiler</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Input format for filtergen packet filter compiler">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="filter_syntax (5) manual">
  <meta name="twitter:description" content="Input format for filtergen packet filter compiler">
  <meta name="twitter:image" content="https://www.carta.tech/images/filtergen-filter_syntax-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/filter_syntax.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="filter_syntax (5) manual" />
  <meta property="og:description" content="Input format for filtergen packet filter compiler" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/filtergen-filter_syntax-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">filter_syntax<small> (5)</small></h1>
        <p class="lead">Input format for filtergen packet filter compiler</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/filter_syntax.5.html">
      <span itemprop="name">filter_syntax: Input format for filtergen packet filter compiler</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/filtergen/">
      <span itemprop="name">filtergen</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/filter_syntax.5.html">
      <span itemprop="name">filter_syntax: Input format for filtergen packet filter compiler</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">INTRO</h2>
        <div class="sectioncontent">
<p>This file describes the input syntax accepted by <a href="../man8/filtergen.8.html"><strong>filtergen</strong>(8)</a>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">BASICS</h2>
        <div class="sectioncontent">
<p>In general form, a filter rule is described by a <em>direction</em>, an <em>interface</em>, a <em>target</em> and (possibly empty) sets of <em>matches</em> and <em>options</em>.</p><p>Simple rules will look like:</p><p><em>direction interface match0 .. matchN target;</em></p><p>for example:</p><p><em>input eth0 source host1 dest host2 proto tcp dport http accept;</em></p><p>Note that the elements of the rule can be placed in any order, with the exception that the <em>interface</em> must <em>immediately</em> follow the direction.  Thus, this rule is equivalent to the above (though perhaps less readable):</p><p><em>proto tcp source host1 dport http accept dest host2 input eth0;</em></p><p>The semicolon separates rules.  It is optional before a closing brace or the end of a file.  Whitespace is not significant.  Anything after a hash ("<em>#</em>") on a line is ignored.</p><h3>DIRECTION</h3>
<p>A direction merely specifies whether to match packets being sent or received.  The only two directions available are "input" and "output". Forwarded packets will pass through both,</p>
<h3>INTERFACE</h3>
<p>This specifies which real or virtual network device to filter.  As far as filtergen is concerned, this is just a text string.  It must be the same as the device name on the target system.  Common names on Linux are "eth0", "eth1", ..., "ppp0", etc.  Other systems will have different naming rules.</p>
<h3>TARGET</h3>
<p>A <em>target</em> notes what we do with a matching packet.  Universal options are <em>accept</em> and <em>drop</em> which, respectively, state that the packet should be allowed as normal, or thrown away.  Some backends support <em>reject</em> to throw away a packet, but send notification to the sender that it was denied, <em>masq</em> (on <em>output</em> rules only) to "masquerade" a packet - alter it so that it appears to come from the address of the sending interface - and <em>proxy</em> (and its deprecated alias <em>redirect</em>) to divert a connection via the local system.</p>
<h3>MATCHES</h3>
<p>The <em>matches</em> are the meat of the rule.  They apply a set of tests to a packet and decide if this rule will be used to process it.  Available matches are:</p><p><em>source addr-range</em> <em>dest addr-range</em></p><p><em>proto {tcp|udp|icmp|...}</em> <em>sport port-range</em> <em>dport port-range</em> <em>icmptype icmp-type</em></p><p>Matches can be negated by prefixing them with a "!":</p>
<pre>
	input eth0 ! dest 10.0.0.3 reject;
</pre>
<p>(note than not all backends can support this).</p>
<h3>OPTIONS</h3>
<p><em>Options</em> affect the behaviour of the matcher or the target. Currently implemented are <em>log</em>, which logs packets, <em>local</em>, which means only to check packets to or from this interface, <em>forward</em> which means the opposite of <em>local</em>, and <em>oneway</em> which causes the backend to omit rules which permit return packets.</p><p>The <em>log</em> option can optionally specify a message to log matching packets with, where the backend supports it:</p>
<pre>
	input eth0 source {
		10.0.0.0/8 192.168.0.0/16
	} log text "private addresses" drop;
</pre>
<p>Note that the <em>oneway</em> option make have no effect when used with the <strong>-l</strong> command-line flag on backends which support it.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">GROUPING</h2>
        <div class="sectioncontent">
<p>Because it can get tedious to type:</p>
<pre>
	input eth0 source foo dest bar proto tcp dport http accept;
	input eth0 source foo dest bar proto tcp dport https accept;
	input eth0 source foo dest bar proto tcp dport nntp accept;
	input eth0 source foo dest bar proto tcp sport 1:1023 dport ssh accept;
	...
</pre>
<p>filter allows you to group rules with a set syntax:</p>
<pre>
	input eth0 source foo dest bar proto tcp {
		dport http;
		dport https;
		dport nntp;
		sport 1:1023 dport ssh;
	} accept;
</pre>
<p>Matches which accept arguments can also be grouped:</p>
<pre>
	input eth0 source foo dest bar proto tcp {
		dport {http https nntp};
		sport 1:1023 dport ssh;
	} accept;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">OUT-OF-LINE GROUPS</h2>
        <div class="sectioncontent">
<p>It is commonly the case that both hosts and routers have long lists of similar looking rules to allow traffic between groups of hosts, as above.  What if we had another pair of hosts which needed a variety of services?  We could simply put the rule groups one after the other:</p>
<pre>
	input eth0 source foo dest bar proto tcp {
		dport {http https nntp};
		sport 1:1023 dport ssh;
	} accept;
	input eth0 source baz dest quux proto tcp {
		dport {1264 1521 1984 8008 8080 26000};
	} accept;
</pre>
<p>The above generates 11 rules, and every additional port adds another rule through which packets will pass (well, ones which don't match any of the above).  The first four output rules have the same source and destination hosts and protocol, and we know that if it doesn't match those on the first rule, it won't on the next three, either.  Out-of-line groups  use this fact to streamline things somewhat:</p>
<pre>
	input eth0 source foo dest bar [
		proto tcp {
			dport {http https nntp};
			sport 1:1023 dport ssh;
		} accept;
	];
	input eth0 source baz dest quux [
		proto tcp { dport {1264 1521 1984 8008 8080 26000}; } accept;
	];
</pre>
<p>Where the underlying system supports it, everything inside the square brackets is moved into a separate "chain" (in ipchains and iptables-speak) or "group" (in ipfilter-speak).  Thus, any packet not matching "source foo dest bar" or "source baz dest quux" above will be checked against only two rules, not eleven.</p><p>Note that matches which must appear together, like "proto tcp" and "sport 12345" need to be either both in the group, or both out of it.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLE</h2>
        <div class="sectioncontent">
<p>Here's a fairly complete example, for a single-interface machine:</p>
<pre>
	#
	# Example filter for (for example) a mail server
	#

	# Unfortunately, we don't have time to audit the
	# communications which go on locally
	{input lo; output lo} accept;

	# But we want to be a bit more careful when speaking
	# to the outside world
	input eth0 {
		# Sadly, we share a DMZ with Windows machines.
		# Don't log their netbios noise
		proto {tcp udp} source ournet/24 dport 137:139 drop;

		proto tcp {
			dport { smtp pop-3 } accept;
			dport ssh source ournet/24 accept;
			# We don't answer this, but don't want to
			# cause timeouts by blocking it
			dport auth reject;
			log drop;
		};
		# We don't run any UDP (or other non-TCP)
		# services
		log drop;
	};
	output eth0 {
		proto tcp {
			dport { smtp auth } accept;
			log drop;
		};
		# Outbound DNS is OK
		proto udp dport domain dest { ns0 ns1 } accept;
		log drop;
	};
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO filter_syntax&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/filtergen.8.html"><strong>filtergen</strong>(8)</a>, <a href="../man7/filter_backends.7.html"><strong>filter_backends</strong>(7)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="filesystems.5.html"><span aria-hidden="true">&larr;</span> filesystems.5: Linux filesystem types: minix, ext, ext2, ext3, ext4, reiserfs, xfs, jfs, xia, msdos, umsdos, vfat, ntfs, proc, nfs, iso9660, hpfs, sysv, smb, ncpfs</a></li>
   <li class="next"><a href="findlib.conf.5.html">findlib.conf.5: [configuration of findlib/ocamlfind] .sh "general" there are three possibilities to configure the findlib library:    build time: .re  before findlib is compiled, a "configure" script is invoked to figure   out the settings that are most likely to work on the system. most   settings are simply entered into text files and can easily be changed   after installation. the following properties cannot be changed later   because they are compiled into the resulting binaries:     \h'-3m'\z\h'3m' .ft r the default location of the configuration file findlib.conf. however,   you can set a different location by the environment variable   ocamlfind_conf .    \h'-3m'\z\h'3m' .ft r whether the installed o'caml version supports autolinking or not.     configuration file findlib.conf: .re  an initial version of this file is generated by the configure script,   but you are free to modify it later. most important, this file   contains the system-wide search path used to look up packages, and the   default location where to install new packages.    all files with the suffix ".conf" found in the directory   findlib.conf.d are also scanned for parameters.    environment variables: .re  the settings of findlib.conf can be overridden by environment variables.    last but not least, several settings can also be passed as  command-line options, or by invoking the function  findlib.init . <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
