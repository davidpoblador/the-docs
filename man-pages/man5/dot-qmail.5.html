<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dot-qmail: Control the delivery of mail messages</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Control the delivery of mail messages">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dot-qmail (5) manual">
  <meta name="twitter:description" content="Control the delivery of mail messages">
  <meta name="twitter:image" content="https://www.carta.tech/images/qmail-dot-qmail-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/dot-qmail.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dot-qmail (5) manual" />
  <meta property="og:description" content="Control the delivery of mail messages" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/qmail-dot-qmail-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dot-qmail<small> (5)</small></h1>
        <p class="lead">Control the delivery of mail messages</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/dot-qmail.5.html">
      <span itemprop="name">dot-qmail: Control the delivery of mail messages</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/qmail/">
      <span itemprop="name">qmail</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/dot-qmail.5.html">
      <span itemprop="name">dot-qmail: Control the delivery of mail messages</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Normally the <strong>qmail-local</strong> program delivers each incoming message to your system mailbox, <em>homedir</em><strong>/Mailbox</strong>, where <em>homedir</em> is your home directory.</p><p>It can instead write the mail to a different file or directory, forward it to another address, distribute it to a mailing list, or even execute programs, all under your control.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">THE QMAIL FILE</h2>
        <div class="sectioncontent">
<p>To change <strong>qmail-local</strong>'s behavior, set up a <strong>.qmail</strong> file in your home directory.</p><p><strong>.qmail</strong> contains one or more lines. Each line is a delivery instruction. <strong>qmail-local</strong> follows each instruction in turn. There are five types of delivery instructions: (1) comment; (2) program; (3) forward; (4) mbox; (5) maildir.</p>
<dl class='dl-vertical'>
  <dt>
    <p>(1)</p>
  </dt>
  <dd>
    <p>A comment line begins with a number sign:</p>
<pre>
     # this is a comment
</pre>
<p><strong>qmail-local</strong> ignores the line.</p>
  </dd>
  <dt>
    <p>(2)</p>
  </dt>
  <dd>
    <p>A program line begins with a vertical bar:</p>
<pre>
     |preline /usr/ucb/vacation djb
</pre>
<p><strong>qmail-local</strong> takes the rest of the line as a command to supply to <strong>sh</strong>. See <a href="../man8/qmail-command.8.html"><strong>qmail-command</strong>(8)</a></strong> for further information.</p>
  </dd>
  <dt>
    <p>(3)</p>
  </dt>
  <dd>
    <p>A forward line begins with an ampersand:</p>
<pre>
     &me@new.job.com
</pre>
<p><strong>qmail-local</strong> takes the rest of the line as a mail address; it uses <strong>qmail-queue</strong> to forward the message to that address. The address must contain a fully qualified domain name; it must not contain extra spaces, angle brackets, or comments:</p>
<pre>
     # the following examples are WRONG

     &me@new

     &&lt;me@new.job.com&gt;

     & me@new.job.com

     &me@new.job.com (New Address)
</pre>
<p>If the address begins with a letter or number, you may leave out the ampersand:</p>
<pre>
     me@new.job.com
</pre>
<p>Note that <strong>qmail-local</strong> omits its new <strong>Return-Path</strong> line when forwarding messages.</p>
  </dd>
  <dt>
    <p>(4)</p>
  </dt>
  <dd>
    <p>An <em>mbox</em> line begins with a slash or dot, and does not end with a slash:</p>
<pre>
     /home/djb/Mailbox.sos
</pre>
<p><strong>qmail-local</strong> takes the entire line as a filename. It appends the mail message to that file, using <strong>flock</strong>-style file locking if possible. <strong>qmail-local</strong> stores the mail message in <em>mbox</em> format, as described in <a href="../man5/mbox.5.html"><strong>mbox</strong>(5)</a></strong>.</p><p><strong>WARNING:</strong> On many systems, anyone who can read a file can <strong>flock</strong> it, and thus hold up <strong>qmail-local</strong>'s delivery forever. Do not deliver mail to a publicly accessible file!</p><p>If <strong>qmail-local</strong> is able to lock the file, but has trouble writing to it (because, for example, the disk is full), it will truncate the file back to its original length. However, it cannot prevent mailbox corruption if the system crashes during delivery.</p>
  </dd>
  <dt>
    <p>(5)</p>
  </dt>
  <dd>
    <p>A <em>maildir</em> line begins with a slash or dot, and ends with a slash:</p>
<pre>
     /home/djb/Maildir/
</pre>
<p><strong>qmail-local</strong> takes the entire line as the name of a directory in <em>maildir</em> format. It reliably stores the incoming message in that directory. See <a href="../man5/maildir.5.html"><strong>maildir</strong>(5)</a></strong> for more details.</p>
  </dd>

</dl>
<p>If <strong>.qmail</strong> has the execute bit set, it must not contain any program lines, <em>mbox</em> lines, or <em>maildir</em> lines. If <strong>qmail-local</strong> sees any such lines, it will stop and indicate a temporary failure.</p><p>If <strong>.qmail</strong> is completely empty (0 bytes long), or does not exist, <strong>qmail-local</strong> follows the <em>defaultdelivery</em> instructions set by your system administrator; normally <em>defaultdelivery</em> is <strong>./Mailbox</strong>, so <strong>qmail-local</strong> appends the mail message to <strong>Mailbox</strong> in <em>mbox</em> format.</p><p><strong>.qmail</strong> may contain extra spaces and tabs at the end of a line. Blank lines are allowed, but not for the first line of <strong>.qmail</strong>.</p><p>If <strong>.qmail</strong> is world-writable, <strong>qmail-local</strong> stops and indicates a temporary failure.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">SAFE QMAIL EDITING</h2>
        <div class="sectioncontent">
<p>Incoming messages can arrive at any moment. If you want to safely edit your <strong>.qmail</strong> file, first set the sticky bit on your home directory:</p>
<pre>
     chmod +t $HOME
</pre>
<p><strong>qmail-local</strong> will temporarily defer delivery of any message to you if your home directory is sticky (or group-writable or other-writable, which should never happen). Make sure to</p>
<pre>
     chmod -t $HOME
</pre>
<p>when you are done! It's a good idea to test your new <strong>.qmail</strong> file as follows:</p>
<pre>
     qmail-local -n $USER ~ $USER '' '' '' '' ./Mailbox
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXTENSION ADDRESSES</h2>
        <div class="sectioncontent">
<p>In the <strong>qmail</strong> system, you control all local addresses of the form <em>user</em><strong>-</strong><em>anything</em>, as well as the address <em>user</em> itself, where <em>user</em> is your account name. Delivery to <em>user</em><strong>-</strong><em>anything</em> is controlled by the file <em>homedir/</em><strong>.qmail-</strong><em>anything</em>. (These rules may be changed by the system administrator; see <a href="../man5/qmail-users.5.html"><strong>qmail-users</strong>(5)</a>.)</p><p>The <strong>alias</strong> user controls all other addresses. Delivery to <em>local</em> is controlled by the file <em>homedir/</em><strong>.qmail-</strong><em>local</em>, where <em>homedir</em> is <strong>alias</strong>'s home directory.</p><p>In the following description, <strong>qmail-local</strong> is handling a message addressed to <em>local@domain</em>, where <em>local</em> is controlled by <strong>.qmail-</strong><em>ext</em>. Here is what it does.</p><p>If <strong>.qmail-</strong><em>ext</em> is completely empty, <strong>qmail-local</strong> follows the <em>defaultdelivery</em> instructions set by your system administrator.</p><p>If <strong>.qmail-</strong><em>ext</em> doesn't exist, <strong>qmail-local</strong> will try some default <strong>.qmail</strong> files. For example, if <em>ext</em> is <strong>foo-bar</strong>, <strong>qmail-local</strong> will try first <strong>.qmail-foo-bar</strong>, then <strong>.qmail-foo-default</strong>, and finally <strong>.qmail-default</strong>. If none of these exist, <strong>qmail-local</strong> will bounce the message. (Exception: for the basic <em>user</em> address, <strong>qmail-local</strong> treats a nonexistent <strong>.qmail</strong> the same as an empty <strong>.qmail</strong>.)</p><p><strong>WARNING:</strong> For security, <strong>qmail-local</strong> replaces any dots in <em>ext</em> with colons before checking <strong>.qmail-</strong><em>ext</em>. For convenience, <strong>qmail-local</strong> converts any uppercase letters in <em>ext</em> to lowercase.</p><p>When <strong>qmail-local</strong> forwards a message as instructed in <strong>.qmail-</strong><em>ext</em> (or <strong>.qmail-default</strong>), it checks whether <strong>.qmail-</strong><em>ext</em><strong>-owner</strong><em></em> exists. If so, it uses <em>local</em><strong>-owner@</strong><em>domain</em> as the envelope sender for the forwarded message. Otherwise it retains the envelope sender of the original message. Exception: <strong>qmail-local</strong> always retains the original envelope sender if it is the empty address or <strong>#@[]</strong>, i.e., if this is a bounce message.</p><p><strong>qmail-local</strong> also supports <strong>variable envelope return paths</strong> (VERPs): if <strong>.qmail-</strong><em>ext</em><strong>-owner</strong><em></em> and <strong>.qmail-</strong><em>ext</em><strong>-owner-default</strong><em></em> both exist, it uses <em>local</em><strong>-owner-@</strong><em>domain</em><strong>-@[]</strong> as the envelope sender. This will cause a recipient <em>recip</em><strong>@</strong><em>reciphost</em> to see an envelope sender of <em>local</em><strong>-owner-</strong><em>recip</em><strong>=</strong><em>reciphost</em><strong>@</strong><em>domain</em>.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">ERROR HANDLING</h2>
        <div class="sectioncontent">
<p>If a delivery instruction fails, <strong>qmail-local</strong> stops immediately and reports failure. <strong>qmail-local</strong> handles forwarding after all other instructions, so any error in another type of delivery will prevent all forwarding.</p><p>If a program returns exit code 99, <strong>qmail-local</strong> ignores all succeeding lines in <strong>.qmail</strong>, but it still pays attention to previous forward lines.</p><p>To set up independent instructions, where a temporary or permanent failure in one instruction does not affect the others, move each instruction into a separate <strong>.qmail-</strong><em>ext</em> file, and set up a central <strong>.qmail</strong> file that forwards to all of the <strong>.qmail-</strong><em>ext</em>s. Note that <strong>qmail-local</strong> can handle any number of forward lines simultaneously.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dot-qmail&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/envelopes.5.html"><strong>envelopes</strong>(5)</a>, <a href="../man5/maildir.5.html"><strong>maildir</strong>(5)</a>, <a href="../man5/mbox.5.html"><strong>mbox</strong>(5)</a>, <a href="../man5/qmail-users.5.html"><strong>qmail-users</strong>(5)</a>, <a href="../man8/qmail-local.8.html"><strong>qmail-local</strong>(8)</a>, <a href="../man8/qmail-command.8.html"><strong>qmail-command</strong>(8)</a>, <a href="../man8/qmail-queue.8.html"><strong>qmail-queue</strong>(8)</a>, <a href="../man8/qmail-lspawn.8.html"><strong>qmail-lspawn</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="dot-obdgpslogger.5.html"><span aria-hidden="true">&larr;</span> dot-obdgpslogger.5: Configuration file for obdgpslogger</a></li>
   <li class="next"><a href="dot-spop3d.5.html">dot-spop3d.5: User configuration data for the solid pop3 server. <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
