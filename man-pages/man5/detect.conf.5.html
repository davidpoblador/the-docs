<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>detect.conf: Detect.conf  provides the configuration for detection of locations for whereami.</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Detect.conf  provides the configuration for detection of locations for whereami.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="detect.conf (5) manual">
  <meta name="twitter:description" content="Detect.conf  provides the configuration for detection of locations for whereami.">
  <meta name="twitter:image" content="https://www.carta.tech/images/whereami-detect.conf-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/detect.conf.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="detect.conf (5) manual" />
  <meta property="og:description" content="Detect.conf  provides the configuration for detection of locations for whereami." />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/whereami-detect.conf-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">detect.conf<small> (5)</small></h1>
        <p class="lead">Detect.conf  provides the configuration for detection of locations for whereami.</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/detect.conf.5.html">
      <span itemprop="name">detect.conf: Detect.conf  provides the configuration for detection of locations for whereami.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/whereami/">
      <span itemprop="name">whereami</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/detect.conf.5.html">
      <span itemprop="name">detect.conf: Detect.conf  provides the configuration for detection of locations for whereami.</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<h3>Syntax</h3>
<p>The <strong>detect.conf</strong> file specifies the tests that allow <strong>whereami</strong> to figure out where it is. The environment of such tests can be manipulated using the 'set' command. Tests can be performed conditionally upon the results of other tests using "if ... fi" constructs.</p><p>Comments are lines starting with the `#' character.  Leading whitespace is ignored on all lines, including comment lines.</p>
<h3>Internal Commands</h3>
<p>The syntax of this file is fairly straightforward.  Tests are specified thus:</p>
<dl class='dl-vertical'>
  <dt>
    <strong>testname </strong><em>parameter</em> <em>locations</em><em></em>
  </dt>
  <dd>
    <p>The command <strong>testname</strong> is run with the single <em>parameter</em> (which may be split internally). If the return value is 0, the test is considered `successful' and the <em>locations</em> are considered `discovered'.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p><em>locations</em> is a list of comma separated identifiers, each one matching the regexp ``<em>[[:alnum:]._-]+</em>''.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>On success, processing will skip all non-`always' statements up to the next `if' or `fi' keyword, whichever is earlier.</p>
  </dd>
  <dt>
    <strong>if </strong><em>location</em> <em>statements ...</em> [elif <em>location</em> <em>statements ...</em>]... [else <em>statements ...</em>] fi<em></em>
  </dt>
  <dd>
    <p>If the <em>location</em> is in the list of locations discovered so far, then the statements in the `if' branch will be processed.  Otherwise, if present, the statements in either the `elif' or the `else' (as appropriate) branch will be processed.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>Note that nesting of `if' blocks is not supported at this time.</p>
  </dd>
  <dt>
    <strong>always testname </strong><em>parameter</em> <em>locations</em><em></em>
  </dt>
  <dd>
    <p>A test preceded by the word `always' is not skipped unless it is within the inactive branch of an `if' clause.</p>
  </dd>
  <dt>
    <strong>set </strong><em>variable</em> <em>value</em><em></em>
  </dt>
  <dd>
    <p>The environment <em>variable</em> is defined as <em>value</em> for all subsequent test scripts and in the shell script eventually constructed by <strong>whereami</strong>.</p>
  </dd>
  <dt>
    <strong>at </strong><em>locations</em><em></em>
  </dt>
  <dd>
    <p>The <em>locations</em> will be added to the "discovered" list.</p>
  </dd>
  <dt>
    <strong>notat </strong><em>locations</em><em></em>
  </dt>
  <dd>
    <p>The <em>locations</em> will be removed from the "discovered" list.</p>
  </dd>
  <dt>
    <strong>echo </strong><em>quoted text string</em><em></em>
  </dt>
  <dd>
    <p>The <em>"quoted text string"</em> will be displayed to the user on stdout.</p>
  </dd>

</dl>
<p>The <em>parameter</em> and <em>locations</em>     may be lists, with a comma (",") used to separate multiple values.</p>
<h3>Tests</h3>
<p>Any program may be used as a test so long as it accepts a single parameter and returns zero on success and non-zero on failure.</p><p>If a parameter of the test script must contain a space, it parameter will need to be quoted.</p><p>A number of tests are included in the whereami package.</p>
<dl class='dl-vertical'>
  <dt>
    testdhcp <em>[interface,]pattern</em>
  </dt>
  <dd>
    <p>Tests for the assignment by DHCP of an IP address matching the specified address <em>pattern</em>. If not specified, the <em>interface</em> defaults to `eth0'.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>Note that the first execution of this test during a particular run of <strong>whereami</strong> induces a DHCP request on the specified interface.</p>
  </dd>
  <dt>
    testmii <em>interface</em>
  </dt>
  <dd>
    <p>Checks for the presence of a link on <em>interface</em> using the <strong>mii-tool</strong> utility. If a link is not found then the interface will be 'down'ed to limit side-effects on other detection later.</p>
  </dd>
  <dt>
    testpppoe <em>interface</em>
  </dt>
  <dd>
    <p>Tries to start a PPPoE connection on the specified interface.  Success is returned if the connection starts.</p>
  </dd>
  <dt>
    testarp <em>interface</em>,<em>mac_address</em>,<em>ip_address</em>
  </dt>
  <dd>
    <p>Performs an <strong>arping</strong> (Debian package: iputils-arping) to look for the specified <em>mac_address</em> and <em>ip_address</em> combination on the network connected to <em>interface</em>.</p>
  </dd>
  <dt>
    testping [<em>interface</em>,]<em>ip_to_ping</em>,<em>ip_to_use</em>
  </dt>
  <dd>
    <p>Uses the <strong>fping</strong> program to perform a fast ping to look for the presence of a particular host on the local network.</p>
  </dd>
  <dt>
    testpci <em>pattern</em>
  </dt>
  <dd>
    <p>Searches for the <em>pattern</em> in the output of <strong>lspci -v</strong>.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This enables checking for specific hardware, such as a particular type of docking station.</p>
  </dd>
  <dt>
    testmodule <em>pattern</em>
  </dt>
  <dd>
    <p>Searches for the <em>pattern</em> in the output of <strong>lsmod</strong>.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This is useful for checking for the presence of a particular PCMCIA card, or possibly a particular kernel configuration.</p>
  </dd>
  <dt>
    testap [<em>interface</em>,]scan
  </dt>
  <dd>
    
  </dd>
  <dt>
    testap <em>pattern</em>[,<em>WEP Key</em>]
  </dt>
  <dd>
    
  </dd>
  <dt>
    testap [<em>interface</em>,]<em>pattern</em>,<em>WEP Key</em>
  </dt>
  <dd>
    <p>The <em>pattern</em> is a regexp (egrep regexp) used to match AP essids: when this regexp matches a detected essid the test is considered succesfull.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This check does not require encryption to be set up to work, although it may not find stealthier equipment - use testssid in that case.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>The 'scan' option will cause a new scan, and the first call should have this option set.  Subsequent calls will use the results of that first scan, reducing the overhead for those busy people who connect to many WLANs!</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>If a WEP key is supplied, and a pattern match is found, the key will be assigned to that interface so that subsequent tests should work correctly.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>When using the <em>WEP key</em> you may in some cases desire to pass additional parameters to iwconfig. These parameters may be passed preceding the WEP key and separated with an underscore. For example "restricted_0123-4567-89" will force the card to be configured to insist on 'restricted' mode at the same time as the key was set.</p>
  </dd>
  <dt>
    testappassive [<em>interface</em>,]scan
  </dt>
  <dd>
    
  </dd>
  <dt>
    testappassive <em>pattern</em>
  </dt>
  <dd>
    
  </dd>
  <dt>
    testap [<em>interface</em>,]<em>pattern</em>
  </dt>
  <dd>
    <p>Checks whether the specified AP is present, passively.  This check does not alter the essid on the interface, or set the WEP key like the testap test.  It just uses iwlist <em>interface</em> scan.  This is useful where you have another external script that sets up all the wifi settings, and running whereami a second time destroys the running wifi connection, as can happen on boot where networking is intialised before whereami starting in run level 2.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>The 'scan' option will cause a new scan, and the first call should have this option set.  Subsequent calls will use the results of that first scan, reducing the overhead for those busy people who connect to many WLANs!</p>
  </dd>
  <dt>
    testprocsys <em>proc-or-sys-path</em>,<em>egrep-pattern</em>
  </dt>
  <dd>
    <p>Checks the specified /sys or /proc file to see if it contains the given egrep expression.  Non-existent file results in failure, as well as a failed match.  Useful for those interfaces that require to hotplug to be configured so that firmware can be loaded.  On machine shutdown, hotplug can be disabled before networking interfaces, and this enables whereami to function correctly in those circumstances.</p>
  </dd>
  <dt>
    testssid <em>ssid</em>[,<em>key</em>]
  </dt>
  <dd>
    <p>Checks whether the wireless interface is in range of the specified <em>ssid</em>, using the key if supplied.  The key should be formatted as for iwconfig.  What works for me looks like da18babe100ea4beadb74324bc ("128" bits) or fe3d1b3ed7 (40 bits).</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This script will also respond to a TIMEOUT variable which is set before it is called, but waiting for $TIMEOUT seconds for the network to settle (default 2).</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This is useful for checking which wireless LAN is in range.</p>
  </dd>
  <dt>
    testreceived [<em>interface</em>]
  </dt>
  <dd>
    <p>Checks whether the <em>interface</em> in question has received any bytes.</p>
  </dd>
  <dt>
    
  </dt>
  <dd>
    <p>This is useful for checking which network interface is actually connected to a network.</p>
  </dd>

</dl>


        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>The following examples show simple setups, firstly for a wired only configuration, and secondly for a mixed wireless and wired setup.</p><p><strong>A Simple Wired DHCP Configuration</strong></p>
<pre>
# Simple wired DHCP with two networks
default undocked
testmii eth0 lan
if lan
set INTERFACE eth0
testdhcp    restart    dhcp
fi
if dhcp
testdhcp    '192.168.1.1'    home
testdhcp    '152.81.*.*'    univ
fi

</pre>
<p><strong>A Wired and Wireless Configuration</strong></p>
<pre>
# Configuration including both wired and wireless networks
default undocked
testmii eth0 lan

# We prefer a wired network, but if we aren't wired
# we will look for a WLAN.
if lan
set INTERFACE eth0
testdhcp    restart    dhcp
else
set INTERFACE wlan0
testap scan wlan
fi

# Try WLANs until it we find one that works
if wlan
testap  homessid,dead-beef-dead-beef-dead-beef-be wlhome_enc
testap  homessid wlhome_open
fi

# If we are at a WLAN we should have the AP setup now
if wlan
# WLAN almost always will be DHCP
testdhcp    restart    dhcp
fi

# Now identify the actual network
if dhcp
testdhcp    '192.168.1.1'    home
testdhcp    '192.168.1.2'    wlhomeip
testdhcp    '152.81.*.*'    work
fi

</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO detect.conf&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man8/whereami.8.html"><strong>whereami</strong>(8)</a>, <a href="../man5/whereami.conf.5.html"><strong>whereami.conf</strong>(5)</a></p><p>Further documentation is available in the /usr/share/doc/whereami directory.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">FILES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
    <strong>/etc/whereami/detect.conf</strong>
  </dt>
  <dd>
    <p>The file we are talking about in this here manpage.</p>
  </dd>
  <dt>
    <strong>/etc/whereami/whereami.conf</strong>
  </dt>
  <dd>
    <p>Defines the actions performed as a result of entering, leaving, or remaining at a particular location.</p>
  </dd>

</dl>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">LIMITATIONS</h2>
        <div class="sectioncontent">
<p>The `if' syntax does not support nesting.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>This manual page was written by Andrew McMillan &lt;awm@debian.org&gt; for the <strong>Debian GNU/Linux</strong> system (but may be used by others).  Permission is granted to copy, distribute and/or modify this document under the terms of the GPL version 2.</p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="depmod.d.5.html"><span aria-hidden="true">&larr;</span> depmod.d.5: Configuration directory for depmod</a></li>
   <li class="next"><a href="devscripts.conf.5.html">devscripts.conf.5: Configuration file for the devscripts package <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
