<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>maildir.courier: E-mail directory</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="E-mail directory">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="maildir.courier (5) manual">
  <meta name="twitter:description" content="E-mail directory">
  <meta name="twitter:image" content="https://www.carta.tech/images/courier-base-maildir.courier-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/maildir.courier.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="maildir.courier (5) manual" />
  <meta property="og:description" content="E-mail directory" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/courier-base-maildir.courier-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">maildir.courier<small> (5)</small></h1>
        <p class="lead">E-mail directory</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/maildir.courier.5.html">
      <span itemprop="name">maildir.courier: E-mail directory</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/courier-base/">
      <span itemprop="name">courier-base</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/maildir.courier.5.html">
      <span itemprop="name">maildir.courier: E-mail directory</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">SYNOPSIS</h2>
        <div class="sectioncontent">
<p>$HOME/Maildir</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>A &ldquo;Maildir&rdquo; is a structured directory that holds E-mail messages. Maildirs were first implemented by the Qmail mail server. Qmail&apos;s maildirs were a simple data structure, nothing more than a single collection of E-mail messages. The Courier mail server builds upon Qmail&apos;s maildirs to provide extended functionality, such as folders and quotas. This document describes the Courier mail server&apos;s extended maildirs, without explicitly identifying The Courier mail server-specific extensions. See <a href="../man5/maildir.5.html"><strong>maildir</strong>(5)</a> in Qmail&apos;s documentation for the original definition of maildirs.</p><p>Traditionally, E-mail folders were saved as plain text files, called &ldquo;mboxes&rdquo;. Mboxes have known limitations. Only one application can use an mbox at the same time. Locking is required in order to allow simultaneous concurrent access by different applications. Locking is often problematic, and not very reliable in network-based filesystem requirements. Some network-based filesystems don&apos;t offer any reliable locking mechanism at all. Furthermore, even bulletproof locking won&apos;t prevent occasional mbox corruption. A process can be killed or terminated in the middle of updating an mbox. This will likely result in corruption, and a loss of most messages in the mbox.</p><p>Maildirs allow multiple concurrent access by different applications. Maildirs do not require locking. Multiple applications can update a maildir at the same time, without stepping on each other&apos;s feet.</p><h3>Maildir contents</h3>
<p>A &ldquo;maildir&rdquo; is a directory that&apos;s created by \m[blue]<strong></strong><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a>\m[]\s-2\u[1]\d\s+2. Naturally, maildirs should not have any group or world permissions, unless you want other people to read your mail. A maildir contains three subdirectories: tmp, new, and cur. These three subdirectories comprise the primary folder, where new mail is delivered by the system.</p><p>Folders are additional subdirectories in the maildir whose names begin with a period: such as .Drafts or .Sent. Each folder itself contains the same three subdirectories, tmp, new, and cur, and an additional zero-length file named maildirfolder, whose purpose is to inform any mail delivery agent that it&apos;s really delivering to a folder, and that the mail delivery agent should look in the parent directory for any maildir-related information.</p><p>Folders are not physically nested. A folder subdirectory, such as .Sent does not itself contain any subfolders. The main maildir contains a single, flat list of subfolders. These folders are logically nested, and periods serve to separate folder hierarchies. For example, .Sent.2002 is considered to be a subfolder called &ldquo;2002&rdquo; which is a subfolder of &ldquo;Sent&rdquo;.</p><p><strong>Folder name encoding</strong></p><p>Folder names can contain any Unicode character, except for control characters. US-ASCII characters, U+0x0020 - U+0x007F, except for the period, forward-slash, and ampersand characters (U+0x002E, U+0x002F, and U+0x0026) represent themselves. The ampersand is represent by the two character sequence &ldquo;&-&rdquo;. The period, forward slash, and non US-ASCII Unicode characters are represented using the UTF-7 character set, and encoded with a modified form of base64-encoding.</p><p>The &ldquo;&&rdquo; character starts the modified base64-encoded sequence; the sequence is terminated by the &ldquo;-&rdquo; character. The sequence of 16-bit Unicode characters is written in big-endian order, and encoded using the base64-encoding method described in section 5.2 of \m[blue]<strong>RFC 1521</strong>\m[]\s-2\u[2]\d\s+2, with the following modifications:</p><p>The &ldquo;=&rdquo; padding character is omitted. When decoding, an incomplete 16-bit character is discarded.</p><p>The comma character, &ldquo;,&rdquo; is used in place of the &ldquo;/&rdquo; character in the base64 alphabet.</p><p>For example, the word &ldquo;Resume&rdquo; with both "e"s being the e-acute character, U+0x00e9, is encoded as &ldquo;R&AOk-sum&AOk-&rdquo; (so a folder of that name would be a maildir subdirectory called &ldquo;.R&AOk-sum&AOk-&rdquo;).</p><p><strong>Other maildir contents</strong></p><p>Software that uses maildirs may also create additional files besides the tmp, new, and cur subdirectories -- in the main maildir or a subfolder -- for its own purposes.</p>
<h3>Messages</h3>
<p>E-mail messages are stored in separate, individual files, one E-mail message per file. The tmp subdirectory temporarily stores E-mail messages that are in the process of being delivered to this maildir. tmp may also store other kinds of temporary files, as long as they are created in the same way that message files are created in tmp. The new subdirectory stores messages that have been delivered to this maildir, but have not yet been seen by any mail application. The cur subdirectory stores messages that have already been seen by mail applications.</p>
<h3>Adding new mail to maildirs</h3>
<p>The following process delivers a new message to the maildir:</p><p>A new unique filename is created using one of two possible forms: &ldquo;time.MusecPpid.host&rdquo;, or &ldquo;time.MusecPpid_unique.host&rdquo;. &ldquo;time&rdquo; and &ldquo;usec&rdquo; is the current system time, obtained from <a href="../man2/gettimeofday.2.html"><strong>gettimeofday</strong>(2)</a>. &ldquo;pid&rdquo; is the process number of the process that is delivering this message to the maildir. &ldquo;host&rdquo; is the name of the machine where the mail is being delivered. In the event that the same process creates multiple messages, a suffix unique to each message is appended to the process id; preferrably an underscore, followed by an increasing counter. This applies whether messages created by a process are all added to the same, or different, maildirs. This protocol allows multiple processes running on multiple machines on the same network to simultaneously create new messages without stomping on each other.</p><p>The filename created in the previous step is checked for existence by executing the <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> system call. If <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> results in ANYTHING OTHER than the system error ENOENT, the process must sleep for two seconds, then go back and create another unique filename. This is an extra step to insure that each new message has a completely unique filename.</p><p>Other applications that wish to use tmp for temporary storage should observe the same protocol (but see READING MAIL FROM MAILDIRS below, because old files in tmp will be eventually deleted).</p><p>If the <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> system call returned ENOENT, the process may proceed to create the file in the tmp subdirectory, and save the entire message in the new file. The message saved MUST NOT have the &ldquo;From_&rdquo; header that is used to mboxes. The message also MUST NOT have any &ldquo;From_&rdquo; lines in the contents of the message prefixed by the &ldquo;&gt;&rdquo; character.</p><p>When saving the message, the number of bytes returned by the <a href="../man2/write.2.html"><strong>write</strong>(2)</a> system call must be checked, in order to make sure that the complete message has been written out.</p><p>After the message is saved, the file descriptor is <a href="../man2/fstat.2.html"><strong>fstat</strong>(2)</a>-ed. The file&apos;s device number, inode number, and the its byte size, are saved. The file is closed and is then immediately moved/renamed into the new subdirectory. The name of the file in new should be &ldquo;time.MusecPpidVdevIino.host,S=<em>cnt</em>&rdquo;, or &ldquo;time.MusecPpidVdevIino_unique.host,S=<em>cnt</em>&rdquo;. &ldquo;dev&rdquo; is the message&apos;s device number, &ldquo;ino&rdquo; is the message&apos;s inode number (from the previous <a href="../man2/fstat.2.html"><strong>fstat</strong>(2)</a> call); and &ldquo;cnt&rdquo; is the message&apos;s size, in bytes.</p><p>The &ldquo;,S=<em>cnt</em>&rdquo; part optimizes the \m[blue]<strong>Courier</strong>\m[]\s-2\u[3]\d\s+2 mail server&apos;s maildir quota enhancement; it allows the size of all the mail stored in the maildir to be added up without issuing the <a href="../man2/stat.2.html"><strong>stat</strong>(2)</a> system call for each individual message (this can be quite a performance drain with certain network filesystems).</p>
<h3>READING MAIL FROM MAILDIRS</h3>
<p>Applications that read mail from maildirs should do it in the following order:</p><p>When opening a maildir or a maildir folder, read the tmp subdirectory and delete any files in there that are at least 36 hours old.</p><p>Look for new messages in the new subdirectory. Rename <em>new/filename</em>, as <em>cur/filename:2,info</em>. Here, <em>info</em> represents the state of the message, and it consists of zero or more boolean flags chosen from the following: &ldquo;D&rdquo; - this is a &apos;draft&apos; message, &ldquo;R&rdquo; - this message has been replied to, &ldquo;S&rdquo; - this message has been viewed (seen), &ldquo;T&rdquo; - this message has been marked to be deleted (trashed), but is not yet removed (messages are removed from maildirs simply by deleting their file), &ldquo;F&rdquo; - this message has been marked by the user, for some purpose. These flags must be stored in alphabetical order. New messages contain only the :2, suffix, with no flags, indicating that the messages were not seen, replied, marked, or deleted.</p><p>Maildirs may have maximum size quotas defined, but these quotas are purely voluntary. If you need to implement mandatory quotas, you should use any quota facilities provided by the underlying filesystem that is used to store the maildirs. The maildir quota enhancement is designed to be used in certain situations where filesystem-based quotas cannot be used for some reason. The implementation is designed to avoid the use of any locking. As such, at certain times the calculated quota may be imprecise, and certain anomalous situations may result in the maildir actually going over the stated quota. One such situation would be when applications create messages without updating the quota estimate for the maildir. Eventually it will be precisely recalculated, but wherever possible new messages should be created in compliance with the voluntary quota protocol.</p><p>The voluntary quota protocol involves some additional procedures that must be followed when creating or deleting messages within a given maildir or its subfolders. The \m[blue]<strong></strong><strong>deliverquota</strong>(8)\m[]\s-2\u[4]\d\s+2 command is a tiny application that delivers a single message to a maildir using the voluntary quota protocol, and hopefully it can be used as a measure of last resort. Alternatively, applications can use the libmaildir.a library to handle all the low-level dirty details for them. The voluntary quota enhancement is described in the \m[blue]<strong></strong><strong>maildirquota</strong>(7)\m[]\s-2\u[5]\d\s+2 man page.</p>
<h3>Maildir Quotas</h3>
<p>This is a voluntary mechanism for enforcing "loose" quotas on the maximum sizes of maildirs. This mechanism is enforced in software, and not by the operating system. Therefore it is only effective as long as the maildirs themselves are not directly accessible by their users, since this mechanism is trivially disabled.</p><p>If possible, operating system-enforced quotas are preferrable. Where operating system quota enforcement is not available, or not possible, this voluntary quota enforcement mechanism might be an acceptable compromise. Since it&apos;s enforced in software, all software that modifies or accesses the maildirs is required to voluntary obey and enforce a quota. The voluntary quota implementation is flexible enough to allow non quota-aware applications to also access the maildirs, without any drastic consequences. There will be some non-drastic consequences, though. Of course, non quota-aware applications will not enforce any defined quotas. Furthermore, this voluntary maildir quota mechanism works by estimating the current size of the maildir, with periodic exact recalculation. Obviously non quota-aware maildir applications will not update the maildir size estimation, so the estimate will be thrown off for some period of time, until the next recalculation.</p><p>This voluntary quota mechanism is designed to be a reasonable compromise between effectiveness, and performance. The entire purpose of using maildir-based mail storage is to avoid any kind of locking, and to permit parallel access to mail by multiple applications. In order to compute the exact size of a maildir, the maildir must be locked somehow to prevent any modifications while its contents are added up. Obviously something like that defeats the original purpose of using maildirs, therefore the voluntary quota mechanism does not use locking, and that&apos;s why the current recorded maildir size is always considered to be an estimate. Regular size recalculations will compensate for any occasional race conditions that result in the estimate to be thrown off.</p><p>A quota for an existing maildir is installed by running maildirmake with the -q option, and naming an existing maildir. The -q option takes a parameter, <em>quota</em>, which is a comma-separated list of quota specifications. A quota specification consists of a number followed by either &apos;S&apos;, indicating the maximum message size in bytes, or &apos;C&apos;, maximum number of messages. For example:</p>
<pre>
<strong>maildirmake -q 5000000S,1000C ./Maildir</strong>
</pre>
<p>This sets the quota to 5,000,000 bytes or 1000 messages, whichever comes first.</p>
<pre>
<strong>maildirmake -q 1000000S ./Maildir</strong>
</pre>
<p>This sets the quota to 1,000,000 bytes, without limiting the number of messages.</p><p>A quota of an existing maildir can be changed by rerunning the <strong>maildirmake</strong> command with a new -q option. To delete a quota entirely, delete the <em>Maildir</em>/maildirsize file.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO maildir.courier&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<strong></strong><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a>\m[]\s-2\u[1]\d\s+2.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p><strong>Sam Varshavchik</strong></p><p>Author</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p><a href="../man1/maildirmake.1.html"><strong>maildirmake</strong>(1)</a></p><p>[set $man.base.url.for.relative.links]/maildirmake.html</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p>RFC 1521</p><p>http://www.rfc-editor.org/rfc/rfc1521.txt</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p>Courier</p><p>http://www.courier-mta.org</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p><strong>deliverquota</strong>(8)</p><p>[set $man.base.url.for.relative.links]/deliverquota.html</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><strong>maildirquota</strong>(7)</p><p>[set $man.base.url.for.relative.links]/maildirquota.html</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="maildir.5.html"><span aria-hidden="true">&larr;</span> maildir.5: Directory for incoming mail messages</a></li>
   <li class="next"><a href="maildir.maildrop.5.html">maildir.maildrop.5: E-mail directory <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
