<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cman: Cluster.conf cman configuration section</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Cluster.conf cman configuration section">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="cman (5) manual">
  <meta name="twitter:description" content="Cluster.conf cman configuration section">
  <meta name="twitter:image" content="https://www.carta.tech/images/cman-cman-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/cman.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="cman (5) manual" />
  <meta property="og:description" content="Cluster.conf cman configuration section" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/cman-cman-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">cman<small> (5)</small></h1>
        <p class="lead">Cluster.conf cman configuration section</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/cman.5.html">
      <span itemprop="name">cman: Cluster.conf cman configuration section</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/cman/">
      <span itemprop="name">cman</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/cman.5.html">
      <span itemprop="name">cman: Cluster.conf cman configuration section</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>Cman configuration values are placed in the &lt;cman&gt; &lt;/cman&gt; section of <strong>cluster.conf</strong>.  Per-node configuration related to cman is placed in the standard &lt;clusternode&gt; &lt;/clusternode&gt; sections.  All cman configuration settings are optional; usually none are used.  The &lt;cman&gt; section is placed under the &lt;cluster&gt; section in cluster.conf.</p>
<pre>
  &lt;cluster&gt;
    &lt;cman&gt;
    &lt;/cman&gt;
    ...
  &lt;/cluster&gt;
</pre>
<p><em>UDP port</em> By default, cman will use UDP port 5405/5404 for internode communication.  This can be changed by setting a port number as follows:</p>
<pre>
  &lt;cman port="6809"&gt;
  &lt;/cman&gt;
</pre>
<p>This will cause cman to use ports 6809 and 6808 for cluster communications.</p><p><em>Expected votes</em> The expected votes value is used by cman to determine quorum.  The cluster is quorate if the sum of votes of existing members is over half of the expected votes value.  By default, cman sets the expected votes value to be the sum of votes of all nodes listed in cluster.conf.  This can be overridden by setting an explicit expected_votes value as follows:</p>
<pre>
  &lt;cman expected_votes="3"&gt;
  &lt;/cman&gt;
</pre>
<p>If the cluster becomes partitioned, improper use of this option can result in more than one partition gaining quorum.  In that event, nodes in each partition will enable cluster services.</p><p><em>Two node clusters</em> Ordinarily, the loss of quorum after one out of two nodes fails will prevent the remaining node from continuing (if both nodes have one vote.)  Special configuration options can be set to allow the one remaining node to continue operating if the other fails.  To do this only two nodes, each with one vote, can be defined in cluster.conf.  The two_node and expected_votes values must then be set to 1 in the cman section as follows.</p>
<pre>
  &lt;cman two_node="1" expected_votes="1"&gt;
  &lt;/cman&gt;
</pre>
<p><em>Node votes</em> By default, a node is given one vote toward the calculation of quorum. This can be changed by giving a node a specific number of votes as follows:</p>
<pre>
  &lt;clusternode name="nd1" votes="2"&gt;
  &lt;/clusternode&gt;
</pre>
<p><em>Node ID</em></p><p>All nodes must have a unique node ID. This is a single integer that identifies it to the cluster. A node's application to join the cluster may be rejected if you try to set the nodeid to one that is already used.</p>
<pre>
  &lt;clusternode name="nd1" nodeid="1"&gt;
  &lt;/clusternode&gt;
</pre>
<p><em>Multi-home configuration</em> It is quite common to use multiple ethernet adapters for cluster nodes, so they will tolerate the failure of one link. A common way to do this is to use ethernet bonding. Alternatively you can get corosync to run in redundant ring mode by specifying an 'altname' for the node. This is an alternative name by which the node is known, that resolves to another IP address used on the other ethernet adapter(s). You can optionally specify a different port and/or multicast address for each altname in use. Up to 9 altnames (10 interfaces in total) can be used.</p><p>Note that if you are using the DLM with cman/corosync then you MUST tell it to use SCTP as it's communications protocol as TCP does not support multihoming.</p>
<pre>
  &lt;clusternode name="nd1" nodeid="1"&gt;
     &lt;altname name="nd1a" port="6809" mcast="239.192.0.2"/&gt;
  &lt;/clusternode&gt;
</pre>

<pre>
  &lt;dlm protocol="sctp"/&gt;
</pre>
<p><em>Multicast network configuration</em> cman uses multicast UDP packets to communicate with other nodes in the cluster. By default it will generate a multicast address using 239.192.x.x where x.x is the 16bit cluster ID number split into bytes. This, in turn is generated from a hash of the cluster name though it can be specified explicitly. The purpose of this is to allow multiple clusters to share the same subnet - they will each use a different multicast address. You might also/instead want to isolate clusters using the port number as shown above.</p><p>It is possible to override the multicast address by specifying it in cluster.conf as shown:</p>
<pre>
  &lt;cman&gt;
      &lt;multicast addr="239.192.0.1"/&gt;
  &lt;/cman&gt;
</pre>
<p><em>Cluster ID</em> The cluster ID number is used to isolate clusters in the same subnet. Usually it is generated from a hash of the cluster name, but it can be overridden here if you feel the need. Sometimes cluster names can hash to the same ID.</p>
<pre>
  &lt;cman cluster_id="669"&gt;
  &lt;/cman&gt;
</pre>
<p><em>corosync security key</em> All traffic sent out by cman/corosync is encrypted. By default the security key used is simply the cluster name. If you need more security you can specify a key file that contains the key used to encrypt cluster communications. Of course, the contents of the key file must be the same on all nodes in the cluster. It is up to you to securely copy the file to the nodes.</p>
<pre>
  &lt;cman keyfile="/etc/cluster/corosync.key"&gt;
  &lt;/cman&gt;
</pre>
<p>Note that this only applies to cluster communication. The DLM does not encrypt traffic.</p><p><em>Other corosync parameters</em> When corosync is started by cman (cman_tool runs corosync), the corosync.conf file is not used.  Many of the configuration parameters listed in corosync.conf can be set in cluster.conf instead.  Cman will read corosync parameters from the following sections in cluster.conf and load them into corosync:</p>
<pre>
  &lt;cluster&gt;
    &lt;totem /&gt;
    &lt;event /&gt;
    &lt;aisexec /&gt;
    &lt;group /&gt;
  &lt;/cluster&gt;
</pre>
<p>See the <a href="../man5/corosync.conf.5.html"><strong>corosync.conf</strong>(5)</a></strong> man page for more information on keys that are valid for these sections. Note that settings in the &lt;clusternodes&gt; section will override settings in the sections above, and options on the cman_tool command line will override both.  In particular, settings like bindnetaddr, mcastaddr, mcastport and nodeid will always be replaced by values in &lt;clusternodes&gt;.</p><p>Cman uses different defaults for some of the corosync parameters listed in <a href="../man5/corosync.conf.5.html"><strong>corosync.conf</strong>(5)</a>.  If you wish to use a non-default setting, they can be configured in cluster.conf as shown above.  Cman uses the following default values:</p>
<pre>
  &lt;totem
    vsftype="none"
    token="10000"
    token_retransmits_before_loss_const="20"
    join="60"
    consensus="4800"
    rrp_mode="none"
    &lt;!-- or rrp_mode="active" if altnames are present &gt;
  /&gt;
  &lt;aisexec user="root" group="root" /&gt;
</pre>
<p>Here's how to set the token timeout to five seconds:</p>
<pre>
  &lt;totem token="5000"/&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO cman&hellip;</h2>
        <div class="sectioncontent">
<p><a href="../man5/cluster.conf.5.html"><strong>cluster.conf</strong>(5)</a>, <a href="../man5/corosync.conf.5.html"><strong>corosync.conf</strong>(5)</a>, <a href="../man8/cman_tool.8.html"><strong>cman_tool</strong>(8)</a></p>
        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cluster.conf.5.html"><span aria-hidden="true">&larr;</span> cluster.conf.5: Configuration file for cman and related daemons</a></li>
   <li class="next"><a href="cmap.5.html">cmap.5: Format of .cmap files (color maps) <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
