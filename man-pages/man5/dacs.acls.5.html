<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700&effect=destruction%7Cshadow-multiple" rel="stylesheet" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>dacs.acls: Dacs access control rules</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/manpage.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="Dacs access control rules">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@CartaTech">
  <meta name="twitter:creator" content="@CartaTech">
  <meta name="twitter:title" content="dacs.acls (5) manual">
  <meta name="twitter:description" content="Dacs access control rules">
  <meta name="twitter:image" content="https://www.carta.tech/images/dacs-dacs.acls-5.png">
  <meta property="og:url" content="https://www.carta.tech/man-pages/man5/dacs.acls.5.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="dacs.acls (5) manual" />
  <meta property="og:description" content="Dacs access control rules" />
  <meta property="fb:app_id" content="1241677679199500" />
  <meta property="og:image" content="https://www.carta.tech/images/dacs-dacs.acls-5.png" />
  <meta property="og:image:width" content="600" />
  <meta property="og:image:height" content="315" />
</head>
<body>
  <div class="container final">
          <div class="page-header">
        <h1 class="font-effect-destruction">dacs.acls<small> (5)</small></h1>
        <p class="lead">Dacs access control rules</p>
      </div>

    <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/">
      <span itemprop="name">Man Pages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/">
      <span itemprop="name">File formats and conventions</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/dacs.acls.5.html">
      <span itemprop="name">dacs.acls: Dacs access control rules</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/">
      <span itemprop="name">Carta.tech</span>
    </a>
    <meta itemprop="position" content="1" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/">
      <span itemprop="name">Packages</span>
    </a>
    <meta itemprop="position" content="2" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/packages/dacs/">
      <span itemprop="name">dacs</span>
    </a>
    <meta itemprop="position" content="3" />
  </li>
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemscope itemtype="http://schema.org/Thing" itemprop="item" href="/man-pages/man5/dacs.acls.5.html">
      <span itemprop="name">dacs.acls: Dacs access control rules</span>
    </a>
    <meta itemprop="position" content="4" />
  </li>
</ol>
    
      <section>
        <h2 class="font-effect-shadow-multiple">DESCRIPTION</h2>
        <div class="sectioncontent">
<p>These files are part of the <strong>DACS</strong> suite.</p><p>When <strong>DACS</strong> receives a service request, expressed as a URL (see \m[blue]<strong>RFC 1738</strong>\m[]\s-2\u[1]\d\s+2, \m[blue]<strong>RFC 2396</strong>\m[]\s-2\u[2]\d\s+2, and \m[blue]<strong>RFC 3986</strong>\m[]\s-2\u[3]\d\s+2), it invokes <strong>ACS</strong> (its access control service, \m[blue]<a href="../man8/dacs_acs.8.html"><strong>dacs_acs</strong>(8)</a></strong>\m[]\s-2\u[4]\d\s+2) to determine whether the request should be carried out. <strong>ACS</strong> defines a language in which access control specifications are written to describe the conditions under which access to a resource is to be granted or denied.</p><p>When it is invoked, <strong>ACS</strong> is provided with the service request URI, its parameters (if any), the current credentials of the client, and certain environment-dependent variables. A simple protocol defines how the web server passes this information to <strong>ACS</strong> and how <strong>ACS</strong> passes its access control decision back to the web server (see \m[blue]<a href="../man8/dacs_acs.8.html"><strong>dacs_acs</strong>(8)</a></strong>\m[]\s-2\u[4]\d\s+2).</p><p>If access is not revoked for the client, <strong>ACS</strong> proceeds to search for an applicable ACL rule for the given request and client. It first searches through custom files (those configured for the jurisdiction through the virtual filestore&apos;s item type "acls"); if necessary, it will also look through a set of standard access control rules (those configured through the virtual filestore&apos;s item type "dacs_acls") in an attempt to find a closer match.</p><p>This document describes access control rules and the <strong>DACS</strong> authorization procedure.</p><p><strong>Tip</strong></p><p>The \m[blue]<a href="../man1/dacsacl.1.html"><strong>dacsacl</strong>(1)</a></strong>\m[]\s-2\u[5]\d\s+2 command is used to validate the syntax of the rulesets and to rebuild indexes. After changing a ruleset by adding, removing, or modifying a rule, \m[blue]<a href="../man1/dacsacl.1.html"><strong>dacsacl</strong>(1)</a></strong>\m[]\s-2\u[5]\d\s+2<em>must be run</em>.</p><h3>Revoking Access and Disabling Authentication: The Revocation List</h3>
<p>It is sometimes useful to have the administrative capability to "pull the plug" on a particular user, class of users, or depending on other context. This can be done in a "global" way by configuring a revocation list. The revocation list is consulted during authorization checking and by various authentication related components. The revocation list is processed by \m[blue]<a href="../man8/dacs_acs.8.html"><strong>dacs_acs</strong>(8)</a></strong>\m[]\s-2\u[4]\d\s+2 before the rulesets, thereby overriding all access control rules, to see if a request should be denied based on the current credentials (if any) associated with the user making the request. The revocation list is also used by \m[blue]<a href="../man8/dacs_authenticate.8.html"><strong>dacs_authenticate</strong>(8)</a></strong>\m[]\s-2\u[6]\d\s+2, \m[blue]<a href="../man8/dacs_auth_transfer.8.html"><strong>dacs_auth_transfer</strong>(8)</a></strong>\m[]\s-2\u[7]\d\s+2, and \m[blue]<a href="../man8/dacs_auth_agent.8.html"><strong>dacs_auth_agent</strong>(8)</a></strong>\m[]\s-2\u[8]\d\s+2 immediately after a tentatively successful authentication to check if access has been revoked for the <strong>DACS</strong> identity established through the normal authentication procedure. Note that the revocation list is not used by \m[blue]<a href="../man1/dacsauth.1.html"><strong>dacsauth</strong>(1)</a></strong>\m[]\s-2\u[9]\d\s+2 or \m[blue]<a href="../man1/dacscheck.1.html"><strong>dacscheck</strong>(1)</a></strong>\m[]\s-2\u[10]\d\s+2 (although it arguably it should be, at least optionally).</p><p>A revocation list must be configured through the item type "revocations" and must be readable, although it can be empty.</p><p>The list consists of a sequence of lines, evaluated in the order in which they appear, each of which may contain:</p><p>deny<em>expression</em></p><p>If the expression evaluates to <strong>True</strong>, 1) access is denied and the user&apos;s request is not performed and 2) revocation list processing terminates</p><p>revoke<em>expression</em></p><p>The expression is evaluated once for each set of credentials; if the expression evaluates to <strong>True</strong>, 1) those credentials will be <em>ignored in all subsequent processing of the current request</em> (as if they did not exist), including the remainder of revocation list processing, 2) access is not necessarily denied, and 3) revocation list processing continues with the next line; in the case of an unauthenticated user, revoke has the same meaning as deny. Revoking all credentials makes the user unauthenticated with respect to this request. Note that this revocation does not affect any credentials held by the user, it only temporarily "hides" them.</p><p><strong>Note</strong></p><p>It is not currently possible to construct a single expression that tests multiple credentials. If this creates difficulties, consider using the \m[blue]<strong>ACS_CREDENTIALS_LIMIT</strong>\m[]\s-2\u[11]\d\s+2 or \m[blue]<strong>AUTH_SINGLE_COOKIE</strong>\m[]\s-2\u[12]\d\s+2 directive.</p><p>disable<em>expression</em></p><p>The expression is evaluated in a context that includes the tentative credentials. If it evaluates to <strong>True</strong>, the account is deemed to be disabled and the credentials will not be issued. This is the only keyword used specifically for disabling authentication and is ignored during access control processing.</p><p>block<em>expression</em></p><p>This form combines deny and disable behaviour to both deny access and disable authentication, effectively blocking all access that satisfies the expression.</p><p>a comment, where the first non-whitespace character, if any, is a &apos;#&apos;</p><p>The keywords are case insensitive and one or more whitespace characters appear between a keyword and the expression. A line can be continued by ending it with a backslash. Any line may be preceded by whitespace characters.</p><p><strong>DACS</strong> expressions are described in \m[blue]<a href="../man5/dacs.exprs.5.html"><strong>dacs.exprs</strong>(5)</a></strong>\m[]\s-2\u[13]\d\s+2.</p><p>Examples:</p>
<pre>
# Deny access to all
deny user("any")

# Deny access to any user not already authenticated
# (subsequently no one will be able to authenticate)
deny user("unauth")

# Revoke all identities, making all users effectively unauthenticated
revoke user("any")

# Deny access to any user not authenticated by this jurisdiction
deny user("unauth") or not user("${Conf::JURISDICTION_NAME}:")

# Revoke the identity DSS:rmorriso
revoke user("DSS:rmorriso")

# Deny all access on the weekend
deny time("wday") eq 6 or time("wday") eq 0

# Deny any request not originating from a local network
deny not (from("10.0.0.0/8") or from("192.168.2.0/24"))

# Do not issue credentials to anyone from 10.0.0.124 but access is
# still possible
disable from("10.0.0.124")

# Do not issue credentials to DSS:bobo
disable user("DSS:bobo")

# Neither issue credentials nor grant access to DSS:bobo
block user("DSS:bobo")
</pre>

<h3>URL Paths and Service Name Matching</h3>
<p>While matching a service request against ACL rules, <strong>ACS</strong> recognizes a hierarchical structure for service names based on the path component of an HTTP (or HTTPS) URL. The URL path "/cgi-bin", for example, is considered to be an ancestor or parent of the path "/cgi-bin/program". The former URL path has two components, the latter has three components. The one-component URL path "/" is considered to be the ancestor of all other paths.</p><p>The * operator, which matches zero or more components that follow it, has special meaning <em>only when it appears as a path component at the end of a URL path pattern specified by a rule</em>. A system administrator can use the tail matching (wildcard) capability to establish default rules for portions of the name space of service requests. For instance the URL path pattern "/cgi-bin/*" is considered to be the ancestor of all paths having the prefix "/cgi-bin/" and matches service requests for "/cgi-bin/printenv", "/cgi-bin/", and "/cgi-bin".</p><p>Before matching a service request against the ruleset, <strong>ACS</strong> converts the service request into a canonical form. It strips any trailing / characters off of the service name (although the URL path pattern "/" is unchanged). Only absolute URLs can be specified in an ACL rule. The URL expressing the service request must also be absolute when received by <strong>DACS</strong>; typically, a web server will canonicalize the pathname corresponding to static content before <strong>ACS</strong> is invoked.</p><p><strong>Note</strong></p><p>It is the URL-encoded request URI (passed by <strong>Apache</strong> as <em>${DACS::URI}</em>) that is matched against access control rules. Path components of URLs used for matching in rules are URL-decoded before being compared against the path components of the request URI, which are also URL-decoded.</p><p><strong>ACS</strong> searches the ruleset for the rule having the most specific URL path pattern that applies to a given request URI; that is, it examines the rules to find the one that has the greatest number of components in common with the service request&apos;s. If no exact match is found, it will search for increasingly general rules that apply. Only the most specific matching rule will be applied to the request; if it fails, no other (less specific) matching rule will be considered. If two or more rules "tie" (e.g., because of duplicate rules), one rule will be chosen arbitrarily. If no suitable match if found, <strong>ACS</strong> will deny access.</p><p><strong>Note</strong></p><p>The URL path pattern may not contain a query component; this may be changed in future versions.</p><p><strong>ACS</strong> does not recognize alternate names for the same resource (e.g., achieved using symbolic links), so it is possible for each of several names for the identical resource to be associated with different access control rules.</p><p><strong>Security</strong></p><p>It is not necessarily the case that permission to access a parent or any ancestor is required to access a descendent path.</p><p>It should be emphasized that the service request URL received by the web server is textually matched against ACL rules without any interpretation on the part of <strong>ACS</strong>. Other than whether it will be mapped to static content or a CGI program, what the URL represents or how it will be processed by the web server is not taken into account by <strong>ACS</strong>.</p><p>For example, a service request for "/weekly" is not the same as a service request for "/weekly/index.html", even if "/weekly" is a directory and the web server would map the request to a file named "/weekly/index.html" and return its contents. A rule with the URL path pattern "/weekly/index.html" or "/weekly/*" (or perhaps "/*") is needed to control access to the file "/weekly/index.html".</p>
<h3>Service Parameters</h3>
<p>A user agent may optionally pass parameters to CGI programs. With the HTTP GET method, the parameters are appended to the URL sent to the web server (the "query string") and the CGI program. While the HTTP specification (\m[blue]<strong>RFC 2616</strong>\m[]\s-2\u[14]\d\s+2) does not impose a limit on the length of a URL, a browser or web server may impose a maximum. (Recent versions of Internet Explorer have a maximum URL length of 2,083 bytes and the <strong>Apache</strong> web server imposes a limit of about 8192 bytes.) In the case of the HTTP POST method, the parameters are streamed from the user agent to the web server and then to the CGI program, so the potential number of parameters and their combined size is unbounded. <strong>ACS</strong> can optionally provide a finer granularity of access control by inspecting the parameters passed with a service request. By examining parameters, an ACL rule can be used to prevent certain users from gaining particular kinds of access. A rule might restrict a parameter value to be within a certain allowed range, for example. <strong>ACS</strong> supports expressions that may test whether particular service parameters are present or reference their values.</p><p>Because in the case of the POST method it is impractical, in general, to pass <strong>ACS</strong> all parameters and their values, a web server may impose limits on the number of parameters and aggregate size of parameters that it will make available to <strong>ACS</strong>. An invoked CGI program is unaffected by this limitation, however. <strong>Apache</strong>&apos;s \m[blue]<strong>mod_auth_dacs</strong>\m[]\s-2\u[15]\d\s+2 module allows its administrator to configure the maximum size of parameter data provided by the POST method that is made available to <strong>ACS</strong>.</p>
<h3>Constraints</h3>
<p>In some cases, merely testing parameter values is insufficient to determine whether access should be granted. Consider the case where a service is a program, a request&apos;s parameters represent the coordinates of a geographic area to be displayed, and some areas are not to be shown to some users, perhaps because they are "top secret". Examination of the parameters alone may be insufficient to determine whether the area they describe is within such a restricted area and perhaps ought not to be displayed. That determination might also depend on the contents of a database or complex calculations, for example. It is, therefore, beyond the scope of <strong>ACS</strong> to make access control decisions in such cases.</p><p><strong>ACS</strong> addresses this problem by allowing constraints to be attached to an ACL rule and by passing them, and the identity of the client, to the service. A constraint may be thought of as a tag or additional argument that a service recognizes. If an ACL rule permits the service to be invoked, it is the responsibility of the service to take any constraints into consideration and make the final decision about granting access, which it is much better qualified to do than is <strong>ACS</strong>. In the case previously described, a constraint might notify the service that the particular user should be granted access only if the request does not involve a restricted area.</p><p>Of course, the purpose and meaning of a constraint depends on the implementation of a particular service. Different services might interpret the same constraint in completely different ways. For example, a service that performs both read-only operations and update operations might be implemented to recognize the constraint string "read-only" as meaning that it should only perform read-only operations. Alternatively, that same service might instead handle a request accompanied by the constraint string "updates-allowed" by permitting any operation for the user making the request; the absence of that constraint would restrict its functionality to read-only operations.</p><p>For additional detail, please refer to descriptions of the <strong>DACS_CONSTRAINT</strong> and <strong>DACS_DEFAULT_CONSTRAINT</strong> environment variables.</p>
<h3>ACL Files</h3>
<p>Each access control rule is stored in a virtual filestore under the item types acls and dacs_acls. The acls must be configured, and ordinarily consists of site-specific or jurisdiction-specific rules; the latter (dacs_acls) is optional and is intended to configure rules for the standard <strong>DACS</strong> web services.</p><p>The default configuration (from site.conf-std) is:</p>
<pre>
VFS "[acls]dacs-fs:${Conf::FEDERATIONS_ROOT}/&#92;
${Conf::FEDERATION_DOMAIN}/${Conf::JURISDICTION_NAME}/acls"
VFS "[dacs_acls]dacs-fs:${Conf::DACS_HOME}/acls"
</pre>
<p>Most installations store ACLs as ordinary files. This is reflected in the default configuration directive shown above and is why they are imprecisely referred to as "ACL files".</p><p><strong>Tip</strong></p><p>To make upgrading easier, avoid adding access control rules to dacs_acls (default location: /usr/local/dacs/acls) or modifying the default rules for <strong>DACS</strong> web services that appear there. Instead, put all customizations where acls has been configured. By following this practice, your customizations will not be lost when you install a new version of <strong>DACS</strong>.</p><p><strong>ACL Naming</strong></p><p>The names of ACL files (more precisely, the names of items within a virtual filestore) follow a particular convention: they <em>must</em> begin with the characters "acl-" (note: <em>the fourth character is a hyphen, not an underscore</em>) and end with a period followed by an unsigned integer value. At least one character must appear between the prefix and the suffix that begins with the period character. For example, any of the following names might be used:</p>
<pre>
acl-photos.0
acl-photos.1
acl-files.40
</pre>
<p><strong>Tip</strong></p><p>Although not currently enforced, an ACL file name should be composed of characters from the \m[blue]<strong>Portable Filename Character Set</strong>\m[]\s-2\u[16]\d\s+2: any alphanumeric character, period, hyphen, or underscore.</p><p>An ACL file may be disabled (not used by <strong>ACS</strong>) if a valid ACL filename is preceded by the characters "disabled-". The three ACLs above would be disabled if they were renamed as follows:</p>
<pre>
disabled-acl-photos.0
disabled-acl-photos.1
disabled-acl-files.40
</pre>
<p><strong>Note</strong></p><p>These two filename prefixes are defined at compile time. \m[blue]<a href="../man1/dacsacl.1.html"><strong>dacsacl</strong>(1)</a></strong>\m[]\s-2\u[5]\d\s+2 should be enhanced to notice simultaneously enabled and disabled files. <strong>FedAdmin</strong>, a \m[blue]<strong>contributed resource</strong>\m[]\s-2\u[17]\d\s+2, is an administrative interface that can manage ACLs, including enabling, disabling, fetching, and deleting them.</p><p>The numeric suffix is significant. It is used to order the evaluation of the rules by the access control service; the rules are evaluated in ascending order.</p><p>Optionally, "subdirectories" (to any depth) can be created to help organize the access control rules. The naming convention for these subdirectories is the same as for ACL files. Disabling a subdirectory effectively disables all ACL files and subdirectories beneath it. The ordering process at each level is still based on the integer suffixes. Here is an example ordering of access control rules, from first to last:</p>
<pre>
/usr/local/dacs/federations/dss/acls/acl-x.0
/usr/local/dacs/federations/dss/acls/acl-x.2
/usr/local/dacs/federations/dss/acls/acl-x.3/acl-y.7
/usr/local/dacs/federations/dss/acls/acl-x.4
/usr/local/dacs/federations/dss/acls/acl-x.5
/usr/local/dacs/federations/dss/acls/acl-x.6/acl-x.1
</pre>
<p>All ACL files and subdirectories that have invalid names are silently ignored, as are all files that are not regular files or directories (e.g., symbolic links). The behaviour is undefined if, for example, files named "acl-foo.0" and "disabled-acl-foo.0" exist simultaneously.</p><p><strong>Note</strong></p><p>Access control rules are ordinarily not placed in a location where a web server could serve them. If access control rules are themselves <strong>DACS</strong>-wrapped, however, care must be taken to structure the rules to avoid an infinite regress.</p>
<h3>ACL Syntax</h3>
<p>Basically, an ACL rule compactly expresses the triple (<em>What, Who, How</em>).</p><p><em>What:</em></p><p>the names of one or more services the rule applies to;</p><p><em>Who</em></p><p>the set of users the rule applies to; and</p><p><em>How</em></p><p>predicates and constraints that describe the conditions under which access will be allowed.</p><p>Although it&apos;s certainly possible to write complicated access control rules, you needn&apos;t be intimidated. Rules are typically quite simple and easy to understand, such as the following rule which applies to a URL that has a path component ending in /cgi-bin/dacs/myprog.php and grants access to any authenticated user:</p>
<pre>
&lt;acl_rule status="enabled"&gt;
  &lt;services&gt;
    &lt;service url_pattern="/cgi-bin/dacs/myprog.php"/&gt;
  &lt;/services&gt;

  &lt;rule order="allow,deny"&gt;
     &lt;allow&gt;
       user("auth")
     &lt;/allow&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>An access control rule is written and stored externally as an XML document with the following DTD (\m[blue]<strong>acl.dtd</strong>\m[]\s-2\u[18]\d\s+2). Management of ACL rules can be done using a standard text editor, web-based interface, or special-purpose GUI. An administrator might only see a user-friendly description of the rules and need never see a lower-level representation such as this XML representation.</p>
<pre>
&lt;!ELEMENT acl_rule (services, (identity)*, (rule)+)&gt;
&lt;!ATTLIST acl_rule
  status (enabled | disabled)             #IMPLIED
  name CDATA                              #IMPLIED
  expires_expr CDATA                      #IMPLIED
  constraint CDATA                        #IMPLIED
  permit_chaining (yes | no)              #IMPLIED
  pass_credentials (none | matched | all) #IMPLIED
  pass_http_cookie (yes | no)             #IMPLIED
  permit_caching (yes | no)               #IMPLIED
&gt;

&lt;!ELEMENT services (service | delegate)+&gt;
&lt;!ATTLIST services
    shared (yes | no) #IMPLIED
&gt;

&lt;!ELEMENT service EMPTY&gt;
&lt;!ATTLIST service
    id          CDATA #IMPLIED
    url_pattern CDATA #IMPLIED
    url_expr    CDATA #IMPLIED
&gt;

&lt;!ELEMENT delegate EMPTY&gt;
&lt;!ATTLIST delegate
    id          CDATA #IMPLIED
    url_pattern CDATA #IMPLIED
    url_expr    CDATA #IMPLIED
    rule_uri    CDATA #REQUIRED
&gt;

&lt;!ELEMENT identity EMPTY&gt;
&lt;!ATTLIST identity
    id            CDATA #IMPLIED
    iptr          CDATA #REQUIRED
    ident         CDATA #REQUIRED
    selector_expr CDATA #REQUIRED
&gt;

&lt;!ELEMENT rule ((precondition)?, (allow | deny)*) &gt;
&lt;!ATTLIST rule
    id CDATA                                #IMPLIED
    order CDATA #REQUIRED
    &lt;!-- order is either of: "allow,deny" or "deny,allow" --&gt;
    constraint CDATA                        #IMPLIED
    permit_chaining (yes | no)              #IMPLIED
    pass_credentials (none | matched | all) #IMPLIED
    pass_http_cookie (yes | no)             #IMPLIED
    permit_caching (yes | no)               #IMPLIED
&gt;

&lt;!ELEMENT precondition ((user_list)?, (predicate)?)&gt;

&lt;!ELEMENT user_list (user)*&gt;

&lt;!ELEMENT user EMPTY&gt;
&lt;!ATTLIST user
    id   CDATA #IMPLIED
    name CDATA #REQUIRED
&gt;

&lt;!ELEMENT predicate (#PCDATA)&gt;

&lt;-- The allow element allows (grants) access, subject to the --&gt;
&lt;-- allow,deny/deny,allow order, if the enclosed expression is TRUE --&gt;
&lt;-- Note: any &apos;&lt;&apos; and &apos;&amp;&apos; characters appearing within an allow element --&gt;
&lt;-- must be escaped as &lt; and &amp;, respectively --&gt;

&lt;!ELEMENT allow (#PCDATA)&gt;
&lt;!ATTLIST allow
    id CDATA                                #IMPLIED
    constraint CDATA                        #IMPLIED
    permit_chaining (yes | no)              #IMPLIED
    pass_credentials (none | matched | all) #IMPLIED
    pass_http_cookie (yes | no)             #IMPLIED
    permit_caching (yes | no)               #IMPLIED
&gt;

&lt;-- The deny element denies access, subject to the allow,deny/deny,allow --&gt;
&lt;-- order, if the enclosed expression is TRUE --&gt;
&lt;-- Note: any &apos;&lt;&apos; and &apos;&amp;&apos; characters appearing within an allow element --&gt;
&lt;-- must be escaped as &lt; and &amp;, respectively --&gt;

&lt;!ELEMENT deny (#PCDATA)&gt;
&lt;!ATTLIST deny
    id CDATA                                #IMPLIED
&gt;
</pre>
<p>The optional id attribute assigns a unique label (within its acl_rule) to an element so that it can be identified conveniently and unambiguously. Attribute values consist of one or more alphanumerics and underscores. At present, no other semantics are assigned to this attribute, but this may change in future releases. Labels that begin with an underscore are reserved for <strong>DACS</strong>-generated labels.</p><p><strong>General Structure</strong></p><p>An access control rule can be divided into two parts: an ordered list of service specifications (the services element) that are matched against service requests, and an ordered list of rule specifications (the rule elements) that are processed if and only if one of the service elements is applicable. In the event that the access control rule grants access, various aspects of subsequent processing can be controlled and defaults can be established.</p><p><strong>Services</strong></p><p>This part of the rule is used during rule selection. Each service element specifies a service to which this access control rule applies. The delegate element identifies a service that is handled by an access control rule specified elsewhere. Delegation is useful if parts of the URL space are managed by different users or if rules are stored in different locations.</p><p><strong>Rule Clause Processing</strong></p><p>An access control rule consists of one or more rule elements, also called rule clauses. A rule clause consists of allow and deny elements. The allow element allows (grants) access if the enclosed expression is <strong>True</strong>, subject to the rule&apos;s order attribute. The deny element denies access if the enclosed expression is <strong>True</strong>, subject to the rule&apos;s order attribute.</p><p>Each rule must have an order attribute that says whether the evaluation order is "allow,deny" or "deny,allow". This attribute serves much the same purpose as, and has semantics similar to, the <strong>Apache</strong>\m[blue]<strong>mod_access</strong>\m[]\s-2\u[19]\d\s+2 module&apos;s Order directive.</p><p>The allow,deny ordering <em>denies access by default</em> and causes allow elements to be evaluated <em>before</em>deny elements. A request that <em>does not</em> satisfy an allow element or <em>does</em> satisfy a deny element will be denied. Equivalently, a request must satisfy an allow element but not satisfy any deny element for access to be granted. If a rule element has no allow element, it is processed as if it had an allow element that evaluated to <strong>False</strong>. If a rule element has no deny element, access is granted only if an allow element evaluates to <strong>True</strong>.</p><p>The deny,allow ordering <em>permits access by default</em> and causes deny elements to be evaluated <em>before</em>allow elements. A request that <em>does not</em> satisfy a deny element or <em>does</em> satisfy an allow element will be allowed. Equivalently, a request must satisfy a deny element but not satisfy any allow element for access to be denied. If a rule element has no deny element, it is processed as if it had an deny element that evaluated to <strong>False</strong>. If a rule element has no allow element, access is granted only if no deny element evaluated to <strong>True</strong>.</p><p>As soon as one allow (deny) element evaluates to <strong>True</strong>, no other elements of the same type are evaluated.</p><p><strong>Note</strong></p><p>Any &apos;&lt;&apos; and &apos;&&apos; characters appearing within an allow element or a deny element must be escaped as "&lt;" and "&amp;", respectively.</p><p><strong>The Precondition Element</strong></p><p>A rule may optionally have exactly one precondition element. The precondition element is a "guard" to enable or disable a particular rule. This might be used, for example, to write one rule for weekdays and another for weekends. It can specify a list of users, an expression, or both. For the rule to be enabled for evaluation, its expression must first evaluate to <strong>True</strong>; if the user_list element is present, the user making the request must be among those listed and if the predicate is present, it must evaluate to <strong>True</strong>. The precondition primarily serves three purposes:</p><p>it can make it clear which user(s) the rule applies to;</p><p>it can improve by efficiency by avoiding having to evaluate potentially expensive expressions; and</p><p>it provides a way to have multiple rule elements, any of which might be enabled depending on the run-time context.</p><p><strong>Expressions</strong></p><p><strong>DACS</strong> employs expressions in access control rules and in configuration files (see \m[blue]<a href="../man5/dacs.exprs.5.html"><strong>dacs.exprs</strong>(5)</a></strong>\m[]\s-2\u[13]\d\s+2). For example, an expression or sequence of statements may appear within predicate, allow, and deny elements of an access control rule. If an expression (or sequence) evaluates to zero, the null string, or an error occurs, the result is <strong>False</strong>. If it evaluates to non-zero or a non-null string and no error occurs, the result of the expression (or sequence) is <strong>True</strong>. In general, arithmetic overflow and underflow, rounding, and other similar conditions will not be detected or considered as errors.</p><p>The particular context within which a service request is being evaluated is made available to an expression through a set of variables. They are described with the \m[blue]<a href="../man8/dacs_acs.8.html"><strong>dacs_acs</strong>(8)</a></strong>\m[]\s-2\u[4]\d\s+2.</p><p>Rules are examined in the order in which they are specified. If a precondition is <strong>False</strong>, processing continues with the next rule. The first rule with a <strong>True</strong>precondition will be used; no other rule will be examined. If no precondition element is given for a rule, it is equivalent to a precondition that evaluates to <strong>True</strong>. If no rule satisfies its precondition, access is denied.</p><p><strong>ACL Rule Elements</strong></p><p>The various syntactical components of access control rules are now described. When a request is being processed, <strong>ACS</strong> examines a ruleset, which is a collection of acl_rule elements that are located and accessed depending on the jurisdiction&apos;s configuration.</p><p><strong>DACS</strong> expressions are described in \m[blue]<a href="../man5/dacs.exprs.5.html"><strong>dacs.exprs</strong>(5)</a></strong>\m[]\s-2\u[13]\d\s+2.</p><p>acl_rule</p>
<pre>
&lt;!ELEMENT acl_rule (services, (identity)*, (rule)+)&gt;
&lt;!ATTLIST acl_rule
  status (enabled | disabled)             #IMPLIED
  name CDATA                              #IMPLIED
  expires_expr CDATA                      #IMPLIED
  constraint CDATA                        #IMPLIED
  permit_chaining (yes | no)              #IMPLIED
  pass_credentials (none | matched | all) #IMPLIED
  pass_http_cookie (yes | no)             #IMPLIED
  permit_caching (yes | no)               #IMPLIED
&gt;
</pre>
<p>An acl_rule specifies, for a given set of services, the conditions under which a request for one of those services is to be granted (or denied). It may also establish new default behaviours (overriding compile-time or configuration defaults) that will be used unless they are in turn overridden during processing of this rule. The name attribute can be used to assign a symbolic name to the rule; some programs (e.g., \m[blue]<a href="../man1/dacsrlink.1.html"><strong>dacsrlink</strong>(1)</a></strong>\m[]\s-2\u[20]\d\s+2) use this name to catch errors. The expires_expr attribute determines if the ACL should be ignored (and potentially deleted, although no <strong>DACS</strong> programs currently implement this). If the expression expires_expr evaluates to <strong>True</strong>, the rule should be deleted.</p><p>identity</p>
<pre>
&lt;!ELEMENT identity EMPTY&gt;
&lt;!ATTLIST identity
    id            CDATA #IMPLIED
    iptr          CDATA #REQUIRED
    ident         CDATA #REQUIRED
    selector_expr CDATA #REQUIRED
&gt;
</pre>
<p>This element associates a specified identity (ident) with the request <em>during processing of this </em><em>acl_rule</em><em> only</em>. This "assigned identity" overrides any identity or identities that were submitted with the request and is not tested for revocation. The iptr attribute is essentially a unique label for this element.</p><p>The identity elements are examined, in the order in which they appear, until one element is selected; no other elements will be processed. An element is selected if its attribute (selector_expr), which is an expression, evaluates to <strong>True</strong>, in which case the identity specified by the ident attribute is used; its value must be a syntactically valid identity in the \m[blue]<strong>concise user syntax</strong>\m[]\s-2\u[21]\d\s+2. Access will be denied if an invalid identity is produced, and rule processing will proceed normally if no element is selected.</p><p>The primary purpose of this element is to support an operational mode of the \m[blue]<strong>Rlinks</strong>\m[]\s-2\u[22]\d\s+2 feature, but the capability may eventually be generalized. This element is subject to change. A future enhancement may allow the identity to alternatively be determined by expression evaluation.</p><p>services</p>
<pre>
&lt;!ELEMENT services (service | delegate)+&gt;
&lt;!ATTLIST services
    shared (yes | no) #IMPLIED
&gt;
</pre>
<p>This element groups service and delegate elements.</p><p>service</p>
<pre>
&lt;!ELEMENT service EMPTY&gt;
&lt;!ATTLIST service
    id          CDATA #IMPLIED
    url_pattern CDATA #IMPLIED
    url_expr    CDATA #IMPLIED
&gt;
</pre>
<p>To decide whether this acl_rule might apply to a request, <strong>ACS</strong> examines the set of one or more service elements. Each service element has either a url_pattern attribute or a url_expr attribute (but not both); the only difference is that the url_expr attribute is an expression that is evaluated and converted to a string that is used internally as the url_pattern (it is a fatal error if the evaluation results in an error or the null string). Each effective url_pattern, whether given as a url_pattern attribute value or derived from a url_expr, is a simple pattern that may be matched against the URL of a service request. With the exception of the special &apos;*&apos; pattern, an effective url_pattern must begin with a &apos;/&apos;; its last component may be a &apos;/*&apos; to indicate that the pattern matches zero or more components of the service request URL that follow.</p><p>The special &apos;*&apos; pattern <em>always</em> results in a successful exact match, causing rule searching to terminate immediately. It is useful as the value of a url_expr that has determined that its rule should be selected. Note that the semantics of this pattern are different from those of the pattern &apos;/*&apos;, which results in a successful match only if no closer match is found.</p><p>During matching, the URL of the service request is first stripped up to and including the hostname part, and parameters, if any, are excluded (starting with a &apos;?&apos; character and extending to the end). Any trailing &apos;/&apos; characters are removed.</p><p>Consider the service request "/cgi-bin/metalogic/metalogic_groups" being matched against the following set of service elements:</p><p>&lt;service url_pattern="/*"/&gt;</p><p>&lt;service url_pattern="/cgi-bin/*"/&gt;</p><p>&lt;service url_pattern="/cgi-bin/metalogic/*"/&gt;</p><p>&lt;service url_pattern="/cgi-bin/metalogic/metalogic_groups"/&gt;</p><p>&lt;service url_pattern="/tmp/foo.gif"/&gt;</p><p>The first four prefixes match the service request URL, but the fourth url_pattern is selected since it is the most specific match, with the third url_pattern being the next most specific match.</p><p>When a single site is home to more than one jurisdiction, it is often handy to be able to share access control rules among the jurisdictions. The shared attribute controls this behaviour. This is best described through an example. Consider the following (partial) Jurisdiction sections:</p>
<pre>
&lt;Jurisdiction uri="dss.ca"&gt;
  JURISDICTION_NAME "ANIMAL"
&lt;/Jurisdiction&gt;

&lt;Jurisdiction uri="dss.ca/dog"&gt;
  JURISDICTION_NAME "DOG"
&lt;/Jurisdiction&gt;

&lt;Jurisdiction uri="dss.ca/cat"&gt;
  JURISDICTION_NAME "CAT"
&lt;/Jurisdiction&gt;
</pre>
<p>With this feature enabled for a set of services, a request for dss.ca/cat/foo... will only consider the /foo... substring when searching the url_pattern attributes to find a matching rule.</p><p>The syntax for the shared attribute is as follows:</p>
<pre>
&lt;!-- Share all services among --&gt;
&lt;!-- path-differentiated jurisdictions --&gt;
&lt;services shared="yes"&gt;

&lt;!-- Do not share services among --&gt;
&lt;!-- path-differentiated jurisdictions --&gt;
&lt;services shared="no"&gt;

&lt;!-- Default: share all services among --&gt;
&lt;!-- path-differentiated jurisdictions --&gt;
&lt;services&gt;
</pre>
<p>Here are some examples, given the configuration above:</p>
<pre>
Partial request URI                 Matched url_pattern

dss.ca/cgi-bin/dacs/dacs_prenv      --&gt;  /cgi-bin/dacs/dacs_prenv
dss.ca/dog/cgi-bin/dacs/dacs_prenv  --&gt;  /cgi-bin/dacs/dacs_prenv
dss.ca/cat/cgi-bin/dacs/dacs_prenv  --&gt;  /cgi-bin/dacs/dacs_prenv
</pre>
<p><strong>Tip</strong></p><p>The default behaviour is the same as if shared="yes" were specified. When this feature is enabled, dss.ca/cat/cgi-bin/dacs/dacs_prenv will not match dss.ca/cgi-bin/dacs/dacs_prenv in the example configuration above.</p><p>The default rules for <strong>DACS</strong> services assume the default behaviour with respect to sharing.</p><p>delegate</p>
<pre>
&lt;!ELEMENT delegate EMPTY&gt;
&lt;!ATTLIST delegate
    id          CDATA #IMPLIED
    url_pattern CDATA #IMPLIED
    url_expr    CDATA #IMPLIED
    rule_uri    CDATA #REQUIRED
&gt;
</pre>
<p>The delegate element functions exactly like the service element with respect to matching. Its purpose, however, is to redirect responsibility for subsequent access control processing for the request to another ruleset.</p><p>There are many applications for this feature, but a common one is for a <strong>DACS</strong> administrator to "carve up" the URL space by delegating parts of it such that individual users are responsible for the rules governing their portion of the space. For example, URL paths that begin with /bob, /ted, and /ann might be delegated to rulesets found in /u/bob/.dacs/acls, /u/ted/.dacs/acls, and /u/ann/.dacs/acls, respectively, and a request like https://example.com/bob/index.html would be fielded by the ruleset found in /u/bob/.dacs/acls.</p><p>If a delegate element is matched:</p><p>no rule clauses in this access control rule will be examined</p><p>any defaults specified in the acl_rule element will be discarded</p><p>processing of the current ruleset is terminated</p><p>the ruleset identified by the rule_uri attribute will be consulted</p><p>no default system ACLs (dacs_acls) will be examined</p><p>Processing of a delegated ruleset is performed in the same way as a non-delegated ruleset. A delegated ruleset may delegate some or all of its services to another ruleset; a maximum depth of three is enforced.</p><p>Any error encountered during processing will cause access to be denied.</p><p><strong>Note</strong></p><p>Despite the attribute name, the value of the rule_uri attribute must currently be a defined item type or a URL that identifies a directory or a supported database (i.e., having a URL scheme of file, dacs-db, or dacs-ndbm) The semantics of this attribute are still being considered.</p><p>For example, an ACL with the elements:</p>
<pre>
&lt;delegate url_pattern="/cgi-bin/myprog" rule_uri="my_acls"/&gt;
&lt;delegate url_pattern="/*" rule_uri="file:/u/bob/delegated"/&gt;
</pre>
<p>and the configuration:</p>
<pre>
VFS "[my_acls]dacs-db:/u/bob/my_acls.db"
</pre>
<p>will delegate service requests matching the first element to rules found in the Berkeley DB file /u/bob/my_acls.db and all other service requests to a ruleset found in the directory /u/bob/delegated.</p><p><strong>Security</strong></p><p>Delegated access control rules have access to all functions (including <strong>exec()</strong>) and all configuration information. Note that <strong>dacs_acs</strong> runs at the privilege level of <strong>Apache</strong>. For this reason, be very careful how delegation is used. Log messages identify selection of delegated rules and can be used to detect improper use. A future version of <strong>DACS</strong> should provide a way to optionally restrict the abilities of delegated rules.</p><p>rule</p>
<pre>
&lt;!ELEMENT rule ((precondition)?, (allow | deny)*) &gt;
&lt;!ATTLIST rule
    id CDATA                                #IMPLIED
    order CDATA #REQUIRED
    &lt;!-- order is either of: "allow,deny" or "deny,allow" --&gt;
    constraint CDATA                        #IMPLIED
    permit_chaining (yes | no)              #IMPLIED
    pass_credentials (none | matched | all) #IMPLIED
    pass_http_cookie (yes | no)             #IMPLIED
    permit_caching (yes | no)               #IMPLIED
&gt;
</pre>
<p>Assuming that <strong>ACS</strong> has determined that this acl_rule is the one that best matches a request, it will then examine one or more of its rule elements and use the first one that has been enabled (that is, satisfies its precondition). An enabled rule element may establish new default behaviours (overriding compile-time, configuration, or acl_rule defaults) that will be used unless they are in turn overridden during processing of this rule.</p><p>Information regarding \m[blue]<strong>rule clause processing</strong>\m[]\s-2\u[23]\d\s+2 appeared earlier.</p><p>precondition</p>
<pre>
&lt;!ELEMENT precondition ((user_list)?, (predicate)?)&gt;
</pre>
<p>A precondition element is used to specify a set of users that includes the user making the request, a condition that must evaluate to <strong>True</strong>, or both. <strong>ACS</strong> will examine the rule elements from top to bottom, selecting the first rule having a precondition that is satisfied. That rule is said to be enabled and no other rule will be considered. If no rule is enabled, access will be denied.</p><p><strong>Note</strong></p><p>A precondition element must contain a predicate element, a user_list element, or both.</p><p>user_list, user</p>
<pre>
&lt;!ELEMENT user_list (user)*&gt;

&lt;!ELEMENT user EMPTY&gt;
&lt;!ATTLIST user
    id   CDATA #IMPLIED
    name CDATA #REQUIRED
&gt;
</pre>
<p>A user_list element consists of zero or more user elements, each of which has a name attribute that is matched against the client&apos;s current credentials. Please refer to the description of the \m[blue]<strong>user()</strong>\m[]\s-2\u[24]\d\s+2 function for details. A user_list that is absent or empty is effectively one that satisfies the precondition. It does not matter to <strong>ACS</strong> whether a mentioned user, group, or jurisdiction actually exists or is defined.</p><p>The following is an example of a user_list (group names are prefixed by a &apos;%&apos; character):</p>
<pre>
&lt;user_list&gt;
   &lt;user name="DSS:smith"/&gt;
   &lt;user name="%METALOGIC:admin/&gt;
   &lt;user name="10.0.0.118"/&gt;
   &lt;user name="192.168.0.0/24"/&gt;
   &lt;user name="DACS:"/&gt;
   &lt;user name="unauth"/&gt;
&lt;/user_list&gt;
</pre>
<p>predicate</p>
<pre>
&lt;!ELEMENT predicate (#PCDATA)&gt;
</pre>
<p>A predicate contains an expression (or sequence of statements) that is evaluated in the context of a particular request and client&apos;s current credentials. A predicate having no expression evaluates to <strong>True</strong>. Expressions are described with \m[blue]<a href="../man5/dacs.exprs.5.html"><strong>dacs.exprs</strong>(5)</a></strong>\m[]\s-2\u[13]\d\s+2).</p><p>allow</p>
<pre>
&lt;!ELEMENT allow (#PCDATA)&gt;
&lt;!ATTLIST allow
    id CDATA                                #IMPLIED
    constraint CDATA                        #IMPLIED
    permit_chaining (yes | no)              #IMPLIED
    pass_credentials (none | matched | all) #IMPLIED
    pass_http_cookie (yes | no)             #IMPLIED
    permit_caching (yes | no)               #IMPLIED
&gt;
</pre>
<p>An allow element contains an expression (or sequence of statements) that is evaluated in the context of a particular request and client&apos;s current credentials. If it evaluates to <strong>True</strong>, an allow element may establish particular behaviours (overriding compile-time or configuration defaults or encompassing acl_rule or rule element defaults). Information regarding \m[blue]<strong>rule clause processing</strong>\m[]\s-2\u[23]\d\s+2 appeared earlier.</p><p>deny</p>
<pre>
&lt;!ELEMENT deny (#PCDATA)&gt;
&lt;!ATTLIST deny
    id CDATA                                #IMPLIED
&gt;
</pre>
<p>A deny element contains an expression (or sequence of statements) that is evaluated in the context of a particular request and client&apos;s current credentials. Information regarding \m[blue]<strong>rule clause processing</strong>\m[]\s-2\u[23]\d\s+2 appeared earlier.</p><p>If <strong>ACS</strong> grants access, various aspects of subsequent behaviour can be controlled through attributes of acl_rule elements, with attributes specified at a "deeper" level overriding ones encountered earlier during ruleset processing.</p><p>A constraint can optionally be specified. If access is granted and a constraint has been provided by the particular allow element that evaluated to <strong>True</strong>, it is made available as the value of an environment variable named <strong>DACS_CONSTRAINT</strong> exported to the invoked CGI program. If access is granted and a default constraint has been provided, it is similarly made available as the value of an environment variable named <strong>DACS_DEFAULT_CONSTRAINT</strong>. Neither variable is defined if no value for it has been specified.</p><p>If access is granted, <strong>ACS</strong> can be told through the pass_credentials attribute whether it should pass the user&apos;s current credentials on to the invoked service. For security reasons, it does not pass credentials ("none") by default. It can be instructed to pass all current credentials ("all"); a service such as \m[blue]<a href="../man8/dacs_current_credentials.8.html"><strong>dacs_current_credentials</strong>(8)</a></strong>\m[]\s-2\u[25]\d\s+2, for example, needs to receive all of the current credentials. A third alternative is to pass only the current credentials of the identity that was used to grant access by having satisfied a user element ("matched"); in the case of multiple current credentials, it may not be possible to predict which current credentials will be matched. When permitted, credentials are passed in the same HTTP cookie format in which they were received as the value of the <strong>DACS_COOKIE</strong> environment variable. <strong>DACS</strong> will look for the user&apos;s <strong>DACS</strong> cookies in that variable before checking the <strong>HTTP_COOKIE</strong> environment variable.</p><p><strong>Security</strong></p><p>Because environment variables are typically visible to all programs on a system, <strong>ACS</strong> "hobbles" or "weakens" credentials exported through them such that they can only be used in a few limited ways. Using them for access control purposes is not one of those ways, otherwise a <strong>DACS</strong> identity could easily be stolen by any user having access to the variables.</p><p>In addition to the environment variable problem, a user might be tricked into invoking a service, though <strong>DACS</strong>-wrapped, that is under the control of an attacker. Weakening the credentials that are available to the service makes it difficult for the attacker to do any harm with them.</p><p>A <strong>DACS</strong> administrator who understands the implications of visible credentials, and who still insists on proceeding at his own risk, can disable the <strong>DACS</strong> security measures by setting the permit_chaining attribute to yes. Any jurisdiction that should honor such credentials for access control purposes must set the configuration directive \m[blue]<strong>PERMIT_CHAINING</strong>\m[]\s-2\u[26]\d\s+2 to yes. This will allow the credentials passed to a service invoked at that jurisdiction to be used for access control purposes. By default, this "chaining" or "cascading" behaviour is not permitted and the credentials are invalid for access control purposes.</p><p>If the pass_credentials attribute is all or matched for the matching rule, unaltered credentials will be exported through the <strong>DACS_COOKIE</strong> environment variable.</p><p>If access is granted, <strong>DACS</strong> can be told whether it should pass the Cookie header field to the invoked service. By default, pass_http_cookie is "no" to reduce the risk of cookies being exposed. Unless <strong>DACS</strong> has been configured with ALLOW_HTTP_COOKIE set to "yes", <strong>DACS</strong> services will refuse to operate if they receive a Cookie header field. If pass_http_cookie is "yes", however, the Cookie header field will be retained.</p><p><strong>Tip</strong></p><p>Setting pass_http_cookie to "yes" is often necessary in cases where <strong>Apache</strong> does an internal redirect, as when it invokes scripts through the \m[blue]<strong>Action</strong>\m[]\s-2\u[27]\d\s+2 directive or when it automatically creates a directory index (as by the Indexes option of the \m[blue]<strong>Options</strong>\m[]\s-2\u[28]\d\s+2 directive). If this attribute is not enabled, Apache will lose track of the identity associated with the request when the redirection occurs, and it will appear to <strong>DACS</strong> as if the user making the redirected request is not authenticated.</p><p>The permit_caching attribute is used to indicate that positive access control decisions associated with the rule are eligible for caching. Please see \m[blue]<strong>Authorization Caching</strong>\m[]\s-2\u[29]\d\s+2 for details.</p><p>Groups are discussed in a separately in \m[blue]<a href="../man5/dacs.groups.5.html"><strong>dacs.groups</strong>(5)</a></strong>\m[]\s-2\u[30]\d\s+2.</p>
<h3>The ACL Selection and Evaluation Algorithm</h3>
<p>The following algorithm is used by <strong>ACS</strong> to determine if a particular service request (<em>S</em>, in canonical form) with optional parameters (<em>P</em>) should be granted for a user with verified credentials (<em>C</em>) within a particular execution environment (<em>E</em>). At this point, <strong>ACS</strong> has already determined that the revocation list has not denied access.</p><p><strong>ACS</strong> searches the ruleset for an acl_rule (<em>R</em>) that lists a service or delegation (using url_pattern or by evaluation of a url_expr) that most closely matches <em>S</em>. The list of services is examined in the order in which they appear.</p><p>If any acl_rule matches exactly, it is selected and the search for an acl_rule is terminated; no other acl_rule in the current ruleset will be examined. Otherwise, the next acl_rule specification will be examined.</p><p>The acl_rule elements in the ruleset are examined in increasing order of the integer suffix of each rule&apos;s name.</p><p>A particular url_pattern should appear exactly once within the entire ruleset.</p><p><strong>ACS</strong> does not treat a duplicated url_pattern as an error, however, nor is it required to check for duplicates.</p><p>If the closest match delegates responsibility to another ruleset, the procedure restarts by searching that ruleset.</p><p>Each rule element in <em>R</em> is examined, from top to bottom, until all have been examined or until one is found that is enabled. An enabled rule either has no precondition element or has a precondition that evaluates to <strong>True</strong>. If an enabled rule is found, no other rule will be considered. If no enabled rule is found, access is denied.</p><p>A precondition is <strong>True</strong> if the user is identified by a user element (or if there is no user_list element or no user element) and if the predicate element evaluates to <strong>True</strong> (or if there is no predicate element).</p><p>During user_list processing, for each set of current credentials, the credentials are compared against the list of user elements in the order in which the user elements appear in the user_list.</p><p>If there is more than one set of credentials accompanying the request, <em>C</em> is considered to be the union of all of the credentials.</p><p>If the enabled rule specifies the order allow,deny, then allow elements are examined before deny elements; if the order is deny,allow, then deny elements are examined before allow elements.</p><p>Evaluation of allow elements always stops when one evaluates to <strong>True</strong>.</p><p>Evaluation of deny elements always stops when one evaluates to <strong>True</strong>.</p><p>In the case of an allow,deny ordering, access is denied by default and allow elements are evaluated before deny elements; a request that does not satisfy an allow element or does satisfy a deny element will be denied.</p><p>In the case of a deny,allow ordering, access is granted by default and causes deny elements to be evaluated before allow elements; a request that does not satisfy a deny element or does satisfy an allow element will be allowed.</p><p>If any predicate evaluates to <strong>True</strong>, the user will be granted access to <em>S</em> with <em>P</em>.</p><p>If access is granted, default or specific attributes associated with the matching acl_rule, rule, or allow elements will be passed to <em>S</em>.</p><p><strong>Security</strong></p><p>It is possible to construct rules such that more than one rule, allow, or deny element applies to a particular user or are contradictory. Such conditions are neither detected nor considered an error.</p>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">EXAMPLES</h2>
        <div class="sectioncontent">
<p>For conciseness, some of the following examples omit the services element.</p><p>This rule grants access to everyone because it establishes "allow" as the default and there is no satisfied deny element.</p>
<pre>
&lt;rule order="deny,allow"&gt;&lt;/rule&gt;
</pre>
<p>This rule denies access to everyone because it establishes "deny" as the default and there is no satisfied allow element.</p>
<pre>
&lt;rule order="allow,deny"&gt;&lt;/rule&gt;
</pre>
<p>This rule establishes the evaluation order allow,deny and there are two allow elements and no deny elements, which means that access will only be granted if one of the allow elements evaluates to <strong>True</strong>. The second allow element evaluates to <strong>True</strong> if 1) the variable <em>SCALE</em> is greater than 1000 and the user is authenticated or 2) the variable <em>SCALE</em> is greater than 10000 and the user is not authenticated.</p>
<pre>
&lt;rule order="allow,deny"&gt;
  &lt;allow&gt;
    user("METALOGIC:rmorriso") or user("DSS:brachman")
  &lt;/allow&gt;

  &lt;allow&gt;
    (${Args::SCALE} gt 1000 and user("auth"))
       or (${Args::SCALE} gt 10000 and user("unauth"))
  &lt;/allow&gt;
&lt;/rule&gt;
</pre>
<p>If the evaluation order deny,allow were selected instead, access would always be granted (since there is no deny element and the default is to grant access). If neither of the allow elements evaluates to <strong>True</strong>, however, default attributes (if present) would be in effect.</p><p>If <em>SCALE</em> is less than 10000 and <em>LAYER-ELEMENT</em> is one of the listed layers and the user is not in the forest-inventory group, then deny. Otherwise, if the user is authenticated, allow.</p>
<pre>
&lt;rule order="allow,deny"&gt;
  &lt;deny&gt;
     ${Args::SCALE} lt 10000
      and (${Args::LAYER-ELEMENT} eq "BC_ORTHO"
      or ${Args::LAYER-ELEMENT} eq "BC_FC50K"
      or ${Args::LAYER-ELEMENT} eq "AB_FC50K"
      or ${Args::LAYER-ELEMENT} eq "SK_FC50K"
      or ${Args::LAYER-ELEMENT} eq "MV_FC50K")
      and (not user("%METALOGIC:forest-inventory-"))
  &lt;/deny&gt;

  &lt;allow&gt;
    user(auth)
  &lt;/allow&gt;
&lt;/rule&gt;
</pre>
<p>The first of these rules is selected only for requests coming from members of the group METALOGIC:forest-inventory. Access is granted to any member, except METALOGIC:rmorriso. The second of these rules is selected for requests not coming from members of that group. Access is granted only if the condition is <strong>True</strong>.</p>
<pre>
&lt;rule order="allow,deny"&gt;
  &lt;precondition&gt;
    &lt;user_list&gt;
      &lt;user name="%METALOGIC:forest-inventory"/&gt;
    &lt;/user_list&gt;
  &lt;/precondition&gt;

  &lt;allow&gt;
    not user("METALOGIC:rmorriso")
  &lt;/allow&gt;
&lt;/rule&gt;

&lt;rule order="allow,deny"&gt;
  &lt;allow&gt;
    ( ${Args::SCALE} gt 1000 and user("auth") )
      or ( ${Args::SCALE} gt 10000 and user("unauth") )
  &lt;/allow&gt;
&lt;/rule&gt;
</pre>
<p>If the first rule&apos;s precondition were instead:</p>
<pre>
&lt;precondition&gt;
  &lt;predicate&gt;
    user("%METALOGIC:forest-inventory") and user("DSS:")
  &lt;/predicate&gt;
&lt;/precondition&gt;
</pre>
<p>then the first rule would only be considered if the user belonged to that group and he was authenticated by the DSS jurisdiction.</p><p>This rule establishes a default for all CGI programs under the cgi-bin URL space. Only users authenticated by the jurisdiction METALOGIC will have access and CGI programs will be invoked with the environment variable <strong>DACS_DEFAULT_CONSTRAINT</strong> set to "MODE=execute-only".</p>
<pre>
&lt;acl_rule status="enabled" constraint="MODE=execute-only"&gt;
   &lt;services&gt;
     &lt;service url_pattern="/cgi-bin/*"/&gt;
   &lt;/services&gt;
   &lt;rule order="allow,deny"&gt;
     &lt;precondition&gt;
       &lt;user_list&gt;
         &lt;user name="METALOGIC:"/&gt;
       &lt;/user_list&gt;
     &lt;/precondition&gt;
     &lt;allow&gt;
     &lt;/allow&gt;
   &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>This rule establishes a default behaviour that denies all access.</p>
<pre>
&lt;acl_rule status="enabled"&gt;
  &lt;services&gt;
     &lt;service url_pattern="/*"/&gt;
  &lt;/services&gt;
  &lt;rule order="allow,deny"&gt;
    &lt;deny&gt;
    &lt;/deny&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>This rule establishes a default behaviour that grants access to the URL space under /any-user to any authenticated user. CGI programs will be invoked with the environment variable <strong>DACS_CONSTRAINT</strong> set to "read-only".</p>
<pre>
&lt;acl_rule status="enabled"&gt;
  &lt;services&gt;
     &lt;service url_pattern="/any-user/*"/&gt;
  &lt;/services&gt;
  &lt;rule order="allow,deny"&gt;
     &lt;allow constraint="read-only"&gt;
       user("auth")
     &lt;/allow&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>This rule establishes a default for all CGI programs under the cgi-bin/gis and cgi-bin/metalogic URL space. Access is granted to members of the groups BC:gis and NF:gis only if the value of parameter <em>X</em> is greater than 10 and the value of parameter <em>Y</em> is greater than 17. CGI programs invoked by those users will have the environment variable <strong>DACS_DEFAULT_CONSTRAINT</strong> set to "MODE=read-only". Members of the group ON:gis have no constraints on the parameters and will invoke CGI programs with the environment variable <strong>DACS_CONSTRAINT</strong> set to "read-write". Requests that do not meet either allow element will be denied.</p>
<pre>
&lt;acl_rule status="enabled" constraint="read-only"&gt;
  &lt;services&gt;
     &lt;service url_pattern="/cgi-bin/gis/*"/&gt;
     &lt;service url_pattern="/cgi-bin/metalogic/*"/&gt;
  &lt;/services&gt;

  &lt;rule order="allow,deny"&gt;
    &lt;allow&gt;
      ${Args::X} gt 10 and ${Args::Y} gt 17
         and (user("%BC:gis") or user("%NF:gis")
    &lt;/allow&gt;

    &lt;allow constraint="read-write"&gt;
       user("%ON:gis")
    &lt;/allow&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>Only bob@dss.ca, authenticated by jurisdiction DSS, will have access to the service /cgi-bin/bob-prog.cgi.</p>
<pre>
&lt;acl_rule status="enabled"&gt;
   &lt;services&gt;
     &lt;service url_pattern="/cgi-bin/bob-prog.cgi"/&gt;
   &lt;/services&gt;

   &lt;rule order="allow,deny"&gt;
     &lt;allow&gt;
       user("DSS:bob@dss.ca")
     &lt;/allow&gt;
   &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>
<p>Every user will be able to invoke the service /cgi-bin/metalogic/group if CGI parameter <em>OP</em> is LIST_GROUPS or SHOW_GROUP. If <em>OP</em> is ADD_GROUP, DELETE_GROUP, or MODIFY_GROUP, only a member of the group DSS:admin can invoke the program. String comparisons are performed without regard to case. If <em>OP</em> has any other value, access will be denied.</p>
<pre>
&lt;acl_rule status="enabled"&gt;
   &lt;services&gt;
     &lt;service url_pattern="/cgi-bin/metalogic/group"/&gt;
   &lt;/services&gt;

   &lt;rule order="allow,deny"&gt;
     &lt;allow&gt;
       ${Args::OP} eq:i "LIST_GROUPS"
          or ${Args::OP} eq:i "SHOW_GROUP"
     &lt;/allow&gt;

     &lt;allow&gt;
       (${Args::OP} eq:i "ADD_GROUP"
          or ${Args::OP} eq:i "DELETE_GROUP"
          or ${Args::OP} eq:i "MODIFY_GROUP")
          and user("%DSS:admin")
     &lt;/allow&gt;
  &lt;/rule&gt;
&lt;/acl_rule&gt;
</pre>

        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">RELATED TO dacs.acls&hellip;</h2>
        <div class="sectioncontent">
<p>\m[blue]<a href="../man1/dacsacl.1.html"><strong>dacsacl</strong>(1)</a></strong>\m[]\s-2\u[5]\d\s+2, \m[blue]<a href="../man8/dacs_admin.8.html"><strong>dacs_admin</strong>(8)</a></strong>\m[]\s-2\u[31]\d\s+2</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">AUTHOR</h2>
        <div class="sectioncontent">
<p>Distributed Systems Software (\m[blue]<strong>www.dss.ca</strong>\m[]\s-2\u[32]\d\s+2)</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">COPYING</h2>
        <div class="sectioncontent">
<p>Copyright2003-2013 Distributed Systems Software. See the \m[blue]<strong>LICENSE</strong>\m[]\s-2\u[33]\d\s+2 file that accompanies the distribution for licensing information.</p>
        </div>
      </section>

      <section>
        <h2 class="font-effect-shadow-multiple">NOTES</h2>
        <div class="sectioncontent">

<dl class='dl-vertical'>
  <dt>
     1.
  </dt>
  <dd>
    <p>RFC 1738</p><p>http://www.rfc-editor.org/rfc/rfc1738.txt</p>
  </dd>
  <dt>
     2.
  </dt>
  <dd>
    <p>RFC 2396</p><p>http://www.rfc-editor.org/rfc/rfc2396.txt</p>
  </dd>
  <dt>
     3.
  </dt>
  <dd>
    <p>RFC 3986</p><p>http://www.rfc-editor.org/rfc/rfc3986.txt</p>
  </dd>
  <dt>
     4.
  </dt>
  <dd>
    <p><a href="../man8/dacs_acs.8.html"><strong>dacs_acs</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_acs.8.html</p>
  </dd>
  <dt>
     5.
  </dt>
  <dd>
    <p><a href="../man1/dacsacl.1.html"><strong>dacsacl</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsacl.1.html</p>
  </dd>
  <dt>
     6.
  </dt>
  <dd>
    <p><a href="../man8/dacs_authenticate.8.html"><strong>dacs_authenticate</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_authenticate.8.html</p>
  </dd>
  <dt>
     7.
  </dt>
  <dd>
    <p><a href="../man8/dacs_auth_transfer.8.html"><strong>dacs_auth_transfer</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_auth_transfer.8.html</p>
  </dd>
  <dt>
     8.
  </dt>
  <dd>
    <p><a href="../man8/dacs_auth_agent.8.html"><strong>dacs_auth_agent</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_auth_agent.8.html</p>
  </dd>
  <dt>
     9.
  </dt>
  <dd>
    <p><a href="../man1/dacsauth.1.html"><strong>dacsauth</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsauth.1.html</p>
  </dd>
  <dt>
    10.
  </dt>
  <dd>
    <p><a href="../man1/dacscheck.1.html"><strong>dacscheck</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacscheck.1.html</p>
  </dd>
  <dt>
    11.
  </dt>
  <dd>
    <p>ACS_CREDENTIALS_LIMIT</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#ACS_CREDENTIALS_LIMIT</p>
  </dd>
  <dt>
    12.
  </dt>
  <dd>
    <p>AUTH_SINGLE_COOKIE</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#AUTH_SINGLE_COOKIE</p>
  </dd>
  <dt>
    13.
  </dt>
  <dd>
    <p><a href="../man5/dacs.exprs.5.html"><strong>dacs.exprs</strong>(5)</a></p><p>http://dacs.dss.ca/man/dacs.exprs.5.html</p>
  </dd>
  <dt>
    14.
  </dt>
  <dd>
    <p>RFC 2616</p><p>http://www.rfc-editor.org/rfc/rfc2616.txt</p>
  </dd>
  <dt>
    15.
  </dt>
  <dd>
    <p>mod_auth_dacs</p><p>http://dacs.dss.ca/man/mod_auth_dacs.html</p>
  </dd>
  <dt>
    16.
  </dt>
  <dd>
    <p>Portable Filename Character Set</p><p>http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap03.html#tag_03_276</p>
  </dd>
  <dt>
    17.
  </dt>
  <dd>
    <p>contributed resource</p><p>http://sourceforge.net/projects/dacs-contrib/</p>
  </dd>
  <dt>
    18.
  </dt>
  <dd>
    <p>acl.dtd</p><p>http://dacs.dss.ca/man/../dtd-xsd/acl.dtd</p>
  </dd>
  <dt>
    19.
  </dt>
  <dd>
    <p>mod_access</p><p>http://httpd.apache.org/docs-2.2/mod/mod_access.html</p>
  </dd>
  <dt>
    20.
  </dt>
  <dd>
    <p><a href="../man1/dacsrlink.1.html"><strong>dacsrlink</strong>(1)</a></p><p>http://dacs.dss.ca/man/dacsrlink.1.html</p>
  </dd>
  <dt>
    21.
  </dt>
  <dd>
    <p>concise user syntax</p><p>http://dacs.dss.ca/man/dacs.1.html#concise_user_syntax</p>
  </dd>
  <dt>
    22.
  </dt>
  <dd>
    <p>Rlinks</p><p>http://dacs.dss.ca/man/dacs_acs.8.html#rlinks</p>
  </dd>
  <dt>
    23.
  </dt>
  <dd>
    <p>rule clause processing</p><p>http://dacs.dss.ca/man/#ordering</p>
  </dd>
  <dt>
    24.
  </dt>
  <dd>
    <p>user()</p><p>http://dacs.dss.ca/man/dacs.exprs.5.html#user</p>
  </dd>
  <dt>
    25.
  </dt>
  <dd>
    <p><a href="../man8/dacs_current_credentials.8.html"><strong>dacs_current_credentials</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_current_credentials.8.html</p>
  </dd>
  <dt>
    26.
  </dt>
  <dd>
    <p>PERMIT_CHAINING</p><p>http://dacs.dss.ca/man/dacs.conf.5.html#PERMIT_CHAINING</p>
  </dd>
  <dt>
    27.
  </dt>
  <dd>
    <p>Action</p><p>http://httpd.apache.org/docs/2.2/mod/mod_actions.html#action</p>
  </dd>
  <dt>
    28.
  </dt>
  <dd>
    <p>Options</p><p>http://httpd.apache.org/docs/2.2/mod/core.html#options</p>
  </dd>
  <dt>
    29.
  </dt>
  <dd>
    <p>Authorization Caching</p><p>http://dacs.dss.ca/man/dacs_acs.8.html#authorization_caching</p>
  </dd>
  <dt>
    30.
  </dt>
  <dd>
    <p><a href="../man5/dacs.groups.5.html"><strong>dacs.groups</strong>(5)</a></p><p>http://dacs.dss.ca/man/dacs.groups.5.html</p>
  </dd>
  <dt>
    31.
  </dt>
  <dd>
    <p><a href="../man8/dacs_admin.8.html"><strong>dacs_admin</strong>(8)</a></p><p>http://dacs.dss.ca/man/dacs_admin.8.html</p>
  </dd>
  <dt>
    32.
  </dt>
  <dd>
    <p>www.dss.ca</p><p>http://www.dss.ca</p>
  </dd>
  <dt>
    33.
  </dt>
  <dd>
    <p>LICENSE</p><p>http://dacs.dss.ca/man/../misc/LICENSE</p>
  </dd>

</dl>

        </div>
      </section>
<nav>
  <ul class="pager">
   <li class="previous"><a href="cyrus.conf.5.html"><span aria-hidden="true">&larr;</span> cyrus.conf.5: Cyrus configuration file</a></li>
   <li class="next"><a href="dacs.exprs.5.html">dacs.exprs.5: Dacs expression language <span aria-hidden="true">&rarr;</span></a></li>
  </ul>
</nav>

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60781387-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
